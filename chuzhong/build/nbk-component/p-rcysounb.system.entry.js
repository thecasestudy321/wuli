var __awaiter=this&&this.__awaiter||function(t,e,i,n){function r(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function a(t){try{h(n.next(t))}catch(e){s(e)}}function o(t){try{h(n["throw"](t))}catch(e){s(e)}}function h(t){t.done?i(t.value):r(t.value).then(a,o)}h((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,r,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(t){return function(e){return h([t,e])}}function h(a){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(s=a[0]&2?r["return"]:a[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;if(r=0,s)a=[a[0]&2,s.value];switch(a[0]){case 0:case 1:s=a;break;case 4:i.label++;return{value:a[1],done:false};case 5:i.label++;r=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(a[0]===6&&i.label<s[1]){i.label=s[1];s=a;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(a);break}if(s[2])i.ops.pop();i.trys.pop();continue}a=e.call(t,i)}catch(o){a=[6,o];r=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-7243f468.system.js","./p-5008d5f5.system.js"],(function(t){"use strict";var e,i,n,r,s;return{setters:[function(t){e=t.r;i=t.c;n=t.h;r=t.g},function(t){s=t.D}],execute:function(){var a;var o;var h=t("nb_brush_container",function(){function t(t){var n=this;e(this,t);this.isActive=false;this.isUsing=true;this.cursor="";this.board=null;this.canvasMain=null;this.sizes=[0,3,6,9];this.type="pen";this.drawStyle={};this.listenerMap=new Map;this.bingBtn=null;this.bingBtnLockClick=function(t){n.lockClick(t)};this.bingBtnPenClick=function(t){n.penClick(t)};this.changeDrawStyle();this.brushOpen=i(this,"brushOpen",7)}t.prototype.freshDom=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){this.state=Math.random();t=s.domQuerySelector(this.element,"nb-lock-pen");if(t)t.freshLocation();return[2]}))}))};t.prototype.initBoard=function(t,e){return __awaiter(this,void 0,void 0,(function(){var i,n;var r=this;return __generator(this,(function(h){this.canvasMain=e;i=t.DrawingBoard;a=i.EventType;o=i.BrushType;n=s.domQuerySelector(this.element,".drawDiv");this.board=new i.Board(n,Object.assign(Object.assign({},i.defaultOptions),{defaultStrokeWidth:3,cursorColor:"#FFFFFF66",maxChgLineTm:500,primaryColor:"#2D8AE6",minGestureFinger:5,maxFingerDis:864,maxR:100,minR:30,maxGeatureDis:25,referDpi:192}));this.resize();this.mainAddListener("canvas.removeAll.equments",(function(){if(r.board){r.board.trigger(a.CLEAR)}}));this.mainAddListener("canvas.moveToUpdateBrush",(function(){r.updateTransform()}));this.mainAddListener("canvas.switchXueke",(function(){r.resetDefault()}));this.mainAddListener("canvas.window.resize",(function(){r.resize()}));this.defaultPen();return[2]}))}))};t.prototype.defaultPen=function(){this.type="";var t={detail:{tool:"pen",attr:"color",value:"#FF7E30"}};this.brushSettingChange(t)};t.prototype.resetDefault=function(t){if(t===void 0){t=true}return __awaiter(this,void 0,void 0,(function(){var e;var i=this;return __generator(this,(function(n){this.isActive=false;this.isUsing=true;if(t){this.board.trigger(a.CLEAR)}this.changeDrawStyle();this.resize();e=s.domQuerySelector(this.element,"nb-brush");e.resetAll(true,{color:{type:"color",index:1,flag:1}}).then((function(){var t=i.bingBtn||s.domQuerySelector(i.element,"nb-lock-pen");t.lockBtnClick({tmpunlock:true});t.reset();i.defaultPen()}));this.brushOpen.emit(false);return[2]}))}))};t.prototype.registerLockBtn=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){if(!t){return[2]}e=s.domQuerySelector(this.element,"nb-lock-pen");e.reset();this.bingBtn=t;this.bingBtn.addEventListener("lockClick",this.bingBtnLockClick);this.bingBtn.addEventListener("penClick",this.bingBtnPenClick);this.state=Math.random();return[2]}))}))};t.prototype.unregisterLockBtn=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.bingBtn){this.bingBtn.removeEventListener("lockClick",this.bingBtnLockClick);this.bingBtn.removeEventListener("penClick",this.bingBtnPenClick);this.bingBtn=null;this.state=Math.random()}return[2]}))}))};t.prototype.mainAddListener=function(t,e){this.canvasMain.addEventListener(t,e);this.listenerMap.set(t,e)};t.prototype.updateTransform=function(t){if(t===void 0){t=false}return __awaiter(this,void 0,void 0,(function(){var e,i,n,r,s,a,o,h,c,u,l,f;return __generator(this,(function(d){if(!t&&(!this.board||!this.isActive)){return[2]}e=this.canvasMain.canvas;i=this.canvasMain.view,n=i.x,r=i.y,s=i.scale;a=this.canvasMain.W/e.width;o=this.canvasMain.getVersion();if(o==8){h=this.canvasMain.activeModule;c=h.forceAndMotion.appData;e=c.canvas;a=parseInt(e.style.width)/e.width;u=c.canvasStage.scaleLayer;l=c.canvasStage.moveLayer;n=l.x;r=l.y;f=l.toGlobal({x:0,y:0});n=f.x;r=f.y;s=u.scale}this.board.transformCanvas(s.x,s.y,n/a,r/a);return[2]}))}))};t.prototype.resize=function(){if(!this.canvasMain){return}var t=this.canvasMain.canvas;var e=t.width,i=t.height;this.board.setSize(e,i,parseInt(t.style.width),parseInt(t.style.height));this.updateTransform()};t.prototype.componentDidUnload=function(){var t=this;if(this.bingBtn){this.unregisterLockBtn()}this.listenerMap.forEach((function(e,i){t.canvasMain.removeEventListener(i,e)}));this.canvasMain=null;this.listenerMap.clear();if(this.board){this.board.dispose();this.board=null}};t.prototype.brushSettingChange=function(t){if(!this.board){return}var e=t.detail;var i=e.attr,n=e.value;switch(i){case"color":{this.board.trigger(a.BRUSH_COLOR,{color:n});break}case"size":{var r=this.sizes[n];if(this.type==="reaser"){r*=10}this.board.trigger(a.LINE_SIZE,{size:r});break}}};t.prototype.brushToolChange=function(t){if(!this.board){return}var e=t.detail.type;var i=["reaser","pen","jinyong"];if(this.type==e&&i.indexOf(e)!=-1){console.log("重复了",e);return}this.type=e==""?"pen":e;var n={pen:o.LINE,arrow:o.ARROW,reaser:o.ERASER};if(this.type=="pen"){this.cursor="cursor-pen"}else if(this.type=="reaser"){this.cursor="cursor-reaser"}else if(this.type=="jinyong"){this.cursor=""}var r=n[e];if(r!==undefined){this.board.trigger(a.BRUSH_TYPE,{type:r});this.board.trigger(a.ENABLE,{enable:true});this.isUsing=true;this.changeLockBtnState();this.changeDrawStyle()}else if(e==="delate"){this.board.trigger(a.CLEAR)}else if(e==="cancel"){this.board.trigger(a.UNDO)}else if(e==="jinyong"){this.board.trigger(a.ENABLE,{enable:false});this.isUsing=false;this.changeLockBtnState();this.changeDrawStyle();this.brushOpen.emit(false)}};t.prototype.penClick=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.isActive=t.detail;this.changeDrawStyle();if(this.isActive){this.changeLockBtnState();this.resize();this.updateTransform();this.brushOpen.emit(true);this.defaultPen();this.brushToolChange({detail:{type:this.type}})}else{this.cursor="";this.changeLockBtnState(false);this.resetDefault(false);this.brushOpen.emit(false)}return[2]}))}))};t.prototype.lockClick=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){e=t.detail;this.canvasMain.changeCanvasLock(e);return[2]}))}))};t.prototype.changeLockBtnState=function(t){var e=this.bingBtn||s.domQuerySelector(this.element,"nb-lock-pen");if(t!=undefined){e.lockBtnClick(t)}else{if(!this.isUsing){e.lockBtnClick({tmpunlock:true})}else{e.lockBtnClick(this.isUsing)}}};t.prototype.changeDrawStyle=function(){if(this.isUsing&&this.isActive){this.drawStyle={pointerEvents:"auto",visibility:"visible"}}else if(!this.isUsing&&this.isActive){this.drawStyle={pointerEvents:"none",visibility:"visible"}}else{this.drawStyle={pointerEvents:"none",visibility:"hidden"}}};t.prototype.hideColorSetting=function(){var t=s.domQuerySelector(this.element,"nb-brush");t.setSubmuneVisible(false)};t.prototype.render=function(){var t=this;return n("div",{class:"brush-content"},n("div",{class:"drawDiv "+this.cursor,style:this.drawStyle,onPointerDown:function(){t.hideColorSetting()}}),n("nb-lock-pen",{style:{display:this.bingBtn?"none":""},onLockClick:function(e){t.lockClick(e)},onPenClick:function(e){t.penClick(e)}}),n("nb-brush",{defaultColor:1,class:"tools",style:{display:this.isActive?"block":"none"},onBrushSettingChange:function(e){t.brushSettingChange(e)},onBrushToolChange:function(e){t.brushToolChange(e)}}))};Object.defineProperty(t.prototype,"element",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(t,"style",{get:function(){return":host .brush-content{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}:host .brush-content .cursor-pen{cursor:url(assets/imgs/cursor_pen.ico) 0 100,auto}:host .brush-content .cursor-reaser{cursor:url(assets/imgs/cursor_reaser.ico) 0 100,auto}:host .brush-content .tools{z-index:1000000;position:absolute;bottom:var(--brush-bottom,70px);left:50%;margin-left:-145px;pointer-events:auto}:host .brush-content .drawDiv{position:absolute;pointer-events:auto;width:100%;height:100%}"},enumerable:true,configurable:true});return t}())}}}));