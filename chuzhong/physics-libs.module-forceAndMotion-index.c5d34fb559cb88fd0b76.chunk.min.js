/*!
 * Copyright (c) 2017 Nobook inc.
 * 
 * (TBD)
 * 
 * Version: 0.6.57
 * Date: Mon Apr 27 2020 08:22:33 GMT+0800 (CST)
 */
webpackJsonpPhysicsCanvas([3],{440:function(n,e,t){"use strict";e.__esModule=!0;var i=t(979);e["default"]=function(n){return n&&n.__esModule?n:{"default":n}}(i)["default"]},447:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(689),r=t(468),a=function s(){i(this,s)};n.exports=a;var p=l.nape;a.nape=p,a.Vec2=p.geom.Vec2,a.Body=p.phys.Body,a.BodyType=p.phys.BodyType,a.Polygon=p.shape.Polygon,a.Circle=p.shape.Circle,a.Space=p.space.Space,a.PivotJoint=p.constraint.PivotJoint,a.WeldJoint=p.constraint.WeldJoint,a.DistanceJoint=p.constraint.DistanceJoint,a.PulleyJoint=p.constraint.PulleyJoint,a.Geom=p.geom.Geom,a.Vec2List=p.geom.Vec2List,a.GeomPoly=p.geom.GeomPoly,a.CbType=p.callbacks.CbType,a.Material=p.phys.Material,a.FluidProperties=p.phys.FluidProperties,a.CbEvent=p.callbacks.CbEvent,a.CbType=p.callbacks.CbType,a.InteractionCallback=p.callbacks.InteractionCallback,a.InteractionListener=p.callbacks.InteractionListener,a.InteractionType=p.callbacks.InteractionType,PIXI.Matrix.prototype.my_translate=function(n,e){this.tx+=n*this.a+e*this.c,this.ty+=n*this.b+e*this.d},a.Body.prototype.dragEndStatic=!1,a.BODY_CB_TYPE=new a.CbType,a.WOOD_CB_TYPE=new a.CbType,a.GROUND_CB_TYPE=new a.CbType,a.APP_STOP="appstop",a.APP_START="appstart",a.APP_PAUSE="apppause",a.AppStatus=a.APP_STOP,a.EVENT_SHOW_DROP_INNER="event-show-drop-inner",a.EVENT_SHOW_DROP_OUTER="event-show-drop-outer",a.EVENT_HIDE_DROP_OUTER="event-hide-drop-outer",a.SHOW_FORCE_SETTING="show-force-setting",a.EVENT_SHOW_PLOT="event-show-plot",a.SHOW_EDITOR="show-editor",a.HIDE_EDITOR="hide-editor",a.STAGE_DOWN="stage-down",a.main=null,a.canvasStage=null,a.canvas=null,a.stage=null,a.global_w=Math.max(window.innerWidth,0),a.global_h=Math.max(window.innerHeight,0),a.stageMouseX=0,a.stageMouseY=0,a.documentMouseX=0,a.documentMouseY=0,a.canvas_w=Math.max(window.innerWidth,0),a.canvas_w=Math.max(window.innerHeight,0),a.W=1024,a.H=768,a.STAGE_SCALE=1,a.GRID_SCALE=100,a.GRID_PIXEL=100,a.GRIG_M2P=a.GRID_SCALE/a.GRID_PIXEL,a.ADSORP_TO_GRID=!1,a.GRID_SPACE=20,a.IF_COLLISION=!0,a.IF_SHOW_PLINE=!1,a.IF_SHOW_ELINE=!1,a.COOR_DIRECTION_X_N=1,a.COOR_DIRECTION_Y_N=-1,a.COOR_DIRECTION_CHANGE="coor-direction-change",a.COOR_DIRECTION_CHANGE_N="coor-direction-change-new",a.FORCE_SHOW_SCALE=1,a.VOL_SHOW_SCALE=1,a.AVOL_SHOW_SCALE=1,a.GRIG_SCALE_CHANGE="grid_scale_change",a.SCREEN_CENTER=new r,a.PI_2=2*Math.PI,a.Value2Pixel=function(n){return n/a.GRIG_M2P},a.Pixel2Value=function(n){return n*a.GRIG_M2P},a.ropeNailJoints=null,a.sourceUrl="assets/forceAndMotion/",a.skinUrl=a.sourceUrl+"skin/",a.settingUrl=a.sourceUrl+"setting/",a.woodSkin=a.skinUrl+"wood.jpg",a.woodPattern=null,a.ELEMENT_TOUCH="element_touch",a.ELEMENT_MOVE="element_move",a.ELEMENT_MOVE_END="element_move_end",a.STAGE_MOVE_START="stage_move_start",a.ELEMENT_DELETE="element_delete",a.ELEMENT_COPY="element_copy",a.EDITER_RESIZE="editer_resize",a.CHANGE_SVG_EDITOR_TYPE="change_svg_editer_type",a.STAGE_SHOW_SCALE="stage_show_scale",a.CHANG_EHEADER_TOP="ChangeHeaderTop",a.STAGE_CLEAR_ALL="forceAndMotion_clear_all",a.CHARGES_CHANGE="chanrges_shange",a.CurrentStageDelay=0,a.CurrentStageStart=0,a.caseCollisionSound=!1,a.cursorRuler=null,a.cursorRrotractor=null,a.detectTime=null,a.DETECT_CHANGE="detect_change",a.detectChange=function(){a.detectTime&&clearTimeout(a.detectTime),a.detectTime=setTimeout(function(){a.main.emit(a.DETECT_CHANGE),a.main.svgTransTool&&a.main.svgTransTool.current&&a.main.svgTransTool.edit(a.main.svgTransTool.current)},50)},a.canLinkArr=["ActionBody","GravitySource","PointCharge","ReferencePoint"],a.woodElements=["WoodBoard","WoodBlock","WoodTriangle"],a.getBodyUnderMouse=function(n,e){var t;t=n||a.canvasStage.bodyCon.toLocal({x:a.stageMouseX,y:a.stageMouseY});for(var i,l=a.Vec2.get(t.x,t.y),r=a.space.bodiesUnderPoint(l),p=0;p<r.get_length();p++){var s=r.at(p),o=s.get_userData().view;if(o&&("ActionBody"==o.typeName||e&&-1!=e.indexOf(o.typeName))){i=s;break}}return i},a.getDataFormItemData=function(n){var e={};for(var t in n){var i=n[t],l=i.noSave||[];if(i.typeName!=undefined&&"body"!=t){var r={};e[t]=r;for(var a in i)if(-1===l.indexOf(a)&&-1!=a.indexOf("_")){var p=a.substring(1);if(-1!==l.indexOf(p))continue;if("eventsCount"==p||"events"==p)continue;r[p]=i[a]}}}return e},a.setItemDataFromData=function(n,e){for(var t in e)if("typeName"!=t&&"id"!=t){var i=e[t],l=n[t];if(i&&l){var r=l.noSave||[];for(var a in i)-1===r.indexOf(a)&&l&&(l[a]=i[a])}}},a.isPC=function(){return!/iPad|iPhone|Android|iPod/g.test(navigator.userAgent)},a.switchFold=function(n){if(a.canvasStage&&a.main.napeWorld){var e=[a.canvasStage.coor.baseData.foldBtn,a.main.napeWorld.baseData.foldBool,a.main.napeWorld.baseData.foldValues,a.main.napeWorld.baseData.foldCommon],t=[a.canvasStage.coor.baseData.foldBtnArr,a.main.napeWorld.baseData.foldBoolArr,a.main.napeWorld.baseData.foldValuesArr,a.main.napeWorld.baseData.foldCommonArr];if(!n.folded)for(var i=0;3>=i;i++){var l=e[i],r=t[i];l!=n&&(l._folded=!0,r.styleHeight=0)}}}},455:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}n.exports=function(n){function e(){var t,r;return i(this,e),r=t=l(this,n.call(this)),l(t,r)}return r(e,n),e.prototype.lineStyle=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return e/=PIXI.settings.RESOLUTION,n.prototype.lineStyle.call(this,e,t,i)},e}(PIXI.Graphics)},458:function(n,e,t){"use strict";function i(n){return n&&n.__esModule?n:{"default":n}}function l(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),a=t(50),p=i(a),s=t(472),o=i(s),h=void 0,_=function(){function n(e){l(this,n),this.config=Object.assign({},e),this.config.moduleMain=this,h=this,this.moduleType=-1,this.active=!1,this.hasInit=!1,this.cachePool=new o["default"],this.looplist=[]}return r(n,[{key:"getModuleType",value:function(){return this.constructor.MODULE_TYPE}},{key:"init",value:function(){this.hasInit=!0}},{key:"addPhysicsCanvasListeners",value:function(){var n=this.config.main;this.onRemoveEquipmentProx||(this.onRemoveEquipmentProx=this.onRemoveEquipment.bind(this),this.onCanvasDomClickProx=this.onCanvasDomClick.bind(this),this.onSetDataCompleteProx=this.onSetDataComplete.bind(this)),n.addEventListener(p["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),n.addEventListener(p["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),n.addEventListener(p["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"removePhysicsCanvasListeners",value:function(){var n=this.config.main;n.removeEventListener(p["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),n.removeEventListener(p["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),n.removeEventListener(p["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"canvasLock",value:function(n){}},{key:"onRemoveEquipment",value:function(){}},{key:"onCanvasDomClick",value:function(n){}},{key:"onSetDataComplete",value:function(){}},{key:"onShowAllEquip",value:function(){}},{key:"setActive",value:function(n){this.active=n,8===this.moduleType?n?(PIXI.settings.RESOLUTION=1,this.forceAndMotion.resize()):PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION:PIXI.settings.RESOLUTION!==this.globalConfig.RESOLUTION&&(PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION),n?this.addPhysicsCanvasListeners():this.removePhysicsCanvasListeners()}},{key:"enterModule",value:function(n){return Promise.resolve()}},{key:"destroy",value:function(){this.removePhysicsCanvasListeners(),this.config.moduleMain=null,this.config=null,this.onRemoveEquipmentProx=null,this.onCanvasDomClickProx=null,this.onSetDataCompleteProx=null,this.hasInit=null,this.active=null}},{key:"updateEqu",value:function(){for(var n=this.main.getEquipmentArr(!0),e=0;n.length>e;e++){var t=n[e];if(t.update)try{t.update()}catch(i){}}}},{key:"getData",value:function(){return{}}},{key:"setData",value:function(n){}},{key:"startRecoverEqu",value:function(){}},{key:"completeRecoverEqu",value:function(){}},{key:"setDataBefore",value:function(){return Promise.resolve()}},{key:"requestAnimationLoop",value:function(){this.updateEqu(),this.main&&this.main.disComp&&this.main.disComp.update(),this.foreachLooplist()}},{key:"foreachLooplist",value:function(){for(var n=0;this.looplist.length>n;n++){var e=this.looplist[n];e.update&&e.update()}}},{key:"main",get:function(){return this.config?this.config.main:null}},{key:"equipmentUtil",get:function(){return this.main.equipmentUtil}},{key:"globalConfig",get:function(){return this.main.globalConfig}},{key:"language",get:function(){return this.main.language}},{key:"SoundTool",get:function(){return this.main.globalConfig.SoundTool}},{key:"phy",get:function(){return this.main.phy}},{key:"ParticleUtil",get:function(){return this.config.ParticleUtil}},{key:"SoundStr",get:function(){return this.config.SoundStr}},{key:"Button",get:function(){return this.config.Button}},{key:"HoverButton",get:function(){return this.config.HoverButton}},{key:"ComponentProperty",get:function(){return this.config.ComponentProperty}},{key:"NBCommand",get:function(){return this.config.NBCommand}},{key:"MouseManager",get:function(){return this.config.MouseManager}},{key:"NBDrag",get:function(){return this.config.NBDrag}},{key:"UploadSkinTool",get:function(){return this.config.UploadSkinTool}},{key:"NBEvent",get:function(){return this.config.NBEvent}}],[{key:"getInstance",value:function(){return h}}]),n}();window.each=function(n,e,t){var i=void 0;for(i=0;n&&n.length>i;i++){if(!1===(t?e.call(t,i,n[i]):e.call(n[i],i,n[i])))break}},e["default"]=_},459:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a,p,s,o,h,_,u){i(this,e);var d=l(this,n.call(this));return d.name=t||"",d.minValue=r===undefined?-1e3:r,d.maxValue=a||1e3,d.step=p||1,d.showValue=s||0,d.canEnter=o||!0,d.enterUnit=h||"",d.precision=_||1,d.canBeAny=u||!1,d.typeName="DragItemData",d.styleHeight=undefined,d.ifShowBar=!1,d.noSave.push("minValue","maxValue","enterUnit","canBeAny","precision","styleHeight","ifShowBar","step","canEnter"),d}return r(e,n),a(e,[{key:"canEnter",get:function(){return this._canEnter},set:function(n){this._canEnter=n}},{key:"enterUnit",get:function(){return this._enterUnit},set:function(n){this._enterUnit=n}},{key:"maxValue",get:function(){return this._maxValue},set:function(n){this._maxValue=n}},{key:"minValue",get:function(){return this._minValue},set:function(n){this._minValue=n}},{key:"showValue",get:function(){return+this._showValue},set:function(n){this._showValue=n,this.emit("change")}},{key:"name",get:function(){return s.getL(this._name)},set:function(n){this._name=n}},{key:"step",get:function(){return this._step},set:function(n){this._step=n}},{key:"ifShowBar",get:function(){return this._ifShowBar},set:function(n){this._ifShowBar=n}},{key:"precision",get:function(){return this._precision},set:function(n){this._precision=n}},{key:"canBeAny",get:function(){return this._canBeAny},set:function(n){this._canBeAny=n}}]),e}(p)},460:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}n.exports=function(){function n(){i(this,n)}return n.getPointDistance=function(n,e){return Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y))},n.delSamePoint=function(n){Math.round(array[0].x)==Math.round(array[1].x)&&Math.round(array[0].y)==Math.round(array[1].y)&&array.shift();var e=array.length;Math.round(array[e-1].x)==Math.round(array[e-2].x)&&Math.round(array[e-1].y)==Math.round(array[e-2].y)&&array.pop()},n.segmentsIntr=function(n,e,t,i,l){var r=(n.x-t.x)*(e.y-t.y)-(n.y-t.y)*(e.x-t.x),a=(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x);if(r*a>=0)return!1;var p=(t.x-n.x)*(i.y-n.y)-(t.y-n.y)*(i.x-n.x);if(p*(p+r-a)>=0)return!1;if(l)return!0;var s=p/(a-r);return{x:n.x+s*(e.x-n.x),y:n.y+s*(e.y-n.y)}},n.getPoint2Line=function(n,e,t,i){var l,r,a={x:e.x-n.x,y:e.y-n.y},p={x:e.x-t.x,y:e.y-t.y},s=a.x*p.x+a.y*p.y,o={x:t.x-n.x,y:t.y-n.y},h={x:t.x-e.x,y:t.y-e.y},_=o.x*h.x+o.y*h.y,u=!1;0>s||0>_||(u=!0),r=a.x*p.y-a.y*p.x;var d=Math.abs(r);return i||(i=Math.sqrt(p.x*p.x+p.y*p.y)),l=d/i,{dis:l,ifIn:u,abdis:i,s:r}},n.vecShadow=function(n,e){var t=n.x*e.x+n.y*e.y,i=Math.sqrt(n.x*n.x+n.y*n.y),l=Math.sqrt(e.x*e.x+e.y*e.y),r=t/l;if(0==i||0==l)return{x:0,y:0};var a=r*e.x/l,p=r*e.y/l;return{x:a||0,y:p||0}},n.getXuPath=function(n,e){var t=this.getPointDistance(n,e),i="";if(3>t)return"M"+n.x+","+n.y+"L"+e.x+","+e.y;for(var l=(e.x-n.x)/t*3,r=(e.y-n.y)/t*3,a=Math.ceil(t/3),p=0;a-1>p;p+=2)i+="M"+(n.x+l*p)+","+(n.y+r*p)+"L"+(n.x+l*(p+1))+","+(n.y+r*(p+1));return i},n.getTriangleCenter=function(n,e,t){return this.segmentsIntr(t,{x:(n.x+e.x)/2,y:(n.y+e.y)/2},e,{x:(n.x+t.x)/2,y:(n.y+t.y)/2})},n.get2pCenter=function(n,e){return{x:(n.x+e.x)/2,y:(n.y+e.y)/2}},n.getPolygonS=function(n){for(var e=0,t=0;n.length-2>t;t++){var i=n[0],l=n[t+1],r=n[t+2],a={x:l.x-i.x,y:l.y-i.y},p={x:r.x-i.x,y:r.y-i.y};e+=(a.x*p.y-a.y*p.x)/2}return e},n.getPolygonS2=function(n){for(var e=0,t=[].concat(n),i=0;t.length-i>=3;){var l=t[i],r=t[++i],a=t[++i],p={x:l.x-a.x,y:l.y-a.y},s={x:r.x-a.x,y:r.y-a.y};e+=(p.x*s.y-p.y*s.x)/2,t.push(l)}return e},n.copyArr=function(n,e){for(var t=0;e.length>t;t++)n[t]=e[t]},n.getPolygonCenter=function(n){var e=[];this.copyArr(e,n);for(var t=null;;){for(var i=[],l=0;e.length-2>l;l++){var r=e[0],a=e[l+1],p=e[l+2],s=this.getTriangleCenter(r,a,p);i.push(s)}if(1==i.length){t=s;break}if(2==i.length){t=this.get2pCenter(i[0],i[1]);break}e=i}return t},n.setPointLength=function(n,e){var t={x:0,y:0},i=Math.sqrt(n.x*n.x+n.y*n.y);if(0==i)return t;var l=e/i;return t.x=l*n.x,t.y=l*n.y,t},n.getBase64Image=function(n,e){var t=new Image;t.src=n,t.onload=function(){var n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0,t.width,t.height);var i=n.toDataURL();e(i)}},n.getPathByArr=function(n){var e="",t=0,i=n.length,l=[],r=[];for(t;i>t;t++){var a=n[t];if("M"==a[0]){e+=this.getCurPath(l,r),l.splice(0),r.splice(0)}l.push(a[1]),r.push(a[2])}return e+=this.getCurPath(l,r)},n.getCurPath=function(n,e){var t="",i=n.length;if(1>=i)return t;for(var l=this.computeControlPoints(n),r=this.computeControlPoints(e),a=0;i-1>a;a++)t+=this.path(n[a],e[a],l.p1[a],r.p1[a],l.p2[a],r.p2[a],n[a+1],e[a+1]);return t},n.path=function(n,e,t,i,l,r,a,p){return"M "+n+" "+e+" C "+t+" "+i+" "+l+" "+r+" "+a+" "+p},n.computeControlPoints=function(n){var e=[],t=[],i=n.length-1,l=[],r=[],a=[],p=[];l[0]=0,r[0]=2,a[0]=1,p[0]=n[0]+2*n[1];var s=0;for(s=1;i-1>s;s++)l[s]=1,r[s]=4,a[s]=1,p[s]=4*n[s]+2*n[s+1];for(l[i-1]=2,r[i-1]=7,a[i-1]=0,p[i-1]=8*n[i-1]+n[i],s=1;i>s;s++){var o=l[s]/r[s-1];r[s]=r[s]-o*a[s-1],p[s]=p[s]-o*p[s-1]}for(e[i-1]=p[i-1]/r[i-1],s=i-2;s>=0;--s)e[s]=(p[s]-a[s]*e[s+1])/r[s];for(s=0;i-1>s;s++)t[s]=2*n[s+1]-e[s+1];return t[i-1]=.5*(n[i]+e[i-1]),{p1:e,p2:t}},n.hexTo64=function(n){return 0===(n+"").indexOf("#")&&(n=parseInt("0x"+n.replace("#",""))),n},n.pathToGraphics=function(n,e){var t=Snap.parsePathString(n);if(t&&t.length>0)for(var i=0;t.length>i;i++){var l=t[i];switch(l[0]){case"M":e.moveTo(l[1],l[2]);break;case"L":e.lineTo(l[1],l[2]);break;case"C":e.bezierCurveTo(l[1],l[2],l[3],l[4],l[5],l[6]);break;case"z":e.closePath()}}},n.checkPointInTr=function(n,e,t,i){var l={x:n.x-i.x,y:n.y-i.y},r={x:e.x-i.x,y:e.y-i.y},a={x:t.x-i.x,y:t.y-i.y},p={x:e.x-n.x,y:e.y-n.y},s={x:t.x-e.x,y:t.y-e.y},o={x:n.x-t.x,y:n.y-t.y},h=l.x*p.y-l.y*p.x,_=r.x*s.y-r.y*s.x,u=a.x*o.y-a.y*o.x;return!(h>0||_>0||u>0)||!(0>h||0>_||0>u)},n}()},464:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a,p){i(this,e);var s=l(this,n.call(this));return s.name=t||"",s.checked=r||!1,s.id=a||0,s.canSwap=p||!1,s.typeName="BoolItemDate",s.noSave.push("id","canSwap"),s}return r(e,n),a(e,[{key:"name",get:function(){return this.needTranslate?s.getL(this._name):this._name},set:function(n){this._name=n}},{key:"checked",get:function(){return this._checked},set:function(n){this._checked=n,this.emit("change")}},{key:"id",get:function(){return this._id},set:function(n){this._id=n}},{key:"canSwap",get:function(){return this._canSwap},set:function(n){this._canSwap=n}}]),e}(p)},465:function(n,e,t){"use strict";function i(){}i.nape=t(690),n.exports=i},466:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="SimpleData",t.noSave.push("colorGroup"),t}return r(e,n),a(e,[{key:"color",get:function(){return this._color||0},set:function(n){this._color=n,this.emit("change",{color:n})}},{key:"colorGroup",get:function(){return this._colorGroup},set:function(n){this._colorGroup=n}},{key:"bodyName",get:function(){return s.getL(this._bodyName)||this._bodyName},set:function(n){this._bodyName=n,this.emit("change",{name:n})}}]),e}(p)},468:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();n.exports=function(){function n(e,t){i(this,n),this.x=e||0,this.y=t||0,this.typeName="Point"}return n.distance=function(n,e){var t=n.x-e.x,i=n.y-e.y;return Math.sqrt(t*t+i*i)},n.interpolate=function(e,t,i){return new n(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)},n.prototype.set=function(n,e){this.x=n||0,this.y=e||(0!==e?this.x:0)},n.prototype.normalize=function(n){var e=this.length;0!==e&&(this.x*=(n||1)/e,this.y*=(n||1)/e)},n.prototype.copy=function(n){this.set(n.x,n.y)},n.prototype.clone=function(){return new n(this.x,this.y)},l(n,[{key:"x",get:function(){return this._x},set:function(n){this._x=n}},{key:"y",get:function(){return this._y},set:function(n){this._y=n}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}]),n}()},472:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();e["default"]=function(){function n(){i(this,n),this.graphicsList=[],this.textList=[],this.elecWiredots=[],this.threeList={}}return l(n,[{key:"disposeAll",value:function(){this.graphicsList.length=0,this.textList.length=0,this.elecWiredots.length=0;for(var n=Object.keys(this.threeList),e=0;n.length>e;e++)for(var t=this.threeList[n[e]],i=0;t.length>i;i++)try{var l=t[i];l.removed&&l.removed()}catch(r){}this.threeList={}}},{key:"resetAll",value:function(n){n.x=0,n.y=0,n.pivot.x=0,n.pivot.y=0,n.scale.x=1,n.scale.y=1,n.rotation=0}},{key:"pushGraphic",value:function(n){n.clear(),this.resetAll(n),this.graphicsList.push(n)}},{key:"popGraphic",value:function(){var n=this.graphicsList.pop();return n&&n.transform||(n=new PIXI.Graphics),n}},{key:"pushText",value:function(n){n.text="",this.resetAll(n),this.textList.push(n)}},{key:"popText",value:function(n,e){var t=this.textList.pop();return t||(n=n||"",e=e||"",t=new PIXI.Text(n,e)),t}},{key:"pushElecDot",value:function(n){this.elecWiredots.push(n)}},{key:"popElecDot",value:function(){return this.elecWiredots.pop()}},{key:"pushThreeClass",value:function(n,e){var t=this.threeList[n];t||(t=[],this.threeList[n]=t),this.resetAll(e),t.push(e)}},{key:"popThreeClass",value:function(n,e,t){var i=this.threeList[n],l=null;return i&&(l=i.pop()),l||(l=new e(t)),l}}]),n}()},473:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(447),o=t(476);n.exports=function(n){function e(t,r,a,p,s,o,h){i(this,e);var _=l(this,n.call(this));return _.name=t||"",_.text=r||"",_.index=a||0,_.typeName="ButtonDate",_.icon=p||null,_.hasArrow=0!=s,_.asIcon=o||!1,_.height=h||"none",_.preventEvent=!1,_}return r(e,n),e.prototype.click=function(){this.emit("click")},a(e,[{key:"iconBaseUrl",get:function(){return s.settingUrl}},{key:"name",get:function(){return o.getL(this._name)},set:function(n){this._name=n}},{key:"icon",get:function(){return this._icon},set:function(n){this._icon=n}},{key:"hasArrow",get:function(){return this._hasArrow},set:function(n){this._hasArrow=n}},{key:"text",get:function(){return this._text},set:function(n){this._text=n}},{key:"index",get:function(){return this._index},set:function(n){this._index=n}},{key:"asIcon",get:function(){return this._asIcon},set:function(n){this._asIcon=n}},{key:"height",get:function(){return this._height},set:function(n){this._height=n}},{key:"preventEvent",get:function(){return this._preventEvent},set:function(n){this._preventEvent=n}}]),e}(p)},475:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a){i(this,e);var p=l(this,n.call(this));return p.typeName="TitleData",p.title=t||"",p.noLine=r||!1,p.noFullLine=a||!1,p.noSave.push("noLine","noFullLine"),p}return r(e,n),a(e,[{key:"title",get:function(){return s.getL(this._title)},set:function(n){this._title=n}},{key:"noLine",get:function(){return this._noLine},set:function(n){this._noLine=n}},{key:"noFullLine",get:function(){return this._noFullLine},set:function(n){this._noFullLine=n}}]),e}(p)},476:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(447);n.exports=function(){function n(){i(this,n)}return n.getLByKey=function(n){return r.languageConfig&&r.languageConfig.getLocaleStr?r.languageConfig.getLocaleStr(n):null},n.getL=function(n){if(!r.languageConfig||!r.languageConfig.getLocaleStr)return n;if(""==n)return n;this.testZn(n)||(n=this.map.get(n));var e=this.getZn(n);if(!e)return n;var t=this.map.get(e);if(!t)return n;var i=r.languageConfig.getLocaleStr(t);if(!i)return n;var l=n.replace(e,i);return this.testZn(l)&&!this.testZn(i)&&(l=this.getL(l)),l},n.getZn=function(n){var e=/[\u4e00-\u9fa5 \/]+/g.exec(n);if(e&&e[0]){return e[0]}return null},n.testZn=function(n){return/[\u4e00-\u9fa5]+/g.test(n)},l(n,null,[{key:"map",get:function(){if(!n._map){var e=new Map;e.set("坐标","coordinate"),e.set("速度","speed"),e.set("速率","speed_rate"),e.set("角度","angle"),e.set("力","force"),e.set("箭头缩放比例","arrow_scale"),e.set("加速度","acceleration"),e.set("水平位移","acceleration"),e.set("质量","mass"),e.set("半径","radius"),e.set("电荷量","charge_amount"),e.set("弹性系数","elastic_coefficient"),e.set("碰撞系数","elastic_coefficient"),e.set("粗糙程度","roughness"),e.set("摩擦系数","friction"),e.set("显示轨迹","show_trajectory"),e.set("轨迹停留时间","stay_time"),e.set("显示","show"),e.set("方向","direction"),e.set("启用闪照","open_flash_photo"),e.set("闪照周期","cycle_time"),e.set("显示闪照时间点","show_flash_time"),e.set("启用质点","as_particle"),e.set("外力","external_force"),e.set("起止时间","start_stop_time"),e.set("运行时隐藏","hidden_at_motion"),e.set("显示图像","show_plot"),e.set("添加外力","add_external_force"),e.set("贴图","skin_icon"),e.set("起始角度","start_angle"),e.set("结束角度","stop_angle"),e.set("上","top"),e.set("下","bottom"),e.set("左","left"),e.set("右","right"),e.set("考虑体积的影响","case_volume"),e.set("阻尼","damping"),e.set("阻尼系数","damp_coefficient"),e.set("一次方系数","linear_coefficient"),e.set("二次方系数","quadratic_coefficient"),e.set("常数","constant"),e.set("电场强度","elec_strength"),e.set("电场方向","elec_direction"),e.set("电场形状","elec_shape"),e.set("宽","width"),e.set("高","height"),e.set("劲度系数","stiffness_coefficient"),e.set("端点","head_pos"),e.set("绳长","rope_length"),e.set("杆长","bar_length"),e.set("弹簧长度","spring_length"),e.set("磁场形状","magn_field_shape"),e.set("圆形","circular"),e.set("矩形","rectangle"),e.set("磁感应强度","magn_strength"),e.set("向里","in_direction"),e.set("向外","out_direction"),e.set("磁场方向","magn_direction"),e.set("带电量","had_charge_amount"),e.set("长度","length"),e.set("锁定旋转","lock_rotate"),e.set("底角","bottom_angle"),e.set("底边长度","bottom_length"),e.set("左右镜像","flip_l_r"),e.set("上下镜像","flip_u_d"),e.set("旋转角度","rotate_angle"),e.set("参数","parameters"),e.set("显示坐标系","show_coordinate_system"),e.set("显示网格线","show_grid_line"),e.set("显示细网格线","show_thin_grid_line"),e.set("加粗线条","bold_line"),e.set("每格代表长度","every_grid_length"),e.set("轴反向","axis_reverse"),e.set("吸附到网格线","adsorp_to_grid"),e.set("显示等势线","show_equipotential_line"),e.set("显示电场线","show_electric_field_line"),e.set("坐标文字大小","coordinate_font_size"),e.set("舞台背景色","background_color"),e.set("坐标系设置","coordinate_system_setting"),e.set("考虑重力","case_gravity"),e.set("重力加速度","gravity"),e.set("考虑物体间库仑力","case_charge_force"),e.set("静电力恒量","charge_force_constant"),e.set("考虑物体间万有引力","case_universal_gravitation"),e.set("万有引力恒量","universal_gravitation_constant"),e.set("考虑运动物体间碰撞","case_collision"),e.set("运动物体间碰撞音效","sound_between_ball"),e.set("还原默认值","reset_default_setting"),e.set("运行时间","motion_delay"),e.set("基础功能设置","basics_setting"),e.set("显示名称","show_force_name"),e.set("显示数值","show_force_number"),e.set("显示分解","show_force_resolution"),e.set("显示角度","show_force_angle"),e.set("力箭头尺寸缩放","force_arrow_scale"),e.set("速度箭头尺寸缩放","speed_arrow_scale"),e.set("加速度箭头尺寸缩放","acceleration_arrow_scale"),e.set("弹力","elastic_force"),e.set("合力","sum_force"),e.set("重力","gravity_force"),e.set("电场力","elec_force"),e.set("洛伦兹力","lorenz_force"),e.set("摩擦力","friction_force"),e.set("阻尼力","dampping_force"),e.set("万有引力","universal_force"),e.set("电荷力","charge_force"),e.set("水平速度","horizontal_speed"),e.set("竖直速度","vertical_speed"),e.set("位移","displacement"),e.set("水平位移","horizontal_displacement"),e.set("竖直位移","vertical_displacement"),e.set("水平加速度","horizontal_acceleration"),e.set("竖直加速度","vertical_acceleration"),e.set("水平力","horizontal_force"),e.set("竖直力","vertical_force"),e.set("动能","kinetic_energy"),e.set("重力势能","gravitation_energy"),e.set("时间跨度","time_span"),e.set("平滑度","line_smooth"),e.set("常量设置","constant_setting"),e.set("时间","time"),e.set("清除","clear_line"),e.set("可视化","visualization"),e.set("材质/外观","material_facade"),e.set("隐藏坐标","hide_coor_xy"),e.set("反向","reverse_roll"),e.set("直角坐标方式","cartesian_coordinates"),e.set("极坐标方式","polar_coordinates"),e.set("测量距离","measure_distance"),e.set("测量角度","measure_angle"),e.set("向上","up_ward"),e.set("向下","down_ward"),e.set("轴方向","axis_direction"),e.set("实验显示设置","exp_display_setting"),e.set("标注显示设置","data_display_setting"),e.set("显示注解","show_annotation"),e.set("运动物体","library.motion.ydwuti"),e.set("匀强电场","library.motion.dianchang"),e.set("匀强磁场","library.motion.cichang"),e.set("万有引力源","library.motion.wyylichang"),e.set("阻尼介质","library.motion.znjiezhi"),e.set("点电荷","library.motion.ddianhe"),e.set("参照点","library.motion.ckaodian"),e.set("轻绳","library.motion.qingsheng"),e.set("轻杆","library.motion.qinggan"),e.set("弹簧","library.motion.tanhuang"),e.set("直轨道","library.motion.zdaogui"),e.set("弧轨道","library.motion.hdaogui"),e.set("钉子","library.motion.dingzi"),e.set("木板","library.motion.muban"),e.set("木块","library.motion.mukuai"),e.set("三角斜面","library.motion.sjxiemian"),e.set("地面","library.motion.dimian"),e.set("滑轮","library.motion.hualun"),e.set("传送带","library.motion.chuansongdai"),e.set("Force","力"),e.set("Velocity","速度"),e.set("Acceleration","加速度"),e.set("Rectangle","矩形"),e.set("Circle","圆形"),e.set("Towards","向里"),e.set("Backwards","向外"),e.set("通用显示设置","Universal_Display_Setting"),e.set("场景显示设置","Stage_Display_Setting"),e.set("场景常量设置","Stage_Constant_Setting"),e.set("场景作用力设置","Stage_Force_Setting"),e.set("功能栏位置","Function_Bar_Position"),e.set("顶端","bar_top"),e.set("底端","bar_bottom"),e.set("恒定","e_static"),e.set("正弦","e_sine"),e.set("电场模式","elec_mode"),e.set("磁场模式","magn_mode"),e.set("周期","cycle"),e.set("形状","shape"),e.set("等边","equal_sides"),e.set("等腰","equal_weist"),e.set("直角","right_angle"),e.set("边长","side_length"),e.set("腰长","weist_length"),e.set("底边长","bottom_side_length"),e.set("直角边长","t_side_length"),e.set("强度","strength"),n._map=e}return n._map}}]),n}()},478:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(496),p=t(447);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.reciveChange(),t.needTranslate=!0,t.noSave=["name","typeName","noSave","needTranslate"],t}return r(e,n),e.prototype.reciveChange=function(){var n=this;this.on("change",function(){n.detectChange()})},e.prototype.detectChange=function(){p.detectChange()},e}(a)},479:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(632),s=t(490);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.moveFunc(),t.allowRotate=!0,t}return r(e,n),e.prototype.moveFunc=function(){function n(){a.main.emit(a.ELEMENT_MOVE_END,{ele:r})}function e(){i(),o=setTimeout(l,1e3),a.main.emit(a.ELEMENT_TOUCH,{ele:r})}function t(){r.emit("move"),a.main.emit(a.ELEMENT_MOVE,{ele:r}),i()}function i(){clearTimeout(o)}function l(){if(r.asEquip){if(a.AppStatus!=a.APP_STOP)return;a.main.emit(a.EVENT_SHOW_DROP_INNER,{element:r})}}this.interactive=!0;var r=this,p=new s(this.group);this.dragUtil=p,p.on("start",function(n){n.stopPropagation(),r.asEquip&&e()}),p.on("move",function(n){r.translate(n.offx,n.offy),t()}),p.on("end",function(e){n(),i()});var o;p.on(s.DOUBLE_CLICK,function(){l()})},e.prototype.translate=function(n,e){this.setXY(this.x+n,this.y+e)},e.prototype.setXY=function(n,e){this.x=n,this.y=e,this.body&&this.body.get_position().setxy(n||0,e||0),this.chargeChange()},e.prototype.changeGridScale=function(){this.emit("move")},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.dragUtil.destroy(),this.dragUtil=null,this.chargeChange()},e.prototype.chargeChange=function(){this.Q&&a.main.emit(a.CHARGES_CHANGE)},e}(p)},485:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r){i(this,e);var a=l(this,n.call(this));return a.value=t||0,a.name=r||"",a.typeName="AngleData",a}return r(e,n),a(e,[{key:"value",get:function(){return this._value},set:function(n){this._value=n,this.emit("change")}},{key:"name",get:function(){return s.getL(this._name)},set:function(n){this._name=n}}]),e}(p)},490:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(496),s=t(468),o=t(447),h=t(637);n.exports=function(n){function e(t,r){function a(n){if(!x.caseAppStart||o.AppStatus==o.APP_STOP){n.stopPropagation(),z=v.parent;var t=n.data.global;b.set(t.x,t.y),m.copy(z.toLocal(b)),o.stageMouseX=t.x,o.stageMouseY=t.y,x.emit(e.START,n),x.canNotMove||(o.stage.on("pointermove",p),o.stage.on("pointerup",h),o.stage.on("pointerupoutside",h),y=!1)}}function p(n){n.stopPropagation();var e=n.data.global;n.stageOffx=e.x-b.x,n.stageOffy=e.y-b.y,b.set(e.x,e.y),_(z.toLocal(b),n)}function h(n){o.stage.removeListener("pointermove",p),o.stage.removeListener("pointerup",h),o.stage.removeListener("pointerupoutside",h),y=!0,x.emit(e.END,n),f=!1,g?x.emit(e.DOUBLE_CLICK):g=!0,setTimeout(function(){g=!1},300)}function _(n,t){if(t.offx=n.x-m.x,t.offy=n.y-m.y,t.offx*t.offx+t.offy*t.offy>25&&(f=!0),0!=f&&(t.element=v,r&&(v.x+=t.offx,v.y+=t.offy),x.emit(e.MOVE,t),m.copy(n),x.dragCircleArea)){var n=z.toLocal(b);x.updateTargetPositionInCircle(n)}}function u(n){x.emit(e.MOVE_IN_OUT,{type:"in"})}function d(n){x.emit(e.MOVE_IN_OUT,{type:"out"})}i(this,e);var c=l(this,n.call(this)),x=c,v=t,z=v.parent,y=!1,f=!1,m=new s,b=new s,g=!1;return c.stagePoint=b,c.element=v,c.caseAppStart=!0,c.canNotMove=!1,c.preventEvent=!0,c.dragCircleArea=null,c.defaultMove=r,v.on("pointerdown",a),v.on("pointerover",u),v.on("pointerout",d),c.destroy=function(){v.removeListener("pointerdown",a),v.removeListener("pointerout",u),v.removeListener("pointerover",d),this.stagePoint=null,this.element=null,this.dragCircleArea=null},c}return r(e,n),e.prototype.initDragCircleArea=function(){this.dragCircleArea=new h},e.prototype.updateTargetPositionInCircle=function(n){var t=n.x,i=n.y,l=n.x-this.dragCircleArea.cx,r=n.y-this.dragCircleArea.cy,a=Math.sqrt(l*l+r*r);(a>this.dragCircleArea.r||this.dragCircleArea.onCircle)&&(t=l/a*this.dragCircleArea.r+this.dragCircleArea.cx,i=r/a*this.dragCircleArea.r+this.dragCircleArea.cy),this.defaultMove&&(this.element.x=t,this.element.y=i);var p=Math.atan2(r,l)/Math.PI*180;0>p&&(p=360+p),this.emit(e.MOVE_IN_CIRCLE,{angle:p})},a(e,null,[{key:"START",get:function(){return"start"}},{key:"MOVE",get:function(){return"move"}},{key:"END",get:function(){return"end"}},{key:"MOVE_IN_OUT",get:function(){return"moveInOut"}},{key:"MOVE_IN_CIRCLE",get:function(){return"moveInCircle"}},{key:"DOUBLE_CLICK",get:function(){return"dobuleClick"}}]),e}(p)},495:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();n.exports=function(){function n(){i(this,n)}return n.setAllLayer=function(e){e.get_shapes().foreach(function(e){e.get_filter().set_collisionGroup(n.ALL)})},n.setLayer=function(n,e){n.get_shapes().foreach(function(n){n.get_filter().set_collisionGroup(e)})},n.setMask=function(n,e){n.get_shapes().foreach(function(n){n.get_filter().set_collisionMask(~e)})},l(n,null,[{key:"DEFAULT",get:function(){return 0}},{key:"LAYER_1",get:function(){return 1}},{key:"LAYER_2",get:function(){return 2}},{key:"LAYER_3",get:function(){return 4}},{key:"LAYER_4",get:function(){return 8}},{key:"ALL",get:function(){return 15}}]),n}()},496:function(n,e,t){"use strict";function i(){}function l(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function r(n,e,t,i,r){if("function"!=typeof t)throw new TypeError("The listener must be a function");var a=new l(t,i||n,r),p=o?o+e:e;return n._events[p]?n._events[p].fn?n._events[p]=[n._events[p],a]:n._events[p].push(a):(n._events[p]=a,n._eventsCount++),n}function a(n,e){0==--n._eventsCount?n._events=new i:delete n._events[e]}function p(){this._events=new i,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,o="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(o=!1)),p.prototype.eventNames=function(){var n,e,t=[];if(0===this._eventsCount)return t;for(e in n=this._events)s.call(n,e)&&t.push(o?e.slice(1):e);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(n)):t},p.prototype.listeners=function(n){var e=o?o+n:n,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var i=0,l=t.length,r=Array(l);l>i;i++)r[i]=t[i].fn;return r},p.prototype.listenerCount=function(n){var e=o?o+n:n,t=this._events[e];return t?t.fn?1:t.length:0},p.prototype.emit=function(n,e,t,i,l,r){var a=o?o+n:n;if(!this._events[a])return!1;var p,s,h=this._events[a],_=arguments.length;if(h.fn){switch(h.once&&this.removeListener(n,h.fn,undefined,!0),_){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,t),!0;case 4:return h.fn.call(h.context,e,t,i),!0;case 5:return h.fn.call(h.context,e,t,i,l),!0;case 6:return h.fn.call(h.context,e,t,i,l,r),!0}for(s=1,p=Array(_-1);_>s;s++)p[s-1]=arguments[s];h.fn.apply(h.context,p)}else{var u,d=h.length;for(s=0;d>s;s++)switch(h[s].once&&this.removeListener(n,h[s].fn,undefined,!0),_){case 1:h[s].fn.call(h[s].context);break;case 2:h[s].fn.call(h[s].context,e);break;case 3:h[s].fn.call(h[s].context,e,t);break;case 4:h[s].fn.call(h[s].context,e,t,i);break;default:if(!p)for(u=1,p=Array(_-1);_>u;u++)p[u-1]=arguments[u];h[s].fn.apply(h[s].context,p)}}return!0},p.prototype.on=function(n,e,t){return r(this,n,e,t,!1)},p.prototype.once=function(n,e,t){return r(this,n,e,t,!0)},p.prototype.removeListener=function(n,e,t,i){var l=o?o+n:n;if(!this._events[l])return this;if(!e)return a(this,l),this;var r=this._events[l];if(r.fn)r.fn!==e||i&&!r.once||t&&r.context!==t||a(this,l);else{for(var p=0,s=[],h=r.length;h>p;p++)(r[p].fn!==e||i&&!r[p].once||t&&r[p].context!==t)&&s.push(r[p]);s.length?this._events[l]=1===s.length?s[0]:s:a(this,l)}return this},p.prototype.removeAllListeners=function(n){var e;return n?(e=o?o+n:n,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=o,p.EventEmitter=p,n.exports=p},501:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a){i(this,e);var p=l(this,n.call(this));return p.checked=t||0,p.name=r||"",p.value=a||[],p.typeName="RadioItemData",p.noSave.push("value"),p}return r(e,n),a(e,[{key:"checked",get:function(){return this._checked},set:function(n){this._checked=n,this.emit("change")}},{key:"name",get:function(){return s.getL(this._name)},set:function(n){this._name=n}},{key:"value",get:function(){for(var n=[],e=0;this._value.length>e;e++)n[e]=s.getL(this._value[e]);return n},set:function(n){this._value=n}}]),e}(p)},518:function(n,e,t){"use strict";function i(n,e,t,i){r.call(this,n,e,t,i),Object.defineProperty(this,"space",{get:function(){var n=this.get_body();return n?n.get_space():null}}),this.set_sensorEnabled(!0)}var l=t(465).nape,r=l.shape.Circle;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.addInterListeners=function(n){var e=this.space.get_listeners();n.map(function(n){e.has(n)||e.add(n)})},i.prototype.removeInterListeners=function(n){n&&this.space&&this.space.get_listeners().remove(n)},i.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},i.prototype.removeCbtype=function(n){this.get_cbTypes().remove(n)},n.exports=i},519:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(466),p=t(475),s=t(464),o=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="轻绳";var t=["坐标","参数"];this.firstDrop=[];for(var o=0;2>o;o++)this.firstDrop.push(new l(t[o],t[o],o));switch(this.X1=new r("坐标X",-100,100,.1,0,!0,"m"),this.Y1=new r("坐标Y",-100,100,.1,0,!0,"m"),this.X2=new r("坐标X",-100,100,.1,0,!0,"m"),this.Y2=new r("坐标Y",-100,100,.1,0,!0,"m"),this.L=new r("绳长",.1,100,1,this.body.L,!0,"m"),this.D=new r("阻尼系数",0,1,.01,0,!0,"",2),this.F=new r("劲度系数",.01,100,.01,1,!0,"N/m",2),this.position1=[new p("端点1坐标",!0),this.X1,this.Y1],this.position2=[new p("端点2坐标",!0),this.X2,this.Y2],this.position=[this.position1,this.position2],this.motionHide=new s("运行时隐藏",!1),this.canshu=[],this.body.typeName){case"LightRope":this.L.name="绳长",this.canshu.push(this.L);break;case"LightBar":this.L.name="杆长",this.canshu.push(this.L);break;case"LightSpring":this.L.name="弹簧长度",this.canshu.push(this.L,this.D,this.F)}this.secondDrop=[this.position,this.canshu],this.compList=[this.firstDropTitle,this.motionHide,this.canshu,new p,this.position],this.jointBody1=new a,this.jointBody2=new a,this.checkDataChange()}return n.prototype.checkDataChange=function(){function n(){e.position.splice(0),""==e.jointBody1.bodyName&&e.position.push(e.position1),""==e.jointBody2.bodyName&&e.position.push(e.position2)}var e=this;this.jointBody1.on("change",function(e){n()}),this.jointBody2.on("change",function(e){n()}),this.X1.on("change",function(){var n=o.Value2Pixel(e.X1.showValue),t=o.Value2Pixel(e.Y1.showValue);e.body.setHeadXY(e.body.head0,n,t)}),this.Y1.on("change",function(){var n=o.Value2Pixel(e.X1.showValue),t=o.Value2Pixel(e.Y1.showValue);e.body.setHeadXY(e.body.head0,n,t)}),this.X2.on("change",function(){var n=o.Value2Pixel(e.X2.showValue),t=o.Value2Pixel(e.Y2.showValue);e.body.setHeadXY(e.body.head1,n,t)}),this.Y2.on("change",function(){var n=o.Value2Pixel(e.X2.showValue),t=o.Value2Pixel(e.Y2.showValue);e.body.setHeadXY(e.body.head1,n,t)}),this.body.on("move",function(){var n=o.Pixel2Value(e.body.head0.body.zpp_inner.posx),t=o.Pixel2Value(e.body.head0.body.zpp_inner.posy),i=o.Pixel2Value(e.body.head1.body.zpp_inner.posx),l=o.Pixel2Value(e.body.head1.body.zpp_inner.posy);e.X1._showValue=n.toFixed(2),e.Y1._showValue=t.toFixed(2),e.X2._showValue=i.toFixed(2),e.Y2._showValue=l.toFixed(2)}),this.L.on("change",function(){var n=o.Value2Pixel(e.L.showValue);e.body.changeLength(n)}),this.D.on("change",function(){e.body.setDamping(e.D.showValue)}),this.F.on("change",function(){e.body.setFrequency(e.F.showValue)})},n.prototype.changeLScale=function(){this.body.changeLength(o.Value2Pixel(this.L.showValue))},n}()},520:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.M=1e3,t.kg_M=1,t.body=new p.Body(p.BodyType.get_DYNAMIC()),t.material=new p.Material(1,0,0,1,0),t.body.set_mass(t.M),t.body.get_userData()["class"]=t,t.elasticity=1,t.friction=0,t.o_speed={v:0,angle:0},t.z_speed={x:0,y:0},t.rotate=0,t.weiyi_x=0,t.weiyi_y=0,t.weiyi_o=0,t.pre_velx=0,t.pre_vely=0,t.pre_velo=0,t.av_x=0,t.av_y=0,t.av_o=0,t.force_x=0,t.force_y=0,t.force_o=0,t.outForce0=new p.Vec2,t.outForce0_delay=[0,10],t.outForce0_obj={id:t.id+"_0",ifShow:!1},t.outForce1=new p.Vec2,t.outForce1_delay=[0,10],t.outForce1_obj={id:t.id+"_1",ifShow:!1},t.applyForce=new p.Vec2,t}return r(e,n),e.prototype.changeGridScale=function(){this.emit("move"),this.baseData.changeVScale&&this.baseData.changeVScale()},e.prototype.applyImpulse=function(n,e,t){this.addForce2(n)},e.prototype.addForce2=function(n){this.addForce(n.zpp_inner.x,n.zpp_inner.y)},e.prototype.addForce=function(n,e){this.applyForce.zpp_inner.x+=+n,this.applyForce.zpp_inner.y+=+e},e.prototype.updateForce=function(){this.body.get_force().setxy(this.applyForce.zpp_inner.x/p.GRIG_M2P*1e3,this.applyForce.zpp_inner.y/p.GRIG_M2P*1e3)},e.prototype.resetForce=function(){this.applyForce.zpp_inner.x=0,this.applyForce.zpp_inner.y=0,this.body.zpp_inner.forcex=0,this.body.zpp_inner.forcey=0,this.body.get_force().setxy(0,0)},e.prototype.setRotate=function(n){this.rotate=n,this.body.set_rotation(this.rotate),this.setXY(p.Value2Pixel(this.baseData.xPosition.showValue),p.Value2Pixel(this.baseData.yPosition.showValue))},e.prototype.setXY=function(e,t){n.prototype.setXY.call(this,e,t),this.rotation=this.rotate,this.body&&this.body.get_position().setxy(e||0,t||0)},e.prototype.reset=function(){this.setRotate(this.rotate),this.body.get_velocity().setxy(0,0),this.body.set_angularVel(0),this.weiyi_x=0,this.weiyi_y=0,this.weiyi_o=0,this.pre_velx=0,this.pre_vely=0,this.pre_velo=0,this.av_x=0,this.av_y=0,this.av_o=0,this.force_x=0,this.force_y=0,this.force_o=0,this.resetForce()},e.prototype.setMass=function(n){this.M=1e3*n,this.kg_M=n,this.body.set_mass(this.M)},e.prototype.setElasticity=function(n){this.elasticity=n,this.material.set_elasticity(n)},e.prototype.setFriction=function(n){this.friction=n,this.material.set_dynamicFriction(n),this.material.set_staticFriction(n)},e.prototype.setOSpeed=function(n,e){this.o_speed.v=n||0,this.o_speed.angle=e||0,this.z_speed.x=Math.cos(this.o_speed.angle)*this.o_speed.v,this.z_speed.y=Math.sin(this.o_speed.angle)*this.o_speed.v},e.prototype.setZSpeed=function(n,e){this.z_speed.x=n||0,this.z_speed.y=e||0,this.o_speed.v=Math.sqrt(this.z_speed.x*this.z_speed.x+this.z_speed.y*this.z_speed.y),this.o_speed.angle=Math.atan2(this.z_speed.y,this.z_speed.x)},e.prototype.setSpeed=function(){this.body.get_velocity().setxy(this.z_speed.x,this.z_speed.y);var n=p.Pixel2Value(this.z_speed.x),e=p.Pixel2Value(this.z_speed.y);this.pre_velx=n,this.pre_vely=e,this.pre_velo=Math.sqrt(n*n+e*e)},e.prototype.updateShow=function(){var n=p.napeWorld,e=n.baseData;(e.ifShowVol.checked||this.baseData.ifShowVol.checked)&&this.showVol(this,n,{x:this.pre_velx,y:this.pre_vely},6),e.showForceH.checked&&this.showForce(this,n,{x:this.force_x,y:this.force_y},5),(e.ifShowAVol.checked||this.baseData.ifShowAVol.checked)&&this.showAVol(this,n,{x:this.av_x,y:this.av_y},7),e.showForceO.checked&&(this.outForce0_obj.ifShow&&this.showForce(this,this.outForce0_obj,{x:this.outForce0.zpp_inner.x,y:this.outForce0.zpp_inner.y},11),this.outForce1_obj.ifShow&&this.showForce(this,this.outForce1_obj,{x:this.outForce1.zpp_inner.x,y:this.outForce1.zpp_inner.y},12))},e.prototype.update=function(){var n=p.Pixel2Value(this.body.zpp_inner.velx),e=p.Pixel2Value(this.body.zpp_inner.vely),t=n-this.pre_velx,i=e-this.pre_vely;this.pre_velx=n,this.pre_vely=e,this.pre_velo=Math.sqrt(n*n+e*e);var l=p.napeWorld,r=t*l.stepTime,a=i*l.stepTime;this.av_x=r,this.av_y=a,this.av_o=Math.sqrt(r*r+a*a);var s=r*this.kg_M,o=a*this.kg_M;this.force_x=s,this.force_y=o,this.force_o=Math.sqrt(s*s+o*o),this.weiyi_x=p.Pixel2Value(this.body.zpp_inner.posx),this.weiyi_y=p.Pixel2Value(this.body.zpp_inner.posy),this.weiyi_o=Math.sqrt(this.weiyi_x*this.weiyi_x+this.weiyi_y*this.weiyi_y),this.outForce0_delay[0]>p.CurrentStageDelay||p.CurrentStageDelay>this.outForce0_delay[1]?this.outForce0_obj.ifShow=!1:(this.applyImpulse(this.outForce0,null,!1),this.outForce0_obj.ifShow=!0),this.outForce1_delay[0]>p.CurrentStageDelay||p.CurrentStageDelay>this.outForce1_delay[1]?this.outForce1_obj.ifShow=!1:(this.applyImpulse(this.outForce1,null,!1),this.outForce1_obj.ifShow=!0)},e.prototype.showForce=function(n,e,t,i,l){if(this.baseData.ifShowForce&&(p.napeWorld.baseData.ifShowForce.checked||this.baseData.ifShowForce.checked)){var r=n.id+"|"+e.id;l&&(r=e.id+"|"+n.id),r=r+"_"+i;var a=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x),o={x:n.body.zpp_inner.posx,y:n.body.zpp_inner.posy},h=p.Value2Pixel(a*p.FORCE_SHOW_SCALE);p.napeWorld.baseData.showDiscom.checked&&(t.x=p.Value2Pixel(t.x*p.FORCE_SHOW_SCALE),t.y=p.Value2Pixel(t.y*p.FORCE_SHOW_SCALE)),p.forceViewer.setForce(r,h,s,o,i,t,a,"N")}},e.prototype.showVol=function(n,e,t,i){var l=n.id+"|"+e.id+"|vol",r=Math.sqrt(t.x*t.x+t.y*t.y),a=Math.atan2(t.y,t.x),s={x:n.body.zpp_inner.posx,y:n.body.zpp_inner.posy},o=r*p.VOL_SHOW_SCALE;p.napeWorld.baseData.showDiscom.checked&&(t.x=t.x*p.VOL_SHOW_SCALE,t.y=t.y*p.VOL_SHOW_SCALE),p.forceViewer.setForce(l,o,a,s,i,t,r,"m/s")},e.prototype.showAVol=function(n,e,t,i){var l=n.id+"|"+e.id+"|avol",r=Math.sqrt(t.x*t.x+t.y*t.y),a=Math.atan2(t.y,t.x),s={x:n.body.zpp_inner.posx,y:n.body.zpp_inner.posy},o=r*p.AVOL_SHOW_SCALE;p.napeWorld.baseData.showDiscom.checked&&(t.x=t.x*p.AVOL_SHOW_SCALE,t.y=t.y*p.AVOL_SHOW_SCALE),p.forceViewer.setForce(l,o,a,s,i,t,r,"m/s²")},e.prototype.checkMove=function(){var n,e=this;this.dragUtil.on("move",function(){n=null;var t=e.getNearItems();e.computRangeTo(t)})},e.prototype.computRangeTo=function(n){if(n.forEach(function(n){n.body.set_allowMovement(!1),n.body.set_allowRotation(!1)}),p.napeWorld.space.step(p.napeWorld.timeStep,40,40),p.napeWorld.worldUpdate(),n.forEach(function(n){n.body.set_allowMovement(!0),n.body.set_allowRotation(n.allowRotate)}),this.baseData.rotate){var e=180*this.body.get_rotation()/Math.PI;0>e&&(e=360+e),this.rotate=this.body.get_rotation(),this.baseData.rotate._value=e,this.setAdsorpPos()}this.emit("move")},e.prototype.getNearItems=function(){for(var n=[],e=0;p.napeWorld.equipArr.length>e;e++){var t=p.napeWorld.equipArr[e],i=["Ground","WoodBoard","WoodTriangle","WoodBlock","ActionBody"];if(t!=this&&-1!=i.indexOf(t.typeName)){p.Geom.intersectsBody(this.body,t.body)&&n.push(t)}}return n},e.prototype.setAdsorpPos=function(){},e}(a)},552:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a,p){i(this,e);var s=l(this,n.call(this));return s.name=t||"",s.folded=null==r||r,s.typeName="FoldButtonData",s.icon=a||"",s.ifFold=p===undefined||p,s}return r(e,n),a(e,[{key:"name",get:function(){return s.getL(this._name)},set:function(n){this._name=n}},{key:"folded",get:function(){return this._folded},set:function(n){this._folded=n,this.emit("change")}}]),e}(p)},553:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(447),s=t(632),o=(t(519),t(490)),h=t(636),_=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.head0=new h,t.head1=new h,t.bodyCon=new PIXI.Container,t.headCon=new PIXI.Container,t.bodyShape=new _,t.bodyCon.addChild(t.bodyShape),t.headCon.addChild(t.head0),t.headCon.addChild(t.head1),t.addChild(t.bodyCon),t.addChild(t.headCon),t.head0.body.set_type(p.BodyType.get_KINEMATIC()),t.head1.body.set_type(p.BodyType.get_KINEMATIC()),t.L_Pixel=200,t.jointMin=0,t.jointMax=t.L_Pixel,t.damping=0,t.frequency=.1,t.L=p.Pixel2Value(t.L_Pixel),t.headDistance=t.L_Pixel,t.jointForce=new p.Vec2,t.joint=new p.DistanceJoint(t.head0.body,t.head1.body,new p.Vec2,new p.Vec2,t.jointMin,t.jointMax),t.joint.set_damping(t.damping),t.joint.set_frequency(t.frequency),t.headsDate={b1x:0,b1y:0,b2x:0,b2y:0,ll:0,l:0,normal_x:0,normal_y:0,cos:1,sin:0,rotation:0,scalex:1,scaley:1},t.initEvents(),t}return r(e,n),e.prototype.initEvents=function(){function n(){p.main.emit(p.ELEMENT_MOVE_END,{ele:a})}function e(){i(),u=setTimeout(l,1e3),clearTimeout(d),d=setTimeout(function(){p.main.emit(p.ELEMENT_TOUCH,{ele:a})},1)}function t(){a.emit("move"),p.main.emit(p.ELEMENT_MOVE,{ele:a}),i()}function i(){a.emit("move"),clearTimeout(u)}function l(){p.AppStatus!=p.APP_START&&p.main.emit(p.EVENT_SHOW_DROP_INNER,{element:a})}var r=this,a=this,s=this.head0.dragUtil,h=this.head1.dragUtil;this.drag0=s,this.drag1=h,s.on("start",function(n){r.joint.set_space(null),r.joint.set_body1(r.head0.body)}),s.on("move",function(n){r.update()}),this.head0.on("change",function(e){var t=e.value,l=t?t.body:null;l&&l!=r.joint.get_body2()?(r.joint.set_body1(l),r.baseData.jointBody1.bodyName=t.id):(r.joint.set_body1(r.head0.body),r.baseData.jointBody1.bodyName=""),r.joint.set_space(r.joint.get_body1().isDynamic()||r.joint.get_body2().isDynamic()?p.space:null),r.update(),n(),i()}),h.on("start",function(n){r.joint.set_space(null),r.joint.set_body2(r.head1.body)}),h.on("move",function(n){r.update()}),this.head1.on("change",function(e){var t=e.value,l=t?t.body:null;l&&l!=r.joint.get_body1()?(r.joint.set_body2(l),r.baseData.jointBody2.bodyName=t.id):(r.joint.set_body2(r.head1.body),r.baseData.jointBody2.bodyName=""),r.joint.set_space(r.joint.get_body1().isDynamic()||r.joint.get_body2().isDynamic()?p.space:null),r.update(),n(),i()});var _=new o(this.bodyCon);this.bodyCon.interactive=!0,_.on("start",function(n){e(),s.emit("start",n),h.emit("start",n)}),_.on("end",function(n){i(),s.emit("end",n),h.emit("end",n)}),_.on("move",function(n){s.emit("move",n),h.emit("move",n),t()});var u,d;_.on(o.DOUBLE_CLICK,l),this.showPop=l},e.prototype.changeLength=function(n){this.L=p.Pixel2Value(n),this.L_Pixel=n,this.jointMax=n,this.joint.set_jointMax(this.jointMax)},e.prototype.setDamping=function(n){this.damping=n||0,this.joint.set_damping(this.damping)},e.prototype.setFrequency=function(n){this.frequency=n||0,this.joint.set_frequency(this.frequency)},e.prototype.setHeadXY=function(n,e,t){n.x=e,n.y=t,this.update()},e.prototype.setXY=function(n,e){var t=this.getBoundsBox(),i=n-t.x,l=e-t.y;this.head0.translate(i,l),this.head1.translate(i,l),this.update()},e.prototype.setBodys=function(n,e){var t=this;n&&t.joint.set_body1(n.body),e&&t.joint.set_body2(e.body),t.joint.set_space(t.joint.get_body1()==t.joint.get_body2()||t.joint.get_body1()==t.head0.body&&t.joint.get_body2()==t.head1.body?null:p.space),this.update()},e.prototype.clearBody=function(n){var e=n.body;this.joint.get_body1()==e&&this.joint.set_body1(this.head0.body),this.joint.get_body2()==e&&this.joint.set_body2(this.head1.body),this.joint.get_body1()==this.head0.body&&this.joint.get_body2()==this.head0.body&&this.joint.set_space(null)},e.prototype.update=function(){this.dragUpdate()},e.prototype.dragUpdate=function(){this.head0.setXY(this.head0.x,this.head0.y),this.head1.setXY(this.head1.x,this.head1.y),this.updateDateAndView()},e.prototype.updateDateAndView=function(){this.updateDate(),this.updateView()},e.prototype.updateDate=function(){var n=this.joint.get_body1(),e=this.joint.get_body2();this.headsDate.b1x=n.zpp_inner.posx,this.headsDate.b1y=n.zpp_inner.posy,this.headsDate.b2x=e.zpp_inner.posx,this.headsDate.b2y=e.zpp_inner.posy;var t=this.headsDate.b2x-this.headsDate.b1x,i=this.headsDate.b2y-this.headsDate.b1y,l=Math.atan2(i,t);if(this.headsDate.cos=Math.cos(l),this.headsDate.sin=Math.sin(l),this.headsDate.rotation=l,this.headsDate.ll=t*t+i*i,this.headsDate.l=Math.sqrt(this.headsDate.ll),this.headDistance=this.headsDate.l,this.headsDate.scalex=(this.headsDate.l-10)/this.L_Pixel,"LightRope"==this.typeName&&(this.headsDate.scalex=1),this.headsDate.scaley=1,this.headsDate.normal_x=t/this.headsDate.l,this.headsDate.normal_y=i/this.headsDate.l,"LightSpring"==this.typeName){if(1==this.joint.get_active())return;if(p.AppStatus!=p.APP_START)return;var r=p.Pixel2Value(this.headsDate.l-this.L_Pixel),a=r*this.frequency,s=this.headsDate.normal_x*a,o=this.headsDate.normal_y*a,h=p.Pixel2Value(n.zpp_inner.velx-e.zpp_inner.velx),_=p.Pixel2Value(n.zpp_inner.vely-e.zpp_inner.vely),u=h*this.headsDate.normal_x+_*this.headsDate.normal_y,d=u*this.headsDate.normal_x*this.damping,c=u*this.headsDate.normal_y*this.damping;if(s-=d,o-=c,n!=this.head0.body){this.jointForce.zpp_inner.x=s,this.jointForce.zpp_inner.y=o;n.zpp_inner.userData["class"].applyImpulse(this.jointForce,null,!1)}if(e!=this.head1.body){this.jointForce.zpp_inner.x=-s,this.jointForce.zpp_inner.y=-o;e.zpp_inner.userData["class"].applyImpulse(this.jointForce,null,!1)}}},e.prototype.updateView=function(){var n=this.joint.get_body1();n!=this.head0.body&&this.head0.setXY(n.zpp_inner.posx,n.zpp_inner.posy);var e=this.joint.get_body2();e!=this.head1.body&&this.head1.setXY(e.zpp_inner.posx,e.zpp_inner.posy)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.head0.destroy(),this.head1.destroy(),this.joint.set_space(null)},e.prototype.changeGridScale=function(){this.emit("move")},e.prototype.getBoundsBox=function(){return this.headCon.getLocalBounds()},e.prototype.getPhoto=function(){return n.prototype.getPhoto.call(this)},a(e,[{key:"jointMin",set:function(n){this._jointMin=n},get:function(){return this._jointMin}},{key:"jointMax",set:function(n){this._jointMax=n},get:function(){return this._jointMax}}]),e}(s)},579:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=(t(447),t(460)),p=(t(637),t(490)),s=(t(496),t(455));n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this));return t=a.hexTo64(t||"#ffffff"),r.anchor=new s,r.anchor.lineStyle(1,a.hexTo64("#16AAF3"),1),r.anchor.beginFill(t,1),r.anchor.drawCircle(0,0,6),r.anchor.endFill(),r.addChild(r.anchor),r.interactive=!0,r.buttonMode=!0,r.dragUtil=new p(r,!0),r}return r(e,n),e.prototype.transform=function(n){},e.prototype.show=function(n){this.visible=n},e.prototype.setCursor=function(n){},e.prototype.destroy=function(){this.dragUtil.destroy(),n.prototype.destroy.call(this)},e}(PIXI.Container)},580:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}t(447);n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this));return r.raduis=t||20,r.color="#cdcdcd",r.hole=0,r.group=new PIXI.Sprite,r.addChild(r.group),r.updateView(),r}return r(e,n),e.prototype.updateView=function(){var n='\n        <svg xmlns="http://www.w3.org/2000/svg" height="400" version="1.1" width="400">\n            <defs>\n            <filter id="Sjhbcfa8h56" filterUnits="userSpaceOnUse">\n            <feGaussianBlur in="SourceAlpha" stdDeviation="0.5" result="blur"/>\n\t\t\t<feOffset dy="0.5" dx="0.5"/>\n\t\t\t<feComposite in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowDiff"/>\n\t\t\t\n           <feFlood flood-color="#222222" flood-opacity="0.9"/>\n\t\t   <feComposite in2="shadowDiff" operator="in"/>\n\t\t   <feComposite in2="SourceGraphic" operator="over" result="firstfilter"/>\n          <feGaussianBlur in="firstfilter" stdDeviation="0.5" result="blur2"/>\n\t\t\t<feOffset dy="-0.5" dx="-0.5"/>\n\t\t\t<feComposite in2="firstfilter" operator="arithmetic" k2="-1" k3="1" result="shadowDiff"/>\n\t\t\t\n           <feFlood flood-color="#2222222" flood-opacity="0.9"/>\n\t\t\t<feComposite in2="shadowDiff" operator="in"/>\n\t\t\t<feComposite in2="firstfilter" operator="over"/>\n\t\t\t</filter><linearGradient x1="0" y1="1" x2="1" y2="1" id="linearGradientSjhbcfa8h58">\n\t\t\t<stop offset="0%" stop-color="'+this.color+'"/>\n\t\t\t<stop offset="50%" stop-color="#cccccc"/>\n\t\t\t<stop offset="100%" stop-color="'+this.color+'"/>\n\t\t\t</linearGradient>\n        </defs>\n\t\t\t<g style="transform: matrix(10,0,0,10,200,200);">\n\t\t\t<circle cx="0" cy="0" r="20" fill="#cccccc"/>\n\t\t\t<circle cx="0" cy="0" r="18" fill="url(\'#linearGradientSjhbcfa8h58\')" filter="url(\'#Sjhbcfa8h56\')"/>\n\t\t\t<circle cx="-10" cy="0" r="2" fill="#333333"/>\n\t\t\t<circle cx="10" cy="0" r="2" fill="#333333"/>\n\t\t\t<circle cx="0" cy="10" r="'+this.hole+'" fill="#333333"/>\n\t\t\t<circle cx="0" cy="-10" r="'+this.hole+'" fill="#333333"/>\n\t\t\t<circle cx="0" cy="0" r="1" fill="#464646"/></g>\n\t\t</svg>';this.group.pivot.set(200,200);var e=this.raduis/200;this.group.scale.set(e,e);var t="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n)));this.group.texture=PIXI.Texture.fromImage(t)},e.prototype.transform=function(n){this.group.transform(n)},e.prototype.setMatelColor=function(n){this.color=n,this.updateView()},e.prototype.rollTo=function(n){this.group.rotation=n},e.prototype.addHole=function(){this.hole=2,this.updateView()},e}(PIXI.Container)},623:function(n,e,t){"use strict";function i(n,e,t){this.handJointStiff=!1,this.handJointFrequency=10,this.view=null,this.weldDrag=!1,this.classType=undefined,this.coordinateField=null,this.dragLevel=null==n?0:n,this.noDrag=e,this.bindupdate=null,this.allowMove=null==t||t,this.stopFindConnectBodies=!1,this.dragManager=null,this.freeMec=!1,this.nolight=!1,this.iswall=!1,this.originKinematicType=!1,this.pivotDrag=!1,this.moveCompo=!1,this.nomoveTool=!1,this.cannotToolRot=!1,this.dragTomoveTool=!1,this.dragtranslate=!1,this.canfixtool=!1,this.noSelectlayer=!1,this.isnbequ=!1}n.exports=i},624:function(n,e,t){"use strict";function i(n,e){l.phys.Body.call(this,n,e),this.userData=new r(0,!1,!0),Object.defineProperty(this,"shapes",{get:function(){return this.get_shapes()}}),Object.defineProperty(this,"constraints",{get:function(){return this.get_constraints()}}),Object.defineProperty(this,"cbTypes",{get:function(){return this.get_cbTypes()}}),Object.defineProperty(this,"arbiters",{get:function(){return this.get_arbiters()}}),Object.defineProperty(this,"bullet",{get:function(){return this.get_isBullet()},set:function(n){this.set_isBullet(n)}}),Object.defineProperty(this,"posx",{get:function(){return this.zpp_inner.posx},set:function(n){this.zpp_inner.posx=n,this.zpp_inner.setupPosition()}}),Object.defineProperty(this,"posy",{get:function(){return this.zpp_inner.posy},set:function(n){this.zpp_inner.posy=n,this.zpp_inner.setupPosition()}}),Object.defineProperty(this,"isSleep",{get:function(){return this.get_isSleeping()}}),Object.defineProperty(this,"rotation",{get:function(){return this.get_rotation()},set:function(n){this.set_rotation(n)}}),Object.defineProperty(this,"type",{get:function(){return this.get_type()},set:function(n){this.set_type(n)}}),Object.defineProperty(this,"noallowRotation",{get:function(){return this.zpp_inner.norotate},set:function(n){this.zpp_inner.norotate=n,this.zpp_inner.invalidate_inertia()}}),Object.defineProperty(this,"allowMovement",{get:function(){return this.get_allowMovement()},set:function(n){this.set_allowMovement(n)}}),Object.defineProperty(this,"angularVel",{get:function(){return this.get_angularVel()},set:function(n){this.set_angularVel(n)}}),Object.defineProperty(this,"velocity",{get:function(){return this.get_velocity()},set:function(n){this.set_velocity(n)}}),Object.defineProperty(this,"position",{get:function(){return this.get_position()},set:function(n){this.set_position(n)}}),Object.defineProperty(this,"bounds",{get:function(){return this.get_bounds()}}),Object.defineProperty(this,"space",{get:function(){return this.get_space()},set:function(n){this.set_space(n)}}),Object.defineProperty(this,"mass",{get:function(){return this.get_mass()},set:function(n){this.set_mass(n)}})}var l=t(465).nape,r=t(623);i.constructor=i,i.prototype=Object.create(l.phys.Body.prototype),i.prototype.dispose=function(){this.zpp_inner.outer=null,this.zpp_inner.outer_i=null},i.prototype.sensorEnabled=function(n){var e;for(e=0;e<this.shapes.get_length();e++){this.shapes.at(e).set_sensorEnabled(n)}},i.prototype.addCbType=function(n){this.cbTypes.add(n)},i.prototype.hasCbType=function(n){return this.cbTypes.has(n)},i.prototype.forbidDrag=function(n){this.userData.noDrag=n},i.prototype.add=function(n){this.shapes.add(n)},i.prototype.remove=function(n){return this.shapes.remove(n)},i.prototype.shapesAt=function(n){return this.shapes.at(n)},i.prototype.set_sensorEnabled_at=function(n,e){this.shapesAt(n).set_sensorEnabled(e)},i.prototype.set_shape_sensorEnabled=function(n,e){n.set_sensorEnabled(e)},i.prototype.setFilter_cm=function(n,e,t){n.zpp_inner.filter.collisionGroup=e,n.zpp_inner.filter.collisionMask=t},i.prototype.setGroup=function(n){this.set_group(null==n?null:n)},i.prototype.setShapeFluidEnabled=function(n,e){n.set_fluidEnabled(e)},i.prototype.getShapeFluidEnabled=function(n){return n.get_fluidEnabled()},i.prototype.setFluidDensity=function(n,e){n.get_fluidProperties().set_density(e),n.get_material().set_density(e)},i.prototype.getFluidDensity=function(n){return n.get_fluidProperties().get_density()},i.prototype.setFluidViscosity=function(n,e){n.get_fluidProperties().set_viscosity(e)},i.prototype.getFluidViscosity=function(n){return n.get_fluidProperties().get_viscosity()},i.prototype.getShapeArea=function(n){return null==n?null:n.zpp_inner.area},i.prototype.getArea=function(){var n,e=this.shapes.get_length(),t=0;for(n=0;e>n;n++)t+=this.shapes.at(n).get_area();return t},i.prototype.getDensity=function(){return 1e3*this.shapesAt(0).zpp_inner.material.density},i.prototype.setDensity=function(n){var e=this.shapes.get_length(),t=0;for(t=0;e>t;t++){var i=this.shapesAt(t);i.zpp_inner.material.density=.001*n,i.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.PROPS)}},i.prototype.getFriction=function(){return this.shapesAt(0).zpp_inner.material.dynamicFriction},i.prototype.setFriction=function(n){var e=0,t=this.shapes.get_length();for(e=0;t>e;e++){var i=this.shapesAt(e);i.zpp_inner.material.dynamicFriction=n,i.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.ANGDRAG|zpp_nape.phys.ZPP_Material.ARBITERS)}},i.prototype.getElasticity=function(){return this.shapesAt(0).zpp_inner.material.elasticity},i.prototype.setElasticity=function(n){var e=0,t=this.shapes.get_length();for(e=0;t>e;e++){var i=this.shapesAt(e);i.zpp_inner.material.elasticity=n,i.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.ARBITERS)}},i.prototype.wake=function(){this.zpp_inner.wake()},n.exports=i},625:function(n,e,t){"use strict";function i(n,e,t,i){l.call(this,n,e,t,i)}var l=t(518);i.constructor=i,i.prototype=Object.create(l.prototype),n.exports=i},626:function(n,e,t){"use strict";function i(){}var l=t(465).nape,r=l.geom.Vec2;i.vec2Length=function(n){return Math.sqrt(n.get_x()*n.get_x()+n.get_y()*n.get_y())},i.LeftNormal=function(n){var e=new r;return e.set_x(n.get_y()),e.set_y(-n.get_x()),e.zpp_inner.validate(),e},i.rightNormal=function(n){var e=new r;return e.set_x(-n.get_y()),e.set_y(n.get_x()),e},i.normal=function(n){var e=new r,t=i.vec2Length(n);return t>0&&(e.set_x(n.get_x()/t),e.set_y(n.get_y()/t)),e},i.angle=function(n){return Math.atan2(n.get_x(),n.get_y())},i.dotProduct=function(n,e){var t=i.normal(e);return n.get_x()*t.get_x()+n.get_y()*t.get_y()},i.perpProduct=function(n,e){var t=i.LeftNormal(n),l=i.dotProduct(t,e);return 0!=l?l:1},i.project=function(n,e){var t=i.dotProduct(n,e),l=i.normal(e),a=t*l.get_x(),p=t*l.get_y();return new r(a,p)},i.bounce=function(n,e){var t=i.project(n,e),l=i.LeftNormal(e),a=i.project(n,l),p=t.get_x()+-1*a.get_x(),s=t.get_y()+-1*a.get_y();return new r(p,s)},i.symmetric=function(n,e){return i.bounce(n,i.LeftNormal(e))},n.exports=i},627:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(459),a=t(464),p=t(475),s=t(473),o=t(735),h=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.bodyName=new p("一个小球"),this.xCheckTitle=new p("X坐标"),this.yCheckTitle=new p("Y坐标"),this.xCheckArr=[[new a("时间",!0,0)],new p(""),[new a("速度",!1,1),new a("水平速度",!1,1),new a("竖直速度",!1,1)],new p(""),[new a("位移",!1,2),new a("水平位移",!1,2),new a("竖直位移",!1,2)],new p(""),[new a("加速度",!1,3),new a("水平加速度",!1,3),new a("竖直加速度",!1,3)],new p(""),[new a("力",!1,4),new a("水平力",!1,4),new a("竖直力",!1,4)],new p(""),[new a("动能",!1,5),new a("重力势能",!1,5)]],this.yCheckArr=[[new a("时间",!1,0)],new p(""),[new a("速度",!0,1),new a("水平速度",!1,1),new a("竖直速度",!1,1)],new p(""),[new a("位移",!1,2),new a("水平位移",!1,2),new a("竖直位移",!1,2)],new p(""),[new a("加速度",!1,3),new a("水平加速度",!1,3),new a("竖直加速度",!1,3)],new p(""),[new a("力",!1,4),new a("水平力",!1,4),new a("竖直力",!1,4)],new p(""),[new a("动能",!1,5),new a("重力势能",!1,5)]],this.ifShowList=!1,this.selectList=[],this.xbutton=new s("X坐标",""),this.xbutton.typeName="ChangeShowButton",this.ybutton=new s("Y坐标",""),this.ybutton.typeName="ChangeShowButton",this.xbutton.on("click",this.xButtonClick.bind(this)),this.ybutton.on("click",this.yButtonClick.bind(this)),this.showLineList=[],this.clearButton=new s("清除",""),this.clearButton.typeName="ChangeShowButton",this.clearButton.on("click",this.clearImage.bind(this)),this.ifShowCoor=new a("显示坐标系",!0),this.ifShowCoor.typeName="CheckBoxItem",this.ifShowMark=new a("显示注解",!0),this.ifShowMark.typeName="CheckBoxItem",this.timeSpan=new r("时间跨度",1,30,1,10,!0,"s"),this.smooth=new r("平滑度",1,50,1,1),this.leftList=[this.bodyName,this.xbutton,this.ybutton,this.showLineList,this.clearButton,new p("",null,!0),this.ifShowCoor,this.ifShowMark,new p("",null,!0),this.timeSpan,this.smooth],this.image=null,this.moImage=new o(this),this.moImage.group.attr({display:"none"}),this.getChange(),this.expTime=h.space.get_elapsedTime(),this.close(),this.id=(new Date).getTime().toString(36)}return n.prototype.init=function(){this.initImage()},n.prototype.close=function(){this.moImage&&this.moImage.group.attr({display:"none"})},n.prototype.getChange=function(){var n=this;this.checkArrChange(this.xCheckArr),this.checkArrChange(this.yCheckArr),this.showLineListChange(),this.timeSpan.on("change",function(){n.moImage.timeSpan=n.timeSpan.showValue}),this.smooth.on("change",function(){n.moImage.smooth=n.smooth.showValue}),this.ifShowMark.on("change",function(){n.moImage.setLineNamesVisible(n.ifShowMark.checked)}),this.ifShowCoor.on("change",function(){n.moImage.setCoorVisible(n.ifShowCoor.checked)})},n.prototype.showLineListChange=function(){function n(n){for(var e=[],t=0;n.length>t;t++){var i=n[t];if(i.length)for(var l=0;i.length>l;l++){var r=i[l];r.checked&&e.push(r)}}return e}var e=this,t=n(this.xCheckArr),i=n(this.yCheckArr),l=":",r=":";t.forEach(function(n){l+=n.name+","}),i.forEach(function(n){r+=n.name+","});for(var p=[],s=0;t.length>s;s++)for(var o=t[s],h=0;i.length>h;h++){var _=i[h],u=o.name+" / "+_.name,d=function(n){for(var t=null,i=0;e.showLineList.length>i;i++){if(n==e.showLineList[i].name){t=e.showLineList[i];break}}return t}(u);d||(d=new a(u,!0)),p.push(d),d.x_Axis=o,d.y_Axis=_}this.xbutton.text=l,this.ybutton.text=r,this.showLineList.splice(0),p.forEach(function(n){n.typeName="CheckBoxItem",n.needTranslate=!1,this.showLineList.push(n)}.bind(this)),this.resizeImage(),this.moImage.changeShowLines()},n.prototype.checkArrChange=function(n){function e(n){var e=this;e.checked&&t(e),i.showLineListChange()}function t(e){for(var t=0;n.length>t;t++){var i=n[t];if(i.length)for(var l=0;i.length>l;l++){var r=i[l];e.id!=r.id&&(r._checked=!1)}}}for(var i=this,l=0;n.length>l;l++){var r=n[l];if(r.length)for(var a=0;r.length>a;a++){var p=r[a];p.typeName="CheckBoxItem",p.on("change",e)}}},n.prototype.getItemData=function(n){var e=0;switch(n.name){case"时间":e=h.space.get_elapsedTime()-this.expTime;break;case"速度":e=this.body.pre_velo;break;case"水平速度":e=this.body.pre_velx;break;case"竖直速度":e=this.body.pre_vely;break;case"位移":e=this.body.weiyi_o;break;case"水平位移":e=this.body.weiyi_x;break;case"竖直位移":e=this.body.weiyi_y;break;case"加速度":e=this.body.av_o;break;case"水平加速度":e=this.body.av_x;break;case"竖直加速度":e=this.body.av_y;break;case"力":e=this.body.force_o;break;case"水平力":e=this.body.force_x;break;case"竖直力":e=this.body.force_y;break;case"动能":e=this.body.pre_velo*this.body.M/2;break;case"势能":break;case"重力势能":e=h.napeWorld.baseData.caseGrave.checked?this.body.M*h.napeWorld.g_gravity*this.body.weiyi_y:0}return e},n.prototype.getUnit=function(n){var e="";switch(n.name){case"时间":e="s";break;case"速度":case"水平速度":case"竖直速度":e="m/s";break;case"位移":case"水平位移":case"竖直位移":e="m";break;case"加速度":case"水平加速度":case"竖直加速度":e="m/s²";break;case"力":case"水平力":case"竖直力":e="N";break;case"动能":case"势能":case"重力势能":case"总能量":e="J"}return e},n.prototype.closeSlectList=function(){this.ifShowList=!1},n.prototype.xButtonClick=function(){this.selectList.splice(0),this.selectList.push(this.xCheckTitle,this.xCheckArr),this.ifShowList=!0},n.prototype.yButtonClick=function(){this.selectList.splice(0),this.selectList.push(this.yCheckTitle,this.yCheckArr),this.ifShowList=!0},n.prototype.clearImage=function(){this.moImage.clear(),this.moImage.changeShowLines()},n.prototype.initImage=function(){function n(){this.image=new Snap("#"+this.id),this.image.attr({id:this.image.id}),this.moImage.group.attr({display:"block"}),this.image.append(this.moImage.group),this.moImage.group.attr({width:"100%",height:"100%"}),this.resizeImage()}setTimeout(n.bind(this),10)},n.prototype.resizeImage=function(){"none"!=this.moImage.group.attr("display")&&this.moImage.group.parent()!=h.svg&&setTimeout(function(){this.moImage.setWH(this.moImage.group.parent().node.clientWidth,this.moImage.group.parent().node.clientHeight)}.bind(this),10)},n.prototype.updataImage=function(){"none"!=this.moImage.group.node.style.display&&"#document"===this.moImage.group.node.getRootNode().nodeName&&this.moImage.update()},n.prototype.destroy=function(){this.moImage.destroy(),this.moImage=null,this.image=null},l(n,[{key:"id",get:function(){return this._id},set:function(n){this._id=n}}]),n}()},628:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(459),r=t(464),a=t(466),p=t(485),s=t(473),o=t(475),h=t(552),_=t(629),u=t(447);n.exports=function(){function n(e){function t(){var n=u.Value2Pixel(x.xVelocity.showValue),e=u.Value2Pixel(x.yVelocity.showValue);x.body.setZSpeed(n,e);var t=u.Pixel2Value(x.body.o_speed.v);x.dVelocity._showValue=t,x.oVelocity._showValue=x.body.o_speed.angle/Math.PI*180}function d(){var n=u.Value2Pixel(x.dVelocity.showValue);x.body.setOSpeed(n,x.oVelocity.showValue/180*Math.PI);var e=u.Pixel2Value(x.body.z_speed.x),t=u.Pixel2Value(x.body.z_speed.y);x.xVelocity._showValue=e,x.yVelocity._showValue=t}var c=this;i(this,n);var x=this;this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="木板",this.motionHide=new r("运行时隐藏",!1),this.xPosition=new l("坐标X",-100,100,.1,0,!0,"m"),this.yPosition=new l("坐标Y",-100,100,.1,0,!0,"m"),this.lockRotate=new r("锁定旋转",!1),this.width=new l("宽",1,100,1,u.Pixel2Value(this.body.width),!0,"m"),this.height=new l("高",1,100,1,u.Pixel2Value(this.body.height),!0,"m"),this.angle=new p(this.body.angle,"底角"),this.bottom=new l("底边长度",1,100,.1,u.Pixel2Value(100),!0,"m"),this.revertX=new r("左右镜像",this.body.revertX),this.revertY=new r("上下镜像",this.body.revertY),this.rotate=new p(0,"旋转角度"),this.ifShowPhoto=new r("启用闪照"),this.showPhotoycle=new l("闪照周期",.1,5,.1,1,!0,"s"),this.ifShowPhotoTime=new r("显示闪照时间点"),this.ifShowPhone0=[],this.bodyM=new l("质量",1,1e3,1,1,!0,"kg"),this.bodyT=new l("碰撞系数",0,1,.01,this.body.material.get_elasticity()),this.bodyC=new l("粗糙程度",0,1,.01,this.body.material.get_staticFriction()),this.xVelocity=new l("速度V(X)",-1e3,1e3,1,0,!0,"m/s"),this.yVelocity=new l("速度V(Y)",-1e3,1e3,1,0,!0,"m/s"),this.xVelocity.canBeAny=!0,this.yVelocity.canBeAny=!0,this.dVelocity=new l("速率",-1e3,1e3,1,0,!0,"m/s"),this.oVelocity=new l("角度",-360,360),this.ifShowForce=new r("力"),this.ifShowForce.typeName="CheckBoxItem",this.ifShowForce.canSwap=!0,this.ifShowVol=new r("速度"),this.ifShowVol.typeName="CheckBoxItem",this.ifShowVol.canSwap=!0,this.ifShowAVol=new r("加速度"),this.ifShowAVol.typeName="CheckBoxItem",this.ifShowAVol.canSwap=!0,this.showValueSetingButton=new s("","",0,"rightbar_btn_shezhi_pressed.png",!1,!0,15),this.showValueSetingButton.preventEvent=!0,this.outForce0=new h("外力1",!0),this.outForce0_x=new l("X方向",-1e3,1e3,.1,0,!0,"N"),this.outForce0_y=new l("Y方向",-1e3,1e3,.1,0,!0,"N"),this.outForce0_x.canBeAny=!0,this.outForce0_y.canBeAny=!0,this.outForce0_delay=new _(0,10,"起止时间","s"),this.outForce0_arr=[],this.outForce1=new h("外力2",!0),this.outForce1_x=new l("X方向",-1e3,1e3,.1,0,!0,"N"),this.outForce1_y=new l("Y方向",-1e3,1e3,.1,0,!0,"N"),this.outForce1_x.canBeAny=!0,this.outForce1_y.canBeAny=!0,this.outForce1_delay=new _(0,10,"起止时间","s"),this.outForce1_arr=[];var v=new s("显示图像","",0,"icon_xianshituxiang_pressed.png",!1),z=new s("显示","",1,"icon_xianshi_pressed.png"),y=new s("参数","",2,"icon_caizhi_pressed.png"),f=new s("速度","",3,"icon_sudu_pressed.png"),m=new s("添加外力","",4,"icon_power_pressed.png");this.secondData=[],this.secondData.index=0,this.compList=[this.firstDropTitle,v,z,y,f,m],v.on("click",function(){u.main.emit(u.EVENT_SHOW_PLOT,{element:c.body})}),z.on("click",function(){c.secondData.splice(0),c.secondData.index=1,"WoodBoard"===c.body.typeName||"WoodBlock"===c.body.typeName?c.secondData.push(c.motionHide,c.width,c.height,c.lockRotate,c.rotate,c.ifShowPhoto,c.ifShowPhone0):c.secondData.push(c.motionHide,c.angle,c.bottom,c.revertX,c.revertY,c.lockRotate,c.rotate,c.ifShowPhoto,c.ifShowPhone0)}),y.on("click",function(){c.secondData.splice(0),c.secondData.index=2,c.secondData.push(c.bodyM,c.bodyT,c.bodyC)}),f.on("click",function(){c.secondData.splice(0),c.secondData.index=3,c.secondData.push(c.xVelocity,c.yVelocity,c.dVelocity,c.oVelocity,new o(null,!1,!0),new o("可视化",!0),c.ifShowForce,c.ifShowVol,c.ifShowAVol,c.showValueSetingButton)}),m.on("click",function(){c.secondData.splice(0),c.secondData.index=4,c.secondData.push(c.outForce0,c.outForce0_arr,new o,c.outForce1,c.outForce1_arr)}),"WoodBoard"===this.body.typeName||"WoodBlock"===this.body.typeName?(this.width.on("change",function(){c.width._showValue=Math.max(1,c.width.showValue),c.body.setWidth(u.Value2Pixel(c.width.showValue))}),this.height.on("change",function(){c.height._showValue=Math.max(1,c.height.showValue),c.body.setHeight(u.Value2Pixel(c.height.showValue))})):(this.angle.on("change",function(){c.body.setAngle(c.angle.value)}),this.bottom.on("change",function(){c.bottom._showValue=Math.max(1,c.bottom.showValue),c.body.setBottom(u.Value2Pixel(c.bottom.showValue))}),this.revertX.on("change",function(){c.body.setRevertX(c.revertX.checked)}),this.revertY.on("change",function(){c.body.setRevertY(c.revertY.checked)})),this.rotate.on("change",function(){c.body.setRotate(c.rotate.value/180*Math.PI)}),this.lockRotate.on("change",function(){c.body.lockRotate(c.lockRotate.checked)}),this.firstDropTitle.on("change",function(n){c.body.plotData.bodyName.title=c.firstDropTitle.bodyName}),this.ifShowPhoto.on("change",function(){c.ifShowPhone0.splice(0),c.ifShowPhoto.checked&&c.ifShowPhone0.push(c.showPhotoycle,c.ifShowPhotoTime)}),this.xPosition.on("change",function(){var n=u.Value2Pixel(c.xPosition.showValue),e=u.Value2Pixel(c.yPosition.showValue);c.body.setXY(n,e)}),this.yPosition.on("change",function(){var n=u.Value2Pixel(c.xPosition.showValue),e=u.Value2Pixel(c.yPosition.showValue);c.body.setXY(n,e)}),this.bodyM.on("change",function(){c.bodyM.showValue>0||(c.bodyM.showValue=c.bodyM.minValue),c.body.setMass(c.bodyM.showValue)}),this.bodyT.on("change",function(){c.body.setElasticity(c.bodyT.showValue)}),this.bodyC.on("change",function(){c.body.setFriction(c.bodyC.showValue)}),this.xVelocity.on("change",t),this.yVelocity.on("change",t),this.dVelocity.on("change",d),this.oVelocity.on("change",d),this.showValueSetingButton.on("click",function(){u.main.emit(u.SHOW_FORCE_SETTING)}),this.outForce0.on("change",function(){x.outForce0_arr.splice(0),x.outForce0.folded||x.outForce0_arr.push(x.outForce0_x,x.outForce0_y,x.outForce0_delay)}),this.outForce0_x.on("change",function(){x.body.outForce0.setxy(x.outForce0_x.showValue,x.outForce0_y.showValue)}),this.outForce0_y.on("change",function(){x.body.outForce0.setxy(x.outForce0_x.showValue,x.outForce0_y.showValue)}),this.outForce0_delay.on("change",function(){x.body.outForce0_delay[0]=x.outForce0_delay.start,x.body.outForce0_delay[1]=x.outForce0_delay.end}),this.outForce1.on("change",function(){x.outForce1_arr.splice(0),x.outForce1.folded||x.outForce1_arr.push(x.outForce1_x,x.outForce1_y,x.outForce1_delay)}),this.outForce1_x.on("change",function(){x.body.outForce1.setxy(x.outForce1_x.showValue,x.outForce1_y.showValue)}),this.outForce1_y.on("change",function(){x.body.outForce1.setxy(x.outForce1_x.showValue,x.outForce1_y.showValue)}),this.outForce1_delay.on("change",function(){x.body.outForce1_delay[0]=x.outForce1_delay.start,x.body.outForce1_delay[1]=x.outForce1_delay.end}),this.body.on("move",function(){var n=u.Pixel2Value(c.body.body.zpp_inner.posx),e=u.Pixel2Value(c.body.body.zpp_inner.posy);c.xPosition._showValue=n.toFixed(2),c.yPosition._showValue=e.toFixed(2);var t=u.Pixel2Value(c.body.width),i=u.Pixel2Value(c.body.height);c.width._showValue=t.toFixed(2),c.height._showValue=i.toFixed(2)})}return n.prototype.changeVScale=function(){this.body.setZSpeed(u.Value2Pixel(this.xVelocity.showValue),u.Value2Pixel(this.yVelocity.showValue))},n}()},629:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a,p){i(this,e);var s=l(this,n.call(this));return s.start=t,s.end=r,s.title=a||"",s.unit=p,s.typeName="IntervalItemData",s.noSave.push("title","unit"),s}return r(e,n),a(e,[{key:"title",get:function(){return s.getL(this._title)},set:function(n){this._title=n}},{key:"unit",get:function(){return this._unit},set:function(n){this._unit=n}},{key:"start",get:function(){return this._start},set:function(n){this._start=n,this.emit("change")}},{key:"end",get:function(){return this._end},set:function(n){this._end=n,this.emit("change")}}]),e}(p)},630:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(447);n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this));return r.typeName="ShapeList",r.list=t||[],r.selected=-1,r.noSave.push("list"),r}return r(e,n),a(e,[{key:"list",get:function(){return this._list||[]},set:function(n){this._list=n}},{key:"selected",get:function(){return this._selected},set:function(n){this._selected=n,this.emit("change")}},{key:"baseUrl",get:function(){return s.skinUrl}}]),e}(p)},631:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=(t(460),t(455));n.exports=function(n){function e(t,r,a){i(this,e);var s=l(this,n.call(this));return s.first=t,s.second=r,s.ifShowDis=a||!1,s.path=new p,s.text=new PIXI.Text("",{fontSize:48,fill:11184810,align:"center"}),s.addChild(s.path,s.text),s}return r(e,n),e.prototype.update=function(){var n={x:this.first.body.zpp_inner.posx,y:this.first.body.zpp_inner.posy},e={x:this.second.body.zpp_inner.posx,y:this.second.body.zpp_inner.posy};if(this.path.clear(),this.path.lineStyle(1,11184810),this.path.moveTo(n.x,n.y),this.path.lineTo(e.x,e.y),this.ifShowDis){var t=e.x-n.x,i=e.y-n.y,l=Math.sqrt(t*t+i*i),r=(n.x+e.x)/2,p=(n.y+e.y)/2,s=a.Pixel2Value(l);this.text.text="L="+(s>1e3||.001>s?s.toExponential(2):s.toFixed(2))+" m";var o=Math.atan2(i,t);o=o>-1.57&&1.57>o?o:o+Math.PI,this.text.rotation=o,this.text.scale.y=.25*a.COOR_DIRECTION_Y_N,this.text.scale.x=.25,this.text.x=r,this.text.y=p}},e.prototype.destroy=function(){this.first=null,this.second=null,this.path=null,this.text=null,n.prototype.destroy.call(this)},e}(PIXI.Container)},632:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=(t(496),t(447)),s=t(579),o=t(468),h=t(460),_=t(764);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.group=t,p.bodyCon.addChild(t.group),t.id=_.creat(),t.editResize=!1,t.baseData=null,t.asEquip=!0,t.showSvgEditor=0,t.dropPos=new o,t.adsorpPos=new o,t}return r(e,n),e.prototype.initAnchor=function(){return this.anchor=new s("#00ff00"),this.group.addChild(this.anchor),this.anchor},e.prototype.showAnchor=function(n){this.anchor&&this.anchor.show(n)},e.prototype.registSound=function(n){p.main.emit("RegistSound",{name:this.soundName,callBack:n})},e.prototype.playSound=function(){p.main.emit("PlaySound",{name:this.soundName})},e.prototype.show=function(n){this.visible=n},e.prototype.updateView=function(){this.removeChildren()},e.prototype.setLayar=function(){var n=["DampArea","UniformElecField","UniformMagnField","StraightTrack","ArcTrack","TElecFiled","TMagnField"],e=["ActionBody","GravitySource","PointCharge","ReferencePoint","WoodBoard","WoodBlock","WoodTriangle","Ground"],t=["LightRope","LightBar","LightSpring","FixedPulley","LightStator"],i=["Nail"];if(-1!=n.indexOf(this.typeName))for(var l=p.bodyCon.children,r=0;l.length>r;r++){var a=l[r];if(-1==n.indexOf(a.typeName)&&p.bodyCon.getChildIndex(this)>p.bodyCon.getChildIndex(a)){p.bodyCon.swapChildren(this.group,a);break}}if(-1!=e.indexOf(this.typeName))for(var l=p.bodyCon.children,r=0;l.length>r;r++){var a=l[r];if(-1!=t.indexOf(a.typeName)&&p.bodyCon.getChildIndex(this)>p.bodyCon.getChildIndex(a)){p.bodyCon.swapChildren(this.group,a);break}}if(-1!=t.indexOf(this.typeName))for(var l=p.bodyCon.children,r=0;l.length>r;r++){var a=l[r];if(-1!=i.indexOf(a.typeName)&&p.bodyCon.getChildIndex(this)>p.bodyCon.getChildIndex(a)){p.bodyCon.swapChildren(this.group,a);break}}},e.prototype.changeViewByEditor=function(n,e,t){},e.prototype.getBoundsBox=function(){return null},e.prototype.changeBorderValue=function(n,e,t){var i;if("end"===e)i=this.adsorpValue(n.showValue);else{i=n.showValue+p.Pixel2Value(e/p.STAGE_SCALE)*t}n.showValue=i},e.prototype.adsorpValue=function(n){var e=n;if(!p.ADSORP_TO_GRID||0===p.GRID_SPACE)return e;var t=p.Value2Pixel(e),i=Math.round(t/p.GRID_SPACE)*p.GRID_SPACE;return e=p.Pixel2Value(i)},e.prototype.destroy=function(){this.body&&(this.body.get_userData().view=null,this.body.get_userData()["class"]=null,this.body.set_space(null)),this.baseData&&(this.baseData.body&&(this.baseData.body=null),this.baseData=null),n.prototype.destroy.call(this)},e.prototype.getData=function(){return this.baseData},e.prototype.setData=function(n){p.setItemDataFromData(this.baseData,n)},e.prototype.pathToGraphics=function(n,e){h.pathToGraphics(n,e)},e.prototype.getPhoto=function(){var n=new PIXI.Container;return this.cloneData(this,n),this.cloneDisplay(this,n),n},e.prototype.cloneDisplay=function(n,e){for(var t=0;n.children.length>t;t++){var i=n.children[t],l=void 0;if(!i.text){if(i.hasOwnProperty("graphicsData")){var r=i.clone();e.addChild(r),l=r}else if("sprite"==i.pluginName||"tilingSprite"==i.pluginName){var a=new PIXI.Sprite(i.texture.clone());e.addChild(a),l=a}else if(i.children&&i.children.length>0){var p=new PIXI.Container;e.addChild(p),l=p}this.cloneData(i,l),i.children&&i.children.length>0&&this.cloneDisplay(i,l)}}},e.prototype.cloneData=function(n,e){e.x=n.x,e.y=n.y,e.rotation=n.rotation,e.scale.copy(n.scale),e.pivot.copy(n.pivot),e.width=n.width,e.height=n.height},a(e,[{key:"typeName",get:function(){return this._typeName},set:function(n){this._typeName=n,this.setLayar()}},{key:"id",get:function(){return this._id},set:function(n){this._id=n}},{key:"editResize",get:function(){return this._editResize||!1},set:function(n){this._editResize=n}},{key:"soundName",get:function(){return this._soundName||""},set:function(n){this._soundName=n}}]),e}(PIXI.Container)},633:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(460),s=t(447),o=t(716),h=t(455);n.exports=function(n){function e(t,r,a,p,h){i(this,e);var _=l(this,n.call(this));_.typeName="UniformElecField";var u=s.Body,d=s.BodyType,c=s.Vec2,x=s.space,v=s.Polygon;_.area={rect:{w:a||200,h:p||200},circle:{r:100}},_.editResize=!0,_.showSvgEditor=1,_.shapeType=0,_.angle=h||0;var z=_.angle/180*Math.PI;_.velocity=c.get(Math.cos(z),Math.sin(z)),_.E=1,_.lineSpace=21,_.container=new PIXI.Container,_.addChild(_.container),_.initAnchor(),_.anchor.dragUtil.initDragCircleArea(),_.anchor.dragUtil.on("moveInCircle",function(n){var e=n.angle%15;(5>e||e>10)&&(_.angle=15*Math.round(n.angle/15),_.baseData.angle.value=_.angle)}),_.anchor.dragUtil.on("end",function(n){_.anchorAlign()}),_.showAnchor(!1),_.body=new u(d.get_KINEMATIC()),_.body.set_space(x);var y=new v(v.rect(0,0,_.area.rect.w,_.area.rect.h));return y.set_sensorEnabled(!0),_.body.get_shapes().add(y),_.body.set_allowRotation(!1),_.body.get_userData().view=_.group,_.body.dragEndStatic=!0,_.updateView(),_.setXY(t||0,r||0),_.baseData=new o(_),_}return r(e,n),e.prototype.showAnchor=function(n){this.anchor&&(this.anchor.show(n),n&&this.anchorAlign())},e.prototype.contains=function(n,e){return this.body.contains(s.Vec2.get(n,e))},e.prototype.anchorAlign=function(){var n=Math.min(this.area.rect.w,this.area.rect.h)/4,e=this.angle/180*Math.PI,t=Math.cos(e)*n+this.area.rect.w/2,i=Math.sin(e)*n+(0==this.shapeType?this.area.rect.h:this.area.rect.w)/2;this.anchor.x=t,this.anchor.y=i},e.prototype.changeViewByEditor=function(n,e,t){this.setXY(n.x,n.y),this.setWH(e,t),this.setAdsorpPos(),this.emit("move"),s.main.emit(s.CHANGE_SVG_EDITOR_TYPE,{ele:this})},e.prototype.getBoundsBox=function(){return 0==this.shapeType?{x:0,y:0,width:this.area.rect.w,height:this.area.rect.h}:{x:0,y:0,width:2*this.area.circle.r,height:2*this.area.circle.r}},e.prototype.setAngle=function(n){this.angle=n,this.updateView();var e=this.angle/180*Math.PI;this.velocity.setxy(Math.cos(e),Math.sin(e))},e.prototype.setStrength=function(n){this.E=n,this.updateView()},e.prototype.getStrength=function(){var n=this.baseData.getEStrength();return 0>n*this.E&&(this.E=n,this.updateView()),n},e.prototype.setShape=function(n){this.shapeType=n,this.showSvgEditor=0==n?1:3,this.setWH(),this.setAdsorpPos(),s.main.emit(s.CHANGE_SVG_EDITOR_TYPE,{ele:this})},e.prototype.setWH=function(n,e){this.area.rect.w=n||this.area.rect.w,this.area.rect.h=e||this.area.rect.h,this.area.circle.r=this.area.rect.w/2,this.updateView(),this.updataBody(),this.anchorAlign()},e.prototype.updataBody=function(){this.body.get_shapes().clear();var n=void 0;0==this.shapeType?n=new s.Polygon(s.Polygon.rect(0,0,this.area.rect.w,this.area.rect.h)):(n=new s.Circle(this.area.circle.r),n.get_localCOM().setxy(this.area.circle.r,this.area.circle.r)),n.set_sensorEnabled(!0),this.body.get_shapes().add(n)},e.prototype.setAdsorpPos=function(){0==this.shapeType?this.adsorpPos.set(0,0):this.adsorpPos.set(this.area.circle.r,this.area.circle.r)},e.prototype.updateView=function(){function n(n,e){var i=n-c,p=e-c,s=i*i+p*p;if(0>z*z-s)return!1;var o=Math.sqrt(z*z-s),h={x:n-r*o,y:e-a*o},_={x:n+r*o,y:e+a*o},u="M"+h.x+","+h.y+"L"+_.x+","+_.y;return l.moveTo(h.x,h.y),l.lineTo(_.x,_.y),[u,t(r,a,_.x,_.y)]}function e(n,e){var i=p.segmentsIntr,s=p.getPointDistance,o=[],h={x:0,y:0},u={x:_.area.rect.w,y:0},c={x:_.area.rect.w,y:_.area.rect.h},x={x:0,y:_.area.rect.h},v={x:n-r*d,y:e-a*d},z={x:n+r*d,y:e+a*d},y=i(v,z,h,u),f=i(v,z,u,c),m=i(v,z,c,x),b=i(v,z,x,h);if(y&&o.push(y),f&&o.push(f),m&&o.push(m),b&&o.push(b),2>o.length)return!1;if(10>s(o[0],o[1]))return!1;var g=Math.round(o[1].x-o[0].x),w=Math.round(o[1].y-o[0].y),C={x:0,y:0},M={x:0,y:0};0>g*r||0>w*a?(C=o[0],M=o[1]):(C=o[1],M=o[0]),M.x=Math.floor(M.x),M.y=Math.floor(M.y),C.x=Math.floor(C.x),C.y=Math.floor(C.y);new Snap.Matrix(r,a,-a,r,C.x,C.y);l.moveTo(C.x,C.y);var k="M"+C.x+","+C.y+t(r,a,C.x,C.y),O="M"+M.x+","+M.y+"L"+C.x+","+C.y;return l.moveTo(M.x,M.y),l.lineTo(C.x,C.y),[O,k]}function t(n,e,t,i){var r=10*n,a=10*e,p=4*Math.PI/5,s=Math.cos(p),o=Math.sin(p),h=r*s-a*o+t,_=r*o+a*s+i,u=Math.cos(-p),d=Math.sin(-p),c=r*u-a*d+t,x=r*d+a*u+i;return l.moveTo(t,i),l.lineTo(h,_),l.moveTo(t,i),l.lineTo(c,x),"M"+t+","+i+"L"+h+","+_+"M"+t+","+i+"L"+c+","+x}this.container.removeChildren();var i=new h;this.container.addChild(i),i.lineStyle(1,36607,1),i.beginFill(36607,.2),0==this.shapeType?i.drawRect(0,0,this.area.rect.w,this.area.rect.h):i.drawCircle(this.area.circle.r,this.area.circle.r,this.area.circle.r),i.endFill(),this.lineSpace=Math.max(5,Math.min(21-15*(this.E-.1)/100,21));var l=new h;l.lineStyle(1,36607,1),this.container.addChild(l);var r,a,s,o,_=this,u=this.E>0?this.angle:this.angle+180,d=Math.max(this.area.rect.w,this.area.rect.h),c=this.area.rect.w/2,x=(0==this.shapeType?this.area.rect.h:this.area.rect.w)/2,v=this.lineSpace,z=this.area.circle.r,y=0==this.shapeType?e:n,f=(function(){u%=360;var n=u/180*Math.PI;r=Math.cos(n),a=Math.sin(n),s=Math.cos(n+Math.PI/2),o=Math.sin(n+Math.PI/2);for(var e="",t="",i=0;;){var l=y(c+s*i*v,x+o*i*v);l&&(e+=l[0],t+=l[1]);var p=y(c-s*i*v,x-o*i*v);if(p&&(e+=p[0],t+=p[1]),!l||!p)break;if(++i>100)break}}(),Math.min(c,x)/2);this.anchor.dragUtil.dragCircleArea.set(c,x,f,!0)},e}(a)},634:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(460),o=t(721),h=t(455);n.exports=function(n){function e(t,r,a,s,h){i(this,e);var _=l(this,n.call(this));_.typeName="UniformMagnField";var u=p.Body,d=p.BodyType;return _.tx=t||0,_.ty=r||0,_.tw=a||200,_.th=s||200,_.shapeType=h||0,_.B=1,_.circleStart=0,_.circleEnd=360,_.editResize=!1,_.showSvgEditor=1,_.type=-1,_.area={rect:{x:0,y:0,w:0,h:0},fan:{r:0,a1:0,a2:2*Math.PI,isCircle:!0}},_.body=new u(d.get_KINEMATIC()),_.body.get_userData().view=_.group,_.body.dragEndStatic=!0,_.setShape(_.shapeType),_.setType(_.type),_.setXY(_.tx,_.ty),_.setWH(_.tw,_.th),_.baseData=new o(_),_}return r(e,n),e.prototype.changeViewByEditor=function(n,e,t){this.setXY(n.x,n.y),this.setWH(e,t),this.emit("move")},e.prototype.getBoundsBox=function(){return{x:0,y:0,width:this.tw,height:this.th}},e.prototype.getStrength=function(){var n=this.baseData.getEStrength();return 0>n*this.B&&(this.B=n,this.type=this.B>0?-1:1,this.updateView()),Math.abs(n)},e.prototype.changeStrength=function(n){this.B=n,this.updateView()},e.prototype.setType=function(n){this.type=-1==n||0==n?-1:1,this.updateView()},e.prototype.getType=function(){return this.type},e.prototype.setShape=function(n){this.shapeType=n,this.updateView(),this.showSvgEditor=0==n?1:3,p.main.emit(p.CHANGE_SVG_EDITOR_TYPE,{ele:this}),this.setAdsorpPos()},e.prototype.setWH=function(n,e){"number"==typeof n&&(this.tw=n,this.th=e||n,1==this.shapeType&&(this.th=this.tw),this.area.rect.w=this.tw,this.area.rect.h=this.th,this.area.fan.r=this.tw/2,this.updateView())},e.prototype.setAngle=function(n,e){this.circleStart=n,this.circleEnd=e;var t=Math.min(this.circleStart,this.circleEnd),i=Math.max(this.circleStart,this.circleEnd);this.area.fan.a1=t/180*Math.PI,this.area.fan.a2=i/180*Math.PI,this.updateView()},e.prototype.updateView=function(){n.prototype.updateView.call(this);var e=new h;this.addChild(e),e.lineStyle(1,s.hexTo64("#3888c0"),1),e.beginFill(s.hexTo64("#3888c0"),.2);if(0==this.shapeType)e.moveTo(0,0),e.lineTo(this.tw,0),e.lineTo(this.tw,this.th),e.lineTo(0,this.th),e.closePath();else{var t=this.area.fan.a1,i=this.area.fan.a2,l=this.area.fan.r;+(i-t)==2*Math.PI?(e.arc(l,l,l,0,2*Math.PI),this.area.fan.isCircle=!0):(e.moveTo(l,l),e.arc(l,l,l,t,i),e.closePath(),this.area.fan.isCircle=!1)}e.endFill();var r=new h;r.lineStyle(1,s.hexTo64("#3888c0"),1),r.beginFill(3705024),this.addChild(r);var a=0;1>this.B&&(a=(this.B-1)/.99*5),this.B>1&&(a=(Math.min(this.B,100)-1)/99*5);for(var p=20-2*a,o=0;this.tw/p>o;o++)for(var _=0;this.th/p>_;_++){var u=o*p+10,d=_*p+10;-1==this.type?(r.moveTo(u-5,d-5),r.lineTo(u+5,d+5),r.moveTo(u+5,d-5),r.lineTo(u-5,d+5)):r.drawCircle(u,d,2)}var c=e.clone();this.addChild(c),r.mask=c},e.prototype.setAdsorpPos=function(){0==this.shapeType?this.adsorpPos.set(0,0):this.adsorpPos.set(this.tw/2,this.tw/2)},e.prototype.contains=function(n,e){var t=!1,i=this.body.zpp_inner.posx,l=this.body.zpp_inner.posy;if(0===this.shapeType)t=!(i>n||n>i+this.tw||l>e||e>l+this.th);else{var r=i+this.area.fan.r,a=l+this.area.fan.r;if(this.area.fan.r>=Math.sqrt(Math.pow(n-r,2)+Math.pow(e-a,2)))if(this.area.fan.isCircle)t=!0;else{var p=Math.atan2(e-a,n-r);0>p&&(p+=2*Math.PI),this.area.fan.a1>p||p>this.area.fan.a2||(t=!0)}}return t},e}(a)},635:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(520),p=t(447),s=(t(460),t(495)),o=t(455),h=t(627);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.points=[],t.shape=new o,t.addChild(t.shape),t.material=new p.Material.wood,t.body.set_space(p.space);var r=new p.Polygon([],t.material);return t.body.get_shapes().add(r),t.body.get_userData().view=t.group,t.body.set_mass(t.M),t.body.get_cbTypes().add(p.BODY_CB_TYPE),t.checkMove(),t.setElasticity(t.material.get_elasticity()),t.setFriction(t.material.get_staticFriction()),t.wood=new PIXI.extras.TilingSprite(PIXI.Texture.fromImage(p.woodSkin)),t.addChild(t.wood),t.plotData=new h(t),t}return r(e,n),e.prototype.lockRotate=function(n){this.allowRotate=!n,this.body.set_allowRotation(this.allowRotate)},e.prototype.setRotate=function(e){n.prototype.setRotate.call(this,e),this.setAdsorpPos()},e.prototype.resetBody=function(){this.points.splice(0),this.points.push({x:-this.w/2,y:-this.h/2},{x:this.w/2,y:-this.h/2},{x:this.w/2,y:this.h/2},{x:-this.w/2,y:this.h/2}),this.wood.x=-this.w/2,this.wood.y=-this.h/2,this.wood.width=this.w,this.wood.height=this.h,this.setShape(),this.setAdsorpPos()},e.prototype.setAdsorpPos=function(){var n=Math.sin(this.rotate),e=Math.cos(this.rotate),t=this.w/2,i=this.h/2;this.adsorpPos.x=t*e-i*n,this.adsorpPos.y=t*n+i*e},e.prototype.setShape=function(){this.shape.clear(),this.shape.beginFill(1118481);for(var n=[],e=0;this.points.length>e;e++){var t=this.points[e];0==e?this.shape.moveTo(t.x,t.y):this.shape.lineTo(t.x,t.y);n.push(p.Vec2.weak(t.x,t.y))}this.shape.closePath(),this.body.get_shapes().clear();var i=new p.Polygon(n,this.material);this.body.get_shapes().add(i),s.setAllLayer(this.body)},e.prototype.updateShow=function(){n.prototype.updateShow.call(this),this.plotData.updataImage()},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.plotData.destroy(),this.plotData=null},e}(a)},636:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=(t(490),t(520)),s=t(720),o=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.asEquip=!1,t.bShape=new a.Circle(5),t.bShape.set_sensorEnabled(!0),t.body.get_shapes().add(t.bShape),t.body.set_space(a.space),t.body.get_userData().view=t.group,t.headShape=new o,t.headShape.beginFill(16711680,.5),t.headShape.drawCircle(0,0,5),t.headShape.endFill(),t.group.addChild(t.headShape),t.dragUtil.on("end",function(n){var e=a.getBodyUnderMouse({x:t.x,y:t.y},a.woodElements),i=e?e.get_userData()["class"]:null;t.emit("change",{value:i}),a.main.emit(a.ELEMENT_MOVE_END)}),t.baseData=new s(t),t}return r(e,n),e.prototype.updateShow=function(){},e.prototype.destroy=function(){n.prototype.destroy.call(this)},e}(p)},637:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();n.exports=function(){function n(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,l=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,r=arguments.length>3&&arguments[3]!==undefined&&arguments[3];i(this,n),this.cx=e,this.cy=t,this.r=l,this.onCircle=r,this.type="CircleArea"}return l(n,[{key:"onCircle",get:function(){return this._onCircle},set:function(n){this._onCircle=n}},{key:"r",get:function(){return this._r},set:function(n){this._r=n}},{key:"cy",get:function(){return this._cy},set:function(n){this._cy=n}},{key:"cx",get:function(){return this._cx},set:function(n){this._cx=n}},{key:"type",get:function(){return this._type},set:function(n){this._type=n}}]),n.prototype.set=function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,t=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,i=arguments.length>3&&arguments[3]!==undefined&&arguments[3];this.cx=n,this.cy=e,this.r=t,this.onCircle=i},n}()},688:function(n,e,t){"use strict";n.exports=t(707)},689:function(n,e,t){"use strict";var i=t(465);i.nape.NbBody=t(624),i.nape.NbSpace=t(692),i.nape.NbCircle=t(691),i.nape.BodyVo=t(623),i.nape.NbAngleJoint=t(693),i.nape.NbDistanceJoint=t(694),i.nape.NbLineJoint=t(695),i.nape.NbPivotJoint=t(696),i.nape.NbPulleyJoint=t(697),i.nape.NbRubberJoint=t(698),i.nape.NbSpringJoint=t(699),i.nape.NbWeldJoint=t(700),i.nape.geom.LDMath=t(626),i.nape.shape.LiquidShape=t(704),i.nape.shape.CircleBase=t(518),i.nape.shape.PourShape=t(705),i.nape.shape.PourPosShape=t(625),i.nape.shape.HockShapeBase=t(703),i.nape.shape.HitShape=t(702),i.nape.phys.LiquidDrop=t(701),n.exports={nape:i.nape}},690:function(n,e,t){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};n.exports=function(n){function e(n,e){function t(){}t.prototype=n;var i=new t;for(var l in e)i[l]=e[l];return e.toString!==Object.prototype.toString&&(i.toString=e.toString),i}function t(n,e){if(null==e)return null;null==e.__id__&&(e.__id__=Vl++);var t;return null==n.hx__closures__?n.hx__closures__={}:t=n.hx__closures__[e.__id__],null==t&&(t=function(){return t.method.apply(t.scope,arguments)},t.scope=n,t.method=e,n.hx__closures__[e.__id__]=t),t}var l={},r=function(){return y.__string_rec(this,"")},a=function(){};l.HxOverrides=a,a.__name__=["HxOverrides"],a.dateStr=function(n){var e=n.getMonth()+1,t=n.getDate(),i=n.getHours(),l=n.getMinutes(),r=n.getSeconds();return n.getFullYear()+"-"+(10>e?"0"+e:""+e)+"-"+(10>t?"0"+t:""+t)+" "+(10>i?"0"+i:""+i)+":"+(10>l?"0"+l:""+l)+":"+(10>r?"0"+r:""+r)},a.strDate=function(n){switch(n.length){case 8:var e=n.split(":"),t=new Date;return t.setTime(0),t.setUTCHours(e[0]),t.setUTCMinutes(e[1]),t.setUTCSeconds(e[2]),t;case 10:var i=n.split("-");return new Date(i[0],i[1]-1,i[2],0,0,0);case 19:var l=n.split(" "),r=l[0].split("-"),a=l[1].split(":");return new Date(r[0],r[1]-1,r[2],a[0],a[1],a[2])}},a.cca=function(n,e){var t=n.charCodeAt(e);return t!=t?undefined:t},a.substr=function(n,e,t){return null!=e&&0!=e&&null!=t&&0>t?"":(null==t&&(t=n.length),0>e?0>(e=n.length+e)&&(e=0):0>t&&(t=n.length+t-e),n.substr(e,t))},a.indexOf=function(n,e,t){var i=n.length;for(0>t&&0>(t+=i)&&(t=0);i>t;){if(n[t]===e)return t;++t}return-1},a.lastIndexOf=function(n,e,t){var i=n.length;for(i>t?0>t&&(t+=i):t=i-1;t>=0;){if(n[t]===e)return t;--t}return-1},a.remove=function(n,e){var t=n.indexOf(e);return-1!=t&&(n.splice(t,1),!0)},a.iter=function(n){return{cur:0,arr:n,hasNext:function(){return this.arr.length>this.cur},next:function(){return this.arr[this.cur++]}}};var p=function(n,e){this.min=n,this.max=e};l.IntIterator=p,p.__name__=["IntIterator"],p.prototype={min:null,max:null,hasNext:function(){return this.max>this.min},next:function(){return this.min++},__class__:p};var s=function(){this.space=new le(new On(0,400)),this.init()};l.Main=s,s.__name__=["Main"],s.main=function(){new s},s.prototype={space:null,init:function(){var n=this,e=this.space;null==e.zpp_inner.wrap_gravity&&e.zpp_inner.getgravity();var t=e.zpp_inner.wrap_gravity,i=t.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=t.zpp_inner;if(null!=l._validate&&l._validate(),10!=t.zpp_inner.y){t.zpp_inner.y=10;var r=t.zpp_inner;null!=r._invalidate&&r._invalidate(r)}var a=t.zpp_inner;null!=a._validate&&a._validate();var p=this.space;p.zpp_inner.global_ang_drag=0;var s=this.space;s.zpp_inner.global_lin_drag=0,new v(200).run=function(){n.space.step(.016666666666666666,10,10)}},__class__:s},Math.__name__=["Math"];var o=function(){};l.Reflect=o,o.__name__=["Reflect"],o.hasField=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},o.field=function(n,e){try{return n[e]}catch(t){return null}},o.setField=function(n,e,t){n[e]=t},o.getProperty=function(n,e){var t;if(null==n)return null;var i;return n.__properties__?(t=n.__properties__["get_"+e],i=t):i=!1,i?n[t]():n[e]},o.setProperty=function(n,e,t){var i,l;n.__properties__?(i=n.__properties__["set_"+e],l=i):l=!1,l?n[i](t):n[e]=t},o.callMethod=function(n,e,t){return e.apply(n,t)},o.fields=function(n){var e=[];if(null!=n){var t=Object.prototype.hasOwnProperty;for(var i in n)"__id__"!=i&&"hx__closures__"!=i&&t.call(n,i)&&e.push(i)}return e},o.isFunction=function(n){return"function"==typeof n&&!(n.__name__||n.__ename__)},o.compare=function(n,e){return n==e?0:n>e?1:-1},o.compareMethods=function(n,e){return n==e||!(!o.isFunction(n)||!o.isFunction(e))&&(n.scope==e.scope&&n.method==e.method&&null!=n.method)},o.isObject=function(n){if(null==n)return!1;var e=void 0===n?"undefined":i(n);return"string"==e||"object"==e&&null==n.__enum__||"function"==e&&null!=(n.__name__||n.__ename__)},o.isEnumValue=function(n){return null!=n&&null!=n.__enum__},o.deleteField=function(n,e){return!!Object.prototype.hasOwnProperty.call(n,e)&&(delete n[e],!0)},o.copy=function(n){for(var e={},t=0,i=o.fields(n);i.length>t;){var l=i[t];++t,e[l]=o.field(n,l)}return e},o.makeVarArgs=function(n){return function(){var e=Array.prototype.slice.call(arguments);return n(e)}};var h=function(){};l.Std=h,h.__name__=["Std"],h.is=function(n,e){return y.__instanceof(n,e)},h.instance=function(n,e){return n instanceof e?n:null},h.string=function(n){return y.__string_rec(n,"")},h["int"]=function(n){return 0|n},h.parseInt=function(n){var e=parseInt(n,10);return 0!=e||120!=a.cca(n,1)&&88!=a.cca(n,1)||(e=parseInt(n)),isNaN(e)?null:e},h.parseFloat=function(n){return parseFloat(n)},h.random=function(n){return n>0?Math.floor(Math.random()*n):0};var _=function(){};l.StringTools=_,_.__name__=["StringTools"],_.urlEncode=function(n){return encodeURIComponent(n)},_.urlDecode=function(n){return decodeURIComponent(n.split("+").join(" "))},_.htmlEscape=function(n,e){return n=n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;"),e?n.split('"').join("&quot;").split("'").join("&#039;"):n},_.htmlUnescape=function(n){return n.split("&gt;").join(">").split("&lt;").join("<").split("&quot;").join('"').split("&#039;").join("'").split("&amp;").join("&")},_.startsWith=function(n,e){return n.length>=e.length&&a.substr(n,0,e.length)==e},_.endsWith=function(n,e){var t=e.length,i=n.length;return i>=t&&a.substr(n,i-t,t)==e},_.isSpace=function(n,e){var t=a.cca(n,e);return t>8&&14>t||32==t},_.ltrim=function(n){for(var e=n.length,t=0;e>t&&_.isSpace(n,t);)++t;return t>0?a.substr(n,t,e-t):n},_.rtrim=function(n){for(var e=n.length,t=0;e>t&&_.isSpace(n,e-t-1);)++t;return t>0?a.substr(n,0,e-t):n},_.trim=function(n){return _.ltrim(_.rtrim(n))},_.lpad=function(n,e,t){if(0>=e.length)return n;for(;t>n.length;)n=e+n;return n},_.rpad=function(n,e,t){if(0>=e.length)return n;for(;t>n.length;)n+=e;return n},_.replace=function(n,e,t){return n.split(e).join(t)},_.hex=function(n,e){for(var t="",i="0123456789ABCDEF";;)if(t=i.charAt(15&n)+t,(n>>>=4)<=0)break;if(null!=e)for(;e>t.length;)t="0"+t;return t},_.fastCodeAt=function(n,e){return n.charCodeAt(e)},_.isEof=function(n){return n!=n};var u=l.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};u.TNull=["TNull",0],u.TNull.toString=r,u.TNull.__enum__=u,u.TInt=["TInt",1],u.TInt.toString=r,u.TInt.__enum__=u,u.TFloat=["TFloat",2],u.TFloat.toString=r,u.TFloat.__enum__=u,u.TBool=["TBool",3],u.TBool.toString=r,u.TBool.__enum__=u,u.TObject=["TObject",4],u.TObject.toString=r,u.TObject.__enum__=u,u.TFunction=["TFunction",5],u.TFunction.toString=r,u.TFunction.__enum__=u,u.TClass=function(n){var e=["TClass",6,n];return e.__enum__=u,e.toString=r,e},u.TEnum=function(n){var e=["TEnum",7,n];return e.__enum__=u,e.toString=r,e},u.TUnknown=["TUnknown",8],u.TUnknown.toString=r,u.TUnknown.__enum__=u,u.__empty_constructs__=[u.TNull,u.TInt,u.TFloat,u.TBool,u.TObject,u.TFunction,u.TUnknown];var d=function(){};l.Type=d,d.__name__=["Type"],d.getClass=function(n){return null==n?null:y.getClass(n)},d.getEnum=function(n){return null==n?null:n.__enum__},d.getSuperClass=function(n){return n.__super__},d.getClassName=function(n){var e=n.__name__;return null==e?null:e.join(".")},d.getEnumName=function(n){return n.__ename__.join(".")},d.resolveClass=function(n){var e=l[n];return null!=e&&e.__name__?e:null},d.resolveEnum=function(n){var e=l[n];return null!=e&&e.__ename__?e:null},d.createInstance=function(n,e){switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);case 6:return new n(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case 8:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7])}},d.createEmptyInstance=function(n){function e(){}return e.prototype=n.prototype,new e},d.createEnum=function(n,e,t){var i=o.field(n,e);return o.isFunction(i)?i.apply(n,t):i},d.createEnumIndex=function(n,e,t){var i=n.__constructs__[e];return d.createEnum(n,i,t)},d.getInstanceFields=function(n){var e=[];for(var t in n.prototype)e.push(t);return a.remove(e,"__class__"),a.remove(e,"__properties__"),e},d.getClassFields=function(n){var e=o.fields(n);return a.remove(e,"__name__"),a.remove(e,"__interfaces__"),a.remove(e,"__properties__"),a.remove(e,"__super__"),a.remove(e,"__meta__"),a.remove(e,"prototype"),e},d.getEnumConstructs=function(n){return n.__constructs__.slice()},d["typeof"]=function(n){switch(void 0===n?"undefined":i(n)){case"boolean":return u.TBool;case"function":return n.__name__||n.__ename__?u.TObject:u.TFunction;case"number":return Math.ceil(n)==n%2147483648?u.TInt:u.TFloat;case"object":if(null==n)return u.TNull;var e=n.__enum__;if(null!=e)return u.TEnum(e);var t=y.getClass(n);return null!=t?u.TClass(t):u.TObject;case"string":return u.TClass(String);case"undefined":return u.TNull;default:return u.TUnknown}},d.enumEq=function(n,e){if(n==e)return!0;try{if(n[0]!=e[0])return!1;for(var t=2,i=n.length;i>t;){var l=t++;if(!d.enumEq(n[l],e[l]))return!1}var r=n.__enum__;if(r!=e.__enum__||null==r)return!1}catch(a){return!1}return!0},d.enumConstructor=function(n){return n[0]},d.enumParameters=function(n){return n.slice(2)},d.enumIndex=function(n){return n[1]},d.allEnums=function(n){return n.__empty_constructs__};var c=function(){};l["haxe.IMap"]=c,c.__name__=["haxe","IMap"],c.prototype={get:null,set:null,exists:null,remove:null,keys:null,iterator:null,toString:null,__class__:c};var x=function(){};l["haxe.Log"]=x,x.__name__=["haxe","Log"],x.trace=function(n,e){y.__trace(n,e)},x.clear=function(){y.__clear_trace()};var v=function(n){var e=this;this.id=setInterval(function(){e.run()},n)};l["haxe.Timer"]=v,v.__name__=["haxe","Timer"],v.delay=function(n,e){var t=new v(e);return t.run=function(){t.stop(),n()},t},v.measure=function(n,e){var t=v.stamp(),i=n();return x.trace(v.stamp()-t+"s",e),i},v.stamp=function(){return(new Date).getTime()/1e3},v.prototype={id:null,stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:v};var z=function ql(n){Error.call(this),this.val=n,this.message=n+"",Error.captureStackTrace&&Error.captureStackTrace(this,ql)};l["js._Boot.HaxeError"]=z,z.__name__=["js","_Boot","HaxeError"],z.__super__=Error,z.prototype=e(Error.prototype,{val:null,__class__:z});var y=function(){};l["js.Boot"]=y,y.__name__=["js","Boot"],y.__unhtml=function(n){return n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},y.__trace=function(n,e){var t=null!=e?e.fileName+":"+e.lineNumber+": ":"";if(t+=y.__string_rec(n,""),null!=e&&null!=e.customParams)for(var i=0,l=e.customParams;l.length>i;){var r=l[i];++i,t+=","+y.__string_rec(r,"")}var a,p;"undefined"!=typeof document?(a=document.getElementById("haxe:trace"),p=null!=a):p=!1,p?a.innerHTML+=y.__unhtml(t)+"<br/>":"undefined"!=typeof console&&console},y.__clear_trace=function(){var n=document.getElementById("haxe:trace");null!=n&&(n.innerHTML="")},y.isClass=function(n){return n.__name__},y.isEnum=function(n){return n.__ename__},y.getClass=function(n){if(n instanceof Array&&null==n.__enum__)return Array;var e=n.__class__;if(null!=e)return e;var t=y.__nativeClassName(n);return null!=t?y.__resolveNativeClass(t):null},y.__string_rec=function(n,e){if(null==n)return"null";if(e.length>=5)return"<...>";var t=void 0===n?"undefined":i(n);switch("function"==t&&(n.__name__||n.__ename__)&&(t="object"),t){case"function":return"<function>";case"object":if(n instanceof Array){if(n.__enum__){if(2==n.length)return n[0];var l=n[0]+"(";e+="\t";for(var r=2,a=n.length;a>r;){var p=r++;l+=2!=p?","+y.__string_rec(n[p],e):y.__string_rec(n[p],e)}return l+")"}var s=n.length,o="[";e+="\t";for(var h=0,_=s;_>h;){var u=h++;o+=(u>0?",":"")+y.__string_rec(n[u],e)}return o+="]"}var d;try{d=n.toString}catch(f){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d){var c=""+n;if("[object Object]"!=c)return c}var x=null,v="{\n";e+="\t";var z=null!=n.hasOwnProperty;for(var x in n)z&&!n.hasOwnProperty(x)||"prototype"!=x&&"__class__"!=x&&"__super__"!=x&&"__interfaces__"!=x&&"__properties__"!=x&&(2!=v.length&&(v+=", \n"),v+=e+x+" : "+y.__string_rec(n[x],e));return e=e.substring(1),v+="\n"+e+"}";case"string":return n;default:return n+""}},y.__interfLoop=function(n,e){if(null==n)return!1;if(n==e)return!0;var t=n.__interfaces__;if(null!=t)for(var i=0,l=t.length;l>i;){var r=i++,a=t[r];if(a==e||y.__interfLoop(a,e))return!0}return y.__interfLoop(n.__super__,e)},y.__instanceof=function(n,e){if(null==e)return!1;switch(e){case Array:return n instanceof Array&&null==n.__enum__;case jl:return"boolean"==typeof n;case Nl:return!0;case Dl:return"number"==typeof n;case Ll:return(0|n)===n;case String:return"string"==typeof n;default:if(null==n)return!1;if("function"==typeof e){if(n instanceof e)return!0;if(y.__interfLoop(y.getClass(n),e))return!0}else if("object"==(void 0===e?"undefined":i(e))&&y.__isNativeObj(e)&&n instanceof e)return!0;return e==Fl&&null!=n.__name__||(e==Bl&&null!=n.__ename__||n.__enum__==e)}},y.__cast=function(n,e){if(y.__instanceof(n,e))return n},y.__nativeClassName=function(n){var e=y.__toStr.call(n).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},y.__isNativeObj=function(n){return null!=y.__nativeClassName(n)},y.__resolveNativeClass=function(n){return Function("return typeof "+n+' != "undefined" ? '+n+" : null")()};var f=function(){};l["nape.Config"]=f,f.__name__=["nape","Config"],f.prototype={__class__:f};var m=function(){this.zpp_inner=null};l["nape.callbacks.Callback"]=m,m.__name__=["nape","callbacks","Callback"],m.prototype={zpp_inner:null,get_event:function(){return fe.events[this.zpp_inner.event]},get_listener:function(){return this.zpp_inner.listener.outer},toString:function(){return""},__class__:m,__properties__:{get_listener:"get_listener",get_event:"get_event"}};var b=function(){m.call(this)};l["nape.callbacks.BodyCallback"]=b,b.__name__=["nape","callbacks","BodyCallback"],b.__super__=m,b.prototype=e(m.prototype,{get_body:function(){return this.zpp_inner.body.outer},toString:function(){var n="Cb:";return n+=["WAKE","SLEEP"][this.zpp_inner.event-ye.id_CbEvent_WAKE],n+=":"+this.zpp_inner.body.outer,n+=" : listener: "+h.string(this.zpp_inner.listener.outer)},__class__:b,__properties__:e(m.prototype.__properties__,{get_body:"get_body"})});var g=function(){this.zpp_inner=null};l["nape.callbacks.Listener"]=g,g.__name__=["nape","callbacks","Listener"],g.prototype={zpp_inner:null,get_type:function(){return fe.types[this.zpp_inner.type]},get_event:function(){return fe.events[this.zpp_inner.event]},set_event:function(n){if(fe.events[this.zpp_inner.event]!=n){var e;null==ye.CbEvent_BEGIN&&(ye.internal=!0,ye.CbEvent_BEGIN=new C,ye.internal=!1),n==ye.CbEvent_BEGIN?e=ye.id_CbEvent_BEGIN:(null==ye.CbEvent_ONGOING&&(ye.internal=!0,ye.CbEvent_ONGOING=new C,ye.internal=!1),n==ye.CbEvent_ONGOING?e=ye.id_CbEvent_ONGOING:(null==ye.CbEvent_END&&(ye.internal=!0,ye.CbEvent_END=new C,ye.internal=!1),n==ye.CbEvent_END?e=ye.id_CbEvent_END:(null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1),n==ye.CbEvent_SLEEP?e=ye.id_CbEvent_SLEEP:(null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1),n==ye.CbEvent_WAKE?e=ye.id_CbEvent_WAKE:(null==ye.CbEvent_PRE&&(ye.internal=!0,ye.CbEvent_PRE=new C,ye.internal=!1),e=n==ye.CbEvent_PRE?ye.id_CbEvent_PRE:ye.id_CbEvent_BREAK))))),this.zpp_inner.swapEvent(e)}return fe.events[this.zpp_inner.event]},get_precedence:function(){return this.zpp_inner.precedence},set_precedence:function(n){return this.zpp_inner.precedence!=n&&(this.zpp_inner.precedence=n,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=n){var e=n.zpp_inner.wrap_listeners;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){var n=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(this.zpp_inner.type==ye.id_ListenerType_BODY){return"BodyListener{"+n+"::"+h.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}"}if(this.zpp_inner.type==ye.id_ListenerType_CONSTRAINT){return"ConstraintListener{"+n+"::"+h.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}"}var e,t=this.zpp_inner.interaction,i=t.itype;i==ye.id_InteractionType_COLLISION?e="COLLISION":e=i==ye.id_InteractionType_SENSOR?"SENSOR":i==ye.id_InteractionType_FLUID?"FLUID":"ALL";return(this.zpp_inner.type==ye.id_ListenerType_INTERACTION?"InteractionListener{"+n+"#"+e+"::"+h.string(t.outer_zni.zpp_inner_zn.options1.outer)+":"+h.string(t.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+e+"::"+h.string(t.outer_znp.zpp_inner_zn.options1.outer)+":"+h.string(t.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},__class__:g,__properties__:{set_space:"set_space",get_space:"get_space",set_precedence:"set_precedence",get_precedence:"get_precedence",set_event:"set_event",get_event:"get_event",get_type:"get_type"}};var w=function(n,e,t,i){null==i&&(i=0),this.zpp_inner_zn=null,fe.internal=!0,g.call(this),fe.internal=!1;var l=-1;null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1),n==ye.CbEvent_WAKE?l=ye.id_CbEvent_WAKE:(null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1),n==ye.CbEvent_SLEEP&&(l=ye.id_CbEvent_SLEEP)),this.zpp_inner_zn=new me(Ce.argument(e),l,t),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=i};l["nape.callbacks.BodyListener"]=w,w.__name__=["nape","callbacks","BodyListener"],w.__super__=g,w.prototype=e(g.prototype,{zpp_inner_zn:null,get_options:function(){return this.zpp_inner_zn.options.outer},set_options:function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},get_handler:function(){return this.zpp_inner_zn.handler},set_handler:function(n){return this.zpp_inner_zn.handler=n},__class__:w,__properties__:e(g.prototype.__properties__,{set_handler:"set_handler",get_handler:"get_handler",set_options:"set_options",get_options:"get_options"})});var C=function(){};l["nape.callbacks.CbEvent"]=C,C.__name__=["nape","callbacks","CbEvent"],C.__properties__={get_PRE:"get_PRE",get_BREAK:"get_BREAK",get_SLEEP:"get_SLEEP",get_WAKE:"get_WAKE",get_END:"get_END",get_ONGOING:"get_ONGOING",get_BEGIN:"get_BEGIN"},C.get_BEGIN=function(){return null==ye.CbEvent_BEGIN&&(ye.internal=!0,ye.CbEvent_BEGIN=new C,ye.internal=!1),ye.CbEvent_BEGIN},C.get_ONGOING=function(){return null==ye.CbEvent_ONGOING&&(ye.internal=!0,ye.CbEvent_ONGOING=new C,ye.internal=!1),ye.CbEvent_ONGOING},C.get_END=function(){return null==ye.CbEvent_END&&(ye.internal=!0,ye.CbEvent_END=new C,ye.internal=!1),ye.CbEvent_END},C.get_WAKE=function(){return null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1),ye.CbEvent_WAKE},C.get_SLEEP=function(){return null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1),ye.CbEvent_SLEEP},C.get_BREAK=function(){return null==ye.CbEvent_BREAK&&(ye.internal=!0,ye.CbEvent_BREAK=new C,ye.internal=!1),ye.CbEvent_BREAK},C.get_PRE=function(){return null==ye.CbEvent_PRE&&(ye.internal=!0,ye.CbEvent_PRE=new C,ye.internal=!1),ye.CbEvent_PRE},C.prototype={toString:function(){return null==ye.CbEvent_PRE&&(ye.internal=!0,ye.CbEvent_PRE=new C,ye.internal=!1),this==ye.CbEvent_PRE?"PRE":(null==ye.CbEvent_BEGIN&&(ye.internal=!0,ye.CbEvent_BEGIN=new C,ye.internal=!1),this==ye.CbEvent_BEGIN?"BEGIN":(null==ye.CbEvent_ONGOING&&(ye.internal=!0,ye.CbEvent_ONGOING=new C,ye.internal=!1),this==ye.CbEvent_ONGOING?"ONGOING":(null==ye.CbEvent_END&&(ye.internal=!0,ye.CbEvent_END=new C,ye.internal=!1),this==ye.CbEvent_END?"END":(null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1),this==ye.CbEvent_WAKE?"WAKE":(null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1),this==ye.CbEvent_SLEEP?"SLEEP":(null==ye.CbEvent_BREAK&&(ye.internal=!0,ye.CbEvent_BREAK=new C,ye.internal=!1),this==ye.CbEvent_BREAK?"BREAK":""))))))},__class__:C};var M=function(){this.zpp_inner=null,this.zpp_inner=new ze,this.zpp_inner.outer=this};l["nape.callbacks.CbType"]=M,M.__name__=["nape","callbacks","CbType"],M.__properties__={get_ANY_COMPOUND:"get_ANY_COMPOUND",get_ANY_SHAPE:"get_ANY_SHAPE",get_ANY_CONSTRAINT:"get_ANY_CONSTRAINT",get_ANY_BODY:"get_ANY_BODY"},M.get_ANY_BODY=function(){return ze.ANY_BODY},M.get_ANY_CONSTRAINT=function(){return ze.ANY_CONSTRAINT},M.get_ANY_SHAPE=function(){return ze.ANY_SHAPE},M.get_ANY_COMPOUND=function(){return ze.ANY_COMPOUND},M.prototype={zpp_inner:null,get_id:function(){return this.zpp_inner.id},including:function(n){return new N(this).including(n)},excluding:function(n){return new N(this).excluding(n)},get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_interactors:function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=hl.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},get_constraints:function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},toString:function(){return this==ze.ANY_BODY?"ANY_BODY":this==ze.ANY_SHAPE?"ANY_SHAPE":this==ze.ANY_COMPOUND?"ANY_COMPOUND":this==ze.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:M,__properties__:{get_constraints:"get_constraints",get_interactors:"get_interactors",get_userData:"get_userData",get_id:"get_id"}};var k=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.callbacks.CbTypeIterator"]=k,k.__name__=["nape","callbacks","CbTypeIterator"],k.get=function(n){var e;if(null==k.zpp_pool){dl.internal=!0;var t=new k;dl.internal=!1,e=t}else{var i=k.zpp_pool;k.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},k.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=k.zpp_pool,k.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:k};var O=function(){this.zpp_inner=null,this.zpp_inner=new dl,this.zpp_inner.outer=this};l["nape.callbacks.CbTypeList"]=O,O.__name__=["nape","callbacks","CbTypeList"],O.fromArray=function(n){for(var e=new O,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},O.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),k.get(this)},copy:function(n){null==n&&(n=!1);var e=new O;this.zpp_inner.valmod();for(var t=k.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=k.zpp_pool,k.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=k.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=k.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=k.zpp_pool,k.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=k.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:O,__properties__:{get_length:"get_length"}};var S=function(){m.call(this)};l["nape.callbacks.ConstraintCallback"]=S,S.__name__=["nape","callbacks","ConstraintCallback"],S.__super__=m,S.prototype=e(m.prototype,{get_constraint:function(){return this.zpp_inner.constraint.outer},toString:function(){var n="Cb:";return n+=["WAKE","SLEEP","BREAK"][this.zpp_inner.event-ye.id_CbEvent_WAKE],n+=":"+this.zpp_inner.constraint.outer,n+=" : listener: "+h.string(this.zpp_inner.listener.outer)},__class__:S,__properties__:e(m.prototype.__properties__,{get_constraint:"get_constraint"})});var P=function(n,e,t,i){null==i&&(i=0),this.zpp_inner_zn=null,fe.internal=!0,g.call(this),fe.internal=!1;var l=-1;null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1),n==ye.CbEvent_WAKE?l=ye.id_CbEvent_WAKE:(null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1),n==ye.CbEvent_SLEEP?l=ye.id_CbEvent_SLEEP:(null==ye.CbEvent_BREAK&&(ye.internal=!0,ye.CbEvent_BREAK=new C,ye.internal=!1),n==ye.CbEvent_BREAK&&(l=ye.id_CbEvent_BREAK))),this.zpp_inner_zn=new be(Ce.argument(e),l,t),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=i};l["nape.callbacks.ConstraintListener"]=P,P.__name__=["nape","callbacks","ConstraintListener"],P.__super__=g,P.prototype=e(g.prototype,{zpp_inner_zn:null,get_options:function(){return this.zpp_inner_zn.options.outer},set_options:function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},get_handler:function(){return this.zpp_inner_zn.handler},set_handler:function(n){return this.zpp_inner_zn.handler=n},__class__:P,__properties__:e(g.prototype.__properties__,{set_handler:"set_handler",get_handler:"get_handler",set_options:"set_options",get_options:"get_options"})});var T=function(){m.call(this)};l["nape.callbacks.InteractionCallback"]=T,T.__name__=["nape","callbacks","InteractionCallback"],T.__super__=m,T.prototype=e(m.prototype,{get_int1:function(){return this.zpp_inner.int1.outer_i},get_int2:function(){return this.zpp_inner.int2.outer_i},get_arbiters:function(){return this.zpp_inner.wrap_arbiters},toString:function(){var n="Cb:";return n+=["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event],n+=":"+this.zpp_inner.int1.outer_i+"/"+this.zpp_inner.int2.outer_i,n+=" : "+this.zpp_inner.wrap_arbiters,n+=" : listener: "+h.string(this.zpp_inner.listener.outer)},__class__:T,__properties__:e(m.prototype.__properties__,{get_arbiters:"get_arbiters",get_int2:"get_int2",get_int1:"get_int1"})});var A=function(n,e,t,i,l,r){null==r&&(r=0),this.zpp_inner_zn=null,fe.internal=!0,g.call(this),fe.internal=!1;var a=-1;null==ye.CbEvent_BEGIN&&(ye.internal=!0,ye.CbEvent_BEGIN=new C,ye.internal=!1),n==ye.CbEvent_BEGIN?a=ye.id_CbEvent_BEGIN:(null==ye.CbEvent_END&&(ye.internal=!0,ye.CbEvent_END=new C,ye.internal=!1),n==ye.CbEvent_END?a=ye.id_CbEvent_END:(null==ye.CbEvent_ONGOING&&(ye.internal=!0,ye.CbEvent_ONGOING=new C,ye.internal=!1),n==ye.CbEvent_ONGOING&&(a=ye.id_CbEvent_ONGOING))),this.zpp_inner_zn=new we(Ce.argument(t),Ce.argument(i),a,ye.id_ListenerType_INTERACTION),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zni=this,this.zpp_inner.precedence=r,this.zpp_inner_zn.handleri=l;var p,s=this.zpp_inner_zn.itype;if(s==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),p=ye.InteractionType_COLLISION):s==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),p=ye.InteractionType_SENSOR):s==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),p=ye.InteractionType_FLUID):s==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),p=ye.InteractionType_ANY):p=null,p!=e){var o;null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),e==ye.InteractionType_COLLISION?o=ye.id_InteractionType_COLLISION:(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),e==ye.InteractionType_SENSOR?o=ye.id_InteractionType_SENSOR:(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),o=e==ye.InteractionType_FLUID?ye.id_InteractionType_FLUID:ye.id_InteractionType_ANY)),this.zpp_inner_zn.itype=o}var h=this.zpp_inner_zn.itype;h==ye.id_InteractionType_COLLISION?null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1):h==ye.id_InteractionType_SENSOR?null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1):h==ye.id_InteractionType_FLUID?null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1):h==ye.id_InteractionType_ANY&&null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1)};l["nape.callbacks.InteractionListener"]=A,A.__name__=["nape","callbacks","InteractionListener"],A.__super__=g,A.prototype=e(g.prototype,{zpp_inner_zn:null,get_options1:function(){return this.zpp_inner_zn.options1.outer},set_options1:function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},get_options2:function(){return this.zpp_inner_zn.options2.outer},set_options2:function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},get_interactionType:function(){var n=this.zpp_inner_zn.itype;return n==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION):n==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR):n==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID):n==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),ye.InteractionType_ANY):null},set_interactionType:function(n){var e,t=this.zpp_inner_zn.itype;if(t==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),e=ye.InteractionType_COLLISION):t==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),e=ye.InteractionType_SENSOR):t==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),e=ye.InteractionType_FLUID):t==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),e=ye.InteractionType_ANY):e=null,e!=n){var i;null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),n==ye.InteractionType_COLLISION?i=ye.id_InteractionType_COLLISION:(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),n==ye.InteractionType_SENSOR?i=ye.id_InteractionType_SENSOR:(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),i=n==ye.InteractionType_FLUID?ye.id_InteractionType_FLUID:ye.id_InteractionType_ANY)),this.zpp_inner_zn.itype=i}var l=this.zpp_inner_zn.itype;return l==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION):l==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR):l==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID):l==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),ye.InteractionType_ANY):null},get_handler:function(){return this.zpp_inner_zn.handleri},set_handler:function(n){return this.zpp_inner_zn.handleri=n},get_allowSleepingCallbacks:function(){return this.zpp_inner_zn.allowSleepingCallbacks},set_allowSleepingCallbacks:function(n){return this.zpp_inner_zn.allowSleepingCallbacks=n},__class__:A,__properties__:e(g.prototype.__properties__,{set_allowSleepingCallbacks:"set_allowSleepingCallbacks",get_allowSleepingCallbacks:"get_allowSleepingCallbacks",set_handler:"set_handler",get_handler:"get_handler",set_interactionType:"set_interactionType",get_interactionType:"get_interactionType",set_options2:"set_options2",get_options2:"get_options2",set_options1:"set_options1",get_options1:"get_options1"})});var E=function(){};l["nape.callbacks.InteractionType"]=E,E.__name__=["nape","callbacks","InteractionType"],E.__properties__={get_ANY:"get_ANY",get_FLUID:"get_FLUID",get_SENSOR:"get_SENSOR",get_COLLISION:"get_COLLISION"},E.get_COLLISION=function(){return null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION},E.get_SENSOR=function(){return null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR},E.get_FLUID=function(){return null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID},E.get_ANY=function(){return null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),ye.InteractionType_ANY},E.prototype={toString:function(){return null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),this==ye.InteractionType_COLLISION?"COLLISION":(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),this==ye.InteractionType_SENSOR?"SENSOR":(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),this==ye.InteractionType_FLUID?"FLUID":(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),this==ye.InteractionType_ANY?"ANY":"")))},__class__:E};var I=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.callbacks.ListenerIterator"]=I,I.__name__=["nape","callbacks","ListenerIterator"],I.get=function(n){var e;if(null==I.zpp_pool){ul.internal=!0;var t=new I;ul.internal=!1,e=t}else{var i=I.zpp_pool;I.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},I.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=I.zpp_pool,I.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:I};var V=function(){this.zpp_inner=null,this.zpp_inner=new ul,this.zpp_inner.outer=this};l["nape.callbacks.ListenerList"]=V,V.__name__=["nape","callbacks","ListenerList"],V.fromArray=function(n){for(var e=new V,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},V.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),I.get(this)},copy:function(n){null==n&&(n=!1);var e=new V;this.zpp_inner.valmod();for(var t=I.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=I.zpp_pool,I.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=I.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=I.zpp_pool,I.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=I.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=I.zpp_pool,I.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=I.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=I.zpp_pool,I.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=I.zpp_pool,I.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:V,__properties__:{get_length:"get_length"}};var L=function(){};l["nape.callbacks.ListenerType"]=L,L.__name__=["nape","callbacks","ListenerType"],L.__properties__={get_PRE:"get_PRE",get_INTERACTION:"get_INTERACTION",get_CONSTRAINT:"get_CONSTRAINT",get_BODY:"get_BODY"},L.get_BODY=function(){return null==ye.ListenerType_BODY&&(ye.internal=!0,ye.ListenerType_BODY=new L,ye.internal=!1),ye.ListenerType_BODY},L.get_CONSTRAINT=function(){return null==ye.ListenerType_CONSTRAINT&&(ye.internal=!0,ye.ListenerType_CONSTRAINT=new L,ye.internal=!1),ye.ListenerType_CONSTRAINT},L.get_INTERACTION=function(){return null==ye.ListenerType_INTERACTION&&(ye.internal=!0,ye.ListenerType_INTERACTION=new L,ye.internal=!1),ye.ListenerType_INTERACTION},L.get_PRE=function(){return null==ye.ListenerType_PRE&&(ye.internal=!0,ye.ListenerType_PRE=new L,ye.internal=!1),ye.ListenerType_PRE},L.prototype={toString:function(){return null==ye.ListenerType_BODY&&(ye.internal=!0,ye.ListenerType_BODY=new L,ye.internal=!1),this==ye.ListenerType_BODY?"BODY":(null==ye.ListenerType_CONSTRAINT&&(ye.internal=!0,ye.ListenerType_CONSTRAINT=new L,ye.internal=!1),this==ye.ListenerType_CONSTRAINT?"CONSTRAINT":(null==ye.ListenerType_INTERACTION&&(ye.internal=!0,ye.ListenerType_INTERACTION=new L,ye.internal=!1),this==ye.ListenerType_INTERACTION?"INTERACTION":(null==ye.ListenerType_PRE&&(ye.internal=!0,ye.ListenerType_PRE=new L,ye.internal=!1),this==ye.ListenerType_PRE?"PRE":"")))},__class__:L};var N=function(n,e){this.zpp_inner=null,this.zpp_inner=new Ce,this.zpp_inner.outer=this,null!=n&&this.including(n),null!=e&&this.excluding(e)};l["nape.callbacks.OptionType"]=N,N.__name__=["nape","callbacks","OptionType"],N.prototype={zpp_inner:null,get_includes:function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},get_excludes:function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},including:function(n){return this.zpp_inner.append(this.zpp_inner.includes,n),this},excluding:function(n){return this.zpp_inner.append(this.zpp_inner.excludes,n),this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var n=""+this.zpp_inner.wrap_includes;return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+n+" excluding "+this.zpp_inner.wrap_excludes+"}"},__class__:N,__properties__:{get_excludes:"get_excludes",get_includes:"get_includes"}};var D=function(){m.call(this)};l["nape.callbacks.PreCallback"]=D,D.__name__=["nape","callbacks","PreCallback"],D.__super__=m,D.prototype=e(m.prototype,{get_arbiter:function(){return this.zpp_inner.pre_arbiter.wrapper()},get_int1:function(){return this.zpp_inner.int1.outer_i},get_int2:function(){return this.zpp_inner.int2.outer_i},get_swapped:function(){return this.zpp_inner.pre_swapped},toString:function(){var n="Cb:PRE:";return n+=":"+this.zpp_inner.int1.outer_i+"/"+this.zpp_inner.int2.outer_i,n+=" : "+this.zpp_inner.pre_arbiter.wrapper(),n+=" : listnener: "+h.string(this.zpp_inner.listener.outer)},__class__:D,__properties__:e(m.prototype.__properties__,{get_swapped:"get_swapped",get_int2:"get_int2",get_int1:"get_int1",get_arbiter:"get_arbiter"})});var j=function(){};l["nape.callbacks.PreFlag"]=j,j.__name__=["nape","callbacks","PreFlag"],j.__properties__={get_IGNORE_ONCE:"get_IGNORE_ONCE",get_ACCEPT_ONCE:"get_ACCEPT_ONCE",get_IGNORE:"get_IGNORE",get_ACCEPT:"get_ACCEPT"},j.get_ACCEPT=function(){return null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),ye.PreFlag_ACCEPT},j.get_IGNORE=function(){return null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),ye.PreFlag_IGNORE},j.get_ACCEPT_ONCE=function(){return null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),ye.PreFlag_ACCEPT_ONCE},j.get_IGNORE_ONCE=function(){return null==ye.PreFlag_IGNORE_ONCE&&(ye.internal=!0,ye.PreFlag_IGNORE_ONCE=new j,ye.internal=!1),ye.PreFlag_IGNORE_ONCE},j.prototype={toString:function(){return null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),this==ye.PreFlag_ACCEPT?"ACCEPT":(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),this==ye.PreFlag_IGNORE?"IGNORE":(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),this==ye.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==ye.PreFlag_IGNORE_ONCE&&(ye.internal=!0,ye.PreFlag_IGNORE_ONCE=new j,ye.internal=!1),this==ye.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},__class__:j};var F=function(n,e,t,i,l,r){null==r&&(r=!1),null==l&&(l=0),this.zpp_inner_zn=null,fe.internal=!0,g.call(this),fe.internal=!1,this.zpp_inner_zn=new we(Ce.argument(e),Ce.argument(t),ye.id_CbEvent_PRE,ye.id_ListenerType_PRE),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_znp=this,this.zpp_inner.precedence=l,this.zpp_inner_zn.pure=r,this.zpp_inner_zn.handlerp=i;var a,p=this.zpp_inner_zn.itype;if(p==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),a=ye.InteractionType_COLLISION):p==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),a=ye.InteractionType_SENSOR):p==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),a=ye.InteractionType_FLUID):p==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),a=ye.InteractionType_ANY):a=null,a!=n){var s;null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),n==ye.InteractionType_COLLISION?s=ye.id_InteractionType_COLLISION:(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),n==ye.InteractionType_SENSOR?s=ye.id_InteractionType_SENSOR:(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),s=n==ye.InteractionType_FLUID?ye.id_InteractionType_FLUID:ye.id_InteractionType_ANY)),this.zpp_inner_zn.itype=s}var o=this.zpp_inner_zn.itype;o==ye.id_InteractionType_COLLISION?null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1):o==ye.id_InteractionType_SENSOR?null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1):o==ye.id_InteractionType_FLUID?null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1):o==ye.id_InteractionType_ANY&&null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1)};l["nape.callbacks.PreListener"]=F,F.__name__=["nape","callbacks","PreListener"],F.__super__=g,F.prototype=e(g.prototype,{zpp_inner_zn:null,get_options1:function(){return this.zpp_inner_zn.options1.outer},set_options1:function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},get_options2:function(){return this.zpp_inner_zn.options2.outer},set_options2:function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},get_handler:function(){return this.zpp_inner_zn.handlerp},set_handler:function(n){return this.zpp_inner_zn.handlerp=n,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},get_pure:function(){return this.zpp_inner_zn.pure},set_pure:function(n){return n||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=n},get_interactionType:function(){var n=this.zpp_inner_zn.itype;return n==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION):n==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR):n==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID):n==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),ye.InteractionType_ANY):null},set_interactionType:function(n){var e,t=this.zpp_inner_zn.itype;if(t==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),e=ye.InteractionType_COLLISION):t==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),e=ye.InteractionType_SENSOR):t==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),e=ye.InteractionType_FLUID):t==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),e=ye.InteractionType_ANY):e=null,e!=n){var i;null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),n==ye.InteractionType_COLLISION?i=ye.id_InteractionType_COLLISION:(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),n==ye.InteractionType_SENSOR?i=ye.id_InteractionType_SENSOR:(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),i=n==ye.InteractionType_FLUID?ye.id_InteractionType_FLUID:ye.id_InteractionType_ANY)),this.zpp_inner_zn.itype=i}var l=this.zpp_inner_zn.itype;return l==ye.id_InteractionType_COLLISION?(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION):l==ye.id_InteractionType_SENSOR?(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR):l==ye.id_InteractionType_FLUID?(null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID):l==ye.id_InteractionType_ANY?(null==ye.InteractionType_ANY&&(ye.internal=!0,ye.InteractionType_ANY=new E,ye.internal=!1),ye.InteractionType_ANY):null},__class__:F,__properties__:e(g.prototype.__properties__,{set_interactionType:"set_interactionType",get_interactionType:"get_interactionType",set_pure:"set_pure",get_pure:"get_pure",set_handler:"set_handler",get_handler:"get_handler",set_options2:"set_options2",get_options2:"get_options2",set_options1:"set_options1",get_options1:"get_options1"})});var B=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(ze.ANY_CONSTRAINT.zpp_inner)};l["nape.constraint.Constraint"]=B,B.__name__=["nape","constraint","Constraint"],B.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},debugDraw:null,get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=n)){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=n){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_isSleeping:function(){return this.zpp_inner.component.sleeping},get_active:function(){return this.zpp_inner.active},set_active:function(n){return this.zpp_inner.active!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),n?(this.zpp_inner.active=n,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=n,this.zpp_inner.deactivate())),this.zpp_inner.active},get_ignore:function(){return this.zpp_inner.ignore},set_ignore:function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.ignore=n,this.zpp_inner.wake()),this.zpp_inner.ignore},get_stiff:function(){return this.zpp_inner.stiff},set_stiff:function(n){return this.zpp_inner.stiff!=n&&(this.zpp_inner.stiff=n,this.zpp_inner.wake()),this.zpp_inner.stiff},get_frequency:function(){return this.zpp_inner.frequency},set_frequency:function(n){return this.zpp_inner.frequency!=n&&(this.zpp_inner.frequency=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},get_damping:function(){return this.zpp_inner.damping},set_damping:function(n){return this.zpp_inner.damping!=n&&(this.zpp_inner.damping=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},get_maxForce:function(){return this.zpp_inner.maxForce},set_maxForce:function(n){return this.zpp_inner.maxForce!=n&&(this.zpp_inner.maxForce=n,this.zpp_inner.wake()),this.zpp_inner.maxForce},get_maxError:function(){return this.zpp_inner.maxError},set_maxError:function(n){return this.zpp_inner.maxError!=n&&(this.zpp_inner.maxError=n,this.zpp_inner.wake()),this.zpp_inner.maxError},get_breakUnderForce:function(){return this.zpp_inner.breakUnderForce},set_breakUnderForce:function(n){return this.zpp_inner.breakUnderForce!=n&&(this.zpp_inner.breakUnderForce=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},get_breakUnderError:function(){return this.zpp_inner.breakUnderError},set_breakUnderError:function(n){return this.zpp_inner.breakUnderError!=n&&(this.zpp_inner.breakUnderError=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},get_removeOnBreak:function(){return this.zpp_inner.removeOnBreak},set_removeOnBreak:function(n){return this.zpp_inner.removeOnBreak=n},impulse:function(){return null},bodyImpulse:function(n){return null},visitBodies:function(n){},get_cbTypes:function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},toString:function(){return"{Constraint}"},copy:function(){return this.zpp_inner.copy()},__class__:B,__properties__:{get_cbTypes:"get_cbTypes",set_removeOnBreak:"set_removeOnBreak",get_removeOnBreak:"get_removeOnBreak",set_breakUnderError:"set_breakUnderError",get_breakUnderError:"get_breakUnderError",set_breakUnderForce:"set_breakUnderForce",get_breakUnderForce:"get_breakUnderForce",set_maxError:"set_maxError",get_maxError:"get_maxError",set_maxForce:"set_maxForce",get_maxForce:"get_maxForce",set_damping:"set_damping",get_damping:"get_damping",set_frequency:"set_frequency",get_frequency:"get_frequency",set_stiff:"set_stiff",get_stiff:"get_stiff",set_ignore:"set_ignore",get_ignore:"get_ignore",set_active:"set_active",get_active:"get_active",get_isSleeping:"get_isSleeping",set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_userData:"get_userData"}};var R=function(n,e,t,i,l){null==l&&(l=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new ke,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==e?null:e.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=i&&(this.zpp_inner_zn.jointMax=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=l&&(this.zpp_inner_zn.ratio=l,this.zpp_inner.wake())};l["nape.constraint.AngleJoint"]=R,R.__name__=["nape","constraint","AngleJoint"],R.__super__=B,R.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},isSlack:function(){var n,e=this.zpp_inner_zn,t=e.ratio*e.b2.rot-e.b1.rot;return e.equal?(t-=e.jointMax,n=!1,e.scale=1):e.jointMin>t?(t=e.jointMin-t,e.scale=-1,n=!1):t>e.jointMax?(t-=e.jointMax,e.scale=1,n=!1):(e.scale=0,t=0,n=!0),n},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get(0,0,0)},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:R,__properties__:e(B.prototype.__properties__,{set_ratio:"set_ratio",get_ratio:"get_ratio",set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var G=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.constraint.ConstraintIterator"]=G,G.__name__=["nape","constraint","ConstraintIterator"],G.get=function(n){var e;if(null==G.zpp_pool){sl.internal=!0;var t=new G;sl.internal=!1,e=t}else{var i=G.zpp_pool;G.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},G.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=G.zpp_pool,G.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:G};var Y=function(){this.zpp_inner=null,this.zpp_inner=new sl,this.zpp_inner.outer=this};l["nape.constraint.ConstraintList"]=Y,Y.__name__=["nape","constraint","ConstraintList"],Y.fromArray=function(n){for(var e=new Y,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Y.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),G.get(this)},copy:function(n){null==n&&(n=!1);var e=new Y;this.zpp_inner.valmod();for(var t=G.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=G.zpp_pool,G.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=G.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=G.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=G.zpp_pool,G.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=G.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Y,__properties__:{get_length:"get_length"}};var U=function(n,e,t,i,l,r){this.zpp_inner_zn=null,this.zpp_inner_zn=new Se,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var a=null==n?null:n.zpp_inner;a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var p=null==e?null:e.zpp_inner;p!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b1!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var s=this.zpp_inner_zn.wrap_a1,o=s.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=t.zpp_inner;null!=h._validate&&h._validate();var _=t.zpp_inner.x,u=t.zpp_inner;null!=u._validate&&u._validate();var d=t.zpp_inner.y,c=s.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x,v=s.zpp_inner;if(null!=v._validate&&v._validate(),s.zpp_inner.x==_){var z=s.zpp_inner;null!=z._validate&&z._validate(),x=s.zpp_inner.y==d}else x=!1;if(!x){s.zpp_inner.x=_,s.zpp_inner.y=d;var y=s.zpp_inner;null!=y._invalidate&&y._invalidate(y)}if(t.zpp_inner.weak){var f=t.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var b=t;b.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=b:Cl.poolVec2=b,Cl.nextVec2=b,b.zpp_disp=!0;var g=m;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Ct.zpp_pool,Ct.zpp_pool=g}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var w=this.zpp_inner_zn.wrap_a2,C=w.zpp_inner;null!=C._isimmutable&&C._isimmutable();var M=i.zpp_inner;null!=M._validate&&M._validate();var k=i.zpp_inner.x,O=i.zpp_inner;null!=O._validate&&O._validate();var S=i.zpp_inner.y,P=w.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T,A=w.zpp_inner;if(null!=A._validate&&A._validate(),w.zpp_inner.x==k){var E=w.zpp_inner;null!=E._validate&&E._validate(),T=w.zpp_inner.y==S}else T=!1;if(!T){w.zpp_inner.x=k,w.zpp_inner.y=S;var I=w.zpp_inner;null!=I._invalidate&&I._invalidate(I)}if(i.zpp_inner.weak){var V=i.zpp_inner;null!=V._isimmutable&&V._isimmutable();var L=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var N=i;N.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=N:Cl.poolVec2=N,Cl.nextVec2=N,N.zpp_disp=!0;var D=L;null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D._isimmutable=null,D._validate=null,D._invalidate=null,D.next=Ct.zpp_pool,Ct.zpp_pool=D}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=r&&(this.zpp_inner_zn.jointMax=r,this.zpp_inner.wake())};l["nape.constraint.DistanceJoint"]=U,U.__name__=["nape","constraint","DistanceJoint"],U.__super__=B,U.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},isSlack:function(){return this.zpp_inner_zn.slack},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:U,__properties__:e(B.prototype.__properties__,{set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var Z=function(n,e,t,i,l,r,a){this.zpp_inner_zn=null,this.zpp_inner_zn=new Pe,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var s=null==e?null:e.zpp_inner;s!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b1!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var o=this.zpp_inner_zn.wrap_a1,h=o.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _=t.zpp_inner;null!=_._validate&&_._validate();var u=t.zpp_inner.x,d=t.zpp_inner;null!=d._validate&&d._validate();var c=t.zpp_inner.y,x=o.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=o.zpp_inner;if(null!=z._validate&&z._validate(),o.zpp_inner.x==u){var y=o.zpp_inner;null!=y._validate&&y._validate(),v=o.zpp_inner.y==c}else v=!1;if(!v){o.zpp_inner.x=u,o.zpp_inner.y=c;var f=o.zpp_inner;null!=f._invalidate&&f._invalidate(f)}if(t.zpp_inner.weak){var m=t.zpp_inner;null!=m._isimmutable&&m._isimmutable();var b=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var g=t;g.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=g:Cl.poolVec2=g,Cl.nextVec2=g,g.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=Ct.zpp_pool,Ct.zpp_pool=w}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var C=this.zpp_inner_zn.wrap_a2,M=C.zpp_inner;null!=M._isimmutable&&M._isimmutable();var k=i.zpp_inner;null!=k._validate&&k._validate();var O=i.zpp_inner.x,S=i.zpp_inner;null!=S._validate&&S._validate();var P=i.zpp_inner.y,T=C.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A,E=C.zpp_inner;if(null!=E._validate&&E._validate(),C.zpp_inner.x==O){var I=C.zpp_inner;null!=I._validate&&I._validate(),A=C.zpp_inner.y==P}else A=!1;if(!A){C.zpp_inner.x=O,C.zpp_inner.y=P;var V=C.zpp_inner;null!=V._invalidate&&V._invalidate(V)}if(i.zpp_inner.weak){var L=i.zpp_inner;null!=L._isimmutable&&L._isimmutable();var N=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var D=i;D.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=D:Cl.poolVec2=D,Cl.nextVec2=D,D.zpp_disp=!0;var j=N;null!=j.outer&&(j.outer.zpp_inner=null,j.outer=null),j._isimmutable=null,j._validate=null,j._invalidate=null,j.next=Ct.zpp_pool,Ct.zpp_pool=j}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var F=this.zpp_inner_zn.wrap_n,R=F.zpp_inner;null!=R._isimmutable&&R._isimmutable();var G=l.zpp_inner;null!=G._validate&&G._validate();var Y=l.zpp_inner.x,U=l.zpp_inner;null!=U._validate&&U._validate();var Z=l.zpp_inner.y,q=F.zpp_inner;null!=q._isimmutable&&q._isimmutable();var W,X=F.zpp_inner;if(null!=X._validate&&X._validate(),F.zpp_inner.x==Y){var H=F.zpp_inner;null!=H._validate&&H._validate(),W=F.zpp_inner.y==Z}else W=!1;if(!W){F.zpp_inner.x=Y,F.zpp_inner.y=Z;var K=F.zpp_inner;null!=K._invalidate&&K._invalidate(K)}if(l.zpp_inner.weak){var J=l.zpp_inner;null!=J._isimmutable&&J._isimmutable();var Q=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var $=l;$.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=$:Cl.poolVec2=$,Cl.nextVec2=$,$.zpp_disp=!0;var nn=Q;null!=nn.outer&&(nn.outer.zpp_inner=null,nn.outer=null),nn._isimmutable=null,nn._validate=null,nn._invalidate=null,nn.next=Ct.zpp_pool,Ct.zpp_pool=nn}null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=r&&(this.zpp_inner_zn.jointMin=r,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=a&&(this.zpp_inner_zn.jointMax=a,this.zpp_inner.wake())};l["nape.constraint.LineJoint"]=Z,Z.__name__=["nape","constraint","LineJoint"],Z.__super__=B,Z.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_direction:function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},set_direction:function(n){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var e=this.zpp_inner_zn.wrap_n,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},impulse:function(){var n=new gn(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:Z,__properties__:e(B.prototype.__properties__,{set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_direction:"set_direction",get_direction:"get_direction",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var q=function(n,e,t,i){null==i&&(i=1),null==t&&(t=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Te,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=t&&(this.zpp_inner_zn.rate=t,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=i&&(this.zpp_inner_zn.ratio=i,this.zpp_inner.wake())};l["nape.constraint.MotorJoint"]=q,q.__name__=["nape","constraint","MotorJoint"],q.__super__=B,q.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},get_rate:function(){return this.zpp_inner_zn.rate},set_rate:function(n){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=n&&(this.zpp_inner_zn.rate=n,this.zpp_inner.wake()),this.zpp_inner_zn.rate},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:q,__properties__:e(B.prototype.__properties__,{set_rate:"set_rate",get_rate:"get_rate",set_ratio:"set_ratio",get_ratio:"get_ratio",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var W=function(n,e,t,i){this.zpp_inner_zn=null,this.zpp_inner_zn=new Ae,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var a=this.zpp_inner_zn.wrap_a1,p=a.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s=t.zpp_inner;null!=s._validate&&s._validate();var o=t.zpp_inner.x,h=t.zpp_inner;null!=h._validate&&h._validate();var _=t.zpp_inner.y,u=a.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d,c=a.zpp_inner;if(null!=c._validate&&c._validate(),a.zpp_inner.x==o){var x=a.zpp_inner;null!=x._validate&&x._validate(),d=a.zpp_inner.y==_}else d=!1;if(!d){a.zpp_inner.x=o,a.zpp_inner.y=_;var v=a.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(t.zpp_inner.weak){var z=t.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var f=t;f.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=f:Cl.poolVec2=f,Cl.nextVec2=f,f.zpp_disp=!0;var m=y;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ct.zpp_pool,Ct.zpp_pool=m}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var b=this.zpp_inner_zn.wrap_a2,g=b.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=i.zpp_inner;null!=w._validate&&w._validate();var C=i.zpp_inner.x,M=i.zpp_inner;null!=M._validate&&M._validate();var k=i.zpp_inner.y,O=b.zpp_inner;null!=O._isimmutable&&O._isimmutable();var S,P=b.zpp_inner;if(null!=P._validate&&P._validate(),b.zpp_inner.x==C){var T=b.zpp_inner;null!=T._validate&&T._validate(),S=b.zpp_inner.y==k}else S=!1;if(!S){b.zpp_inner.x=C,b.zpp_inner.y=k;var A=b.zpp_inner;null!=A._invalidate&&A._invalidate(A)}if(i.zpp_inner.weak){var E=i.zpp_inner;null!=E._isimmutable&&E._isimmutable();var I=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var V=i;V.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=V:Cl.poolVec2=V,Cl.nextVec2=V,V.zpp_disp=!0;var L=I;null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=Ct.zpp_pool,Ct.zpp_pool=L}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};l["nape.constraint.PivotJoint"]=W,W.__name__=["nape","constraint","PivotJoint"],W.__super__=B,W.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},impulse:function(){var n=new gn(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:W,__properties__:e(B.prototype.__properties__,{set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var X=function(n,e,t,i,l,r,a,p,s,o,h){null==h&&(h=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ee,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var _=null==n?null:n.zpp_inner;_!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=_,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=_&&this.zpp_inner_zn.b2!=_&&this.zpp_inner_zn.b3!=_&&this.zpp_inner_zn.b4!=_&&null!=_&&_.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=_&&_.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var u=null==e?null:e.zpp_inner;u!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b1!=u&&this.zpp_inner_zn.b3!=u&&this.zpp_inner_zn.b4!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake()));this.zpp_inner.immutable_midstep("Constraint::body3");var d=null==t?null:t.zpp_inner;d!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=d,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=d&&this.zpp_inner_zn.b1!=d&&this.zpp_inner_zn.b2!=d&&this.zpp_inner_zn.b4!=d&&null!=d&&d.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=d&&d.wake()));this.zpp_inner.immutable_midstep("Constraint::body4");var c=null==i?null:i.zpp_inner;c!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=c,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=c&&this.zpp_inner_zn.b1!=c&&this.zpp_inner_zn.b2!=c&&this.zpp_inner_zn.b3!=c&&null!=c&&c.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=c&&c.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var x=this.zpp_inner_zn.wrap_a1,v=x.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=l.zpp_inner;null!=z._validate&&z._validate();var y=l.zpp_inner.x,f=l.zpp_inner;null!=f._validate&&f._validate();var m=l.zpp_inner.y,b=x.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g,w=x.zpp_inner;if(null!=w._validate&&w._validate(),x.zpp_inner.x==y){var C=x.zpp_inner;null!=C._validate&&C._validate(),g=x.zpp_inner.y==m}else g=!1;if(!g){x.zpp_inner.x=y,x.zpp_inner.y=m;var M=x.zpp_inner;null!=M._invalidate&&M._invalidate(M)}if(l.zpp_inner.weak){var k=l.zpp_inner;null!=k._isimmutable&&k._isimmutable();var O=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var S=l;S.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=S:Cl.poolVec2=S,Cl.nextVec2=S,S.zpp_disp=!0;var P=O;null!=P.outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=Ct.zpp_pool,Ct.zpp_pool=P}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var T=this.zpp_inner_zn.wrap_a2,A=T.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E=r.zpp_inner;null!=E._validate&&E._validate();var I=r.zpp_inner.x,V=r.zpp_inner;null!=V._validate&&V._validate();var L=r.zpp_inner.y,N=T.zpp_inner;null!=N._isimmutable&&N._isimmutable();var D,j=T.zpp_inner;if(null!=j._validate&&j._validate(),T.zpp_inner.x==I){var F=T.zpp_inner;null!=F._validate&&F._validate(),D=T.zpp_inner.y==L}else D=!1;if(!D){T.zpp_inner.x=I,T.zpp_inner.y=L;var R=T.zpp_inner;null!=R._invalidate&&R._invalidate(R)}if(r.zpp_inner.weak){var G=r.zpp_inner;null!=G._isimmutable&&G._isimmutable();var Y=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var U=r;U.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=U:Cl.poolVec2=U,Cl.nextVec2=U,U.zpp_disp=!0;var Z=Y;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=Ct.zpp_pool,Ct.zpp_pool=Z}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var q=this.zpp_inner_zn.wrap_a3,W=q.zpp_inner;null!=W._isimmutable&&W._isimmutable();var X=a.zpp_inner;null!=X._validate&&X._validate();var H=a.zpp_inner.x,K=a.zpp_inner;null!=K._validate&&K._validate();var J=a.zpp_inner.y,Q=q.zpp_inner;null!=Q._isimmutable&&Q._isimmutable();var $,nn=q.zpp_inner;if(null!=nn._validate&&nn._validate(),q.zpp_inner.x==H){var en=q.zpp_inner;null!=en._validate&&en._validate(),$=q.zpp_inner.y==J}else $=!1;if(!$){q.zpp_inner.x=H,q.zpp_inner.y=J;var tn=q.zpp_inner;null!=tn._invalidate&&tn._invalidate(tn)}if(a.zpp_inner.weak){var ln=a.zpp_inner;null!=ln._isimmutable&&ln._isimmutable();var rn=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var an=a;an.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=an:Cl.poolVec2=an,Cl.nextVec2=an,an.zpp_disp=!0;var pn=rn;null!=pn.outer&&(pn.outer.zpp_inner=null,pn.outer=null),pn._isimmutable=null,pn._validate=null,pn._invalidate=null,pn.next=Ct.zpp_pool,Ct.zpp_pool=pn}null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var sn=this.zpp_inner_zn.wrap_a4,on=sn.zpp_inner;null!=on._isimmutable&&on._isimmutable();var hn=p.zpp_inner;null!=hn._validate&&hn._validate();var _n=p.zpp_inner.x,un=p.zpp_inner;null!=un._validate&&un._validate();var dn=p.zpp_inner.y,cn=sn.zpp_inner;null!=cn._isimmutable&&cn._isimmutable();var xn,vn=sn.zpp_inner;if(null!=vn._validate&&vn._validate(),sn.zpp_inner.x==_n){var zn=sn.zpp_inner;null!=zn._validate&&zn._validate(),xn=sn.zpp_inner.y==dn}else xn=!1;if(!xn){sn.zpp_inner.x=_n,sn.zpp_inner.y=dn;var yn=sn.zpp_inner;null!=yn._invalidate&&yn._invalidate(yn)}if(p.zpp_inner.weak){var fn=p.zpp_inner;null!=fn._isimmutable&&fn._isimmutable();var mn=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var bn=p;bn.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=bn:Cl.poolVec2=bn,Cl.nextVec2=bn,bn.zpp_disp=!0;var gn=mn;null!=gn.outer&&(gn.outer.zpp_inner=null,gn.outer=null),gn._isimmutable=null,gn._validate=null,gn._invalidate=null,gn.next=Ct.zpp_pool,Ct.zpp_pool=gn}null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=h&&(this.zpp_inner_zn.ratio=h,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=s&&(this.zpp_inner_zn.jointMin=s,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=o&&(this.zpp_inner_zn.jointMax=o,this.zpp_inner.wake())};l["nape.constraint.PulleyJoint"]=X,X.__name__=["nape","constraint","PulleyJoint"],X.__super__=B,X.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_body3:function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},set_body3:function(n){this.zpp_inner.immutable_midstep("Constraint::body3");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},get_body4:function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},set_body4:function(n){this.zpp_inner.immutable_midstep("Constraint::body4");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_anchor3:function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},set_anchor3:function(n){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var e=this.zpp_inner_zn.wrap_a3,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},get_anchor4:function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},set_anchor4:function(n){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var e=this.zpp_inner_zn.wrap_a4,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},isSlack:function(){return this.zpp_inner_zn.slack},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&n(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&n(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},__class__:X,__properties__:e(B.prototype.__properties__,{set_ratio:"set_ratio",get_ratio:"get_ratio",set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_anchor4:"set_anchor4",get_anchor4:"get_anchor4",set_anchor3:"set_anchor3",get_anchor3:"get_anchor3",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body4:"set_body4",get_body4:"get_body4",set_body3:"set_body3",get_body3:"get_body3",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var H=function(n,e){null==e&&(e=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ie(n,e),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1};l["nape.constraint.UserConstraint"]=H,H.__name__=["nape","constraint","UserConstraint"],H.__super__=B,H.prototype=e(B.prototype,{zpp_inner_zn:null,__bindVec2:function(){var n=new On;return n.zpp_inner._inuse=!0,n.zpp_inner._invalidate=(Il=this.zpp_inner_zn,t(Il,Il.bindVec2_invalidate)),n},__copy:function(){},__broken:function(){},__validate:function(){},__draw:function(n){},__prepare:function(){},__position:function(n){},__velocity:function(n){},__eff_mass:function(n){},__clamp:function(n){},__impulse:function(n,e,t){},impulse:function(){for(var n=new gn(this.zpp_inner_zn.dim,1),e=0,t=this.zpp_inner_zn.dim;t>e;){var i=e++;n.zpp_inner.x[i*n.zpp_inner.n]=this.zpp_inner_zn.jAcc[i]}return n},bodyImpulse:function(n){for(var e=0,t=this.zpp_inner_zn.bodies;t.length>e;){var i=t[e];if(++e,i.body==n.zpp_inner){!0;break}}return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){for(var e=0,t=this.zpp_inner_zn.bodies.length;t>e;){var i=this.zpp_inner_zn.bodies[e];if(null!=i.body){for(var l=!1,r=e+1,a=t;a>r;){if(this.zpp_inner_zn.bodies[r++].body==i.body){l=!0;break}}l||n(i.body.outer)}++e}},__invalidate:function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},__registerBody:function(n,e){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),n!=e&&(null!=n&&(this.zpp_inner_zn.remBody(n.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&n.zpp_inner.wake()),null!=e&&this.zpp_inner_zn.addBody(e.zpp_inner),this.zpp_inner.wake(),null!=e&&e.zpp_inner.wake()),e},__class__:H});var K=function(n,e,t,i,l){null==l&&(l=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Le,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,B.zpp_internalAlloc=!0,B.call(this),B.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==e?null:e.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var p=this.zpp_inner_zn.wrap_a1,s=p.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=t.zpp_inner;null!=o._validate&&o._validate();var h=t.zpp_inner.x,_=t.zpp_inner;null!=_._validate&&_._validate();var u=t.zpp_inner.y,d=p.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c,x=p.zpp_inner;if(null!=x._validate&&x._validate(),p.zpp_inner.x==h){var v=p.zpp_inner;null!=v._validate&&v._validate(),c=p.zpp_inner.y==u}else c=!1;if(!c){p.zpp_inner.x=h,p.zpp_inner.y=u;var z=p.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(t.zpp_inner.weak){var y=t.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var m=t;m.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=m:Cl.poolVec2=m,Cl.nextVec2=m,m.zpp_disp=!0;var b=f;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Ct.zpp_pool,Ct.zpp_pool=b}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var g=this.zpp_inner_zn.wrap_a2,w=g.zpp_inner;null!=w._isimmutable&&w._isimmutable();var C=i.zpp_inner;null!=C._validate&&C._validate();var M=i.zpp_inner.x,k=i.zpp_inner;null!=k._validate&&k._validate();var O=i.zpp_inner.y,S=g.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P,T=g.zpp_inner;if(null!=T._validate&&T._validate(),g.zpp_inner.x==M){var A=g.zpp_inner;null!=A._validate&&A._validate(),P=g.zpp_inner.y==O}else P=!1;if(!P){g.zpp_inner.x=M,g.zpp_inner.y=O;var E=g.zpp_inner;null!=E._invalidate&&E._invalidate(E)}if(i.zpp_inner.weak){var I=i.zpp_inner;null!=I._isimmutable&&I._isimmutable();var V=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var L=i;L.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=L:Cl.poolVec2=L,Cl.nextVec2=L,L.zpp_disp=!0;var N=V;null!=N.outer&&(N.outer.zpp_inner=null,N.outer=null),N._isimmutable=null,N._validate=null,N._invalidate=null,N.next=Ct.zpp_pool,Ct.zpp_pool=N}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=l&&(this.zpp_inner_zn.phase=l,this.zpp_inner.wake())};l["nape.constraint.WeldJoint"]=K,K.__name__=["nape","constraint","WeldJoint"],K.__super__=B,K.prototype=e(B.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_phase:function(){return this.zpp_inner_zn.phase},set_phase:function(n){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=n&&(this.zpp_inner_zn.phase=n,this.zpp_inner.wake()),this.zpp_inner_zn.phase},impulse:function(){var n=new gn(3,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccz,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Tn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:K,__properties__:e(B.prototype.__properties__,{set_phase:"set_phase",get_phase:"get_phase",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var J=function(){this.zpp_inner=null};l["nape.dynamics.Arbiter"]=J,J.__name__=["nape","dynamics","Arbiter"],J.prototype={zpp_inner:null,get_isSleeping:function(){return this.zpp_inner.sleeping},get_type:function(){return Ne.types[this.zpp_inner.type]},isCollisionArbiter:function(){return this.zpp_inner.type==Ne.COL},isFluidArbiter:function(){return this.zpp_inner.type==Ne.FLUID},isSensorArbiter:function(){return this.zpp_inner.type==Ne.SENSOR},get_collisionArbiter:function(){return this.zpp_inner.type==Ne.COL?this.zpp_inner.colarb.outer_zn:null},get_fluidArbiter:function(){return this.zpp_inner.type==Ne.FLUID?this.zpp_inner.fluidarb.outer_zn:null},get_shape1:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer},get_shape2:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer},get_body1:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer},get_body2:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer},get_state:function(){var n=this.zpp_inner.immState;return n==(ye.id_ImmState_ACCEPT|ye.id_ImmState_ALWAYS)?(null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),ye.PreFlag_ACCEPT):n==ye.id_ImmState_ACCEPT?(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),ye.PreFlag_ACCEPT_ONCE):n==(ye.id_ImmState_IGNORE|ye.id_ImmState_ALWAYS)?(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),ye.PreFlag_IGNORE):(null==ye.PreFlag_IGNORE_ONCE&&(ye.internal=!0,ye.PreFlag_IGNORE_ONCE=new j,ye.internal=!1),ye.PreFlag_IGNORE_ONCE)},totalImpulse:function(n,e){null==e&&(e=!1);var t;return t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer),!!t&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer),Tn.get(0,0,0)},toString:function(){var n=this.zpp_inner.type==Ne.COL?"CollisionArbiter":this.zpp_inner.type==Ne.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return n+"(object-pooled)";var e,t=n+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer)+"|",i=t+""+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer)+")",l=this.zpp_inner.type==Ne.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"",r=this.zpp_inner.immState;r==(ye.id_ImmState_ACCEPT|ye.id_ImmState_ALWAYS)?(null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),e=ye.PreFlag_ACCEPT):r==ye.id_ImmState_ACCEPT?(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),e=ye.PreFlag_ACCEPT_ONCE):r==(ye.id_ImmState_IGNORE|ye.id_ImmState_ALWAYS)?(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),e=ye.PreFlag_IGNORE):(null==ye.PreFlag_IGNORE_ONCE&&(ye.internal=!0,ye.PreFlag_IGNORE_ONCE=new j,ye.internal=!1),e=ye.PreFlag_IGNORE_ONCE);return i+l+"<-"+e},__class__:J,__properties__:{get_state:"get_state",get_body2:"get_body2",get_body1:"get_body1",get_shape2:"get_shape2",get_shape1:"get_shape1",get_fluidArbiter:"get_fluidArbiter",get_collisionArbiter:"get_collisionArbiter",get_type:"get_type",get_isSleeping:"get_isSleeping"}};var Q=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.ArbiterIterator"]=Q,Q.__name__=["nape","dynamics","ArbiterIterator"],Q.get=function(n){var e;if(null==Q.zpp_pool){bl.internal=!0;var t=new Q;bl.internal=!1,e=t}else{var i=Q.zpp_pool;Q.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Q.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,n>this.zpp_i||(this.zpp_next=Q.zpp_pool,Q.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Q};var $=function(){this.zpp_inner=null,this.zpp_inner=new bl,this.zpp_inner.outer=this};l["nape.dynamics.ArbiterList"]=$,$.__name__=["nape","dynamics","ArbiterList"],$.fromArray=function(n){for(var e=new $,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},$.prototype={zpp_inner:null,get_length:function(){return this.zpp_gl()},zpp_gl:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.head;null!=n;){n.elt.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},has:function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;;){var e=this.zpp_inner.at_ite.elt;if(e.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var t=this.zpp_inner.at_ite.elt;if(t.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.elt.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var i=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.wrapper()},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var i=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},empty:function(){return 0==this.zpp_gl()},iterator:function(){return this.zpp_vm(),Q.get(this)},copy:function(n){null==n&&(n=!1);for(var e=new $,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner.zpp_gl();t.zpp_critical=!0;var l;if(i>t.zpp_i?l=!0:(t.zpp_next=Q.zpp_pool,Q.zpp_pool=t,t.zpp_inner=null,l=!1),!l)break;t.zpp_critical=!1;var r,a=t.zpp_inner.at(t.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var i;if(t>e.zpp_i?i=!0:(e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||this.add(l)}},toString:function(){for(var n="[",e=!0,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner.zpp_gl();t.zpp_critical=!0;var l;if(i>t.zpp_i?l=!0:(t.zpp_next=Q.zpp_pool,Q.zpp_pool=t,t.zpp_inner=null,l=!1),!l)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var i;if(t>e.zpp_i?i=!0:(e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(l){e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;e<this.zpp_gl();){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:$,__properties__:{get_length:"get_length"}};var nn=function(){};l["nape.dynamics.ArbiterType"]=nn,nn.__name__=["nape","dynamics","ArbiterType"],nn.__properties__={get_FLUID:"get_FLUID",get_SENSOR:"get_SENSOR",get_COLLISION:"get_COLLISION"},nn.get_COLLISION=function(){return null==ye.ArbiterType_COLLISION&&(ye.internal=!0,ye.ArbiterType_COLLISION=new nn,ye.internal=!1),ye.ArbiterType_COLLISION},nn.get_SENSOR=function(){return null==ye.ArbiterType_SENSOR&&(ye.internal=!0,ye.ArbiterType_SENSOR=new nn,ye.internal=!1),ye.ArbiterType_SENSOR},nn.get_FLUID=function(){return null==ye.ArbiterType_FLUID&&(ye.internal=!0,ye.ArbiterType_FLUID=new nn,ye.internal=!1),ye.ArbiterType_FLUID},nn.prototype={toString:function(){return null==ye.ArbiterType_COLLISION&&(ye.internal=!0,ye.ArbiterType_COLLISION=new nn,ye.internal=!1),this==ye.ArbiterType_COLLISION?"COLLISION":(null==ye.ArbiterType_SENSOR&&(ye.internal=!0,ye.ArbiterType_SENSOR=new nn,ye.internal=!1),this==ye.ArbiterType_SENSOR?"SENSOR":(null==ye.ArbiterType_FLUID&&(ye.internal=!0,ye.ArbiterType_FLUID=new nn,ye.internal=!1),this==ye.ArbiterType_FLUID?"FLUID":""))},__class__:nn};var en=function(){J.call(this)};l["nape.dynamics.CollisionArbiter"]=en,en.__name__=["nape","dynamics","CollisionArbiter"],en.__super__=J,en.prototype=e(J.prototype,{get_contacts:function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},get_normal:function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},get_radius:function(){return this.zpp_inner.colarb.radius},get_referenceEdge1:function(){var n,e=this.zpp_inner.colarb.__ref_edge1;return n=null!=e&&((this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner.type!=ye.id_ShapeType_POLYGON||(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner!=e.polygon),n&&(e=this.zpp_inner.colarb.__ref_edge2),null==e?null:e.wrapper()},get_referenceEdge2:function(){var n,e=this.zpp_inner.colarb.__ref_edge1;return n=null!=e&&((this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner.type!=ye.id_ShapeType_POLYGON||(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner!=e.polygon),n&&(e=this.zpp_inner.colarb.__ref_edge2),null==e?null:e.wrapper()},firstVertex:function(){return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&-1==this.zpp_inner.colarb.__ref_vertex},secondVertex:function(){return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&1==this.zpp_inner.colarb.__ref_vertex},normalImpulse:function(n,e){null==e&&(e=!1);var t;t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=0,l=0,r=0,a=this.zpp_inner.colarb;if(!e||a.oc1.fresh){var p=a.oc1.wrapper().normalImpulse(n),s=p.zpp_inner;null!=s._validate&&s._validate(),i+=1*p.zpp_inner.x;var o=p.zpp_inner;null!=o._validate&&o._validate(),l+=1*p.zpp_inner.y;var h=p.zpp_inner;null!=h._validate&&h._validate(),r+=1*p.zpp_inner.z,p.dispose()}if(a.hc2&&(!e||a.oc2.fresh)){var _=a.oc2.wrapper().normalImpulse(n),u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),l+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),r+=1*_.zpp_inner.z,_.dispose()}return Tn.get(i,l,r)},tangentImpulse:function(n,e){null==e&&(e=!1);var t;t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=0,l=0,r=0,a=this.zpp_inner.colarb;if(!e||a.oc1.fresh){var p=a.oc1.wrapper().tangentImpulse(n),s=p.zpp_inner;null!=s._validate&&s._validate(),i+=1*p.zpp_inner.x;var o=p.zpp_inner;null!=o._validate&&o._validate(),l+=1*p.zpp_inner.y;var h=p.zpp_inner;null!=h._validate&&h._validate(),r+=1*p.zpp_inner.z,p.dispose()}if(a.hc2&&(!e||a.oc2.fresh)){var _=a.oc2.wrapper().tangentImpulse(n),u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),l+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),r+=1*_.zpp_inner.z,_.dispose()}return Tn.get(i,l,r)},totalImpulse:function(n,e){null==e&&(e=!1);var t;t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=0,l=0,r=0,a=this.zpp_inner.colarb;if(!e||a.oc1.fresh){var p=a.oc1.wrapper().totalImpulse(n),s=p.zpp_inner;null!=s._validate&&s._validate(),i+=1*p.zpp_inner.x;var o=p.zpp_inner;null!=o._validate&&o._validate(),l+=1*p.zpp_inner.y;var h=p.zpp_inner;null!=h._validate&&h._validate(),r+=1*p.zpp_inner.z,p.dispose()}if(a.hc2&&(!e||a.oc2.fresh)){var _=a.oc2.wrapper().totalImpulse(n),u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),l+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),r+=1*_.zpp_inner.z,_.dispose()}return Tn.get(i,l,r)},rollingImpulse:function(n,e){null==e&&(e=!1);var t;t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=this.zpp_inner.colarb;return!e||i.oc1.fresh?i.oc1.wrapper().rollingImpulse(n):0},get_elasticity:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.restitution},set_elasticity:function(n){var e=this.zpp_inner.colarb;e.restitution=n,e.userdef_restitution=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.restitution=t.s1.material.elasticity>-Infinity&&t.s2.material.elasticity>-Infinity?t.s1.material.elasticity<Infinity&&t.s2.material.elasticity<Infinity?(t.s1.material.elasticity+t.s2.material.elasticity)/2:1:0,0>t.restitution&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.restitution},get_dynamicFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.dyn_fric},set_dynamicFriction:function(n){var e=this.zpp_inner.colarb;e.dyn_fric=n,e.userdef_dyn_fric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.restitution=t.s1.material.elasticity>-Infinity&&t.s2.material.elasticity>-Infinity?t.s1.material.elasticity<Infinity&&t.s2.material.elasticity<Infinity?(t.s1.material.elasticity+t.s2.material.elasticity)/2:1:0,0>t.restitution&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.dyn_fric},get_staticFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.stat_fric},set_staticFriction:function(n){var e=this.zpp_inner.colarb;e.stat_fric=n,e.userdef_stat_fric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.restitution=t.s1.material.elasticity>-Infinity&&t.s2.material.elasticity>-Infinity?t.s1.material.elasticity<Infinity&&t.s2.material.elasticity<Infinity?(t.s1.material.elasticity+t.s2.material.elasticity)/2:1:0,0>t.restitution&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.stat_fric},get_rollingFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.rfric},set_rollingFriction:function(n){var e=this.zpp_inner.colarb;e.rfric=n,e.userdef_rfric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.restitution=t.s1.material.elasticity>-Infinity&&t.s2.material.elasticity>-Infinity?t.s1.material.elasticity<Infinity&&t.s2.material.elasticity<Infinity?(t.s1.material.elasticity+t.s2.material.elasticity)/2:1:0,0>t.restitution&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.rfric},__class__:en,__properties__:e(J.prototype.__properties__,{set_rollingFriction:"set_rollingFriction",get_rollingFriction:"get_rollingFriction",set_staticFriction:"set_staticFriction",get_staticFriction:"get_staticFriction",set_dynamicFriction:"set_dynamicFriction",get_dynamicFriction:"get_dynamicFriction",set_elasticity:"set_elasticity",get_elasticity:"get_elasticity",get_referenceEdge2:"get_referenceEdge2",get_referenceEdge1:"get_referenceEdge1",get_radius:"get_radius",get_normal:"get_normal",get_contacts:"get_contacts"})});var tn=function(){this.zpp_inner=null};l["nape.dynamics.Contact"]=tn,tn.__name__=["nape","dynamics","Contact"],tn.prototype={zpp_inner:null,get_arbiter:function(){if(null==this.zpp_inner.arbiter)return null;var n=this.zpp_inner.arbiter.outer;return n.zpp_inner.type==Ne.COL?n.zpp_inner.colarb.outer_zn:null},get_penetration:function(){return this.zpp_inner.inactiveme(),-this.zpp_inner.dist},get_position:function(){return this.zpp_inner.inactiveme(),null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},get_fresh:function(){return this.zpp_inner.inactiveme(),this.zpp_inner.fresh},normalImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jnAcc;return null==n?Tn.get(e.nx*i,e.ny*i):n==e.b1.outer?Tn.get(e.nx*-i,e.ny*-i,-(e.ny*t.r1x-e.nx*t.r1y)*i):Tn.get(e.nx*i,e.ny*i,(e.ny*t.r2x-e.nx*t.r2y)*i)},tangentImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jtAcc;return null==n?Tn.get(-e.ny*i,e.nx*i):n==e.b1.outer?Tn.get(e.ny*i,-e.nx*i,-(t.r1x*e.nx+t.r1y*e.ny)*i):Tn.get(-e.ny*i,e.nx*i,(t.r2x*e.nx+t.r2y*e.ny)*i)},rollingImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.arbiter.colarb.jrAcc;return null==n?t:n==e.b1.outer?-t:t},totalImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jnAcc,l=t.jtAcc,r=e.jrAcc;if(null==n)return Tn.get(e.nx*i-e.ny*l,e.ny*i+e.nx*l,r);var a=e.nx*i-e.ny*l,p=e.ny*i+e.nx*l;return n==e.b1.outer?Tn.get(-a,-p,-(p*t.r1x-a*t.r1y)-r):Tn.get(a,p,p*t.r2x-a*t.r2y+r)},get_friction:function(){return this.zpp_inner.inactiveme(),this.zpp_inner.inner.friction},toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:tn,__properties__:{get_friction:"get_friction",get_fresh:"get_fresh",get_position:"get_position",get_penetration:"get_penetration",get_arbiter:"get_arbiter"}};var ln=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.ContactIterator"]=ln,ln.__name__=["nape","dynamics","ContactIterator"],ln.get=function(n){var e;if(null==ln.zpp_pool){gl.internal=!0;var t=new ln;gl.internal=!1,e=t}else{var i=ln.zpp_pool;ln.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},ln.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var e=n.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&n.zpp_inner.user_length++,e=e.next}}var i=n.zpp_inner.user_length;return this.zpp_critical=!0,i>this.zpp_i||(this.zpp_next=ln.zpp_pool,ln.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:ln};var rn=function(){this.zpp_inner=null,this.zpp_inner=new gl,this.zpp_inner.outer=this};l["nape.dynamics.ContactList"]=rn,rn.__name__=["nape","dynamics","ContactList"],rn.fromArray=function(n){for(var e=new rn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},rn.prototype={zpp_inner:null,get_length:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(n<0)!0;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}n>=this.zpp_inner.user_length}if(this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var l=i;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}n=this.zpp_inner.user_length-1-n}if(this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var r=this.zpp_inner.at_ite;if(r.active&&r.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var a=this.zpp_inner.at_ite;if(a.active&&a.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var l=i;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{var r=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var p=a;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,a=a.next}}t=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var l=i;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{var r=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var p=a;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,a=a.next}}t=r.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}this.zpp_inner.valmod();var t=null;if(this.zpp_inner.reverse_flag){t=this.zpp_inner.inner.next;var i=t.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var l;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;){var a=r;a.active&&a.arbiter.active&&this.zpp_inner.user_length++,r=r.next}}if(1==this.zpp_inner.user_length)l=null;else{var p=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var s=this.zpp_inner.inner.next;null!=s;){var o=s;o.active&&o.arbiter.active&&this.zpp_inner.user_length++,s=s.next}}l=p.iterator_at(this.zpp_inner.user_length-2)}t=null==l?this.zpp_inner.inner.next:l.next;var h=t.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(h),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(l)}return this.zpp_inner.invalidate(),t.wrapper()},shift:function(){if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}this.zpp_inner.valmod();var t=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}if(1==this.zpp_inner.user_length)i=null;else{var a=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){var s=p;s.active&&s.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}i=a.iterator_at(this.zpp_inner.user_length-2)}t=null==i?this.zpp_inner.inner.next:i.next;var o=t.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}else{t=this.zpp_inner.inner.next;var h=t.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(h),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),t.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.next;null!=t;){if(t==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var i=t;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(0==this.zpp_inner.user_length)break;this.shift()}},empty:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return 0==this.zpp_inner.user_length},iterator:function(){return this.zpp_inner.valmod(),ln.get(this)},copy:function(n){null==n&&(n=!1);var e=new rn;this.zpp_inner.valmod();for(var t=ln.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var l=i.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&i.zpp_inner.user_length++,l=l.next}}var a=i.zpp_inner.user_length;t.zpp_critical=!0;var p;if(a>t.zpp_i?p=!0:(t.zpp_next=ln.zpp_pool,ln.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var s,o=t.zpp_inner.at(t.zpp_i++);n||(s=o),e.push(s)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=ln.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var i=t.zpp_inner.inner.next;null!=i;){var l=i;l.active&&l.arbiter.active&&t.zpp_inner.user_length++,i=i.next}}var r=t.zpp_inner.user_length;e.zpp_critical=!0;var a;if(r>e.zpp_i?a=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,a=!1),!a)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=ln.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var l=i.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&i.zpp_inner.user_length++,l=l.next}}var a=i.zpp_inner.user_length;t.zpp_critical=!0;var p;if(a>t.zpp_i?p=!0:(t.zpp_next=ln.zpp_pool,ln.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var s=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==s?"NULL":""+s,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=ln.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var i=t.zpp_inner.inner.next;null!=i;){var l=i;l.active&&l.arbiter.active&&t.zpp_inner.user_length++,i=i.next}}var r=t.zpp_inner.user_length;e.zpp_critical=!0;var a;if(r>e.zpp_i?a=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,a=!1),!a)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var i=t;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(this.zpp_inner.user_length<=e)break;var l=this.at(e);try{n(l)?++e:this.remove(l)}catch(r){break}}return this},__class__:rn,__properties__:{get_length:"get_length"}};var an=function(){J.call(this)};l["nape.dynamics.FluidArbiter"]=an,an.__name__=["nape","dynamics","FluidArbiter"],an.__super__=J,an.prototype=e(J.prototype,{get_position:function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},set_position:function(n){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var e=this.zpp_inner.fluidarb.wrap_position,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},get_overlap:function(){return this.zpp_inner.fluidarb.overlap},set_overlap:function(n){return 0>=n||Infinity,this.zpp_inner.fluidarb.overlap=n},buoyancyImpulse:function(n){var e;e=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=this.zpp_inner.fluidarb;return null==n?Tn.get(t.buoyx,t.buoyy,0):n.zpp_inner==this.zpp_inner.b2?Tn.get(t.buoyx,t.buoyy,t.buoyy*t.r2x-t.buoyx*t.r2y):Tn.get(-t.buoyx,-t.buoyy,-(t.buoyy*t.r1x-t.buoyx*t.r1y))},dragImpulse:function(n){var e;e=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=this.zpp_inner.fluidarb,i=null==n||n.zpp_inner==this.zpp_inner.b2?1:-1;return Tn.get(t.dampx*i,t.dampy*i,t.adamp*i)},totalImpulse:function(n,e){null==e&&(e=!1);var t;t=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=this.buoyancyImpulse(n),l=this.dragImpulse(n),r=l,a=r.zpp_inner;null!=a._validate&&a._validate();var p=r.zpp_inner.x,s=i.zpp_inner;null!=s._validate&&s._validate(),r.zpp_inner.x=p+i.zpp_inner.x;var o=r.zpp_inner;null!=o._validate&&o._validate();var h=l,_=h.zpp_inner;null!=_._validate&&_._validate();var u=h.zpp_inner.y,d=i.zpp_inner;null!=d._validate&&d._validate(),h.zpp_inner.y=u+i.zpp_inner.y;var c=h.zpp_inner;null!=c._validate&&c._validate();var x=l,v=x.zpp_inner;null!=v._validate&&v._validate();var z=x.zpp_inner.z,y=i.zpp_inner;null!=y._validate&&y._validate(),x.zpp_inner.z=z+i.zpp_inner.z;var f=x.zpp_inner;return null!=f._validate&&f._validate(),i.dispose(),l},__class__:an,__properties__:e(J.prototype.__properties__,{set_overlap:"set_overlap",get_overlap:"get_overlap",set_position:"set_position",get_position:"get_position"})});var pn=function(n,e,t,i,l,r){null==r&&(r=-1),null==l&&(l=1),null==i&&(i=-1),null==t&&(t=1),null==e&&(e=-1),null==n&&(n=1),this.zpp_inner=null,null==Ge.zpp_pool?this.zpp_inner=new Ge:(this.zpp_inner=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=e&&(this.zpp_inner.collisionMask=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=t&&(this.zpp_inner.sensorGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=i&&(this.zpp_inner.sensorMask=i,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=l&&(this.zpp_inner.fluidGroup=l,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=r&&(this.zpp_inner.fluidMask=r,this.zpp_inner.invalidate())};l["nape.dynamics.InteractionFilter"]=pn,pn.__name__=["nape","dynamics","InteractionFilter"],pn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=fl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},get_collisionGroup:function(){return this.zpp_inner.collisionGroup},set_collisionGroup:function(n){return this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},get_collisionMask:function(){return this.zpp_inner.collisionMask},set_collisionMask:function(n){return this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},get_sensorGroup:function(){return this.zpp_inner.sensorGroup},set_sensorGroup:function(n){return this.zpp_inner.sensorGroup!=n&&(this.zpp_inner.sensorGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},get_sensorMask:function(){return this.zpp_inner.sensorMask},set_sensorMask:function(n){return this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},get_fluidGroup:function(){return this.zpp_inner.fluidGroup},set_fluidGroup:function(n){return this.zpp_inner.fluidGroup!=n&&(this.zpp_inner.fluidGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},get_fluidMask:function(){return this.zpp_inner.fluidMask},set_fluidMask:function(n){return this.zpp_inner.fluidMask!=n&&(this.zpp_inner.fluidMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},shouldCollide:function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&e.collisionGroup)},shouldSense:function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.sensorMask&t.sensorGroup)&&0!=(t.sensorMask&e.sensorGroup)},shouldFlow:function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.fluidMask&t.fluidGroup)&&0!=(t.fluidMask&e.fluidGroup)},copy:function(){return new pn(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},toString:function(){return"{ collision: "+_.hex(this.zpp_inner.collisionGroup,8)+"~"+_.hex(this.zpp_inner.collisionMask,8)+" sensor: "+_.hex(this.zpp_inner.sensorGroup,8)+"~"+_.hex(this.zpp_inner.sensorMask,8)+" fluid: "+_.hex(this.zpp_inner.fluidGroup,8)+"~"+_.hex(this.zpp_inner.fluidMask,8)+" }"},__class__:pn,__properties__:{set_fluidMask:"set_fluidMask",get_fluidMask:"get_fluidMask",set_fluidGroup:"set_fluidGroup",get_fluidGroup:"get_fluidGroup",set_sensorMask:"set_sensorMask",get_sensorMask:"get_sensorMask",set_sensorGroup:"set_sensorGroup",get_sensorGroup:"get_sensorGroup",set_collisionMask:"set_collisionMask",get_collisionMask:"get_collisionMask",set_collisionGroup:"set_collisionGroup",get_collisionGroup:"get_collisionGroup",get_shapes:"get_shapes",get_userData:"get_userData"}};var sn=function(n){null==n&&(n=!1),this.zpp_inner=null,this.zpp_inner=new Ye,this.zpp_inner.outer=this,this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n)};l["nape.dynamics.InteractionGroup"]=sn,sn.__name__=["nape","dynamics","InteractionGroup"],sn.prototype={zpp_inner:null,get_group:function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},set_group:function(n){return this.zpp_inner.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},get_ignore:function(){return this.zpp_inner.ignore},set_ignore:function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n),this.zpp_inner.ignore},get_interactors:function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=hl.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},get_groups:function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=ml.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},toString:function(){var n="InteractionGroup";return this.zpp_inner.ignore&&(n+=":ignore"),n},__class__:sn,__properties__:{get_groups:"get_groups",get_interactors:"get_interactors",set_ignore:"set_ignore",get_ignore:"get_ignore",set_group:"set_group",get_group:"get_group"}};var on=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.InteractionGroupIterator"]=on,on.__name__=["nape","dynamics","InteractionGroupIterator"],on.get=function(n){var e;if(null==on.zpp_pool){ml.internal=!0;var t=new on;ml.internal=!1,e=t}else{var i=on.zpp_pool;on.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},on.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=on.zpp_pool,on.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:on};var hn=function(){this.zpp_inner=null,this.zpp_inner=new ml,this.zpp_inner.outer=this};l["nape.dynamics.InteractionGroupList"]=hn,hn.__name__=["nape","dynamics","InteractionGroupList"],hn.fromArray=function(n){for(var e=new hn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},hn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),on.get(this)},copy:function(n){null==n&&(n=!1);var e=new hn;this.zpp_inner.valmod();for(var t=on.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=on.zpp_pool,on.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=on.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=on.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=on.zpp_pool,on.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=on.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:hn,__properties__:{get_length:"get_length"}};var _n=function(n,e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),this.zpp_inner=null;var l;null==Ze.zpp_pool?l=new Ze:(l=Ze.zpp_pool,Ze.zpp_pool=l.next,l.next=null),l.minx=n,l.miny=e,l.maxx=n+t,l.maxy=e+i,this.zpp_inner=l,this.zpp_inner.outer=this};l["nape.geom.AABB"]=_n,_n.__name__=["nape","geom","AABB"],_n.prototype={zpp_inner:null,copy:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e,t=this.zpp_inner,i=t.minx,l=t.miny,r=t.maxx,a=t.maxy;return null==Ze.zpp_pool?e=new Ze:(e=Ze.zpp_pool,Ze.zpp_pool=e.next,e.next=null),e.minx=i,e.miny=l,e.maxx=r,e.maxy=a,e.wrapper()},get_min:function(){return this.zpp_inner.getmin()},set_min:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.minx,i=this.zpp_inner;if(null!=i._validate&&i._validate(),t==this.zpp_inner.minx){var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.miny,a=this.zpp_inner;null!=a._validate&&a._validate(),r!=this.zpp_inner.miny}else!0;var p=n.zpp_inner;null!=p._validate&&p._validate();var s=this.zpp_inner.getmax(),o=s.zpp_inner;null!=o._validate&&o._validate();var h=n.zpp_inner;null!=h._validate&&h._validate();var _=this.zpp_inner.getmax(),u=_.zpp_inner;null!=u._validate&&u._validate();var d=this.zpp_inner.getmin(),c=d.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x=n.zpp_inner;null!=x._validate&&x._validate();var v=n.zpp_inner.x,z=n.zpp_inner;null!=z._validate&&z._validate();var y=n.zpp_inner.y,f=d.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m,b=d.zpp_inner;if(null!=b._validate&&b._validate(),d.zpp_inner.x==v){var g=d.zpp_inner;null!=g._validate&&g._validate(),m=d.zpp_inner.y==y}else m=!1;if(!m){d.zpp_inner.x=v,d.zpp_inner.y=y;var w=d.zpp_inner;null!=w._invalidate&&w._invalidate(w)}if(n.zpp_inner.weak){var C=n.zpp_inner;null!=C._isimmutable&&C._isimmutable();var M=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var k=n;k.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=k:Cl.poolVec2=k,Cl.nextVec2=k,k.zpp_disp=!0;var O=M;null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=Ct.zpp_pool,Ct.zpp_pool=O}return this.zpp_inner.getmin()},get_max:function(){return this.zpp_inner.getmax()},set_max:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.minx,i=this.zpp_inner;if(null!=i._validate&&i._validate(),t==this.zpp_inner.minx){var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.miny,a=this.zpp_inner;null!=a._validate&&a._validate(),r!=this.zpp_inner.miny}else!0;var p=n.zpp_inner;null!=p._validate&&p._validate();var s=this.zpp_inner.getmin(),o=s.zpp_inner;null!=o._validate&&o._validate();var h=n.zpp_inner;null!=h._validate&&h._validate();var _=this.zpp_inner.getmin(),u=_.zpp_inner;null!=u._validate&&u._validate();var d=this.zpp_inner.getmax(),c=d.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x=n.zpp_inner;null!=x._validate&&x._validate();var v=n.zpp_inner.x,z=n.zpp_inner;null!=z._validate&&z._validate();var y=n.zpp_inner.y,f=d.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m,b=d.zpp_inner;if(null!=b._validate&&b._validate(),d.zpp_inner.x==v){var g=d.zpp_inner;null!=g._validate&&g._validate(),m=d.zpp_inner.y==y}else m=!1;if(!m){d.zpp_inner.x=v,d.zpp_inner.y=y;var w=d.zpp_inner;null!=w._invalidate&&w._invalidate(w)}if(n.zpp_inner.weak){var C=n.zpp_inner;null!=C._isimmutable&&C._isimmutable();var M=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var k=n;k.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=k:Cl.poolVec2=k,Cl.nextVec2=k,k.zpp_disp=!0;var O=M;null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=Ct.zpp_pool,Ct.zpp_pool=O}return this.zpp_inner.getmax()},get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.minx},set_x:function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.minx!=n){this.zpp_inner.maxx+=n-this.zpp_inner.minx,this.zpp_inner.minx=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.minx},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.miny},set_y:function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.miny!=n){this.zpp_inner.maxy+=n-this.zpp_inner.miny,this.zpp_inner.miny=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.miny},get_width:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxx-e.minx},set_width:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;if(t.maxx-t.minx!=n){var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+n;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l)}var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner;return a.maxx-a.minx},get_height:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxy-e.miny},set_height:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;if(t.maxy-t.miny!=n){var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+n;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l)}var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner;return a.maxy-a.miny},toString:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),""+this.zpp_inner},__class__:_n,__properties__:{set_height:"set_height",get_height:"get_height",set_width:"set_width",get_width:"get_width",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x",set_max:"set_max",get_max:"get_max",set_min:"set_min",get_min:"get_min"}};var un=function(){this.zpp_inner=null};l["nape.geom.ConvexResult"]=un,un.__name__=["nape","geom","ConvexResult"],un.prototype={zpp_inner:null,get_normal:function(){return this.zpp_inner.normal},get_position:function(){return this.zpp_inner.position},get_toi:function(){return this.zpp_inner.toiDistance},get_shape:function(){return this.zpp_inner.shape},dispose:function(){this.zpp_inner.free()},toString:function(){return"{ shape: "+h.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},__class__:un,__properties__:{get_shape:"get_shape",get_toi:"get_toi",get_position:"get_position",get_normal:"get_normal"}};var dn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.ConvexResultIterator"]=dn,dn.__name__=["nape","geom","ConvexResultIterator"],dn.get=function(n){var e;if(null==dn.zpp_pool){zl.internal=!0;var t=new dn;zl.internal=!1,e=t}else{var i=dn.zpp_pool;dn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},dn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=dn.zpp_pool,dn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:dn};var cn=function(){this.zpp_inner=null,this.zpp_inner=new zl,this.zpp_inner.outer=this};l["nape.geom.ConvexResultList"]=cn,cn.__name__=["nape","geom","ConvexResultList"],cn.fromArray=function(n){for(var e=new cn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},cn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),dn.get(this)},copy:function(n){null==n&&(n=!1);var e=new cn;this.zpp_inner.valmod();for(var t=dn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=dn.zpp_pool,dn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=dn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=dn.zpp_pool,dn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=dn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=dn.zpp_pool,dn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=dn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=dn.zpp_pool,dn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=dn.zpp_pool,dn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:cn,__properties__:{get_length:"get_length"}};var xn=function(){};l["nape.geom.Geom"]=xn,xn.__name__=["nape","geom","Geom"],xn.distanceBody=function(n,e,t,i){var l=t.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r=i.zpp_inner;null!=r._isimmutable&&r._isimmutable();for(var a=n.zpp_inner.shapes.head;null!=a;){$e.validateShape(a.elt),a=a.next}for(var p=e.zpp_inner.shapes.head;null!=p;){$e.validateShape(p.elt),p=p.next}return bt.distanceBody(n.zpp_inner,e.zpp_inner,t.zpp_inner,i.zpp_inner)},xn.distance=function(n,e,t,i){var l=t.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r=i.zpp_inner;null!=r._isimmutable&&r._isimmutable(),$e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner);var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1;var p,s=n.zpp_inner,o=e.zpp_inner,h=t.zpp_inner,_=i.zpp_inner;if(s.type==ye.id_ShapeType_CIRCLE&&o.type==ye.id_ShapeType_CIRCLE){var u,d=s.circle,c=o.circle,x=0,v=0;x=c.worldCOMx-d.worldCOMx,v=c.worldCOMy-d.worldCOMy;var z=Math.sqrt(x*x+v*v);if(1e100>(u=z-(d.radius+c.radius))){if(0==z)x=1,v=0;else{var y=1/z;x*=y,v*=y}var m=d.radius;h.x=d.worldCOMx+x*m,h.y=d.worldCOMy+v*m;var b=-c.radius;_.x=c.worldCOMx+x*b,_.y=c.worldCOMy+v*b,a.x=x,a.y=v}p=u}else{var g=!1;if(s.type==ye.id_ShapeType_CIRCLE&&o.type==ye.id_ShapeType_POLYGON){var w=s;s=o,o=w;var C=h;h=_,_=C,g=!0}if(s.type==ye.id_ShapeType_POLYGON&&o.type==ye.id_ShapeType_CIRCLE){for(var M=s.polygon,k=o.circle,O=-1e100,S=null,P=M.edges.head;null!=P;){var T=P.elt,A=T.gnormx*k.worldCOMx+T.gnormy*k.worldCOMy-T.gprojection-k.radius;if(A>1e100){O=A;break}A>0?A>O&&(O=A,S=T):0>O&&A>O&&(O=A,S=T),P=P.next}if(1e100>O){var E=S.gp0,I=S.gp1,V=k.worldCOMy*S.gnormx-k.worldCOMx*S.gnormy;if(E.y*S.gnormx-E.x*S.gnormy<V)if(V<I.y*S.gnormx-I.x*S.gnormy){var L=-k.radius;_.x=k.worldCOMx+S.gnormx*L,_.y=k.worldCOMy+S.gnormy*L;var N=-O;h.x=_.x+S.gnormx*N,h.y=_.y+S.gnormy*N,a.x=S.gnormx,a.y=S.gnormy}else{var D=0,j=0;D=k.worldCOMx-I.x,j=k.worldCOMy-I.y;var F=Math.sqrt(D*D+j*j);if(1e100>(O=F-k.radius)){if(0==F)D=1,j=0;else{var B=1/F;D*=B,j*=B}h.x=I.x+0*D,h.y=I.y+0*j;var R=-k.radius;_.x=k.worldCOMx+D*R,_.y=k.worldCOMy+j*R,a.x=D,a.y=j}}else{var G=0,Y=0;G=k.worldCOMx-E.x,Y=k.worldCOMy-E.y;var U=Math.sqrt(G*G+Y*Y);if(1e100>(O=U-k.radius)){if(0==U)G=1,Y=0;else{var Z=1/U;G*=Z,Y*=Z}h.x=E.x+0*G,h.y=E.y+0*Y;var q=-k.radius;_.x=k.worldCOMx+G*q,_.y=k.worldCOMy+Y*q,a.x=G,a.y=Y}}}g&&(a.x=-a.x,a.y=-a.y),p=O}else{for(var W=s.polygon,X=o.polygon,H=-1e100,K=null,J=null,Q=0,$=W.edges.head;null!=$;){for(var nn=$.elt,en=1e100,tn=X.gverts.next;null!=tn;){var ln=tn,rn=nn.gnormx*ln.x+nn.gnormy*ln.y;en>rn&&(en=rn),tn=tn.next}if((en-=nn.gprojection)>1e100){H=en;break}en>0?en>H&&(H=en,K=nn,Q=1):0>H&&en>H&&(H=en,K=nn,Q=1),$=$.next}if(1e100>H){for(var an=X.edges.head;null!=an;){for(var pn=an.elt,sn=1e100,on=W.gverts.next;null!=on;){var hn=on,_n=pn.gnormx*hn.x+pn.gnormy*hn.y;sn>_n&&(sn=_n),on=on.next}if((sn-=pn.gprojection)>1e100){H=sn;break}sn>0?sn>H&&(H=sn,J=pn,Q=2):0>H&&sn>H&&(H=sn,J=pn,Q=2),an=an.next}if(1e100>H){var un,dn;if(1==Q)W,un=X,dn=K;else{X,un=W,dn=J;var cn=h;h=_,_=cn,g=!g}for(var xn=null,vn=1e100,zn=un.edges.head;null!=zn;){var yn=zn.elt,fn=dn.gnormx*yn.gnormx+dn.gnormy*yn.gnormy;vn>fn&&(vn=fn,xn=yn),zn=zn.next}if(g?(a.x=-dn.gnormx,a.y=-dn.gnormy):(a.x=dn.gnormx,a.y=dn.gnormy),0>H){var mn=0,bn=0;mn=xn.gp0.x,bn=xn.gp0.y;var gn=0,wn=0;gn=xn.gp1.x,wn=xn.gp1.y;var Cn=0,Mn=0;Cn=gn-mn,Mn=wn-bn;var kn=dn.gnormy*mn-dn.gnormx*bn,On=dn.gnormy*gn-dn.gnormx*wn,Sn=1/(On-kn),Pn=(-dn.tp1-kn)*Sn;if(Pn>f.epsilon){var Tn=Pn;mn+=Cn*Tn,bn+=Mn*Tn}var An=(-dn.tp0-On)*Sn;if(-f.epsilon>An){var En=An;gn+=Cn*En,wn+=Mn*En}var In=mn*dn.gnormx+bn*dn.gnormy-dn.gprojection,Vn=gn*dn.gnormx+wn*dn.gnormy-dn.gprojection;if(Vn>In){_.x=mn,_.y=bn;var Ln=-In;h.x=_.x+dn.gnormx*Ln,h.y=_.y+dn.gnormy*Ln,p=In}else{_.x=gn,_.y=wn;var Nn=-Vn;h.x=_.x+dn.gnormx*Nn,h.y=_.y+dn.gnormy*Nn,p=Vn}}else{var Dn=dn.gp0,jn=dn.gp1,Fn=xn.gp0,Bn=xn.gp1,Rn=0,Gn=0,Yn=0,Un=0;Rn=jn.x-Dn.x,Gn=jn.y-Dn.y,Yn=Bn.x-Fn.x,Un=Bn.y-Fn.y;var Zn=1/(Rn*Rn+Gn*Gn),qn=1/(Yn*Yn+Un*Un),Wn=-(Rn*(Dn.x-Fn.x)+Gn*(Dn.y-Fn.y))*Zn,Xn=-(Rn*(Dn.x-Bn.x)+Gn*(Dn.y-Bn.y))*Zn,Hn=-(Yn*(Fn.x-Dn.x)+Un*(Fn.y-Dn.y))*qn,Kn=-(Yn*(Fn.x-jn.x)+Un*(Fn.y-jn.y))*qn;0>Wn?Wn=0:Wn>1&&(Wn=1),0>Xn?Xn=0:Xn>1&&(Xn=1),0>Hn?Hn=0:Hn>1&&(Hn=1),0>Kn?Kn=0:Kn>1&&(Kn=1);var Jn=0,Qn=0,$n=Wn;Jn=Dn.x+Rn*$n,Qn=Dn.y+Gn*$n;var ne=0,ee=0,te=Xn;ne=Dn.x+Rn*te,ee=Dn.y+Gn*te;var ie=0,le=0,re=Hn;ie=Fn.x+Yn*re,le=Fn.y+Un*re;var ae=0,pe=0,se=Kn;ae=Fn.x+Yn*se,pe=Fn.y+Un*se;var oe=0,he=0;oe=Jn-Fn.x,he=Qn-Fn.y;var _e=oe*oe+he*he,ue=0,de=0;ue=ne-Bn.x,de=ee-Bn.y;var ce=ue*ue+de*de,xe=0,ve=0;xe=ie-Dn.x,ve=le-Dn.y;var ze=xe*xe+ve*ve,fe=0,me=0;fe=ae-jn.x,me=pe-jn.y;var be=fe*fe+me*me,ge=0,we=0,Ce=null;ce>_e?(ge=Jn,we=Qn,Ce=Fn):(ge=ne,we=ee,Ce=Bn,_e=ce);var Me=0,ke=0,Oe=null;if(be>ze?(Me=ie,ke=le,Oe=Dn):(Me=ae,ke=pe,Oe=jn,ze=be),ze>_e?(h.x=ge,h.y=we,_.x=Ce.x,_.y=Ce.y,H=Math.sqrt(_e)):(_.x=Me,_.y=ke,h.x=Oe.x,h.y=Oe.y,H=Math.sqrt(ze)),0!=H){a.x=_.x-h.x,a.y=_.y-h.y;var Se=1/H;a.x*=Se,a.y*=Se,g&&(a.x=-a.x,a.y=-a.y)}p=H}}else p=1e100}else p=1e100}}var Pe=a;return null!=Pe.outer&&(Pe.outer.zpp_inner=null,Pe.outer=null),Pe._isimmutable=null,Pe._validate=null,Pe._invalidate=null,Pe.next=Ct.zpp_pool,Ct.zpp_pool=Pe,p},xn.intersectsBody=function(n,e){for(var t=n.zpp_inner.shapes.head;null!=t;){$e.validateShape(t.elt),t=t.next}for(var i=e.zpp_inner.shapes.head;null!=i;){$e.validateShape(i.elt),i=i.next}var l=n.zpp_inner.aabb,r=e.zpp_inner.aabb;if(r.miny>l.maxy||l.miny>r.maxy||r.minx>l.maxx||l.minx>r.maxx)return!1;for(var a=n.zpp_inner.shapes.head;null!=a;){for(var p=a.elt,s=e.zpp_inner.shapes.head;null!=s;){if(We.testCollide_safe(p,s.elt))return!0;s=s.next}a=a.next}return!1},xn.intersects=function(n,e){$e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner);var t=n.zpp_inner.aabb,i=e.zpp_inner.aabb;return!(i.miny>t.maxy||t.miny>i.maxy||i.minx>t.maxx||t.minx>i.maxx)&&We.testCollide_safe(n.zpp_inner,e.zpp_inner)},xn.contains=function(n,e){return $e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner),We.containTest(n.zpp_inner,e.zpp_inner)};var vn=function Wl(n){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new et(this),null!=n){if(n instanceof Array&&null==n.__enum__)for(var e=n,t=0;e.length>t;){var i=e[t];++t,y.__instanceof(i,On);var l=i,r=l.zpp_inner;null!=r._validate&&r._validate();var a=l.zpp_inner.x,p=l.zpp_inner;null!=p._validate&&p._validate();var s,o=l.zpp_inner.y;null==nt.zpp_pool?s=new nt:(s=nt.zpp_pool,nt.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=a,s.y=o;var h=s;null==this.zpp_inner.vertices?this.zpp_inner.vertices=h.prev=h.next=h:(h.prev=this.zpp_inner.vertices,h.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=h,this.zpp_inner.vertices.next=h),this.zpp_inner.vertices=h}else if(y.__instanceof(n,Pn))for(var _=n,u=_.iterator();;){u.zpp_inner.zpp_inner.valmod();var d=u.zpp_inner.zpp_gl();u.zpp_critical=!0;var c;if(d>u.zpp_i?c=!0:(u.zpp_next=Sn.zpp_pool,Sn.zpp_pool=u,u.zpp_inner=null,c=!1),!c)break;u.zpp_critical=!1;var x=u.zpp_inner.at(u.zpp_i++),v=x.zpp_inner;null!=v._validate&&v._validate();var z=x.zpp_inner.x,f=x.zpp_inner;null!=f._validate&&f._validate();var m,b=x.zpp_inner.y;null==nt.zpp_pool?m=new nt:(m=nt.zpp_pool,nt.zpp_pool=m.next,m.next=null),m.forced=!1,m.x=z,m.y=b;var g=m;null==this.zpp_inner.vertices?this.zpp_inner.vertices=g.prev=g.next=g:(g.prev=this.zpp_inner.vertices,g.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=g,this.zpp_inner.vertices.next=g),this.zpp_inner.vertices=g}else if(y.__instanceof(n,Wl)){var w=n,C=w.zpp_inner.vertices;if(null!=C)for(var M=C;;){var k,O=M.x,S=M.y;if(null==Cl.poolVec2?k=new On:(k=Cl.poolVec2,Cl.poolVec2=k.zpp_pool,k.zpp_pool=null,k.zpp_disp=!1,k==Cl.nextVec2&&(Cl.nextVec2=null)),null==k.zpp_inner){var P;null==Ct.zpp_pool?P=new Ct:(P=Ct.zpp_pool,Ct.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=O,P.y=S,k.zpp_inner=P,k.zpp_inner.outer=k}else{var T=k.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A,E=k.zpp_inner;if(null!=E._validate&&E._validate(),k.zpp_inner.x==O){var I=k.zpp_inner;null!=I._validate&&I._validate(),A=k.zpp_inner.y==S}else A=!1;if(!A){k.zpp_inner.x=O,k.zpp_inner.y=S;var V=k.zpp_inner;null!=V._invalidate&&V._invalidate(V)}}k.zpp_inner.weak=!1;var L=k;M=M.next;var N=L.zpp_inner;null!=N._validate&&N._validate();var D=L.zpp_inner.x,j=L.zpp_inner;null!=j._validate&&j._validate();var F,B=L.zpp_inner.y;null==nt.zpp_pool?F=new nt:(F=nt.zpp_pool,nt.zpp_pool=F.next,F.next=null),F.forced=!1,F.x=D,F.y=B;var R=F;null==this.zpp_inner.vertices?this.zpp_inner.vertices=R.prev=R.next=R:(R.prev=this.zpp_inner.vertices,R.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=R,this.zpp_inner.vertices.next=R),this.zpp_inner.vertices=R;var G=L.zpp_inner;null!=G._isimmutable&&G._isimmutable();var Y=L.zpp_inner;L.zpp_inner.outer=null,L.zpp_inner=null;var U=L;U.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=U:Cl.poolVec2=U,Cl.nextVec2=U,U.zpp_disp=!0;var Z=Y;if(null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=Ct.zpp_pool,Ct.zpp_pool=Z,M==C)break}}if(this.skipForward(1),n instanceof Array&&null==n.__enum__)for(var q=n,W=0;q.length>W;){var X,H=q[W];if(H.zpp_inner.weak){var K=H.zpp_inner;null!=K._isimmutable&&K._isimmutable();var J=H.zpp_inner;H.zpp_inner.outer=null,H.zpp_inner=null;var Q=H;Q.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Q:Cl.poolVec2=Q,Cl.nextVec2=Q,Q.zpp_disp=!0;var $=J;null!=$.outer&&($.outer.zpp_inner=null,$.outer=null),$._isimmutable=null,$._validate=null,$._invalidate=null,$.next=Ct.zpp_pool,Ct.zpp_pool=$,X=!0}else X=!1;X?q.splice(W,1):++W}else if(y.__instanceof(n,Pn)){var nn=n;null!=nn.zpp_inner._validate&&nn.zpp_inner._validate();for(var en=nn.zpp_inner.inner,tn=null,ln=en.head;null!=ln;){var rn=ln.elt;if(rn.outer.zpp_inner.weak){if(ln=en.erase(tn),rn.outer.zpp_inner.weak){var an=rn.outer,pn=an.zpp_inner;null!=pn._isimmutable&&pn._isimmutable();var sn=an.zpp_inner;an.zpp_inner.outer=null,an.zpp_inner=null;var on=an;on.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=on:Cl.poolVec2=on,Cl.nextVec2=on,on.zpp_disp=!0;var hn=sn;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn._isimmutable=null,hn._validate=null,hn._invalidate=null,hn.next=Ct.zpp_pool,Ct.zpp_pool=hn}}else tn=ln,ln=ln.next}}}};l["nape.geom.GeomPoly"]=vn,vn.__name__=["nape","geom","GeomPoly"],vn.get=function(n){var e;if(null==Cl.poolGeomPoly?e=new vn:(e=Cl.poolGeomPoly,Cl.poolGeomPoly=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Cl.nextGeomPoly&&(Cl.nextGeomPoly=null)),null!=n){if(n instanceof Array&&null==n.__enum__)for(var t=n,i=0;t.length>i;){var l=t[i];++i,y.__instanceof(l,On);var r=l,a=r.zpp_inner;null!=a._validate&&a._validate();var p=r.zpp_inner.x,s=r.zpp_inner;null!=s._validate&&s._validate();var o,h=r.zpp_inner.y;null==nt.zpp_pool?o=new nt:(o=nt.zpp_pool,nt.zpp_pool=o.next,o.next=null),o.forced=!1,o.x=p,o.y=h;var _=o;null==e.zpp_inner.vertices?e.zpp_inner.vertices=_.prev=_.next=_:(_.prev=e.zpp_inner.vertices,_.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=_,e.zpp_inner.vertices.next=_),e.zpp_inner.vertices=_}else if(y.__instanceof(n,Pn))for(var u=n,d=u.iterator();;){d.zpp_inner.zpp_inner.valmod();var c=d.zpp_inner.zpp_gl();d.zpp_critical=!0;var x;if(c>d.zpp_i?x=!0:(d.zpp_next=Sn.zpp_pool,Sn.zpp_pool=d,d.zpp_inner=null,x=!1),!x)break;d.zpp_critical=!1;var v=d.zpp_inner.at(d.zpp_i++),z=v.zpp_inner;null!=z._validate&&z._validate();var f=v.zpp_inner.x,m=v.zpp_inner;null!=m._validate&&m._validate();var b,g=v.zpp_inner.y;null==nt.zpp_pool?b=new nt:(b=nt.zpp_pool,nt.zpp_pool=b.next,b.next=null),b.forced=!1,b.x=f,b.y=g;var w=b;null==e.zpp_inner.vertices?e.zpp_inner.vertices=w.prev=w.next=w:(w.prev=e.zpp_inner.vertices,w.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=w,e.zpp_inner.vertices.next=w),e.zpp_inner.vertices=w}else if(y.__instanceof(n,vn)){var C=n,M=C.zpp_inner.vertices;if(null!=M)for(var k=M;;){var O,S=k.x,P=k.y;if(null==Cl.poolVec2?O=new On:(O=Cl.poolVec2,Cl.poolVec2=O.zpp_pool,O.zpp_pool=null,O.zpp_disp=!1,O==Cl.nextVec2&&(Cl.nextVec2=null)),null==O.zpp_inner){var T;null==Ct.zpp_pool?T=new Ct:(T=Ct.zpp_pool,Ct.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=S,T.y=P,O.zpp_inner=T,O.zpp_inner.outer=O}else{var A=O.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E,I=O.zpp_inner;if(null!=I._validate&&I._validate(),O.zpp_inner.x==S){var V=O.zpp_inner;null!=V._validate&&V._validate(),E=O.zpp_inner.y==P}else E=!1;if(!E){O.zpp_inner.x=S,O.zpp_inner.y=P;var L=O.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}O.zpp_inner.weak=!1;var N=O;k=k.next;var D=N.zpp_inner;null!=D._validate&&D._validate();var j=N.zpp_inner.x,F=N.zpp_inner;null!=F._validate&&F._validate();var B,R=N.zpp_inner.y;null==nt.zpp_pool?B=new nt:(B=nt.zpp_pool,nt.zpp_pool=B.next,B.next=null),B.forced=!1,B.x=j,B.y=R;var G=B;null==e.zpp_inner.vertices?e.zpp_inner.vertices=G.prev=G.next=G:(G.prev=e.zpp_inner.vertices,G.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=G,e.zpp_inner.vertices.next=G),e.zpp_inner.vertices=G;var Y=N.zpp_inner;null!=Y._isimmutable&&Y._isimmutable();var U=N.zpp_inner;N.zpp_inner.outer=null,N.zpp_inner=null;var Z=N;Z.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Z:Cl.poolVec2=Z,Cl.nextVec2=Z,Z.zpp_disp=!0;var q=U;if(null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=Ct.zpp_pool,Ct.zpp_pool=q,k==M)break}}if(e.skipForward(1),n instanceof Array&&null==n.__enum__)for(var W=n,X=0;W.length>X;){var H,K=W[X];if(K.zpp_inner.weak){var J=K.zpp_inner;null!=J._isimmutable&&J._isimmutable();var Q=K.zpp_inner;K.zpp_inner.outer=null,K.zpp_inner=null;var $=K;$.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=$:Cl.poolVec2=$,Cl.nextVec2=$,$.zpp_disp=!0;var nn=Q;null!=nn.outer&&(nn.outer.zpp_inner=null,nn.outer=null),nn._isimmutable=null,nn._validate=null,nn._invalidate=null,nn.next=Ct.zpp_pool,Ct.zpp_pool=nn,H=!0}else H=!1;H?W.splice(X,1):++X}else if(y.__instanceof(n,Pn)){var en=n;null!=en.zpp_inner._validate&&en.zpp_inner._validate();for(var tn=en.zpp_inner.inner,ln=null,rn=tn.head;null!=rn;){var an=rn.elt;if(an.outer.zpp_inner.weak){if(rn=tn.erase(ln),an.outer.zpp_inner.weak){var pn=an.outer,sn=pn.zpp_inner;null!=sn._isimmutable&&sn._isimmutable();var on=pn.zpp_inner;pn.zpp_inner.outer=null,pn.zpp_inner=null;var hn=pn;hn.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=hn:Cl.poolVec2=hn,Cl.nextVec2=hn,hn.zpp_disp=!0;var _n=on;null!=_n.outer&&(_n.outer.zpp_inner=null,_n.outer=null),_n._isimmutable=null,_n._validate=null,_n._invalidate=null,_n.next=Ct.zpp_pool,Ct.zpp_pool=_n}}else ln=rn,rn=rn.next}}}return e},vn.prototype={zpp_pool:null,zpp_disp:null,zpp_inner:null,empty:function(){return null==this.zpp_inner.vertices},size:function(){var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){if(++n,(i=i.next)==t)break}return n},iterator:function(){return tt.get(this.zpp_inner.vertices,!0)},forwardIterator:function(){return tt.get(this.zpp_inner.vertices,!0)},backwardsIterator:function(){return tt.get(this.zpp_inner.vertices,!1)},current:function(){var n=this.zpp_inner.vertices;if(null==n.wrap){var e,i=n.x,l=n.y;if(null==Cl.poolVec2?e=new On:(e=Cl.poolVec2,Cl.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Cl.nextVec2&&(Cl.nextVec2=null)),null==e.zpp_inner){var r;null==Ct.zpp_pool?r=new Ct:(r=Ct.zpp_pool,Ct.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=l,e.zpp_inner=r,e.zpp_inner.outer=e}else{var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==i){var o=e.zpp_inner;null!=o._validate&&o._validate(),p=e.zpp_inner.y==l}else p=!1;if(!p){e.zpp_inner.x=i,e.zpp_inner.y=l;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}return n.wrap},push:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var l,r=n.zpp_inner.y;null==nt.zpp_pool?l=new nt:(l=nt.zpp_pool,nt.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=t,l.y=r;var a=l;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=a.prev=a.next=a:(a.prev=this.zpp_inner.vertices,a.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=a,this.zpp_inner.vertices.next=a),this.zpp_inner.vertices=a,n.zpp_inner.weak){var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var o=n;o.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=o:Cl.poolVec2=o,Cl.nextVec2=o,o.zpp_disp=!0;var h=s;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ct.zpp_pool,Ct.zpp_pool=h}return this},pop:function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=null;else{var t=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}this.zpp_inner.vertices=n;var i=e;if(null!=i.wrap){i.wrap.zpp_inner._inuse=!1;var l=i.wrap,r=l.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var p=l;p.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=p:Cl.poolVec2=p,Cl.nextVec2=p,p.zpp_disp=!0;var s=a;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ct.zpp_pool,Ct.zpp_pool=s,i.wrap=null}return i.prev=i.next=null,i.next=nt.zpp_pool,nt.zpp_pool=i,this},unshift:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var l,r=n.zpp_inner.y;null==nt.zpp_pool?l=new nt:(l=nt.zpp_pool,nt.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=t,l.y=r;var a=l;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=a.prev=a.next=a:(a.next=this.zpp_inner.vertices,a.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=a,this.zpp_inner.vertices.prev=a),this.zpp_inner.vertices=a,n.zpp_inner.weak){var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var o=n;o.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=o:Cl.poolVec2=o,Cl.nextVec2=o,o.zpp_disp=!0;var h=s;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ct.zpp_pool,Ct.zpp_pool=h}return this},shift:function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var t=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}this.zpp_inner.vertices=n;var i=e;if(null!=i.wrap){i.wrap.zpp_inner._inuse=!1;var l=i.wrap,r=l.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var p=l;p.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=p:Cl.poolVec2=p,Cl.nextVec2=p,p.zpp_disp=!0;var s=a;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ct.zpp_pool,Ct.zpp_pool=s,i.wrap=null}return i.prev=i.next=null,i.next=nt.zpp_pool,nt.zpp_pool=i,this},skipForward:function(n){if(null!=this.zpp_inner.vertices)if(n>0)for(;n-- >0;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(0>n)for(;0>n++;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},skipBackwards:function(n){return this.skipForward(-n)},erase:function(n){for(;0!=n&&null!=this.zpp_inner.vertices;){var e=this.zpp_inner.vertices;if(n>0){var t;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,t=this.zpp_inner.vertices=null;else{var i=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t=i}this.zpp_inner.vertices=t,--n}else if(0>n){var l;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,l=null;else{var r=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,l=r}this.zpp_inner.vertices=l,++n}var a=e;if(null!=a.wrap){a.wrap.zpp_inner._inuse=!1;var p=a.wrap,s=p.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var h=p;h.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=h:Cl.poolVec2=h,Cl.nextVec2=h,h.zpp_disp=!0;var _=o;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ct.zpp_pool,Ct.zpp_pool=_,a.wrap=null}a.prev=a.next=null,a.next=nt.zpp_pool,nt.zpp_pool=a}return this},clear:function(){for(;null!=this.zpp_inner.vertices;){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var t=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}this.zpp_inner.vertices=n;var i=e;if(null!=i.wrap){i.wrap.zpp_inner._inuse=!1;var l=i.wrap,r=l.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var p=l;p.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=p:Cl.poolVec2=p,Cl.nextVec2=p,p.zpp_disp=!0;var s=a;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Ct.zpp_pool,Ct.zpp_pool=s,i.wrap=null}i.prev=i.next=null,i.next=nt.zpp_pool,nt.zpp_pool=i}return this},copy:function(){var n=vn.get(),e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var l,r=i,a=r.x,p=r.y;null==nt.zpp_pool?l=new nt:(l=nt.zpp_pool,nt.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=a,l.y=p;var s=l;if(null==n.zpp_inner.vertices?n.zpp_inner.vertices=s.prev=s.next=s:(s.prev=n.zpp_inner.vertices,s.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=s,n.zpp_inner.vertices.next=s),n.zpp_inner.vertices=s,(i=i.next)==t)break}return n.skipForward(1)},dispose:function(){this.clear();var n=this;n.zpp_pool=null,null!=Cl.nextGeomPoly?Cl.nextGeomPoly.zpp_pool=n:Cl.poolGeomPoly=n,Cl.nextGeomPoly=n,n.zpp_disp=!0},toString:function(){var n="GeomPoly[",e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var l=i;if(l!=this.zpp_inner.vertices&&(n+=","),n+="{"+l.x+","+l.y+"}",(i=i.next)==t)break}return n+"]"},area:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var l=i;if(n+=l.x*(l.next.y-l.prev.y),(i=i.next)==t)break}var r=.5*n;return 0>r?-r:r},winding:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==ye.Winding_UNDEFINED&&(ye.internal=!0,ye.Winding_UNDEFINED=new An,ye.internal=!1),ye.Winding_UNDEFINED;var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var l=i;if(n+=l.x*(l.next.y-l.prev.y),(i=i.next)==t)break}var r=.5*n;return r>0?(null==ye.Winding_CLOCKWISE&&(ye.internal=!0,ye.Winding_CLOCKWISE=new An,ye.internal=!1),ye.Winding_CLOCKWISE):0==r?(null==ye.Winding_UNDEFINED&&(ye.internal=!0,ye.Winding_UNDEFINED=new An,ye.internal=!1),ye.Winding_UNDEFINED):(null==ye.Winding_ANTICLOCKWISE&&(ye.internal=!0,ye.Winding_ANTICLOCKWISE=new An,ye.internal=!1),ye.Winding_ANTICLOCKWISE)},contains:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.y,r=!1,a=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=a)for(var s=a;;){var o=s,h=o.prev;if(!(l>o.y&&h.y>=l||l>h.y&&o.y>=l)||o.x>t&&h.x>t||t>o.x+(l-o.y)/(h.y-o.y)*(h.x-o.x)&&(r=!r),(s=s.next)==p)break}var _=r;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return _},isClockwise:function(){var n=this.winding();return null==ye.Winding_CLOCKWISE&&(ye.internal=!0,ye.Winding_CLOCKWISE=new An,ye.internal=!1),n==ye.Winding_CLOCKWISE},isConvex:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var n=!1,e=!1,t=!0,i=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=i)for(var r=i;;){var a=r,p=a.prev,s=a.next,o=0,h=0;o=s.x-a.x,h=s.y-a.y;var _=0,u=0;_=a.x-p.x,u=a.y-p.y;var d=u*o-_*h;if(d>0?e=!0:0>d&&(n=!0),e&&n){t=!1;break}if((r=r.next)==l)break}return t},isSimple:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||vt.isSimple(this.zpp_inner.vertices)},isMonotone:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||st.isMonotone(this.zpp_inner.vertices)},isDegenerate:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<f.epsilon},simplify:function(n){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var e=ft.simplify(this.zpp_inner.vertices,n),t=vn.get();return t.zpp_inner.vertices=e,t},simpleDecomposition:function(n){var e=this.zpp_inner.vertices;null==ht.sharedGVList&&(ht.sharedGVList=new oi);for(var t=vt.decompose(e,ht.sharedGVList),i=null==n?new yn:n;null!=t.head;){var l=t.pop_unsafe(),r=vn.get();r.zpp_inner.vertices=l,i.zpp_inner.reverse_flag?i.push(r):i.unshift(r)}return i},monotoneDecomposition:function(n){var e=this.zpp_inner.vertices;null==st.sharedPPoly&&(st.sharedPPoly=new ht);var t=st.decompose(e,st.sharedPPoly);null==ht.sharedGVList&&(ht.sharedGVList=new oi);for(var i=t.extract(ht.sharedGVList),l=null==n?new yn:n;null!=i.head;){var r=i.pop_unsafe(),a=vn.get();a.zpp_inner.vertices=r,l.zpp_inner.reverse_flag?l.push(a):l.unshift(a)}return l},convexDecomposition:function(n,e){null==n&&(n=!1);var t=this.zpp_inner.vertices;null==st.sharedPPoly&&(st.sharedPPoly=new ht);var i=st.decompose(t,st.sharedPPoly);null==ht.sharedPPList&&(ht.sharedPPList=new si);for(var l=i.extract_partitions(ht.sharedPPList),r=null==e?new yn:e;null!=l.head;){var a=l.pop_unsafe();wt.triangulate(a),n&&wt.optimise(a),Xe.optimise(a),null==ht.sharedGVList&&(ht.sharedGVList=new oi);var p=a.extract(ht.sharedGVList),s=a;for(s.next=ht.zpp_pool,ht.zpp_pool=s;null!=p.head;){var o=p.pop_unsafe(),h=vn.get();h.zpp_inner.vertices=o,r.zpp_inner.reverse_flag?r.push(h):r.unshift(h)}}return r},triangularDecomposition:function(n,e){null==n&&(n=!1);var t=this.zpp_inner.vertices;null==st.sharedPPoly&&(st.sharedPPoly=new ht);var i=st.decompose(t,st.sharedPPoly);null==ht.sharedPPList&&(ht.sharedPPList=new si);for(var l=i.extract_partitions(ht.sharedPPList),r=null==e?new yn:e;null!=l.head;){var a=l.pop_unsafe();wt.triangulate(a),n&&wt.optimise(a),null==ht.sharedGVList&&(ht.sharedGVList=new oi);var p=a.extract(ht.sharedGVList),s=a;for(s.next=ht.zpp_pool,ht.zpp_pool=s;null!=p.head;){var o=p.pop_unsafe(),h=vn.get();h.zpp_inner.vertices=o,r.zpp_inner.reverse_flag?r.push(h):r.unshift(h)}}return r},inflate:function(n){var e=vn.get(),t=this.winding();null==ye.Winding_CLOCKWISE&&(ye.internal=!0,ye.Winding_CLOCKWISE=new An,ye.internal=!1),t==ye.Winding_CLOCKWISE&&(n=-n);var i=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=i)for(var r=i;;){var a=r,p=a.prev,s=a.next,o=0,h=0,_=0,u=0;o=a.x-p.x,h=a.y-p.y,_=s.x-a.x,u=s.y-a.y;var d=0,c=0,x=0,v=0;d=o,c=h;var z=d*d+c*c,y=1/Math.sqrt(z),f=y;d*=f,c*=f;var m=d;d=-c,c=m;var b=n;d*=b,c*=b,x=_,v=u;var g=x*x+v*v,w=1/Math.sqrt(g),C=w;x*=C,v*=C;var M=x;x=-v,v=M;var k=n;x*=k,v*=k;var O=0,S=0;O=x-d,S=v-c;var P=u*O-_*S,T=0==P?0:P/(u*o-_*h),A=0,E=0;A=a.x+d,E=a.y+c;var I=T;A+=o*I,E+=h*I;var V;if(null==Cl.poolVec2?V=new On:(V=Cl.poolVec2,Cl.poolVec2=V.zpp_pool,V.zpp_pool=null,V.zpp_disp=!1,V==Cl.nextVec2&&(Cl.nextVec2=null)),null==V.zpp_inner){var L;null==Ct.zpp_pool?L=new Ct:(L=Ct.zpp_pool,Ct.zpp_pool=L.next,L.next=null),L.weak=!1,L._immutable=!1,L.x=A,L.y=E,V.zpp_inner=L,V.zpp_inner.outer=V}else{var N=V.zpp_inner;null!=N._isimmutable&&N._isimmutable();var D,j=V.zpp_inner;if(null!=j._validate&&j._validate(),V.zpp_inner.x==A){var F=V.zpp_inner;null!=F._validate&&F._validate(),D=V.zpp_inner.y==E}else D=!1;if(!D){V.zpp_inner.x=A,V.zpp_inner.y=E;var B=V.zpp_inner;null!=B._invalidate&&B._invalidate(B)}}if(V.zpp_inner.weak=!1,e.push(V),(r=r.next)==l)break}return e.skipForward(1)},cut:function(n,e,t,i,l){null==i&&(i=!1),null==t&&(t=!1),null!=this.zpp_inner.vertices&&null!=this.zpp_inner.vertices.next&&this.zpp_inner.vertices.prev!=this.zpp_inner.vertices.next&&vt.isSimple(this.zpp_inner.vertices);var r=Qe.run(this.zpp_inner.vertices,n,e,t,i,l);if(n.zpp_inner.weak){var a=n.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}if(e.zpp_inner.weak){var h=e.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var u=e;u.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=u:Cl.poolVec2=u,Cl.nextVec2=u,u.zpp_disp=!0;var d=_;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=Ct.zpp_pool,Ct.zpp_pool=d}return r},transform:function(n){var e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var l=i,r=n.zpp_inner.a*l.x+n.zpp_inner.b*l.y+n.zpp_inner.tx;if(l.y=n.zpp_inner.c*l.x+n.zpp_inner.d*l.y+n.zpp_inner.ty,l.x=r,(i=i.next)==t)break}return this},bounds:function(){var n=1e100,e=1e100,t=-1e100,i=-1e100,l=this.zpp_inner.vertices,r=this.zpp_inner.vertices;if(null!=l)for(var a=l;;){var p=a;if(n>p.x&&(n=p.x),e>p.y&&(e=p.y),p.x>t&&(t=p.x),p.y>i&&(i=p.y),(a=a.next)==r)break}return new _n(n,e,t-n,i-e)},top:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var r=l;if(n.y>r.y&&(n=r),(l=l.next)==i)break}if(null==n.wrap){var a,p=n.x,s=n.y;if(null==Cl.poolVec2?a=new On:(a=Cl.poolVec2,Cl.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==Cl.nextVec2&&(Cl.nextVec2=null)),null==a.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=p,o.y=s,a.zpp_inner=o,a.zpp_inner.outer=a}else{var h=a.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==p){var d=a.zpp_inner;null!=d._validate&&d._validate(),_=a.zpp_inner.y==s}else _=!1;if(!_){a.zpp_inner.x=p,a.zpp_inner.y=s;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}a.zpp_inner.weak=!1,n.wrap=a,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}return n.wrap},bottom:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var r=l;if(r.y>n.y&&(n=r),(l=l.next)==i)break}if(null==n.wrap){var a,p=n.x,s=n.y;if(null==Cl.poolVec2?a=new On:(a=Cl.poolVec2,Cl.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==Cl.nextVec2&&(Cl.nextVec2=null)),null==a.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=p,o.y=s,a.zpp_inner=o,a.zpp_inner.outer=a}else{var h=a.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==p){var d=a.zpp_inner;null!=d._validate&&d._validate(),_=a.zpp_inner.y==s}else _=!1;if(!_){a.zpp_inner.x=p,a.zpp_inner.y=s;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}a.zpp_inner.weak=!1,n.wrap=a,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}return n.wrap},left:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var r=l;if(n.x>r.x&&(n=r),(l=l.next)==i)break}if(null==n.wrap){var a,p=n.x,s=n.y;if(null==Cl.poolVec2?a=new On:(a=Cl.poolVec2,Cl.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==Cl.nextVec2&&(Cl.nextVec2=null)),null==a.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=p,o.y=s,a.zpp_inner=o,a.zpp_inner.outer=a}else{var h=a.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==p){var d=a.zpp_inner;null!=d._validate&&d._validate(),_=a.zpp_inner.y==s}else _=!1;if(!_){a.zpp_inner.x=p,a.zpp_inner.y=s;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}a.zpp_inner.weak=!1,n.wrap=a,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}return n.wrap},right:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var r=l;if(r.x>n.x&&(n=r),(l=l.next)==i)break}if(null==n.wrap){var a,p=n.x,s=n.y;if(null==Cl.poolVec2?a=new On:(a=Cl.poolVec2,Cl.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==Cl.nextVec2&&(Cl.nextVec2=null)),null==a.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=p,o.y=s,a.zpp_inner=o,a.zpp_inner.outer=a}else{var h=a.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==p){var d=a.zpp_inner;null!=d._validate&&d._validate(),_=a.zpp_inner.y==s}else _=!1;if(!_){a.zpp_inner.x=p,a.zpp_inner.y=s;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}a.zpp_inner.weak=!1,n.wrap=a,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}return n.wrap},__class__:vn};var zn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.GeomPolyIterator"]=zn,zn.__name__=["nape","geom","GeomPolyIterator"],zn.get=function(n){var e;if(null==zn.zpp_pool){xl.internal=!0;var t=new zn;xl.internal=!1,e=t}else{var i=zn.zpp_pool;zn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},zn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=zn.zpp_pool,zn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:zn};var yn=function(){this.zpp_inner=null,this.zpp_inner=new xl,this.zpp_inner.outer=this};l["nape.geom.GeomPolyList"]=yn,yn.__name__=["nape","geom","GeomPolyList"],yn.fromArray=function(n){for(var e=new yn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},yn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),zn.get(this)},copy:function(n){null==n&&(n=!1);var e=new yn;this.zpp_inner.valmod();for(var t=zn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=zn.zpp_pool,zn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=zn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=zn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=zn.zpp_pool,zn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=zn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:yn,__properties__:{get_length:"get_length"}};var fn=function(){};l["nape.geom.GeomVertexIterator"]=fn,fn.__name__=["nape","geom","GeomVertexIterator"],fn.prototype={zpp_inner:null,hasNext:function(){var n=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;if(this.zpp_inner.first=!1,!n){var e=this.zpp_inner;e.outer.zpp_inner=null,e.ptr=e.start=null,e.next=tt.zpp_pool,tt.zpp_pool=e}return n},next:function(){var n=this.zpp_inner.ptr;if(null==n.wrap){var e,i=n.x,l=n.y;if(null==Cl.poolVec2?e=new On:(e=Cl.poolVec2,Cl.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Cl.nextVec2&&(Cl.nextVec2=null)),null==e.zpp_inner){var r;null==Ct.zpp_pool?r=new Ct:(r=Ct.zpp_pool,Ct.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=l,e.zpp_inner=r,e.zpp_inner.outer=e}else{var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==i){var o=e.zpp_inner;null!=o._validate&&o._validate(),p=e.zpp_inner.y==l}else p=!1;if(!p){e.zpp_inner.x=i,e.zpp_inner.y=l;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=t(n,n.modwrap),n.wrap.zpp_inner._validate=t(n,n.getwrap)}var _=n.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,_},__class__:fn};var mn=function(){};l["nape.geom.MarchingSquares"]=mn,mn.__name__=["nape","geom","MarchingSquares"],mn.run=function(n,e,t,i,l,r,a){null==r&&(r=!0),null==i&&(i=2);var p=t.zpp_inner;if(null!=p._validate&&p._validate(),0<t.zpp_inner.x){var s=t.zpp_inner;null!=s._validate&&s._validate(),0>=t.zpp_inner.y}else!0;if(null!=l){var o=l.zpp_inner;if(null!=o._validate&&o._validate(),0<l.zpp_inner.x){var h=l.zpp_inner;null!=h._validate&&h._validate(),0>=l.zpp_inner.y}else!0}else!1;var _=null!=a?a:new yn;if(null==l){var u=e.zpp_inner;null!=u._validate&&u._validate();var d=e.zpp_inner.minx,c=e.zpp_inner;null!=c._validate&&c._validate();var x=e.zpp_inner.miny,v=e.zpp_inner.getmax(),z=v.zpp_inner;null!=z._validate&&z._validate();var y=v.zpp_inner.x,f=e.zpp_inner.getmax(),m=f.zpp_inner;null!=m._validate&&m._validate(),rt.run(n,d,x,y,f.zpp_inner.y,t,i,r,_)}else{var b=e.zpp_inner;null!=b._validate&&b._validate();var g=e.zpp_inner,w=g.maxx-g.minx,C=l.zpp_inner;null!=C._validate&&C._validate();var M=w/l.zpp_inner.x,k=e.zpp_inner;null!=k._validate&&k._validate();var O=e.zpp_inner,S=O.maxy-O.miny,P=l.zpp_inner;null!=P._validate&&P._validate();var T=S/l.zpp_inner.y,A=0|M,E=0|T;A!=M&&++A,E!=T&&++E;for(var I=0,V=A;V>I;){var L=I++,N=e.zpp_inner;null!=N._validate&&N._validate();var D=e.zpp_inner.minx,j=l.zpp_inner;null!=j._validate&&j._validate();var F,B=D+l.zpp_inner.x*L;if(L==A-1){var R=e.zpp_inner.getmax(),G=R.zpp_inner;null!=G._validate&&G._validate(),F=R.zpp_inner.x}else{var Y=l.zpp_inner;null!=Y._validate&&Y._validate(),F=B+l.zpp_inner.x}for(var U=0,Z=E;Z>U;){var q=U++,W=e.zpp_inner;null!=W._validate&&W._validate();var X=e.zpp_inner.miny,H=l.zpp_inner;null!=H._validate&&H._validate();var K,J=X+l.zpp_inner.y*q;if(q==E-1){var Q=e.zpp_inner.getmax(),$=Q.zpp_inner;null!=$._validate&&$._validate(),K=Q.zpp_inner.y}else{var nn=l.zpp_inner;null!=nn._validate&&nn._validate(),K=J+l.zpp_inner.y}rt.run(n,B,J,F,K,t,i,r,_)}}}if(t.zpp_inner.weak){var en=t.zpp_inner;null!=en._isimmutable&&en._isimmutable();var tn=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var ln=t;ln.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=ln:Cl.poolVec2=ln,Cl.nextVec2=ln,ln.zpp_disp=!0;var rn=tn;null!=rn.outer&&(rn.outer.zpp_inner=null,rn.outer=null),rn._isimmutable=null,rn._validate=null,rn._invalidate=null,rn.next=Ct.zpp_pool,Ct.zpp_pool=rn}if(null!=l&&l.zpp_inner.weak){var an=l.zpp_inner;null!=an._isimmutable&&an._isimmutable();var pn=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var sn=l;sn.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=sn:Cl.poolVec2=sn,Cl.nextVec2=sn,sn.zpp_disp=!0;var on=pn;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on._isimmutable=null,on._validate=null,on._invalidate=null,on.next=Ct.zpp_pool,Ct.zpp_pool=on}return _};var bn=function(n,e,t,i,l,r){null==r&&(r=0),null==l&&(l=0),null==i&&(i=1),null==t&&(t=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner=null,this.zpp_inner=at.get(),this.zpp_inner.outer=this,this.zpp_inner.a=n;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(),this.zpp_inner.b=e;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate(),this.zpp_inner.tx=l;var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(),this.zpp_inner.c=t;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(),this.zpp_inner.d=i;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate(),this.zpp_inner.ty=r;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate()};l["nape.geom.Mat23"]=bn,bn.__name__=["nape","geom","Mat23"],bn.rotation=function(n){var e=Math.cos(n),t=Math.sin(n);return new bn(e,-t,t,e,0,0)},bn.translation=function(n,e){return new bn(1,0,0,1,n,e)},bn.scale=function(n,e){return new bn(n,0,0,e,0,0)},bn.prototype={zpp_inner:null,get_a:function(){return this.zpp_inner.a},set_a:function(n){this.zpp_inner.a=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.a},get_b:function(){return this.zpp_inner.b},set_b:function(n){this.zpp_inner.b=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.b},get_c:function(){return this.zpp_inner.c},set_c:function(n){this.zpp_inner.c=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.c},get_d:function(){return this.zpp_inner.d},set_d:function(n){this.zpp_inner.d=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.d},get_tx:function(){return this.zpp_inner.tx},set_tx:function(n){this.zpp_inner.tx=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.tx},get_ty:function(){return this.zpp_inner.ty},set_ty:function(n){this.zpp_inner.ty=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.ty},copy:function(){return new bn(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},set:function(n){var e=n.zpp_inner;this.zpp_inner.setas(e.a,e.b,e.c,e.d,e.tx,e.ty);var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this},setAs:function(n,e,t,i,l,r){null==r&&(r=0),null==l&&(l=0),null==i&&(i=1),null==t&&(t=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner.setas(n,e,t,i,l,r);var a=this.zpp_inner;return null!=a._invalidate&&a._invalidate(),this},reset:function(){return this.setAs()},get_determinant:function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},singular:function(){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,e=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return 0>e&&(e=-e),n>f.illConditionedThreshold*e},inverse:function(){this.singular();var n=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new bn(this.zpp_inner.d*n,-this.zpp_inner.b*n,-this.zpp_inner.c*n,this.zpp_inner.a*n,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*n,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*n)},transpose:function(){return new bn(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},concat:function(n){var e=n;return new bn(e.zpp_inner.a*this.zpp_inner.a+e.zpp_inner.b*this.zpp_inner.c,e.zpp_inner.a*this.zpp_inner.b+e.zpp_inner.b*this.zpp_inner.d,e.zpp_inner.c*this.zpp_inner.a+e.zpp_inner.d*this.zpp_inner.c,e.zpp_inner.c*this.zpp_inner.b+e.zpp_inner.d*this.zpp_inner.d,e.zpp_inner.a*this.zpp_inner.tx+e.zpp_inner.b*this.zpp_inner.ty+e.zpp_inner.tx,e.zpp_inner.c*this.zpp_inner.tx+e.zpp_inner.d*this.zpp_inner.ty+e.zpp_inner.ty)},transform:function(n,e,t){null==t&&(t=!1),null==e&&(e=!1);var i;if(e){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x*this.zpp_inner.a,a=n.zpp_inner;null!=a._validate&&a._validate();var p=r+n.zpp_inner.y*this.zpp_inner.b,s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.x*this.zpp_inner.c,h=n.zpp_inner;null!=h._validate&&h._validate();var _,u=o+n.zpp_inner.y*this.zpp_inner.d;if(null==Cl.poolVec2?_=new On:(_=Cl.poolVec2,Cl.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==Cl.nextVec2&&(Cl.nextVec2=null)),null==_.zpp_inner){var d;null==Ct.zpp_pool?d=new Ct:(d=Ct.zpp_pool,Ct.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=p,d.y=u,_.zpp_inner=d,_.zpp_inner.outer=_}else{var c=_.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x,v=_.zpp_inner;if(null!=v._validate&&v._validate(),_.zpp_inner.x==p){var z=_.zpp_inner;null!=z._validate&&z._validate(),x=_.zpp_inner.y==u}else x=!1;if(!x){_.zpp_inner.x=p,_.zpp_inner.y=u;var y=_.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}_.zpp_inner.weak=t,i=_}else{var f=n.zpp_inner;null!=f._validate&&f._validate();var m=n.zpp_inner.x*this.zpp_inner.a,b=n.zpp_inner;null!=b._validate&&b._validate();var g=m+n.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,w=n.zpp_inner;null!=w._validate&&w._validate();var C=n.zpp_inner.x*this.zpp_inner.c,M=n.zpp_inner;null!=M._validate&&M._validate();var k,O=C+n.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty;if(null==Cl.poolVec2?k=new On:(k=Cl.poolVec2,Cl.poolVec2=k.zpp_pool,k.zpp_pool=null,k.zpp_disp=!1,k==Cl.nextVec2&&(Cl.nextVec2=null)),null==k.zpp_inner){var S;null==Ct.zpp_pool?S=new Ct:(S=Ct.zpp_pool,Ct.zpp_pool=S.next,S.next=null),S.weak=!1,S._immutable=!1,S.x=g,S.y=O,k.zpp_inner=S,k.zpp_inner.outer=k}else{var P=k.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T,A=k.zpp_inner;if(null!=A._validate&&A._validate(),k.zpp_inner.x==g){var E=k.zpp_inner;null!=E._validate&&E._validate(),T=k.zpp_inner.y==O}else T=!1;if(!T){k.zpp_inner.x=g,k.zpp_inner.y=O;var I=k.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}k.zpp_inner.weak=t,i=k}if(n.zpp_inner.weak){var V=n.zpp_inner;null!=V._isimmutable&&V._isimmutable();var L=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var N=n;N.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=N:Cl.poolVec2=N,Cl.nextVec2=N,N.zpp_disp=!0;var D=L;null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D._isimmutable=null,D._validate=null,D._invalidate=null,D.next=Ct.zpp_pool,Ct.zpp_pool=D}return i},inverseTransform:function(n,e,t){null==t&&(t=!1),null==e&&(e=!1),this.singular();var i,l=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);if(e){var r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x*this.zpp_inner.d,p=n.zpp_inner;null!=p._validate&&p._validate();var s=(a-n.zpp_inner.y*this.zpp_inner.b)*l,o=n.zpp_inner;null!=o._validate&&o._validate();var h=n.zpp_inner.y*this.zpp_inner.a,_=n.zpp_inner;null!=_._validate&&_._validate();var u,d=(h-n.zpp_inner.x*this.zpp_inner.c)*l;if(null==Cl.poolVec2?u=new On:(u=Cl.poolVec2,Cl.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Cl.nextVec2&&(Cl.nextVec2=null)),null==u.zpp_inner){var c;null==Ct.zpp_pool?c=new Ct:(c=Ct.zpp_pool,Ct.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=s,c.y=d,u.zpp_inner=c,u.zpp_inner.outer=u}else{var x=u.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==s){var y=u.zpp_inner;null!=y._validate&&y._validate(),v=u.zpp_inner.y==d}else v=!1;if(!v){u.zpp_inner.x=s,u.zpp_inner.y=d;var f=u.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}u.zpp_inner.weak=t,i=u}else{var m=n.zpp_inner;null!=m._validate&&m._validate();var b=n.zpp_inner.x-this.zpp_inner.tx,g=n.zpp_inner;null!=g._validate&&g._validate();var w,C=n.zpp_inner.y-this.zpp_inner.ty,M=(b*this.zpp_inner.d-C*this.zpp_inner.b)*l,k=(C*this.zpp_inner.a-b*this.zpp_inner.c)*l;if(null==Cl.poolVec2?w=new On:(w=Cl.poolVec2,Cl.poolVec2=w.zpp_pool,w.zpp_pool=null,w.zpp_disp=!1,w==Cl.nextVec2&&(Cl.nextVec2=null)),null==w.zpp_inner){var O;null==Ct.zpp_pool?O=new Ct:(O=Ct.zpp_pool,Ct.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=M,O.y=k,w.zpp_inner=O,w.zpp_inner.outer=w}else{var S=w.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P,T=w.zpp_inner;if(null!=T._validate&&T._validate(),w.zpp_inner.x==M){var A=w.zpp_inner;null!=A._validate&&A._validate(),P=w.zpp_inner.y==k}else P=!1;if(!P){w.zpp_inner.x=M,w.zpp_inner.y=k;var E=w.zpp_inner;null!=E._invalidate&&E._invalidate(E)}}w.zpp_inner.weak=t,i=w}if(n.zpp_inner.weak){var I=n.zpp_inner;null!=I._isimmutable&&I._isimmutable();var V=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var L=n;L.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=L:Cl.poolVec2=L,Cl.nextVec2=L,L.zpp_disp=!0;var N=V;null!=N.outer&&(N.outer.zpp_inner=null,N.outer=null),N._isimmutable=null,N._validate=null,N._invalidate=null,N.next=Ct.zpp_pool,Ct.zpp_pool=N}return i},toString:function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},equiorthogonal:function(){if(this.singular())return!1;var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(f.epsilon>n*n){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return f.epsilon>e*e}return!1},orthogonal:function(){var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(f.epsilon>n*n){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,t=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return f.epsilon>e*e&&f.epsilon>t*t}return!1},equiorthogonalise:function(){if(!this.equiorthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d),t=(n+e)/2;n=t/n,e=t/e;var i=this,l=i.zpp_inner.a*n;i.zpp_inner.a=l;var r=i.zpp_inner;null!=r._invalidate&&r._invalidate();var a=this,p=a.zpp_inner.c*n;a.zpp_inner.c=p;var s=a.zpp_inner;null!=s._invalidate&&s._invalidate();var o=this,h=o.zpp_inner.b*e;o.zpp_inner.b=h;var _=o.zpp_inner;null!=_._invalidate&&_._invalidate();var u=this,d=u.zpp_inner.d*e;u.zpp_inner.d=d;var c=u.zpp_inner;null!=c._invalidate&&c._invalidate();var x=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,v=.25*Math.PI-.5*Math.acos(x/(t*t));this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(v=-v);var z=Math.sin(v),y=Math.cos(v),f=this.zpp_inner.a*y-this.zpp_inner.c*z,m=this.zpp_inner.b*y+this.zpp_inner.d*z,b=this.zpp_inner.c*y+this.zpp_inner.a*z;this.zpp_inner.c=b;var g=this.zpp_inner;null!=g._invalidate&&g._invalidate(),this.zpp_inner.a=f;var w=this.zpp_inner;null!=w._invalidate&&w._invalidate();var C=this.zpp_inner.d*y-this.zpp_inner.b*z;this.zpp_inner.d=C;var M=this.zpp_inner;null!=M._invalidate&&M._invalidate(),this.zpp_inner.b=m;var k=this.zpp_inner;null!=k._invalidate&&k._invalidate();var O=this.zpp_inner;null!=O._invalidate&&O._invalidate()}return this},orthogonalise:function(){if(!this.orthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d);n=1/n,e=1/e;var t=this,i=t.zpp_inner.a*n;t.zpp_inner.a=i;var l=t.zpp_inner;null!=l._invalidate&&l._invalidate();var r=this,a=r.zpp_inner.c*n;r.zpp_inner.c=a;var p=r.zpp_inner;null!=p._invalidate&&p._invalidate();var s=this,o=s.zpp_inner.b*e;s.zpp_inner.b=o;var h=s.zpp_inner;null!=h._invalidate&&h._invalidate();var _=this,u=_.zpp_inner.d*e;_.zpp_inner.d=u;var d=_.zpp_inner;null!=d._invalidate&&d._invalidate();var c=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,x=.25*Math.PI-.5*Math.acos(c/1);this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(x=-x);var v=Math.sin(x),z=Math.cos(x),y=this.zpp_inner.a*z-this.zpp_inner.c*v,f=this.zpp_inner.b*z+this.zpp_inner.d*v,m=this.zpp_inner.c*z+this.zpp_inner.a*v;this.zpp_inner.c=m;var b=this.zpp_inner;null!=b._invalidate&&b._invalidate(),this.zpp_inner.a=y;var g=this.zpp_inner;null!=g._invalidate&&g._invalidate();var w=this.zpp_inner.d*z-this.zpp_inner.b*v;this.zpp_inner.d=w;var C=this.zpp_inner;null!=C._invalidate&&C._invalidate(),this.zpp_inner.b=f;var M=this.zpp_inner;null!=M._invalidate&&M._invalidate();var k=this.zpp_inner;null!=k._invalidate&&k._invalidate()}return this},__class__:bn,__properties__:{get_determinant:"get_determinant",set_ty:"set_ty",get_ty:"get_ty",set_tx:"set_tx",get_tx:"get_tx",set_d:"set_d",get_d:"get_d",set_c:"set_c",get_c:"get_c",set_b:"set_b",get_b:"get_b",set_a:"set_a",get_a:"get_a"}};var gn=function(n,e){this.zpp_inner=null,this.zpp_inner=new pt(n,e),this.zpp_inner.outer=this};l["nape.geom.MatMN"]=gn,gn.__name__=["nape","geom","MatMN"],gn.prototype={zpp_inner:null,get_rows:function(){return this.zpp_inner.m},get_cols:function(){return this.zpp_inner.n},x:function(n,e){return this.zpp_inner.x[n*this.zpp_inner.n+e]},setx:function(n,e,t){return this.zpp_inner.x[n*this.zpp_inner.n+e]=t},toString:function(){for(var n="{ ",e=!0,t=0,i=this.zpp_inner.m;i>t;){var l=t++;e||(n+="; "),e=!1;for(var r=0,a=this.zpp_inner.n;a>r;){var p=r++;n+=this.zpp_inner.x[l*this.zpp_inner.n+p]+" "}}return n+="}"},transpose:function(){for(var n=new gn(this.zpp_inner.n,this.zpp_inner.m),e=0,t=this.zpp_inner.m;t>e;)for(var i=e++,l=0,r=this.zpp_inner.n;r>l;){var a=l++;n.zpp_inner.x[a*n.zpp_inner.n+i]=this.zpp_inner.x[i*this.zpp_inner.n+a]}return n},mul:function(n){for(var e=n,t=new gn(this.zpp_inner.m,e.zpp_inner.n),i=0,l=this.zpp_inner.m;l>i;)for(var r=i++,a=0,p=e.zpp_inner.n;p>a;){for(var s=a++,o=0,h=0,_=this.zpp_inner.n;_>h;){var u=h++;o+=this.zpp_inner.x[r*this.zpp_inner.n+u]*e.zpp_inner.x[u*e.zpp_inner.n+s]}t.zpp_inner.x[r*t.zpp_inner.n+s]=o}return t},__class__:gn,__properties__:{get_cols:"get_cols",get_rows:"get_rows"}};var wn=function(n,e){this.zpp_inner=null,this.zpp_inner=new _t;var t=this.zpp_inner.origin,i=t.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,a=n.zpp_inner;null!=a._validate&&a._validate();var p=n.zpp_inner.y,s=t.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o,h=t.zpp_inner;if(null!=h._validate&&h._validate(),t.zpp_inner.x==r){var _=t.zpp_inner;null!=_._validate&&_._validate(),o=t.zpp_inner.y==p}else o=!1;if(!o){t.zpp_inner.x=r,t.zpp_inner.y=p;var u=t.zpp_inner;null!=u._invalidate&&u._invalidate(u)}if(n.zpp_inner.weak){var d=n.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var x=n;x.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=x:Cl.poolVec2=x,Cl.nextVec2=x,x.zpp_disp=!0;var v=c;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Ct.zpp_pool,Ct.zpp_pool=v}var z=this.zpp_inner.direction,y=z.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=e.zpp_inner;null!=f._validate&&f._validate();var m=e.zpp_inner.x,b=e.zpp_inner;null!=b._validate&&b._validate();var g=e.zpp_inner.y,w=z.zpp_inner;null!=w._isimmutable&&w._isimmutable();var C,M=z.zpp_inner;if(null!=M._validate&&M._validate(),z.zpp_inner.x==m){var k=z.zpp_inner;null!=k._validate&&k._validate(),C=z.zpp_inner.y==g}else C=!1;if(!C){z.zpp_inner.x=m,z.zpp_inner.y=g;var O=z.zpp_inner;null!=O._invalidate&&O._invalidate(O)}if(e.zpp_inner.weak){var S=e.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var T=e;T.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=T:Cl.poolVec2=T,Cl.nextVec2=T,T.zpp_disp=!0;var A=P;null!=A.outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=Ct.zpp_pool,Ct.zpp_pool=A}this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=Infinity};l["nape.geom.Ray"]=wn,wn.__name__=["nape","geom","Ray"],wn.fromSegment=function(n,e){var t=e.sub(n,!0),i=new wn(n,t),l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,a=n.zpp_inner;null!=a._validate&&a._validate();var p=n.zpp_inner.y,s=e.zpp_inner;null!=s._validate&&s._validate();var o=e.zpp_inner.x,h=e.zpp_inner;null!=h._validate&&h._validate();var _=0,u=0;_=r-o,u=p-e.zpp_inner.y;var d=Math.sqrt(_*_+u*u);if(i.zpp_inner.maxdist=d,n.zpp_inner.weak){var c=n.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var v=n;v.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=v:Cl.poolVec2=v,Cl.nextVec2=v,v.zpp_disp=!0;var z=x;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Ct.zpp_pool,Ct.zpp_pool=z}if(e.zpp_inner.weak){var y=e.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var m=e;m.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=m:Cl.poolVec2=m,Cl.nextVec2=m,m.zpp_disp=!0;var b=f;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Ct.zpp_pool,Ct.zpp_pool=b}return i},wn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_origin:function(){return this.zpp_inner.origin},set_origin:function(n){var e=this.zpp_inner.origin,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return this.zpp_inner.origin},get_direction:function(){return this.zpp_inner.direction},set_direction:function(n){var e=this.zpp_inner.direction,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},get_maxDistance:function(){return this.zpp_inner.maxdist},set_maxDistance:function(n){return this.zpp_inner.maxdist=n},aabb:function(){return this.zpp_inner.rayAABB().wrapper()},at:function(n,e){null==e&&(e=!1),this.zpp_inner.validate_dir();var t=this.zpp_inner.origin,i=t.zpp_inner;null!=i._validate&&i._validate();var l=t.zpp_inner.x+n*this.zpp_inner.dirx,r=this.zpp_inner.origin,a=r.zpp_inner;null!=a._validate&&a._validate();var p,s=r.zpp_inner.y+n*this.zpp_inner.diry;if(null==Cl.poolVec2?p=new On:(p=Cl.poolVec2,Cl.poolVec2=p.zpp_pool,p.zpp_pool=null,p.zpp_disp=!1,p==Cl.nextVec2&&(Cl.nextVec2=null)),null==p.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=l,o.y=s,p.zpp_inner=o,p.zpp_inner.outer=p}else{var h=p.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=p.zpp_inner;if(null!=u._validate&&u._validate(),p.zpp_inner.x==l){var d=p.zpp_inner;null!=d._validate&&d._validate(),_=p.zpp_inner.y==s}else _=!1;if(!_){p.zpp_inner.x=l,p.zpp_inner.y=s;var c=p.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}return p.zpp_inner.weak=e,p},copy:function(){var n=new wn(this.zpp_inner.origin,this.zpp_inner.direction),e=this.zpp_inner.maxdist;return n.zpp_inner.maxdist=e,n},__class__:wn,__properties__:{set_maxDistance:"set_maxDistance",get_maxDistance:"get_maxDistance",set_direction:"set_direction",get_direction:"get_direction",set_origin:"set_origin",get_origin:"get_origin",get_userData:"get_userData"}};var Cn=function(){this.zpp_inner=null};l["nape.geom.RayResult"]=Cn,Cn.__name__=["nape","geom","RayResult"],Cn.prototype={zpp_inner:null,get_normal:function(){return this.zpp_inner.normal},get_distance:function(){return this.zpp_inner.toiDistance},get_inner:function(){return this.zpp_inner.inner},get_shape:function(){return this.zpp_inner.shape},dispose:function(){this.zpp_inner.free()},toString:function(){return"{ shape: "+h.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+h.string(this.zpp_inner.inner)+" }"},__class__:Cn,__properties__:{get_shape:"get_shape",get_inner:"get_inner",get_distance:"get_distance",get_normal:"get_normal"}};var Mn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.RayResultIterator"]=Mn,Mn.__name__=["nape","geom","RayResultIterator"],Mn.get=function(n){var e;if(null==Mn.zpp_pool){vl.internal=!0;var t=new Mn;vl.internal=!1,e=t}else{var i=Mn.zpp_pool;Mn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Mn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Mn.zpp_pool,Mn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Mn};var kn=function(){this.zpp_inner=null,this.zpp_inner=new vl,this.zpp_inner.outer=this};l["nape.geom.RayResultList"]=kn,kn.__name__=["nape","geom","RayResultList"],kn.fromArray=function(n){for(var e=new kn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},kn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Mn.get(this)},copy:function(n){null==n&&(n=!1);var e=new kn;this.zpp_inner.valmod();for(var t=Mn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Mn.zpp_pool,Mn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Mn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Mn.zpp_pool,Mn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Mn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Mn.zpp_pool,Mn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Mn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Mn.zpp_pool,Mn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=Mn.zpp_pool,Mn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:kn,__properties__:{get_length:"get_length"}};var On=function(n,e){null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null;var t;null==Ct.zpp_pool?t=new Ct:(t=Ct.zpp_pool,Ct.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=n,t.y=e,this.zpp_inner=t,this.zpp_inner.outer=this};l["nape.geom.Vec2"]=On,On.__name__=["nape","geom","Vec2"],On.weak=function(n,e){null==e&&(e=0),null==n&&(n=0);var t;if(null==Cl.poolVec2?t=new On:(t=Cl.poolVec2,Cl.poolVec2=t.zpp_pool,t.zpp_pool=null,t.zpp_disp=!1,t==Cl.nextVec2&&(Cl.nextVec2=null)),null==t.zpp_inner){var i;null==Ct.zpp_pool?i=new Ct:(i=Ct.zpp_pool,Ct.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=e,t.zpp_inner=i,t.zpp_inner.outer=t}else{var l=t.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r,a=t.zpp_inner;if(null!=a._validate&&a._validate(),t.zpp_inner.x==n){var p=t.zpp_inner;null!=p._validate&&p._validate(),r=t.zpp_inner.y==e}else r=!1;if(!r){t.zpp_inner.x=n,t.zpp_inner.y=e;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}return t.zpp_inner.weak=!0,t},On.get=function(n,e,t){null==t&&(t=!1),null==e&&(e=0),null==n&&(n=0);var i;if(null==Cl.poolVec2?i=new On:(i=Cl.poolVec2,Cl.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==Cl.nextVec2&&(Cl.nextVec2=null)),null==i.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e,i.zpp_inner=l,i.zpp_inner.outer=i}else{var r=i.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=i.zpp_inner;if(null!=p._validate&&p._validate(),i.zpp_inner.x==n){var s=i.zpp_inner;null!=s._validate&&s._validate(),a=i.zpp_inner.y==e}else a=!1;if(!a){i.zpp_inner.x=n,i.zpp_inner.y=e;var o=i.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}return i.zpp_inner.weak=t,i},On.fromPolar=function(n,e,t){null==t&&(t=!1);var i,l=n*Math.cos(e),r=n*Math.sin(e);if(null==Cl.poolVec2?i=new On:(i=Cl.poolVec2,Cl.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==Cl.nextVec2&&(Cl.nextVec2=null)),null==i.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=l,a.y=r,i.zpp_inner=a,i.zpp_inner.outer=i}else{var p=i.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=i.zpp_inner;if(null!=o._validate&&o._validate(),i.zpp_inner.x==l){var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==r}else s=!1;if(!s){i.zpp_inner.x=l,i.zpp_inner.y=r;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return i.zpp_inner.weak=t,i},On.dsq=function(n,e){var t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._validate&&a._validate();var p=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var o=0,h=0;o=i-p,h=r-e.zpp_inner.y;var _=o*o+h*h;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}if(e.zpp_inner.weak){var v=e.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var y=e;y.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=y:Cl.poolVec2=y,Cl.nextVec2=y,y.zpp_disp=!0;var f=z;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ct.zpp_pool,Ct.zpp_pool=f}return _},On.distance=function(n,e){var t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._validate&&a._validate();var p=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var o=0,h=0;o=i-p,h=r-e.zpp_inner.y;var _=Math.sqrt(o*o+h*h);if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}if(e.zpp_inner.weak){var v=e.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var y=e;y.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=y:Cl.poolVec2=y,Cl.nextVec2=y,y.zpp_disp=!0;var f=z;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ct.zpp_pool,Ct.zpp_pool=f}return _},On.prototype={zpp_inner:null,zpp_pool:null,zpp_disp:null,dispose:function(){var n=this.zpp_inner;null!=n._isimmutable&&n._isimmutable();var e=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;var t=this;t.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=t:Cl.poolVec2=t,Cl.nextVec2=t,t.zpp_disp=!0;var i=e;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Ct.zpp_pool,Ct.zpp_pool=i},copy:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var l,r=this.zpp_inner.y;if(null==Cl.poolVec2?l=new On:(l=Cl.poolVec2,Cl.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Cl.nextVec2&&(Cl.nextVec2=null)),null==l.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=t,a.y=r,l.zpp_inner=a,l.zpp_inner.outer=l}else{var p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==t){var h=l.zpp_inner;null!=h._validate&&h._validate(),s=l.zpp_inner.y==r}else s=!1;if(!s){l.zpp_inner.x=t,l.zpp_inner.y=r;var _=l.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return l.zpp_inner.weak=n,l},get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},set_x:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;if(null!=t._validate&&t._validate(),this.zpp_inner.x!=n){this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var l=this.zpp_inner;return null!=l._validate&&l._validate(),this.zpp_inner.x},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},set_y:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;if(null!=t._validate&&t._validate(),this.zpp_inner.y!=n){this.zpp_inner.y=n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var l=this.zpp_inner;return null!=l._validate&&l._validate(),this.zpp_inner.y},get_length:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,a=this.zpp_inner;return null!=a._validate&&a._validate(),Math.sqrt(i+r*this.zpp_inner.y)},set_length:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner;null!=i._validate&&i._validate();var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.x,s=this.zpp_inner;null!=s._validate&&s._validate();var o=p*this.zpp_inner.x,h=this.zpp_inner;null!=h._validate&&h._validate();var _=this.zpp_inner.y,u=this.zpp_inner;null!=u._validate&&u._validate();var d=n/Math.sqrt(o+_*this.zpp_inner.y),c=this,x=c.zpp_inner;null!=x._validate&&x._validate();var v=c.zpp_inner.x*d,z=c.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y=c.zpp_inner;if(null!=y._validate&&y._validate(),c.zpp_inner.x!=v){c.zpp_inner.x=v;var f=c.zpp_inner;null!=f._invalidate&&f._invalidate(f)}var m=c.zpp_inner;null!=m._validate&&m._validate();var b=this,g=b.zpp_inner;null!=g._validate&&g._validate();var w=b.zpp_inner.y*d,C=b.zpp_inner;null!=C._isimmutable&&C._isimmutable();var M=b.zpp_inner;if(null!=M._validate&&M._validate(),b.zpp_inner.y!=w){b.zpp_inner.y=w;var k=b.zpp_inner;null!=k._invalidate&&k._invalidate(k)}var O=b.zpp_inner;null!=O._validate&&O._validate();var S=this.zpp_inner;null!=S._invalidate&&S._invalidate(S);var P=this.zpp_inner;null!=P._validate&&P._validate();var T=this.zpp_inner.x,A=this.zpp_inner;null!=A._validate&&A._validate();var E=T*this.zpp_inner.x,I=this.zpp_inner;null!=I._validate&&I._validate();var V=this.zpp_inner.y,L=this.zpp_inner;return null!=L._validate&&L._validate(),Math.sqrt(E+V*this.zpp_inner.y)},lsq:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,a=this.zpp_inner;return null!=a._validate&&a._validate(),i+r*this.zpp_inner.y},set:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,a=this.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p,s=this.zpp_inner;if(null!=s._validate&&s._validate(),this.zpp_inner.x==i){var o=this.zpp_inner;null!=o._validate&&o._validate(),p=this.zpp_inner.y==r}else p=!1;if(!p){this.zpp_inner.x=i,this.zpp_inner.y=r;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate(h)}var _=this;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return _},setxy:function(n,e){var t=this.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i,l=this.zpp_inner;if(null!=l._validate&&l._validate(),this.zpp_inner.x==n){var r=this.zpp_inner;null!=r._validate&&r._validate(),i=this.zpp_inner.y==e}else i=!1;if(!i){this.zpp_inner.x=n,this.zpp_inner.y=e;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(a)}return this},get_angle:function(){var n,e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;if(null!=i._validate&&i._validate(),t==this.zpp_inner.y){var l=this.zpp_inner;null!=l._validate&&l._validate(),n=0==this.zpp_inner.x}else n=!1;if(n)return 0;var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,p=this.zpp_inner;return null!=p._validate&&p._validate(),Math.atan2(a,this.zpp_inner.x)},set_angle:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=i*this.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=Math.sqrt(r+p*this.zpp_inner.y),h=o*Math.cos(n),_=o*Math.sin(n),u=this.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d,c=this.zpp_inner;if(null!=c._validate&&c._validate(),this.zpp_inner.x==h){var x=this.zpp_inner;null!=x._validate&&x._validate(),d=this.zpp_inner.y==_}else d=!1;if(!d){this.zpp_inner.x=h,this.zpp_inner.y=_;var v=this.zpp_inner;null!=v._invalidate&&v._invalidate(v)}var z,y=this.zpp_inner;null!=y._validate&&y._validate();var f=this.zpp_inner.x,m=this.zpp_inner;if(null!=m._validate&&m._validate(),f==this.zpp_inner.y){var b=this.zpp_inner;null!=b._validate&&b._validate(),z=0==this.zpp_inner.x}else z=!1;if(z)return 0;var g=this.zpp_inner;null!=g._validate&&g._validate();var w=this.zpp_inner.y,C=this.zpp_inner;return null!=C._validate&&C._validate(),Math.atan2(w,this.zpp_inner.x)},rotate:function(n){var e=this.zpp_inner;if(null!=e._isimmutable&&e._isimmutable(),n%(2*Math.PI)!=0){var t=Math.sin(n),i=Math.cos(n),l=i*this.zpp_inner.x-t*this.zpp_inner.y;this.zpp_inner.y=this.zpp_inner.x*t+this.zpp_inner.y*i,this.zpp_inner.x=l;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(r)}return this},reflect:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=i*this.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate(),Math.sqrt(r+p*this.zpp_inner.y);var o=this.zpp_inner;null!=o._validate&&o._validate();var h=this.zpp_inner.x,_=this.zpp_inner;null!=_._validate&&_._validate();var u,d=this.zpp_inner.y;if(null==Cl.poolVec2?u=new On:(u=Cl.poolVec2,Cl.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Cl.nextVec2&&(Cl.nextVec2=null)),null==u.zpp_inner){var c;null==Ct.zpp_pool?c=new Ct:(c=Ct.zpp_pool,Ct.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=h,c.y=d,u.zpp_inner=c,u.zpp_inner.outer=u}else{var x=u.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==h){var y=u.zpp_inner;null!=y._validate&&y._validate(),v=u.zpp_inner.y==d}else v=!1;if(!v){u.zpp_inner.x=h,u.zpp_inner.y=d;var f=u.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}u.zpp_inner.weak=!0;var m=u.normalise(),b=n.sub(m.muleq(2*m.dot(n)),e);if(n.zpp_inner.weak){var g=n.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var C=n;C.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=C:Cl.poolVec2=C,Cl.nextVec2=C,C.zpp_disp=!0;var M=w;null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=Ct.zpp_pool,Ct.zpp_pool=M}return b},normalise:function(){var n=this.zpp_inner;null!=n._isimmutable&&n._isimmutable();var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var l=t*this.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,p=this.zpp_inner;null!=p._validate&&p._validate(),Math.sqrt(l+a*this.zpp_inner.y);var s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.x,h=this.zpp_inner;null!=h._validate&&h._validate();var _=o*this.zpp_inner.x,u=this.zpp_inner;null!=u._validate&&u._validate();var d=this.zpp_inner.y,c=this.zpp_inner;null!=c._validate&&c._validate();var x=_+d*this.zpp_inner.y,v=1/Math.sqrt(x),z=v,y=this,f=y.zpp_inner;null!=f._validate&&f._validate();var m=y.zpp_inner.x*z,b=y.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=y.zpp_inner;if(null!=g._validate&&g._validate(),y.zpp_inner.x!=m){y.zpp_inner.x=m;var w=y.zpp_inner;null!=w._invalidate&&w._invalidate(w)}var C=y.zpp_inner;null!=C._validate&&C._validate();var M=this,k=M.zpp_inner;null!=k._validate&&k._validate();var O=M.zpp_inner.y*z,S=M.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P=M.zpp_inner;if(null!=P._validate&&P._validate(),M.zpp_inner.y!=O){M.zpp_inner.y=O;var T=M.zpp_inner;null!=T._invalidate&&T._invalidate(T)}var A=M.zpp_inner;null!=A._validate&&A._validate();var E=this.zpp_inner;return null!=E._invalidate&&E._invalidate(E),this},unit:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var l=t*this.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,p=this.zpp_inner;null!=p._validate&&p._validate(),Math.sqrt(l+a*this.zpp_inner.y);var s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.x,h=this.zpp_inner;null!=h._validate&&h._validate();var _=o*this.zpp_inner.x,u=this.zpp_inner;null!=u._validate&&u._validate();var d=this.zpp_inner.y,c=this.zpp_inner;null!=c._validate&&c._validate();var x=1/Math.sqrt(_+d*this.zpp_inner.y),v=this.zpp_inner;null!=v._validate&&v._validate();var z=this.zpp_inner.x*x,y=this.zpp_inner;null!=y._validate&&y._validate();var f,m=this.zpp_inner.y*x;if(null==Cl.poolVec2?f=new On:(f=Cl.poolVec2,Cl.poolVec2=f.zpp_pool,f.zpp_pool=null,f.zpp_disp=!1,f==Cl.nextVec2&&(Cl.nextVec2=null)),null==f.zpp_inner){var b;null==Ct.zpp_pool?b=new Ct:(b=Ct.zpp_pool,Ct.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=z,b.y=m,f.zpp_inner=b,f.zpp_inner.outer=f}else{var g=f.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w,C=f.zpp_inner;if(null!=C._validate&&C._validate(),f.zpp_inner.x==z){var M=f.zpp_inner;null!=M._validate&&M._validate(),w=f.zpp_inner.y==m}else w=!1;if(!w){f.zpp_inner.x=z,f.zpp_inner.y=m;var k=f.zpp_inner;null!=k._invalidate&&k._invalidate(k)}}return f.zpp_inner.weak=n,f},add:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=i+n.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o,h=p+n.zpp_inner.y;if(null==Cl.poolVec2?o=new On:(o=Cl.poolVec2,Cl.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Cl.nextVec2&&(Cl.nextVec2=null)),null==o.zpp_inner){var _;null==Ct.zpp_pool?_=new Ct:(_=Ct.zpp_pool,Ct.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=r,_.y=h,o.zpp_inner=_,o.zpp_inner.outer=o}else{var u=o.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d,c=o.zpp_inner;if(null!=c._validate&&c._validate(),o.zpp_inner.x==r){var x=o.zpp_inner;null!=x._validate&&x._validate(),d=o.zpp_inner.y==h}else d=!1;if(!d){o.zpp_inner.x=r,o.zpp_inner.y=h;var v=o.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}o.zpp_inner.weak=e;var z=o;if(n.zpp_inner.weak){var y=n.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var m=n;m.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=m:Cl.poolVec2=m,Cl.nextVec2=m,m.zpp_disp=!0;var b=f;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Ct.zpp_pool,Ct.zpp_pool=b}return z},addMul:function(n,e,t){null==t&&(t=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var l=this.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=l+n.zpp_inner.x*e,p=this.zpp_inner;null!=p._validate&&p._validate();var s=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var h,_=s+n.zpp_inner.y*e;if(null==Cl.poolVec2?h=new On:(h=Cl.poolVec2,Cl.poolVec2=h.zpp_pool,h.zpp_pool=null,h.zpp_disp=!1,h==Cl.nextVec2&&(Cl.nextVec2=null)),null==h.zpp_inner){var u;null==Ct.zpp_pool?u=new Ct:(u=Ct.zpp_pool,Ct.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=a,u.y=_,h.zpp_inner=u,h.zpp_inner.outer=h}else{var d=h.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c,x=h.zpp_inner;if(null!=x._validate&&x._validate(),h.zpp_inner.x==a){var v=h.zpp_inner;null!=v._validate&&v._validate(),c=h.zpp_inner.y==_}else c=!1;if(!c){h.zpp_inner.x=a,h.zpp_inner.y=_;var z=h.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}h.zpp_inner.weak=t;var y=h;if(n.zpp_inner.weak){var f=n.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var b=n;b.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=b:Cl.poolVec2=b,Cl.nextVec2=b,b.zpp_disp=!0;var g=m;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Ct.zpp_pool,Ct.zpp_pool=g}return y},sub:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=i-n.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o,h=p-n.zpp_inner.y;if(null==Cl.poolVec2?o=new On:(o=Cl.poolVec2,Cl.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Cl.nextVec2&&(Cl.nextVec2=null)),null==o.zpp_inner){var _;null==Ct.zpp_pool?_=new Ct:(_=Ct.zpp_pool,Ct.zpp_pool=_.next,_.next=null),_.weak=!1,_._immutable=!1,_.x=r,_.y=h,o.zpp_inner=_,o.zpp_inner.outer=o}else{var u=o.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d,c=o.zpp_inner;if(null!=c._validate&&c._validate(),o.zpp_inner.x==r){var x=o.zpp_inner;null!=x._validate&&x._validate(),d=o.zpp_inner.y==h}else d=!1;if(!d){o.zpp_inner.x=r,o.zpp_inner.y=h;var v=o.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}o.zpp_inner.weak=e;var z=o;if(n.zpp_inner.weak){var y=n.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var m=n;m.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=m:Cl.poolVec2=m,Cl.nextVec2=m,m.zpp_disp=!0;var b=f;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Ct.zpp_pool,Ct.zpp_pool=b}return z},mul:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x*n,l=this.zpp_inner;null!=l._validate&&l._validate();var r,a=this.zpp_inner.y*n;if(null==Cl.poolVec2?r=new On:(r=Cl.poolVec2,Cl.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Cl.nextVec2&&(Cl.nextVec2=null)),null==r.zpp_inner){var p;null==Ct.zpp_pool?p=new Ct:(p=Ct.zpp_pool,Ct.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=i,p.y=a,r.zpp_inner=p,r.zpp_inner.outer=r}else{var s=r.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o,h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==i){var _=r.zpp_inner;null!=_._validate&&_._validate(),o=r.zpp_inner.y==a}else o=!1;if(!o){r.zpp_inner.x=i,r.zpp_inner.y=a;var u=r.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}return r.zpp_inner.weak=e,r},addeq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=i+n.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o=p+n.zpp_inner.y,h=this.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=this.zpp_inner;if(null!=u._validate&&u._validate(),this.zpp_inner.x==r){var d=this.zpp_inner;null!=d._validate&&d._validate(),_=this.zpp_inner.y==o}else _=!1;if(!_){this.zpp_inner.x=r,this.zpp_inner.y=o;var c=this.zpp_inner;null!=c._invalidate&&c._invalidate(c)}if(n.zpp_inner.weak){var x=n.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var z=n;z.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=z:Cl.poolVec2=z,Cl.nextVec2=z,z.zpp_disp=!0;var y=v;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Ct.zpp_pool,Ct.zpp_pool=y}return this},subeq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=i-n.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o=p-n.zpp_inner.y,h=this.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=this.zpp_inner;if(null!=u._validate&&u._validate(),this.zpp_inner.x==r){var d=this.zpp_inner;null!=d._validate&&d._validate(),_=this.zpp_inner.y==o}else _=!1;if(!_){this.zpp_inner.x=r,this.zpp_inner.y=o;var c=this.zpp_inner;null!=c._invalidate&&c._invalidate(c)}if(n.zpp_inner.weak){var x=n.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var z=n;z.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=z:Cl.poolVec2=z,Cl.nextVec2=z,z.zpp_disp=!0;var y=v;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Ct.zpp_pool,Ct.zpp_pool=y}return this},muleq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x*n,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y*n,a=this.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p,s=this.zpp_inner;if(null!=s._validate&&s._validate(),this.zpp_inner.x==i){var o=this.zpp_inner;null!=o._validate&&o._validate(),p=this.zpp_inner.y==r}else p=!1;if(!p){this.zpp_inner.x=i,this.zpp_inner.y=r;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate(h)}return this},dot:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var l=t*n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,p=n.zpp_inner;null!=p._validate&&p._validate();var s=l+a*n.zpp_inner.y;if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_:Cl.poolVec2=_,Cl.nextVec2=_,_.zpp_disp=!0;var u=h;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u}return s},cross:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var l=t*this.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var s=l-a*this.zpp_inner.y;if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_:Cl.poolVec2=_,Cl.nextVec2=_,_.zpp_disp=!0;var u=h;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u}return s},perp:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=-this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var l,r=this.zpp_inner.x;if(null==Cl.poolVec2?l=new On:(l=Cl.poolVec2,Cl.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Cl.nextVec2&&(Cl.nextVec2=null)),null==l.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=t,a.y=r,l.zpp_inner=a,l.zpp_inner.outer=l}else{var p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==t){var h=l.zpp_inner;null!=h._validate&&h._validate(),s=l.zpp_inner.y==r}else s=!1;if(!s){l.zpp_inner.x=t,l.zpp_inner.y=r;var _=l.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return l.zpp_inner.weak=n,l},toString:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),""+this.zpp_inner},__class__:On,__properties__:{set_angle:"set_angle",get_angle:"get_angle",set_length:"set_length",get_length:"get_length",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x"}};var Sn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.Vec2Iterator"]=Sn,Sn.__name__=["nape","geom","Vec2Iterator"],Sn.get=function(n){var e;if(null==Sn.zpp_pool){cl.internal=!0;var t=new Sn;cl.internal=!1,e=t}else{var i=Sn.zpp_pool;Sn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Sn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,n>this.zpp_i||(this.zpp_next=Sn.zpp_pool,Sn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Sn};var Pn=function(){this.zpp_inner=null,this.zpp_inner=new cl,this.zpp_inner.outer=this};l["nape.geom.Vec2List"]=Pn,Pn.__name__=["nape","geom","Vec2List"],Pn.fromArray=function(n){for(var e=new Pn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Pn.prototype={zpp_inner:null,get_length:function(){return this.zpp_gl()},zpp_gl:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},has:function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var e=this.zpp_inner.at_ite.elt;if(null==e.outer){e.outer=new On;var t=e.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ct.zpp_pool,Ct.zpp_pool=t,e.outer.zpp_inner=e}return e.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(n=this.zpp_inner.inner.head.elt,null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ct.zpp_pool,Ct.zpp_pool=e,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(n=null==i?this.zpp_inner.inner.head.elt:i.next.elt,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,n.outer.zpp_inner=n}var r=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var a=n.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,n.outer.zpp_inner=n}return n.outer},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt,null==n.outer){n.outer=new On;var t=n.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ct.zpp_pool,Ct.zpp_pool=t,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{if(n=this.zpp_inner.inner.head.elt,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,n.outer.zpp_inner=n}var r=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var a=n.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,n.outer.zpp_inner=n}return n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},empty:function(){return 0==this.zpp_gl()},iterator:function(){return this.zpp_vm(),Sn.get(this)},copy:function(n){null==n&&(n=!1);for(var e=new Pn,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner.zpp_gl();t.zpp_critical=!0;var l;if(i>t.zpp_i?l=!0:(t.zpp_next=Sn.zpp_pool,Sn.zpp_pool=t,t.zpp_inner=null,l=!1),!l)break;t.zpp_critical=!1;var r,a=t.zpp_inner.at(t.zpp_i++);if(n){var p=a.zpp_inner;null!=p._validate&&p._validate();var s=a.zpp_inner.x,o=a.zpp_inner;null!=o._validate&&o._validate();var h,_=a.zpp_inner.y;if(null==Cl.poolVec2?h=new On:(h=Cl.poolVec2,Cl.poolVec2=h.zpp_pool,h.zpp_pool=null,h.zpp_disp=!1,h==Cl.nextVec2&&(Cl.nextVec2=null)),null==h.zpp_inner){var u;null==Ct.zpp_pool?u=new Ct:(u=Ct.zpp_pool,Ct.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=s,u.y=_,h.zpp_inner=u,h.zpp_inner.outer=h}else{var d=h.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c,x=h.zpp_inner;if(null!=x._validate&&x._validate(),h.zpp_inner.x==s){var v=h.zpp_inner;null!=v._validate&&v._validate(),c=h.zpp_inner.y==_}else c=!1;if(!c){h.zpp_inner.x=s,h.zpp_inner.y=_;var z=h.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}h.zpp_inner.weak=!1,r=h}else r=a;e.push(r)}return e},merge:function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var i;if(t>e.zpp_i?i=!0:(e.zpp_next=Sn.zpp_pool,Sn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||this.add(l)}},toString:function(){for(var n="[",e=!0,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner.zpp_gl();t.zpp_critical=!0;var l;if(i>t.zpp_i?l=!0:(t.zpp_next=Sn.zpp_pool,Sn.zpp_pool=t,t.zpp_inner=null,l=!1),!l)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var i;if(t>e.zpp_i?i=!0:(e.zpp_next=Sn.zpp_pool,Sn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(l){e.zpp_next=Sn.zpp_pool,Sn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;e<this.zpp_gl();){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Pn,__properties__:{get_length:"get_length"}};var Tn=function(n,e,t){null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new Mt,this.zpp_inner.outer=this,this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=e;var l=this.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.z=t;var r=this.zpp_inner;null!=r._validate&&r._validate()};l["nape.geom.Vec3"]=Tn,Tn.__name__=["nape","geom","Vec3"],Tn.get=function(n,e,t){null==t&&(t=0),null==e&&(e=0),null==n&&(n=0);var i;return null==Cl.poolVec3?i=new Tn:(i=Cl.poolVec3,Cl.poolVec3=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==Cl.nextVec3&&(Cl.nextVec3=null)),i.setxyz(n,e,t),i.zpp_inner.immutable=!1,i.zpp_inner._validate=null,i},Tn.prototype={zpp_inner:null,zpp_pool:null,zpp_disp:null,get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},set_x:function(n){this.zpp_inner.x=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},set_y:function(n){this.zpp_inner.y=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},get_z:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},set_z:function(n){this.zpp_inner.z=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.z},dispose:function(){var n=this;n.zpp_pool=null,null!=Cl.nextVec3?Cl.nextVec3.zpp_pool=n:Cl.poolVec3=n,Cl.nextVec3=n,n.zpp_disp=!0},get_length:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var p=i+r*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.z,h=this.zpp_inner;return null!=h._validate&&h._validate(),Math.sqrt(p+o*this.zpp_inner.z)},set_length:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner;null!=i._validate&&i._validate();var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner;null!=a._validate&&a._validate();var p=this.zpp_inner;null!=p._validate&&p._validate();var s=this.zpp_inner.x,o=this.zpp_inner;null!=o._validate&&o._validate();var h=s*this.zpp_inner.x,_=this.zpp_inner;null!=_._validate&&_._validate();var u=this.zpp_inner.y,d=this.zpp_inner;null!=d._validate&&d._validate();var c=h+u*this.zpp_inner.y,x=this.zpp_inner;null!=x._validate&&x._validate();var v=this.zpp_inner.z,z=this.zpp_inner;null!=z._validate&&z._validate();var y=n/Math.sqrt(c+v*this.zpp_inner.z),f=y,m=this,b=m.zpp_inner;null!=b._validate&&b._validate(),m.zpp_inner.x=m.zpp_inner.x*f;var g=m.zpp_inner;null!=g._validate&&g._validate();var w=this,C=w.zpp_inner;null!=C._validate&&C._validate(),w.zpp_inner.y=w.zpp_inner.y*f;var M=w.zpp_inner;null!=M._validate&&M._validate();var k=this,O=k.zpp_inner;null!=O._validate&&O._validate(),k.zpp_inner.z=k.zpp_inner.z*y;var S=k.zpp_inner;null!=S._validate&&S._validate();var P=this.zpp_inner;null!=P._validate&&P._validate();var T=this.zpp_inner.x,A=this.zpp_inner;null!=A._validate&&A._validate();var E=T*this.zpp_inner.x,I=this.zpp_inner;null!=I._validate&&I._validate();var V=this.zpp_inner.y,L=this.zpp_inner;null!=L._validate&&L._validate();var N=E+V*this.zpp_inner.y,D=this.zpp_inner;null!=D._validate&&D._validate();var j=this.zpp_inner.z,F=this.zpp_inner;return null!=F._validate&&F._validate(),Math.sqrt(N+j*this.zpp_inner.z)},lsq:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var p=i+r*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.z,h=this.zpp_inner;return null!=h._validate&&h._validate(),p+o*this.zpp_inner.z},set:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.y,r=n.zpp_inner;return null!=r._validate&&r._validate(),this.setxyz(t,l,n.zpp_inner.z)},setxyz:function(n,e,t){this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=e;var l=this.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.z=t;var r=this.zpp_inner;return null!=r._validate&&r._validate(),this},xy:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var l,r=this.zpp_inner.y;if(null==Cl.poolVec2?l=new On:(l=Cl.poolVec2,Cl.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Cl.nextVec2&&(Cl.nextVec2=null)),null==l.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=t,a.y=r,l.zpp_inner=a,l.zpp_inner.outer=l}else{var p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==t){var h=l.zpp_inner;null!=h._validate&&h._validate(),s=l.zpp_inner.y==r}else s=!1;if(!s){l.zpp_inner.x=t,l.zpp_inner.y=r;var _=l.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return l.zpp_inner.weak=n,l},toString:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e="{ x: "+this.zpp_inner.x+" y: ",t=this.zpp_inner;null!=t._validate&&t._validate();var i=e+this.zpp_inner.y+" z: ",l=this.zpp_inner;return null!=l._validate&&l._validate(),i+this.zpp_inner.z+" }"},__class__:Tn,__properties__:{set_length:"set_length",get_length:"get_length",set_z:"set_z",get_z:"get_z",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x"}};var An=function(){};l["nape.geom.Winding"]=An,An.__name__=["nape","geom","Winding"],An.__properties__={get_ANTICLOCKWISE:"get_ANTICLOCKWISE",get_CLOCKWISE:"get_CLOCKWISE",get_UNDEFINED:"get_UNDEFINED"},An.get_UNDEFINED=function(){return null==ye.Winding_UNDEFINED&&(ye.internal=!0,ye.Winding_UNDEFINED=new An,ye.internal=!1),ye.Winding_UNDEFINED},An.get_CLOCKWISE=function(){return null==ye.Winding_CLOCKWISE&&(ye.internal=!0,ye.Winding_CLOCKWISE=new An,ye.internal=!1),ye.Winding_CLOCKWISE},An.get_ANTICLOCKWISE=function(){return null==ye.Winding_ANTICLOCKWISE&&(ye.internal=!0,ye.Winding_ANTICLOCKWISE=new An,ye.internal=!1),ye.Winding_ANTICLOCKWISE},An.prototype={toString:function(){return null==ye.Winding_UNDEFINED&&(ye.internal=!0,ye.Winding_UNDEFINED=new An,ye.internal=!1),this==ye.Winding_UNDEFINED?"UNDEFINED":(null==ye.Winding_CLOCKWISE&&(ye.internal=!0,ye.Winding_CLOCKWISE=new An,ye.internal=!1),this==ye.Winding_CLOCKWISE?"CLOCKWISE":(null==ye.Winding_ANTICLOCKWISE&&(ye.internal=!0,ye.Winding_ANTICLOCKWISE=new An,ye.internal=!1),this==ye.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},__class__:An};var En=function(){this.zpp_inner_i=null};l["nape.phys.Interactor"]=En,En.__name__=["nape","phys","Interactor"],En.prototype={zpp_inner_i:null,get_id:function(){return this.zpp_inner_i.id},get_userData:function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},isShape:function(){return null!=this.zpp_inner_i.ishape},isBody:function(){return null!=this.zpp_inner_i.ibody},isCompound:function(){return null!=this.zpp_inner_i.icompound},get_castShape:function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},get_castBody:function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},get_castCompound:function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},get_group:function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},set_group:function(n){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},get_cbTypes:function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},toString:function(){return""},__class__:En,__properties__:{get_cbTypes:"get_cbTypes",set_group:"set_group",get_group:"get_group",get_castCompound:"get_castCompound",get_castBody:"get_castBody",get_castShape:"get_castShape",get_userData:"get_userData",get_id:"get_id"}};var In=function(n,e){if(this.debugDraw=!0,this.zpp_inner=null,En.zpp_internalAlloc=!0,En.call(this),En.zpp_internalAlloc=!1,this.zpp_inner=new St,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,null!=e){var t=e.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.posx=e.zpp_inner.x;var i=e.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.posy=e.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=0;var l;if(null==n?(null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1),l=ye.BodyType_DYNAMIC):l=n,this.zpp_inner.immutable_midstep("Body::type"),St.types[this.zpp_inner.type]!=l){var r;null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1),l==ye.BodyType_DYNAMIC?r=ye.id_BodyType_DYNAMIC:(null==ye.BodyType_KINEMATIC&&(ye.internal=!0,ye.BodyType_KINEMATIC=new Nn,ye.internal=!1),r=l==ye.BodyType_KINEMATIC?ye.id_BodyType_KINEMATIC:ye.id_BodyType_STATIC),r==ye.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,r):this.zpp_inner.type=r}if(null!=e&&e.zpp_inner.weak){var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}this.zpp_inner_i.insert_cbtype(ze.ANY_BODY.zpp_inner)};l["nape.phys.Body"]=In,In.__name__=["nape","phys","Body"],In.__super__=En,In.prototype=e(En.prototype,{zpp_inner:null,debugDraw:null,get_type:function(){return St.types[this.zpp_inner.type]},set_type:function(n){if(this.zpp_inner.immutable_midstep("Body::type"),St.types[this.zpp_inner.type]!=n){var e;null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1),n==ye.BodyType_DYNAMIC?e=ye.id_BodyType_DYNAMIC:(null==ye.BodyType_KINEMATIC&&(ye.internal=!0,ye.BodyType_KINEMATIC=new Nn,ye.internal=!1),e=n==ye.BodyType_KINEMATIC?ye.id_BodyType_KINEMATIC:ye.id_BodyType_STATIC),e==ye.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,e):this.zpp_inner.type=e}return St.types[this.zpp_inner.type]},get_isBullet:function(){return this.zpp_inner.bulletEnabled},set_isBullet:function(n){return this.zpp_inner.bulletEnabled=n},get_disableCCD:function(){return this.zpp_inner.disableCCD},set_disableCCD:function(n){return this.zpp_inner.disableCCD=n},integrate:function(n){if(this.zpp_inner.immutable_midstep("Body::space"),0==n)return this;var e=this.zpp_inner;e.sweepTime=0,e.sweep_angvel=e.angvel;var t=n-e.sweepTime;if(0!=t){e.sweepTime=n;var i=t;if(e.posx+=e.velx*i,e.posy+=e.vely*i,0!=e.angvel){var l=e.sweep_angvel*t;if(e.rot+=l,l*l>1e-4)e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot);else{var r=l*l,a=1-.5*r,p=1-r*r/8,s=(a*e.axisx+l*e.axisy)*p;e.axisy=(a*e.axisy-l*e.axisx)*p,e.axisx=s}}}for(var o=e.shapes.head;null!=o;){var h=o.elt;h.type==ye.id_ShapeType_POLYGON&&(h.polygon.invalidate_gverts(),h.polygon.invalidate_gaxi()),h.invalidate_worldCOM(),o=o.next}e.zip_worldCOM=!0,e.zip_axis=!0;for(var _=e.shapes.head;null!=_;){var u=_.elt;u.type==ye.id_ShapeType_POLYGON&&(u.polygon.invalidate_gverts(),u.polygon.invalidate_gaxi()),u.invalidate_worldCOM(),_=_.next}return e.zip_worldCOM=!0,e.sweepTime=0,this},isStatic:function(){return this.zpp_inner.type==ye.id_BodyType_STATIC},isDynamic:function(){return this.zpp_inner.type==ye.id_BodyType_DYNAMIC},isKinematic:function(){return this.zpp_inner.type==ye.id_BodyType_KINEMATIC},get_shapes:function(){return this.zpp_inner.wrap_shapes},get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if(this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_arbiters:function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},get_isSleeping:function(){return this.zpp_inner.component.sleeping},get_constraints:function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},copy:function(){return this.zpp_inner.copy()},get_position:function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},set_position:function(n){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var e=this.zpp_inner.wrap_pos,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},get_velocity:function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},set_velocity:function(n){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var e=this.zpp_inner.wrap_vel,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},setVelocityFromTarget:function(n,e,t){var i=1/t;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var l=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var r=n.sub(this.zpp_inner.wrap_pos,!0).muleq(i),a=l.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=r.zpp_inner;null!=p._validate&&p._validate();var s=r.zpp_inner.x,o=r.zpp_inner;null!=o._validate&&o._validate();var h=r.zpp_inner.y,_=l.zpp_inner;null!=_._isimmutable&&_._isimmutable();var u,d=l.zpp_inner;if(null!=d._validate&&d._validate(),l.zpp_inner.x==s){var c=l.zpp_inner;null!=c._validate&&c._validate(),u=l.zpp_inner.y==h}else u=!1;if(!u){l.zpp_inner.x=s,l.zpp_inner.y=h;var x=l.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(r.zpp_inner.weak){var v=r.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var y=r;y.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=y:Cl.poolVec2=y,Cl.nextVec2=y,y.zpp_disp=!0;var f=z;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ct.zpp_pool,Ct.zpp_pool=f}var m=(e-this.zpp_inner.rot)*i;if(this.zpp_inner.angvel!=m&&(this.zpp_inner.angvel=m,this.zpp_inner.wake()),n.zpp_inner.weak){var b=n.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var w=n;w.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=w:Cl.poolVec2=w,Cl.nextVec2=w,w.zpp_disp=!0;var C=g;null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Ct.zpp_pool,Ct.zpp_pool=C}return this},get_kinematicVel:function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},set_kinematicVel:function(n){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var e=this.zpp_inner.wrap_kinvel,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},get_surfaceVel:function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},set_surfaceVel:function(n){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var e=this.zpp_inner.wrap_svel,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},get_force:function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},set_force:function(n){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var e=this.zpp_inner.wrap_force,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},get_constraintVelocity:function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},get_rotation:function(){return this.zpp_inner.rot},set_rotation:function(n){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=n){this.zpp_inner.rot=n;var e=this.zpp_inner;e.zip_axis=!0;for(var t=e.shapes.head;null!=t;){var i=t.elt;i.type==ye.id_ShapeType_POLYGON&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),t=t.next}e.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},get_angularVel:function(){return this.zpp_inner.angvel},set_angularVel:function(n){return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),this.zpp_inner.angvel},get_kinAngVel:function(){return this.zpp_inner.kinangvel},set_kinAngVel:function(n){return this.zpp_inner.kinangvel!=n&&(this.zpp_inner.kinangvel=n,this.zpp_inner.wake()),this.zpp_inner.kinangvel},get_torque:function(){return this.zpp_inner.torque},set_torque:function(n){return this.zpp_inner.torque!=n&&(this.zpp_inner.torque=n,this.zpp_inner.wake()),this.zpp_inner.torque},get_bounds:function(){return this.zpp_inner.aabb.wrapper()},get_allowMovement:function(){return!this.zpp_inner.nomove},set_allowMovement:function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.nomove!=n&&(this.zpp_inner.nomove=!n,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},get_allowRotation:function(){return!this.zpp_inner.norotate},set_allowRotation:function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.norotate!=n&&(this.zpp_inner.norotate=!n,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},get_massMode:function(){null==ye.MassMode_DEFAULT&&(ye.internal=!0,ye.MassMode_DEFAULT=new Zn,ye.internal=!1);var n=ye.MassMode_DEFAULT;return null==ye.MassMode_FIXED&&(ye.internal=!0,ye.MassMode_FIXED=new Zn,ye.internal=!1),[n,ye.MassMode_FIXED][this.zpp_inner.massMode]},set_massMode:function(n){this.zpp_inner.immutable_midstep("Body::massMode");var e;null==ye.MassMode_DEFAULT&&(ye.internal=!0,ye.MassMode_DEFAULT=new Zn,ye.internal=!1),e=n==ye.MassMode_DEFAULT?ye.id_MassMode_DEFAULT:ye.id_MassMode_FIXED,this.zpp_inner.massMode=e,this.zpp_inner.invalidate_mass(),null==ye.MassMode_DEFAULT&&(ye.internal=!0,ye.MassMode_DEFAULT=new Zn,ye.internal=!1);var t=ye.MassMode_DEFAULT;return null==ye.MassMode_FIXED&&(ye.internal=!0,ye.MassMode_FIXED=new Zn,ye.internal=!1),[t,ye.MassMode_FIXED][this.zpp_inner.massMode]},get_constraintMass:function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},get_mass:function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},set_mass:function(n){return this.zpp_inner.immutable_midstep("Body::mass"),Infinity,this.zpp_inner.massMode=ye.id_MassMode_FIXED,this.zpp_inner.cmass=n,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},get_gravMassMode:function(){null==ye.GravMassMode_DEFAULT&&(ye.internal=!0,ye.GravMassMode_DEFAULT=new Rn,ye.internal=!1);var n=ye.GravMassMode_DEFAULT;null==ye.GravMassMode_FIXED&&(ye.internal=!0,ye.GravMassMode_FIXED=new Rn,ye.internal=!1);var e=ye.GravMassMode_FIXED;return null==ye.GravMassMode_SCALED&&(ye.internal=!0,ye.GravMassMode_SCALED=new Rn,ye.internal=!1),[n,e,ye.GravMassMode_SCALED][this.zpp_inner.massMode]},set_gravMassMode:function(n){this.zpp_inner.immutable_midstep("Body::gravMassMode");var e;null==ye.GravMassMode_SCALED&&(ye.internal=!0,ye.GravMassMode_SCALED=new Rn,ye.internal=!1),n==ye.GravMassMode_SCALED?e=ye.id_GravMassMode_SCALED:(null==ye.GravMassMode_DEFAULT&&(ye.internal=!0,ye.GravMassMode_DEFAULT=new Rn,ye.internal=!1),e=n==ye.GravMassMode_DEFAULT?ye.id_GravMassMode_DEFAULT:ye.id_GravMassMode_FIXED),this.zpp_inner.gravMassMode=e,this.zpp_inner.invalidate_gravMass(),null==ye.GravMassMode_DEFAULT&&(ye.internal=!0,ye.GravMassMode_DEFAULT=new Rn,ye.internal=!1);var t=ye.GravMassMode_DEFAULT;null==ye.GravMassMode_FIXED&&(ye.internal=!0,ye.GravMassMode_FIXED=new Rn,ye.internal=!1);var i=ye.GravMassMode_FIXED;return null==ye.GravMassMode_SCALED&&(ye.internal=!0,ye.GravMassMode_SCALED=new Rn,ye.internal=!1),[t,i,ye.GravMassMode_SCALED][this.zpp_inner.massMode]},get_gravMass:function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},set_gravMass:function(n){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=ye.id_GravMassMode_FIXED,this.zpp_inner.gravMass=n,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},get_gravMassScale:function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},set_gravMassScale:function(n){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=ye.id_GravMassMode_SCALED,this.zpp_inner.gravMassScale=n,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},get_inertiaMode:function(){null==ye.InertiaMode_DEFAULT&&(ye.internal=!0,ye.InertiaMode_DEFAULT=new Gn,ye.internal=!1);var n=ye.InertiaMode_DEFAULT;return null==ye.InertiaMode_FIXED&&(ye.internal=!0,ye.InertiaMode_FIXED=new Gn,ye.internal=!1),[n,ye.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},set_inertiaMode:function(n){this.zpp_inner.immutable_midstep("Body::inertiaMode");var e;null==ye.InertiaMode_FIXED&&(ye.internal=!0,ye.InertiaMode_FIXED=new Gn,ye.internal=!1),e=n==ye.InertiaMode_FIXED?ye.id_InertiaMode_FIXED:ye.id_InertiaMode_DEFAULT,this.zpp_inner.inertiaMode=e,this.zpp_inner.invalidate_inertia(),null==ye.InertiaMode_DEFAULT&&(ye.internal=!0,ye.InertiaMode_DEFAULT=new Gn,ye.internal=!1);var t=ye.InertiaMode_DEFAULT;return null==ye.InertiaMode_FIXED&&(ye.internal=!0,ye.InertiaMode_FIXED=new Gn,ye.internal=!1),[t,ye.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},get_constraintInertia:function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},get_inertia:function(){this.zpp_inner.validate_inertia();if(this.zpp_inner.inertiaMode==ye.id_InertiaMode_DEFAULT){null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head}else!1;return this.zpp_inner.cinertia},set_inertia:function(n){this.zpp_inner.immutable_midstep("Body::inertia"),Infinity,this.zpp_inner.inertiaMode=ye.id_InertiaMode_FIXED,this.zpp_inner.cinertia=n,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia();if(this.zpp_inner.inertiaMode==ye.id_InertiaMode_DEFAULT){null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head}else!1;return this.zpp_inner.cinertia},connectedBodies:function(n,e){return null==n&&(n=-1),this.zpp_inner.connectedBodies(n,e)},interactingBodies:function(n,e,t){null==e&&(e=-1);var i;return null==n?i=Ne.COL|Ne.SENSOR|Ne.FLUID:(null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),n==ye.InteractionType_COLLISION?i=Ne.COL:(null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),i=n==ye.InteractionType_SENSOR?Ne.SENSOR:Ne.FLUID)),this.zpp_inner.interactingBodies(i,e,t)},crushFactor:function(){var n,e=0;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var t;null==Ct.zpp_pool?t=new Ct:(t=Ct.zpp_pool,Ct.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n}else{var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),0==n.zpp_inner.x){var a=n.zpp_inner;null!=a._validate&&a._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var p=n.zpp_inner;null!=p._invalidate&&p._invalidate(p)}}n.zpp_inner.weak=!1;var s=n;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var o=this.zpp_inner.wrap_arbiters.iterator();;){o.zpp_inner.zpp_inner.valmod();var h=o.zpp_inner.zpp_gl();o.zpp_critical=!0;var _;if(h>o.zpp_i?_=!0:(o.zpp_next=Q.zpp_pool,Q.zpp_pool=o,o.zpp_inner=null,_=!1),!_)break;o.zpp_critical=!1;var u=o.zpp_inner.at(o.zpp_i++),d=u.totalImpulse(this),c=d.xy();s.addeq(c);var x=c.zpp_inner;null!=x._validate&&x._validate();var v=c.zpp_inner.x,z=c.zpp_inner;null!=z._validate&&z._validate();var y=v*c.zpp_inner.x,f=c.zpp_inner;null!=f._validate&&f._validate();var m=c.zpp_inner.y,b=c.zpp_inner;null!=b._validate&&b._validate(),e+=Math.sqrt(y+m*c.zpp_inner.y);var g=c.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=c.zpp_inner;c.zpp_inner.outer=null,c.zpp_inner=null;var C=c;C.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=C:Cl.poolVec2=C,Cl.nextVec2=C,C.zpp_disp=!0;var M=w;null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=Ct.zpp_pool,Ct.zpp_pool=M,d.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0));var k=this.zpp_inner.wrap_constraints;k.zpp_inner.valmod();for(var O=G.get(k);;){O.zpp_inner.zpp_inner.valmod();var S=O.zpp_inner;S.zpp_inner.valmod(),S.zpp_inner.zip_length&&(S.zpp_inner.zip_length=!1,S.zpp_inner.user_length=S.zpp_inner.inner.length);var P=S.zpp_inner.user_length;O.zpp_critical=!0;var T;if(P>O.zpp_i?T=!0:(O.zpp_next=G.zpp_pool,G.zpp_pool=O,O.zpp_inner=null,T=!1),!T)break;O.zpp_critical=!1;var A=O.zpp_inner.at(O.zpp_i++),E=A.bodyImpulse(this),I=E.xy();s.addeq(I);var V=I.zpp_inner;null!=V._validate&&V._validate();var L=I.zpp_inner.x,N=I.zpp_inner;null!=N._validate&&N._validate();var D=L*I.zpp_inner.x,j=I.zpp_inner;null!=j._validate&&j._validate();var F=I.zpp_inner.y,B=I.zpp_inner;null!=B._validate&&B._validate(),e+=Math.sqrt(D+F*I.zpp_inner.y);var R=I.zpp_inner;null!=R._isimmutable&&R._isimmutable();var Y=I.zpp_inner;I.zpp_inner.outer=null,I.zpp_inner=null;var U=I;U.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=U:Cl.poolVec2=U,Cl.nextVec2=U,U.zpp_disp=!0;var Z=Y;null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=Ct.zpp_pool,Ct.zpp_pool=Z,E.dispose()}var q=s.zpp_inner;null!=q._validate&&q._validate();var W=s.zpp_inner.x,X=s.zpp_inner;null!=X._validate&&X._validate();var H=W*s.zpp_inner.x,K=s.zpp_inner;null!=K._validate&&K._validate();var J=s.zpp_inner.y,$=s.zpp_inner;null!=$._validate&&$._validate();var nn=e-Math.sqrt(H+J*s.zpp_inner.y);this.zpp_inner.validate_mass();var en=nn/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),tn=s.zpp_inner;null!=tn._isimmutable&&tn._isimmutable();var ln=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var rn=s;rn.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=rn:Cl.poolVec2=rn,Cl.nextVec2=rn,rn.zpp_disp=!0;var an=ln;return null!=an.outer&&(an.outer.zpp_inner=null,an.outer=null),an._isimmutable=null,an._validate=null,an._invalidate=null,an.next=Ct.zpp_pool,Ct.zpp_pool=an,en},localPointToWorld:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i=0,l=0,r=this.zpp_inner.axisy,a=n.zpp_inner;null!=a._validate&&a._validate();var p=r*n.zpp_inner.x,s=this.zpp_inner.axisx,o=n.zpp_inner;null!=o._validate&&o._validate(),i=p-s*n.zpp_inner.y;var h=n.zpp_inner;null!=h._validate&&h._validate();var _=n.zpp_inner.x*this.zpp_inner.axisx,u=n.zpp_inner;if(null!=u._validate&&u._validate(),l=_+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var d=n.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var x=n;x.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=x:Cl.poolVec2=x,Cl.nextVec2=x,x.zpp_disp=!0;var v=c;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Ct.zpp_pool,Ct.zpp_pool=v}var z,y=i+this.zpp_inner.posx,f=l+this.zpp_inner.posy;if(null==Cl.poolVec2?z=new On:(z=Cl.poolVec2,Cl.poolVec2=z.zpp_pool,z.zpp_pool=null,z.zpp_disp=!1,z==Cl.nextVec2&&(Cl.nextVec2=null)),null==z.zpp_inner){var m;null==Ct.zpp_pool?m=new Ct:(m=Ct.zpp_pool,Ct.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=y,m.y=f,z.zpp_inner=m,z.zpp_inner.outer=z}else{var b=z.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g,w=z.zpp_inner;if(null!=w._validate&&w._validate(),z.zpp_inner.x==y){var C=z.zpp_inner;null!=C._validate&&C._validate(),g=z.zpp_inner.y==f}else g=!1;if(!g){z.zpp_inner.x=y,z.zpp_inner.y=f;var M=z.zpp_inner;null!=M._invalidate&&M._invalidate(M)}}return z.zpp_inner.weak=e,z},worldPointToLocal:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i=0,l=0,r=0,a=0,p=n.zpp_inner;null!=p._validate&&p._validate(),r=n.zpp_inner.x-this.zpp_inner.posx;var s=n.zpp_inner;if(null!=s._validate&&s._validate(),a=n.zpp_inner.y-this.zpp_inner.posy,i=r*this.zpp_inner.axisy+a*this.zpp_inner.axisx,l=a*this.zpp_inner.axisy-r*this.zpp_inner.axisx,n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_:Cl.poolVec2=_,Cl.nextVec2=_,_.zpp_disp=!0;var u=h;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u}var d;if(null==Cl.poolVec2?d=new On:(d=Cl.poolVec2,Cl.poolVec2=d.zpp_pool,d.zpp_pool=null,d.zpp_disp=!1,d==Cl.nextVec2&&(Cl.nextVec2=null)),null==d.zpp_inner){var c;null==Ct.zpp_pool?c=new Ct:(c=Ct.zpp_pool,Ct.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=i,c.y=l,d.zpp_inner=c,d.zpp_inner.outer=d}else{var x=d.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=d.zpp_inner;if(null!=z._validate&&z._validate(),d.zpp_inner.x==i){var y=d.zpp_inner;null!=y._validate&&y._validate(),v=d.zpp_inner.y==l}else v=!1;if(!v){d.zpp_inner.x=i,d.zpp_inner.y=l;var f=d.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}return d.zpp_inner.weak=e,d},localVectorToWorld:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i=0,l=0,r=this.zpp_inner.axisy,a=n.zpp_inner;null!=a._validate&&a._validate();var p=r*n.zpp_inner.x,s=this.zpp_inner.axisx,o=n.zpp_inner;null!=o._validate&&o._validate(),i=p-s*n.zpp_inner.y;var h=n.zpp_inner;null!=h._validate&&h._validate();var _=n.zpp_inner.x*this.zpp_inner.axisx,u=n.zpp_inner;if(null!=u._validate&&u._validate(),l=_+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var d=n.zpp_inner;null!=d._isimmutable&&d._isimmutable();var c=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var x=n;x.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=x:Cl.poolVec2=x,Cl.nextVec2=x,x.zpp_disp=!0;var v=c;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Ct.zpp_pool,Ct.zpp_pool=v}var z;if(null==Cl.poolVec2?z=new On:(z=Cl.poolVec2,Cl.poolVec2=z.zpp_pool,z.zpp_pool=null,z.zpp_disp=!1,z==Cl.nextVec2&&(Cl.nextVec2=null)),null==z.zpp_inner){var y;null==Ct.zpp_pool?y=new Ct:(y=Ct.zpp_pool,Ct.zpp_pool=y.next,y.next=null),y.weak=!1,y._immutable=!1,y.x=i,y.y=l,z.zpp_inner=y,z.zpp_inner.outer=z}else{var f=z.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m,b=z.zpp_inner;if(null!=b._validate&&b._validate(),z.zpp_inner.x==i){var g=z.zpp_inner;null!=g._validate&&g._validate(),m=z.zpp_inner.y==l}else m=!1;if(!m){z.zpp_inner.x=i,z.zpp_inner.y=l;var w=z.zpp_inner;null!=w._invalidate&&w._invalidate(w)}}return z.zpp_inner.weak=e,z},worldVectorToLocal:function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i=0,l=0,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x*this.zpp_inner.axisy,p=n.zpp_inner;null!=p._validate&&p._validate(),i=a+n.zpp_inner.y*this.zpp_inner.axisx;var s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.y*this.zpp_inner.axisy,h=n.zpp_inner;if(null!=h._validate&&h._validate(),l=o-n.zpp_inner.x*this.zpp_inner.axisx,n.zpp_inner.weak){var _=n.zpp_inner;null!=_._isimmutable&&_._isimmutable();var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=d:Cl.poolVec2=d,Cl.nextVec2=d,d.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Ct.zpp_pool,Ct.zpp_pool=c}var x;if(null==Cl.poolVec2?x=new On:(x=Cl.poolVec2,Cl.poolVec2=x.zpp_pool,x.zpp_pool=null,x.zpp_disp=!1,x==Cl.nextVec2&&(Cl.nextVec2=null)),null==x.zpp_inner){var v;null==Ct.zpp_pool?v=new Ct:(v=Ct.zpp_pool,Ct.zpp_pool=v.next,v.next=null),v.weak=!1,v._immutable=!1,v.x=i,v.y=l,x.zpp_inner=v,x.zpp_inner.outer=x}else{var z=x.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y,f=x.zpp_inner;if(null!=f._validate&&f._validate(),x.zpp_inner.x==i){var m=x.zpp_inner;null!=m._validate&&m._validate(),y=x.zpp_inner.y==l}else y=!1;if(!y){x.zpp_inner.x=i,x.zpp_inner.y=l;var b=x.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}return x.zpp_inner.weak=e,x},applyImpulse:function(n,e,t){null==t&&(t=!1);if(!!t&&this.zpp_inner.component.sleeping){if(n.zpp_inner.weak){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var r=n;r.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=r:Cl.poolVec2=r,Cl.nextVec2=r,r.zpp_disp=!0;var a=l;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a}if(null!=e&&e.zpp_inner.weak){var p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var o=e;o.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=o:Cl.poolVec2=o,Cl.nextVec2=o,o.zpp_disp=!0;var h=s;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Ct.zpp_pool,Ct.zpp_pool=h}return this}this.zpp_inner.validate_mass();var _=this.zpp_inner.imass,u=this.zpp_inner,d=u.velx,c=n.zpp_inner;null!=c._validate&&c._validate(),u.velx=d+n.zpp_inner.x*_;var x=this.zpp_inner,v=x.vely,z=n.zpp_inner;if(null!=z._validate&&z._validate(),x.vely=v+n.zpp_inner.y*_,null!=e){var y=0,f=0,m=e.zpp_inner;null!=m._validate&&m._validate(),y=e.zpp_inner.x-this.zpp_inner.posx;var b=e.zpp_inner;null!=b._validate&&b._validate(),f=e.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia();var g=this.zpp_inner,w=g.angvel,C=n.zpp_inner;null!=C._validate&&C._validate();var M=n.zpp_inner.y*y,k=n.zpp_inner;if(null!=k._validate&&k._validate(),g.angvel=w+(M-n.zpp_inner.x*f)*this.zpp_inner.iinertia,e.zpp_inner.weak){var O=e.zpp_inner;null!=O._isimmutable&&O._isimmutable();var S=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=P:Cl.poolVec2=P,Cl.nextVec2=P,P.zpp_disp=!0;var T=S;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T._isimmutable=null,T._validate=null,T._invalidate=null,T.next=Ct.zpp_pool,Ct.zpp_pool=T}}if(t||this.zpp_inner.type==ye.id_BodyType_DYNAMIC&&this.zpp_inner.wake(),n.zpp_inner.weak){var A=n.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var I=n;I.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=I:Cl.poolVec2=I,Cl.nextVec2=I,I.zpp_disp=!0;var V=E;null!=V.outer&&(V.outer.zpp_inner=null,V.outer=null),V._isimmutable=null,V._validate=null,V._invalidate=null,V.next=Ct.zpp_pool,Ct.zpp_pool=V}return this},applyAngularImpulse:function(n,e){null==e&&(e=!1);return!!e&&this.zpp_inner.component.sleeping?this:(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=n*this.zpp_inner.iinertia,e||this.zpp_inner.type==ye.id_BodyType_DYNAMIC&&this.zpp_inner.wake(),this)},translateShapes:function(n){this.zpp_inner.immutable_midstep("Body::translateShapes()");var e=n.zpp_inner.weak;n.zpp_inner.weak=!1;for(var t=this.zpp_inner.shapes.head;null!=t;){t.elt.outer.translate(n),t=t.next}if(n.zpp_inner.weak=e){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var r=n;r.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=r:Cl.poolVec2=r,Cl.nextVec2=r,r.zpp_disp=!0;var a=l;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a}return this},rotateShapes:function(n){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;){e.elt.outer.rotate(n),e=e.next}return this},scaleShapes:function(n,e){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;){t.elt.outer.scale(n,e),t=t.next}return this},transformShapes:function(n){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;){e.elt.outer.transform(n),e=e.next}return this},align:function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var n,e=-this.zpp_inner.localCOMx,t=-this.zpp_inner.localCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var i;null==Ct.zpp_pool?i=new Ct:(i=Ct.zpp_pool,Ct.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=e,i.y=t,n.zpp_inner=i,n.zpp_inner.outer=n}else{var l=n.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var p=n.zpp_inner;null!=p._validate&&p._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var s=n.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}n.zpp_inner.weak=!1;var o=n;this.translateShapes(o);var h=this.localVectorToWorld(o);if(null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(h),this.zpp_inner.pre_posx<Infinity){var _=this.zpp_inner,u=_.pre_posx,d=h.zpp_inner;null!=d._validate&&d._validate(),_.pre_posx=u-1*h.zpp_inner.x;var c=this.zpp_inner,x=c.pre_posy,v=h.zpp_inner;null!=v._validate&&v._validate(),c.pre_posy=x-1*h.zpp_inner.y}var z=o.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var f=o;f.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=f:Cl.poolVec2=f,Cl.nextVec2=f,f.zpp_disp=!0;var m=y;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ct.zpp_pool,Ct.zpp_pool=m;var b=h.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=h.zpp_inner;h.zpp_inner.outer=null,h.zpp_inner=null;var w=h;w.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=w:Cl.poolVec2=w,Cl.nextVec2=w,w.zpp_disp=!0;var C=g;return null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Ct.zpp_pool,Ct.zpp_pool=C,this},rotate:function(n,e){var t=n.zpp_inner.weak;n.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var i=this.zpp_inner.wrap_pos.sub(n);i.rotate(e);var l=n.add(i,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var r=this.zpp_inner.wrap_pos,a=r.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=l.zpp_inner;null!=p._validate&&p._validate();var s=l.zpp_inner.x,o=l.zpp_inner;null!=o._validate&&o._validate();var h=l.zpp_inner.y,_=r.zpp_inner;null!=_._isimmutable&&_._isimmutable();var u,d=r.zpp_inner;if(null!=d._validate&&d._validate(),r.zpp_inner.x==s){var c=r.zpp_inner;null!=c._validate&&c._validate(),u=r.zpp_inner.y==h}else u=!1;if(!u){r.zpp_inner.x=s,r.zpp_inner.y=h;var x=r.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(l.zpp_inner.weak){var v=l.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var y=l;y.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=y:Cl.poolVec2=y,Cl.nextVec2=y,y.zpp_disp=!0;var f=z;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Ct.zpp_pool,Ct.zpp_pool=f}null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var m=i.zpp_inner;null!=m._isimmutable&&m._isimmutable();var b=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var g=i;g.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=g:Cl.poolVec2=g,Cl.nextVec2=g,g.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=Ct.zpp_pool,Ct.zpp_pool=w;var C=this,M=C.zpp_inner.rot+e;if(C.zpp_inner.immutable_midstep("Body::rotation"),C.zpp_inner.rot!=M){C.zpp_inner.rot=M;var k=C.zpp_inner;k.zip_axis=!0;for(var O=k.shapes.head;null!=O;){var S=O.elt;S.type==ye.id_ShapeType_POLYGON&&(S.polygon.invalidate_gverts(),S.polygon.invalidate_gaxi()),S.invalidate_worldCOM(),O=O.next}k.zip_worldCOM=!0,C.zpp_inner.wake()}if(n.zpp_inner.weak=t){var P=n.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var A=n;A.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=A:Cl.poolVec2=A,Cl.nextVec2=A,A.zpp_disp=!0;var E=T;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=Ct.zpp_pool,Ct.zpp_pool=E}return this},setShapeMaterials:function(n){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt,i=t.outer;i.zpp_inner.immutable_midstep("Shape::material"),i.zpp_inner.setMaterial(n.zpp_inner),i.zpp_inner.material.wrapper(),e=e.next}return this},setShapeFilters:function(n){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt,i=t.outer;i.zpp_inner.immutable_midstep("Shape::filter"),i.zpp_inner.setFilter(n.zpp_inner),i.zpp_inner.filter.wrapper(),e=e.next}return this},setShapeFluidProperties:function(n){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt,i=t.outer;i.zpp_inner.setFluid(n.zpp_inner),i.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==i.zpp_inner.fluidProperties&&i.zpp_inner.setFluid((new Bn).zpp_inner),i.zpp_inner.fluidProperties.wrapper(),e=e.next}return this},get_localCOM:function(){if(null==this.zpp_inner.wrap_localCOM){var n,e=this.zpp_inner.localCOMx,i=this.zpp_inner.localCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=n,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=(Il=this.zpp_inner,t(Il,Il.getlocalCOM))}return this.zpp_inner.wrap_localCOM},get_worldCOM:function(){if(null==this.zpp_inner.wrap_worldCOM){var n,e=this.zpp_inner.worldCOMx,i=this.zpp_inner.worldCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=n,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=(Il=this.zpp_inner,t(Il,Il.getworldCOM))}return this.zpp_inner.wrap_worldCOM},normalImpulse:function(n,e){null==e&&(e=!1);var t=0,i=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner.zpp_gl();r.zpp_critical=!0;var p;if(a>r.zpp_i?p=!0:(r.zpp_next=Q.zpp_pool,Q.zpp_pool=r,r.zpp_inner=null,p=!1),!p)break;r.zpp_critical=!1;var s=r.zpp_inner.at(r.zpp_i++),o=s.zpp_inner;if(o.type==Ne.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var h=o.wrapper(),_=(h.zpp_inner.type==Ne.COL?h.zpp_inner.colarb.outer_zn:null).normalImpulse(this,e),u=_.zpp_inner;null!=u._validate&&u._validate(),t+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),i+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),l+=1*_.zpp_inner.z,_.dispose()}}return Tn.get(t,i,l)},tangentImpulse:function(n,e){null==e&&(e=!1);var t=0,i=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner.zpp_gl();r.zpp_critical=!0;var p;if(a>r.zpp_i?p=!0:(r.zpp_next=Q.zpp_pool,Q.zpp_pool=r,r.zpp_inner=null,p=!1),!p)break;r.zpp_critical=!1;var s=r.zpp_inner.at(r.zpp_i++),o=s.zpp_inner;if(o.type==Ne.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var h=o.wrapper(),_=(h.zpp_inner.type==Ne.COL?h.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,e),u=_.zpp_inner;null!=u._validate&&u._validate(),t+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),i+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),l+=1*_.zpp_inner.z,_.dispose()}}return Tn.get(t,i,l)},totalContactsImpulse:function(n,e){null==e&&(e=!1);var t=0,i=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner.zpp_gl();r.zpp_critical=!0;var p;if(a>r.zpp_i?p=!0:(r.zpp_next=Q.zpp_pool,Q.zpp_pool=r,r.zpp_inner=null,p=!1),!p)break;r.zpp_critical=!1;var s=r.zpp_inner.at(r.zpp_i++),o=s.zpp_inner;if(o.type==Ne.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var h=o.wrapper(),_=(h.zpp_inner.type==Ne.COL?h.zpp_inner.colarb.outer_zn:null).totalImpulse(this,e),u=_.zpp_inner;null!=u._validate&&u._validate(),t+=1*_.zpp_inner.x;var d=_.zpp_inner;null!=d._validate&&d._validate(),i+=1*_.zpp_inner.y;var c=_.zpp_inner;null!=c._validate&&c._validate(),l+=1*_.zpp_inner.z,_.dispose()}}return Tn.get(t,i,l)},rollingImpulse:function(n,e){null==e&&(e=!1);var t=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var i=this.zpp_inner.wrap_arbiters.iterator();;){i.zpp_inner.zpp_inner.valmod();var l=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var r;if(l>i.zpp_i?r=!0:(i.zpp_next=Q.zpp_pool,Q.zpp_pool=i,i.zpp_inner=null,r=!1),!r)break;i.zpp_critical=!1;var a=i.zpp_inner.at(i.zpp_i++),p=a.zpp_inner;if(p.type==Ne.COL&&(null==n||p.b2==n.zpp_inner||p.b1==n.zpp_inner)){var s=p.wrapper();t+=(s.zpp_inner.type==Ne.COL?s.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,e)}}return t},buoyancyImpulse:function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var a;if(r>l.zpp_i?a=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,a=!1),!a)break;l.zpp_critical=!1;var p=l.zpp_inner.at(l.zpp_i++),s=p.zpp_inner;if(s.type==Ne.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),h=(o.zpp_inner.type==Ne.FLUID?o.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this),_=h.zpp_inner;null!=_._validate&&_._validate(),e+=1*h.zpp_inner.x;var u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),i+=1*h.zpp_inner.z,h.dispose()}}return Tn.get(e,t,i)},dragImpulse:function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var a;if(r>l.zpp_i?a=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,a=!1),!a)break;l.zpp_critical=!1;var p=l.zpp_inner.at(l.zpp_i++),s=p.zpp_inner;if(s.type==Ne.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),h=(o.zpp_inner.type==Ne.FLUID?o.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this),_=h.zpp_inner;null!=_._validate&&_._validate(),e+=1*h.zpp_inner.x;var u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),i+=1*h.zpp_inner.z,h.dispose()}}return Tn.get(e,t,i)},totalFluidImpulse:function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var a;if(r>l.zpp_i?a=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,a=!1),!a)break;l.zpp_critical=!1;var p=l.zpp_inner.at(l.zpp_i++),s=p.zpp_inner;if(s.type==Ne.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),h=(o.zpp_inner.type==Ne.FLUID?o.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this),_=h.zpp_inner;null!=_._validate&&_._validate(),e+=1*h.zpp_inner.x;var u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),i+=1*h.zpp_inner.z,h.dispose()}}return Tn.get(e,t,i)},constraintsImpulse:function(){for(var n=0,e=0,t=0,i=this.zpp_inner.constraints.head;null!=i;){var l=i.elt,r=l.outer.bodyImpulse(this),a=r.zpp_inner;null!=a._validate&&a._validate(),n+=1*r.zpp_inner.x;var p=r.zpp_inner;null!=p._validate&&p._validate(),e+=1*r.zpp_inner.y;var s=r.zpp_inner;null!=s._validate&&s._validate(),t+=1*r.zpp_inner.z,r.dispose(),i=i.next}return Tn.get(n,e,t)},totalImpulse:function(n,e){null==e&&(e=!1);var t=0,i=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var r=this.zpp_inner.wrap_arbiters.iterator();;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner.zpp_gl();r.zpp_critical=!0;var p;if(a>r.zpp_i?p=!0:(r.zpp_next=Q.zpp_pool,Q.zpp_pool=r,r.zpp_inner=null,p=!1),!p)break;r.zpp_critical=!1;var s=r.zpp_inner.at(r.zpp_i++),o=s.zpp_inner;if(o.type!=Ne.SENSOR&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var h=o.wrapper().totalImpulse(this,e),_=h.zpp_inner;null!=_._validate&&_._validate(),t+=1*h.zpp_inner.x;var u=h.zpp_inner;null!=u._validate&&u._validate(),i+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),l+=1*h.zpp_inner.z,h.dispose()}}for(var c=this.zpp_inner.constraints.head;null!=c;){var x=c.elt;if(x.active){var v=x.outer.bodyImpulse(this),z=v.zpp_inner;null!=z._validate&&z._validate(),t+=1*v.zpp_inner.x;var y=v.zpp_inner;null!=y._validate&&y._validate(),i+=1*v.zpp_inner.y;var f=v.zpp_inner;null!=f._validate&&f._validate(),l+=1*v.zpp_inner.z,v.dispose()}c=c.next}return Tn.get(t,i,l)},contains:function(n){var e=n.zpp_inner.weak;n.zpp_inner.weak=!1;var t;t=!1;for(var i=this.zpp_inner.shapes.head;null!=i;){if(i.elt.outer.contains(n)){t=!0;break}i=i.next}if(n.zpp_inner.weak=e){var l=n.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var a=n;a.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=a:Cl.poolVec2=a,Cl.nextVec2=a,a.zpp_disp=!0;var p=r;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Ct.zpp_pool,Ct.zpp_pool=p}return t},toString:function(){return(this.zpp_inner.world?"(space::world":"("+(this.zpp_inner.type==ye.id_BodyType_DYNAMIC?"dynamic":this.zpp_inner.type==ye.id_BodyType_STATIC?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:In,__properties__:e(En.prototype.__properties__,{get_worldCOM:"get_worldCOM",get_localCOM:"get_localCOM",set_inertia:"set_inertia",get_inertia:"get_inertia",get_constraintInertia:"get_constraintInertia",set_inertiaMode:"set_inertiaMode",get_inertiaMode:"get_inertiaMode",set_gravMassScale:"set_gravMassScale",get_gravMassScale:"get_gravMassScale",set_gravMass:"set_gravMass",get_gravMass:"get_gravMass",set_gravMassMode:"set_gravMassMode",get_gravMassMode:"get_gravMassMode",set_mass:"set_mass",get_mass:"get_mass",get_constraintMass:"get_constraintMass",set_massMode:"set_massMode",get_massMode:"get_massMode",set_allowRotation:"set_allowRotation",get_allowRotation:"get_allowRotation",set_allowMovement:"set_allowMovement",get_allowMovement:"get_allowMovement",get_bounds:"get_bounds",set_torque:"set_torque",get_torque:"get_torque",set_kinAngVel:"set_kinAngVel",get_kinAngVel:"get_kinAngVel",set_angularVel:"set_angularVel",get_angularVel:"get_angularVel",set_rotation:"set_rotation",get_rotation:"get_rotation",get_constraintVelocity:"get_constraintVelocity",set_force:"set_force",get_force:"get_force",set_surfaceVel:"set_surfaceVel",get_surfaceVel:"get_surfaceVel",set_kinematicVel:"set_kinematicVel",get_kinematicVel:"get_kinematicVel",set_velocity:"set_velocity",get_velocity:"get_velocity",set_position:"set_position",get_position:"get_position",get_constraints:"get_constraints",get_isSleeping:"get_isSleeping",get_arbiters:"get_arbiters",set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_shapes:"get_shapes",set_disableCCD:"set_disableCCD",get_disableCCD:"get_disableCCD",set_isBullet:"set_isBullet",get_isBullet:"get_isBullet",set_type:"set_type",get_type:"get_type"})});var Vn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.BodyIterator"]=Vn,Vn.__name__=["nape","phys","BodyIterator"],Vn.get=function(n){var e;if(null==Vn.zpp_pool){ol.internal=!0;var t=new Vn;ol.internal=!1,e=t}else{var i=Vn.zpp_pool;Vn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Vn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Vn.zpp_pool,Vn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Vn};var Ln=function(){this.zpp_inner=null,this.zpp_inner=new ol,this.zpp_inner.outer=this};l["nape.phys.BodyList"]=Ln,Ln.__name__=["nape","phys","BodyList"],Ln.fromArray=function(n){for(var e=new Ln,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Ln.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Vn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Ln;this.zpp_inner.valmod();for(var t=Vn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Vn.zpp_pool,Vn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Vn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Vn.zpp_pool,Vn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Vn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Vn.zpp_pool,Vn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Vn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Vn.zpp_pool,Vn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=Vn.zpp_pool,Vn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Ln,__properties__:{get_length:"get_length"}};var Nn=function(){};l["nape.phys.BodyType"]=Nn,Nn.__name__=["nape","phys","BodyType"],Nn.__properties__={get_KINEMATIC:"get_KINEMATIC",get_DYNAMIC:"get_DYNAMIC",get_STATIC:"get_STATIC"},Nn.get_STATIC=function(){return null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1),ye.BodyType_STATIC},Nn.get_DYNAMIC=function(){return null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1),ye.BodyType_DYNAMIC},Nn.get_KINEMATIC=function(){return null==ye.BodyType_KINEMATIC&&(ye.internal=!0,ye.BodyType_KINEMATIC=new Nn,ye.internal=!1),ye.BodyType_KINEMATIC},Nn.prototype={toString:function(){return null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1),this==ye.BodyType_STATIC?"STATIC":(null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1),this==ye.BodyType_DYNAMIC?"DYNAMIC":(null==ye.BodyType_KINEMATIC&&(ye.internal=!0,ye.BodyType_KINEMATIC=new Nn,ye.internal=!1),this==ye.BodyType_KINEMATIC?"KINEMATIC":""))},__class__:Nn};var Dn=function(){this.zpp_inner=null,En.zpp_internalAlloc=!0,En.call(this),En.zpp_internalAlloc=!1,this.zpp_inner=new Pt,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(ze.ANY_COMPOUND.zpp_inner)};l["nape.phys.Compound"]=Dn,Dn.__name__=["nape","phys","Compound"],Dn.__super__=En,Dn.prototype=e(En.prototype,{zpp_inner:null,get_bodies:function(){return this.zpp_inner.wrap_bodies},get_constraints:function(){return this.zpp_inner.wrap_constraints},get_compounds:function(){return this.zpp_inner.wrap_compounds},get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if(this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if(this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){return"Compound"+this.zpp_inner_i.id},copy:function(){return this.zpp_inner.copy()},breakApart:function(){this.zpp_inner.breakApart()},visitBodies:function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var t=Vn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Vn.zpp_pool,Vn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;n(t.zpp_inner.at(t.zpp_i++))}var a=this.zpp_inner.wrap_compounds;a.zpp_inner.valmod();for(var p=jn.get(a);;){p.zpp_inner.zpp_inner.valmod();var s=p.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;p.zpp_critical=!0;var h;if(o>p.zpp_i?h=!0:(p.zpp_next=jn.zpp_pool,jn.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1;p.zpp_inner.at(p.zpp_i++).visitBodies(n)}},visitConstraints:function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var t=G.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=G.zpp_pool,G.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;n(t.zpp_inner.at(t.zpp_i++))}var a=this.zpp_inner.wrap_compounds;a.zpp_inner.valmod();for(var p=jn.get(a);;){p.zpp_inner.zpp_inner.valmod();var s=p.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;p.zpp_critical=!0;var h;if(o>p.zpp_i?h=!0:(p.zpp_next=jn.zpp_pool,jn.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1;p.zpp_inner.at(p.zpp_i++).visitConstraints(n)}},visitCompounds:function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var t=jn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);n(a),a.visitCompounds(n)}},COM:function(n){null==n&&(n=!1);var e;if(null==Cl.poolVec2?e=new On:(e=Cl.poolVec2,Cl.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Cl.nextVec2&&(Cl.nextVec2=null)),null==e.zpp_inner){var i;null==Ct.zpp_pool?i=new Ct:(i=Ct.zpp_pool,Ct.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=0,i.y=0,e.zpp_inner=i,e.zpp_inner.outer=e}else{var l=e.zpp_inner;null!=l._isimmutable&&l._isimmutable();var r,a=e.zpp_inner;if(null!=a._validate&&a._validate(),0==e.zpp_inner.x){var p=e.zpp_inner;null!=p._validate&&p._validate(),r=0==e.zpp_inner.y}else r=!1;if(!r){e.zpp_inner.x=0,e.zpp_inner.y=0;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=n;var o=e,h=0;return this.visitBodies(function(n){if(null!=n.zpp_inner.wrap_shapes.zpp_inner.inner.head){if(null==n.zpp_inner.wrap_worldCOM){var e,i=n.zpp_inner.worldCOMx,l=n.zpp_inner.worldCOMy;if(null==Cl.poolVec2?e=new On:(e=Cl.poolVec2,Cl.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Cl.nextVec2&&(Cl.nextVec2=null)),null==e.zpp_inner){var r;null==Ct.zpp_pool?r=new Ct:(r=Ct.zpp_pool,Ct.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=l,e.zpp_inner=r,e.zpp_inner.outer=e}else{var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==i){var _=e.zpp_inner;null!=_._validate&&_._validate(),p=e.zpp_inner.y==l}else p=!1;if(!p){e.zpp_inner.x=i,e.zpp_inner.y=l;var u=e.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}e.zpp_inner.weak=!1,n.zpp_inner.wrap_worldCOM=e,n.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._validate=(Il=n.zpp_inner,t(Il,Il.getworldCOM))}var d=n.zpp_inner.wrap_worldCOM;n.zpp_inner.validate_mass();var c=d.mul(n.zpp_inner.cmass,!0);o.addeq(c),n.zpp_inner.validate_mass(),h+=n.zpp_inner.cmass}}),o.muleq(1/h),o},translate:function(n){var e=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(e){null==e.zpp_inner.wrap_pos&&e.zpp_inner.setupPosition(),e.zpp_inner.wrap_pos.addeq(n)}),n.zpp_inner.weak=e){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var l=n;l.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=l:Cl.poolVec2=l,Cl.nextVec2=l,l.zpp_disp=!0;var r=i;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ct.zpp_pool,Ct.zpp_pool=r}return this},rotate:function(n,e){var t=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(t){t.rotate(n,e)}),n.zpp_inner.weak=t){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var r=n;r.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=r:Cl.poolVec2=r,Cl.nextVec2=r,r.zpp_disp=!0;var a=l;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a}return this},__class__:Dn,__properties__:e(En.prototype.__properties__,{set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_compounds:"get_compounds",get_constraints:"get_constraints",get_bodies:"get_bodies"})});var jn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.CompoundIterator"]=jn,jn.__name__=["nape","phys","CompoundIterator"],jn.get=function(n){var e;if(null==jn.zpp_pool){_l.internal=!0;var t=new jn;_l.internal=!1,e=t}else{var i=jn.zpp_pool;jn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},jn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=jn.zpp_pool,jn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:jn};var Fn=function(){this.zpp_inner=null,this.zpp_inner=new _l,this.zpp_inner.outer=this};l["nape.phys.CompoundList"]=Fn,Fn.__name__=["nape","phys","CompoundList"],Fn.fromArray=function(n){for(var e=new Fn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Fn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),jn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Fn;this.zpp_inner.valmod();for(var t=jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=jn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Fn,__properties__:{get_length:"get_length"}};var Bn=function(n,e){null==e&&(e=1),null==n&&(n=1),this.zpp_inner=null,null==Tt.zpp_pool?this.zpp_inner=new Tt:(this.zpp_inner=Tt.zpp_pool,Tt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),e!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=e/1,this.zpp_inner.invalidate())};l["nape.phys.FluidProperties"]=Bn,Bn.__name__=["nape","phys","FluidProperties"],Bn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=fl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},copy:function(){var n=new Bn(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(n.zpp_inner.userData=o.copy(this.zpp_inner.userData));var e=this.zpp_inner.wrap_gravity;if(null==e){if(null!=n.zpp_inner.wrap_gravity){n.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var t=n.zpp_inner.wrap_gravity,i=t.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var r=t;r.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=r:Cl.poolVec2=r,Cl.nextVec2=r,r.zpp_disp=!0;var a=l;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,n.zpp_inner.wrap_gravity=null}}else{null==n.zpp_inner.wrap_gravity&&n.zpp_inner.getgravity();var p=n.zpp_inner.wrap_gravity,s=p.zpp_inner;null!=s._isimmutable&&s._isimmutable();var h=e.zpp_inner;null!=h._validate&&h._validate();var _=e.zpp_inner.x,u=e.zpp_inner;null!=u._validate&&u._validate();var d=e.zpp_inner.y,c=p.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x,v=p.zpp_inner;if(null!=v._validate&&v._validate(),p.zpp_inner.x==_){var z=p.zpp_inner;null!=z._validate&&z._validate(),x=p.zpp_inner.y==d}else x=!1;if(!x){p.zpp_inner.x=_,p.zpp_inner.y=d;var y=p.zpp_inner;null!=y._invalidate&&y._invalidate(y)}if(e.zpp_inner.weak){var f=e.zpp_inner;null!=f._isimmutable&&f._isimmutable();var m=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var b=e;b.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=b:Cl.poolVec2=b,Cl.nextVec2=b,b.zpp_disp=!0;var g=m;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Ct.zpp_pool,Ct.zpp_pool=g}}return n},get_density:function(){return 1e3*this.zpp_inner.density},set_density:function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},get_viscosity:function(){return this.zpp_inner.viscosity},set_viscosity:function(n){return n!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=n/1,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},get_gravity:function(){return this.zpp_inner.wrap_gravity},set_gravity:function(n){if(null==n){if(null!=this.zpp_inner.wrap_gravity){this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var e=this.zpp_inner.wrap_gravity,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var l=e;l.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=l:Cl.poolVec2=l,Cl.nextVec2=l,l.zpp_disp=!0;var r=i;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ct.zpp_pool,Ct.zpp_pool=r,this.zpp_inner.wrap_gravity=null}}else{null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var a=this.zpp_inner.wrap_gravity,p=a.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.x,h=n.zpp_inner;null!=h._validate&&h._validate();var _=n.zpp_inner.y,u=a.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d,c=a.zpp_inner;if(null!=c._validate&&c._validate(),a.zpp_inner.x==o){var x=a.zpp_inner;null!=x._validate&&x._validate(),d=a.zpp_inner.y==_}else d=!1;if(!d){a.zpp_inner.x=o,a.zpp_inner.y=_;var v=a.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(n.zpp_inner.weak){var z=n.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var f=n;f.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=f:Cl.poolVec2=f,Cl.nextVec2=f,f.zpp_disp=!0;var m=y;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ct.zpp_pool,Ct.zpp_pool=m}}return this.zpp_inner.wrap_gravity},toString:function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+h.string(this.zpp_inner.wrap_gravity)+" }"},__class__:Bn,__properties__:{set_gravity:"set_gravity",get_gravity:"get_gravity",set_viscosity:"set_viscosity",get_viscosity:"get_viscosity",set_density:"set_density",get_density:"get_density",get_shapes:"get_shapes",get_userData:"get_userData"}};var Rn=function(){};l["nape.phys.GravMassMode"]=Rn,Rn.__name__=["nape","phys","GravMassMode"],Rn.__properties__={get_SCALED:"get_SCALED",get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},Rn.get_DEFAULT=function(){return null==ye.GravMassMode_DEFAULT&&(ye.internal=!0,ye.GravMassMode_DEFAULT=new Rn,ye.internal=!1),ye.GravMassMode_DEFAULT},Rn.get_FIXED=function(){return null==ye.GravMassMode_FIXED&&(ye.internal=!0,ye.GravMassMode_FIXED=new Rn,ye.internal=!1),ye.GravMassMode_FIXED},Rn.get_SCALED=function(){return null==ye.GravMassMode_SCALED&&(ye.internal=!0,ye.GravMassMode_SCALED=new Rn,ye.internal=!1),ye.GravMassMode_SCALED},Rn.prototype={toString:function(){return null==ye.GravMassMode_DEFAULT&&(ye.internal=!0,ye.GravMassMode_DEFAULT=new Rn,ye.internal=!1),this==ye.GravMassMode_DEFAULT?"DEFAULT":(null==ye.GravMassMode_FIXED&&(ye.internal=!0,ye.GravMassMode_FIXED=new Rn,ye.internal=!1),this==ye.GravMassMode_FIXED?"FIXED":(null==ye.GravMassMode_SCALED&&(ye.internal=!0,ye.GravMassMode_SCALED=new Rn,ye.internal=!1),this==ye.GravMassMode_SCALED?"SCALED":""))},__class__:Rn};var Gn=function(){};l["nape.phys.InertiaMode"]=Gn,Gn.__name__=["nape","phys","InertiaMode"],Gn.__properties__={get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},Gn.get_DEFAULT=function(){return null==ye.InertiaMode_DEFAULT&&(ye.internal=!0,ye.InertiaMode_DEFAULT=new Gn,ye.internal=!1),ye.InertiaMode_DEFAULT},Gn.get_FIXED=function(){return null==ye.InertiaMode_FIXED&&(ye.internal=!0,ye.InertiaMode_FIXED=new Gn,ye.internal=!1),ye.InertiaMode_FIXED},Gn.prototype={toString:function(){return null==ye.InertiaMode_DEFAULT&&(ye.internal=!0,ye.InertiaMode_DEFAULT=new Gn,ye.internal=!1),this==ye.InertiaMode_DEFAULT?"DEFAULT":(null==ye.InertiaMode_FIXED&&(ye.internal=!0,ye.InertiaMode_FIXED=new Gn,ye.internal=!1),this==ye.InertiaMode_FIXED?"FIXED":"")},__class__:Gn};var Yn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.InteractorIterator"]=Yn,Yn.__name__=["nape","phys","InteractorIterator"],Yn.get=function(n){var e;if(null==Yn.zpp_pool){hl.internal=!0;var t=new Yn;hl.internal=!1,e=t}else{var i=Yn.zpp_pool;Yn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Yn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Yn.zpp_pool,Yn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Yn};var Un=function(){this.zpp_inner=null,this.zpp_inner=new hl,this.zpp_inner.outer=this};l["nape.phys.InteractorList"]=Un,Un.__name__=["nape","phys","InteractorList"],Un.fromArray=function(n){for(var e=new Un,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Un.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner_i)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner_i);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}else this.zpp_inner.inner.add(n.zpp_inner_i);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer_i},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer_i},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner_i){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner_i),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Yn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Un;this.zpp_inner.valmod();for(var t=Yn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Yn.zpp_pool,Yn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Yn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Yn.zpp_pool,Yn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Yn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Yn.zpp_pool,Yn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Yn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Yn.zpp_pool,Yn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=Yn.zpp_pool,Yn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Un,__properties__:{get_length:"get_length"}};var Zn=function(){};l["nape.phys.MassMode"]=Zn,Zn.__name__=["nape","phys","MassMode"],Zn.__properties__={get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},Zn.get_DEFAULT=function(){return null==ye.MassMode_DEFAULT&&(ye.internal=!0,ye.MassMode_DEFAULT=new Zn,ye.internal=!1),ye.MassMode_DEFAULT},Zn.get_FIXED=function(){return null==ye.MassMode_FIXED&&(ye.internal=!0,ye.MassMode_FIXED=new Zn,ye.internal=!1),ye.MassMode_FIXED},Zn.prototype={toString:function(){return null==ye.MassMode_DEFAULT&&(ye.internal=!0,ye.MassMode_DEFAULT=new Zn,ye.internal=!1),this==ye.MassMode_DEFAULT?"DEFAULT":(null==ye.MassMode_FIXED&&(ye.internal=!0,ye.MassMode_FIXED=new Zn,ye.internal=!1),this==ye.MassMode_FIXED?"FIXED":"")},__class__:Zn};var qn=function(n,e,t,i,l){null==l&&(l=.001),null==i&&(i=1),null==t&&(t=2),null==e&&(e=1),null==n&&(n=0),this.zpp_inner=null,null==At.zpp_pool?this.zpp_inner=new At:(this.zpp_inner=At.zpp_pool,At.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS)),e!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=e/1,this.zpp_inner.invalidate(At.WAKE|At.ANGDRAG|At.ARBITERS)),t!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=t/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS)),i!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=i/1e3,this.zpp_inner.invalidate(At.WAKE|At.PROPS)),l!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=l/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS))};l["nape.phys.Material"]=qn,qn.__name__=["nape","phys","Material"],qn.wood=function(){return new qn(.4,.2,.38,.7,.005)},qn.steel=function(){return new qn(.2,.57,.74,7.8,.001)},qn.ice=function(){return new qn(.3,.03,.1,.9,1e-4)},qn.rubber=function(){return new qn(.8,1,1.4,1.5,.01)},qn.glass=function(){return new qn(.4,.4,.94,2.6,.002)},qn.sand=function(){return new qn(-1,.45,.6,1.6,16)},qn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=fl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},copy:function(){var n=new qn(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(n.zpp_inner.userData=o.copy(this.zpp_inner.userData)),n},get_elasticity:function(){return this.zpp_inner.elasticity},set_elasticity:function(n){return n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS)),this.zpp_inner.elasticity},get_dynamicFriction:function(){return this.zpp_inner.dynamicFriction},set_dynamicFriction:function(n){return n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=n/1,this.zpp_inner.invalidate(At.WAKE|At.ANGDRAG|At.ARBITERS)),this.zpp_inner.dynamicFriction},get_staticFriction:function(){return this.zpp_inner.staticFriction},set_staticFriction:function(n){return n!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=n/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS)),this.zpp_inner.staticFriction},get_density:function(){return 1e3*this.zpp_inner.density},set_density:function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(At.WAKE|At.PROPS)),1e3*this.zpp_inner.density},get_rollingFriction:function(){return this.zpp_inner.rollingFriction},set_rollingFriction:function(n){return n!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=n/1,this.zpp_inner.invalidate(At.WAKE|At.ARBITERS)),this.zpp_inner.rollingFriction},toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:qn,__properties__:{set_rollingFriction:"set_rollingFriction",get_rollingFriction:"get_rollingFriction",set_density:"set_density",get_density:"get_density",set_staticFriction:"set_staticFriction",get_staticFriction:"get_staticFriction",set_dynamicFriction:"set_dynamicFriction",get_dynamicFriction:"get_dynamicFriction",set_elasticity:"set_elasticity",get_elasticity:"get_elasticity",get_shapes:"get_shapes",get_userData:"get_userData"}};var Wn=function(){this.zpp_inner=null,En.zpp_internalAlloc=!0,En.call(this),En.zpp_internalAlloc=!1};l["nape.shape.Shape"]=Wn,Wn.__name__=["nape","shape","Shape"],Wn.__super__=En,Wn.prototype=e(En.prototype,{zpp_inner:null,get_type:function(){return Et.types[this.zpp_inner.type]},isCircle:function(){return this.zpp_inner.type==ye.id_ShapeType_CIRCLE},isPolygon:function(){return this.zpp_inner.type==ye.id_ShapeType_POLYGON},get_body:function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},set_body:function(n){if(this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=n&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=n)){var e=n.zpp_inner.wrap_shapes;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},get_castCircle:function(){return this.zpp_inner.type==ye.id_ShapeType_CIRCLE?this.zpp_inner.circle.outer_zn:null},get_castPolygon:function(){return this.zpp_inner.type==ye.id_ShapeType_POLYGON?this.zpp_inner.polygon.outer_zn:null},get_worldCOM:function(){if(null==this.zpp_inner.wrap_worldCOM){var n,e=this.zpp_inner.worldCOMx,i=this.zpp_inner.worldCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=n,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=(Il=this.zpp_inner,t(Il,Il.getworldCOM))}return this.zpp_inner.wrap_worldCOM},get_localCOM:function(){return null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==ye.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},set_localCOM:function(n){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==ye.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM());var e=this.zpp_inner.wrap_localCOM,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==ye.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},get_area:function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},get_inertia:function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},get_angDrag:function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},get_material:function(){return this.zpp_inner.material.wrapper()},set_material:function(n){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper()},get_filter:function(){return this.zpp_inner.filter.wrapper()},set_filter:function(n){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()},get_fluidProperties:function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Bn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},set_fluidProperties:function(n){return this.zpp_inner.setFluid(n.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Bn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},get_fluidEnabled:function(){return this.zpp_inner.fluidEnabled},set_fluidEnabled:function(n){if(this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),this.zpp_inner.fluidEnabled=n,n&&null==this.zpp_inner.fluidProperties){var e=new Bn;this.zpp_inner.setFluid(e.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Bn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()}return this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},get_sensorEnabled:function(){return this.zpp_inner.sensorEnabled},set_sensorEnabled:function(n){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=n,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},get_bounds:function(){return this.zpp_inner.aabb.wrapper()},translate:function(n){if(this.zpp_inner.immutable_midstep("Shape::translate()"),n.lsq()>0)if(this.zpp_inner.type==ye.id_ShapeType_CIRCLE){var e=this.zpp_inner.circle,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate(),e.__translate(i,n.zpp_inner.y)}else{var r=this.zpp_inner.polygon,a=n.zpp_inner;null!=a._validate&&a._validate();var p=n.zpp_inner.x,s=n.zpp_inner;null!=s._validate&&s._validate(),r.__translate(p,n.zpp_inner.y)}if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_:Cl.poolVec2=_,Cl.nextVec2=_,_.zpp_disp=!0;var u=h;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u}return this},scale:function(n,e){if(this.zpp_inner.immutable_midstep("Shape::scale()"),this.zpp_inner.type==ye.id_ShapeType_CIRCLE){var t=n*n-e*e;f.epsilon*f.epsilon>t*t&&this.zpp_inner.circle.__scale(n,e)}else this.zpp_inner.polygon.__scale(n,e);return this},rotate:function(n){if(this.zpp_inner.immutable_midstep("Shape::rotate()"),0!=n%(2*Math.PI)){var e=Math.cos(n),t=Math.sin(n);this.zpp_inner.type==ye.id_ShapeType_CIRCLE?this.zpp_inner.circle.__rotate(t,e):this.zpp_inner.polygon.__rotate(t,e)}return this},transform:function(n){return this.zpp_inner.immutable_midstep("Shape::transform()"),n.singular(),this.zpp_inner.type==ye.id_ShapeType_CIRCLE?n.equiorthogonal()&&this.zpp_inner.circle.__transform(n):this.zpp_inner.polygon.__transform(n),this},contains:function(n){$e.validateShape(this.zpp_inner);var e=n.zpp_inner;null!=e._validate&&e._validate();var t=We.shapeContains(this.zpp_inner,n.zpp_inner);if(n.zpp_inner.weak){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var r=n;r.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=r:Cl.poolVec2=r,Cl.nextVec2=r,r.zpp_disp=!0;var a=l;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a}return t},copy:function(){return this.zpp_inner.copy()},toString:function(){return(this.zpp_inner.type==ye.id_ShapeType_CIRCLE?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},__class__:Wn,__properties__:e(En.prototype.__properties__,{get_bounds:"get_bounds",set_sensorEnabled:"set_sensorEnabled",get_sensorEnabled:"get_sensorEnabled",set_fluidEnabled:"set_fluidEnabled",get_fluidEnabled:"get_fluidEnabled",set_fluidProperties:"set_fluidProperties",get_fluidProperties:"get_fluidProperties",set_filter:"set_filter",get_filter:"get_filter",set_material:"set_material",get_material:"get_material",get_angDrag:"get_angDrag",get_inertia:"get_inertia",get_area:"get_area",set_localCOM:"set_localCOM",get_localCOM:"get_localCOM",get_worldCOM:"get_worldCOM",get_castPolygon:"get_castPolygon",get_castCircle:"get_castCircle",set_body:"set_body",get_body:"get_body",get_type:"get_type"})});var Xn=function(n,e,t,i){if(this.zpp_inner_zn=null,Wn.zpp_internalAlloc=!0,Wn.call(this),Wn.zpp_internalAlloc=!1,this.zpp_inner_zn=new It,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),null==e)this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0;else{var l=e.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.localCOMx=e.zpp_inner.x;var r=e.zpp_inner;if(null!=r._validate&&r._validate(),this.zpp_inner.localCOMy=e.zpp_inner.y,e.zpp_inner.weak){var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}}if(null==t){null==At.zpp_pool?this.zpp_inner.material=new At:(this.zpp_inner.material=At.zpp_pool,At.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null)}else this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(t.zpp_inner),this.zpp_inner.material.wrapper();if(null==i){null==Ge.zpp_pool?this.zpp_inner.filter=new Ge:(this.zpp_inner.filter=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null)}else this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper();this.zpp_inner_i.insert_cbtype(ze.ANY_SHAPE.zpp_inner)};l["nape.shape.Circle"]=Xn,Xn.__name__=["nape","shape","Circle"],Xn.__super__=Wn,Xn.prototype=e(Wn.prototype,{zpp_inner_zn:null,get_radius:function(){return this.zpp_inner_zn.radius},set_radius:function(n){return this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},__class__:Xn,__properties__:e(Wn.prototype.__properties__,{set_radius:"set_radius",get_radius:"get_radius"})});var Hn=function(){this.zpp_inner=null};l["nape.shape.Edge"]=Hn,Hn.__name__=["nape","shape","Edge"],Hn.prototype={zpp_inner:null,get_polygon:function(){return this.zpp_inner.polygon.outer_zn},get_localNormal:function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},get_worldNormal:function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},get_length:function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},get_localProjection:function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},get_worldProjection:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,l=n.gverts.next;null!=l;){var r=l,a=i;i=i.next,r.x=n.body.posx+(n.body.axisy*a.x-n.body.axisx*a.y),r.y=n.body.posy+(a.x*n.body.axisx+a.y*n.body.axisy),l=l.next}}var p=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var h=s,_=p.elt;p=p.next,_.gp0=o,_.gp1=h,_.gnormx=n.body.axisy*_.lnormx-n.body.axisx*_.lnormy,_.gnormy=_.lnormx*n.body.axisx+_.lnormy*n.body.axisy,_.gprojection=n.body.posx*_.gnormx+n.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=h,s=s.next}var u=n.gverts.next,d=p.elt;p=p.next,d.gp0=o,d.gp1=u,d.gnormx=n.body.axisy*d.lnormx-n.body.axisx*d.lnormy,d.gnormy=d.lnormx*n.body.axisx+d.lnormy*n.body.axisy,d.gprojection=n.body.posx*d.gnormx+n.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}return this.zpp_inner.gprojection},get_localVertex1:function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp0;if(null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ct.zpp_pool,Ct.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},get_localVertex2:function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp1;if(null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ct.zpp_pool,Ct.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},get_worldVertex1:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,l=n.gverts.next;null!=l;){var r=l,a=i;i=i.next,r.x=n.body.posx+(n.body.axisy*a.x-n.body.axisx*a.y),r.y=n.body.posy+(a.x*n.body.axisx+a.y*n.body.axisy),l=l.next}}var p=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var h=s,_=p.elt;p=p.next,_.gp0=o,_.gp1=h,_.gnormx=n.body.axisy*_.lnormx-n.body.axisx*_.lnormy,_.gnormy=_.lnormx*n.body.axisx+_.lnormy*n.body.axisy,_.gprojection=n.body.posx*_.gnormx+n.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=h,s=s.next}var u=n.gverts.next,d=p.elt;p=p.next,d.gp0=o,d.gp1=u,d.gnormx=n.body.axisy*d.lnormx-n.body.axisx*d.lnormy,d.gnormy=d.lnormx*n.body.axisx+d.lnormy*n.body.axisy,d.gprojection=n.body.posx*d.gnormx+n.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}var c=this.zpp_inner.gp0;if(null==c.outer){c.outer=new On;var x=c.outer.zpp_inner;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x,c.outer.zpp_inner=c}return c.outer},get_worldVertex2:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,l=n.gverts.next;null!=l;){var r=l,a=i;i=i.next,r.x=n.body.posx+(n.body.axisy*a.x-n.body.axisx*a.y),r.y=n.body.posy+(a.x*n.body.axisx+a.y*n.body.axisy),l=l.next}}var p=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var h=s,_=p.elt;p=p.next,_.gp0=o,_.gp1=h,_.gnormx=n.body.axisy*_.lnormx-n.body.axisx*_.lnormy,_.gnormy=_.lnormx*n.body.axisx+_.lnormy*n.body.axisy,_.gprojection=n.body.posx*_.gnormx+n.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=h,s=s.next}var u=n.gverts.next,d=p.elt;p=p.next,d.gp0=o,d.gp1=u,d.gnormx=n.body.axisy*d.lnormx-n.body.axisx*d.lnormy,d.gnormy=d.lnormx*n.body.axisx+d.lnormy*n.body.axisy,d.gprojection=n.body.posx*d.gnormx+n.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}var c=this.zpp_inner.gp1;if(null==c.outer){c.outer=new On;var x=c.outer.zpp_inner;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x,c.outer.zpp_inner=c}return c.outer},toString:function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,l=n.gverts.next;null!=l;){var r=l,a=i;i=i.next,r.x=n.body.posx+(n.body.axisy*a.x-n.body.axisx*a.y),r.y=n.body.posy+(a.x*n.body.axisx+a.y*n.body.axisy),l=l.next}}var p=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var h=s,_=p.elt;p=p.next,_.gp0=o,_.gp1=h,_.gnormx=n.body.axisy*_.lnormx-n.body.axisx*_.lnormy,_.gnormy=_.lnormx*n.body.axisx+_.lnormy*n.body.axisy,_.gprojection=n.body.posx*_.gnormx+n.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=h,s=s.next}var u=n.gverts.next,d=p.elt;p=p.next,d.gp0=o,d.gp1=u,d.gnormx=n.body.axisy*d.lnormx-n.body.axisx*d.lnormy,d.gnormy=d.lnormx*n.body.axisx+d.lnormy*n.body.axisy,d.gprojection=n.body.posx*d.gnormx+n.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},__class__:Hn,__properties__:{get_worldVertex2:"get_worldVertex2",get_worldVertex1:"get_worldVertex1",get_localVertex2:"get_localVertex2",get_localVertex1:"get_localVertex1",get_worldProjection:"get_worldProjection",get_localProjection:"get_localProjection",get_length:"get_length",get_worldNormal:"get_worldNormal",get_localNormal:"get_localNormal",get_polygon:"get_polygon"}};var Kn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.shape.EdgeIterator"]=Kn,Kn.__name__=["nape","shape","EdgeIterator"],Kn.get=function(n){var e;if(null==Kn.zpp_pool){yl.internal=!0;var t=new Kn;yl.internal=!1,e=t}else{var i=Kn.zpp_pool;Kn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Kn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Kn.zpp_pool,Kn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Kn};var Jn=function(){this.zpp_inner=null,this.zpp_inner=new yl,this.zpp_inner.outer=this};l["nape.shape.EdgeList"]=Jn,Jn.__name__=["nape","shape","EdgeList"],Jn.fromArray=function(n){for(var e=new Jn,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},Jn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n==this.zpp_inner.user_length-1?n=n:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-2-n)),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.wrapper()},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Kn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Jn;this.zpp_inner.valmod();for(var t=Kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Kn.zpp_pool,Kn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Kn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Kn.zpp_pool,Kn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Kn.zpp_pool,Kn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=Kn.zpp_pool,Kn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=Kn.zpp_pool,Kn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:Jn,__properties__:{get_length:"get_length"}};var Qn=function(n,e,t){if(this.zpp_inner_zn=null,Wn.zpp_internalAlloc=!0,Wn.call(this),Wn.zpp_internalAlloc=!1,this.zpp_inner_zn=new Lt,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,n instanceof Array&&null==n.__enum__)for(var i=n,l=0;i.length>l;){var r=i[l];++l,y.__instanceof(r,On);var a=r;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var p=this.zpp_inner_zn.wrap_lverts,s=a.zpp_inner;null!=s._validate&&s._validate();var o=a.zpp_inner.x,h=a.zpp_inner;null!=h._validate&&h._validate();var _,u=a.zpp_inner.y;if(null==Cl.poolVec2?_=new On:(_=Cl.poolVec2,Cl.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==Cl.nextVec2&&(Cl.nextVec2=null)),null==_.zpp_inner){var d;null==Ct.zpp_pool?d=new Ct:(d=Ct.zpp_pool,Ct.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=o,d.y=u,_.zpp_inner=d,_.zpp_inner.outer=_}else{var c=_.zpp_inner;null!=c._isimmutable&&c._isimmutable();var x,v=_.zpp_inner;if(null!=v._validate&&v._validate(),_.zpp_inner.x==o){var z=_.zpp_inner;null!=z._validate&&z._validate(),x=_.zpp_inner.y==u}else x=!1;if(!x){_.zpp_inner.x=o,_.zpp_inner.y=u;var f=_.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}_.zpp_inner.weak=!1,p.push(_)}else if(y.__instanceof(n,Pn))for(var m=n,b=m.iterator();;){b.zpp_inner.zpp_inner.valmod();var g=b.zpp_inner.zpp_gl();b.zpp_critical=!0;var w;if(g>b.zpp_i?w=!0:(b.zpp_next=Sn.zpp_pool,Sn.zpp_pool=b,b.zpp_inner=null,w=!1),!w)break;b.zpp_critical=!1;var C=b.zpp_inner.at(b.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var M=this.zpp_inner_zn.wrap_lverts,k=C.zpp_inner;null!=k._validate&&k._validate();var O=C.zpp_inner.x,S=C.zpp_inner;null!=S._validate&&S._validate();var P,T=C.zpp_inner.y;if(null==Cl.poolVec2?P=new On:(P=Cl.poolVec2,Cl.poolVec2=P.zpp_pool,P.zpp_pool=null,P.zpp_disp=!1,P==Cl.nextVec2&&(Cl.nextVec2=null)),null==P.zpp_inner){var A;null==Ct.zpp_pool?A=new Ct:(A=Ct.zpp_pool,Ct.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=O,A.y=T,P.zpp_inner=A,P.zpp_inner.outer=P}else{var E=P.zpp_inner;null!=E._isimmutable&&E._isimmutable();var I,V=P.zpp_inner;if(null!=V._validate&&V._validate(),P.zpp_inner.x==O){var L=P.zpp_inner;null!=L._validate&&L._validate(),I=P.zpp_inner.y==T}else I=!1;if(!I){P.zpp_inner.x=O,P.zpp_inner.y=T;var N=P.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}P.zpp_inner.weak=!1,M.push(P)}else if(y.__instanceof(n,vn)){var D=n,j=D.zpp_inner.vertices;if(null!=j)for(var F=j;;){var B,R=F.x,G=F.y;if(null==Cl.poolVec2?B=new On:(B=Cl.poolVec2,Cl.poolVec2=B.zpp_pool,B.zpp_pool=null,B.zpp_disp=!1,B==Cl.nextVec2&&(Cl.nextVec2=null)),null==B.zpp_inner){var Y;null==Ct.zpp_pool?Y=new Ct:(Y=Ct.zpp_pool,Ct.zpp_pool=Y.next,Y.next=null),Y.weak=!1,Y._immutable=!1,Y.x=R,Y.y=G,B.zpp_inner=Y,B.zpp_inner.outer=B}else{var U=B.zpp_inner;null!=U._isimmutable&&U._isimmutable();var Z,q=B.zpp_inner;if(null!=q._validate&&q._validate(),B.zpp_inner.x==R){var W=B.zpp_inner;null!=W._validate&&W._validate(),Z=B.zpp_inner.y==G}else Z=!1;if(!Z){B.zpp_inner.x=R,B.zpp_inner.y=G;var X=B.zpp_inner;null!=X._invalidate&&X._invalidate(X)}}B.zpp_inner.weak=!1;var H=B;F=F.next,null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var K=this.zpp_inner_zn.wrap_lverts,J=H.zpp_inner;null!=J._validate&&J._validate();var Q=H.zpp_inner.x,$=H.zpp_inner;null!=$._validate&&$._validate();var nn,en=H.zpp_inner.y;if(null==Cl.poolVec2?nn=new On:(nn=Cl.poolVec2,Cl.poolVec2=nn.zpp_pool,nn.zpp_pool=null,nn.zpp_disp=!1,nn==Cl.nextVec2&&(Cl.nextVec2=null)),null==nn.zpp_inner){var tn;null==Ct.zpp_pool?tn=new Ct:(tn=Ct.zpp_pool,Ct.zpp_pool=tn.next,tn.next=null),tn.weak=!1,tn._immutable=!1,tn.x=Q,tn.y=en,nn.zpp_inner=tn,nn.zpp_inner.outer=nn}else{var ln=nn.zpp_inner;null!=ln._isimmutable&&ln._isimmutable();var rn,an=nn.zpp_inner;if(null!=an._validate&&an._validate(),nn.zpp_inner.x==Q){var pn=nn.zpp_inner;null!=pn._validate&&pn._validate(),rn=nn.zpp_inner.y==en}else rn=!1;if(!rn){nn.zpp_inner.x=Q,nn.zpp_inner.y=en;var sn=nn.zpp_inner;null!=sn._invalidate&&sn._invalidate(sn)}}nn.zpp_inner.weak=!1,K.push(nn);var on=H.zpp_inner;null!=on._isimmutable&&on._isimmutable();var hn=H.zpp_inner;H.zpp_inner.outer=null,H.zpp_inner=null;var _n=H;_n.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_n:Cl.poolVec2=_n,Cl.nextVec2=_n,_n.zpp_disp=!0;var un=hn;if(null!=un.outer&&(un.outer.zpp_inner=null,un.outer=null),un._isimmutable=null,un._validate=null,un._invalidate=null,un.next=Ct.zpp_pool,Ct.zpp_pool=un,F==j)break}}if(n instanceof Array&&null==n.__enum__)for(var dn=n,cn=0;dn.length>cn;){var xn,zn=dn[cn];if(zn.zpp_inner.weak){var yn=zn.zpp_inner;null!=yn._isimmutable&&yn._isimmutable();var fn=zn.zpp_inner;zn.zpp_inner.outer=null,zn.zpp_inner=null;var mn=zn;mn.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=mn:Cl.poolVec2=mn,Cl.nextVec2=mn,mn.zpp_disp=!0;var bn=fn;null!=bn.outer&&(bn.outer.zpp_inner=null,bn.outer=null),bn._isimmutable=null,bn._validate=null,bn._invalidate=null,bn.next=Ct.zpp_pool,Ct.zpp_pool=bn,xn=!0}else xn=!1;xn?dn.splice(cn,1):++cn}else if(y.__instanceof(n,Pn)){var gn=n;null!=gn.zpp_inner._validate&&gn.zpp_inner._validate();for(var wn=gn.zpp_inner.inner,Cn=null,Mn=wn.head;null!=Mn;){var kn=Mn.elt;if(kn.outer.zpp_inner.weak){if(Mn=wn.erase(Cn),kn.outer.zpp_inner.weak){var Tn=kn.outer,An=Tn.zpp_inner;null!=An._isimmutable&&An._isimmutable();var En=Tn.zpp_inner;Tn.zpp_inner.outer=null,Tn.zpp_inner=null;var In=Tn;In.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=In:Cl.poolVec2=In,Cl.nextVec2=In,In.zpp_disp=!0;var Vn=En;null!=Vn.outer&&(Vn.outer.zpp_inner=null,Vn.outer=null),Vn._isimmutable=null,Vn._validate=null,Vn._invalidate=null,Vn.next=Ct.zpp_pool,Ct.zpp_pool=Vn}}else Cn=Mn,Mn=Mn.next}}if(null==e){null==At.zpp_pool?this.zpp_inner.material=new At:(this.zpp_inner.material=At.zpp_pool,At.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null)}else this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper();if(null==t){null==Ge.zpp_pool?this.zpp_inner.filter=new Ge:(this.zpp_inner.filter=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null)}else this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(t.zpp_inner),this.zpp_inner.filter.wrapper();this.zpp_inner_i.insert_cbtype(ze.ANY_SHAPE.zpp_inner)};l["nape.shape.Polygon"]=Qn,Qn.__name__=["nape","shape","Polygon"],Qn.rect=function(n,e,t,i,l){null==l&&(l=!1);var r;if(null==Cl.poolVec2?r=new On:(r=Cl.poolVec2,Cl.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Cl.nextVec2&&(Cl.nextVec2=null)),null==r.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=e,r.zpp_inner=a,r.zpp_inner.outer=r}else{var p=r.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=r.zpp_inner;if(null!=o._validate&&o._validate(),r.zpp_inner.x==n){var h=r.zpp_inner;null!=h._validate&&h._validate(),s=r.zpp_inner.y==e}else s=!1;if(!s){r.zpp_inner.x=n,r.zpp_inner.y=e;var _=r.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}r.zpp_inner.weak=l;var u,d=n+t;if(null==Cl.poolVec2?u=new On:(u=Cl.poolVec2,Cl.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Cl.nextVec2&&(Cl.nextVec2=null)),null==u.zpp_inner){var c;null==Ct.zpp_pool?c=new Ct:(c=Ct.zpp_pool,Ct.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=d,c.y=e,u.zpp_inner=c,u.zpp_inner.outer=u}else{var x=u.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==d){var y=u.zpp_inner;null!=y._validate&&y._validate(),v=u.zpp_inner.y==e}else v=!1;if(!v){u.zpp_inner.x=d,u.zpp_inner.y=e;var f=u.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}u.zpp_inner.weak=l;var m,b=n+t,g=e+i;if(null==Cl.poolVec2?m=new On:(m=Cl.poolVec2,Cl.poolVec2=m.zpp_pool,m.zpp_pool=null,m.zpp_disp=!1,m==Cl.nextVec2&&(Cl.nextVec2=null)),null==m.zpp_inner){var w;null==Ct.zpp_pool?w=new Ct:(w=Ct.zpp_pool,Ct.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=b,w.y=g,m.zpp_inner=w,m.zpp_inner.outer=m}else{var C=m.zpp_inner;null!=C._isimmutable&&C._isimmutable();var M,k=m.zpp_inner;if(null!=k._validate&&k._validate(),m.zpp_inner.x==b){var O=m.zpp_inner;null!=O._validate&&O._validate(),M=m.zpp_inner.y==g}else M=!1;if(!M){m.zpp_inner.x=b,m.zpp_inner.y=g;var S=m.zpp_inner;null!=S._invalidate&&S._invalidate(S)}}m.zpp_inner.weak=l;var P,T=e+i;if(null==Cl.poolVec2?P=new On:(P=Cl.poolVec2,Cl.poolVec2=P.zpp_pool,P.zpp_pool=null,P.zpp_disp=!1,P==Cl.nextVec2&&(Cl.nextVec2=null)),null==P.zpp_inner){var A;null==Ct.zpp_pool?A=new Ct:(A=Ct.zpp_pool,Ct.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=n,A.y=T,P.zpp_inner=A,P.zpp_inner.outer=P}else{var E=P.zpp_inner;null!=E._isimmutable&&E._isimmutable();var I,V=P.zpp_inner;if(null!=V._validate&&V._validate(),P.zpp_inner.x==n){var L=P.zpp_inner;null!=L._validate&&L._validate(),I=P.zpp_inner.y==T}else I=!1;if(!I){P.zpp_inner.x=n,P.zpp_inner.y=T;var N=P.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}return P.zpp_inner.weak=l,[r,u,m,P]},Qn.box=function(n,e,t){return null==t&&(t=!1),Qn.rect(-n/2,-e/2,n,e,t)},Qn.regular=function(n,e,t,i,l){null==l&&(l=!1),null==i&&(i=0);for(var r=[],a=2*Math.PI/t,p=0,s=t;s>p;){var o,h=p++,_=h*a+i,u=Math.cos(_)*n,d=Math.sin(_)*e;if(null==Cl.poolVec2?o=new On:(o=Cl.poolVec2,Cl.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Cl.nextVec2&&(Cl.nextVec2=null)),null==o.zpp_inner){var c;null==Ct.zpp_pool?c=new Ct:(c=Ct.zpp_pool,Ct.zpp_pool=c.next,c.next=null),c.weak=!1,c._immutable=!1,c.x=u,c.y=d,o.zpp_inner=c,o.zpp_inner.outer=o}else{var x=o.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v,z=o.zpp_inner;if(null!=z._validate&&z._validate(),o.zpp_inner.x==u){var y=o.zpp_inner;null!=y._validate&&y._validate(),v=o.zpp_inner.y==d}else v=!1;if(!v){o.zpp_inner.x=u,o.zpp_inner.y=d;var f=o.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}o.zpp_inner.weak=l;r.push(o)}return r},Qn.__super__=Wn,Qn.prototype=e(Wn.prototype,{zpp_inner_zn:null,get_localVerts:function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},get_worldVerts:function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},get_edges:function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},validity:function(){return this.zpp_inner_zn.valid()},__class__:Qn,__properties__:e(Wn.prototype.__properties__,{get_edges:"get_edges",get_worldVerts:"get_worldVerts",get_localVerts:"get_localVerts"})});var $n=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.shape.ShapeIterator"]=$n,$n.__name__=["nape","shape","ShapeIterator"],$n.get=function(n){var e;if(null==$n.zpp_pool){fl.internal=!0;var t=new $n;fl.internal=!1,e=t}else{var i=$n.zpp_pool;$n.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},$n.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=$n.zpp_pool,$n.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:$n};var ne=function(){this.zpp_inner=null,this.zpp_inner=new fl,this.zpp_inner.outer=this};l["nape.shape.ShapeList"]=ne,ne.__name__=["nape","shape","ShapeList"],ne.fromArray=function(n){for(var e=new ne,t=0;n.length>t;){var i=n[t];++t,e.push(i)}return e},ne.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(null==this.zpp_inner.inner.head)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)t=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=i.iterator_at(this.zpp_inner.user_length-2)}n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=t.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),$n.get(this)},copy:function(n){null==n&&(n=!1);var e=new ne;this.zpp_inner.valmod();for(var t=$n.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=$n.zpp_pool,$n.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a,p=t.zpp_inner.at(t.zpp_i++);n||(a=p),e.push(a)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=$n.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var r=e.zpp_inner.at(e.zpp_i++);this.has(r)||(this.zpp_inner.reverse_flag?this.push(r):this.unshift(r))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=$n.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=$n.zpp_pool,$n.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":""+a,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i=t.zpp_inner.user_length;e.zpp_critical=!0;var l;if(i>e.zpp_i?l=!0:(e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(r){e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(i){break}}return this},__class__:ne,__properties__:{get_length:"get_length"}};var ee=function(){};l["nape.shape.ShapeType"]=ee,ee.__name__=["nape","shape","ShapeType"],ee.__properties__={get_POLYGON:"get_POLYGON",get_CIRCLE:"get_CIRCLE"},ee.get_CIRCLE=function(){return null==ye.ShapeType_CIRCLE&&(ye.internal=!0,ye.ShapeType_CIRCLE=new ee,ye.internal=!1),ye.ShapeType_CIRCLE},ee.get_POLYGON=function(){return null==ye.ShapeType_POLYGON&&(ye.internal=!0,ye.ShapeType_POLYGON=new ee,ye.internal=!1),ye.ShapeType_POLYGON},ee.prototype={toString:function(){return null==ye.ShapeType_CIRCLE&&(ye.internal=!0,ye.ShapeType_CIRCLE=new ee,ye.internal=!1),this==ye.ShapeType_CIRCLE?"CIRCLE":(null==ye.ShapeType_POLYGON&&(ye.internal=!0,ye.ShapeType_POLYGON=new ee,ye.internal=!1),this==ye.ShapeType_POLYGON?"POLYGON":"")},__class__:ee};var te=function(){};l["nape.shape.ValidationResult"]=te,te.__name__=["nape","shape","ValidationResult"],te.__properties__={get_SELF_INTERSECTING:"get_SELF_INTERSECTING",get_CONCAVE:"get_CONCAVE",get_DEGENERATE:"get_DEGENERATE",get_VALID:"get_VALID"},te.get_VALID=function(){return null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1),ye.ValidationResult_VALID},te.get_DEGENERATE=function(){return null==ye.ValidationResult_DEGENERATE&&(ye.internal=!0,ye.ValidationResult_DEGENERATE=new te,ye.internal=!1),ye.ValidationResult_DEGENERATE},te.get_CONCAVE=function(){return null==ye.ValidationResult_CONCAVE&&(ye.internal=!0,ye.ValidationResult_CONCAVE=new te,ye.internal=!1),ye.ValidationResult_CONCAVE},te.get_SELF_INTERSECTING=function(){return null==ye.ValidationResult_SELF_INTERSECTING&&(ye.internal=!0,ye.ValidationResult_SELF_INTERSECTING=new te,ye.internal=!1),ye.ValidationResult_SELF_INTERSECTING},te.prototype={toString:function(){return null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1),this==ye.ValidationResult_VALID?"VALID":(null==ye.ValidationResult_DEGENERATE&&(ye.internal=!0,ye.ValidationResult_DEGENERATE=new te,ye.internal=!1),this==ye.ValidationResult_DEGENERATE?"DEGENERATE":(null==ye.ValidationResult_CONCAVE&&(ye.internal=!0,ye.ValidationResult_CONCAVE=new te,ye.internal=!1),this==ye.ValidationResult_CONCAVE?"CONCAVE":(null==ye.ValidationResult_SELF_INTERSECTING&&(ye.internal=!0,ye.ValidationResult_SELF_INTERSECTING=new te,ye.internal=!1),this==ye.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},__class__:te};var ie=function(){};l["nape.space.Broadphase"]=ie,ie.__name__=["nape","space","Broadphase"],ie.__properties__={get_SWEEP_AND_PRUNE:"get_SWEEP_AND_PRUNE",get_DYNAMIC_AABB_TREE:"get_DYNAMIC_AABB_TREE"},ie.get_DYNAMIC_AABB_TREE=function(){return null==ye.Broadphase_DYNAMIC_AABB_TREE&&(ye.internal=!0,ye.Broadphase_DYNAMIC_AABB_TREE=new ie,ye.internal=!1),ye.Broadphase_DYNAMIC_AABB_TREE},ie.get_SWEEP_AND_PRUNE=function(){return null==ye.Broadphase_SWEEP_AND_PRUNE&&(ye.internal=!0,ye.Broadphase_SWEEP_AND_PRUNE=new ie,ye.internal=!1),ye.Broadphase_SWEEP_AND_PRUNE},ie.prototype={toString:function(){return null==ye.Broadphase_DYNAMIC_AABB_TREE&&(ye.internal=!0,ye.Broadphase_DYNAMIC_AABB_TREE=new ie,ye.internal=!1),this==ye.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==ye.Broadphase_SWEEP_AND_PRUNE&&(ye.internal=!0,ye.Broadphase_SWEEP_AND_PRUNE=new ie,ye.internal=!1),this==ye.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},__class__:ie};var le=function(n,e){if(this.zpp_inner=null,this.zpp_inner=new Zt(null==n?null:n.zpp_inner,e),this.zpp_inner.outer=this,null!=n&&n.zpp_inner.weak){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var l=n;l.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=l:Cl.poolVec2=l,Cl.nextVec2=l,l.zpp_disp=!0;var r=i;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ct.zpp_pool,Ct.zpp_pool=r}};l["nape.space.Space"]=le,le.__name__=["nape","space","Space"],le.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_gravity:function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},set_gravity:function(n){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var e=this.zpp_inner.wrap_gravity,t=e.zpp_inner;null!=t._isimmutable&&t._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,p=e.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y==a}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=a;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=c:Cl.poolVec2=c,Cl.nextVec2=c,c.zpp_disp=!0;var x=d;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x}return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},get_broadphase:function(){return this.zpp_inner.bphase.is_sweep?(null==ye.Broadphase_SWEEP_AND_PRUNE&&(ye.internal=!0,ye.Broadphase_SWEEP_AND_PRUNE=new ie,ye.internal=!1),ye.Broadphase_SWEEP_AND_PRUNE):(null==ye.Broadphase_DYNAMIC_AABB_TREE&&(ye.internal=!0,ye.Broadphase_DYNAMIC_AABB_TREE=new ie,ye.internal=!1),ye.Broadphase_DYNAMIC_AABB_TREE)},get_sortContacts:function(){return this.zpp_inner.sortcontacts},set_sortContacts:function(n){return this.zpp_inner.sortcontacts=n},get_worldAngularDrag:function(){return this.zpp_inner.global_ang_drag},set_worldAngularDrag:function(n){var e=n;return this.zpp_inner.global_ang_drag=e},get_worldLinearDrag:function(){return this.zpp_inner.global_lin_drag},set_worldLinearDrag:function(n){var e=n;return this.zpp_inner.global_lin_drag=e},get_compounds:function(){return this.zpp_inner.wrap_compounds},get_bodies:function(){return this.zpp_inner.wrap_bodies},get_liveBodies:function(){return this.zpp_inner.wrap_live},get_constraints:function(){return this.zpp_inner.wrap_constraints},get_liveConstraints:function(){return this.zpp_inner.wrap_livecon},visitBodies:function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var t=Vn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=Vn.zpp_pool,Vn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;n(t.zpp_inner.at(t.zpp_i++))}var a=this.zpp_inner.wrap_compounds;a.zpp_inner.valmod();for(var p=jn.get(a);;){p.zpp_inner.zpp_inner.valmod();var s=p.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;p.zpp_critical=!0;var h;if(o>p.zpp_i?h=!0:(p.zpp_next=jn.zpp_pool,jn.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1;p.zpp_inner.at(p.zpp_i++).visitBodies(n)}},visitConstraints:function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var t=G.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=G.zpp_pool,G.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;n(t.zpp_inner.at(t.zpp_i++))}var a=this.zpp_inner.wrap_compounds;a.zpp_inner.valmod();for(var p=jn.get(a);;){p.zpp_inner.zpp_inner.valmod();var s=p.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;p.zpp_critical=!0;var h;if(o>p.zpp_i?h=!0:(p.zpp_next=jn.zpp_pool,jn.zpp_pool=p,p.zpp_inner=null,h=!1),!h)break;p.zpp_critical=!1;p.zpp_inner.at(p.zpp_i++).visitConstraints(n)}},visitCompounds:function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var t=jn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var l=i.zpp_inner.user_length;t.zpp_critical=!0;var r;if(l>t.zpp_i?r=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);n(a),a.visitCompounds(n)}},get_world:function(){return this.zpp_inner.__static},get_arbiters:function(){if(null==this.zpp_inner.wrap_arbiters){var n=new Ue;n.space=this.zpp_inner,this.zpp_inner.wrap_arbiters=n}return this.zpp_inner.wrap_arbiters},get_listeners:function(){return this.zpp_inner.wrap_listeners},clear:function(){this.zpp_inner.clear()},step:function(n,e,t){null==t&&(t=10),null==e&&(e=10),this.zpp_inner.step(n,e,t)},get_timeStamp:function(){return this.zpp_inner.stamp},get_elapsedTime:function(){return this.zpp_inner.time},interactionType:function(n,e){if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null).zpp_inner.type==ye.id_BodyType_STATIC&&(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null).zpp_inner.type==ye.id_BodyType_STATIC)return null;if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null)==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))return null;var t,i=n.zpp_inner,l=e.zpp_inner,r=i.body,a=l.body;t=!1;for(var p=r.constraints.head;null!=p;){var s=p.elt;if(s.ignore&&s.pair_exists(r.id,a.id)){t=!0;break}p=p.next}var o,h;if(t)h=!1;else{for(var _=i;null!=_&&null==_.group;)_=null!=_.ishape?_.ishape.body:null!=_.icompound?_.icompound.compound:_.ibody.compound;var u,d=null==_?null:_.group;if(null==d)u=!1;else{for(var c=l;null!=c&&null==c.group;)c=null!=c.ishape?c.ishape.body:null!=c.icompound?c.icompound.compound:c.ibody.compound;var x=null==c?null:c.group;if(null==x)u=!1;else{for(var v=!1;null!=d&&null!=x;){if(d==x){v=d.ignore;break}x.depth>d.depth?x=x.group:d=d.group}u=v}}h=!u}if(h){var z;if(i.sensorEnabled||l.sensorEnabled){var y=i.filter,f=l.filter;z=0!=(y.sensorMask&f.sensorGroup)&&0!=(f.sensorMask&y.sensorGroup)}else z=!1;if(z)o=2;else{var m;if(i.fluidEnabled||l.fluidEnabled){var b=i.filter,g=l.filter;m=0!=(b.fluidMask&g.fluidGroup)&&0!=(g.fluidMask&b.fluidGroup)}else m=!1;if(!!m&&!(0==r.imass&&0==a.imass&&0==r.iinertia&&0==a.iinertia))o=0;else{var w,C=i.filter,M=l.filter;w=0!=(C.collisionMask&M.collisionGroup)&&0!=(M.collisionMask&C.collisionGroup)&&!(0==r.imass&&0==a.imass&&0==r.iinertia&&0==a.iinertia),o=w?1:-1}}}else o=-1;switch(o){case 0:return null==ye.InteractionType_FLUID&&(ye.internal=!0,ye.InteractionType_FLUID=new E,ye.internal=!1),ye.InteractionType_FLUID;case 1:return null==ye.InteractionType_COLLISION&&(ye.internal=!0,ye.InteractionType_COLLISION=new E,ye.internal=!1),ye.InteractionType_COLLISION;case 2:return null==ye.InteractionType_SENSOR&&(ye.internal=!0,ye.InteractionType_SENSOR=new E,ye.internal=!1),ye.InteractionType_SENSOR;default:return null}},shapesUnderPoint:function(n,e,t){var i=this.zpp_inner,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,a=n.zpp_inner;null!=a._validate&&a._validate();var p=i.shapesUnderPoint(r,n.zpp_inner.y,null==e?null:e.zpp_inner,t);if(n.zpp_inner.weak){var s=n.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=h:Cl.poolVec2=h,Cl.nextVec2=h,h.zpp_disp=!0;var _=o;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ct.zpp_pool,Ct.zpp_pool=_}return p},bodiesUnderPoint:function(n,e,t){var i=this.zpp_inner,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,a=n.zpp_inner;null!=a._validate&&a._validate();var p=i.bodiesUnderPoint(r,n.zpp_inner.y,null==e?null:e.zpp_inner,t);if(n.zpp_inner.weak){var s=n.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=h:Cl.poolVec2=h,Cl.nextVec2=h,h.zpp_disp=!0;var _=o;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ct.zpp_pool,Ct.zpp_pool=_}return p},shapesInAABB:function(n,e,t,i,l){null==t&&(t=!0),null==e&&(e=!1);var r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner;if(a.maxx-a.minx!=0){var p=n.zpp_inner;null!=p._validate&&p._validate();var s=n.zpp_inner;s.maxy-s.miny==0}else!0;return this.zpp_inner.shapesInAABB(n,t,e,null==i?null:i.zpp_inner,l)},bodiesInAABB:function(n,e,t,i,l){null==t&&(t=!0),null==e&&(e=!1);var r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner;if(a.maxx-a.minx!=0){var p=n.zpp_inner;null!=p._validate&&p._validate();var s=n.zpp_inner;s.maxy-s.miny==0}else!0;return this.zpp_inner.bodiesInAABB(n,t,e,null==i?null:i.zpp_inner,l)},shapesInCircle:function(n,e,t,i,l){null==t&&(t=!1);var r=this.zpp_inner.shapesInCircle(n,e,t,null==i?null:i.zpp_inner,l);if(n.zpp_inner.weak){var a=n.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}return r},bodiesInCircle:function(n,e,t,i,l){null==t&&(t=!1);var r=this.zpp_inner.bodiesInCircle(n,e,t,null==i?null:i.zpp_inner,l);if(n.zpp_inner.weak){var a=n.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}return r},shapesInShape:function(n,e,t,i){if(null==e&&(e=!1),n.zpp_inner.type==ye.id_ShapeType_POLYGON){n.zpp_inner.polygon.valid();null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1)}return this.zpp_inner.shapesInShape(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},bodiesInShape:function(n,e,t,i){if(null==e&&(e=!1),n.zpp_inner.type==ye.id_ShapeType_POLYGON){n.zpp_inner.polygon.valid();null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1)}return this.zpp_inner.bodiesInShape(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},shapesInBody:function(n,e,t){var i=null==t?new ne:t,l=n.zpp_inner.wrap_shapes;l.zpp_inner.valmod();for(var r=$n.get(l);;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var p=a.zpp_inner.user_length;r.zpp_critical=!0;var s;if(p>r.zpp_i?s=!0:(r.zpp_next=$n.zpp_pool,$n.zpp_pool=r,r.zpp_inner=null,s=!1),!s)break;r.zpp_critical=!1;var o=r.zpp_inner.at(r.zpp_i++);this.shapesInShape(o,!1,e,i)}return i},bodiesInBody:function(n,e,t){var i=null==t?new Ln:t,l=n.zpp_inner.wrap_shapes;l.zpp_inner.valmod();for(var r=$n.get(l);;){r.zpp_inner.zpp_inner.valmod();var a=r.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var p=a.zpp_inner.user_length;r.zpp_critical=!0;var s;if(p>r.zpp_i?s=!0:(r.zpp_next=$n.zpp_pool,$n.zpp_pool=r,r.zpp_inner=null,s=!1),!s)break;r.zpp_critical=!1;var o=r.zpp_inner.at(r.zpp_i++);this.bodiesInShape(o,!1,e,i)}return i},convexCast:function(n,e,t,i){return null==t&&(t=!1),this.zpp_inner.convexCast(n.zpp_inner,e,i,t)},convexMultiCast:function(n,e,t,i,l){return null==t&&(t=!1),this.zpp_inner.convexMultiCast(n.zpp_inner,e,i,t,l)},rayCast:function(n,e,t){return null==e&&(e=!1),this.zpp_inner.rayCast(n,e,t)},rayMultiCast:function(n,e,t,i){return null==e&&(e=!1),this.zpp_inner.rayMultiCast(n,e,t,i)},__class__:le,__properties__:{get_elapsedTime:"get_elapsedTime",get_timeStamp:"get_timeStamp",get_listeners:"get_listeners",get_arbiters:"get_arbiters",get_world:"get_world",get_liveConstraints:"get_liveConstraints",get_constraints:"get_constraints",get_liveBodies:"get_liveBodies",get_bodies:"get_bodies",get_compounds:"get_compounds",set_worldLinearDrag:"set_worldLinearDrag",get_worldLinearDrag:"get_worldLinearDrag",set_worldAngularDrag:"set_worldAngularDrag",get_worldAngularDrag:"get_worldAngularDrag",set_sortContacts:"set_sortContacts",get_sortContacts:"get_sortContacts",get_broadphase:"get_broadphase",set_gravity:"set_gravity",get_gravity:"get_gravity",get_userData:"get_userData"}};var re=function(){};l["nape.util.Debug"]=re,re.__name__=["nape","util","Debug"],re.version=function(){return"Nape 2.0.19"},re.clearObjectPools=function(){for(;null!=G.zpp_pool;){var n=G.zpp_pool.zpp_next;G.zpp_pool.zpp_next=null,G.zpp_pool=n}for(;null!=Yn.zpp_pool;){var e=Yn.zpp_pool.zpp_next;Yn.zpp_pool.zpp_next=null,Yn.zpp_pool=e}for(;null!=Vn.zpp_pool;){var t=Vn.zpp_pool.zpp_next;Vn.zpp_pool.zpp_next=null,Vn.zpp_pool=t}for(;null!=jn.zpp_pool;){var i=jn.zpp_pool.zpp_next;jn.zpp_pool.zpp_next=null,jn.zpp_pool=i}for(;null!=I.zpp_pool;){var l=I.zpp_pool.zpp_next;I.zpp_pool.zpp_next=null,I.zpp_pool=l}for(;null!=k.zpp_pool;){var r=k.zpp_pool.zpp_next;k.zpp_pool.zpp_next=null,k.zpp_pool=r}for(;null!=dn.zpp_pool;){var a=dn.zpp_pool.zpp_next;dn.zpp_pool.zpp_next=null,dn.zpp_pool=a}for(;null!=zn.zpp_pool;){var p=zn.zpp_pool.zpp_next;zn.zpp_pool.zpp_next=null,zn.zpp_pool=p}for(;null!=Sn.zpp_pool;){var s=Sn.zpp_pool.zpp_next;Sn.zpp_pool.zpp_next=null,Sn.zpp_pool=s}for(;null!=Mn.zpp_pool;){var o=Mn.zpp_pool.zpp_next;Mn.zpp_pool.zpp_next=null,Mn.zpp_pool=o}for(;null!=$n.zpp_pool;){var h=$n.zpp_pool.zpp_next;$n.zpp_pool.zpp_next=null,$n.zpp_pool=h}for(;null!=Kn.zpp_pool;){var _=Kn.zpp_pool.zpp_next;Kn.zpp_pool.zpp_next=null,Kn.zpp_pool=_}for(;null!=ln.zpp_pool;){var u=ln.zpp_pool.zpp_next;ln.zpp_pool.zpp_next=null,ln.zpp_pool=u}for(;null!=Q.zpp_pool;){var d=Q.zpp_pool.zpp_next;Q.zpp_pool.zpp_next=null,Q.zpp_pool=d}for(;null!=on.zpp_pool;){var c=on.zpp_pool.zpp_next;on.zpp_pool.zpp_next=null,on.zpp_pool=c}for(;null!=ki.zpp_pool;){var x=ki.zpp_pool.next;ki.zpp_pool.next=null,ki.zpp_pool=x}for(;null!=Oi.zpp_pool;){var v=Oi.zpp_pool.next;Oi.zpp_pool.next=null,Oi.zpp_pool=v}for(;null!=At.zpp_pool;){var z=At.zpp_pool.next;At.zpp_pool.next=null,At.zpp_pool=z}for(;null!=Si.zpp_pool;){var y=Si.zpp_pool.next;Si.zpp_pool.next=null,Si.zpp_pool=y}for(;null!=Tt.zpp_pool;){var f=Tt.zpp_pool.next;Tt.zpp_pool.next=null,Tt.zpp_pool=f}for(;null!=Pi.zpp_pool;){var m=Pi.zpp_pool.next;Pi.zpp_pool.next=null,Pi.zpp_pool=m}for(;null!=Ti.zpp_pool;){var b=Ti.zpp_pool.next;Ti.zpp_pool.next=null,Ti.zpp_pool=b}for(;null!=Ai.zpp_pool;){var g=Ai.zpp_pool.next;Ai.zpp_pool.next=null,Ai.zpp_pool=g}for(;null!=he.zpp_pool;){var w=he.zpp_pool.next;he.zpp_pool.next=null,he.zpp_pool=w}for(;null!=Ei.zpp_pool;){var C=Ei.zpp_pool.next;Ei.zpp_pool.next=null,Ei.zpp_pool=C}for(;null!=Ii.zpp_pool;){var M=Ii.zpp_pool.next;Ii.zpp_pool.next=null,Ii.zpp_pool=M}for(;null!=Vi.zpp_pool;){var O=Vi.zpp_pool.next;Vi.zpp_pool.next=null,Vi.zpp_pool=O}for(;null!=Li.zpp_pool;){var S=Li.zpp_pool.next;Li.zpp_pool.next=null,Li.zpp_pool=S}for(;null!=Ni.zpp_pool;){var P=Ni.zpp_pool.next;Ni.zpp_pool.next=null,Ni.zpp_pool=P}for(;null!=Di.zpp_pool;){var T=Di.zpp_pool.next;Di.zpp_pool.next=null,Di.zpp_pool=T}for(;null!=Ml.zpp_pool;){var A=Ml.zpp_pool.next;Ml.zpp_pool.next=null,Ml.zpp_pool=A}for(;null!=oe.zpp_pool;){var E=oe.zpp_pool.next;oe.zpp_pool.next=null,oe.zpp_pool=E}for(;null!=ji.zpp_pool;){var V=ji.zpp_pool.next;ji.zpp_pool.next=null,ji.zpp_pool=V}for(;null!=se.zpp_pool;){var L=se.zpp_pool.next;se.zpp_pool.next=null,se.zpp_pool=L}for(;null!=nt.zpp_pool;){var N=nt.zpp_pool.next;nt.zpp_pool.next=null,nt.zpp_pool=N}for(;null!=tt.zpp_pool;){var D=tt.zpp_pool.next;tt.zpp_pool.next=null,tt.zpp_pool=D}for(;null!=kl.zpp_pool;){var j=kl.zpp_pool.next;kl.zpp_pool.next=null,kl.zpp_pool=j}for(;null!=at.zpp_pool;){var F=at.zpp_pool.next;at.zpp_pool.next=null,at.zpp_pool=F}for(;null!=Ke.zpp_pool;){var B=Ke.zpp_pool.next;Ke.zpp_pool.next=null,Ke.zpp_pool=B}for(;null!=Je.zpp_pool;){var R=Je.zpp_pool.next;Je.zpp_pool.next=null,Je.zpp_pool=R}for(;null!=Fi.zpp_pool;){var Y=Fi.zpp_pool.next;Fi.zpp_pool.next=null,Fi.zpp_pool=Y}for(;null!=Bi.zpp_pool;){var U=Bi.zpp_pool.next;Bi.zpp_pool.next=null,Bi.zpp_pool=U}for(;null!=Ct.zpp_pool;){var Z=Ct.zpp_pool.next;Ct.zpp_pool.next=null,Ct.zpp_pool=Z}for(;null!=Ri.zpp_pool;){var q=Ri.zpp_pool.next;Ri.zpp_pool.next=null,Ri.zpp_pool=q}for(;null!=ot.zpp_pool;){var W=ot.zpp_pool.next;ot.zpp_pool.next=null,ot.zpp_pool=W}for(;null!=Ol.zpp_pool;){var X=Ol.zpp_pool.next;Ol.zpp_pool.next=null,Ol.zpp_pool=X}for(;null!=ht.zpp_pool;){var H=ht.zpp_pool.next;ht.zpp_pool.next=null,ht.zpp_pool=H}for(;null!=Gi.zpp_pool;){var K=Gi.zpp_pool.next;Gi.zpp_pool.next=null,Gi.zpp_pool=K}for(;null!=gt.zpp_pool;){var J=gt.zpp_pool.next;gt.zpp_pool.next=null,gt.zpp_pool=J}for(;null!=Sl.zpp_pool;){var $=Sl.zpp_pool.next;Sl.zpp_pool.next=null,Sl.zpp_pool=$}for(;null!=Yi.zpp_pool;){var nn=Yi.zpp_pool.next;Yi.zpp_pool.next=null,Yi.zpp_pool=nn}for(;null!=zt.zpp_pool;){var en=zt.zpp_pool.next;zt.zpp_pool.next=null,zt.zpp_pool=en}for(;null!=yt.zpp_pool;){var tn=yt.zpp_pool.next;yt.zpp_pool.next=null,yt.zpp_pool=tn}for(;null!=Ui.zpp_pool;){var rn=Ui.zpp_pool.next;Ui.zpp_pool.next=null,Ui.zpp_pool=rn}for(;null!=Ze.zpp_pool;){var an=Ze.zpp_pool.next;Ze.zpp_pool.next=null,Ze.zpp_pool=an}for(;null!=mt.zpp_pool;){var pn=mt.zpp_pool.next;mt.zpp_pool.next=null,mt.zpp_pool=pn}for(;null!=Pl.zpp_pool;){var sn=Pl.zpp_pool.next;Pl.zpp_pool.next=null,Pl.zpp_pool=sn}for(;null!=ut.zpp_pool;){var hn=ut.zpp_pool.next;ut.zpp_pool.next=null,ut.zpp_pool=hn}for(;null!=dt.zpp_pool;){var _n=dt.zpp_pool.next;dt.zpp_pool.next=null,dt.zpp_pool=_n}for(;null!=Tl.zpp_pool;){var un=Tl.zpp_pool.next;Tl.zpp_pool.next=null,Tl.zpp_pool=un}for(;null!=it.zpp_pool;){var cn=it.zpp_pool.next;it.zpp_pool.next=null,it.zpp_pool=cn}for(;null!=lt.zpp_pool;){var xn=lt.zpp_pool.next;lt.zpp_pool.next=null,lt.zpp_pool=xn}for(;null!=Al.zpp_pool;){var vn=Al.zpp_pool.next;Al.zpp_pool.next=null,Al.zpp_pool=vn}for(;null!=ct.zpp_pool;){var yn=ct.zpp_pool.next;ct.zpp_pool.next=null,ct.zpp_pool=yn}for(;null!=Jt.zpp_pool;){var fn=Jt.zpp_pool.next;Jt.zpp_pool.next=null,Jt.zpp_pool=fn}for(;null!=Zi.zpp_pool;){var mn=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=mn}for(;null!=qi.zpp_pool;){var bn=qi.zpp_pool.next;qi.zpp_pool.next=null,qi.zpp_pool=bn}for(;null!=Wi.zpp_pool;){var gn=Wi.zpp_pool.next;Wi.zpp_pool.next=null,Wi.zpp_pool=gn}for(;null!=Vt.zpp_pool;){var wn=Vt.zpp_pool.next;Vt.zpp_pool.next=null,Vt.zpp_pool=wn}for(;null!=Xi.zpp_pool;){var Cn=Xi.zpp_pool.next;Xi.zpp_pool.next=null,Xi.zpp_pool=Cn}for(;null!=Hi.zpp_pool;){var kn=Hi.zpp_pool.next;Hi.zpp_pool.next=null,Hi.zpp_pool=kn}for(;null!=qt.zpp_pool;){var On=qt.zpp_pool.next;qt.zpp_pool.next=null,qt.zpp_pool=On}for(;null!=Dt.zpp_pool;){var Pn=Dt.zpp_pool.next;Dt.zpp_pool.next=null,Dt.zpp_pool=Pn}for(;null!=jt.zpp_pool;){var Tn=jt.zpp_pool.next;jt.zpp_pool.next=null,jt.zpp_pool=Tn}for(;null!=Be.zpp_pool;){var An=Be.zpp_pool.next;Be.zpp_pool.next=null,Be.zpp_pool=An}for(;null!=Ki.zpp_pool;){var En=Ki.zpp_pool.next;Ki.zpp_pool.next=null,Ki.zpp_pool=En}for(;null!=Ji.zpp_pool;){var In=Ji.zpp_pool.next;Ji.zpp_pool.next=null,Ji.zpp_pool=In}for(;null!=Rt.zpp_pool;){var Ln=Rt.zpp_pool.next;Rt.zpp_pool.next=null,Rt.zpp_pool=Ln}for(;null!=Gt.zpp_pool;){var Nn=Gt.zpp_pool.next;Gt.zpp_pool.next=null,Gt.zpp_pool=Nn}for(;null!=Yt.zpp_pool;){var Dn=Yt.zpp_pool.next;Yt.zpp_pool.next=null,Yt.zpp_pool=Dn}for(;null!=El.zpp_pool;){var Fn=El.zpp_pool.next;El.zpp_pool.next=null,El.zpp_pool=Fn}for(;null!=Qi.zpp_pool;){var Bn=Qi.zpp_pool.next;Qi.zpp_pool.next=null,Qi.zpp_pool=Bn}for(;null!=$i.zpp_pool;){var Rn=$i.zpp_pool.next;$i.zpp_pool.next=null,$i.zpp_pool=Rn}for(;null!=Ge.zpp_pool;){var Gn=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=Gn}for(;null!=nl.zpp_pool;){var Un=nl.zpp_pool.next;nl.zpp_pool.next=null,nl.zpp_pool=Un}for(;null!=el.zpp_pool;){var Zn=el.zpp_pool.next;el.zpp_pool.next=null,el.zpp_pool=Zn}for(;null!=tl.zpp_pool;){var qn=tl.zpp_pool.next;tl.zpp_pool.next=null,tl.zpp_pool=qn}for(;null!=De.zpp_pool;){var Wn=De.zpp_pool.next;De.zpp_pool.next=null,De.zpp_pool=Wn}for(;null!=je.zpp_pool;){var Xn=je.zpp_pool.next;je.zpp_pool.next=null,je.zpp_pool=Xn}for(;null!=il.zpp_pool;){var Hn=il.zpp_pool.next;il.zpp_pool.next=null,il.zpp_pool=Hn}for(;null!=Fe.zpp_pool;){var Jn=Fe.zpp_pool.next;Fe.zpp_pool.next=null,Fe.zpp_pool=Jn}for(;null!=ll.zpp_pool;){var Qn=ll.zpp_pool.next;ll.zpp_pool.next=null,ll.zpp_pool=Qn}for(;null!=rl.zpp_pool;){var ne=rl.zpp_pool.next;rl.zpp_pool.next=null,rl.zpp_pool=ne}for(;null!=al.zpp_pool;){var ee=al.zpp_pool.next;al.zpp_pool.next=null,al.zpp_pool=ee}for(;null!=Cl.poolGeomPoly;){var te=Cl.poolGeomPoly.zpp_pool;Cl.poolGeomPoly.zpp_pool=null,Cl.poolGeomPoly=te}for(;null!=Cl.poolVec2;){var ie=Cl.poolVec2.zpp_pool;Cl.poolVec2.zpp_pool=null,Cl.poolVec2=ie}for(;null!=Cl.poolVec3;){var le=Cl.poolVec3.zpp_pool;Cl.poolVec3.zpp_pool=null,Cl.poolVec3=le}};var ae=function(){};l["zpp_nape.ZPP_Const"]=ae,ae.__name__=["zpp_nape","ZPP_Const"],ae.POSINF=function(){return Infinity},ae.NEGINF=function(){return-Infinity};var pe=function(){};l["zpp_nape.ZPP_ID"]=pe,pe.__name__=["zpp_nape","ZPP_ID"],pe.Constraint=function(){return pe._Constraint++},pe.Interactor=function(){return pe._Interactor++},pe.CbType=function(){return pe._CbType++},pe.CbSet=function(){return pe._CbSet++},pe.Listener=function(){return pe._Listener++},pe.ZPP_SimpleVert=function(){return pe._ZPP_SimpleVert++},pe.ZPP_SimpleSeg=function(){return pe._ZPP_SimpleSeg++},pe.Space=function(){return pe._Space++},pe.InteractionGroup=function(){return pe._InteractionGroup++};var se=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};l["zpp_nape.callbacks.ZPP_Callback"]=se,se.__name__=["zpp_nape","callbacks","ZPP_Callback"],se.prototype={outer_body:null,outer_con:null,outer_int:null,wrapper_body:function(){return null==this.outer_body&&(se.internal=!0,this.outer_body=new b,se.internal=!1,this.outer_body.zpp_inner=this),this.outer_body},wrapper_con:function(){return null==this.outer_con&&(se.internal=!0,this.outer_con=new S,se.internal=!1,this.outer_con.zpp_inner=this),this.outer_con},wrapper_int:function(){return null==this.outer_int&&(se.internal=!0,this.outer_int=new T,se.internal=!1,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=bl.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},event:null,listener:null,space:null,index:null,next:null,prev:null,length:null,push:function(n){null!=this.prev?this.prev.next=n:this.next=n,n.prev=this.prev,n.next=null,this.prev=n,this.length++},push_rev:function(n){null!=this.next?this.next.prev=n:this.prev=n,n.next=this.next,n.prev=null,this.next=n,this.length++},pop:function(){var n=this.next;return this.next=n.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,n},pop_rev:function(){var n=this.prev;return this.prev=n.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,n},empty:function(){return null==this.next},clear:function(){for(;!this.empty();)this.pop()},splice:function(n){var e=n.next;return null==n.prev?(this.next=n.next,null!=this.next?this.next.prev=null:this.prev=null):(n.prev.next=n.next,null!=n.next?n.next.prev=n.prev:this.prev=n.prev),this.length--,e},rotateL:function(){this.push(this.pop())},rotateR:function(){this.push_rev(this.pop_rev())},cycleNext:function(n){return null==n.next?this.next:n.next},cyclePrev:function(n){return null==n.prev?this.prev:n.prev},at:function(n){for(var e=this.next;0!=n--;)e=e.next;return e},rev_at:function(n){for(var e=this.prev;0!=n--;)e=e.prev;return e},free:function(){this.int1=this.int2=null,this.body=null,this.constraint=null,this.listener=null,null!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},alloc:function(){},int1:null,int2:null,set:null,wrap_arbiters:null,pre_arbiter:null,pre_swapped:null,genarbs:function(){null==this.wrap_arbiters?this.wrap_arbiters=bl.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},body:null,constraint:null,__class__:se};var oe=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new ge,this.listeners=new _e,this.zip_listeners=!0,this.bodylisteners=new ue,this.zip_bodylisteners=!0,this.conlisteners=new de,this.zip_conlisteners=!0,this.constraints=new ce,this.interactors=new xe,this.id=pe.CbSet(),this.cbpairs=new li};l["zpp_nape.callbacks.ZPP_CbSet"]=oe,oe.__name__=["zpp_nape","callbacks","ZPP_CbSet"],oe.setlt=function(n,e){for(var t=n.cbTypes.head,i=e.cbTypes.head;null!=t&&null!=i;){var l=t.elt,r=i.elt;if(r.id>l.id)return!0;if(l.id>r.id)return!1;t=t.next,i=i.next}return null!=i&&null==t},oe.get=function(n){var e;null==oe.zpp_pool?e=new oe:(e=oe.zpp_pool,oe.zpp_pool=e.next,e.next=null);for(var t=null,i=n.head;null!=i;){var l=i.elt;t=e.cbTypes.insert(t,l),l.cbsets.add(e),i=i.next}return e},oe.compatible=function(n,e,t){var i,l=n.options1,r=e.cbTypes;if(l.nonemptyintersection(r,l.includes)&&!l.nonemptyintersection(r,l.excludes)){var a=n.options2,p=t.cbTypes;i=!!a.nonemptyintersection(p,a.includes)&&!a.nonemptyintersection(p,a.excludes)}else i=!1;if(i)return!0;var s=n.options2,o=e.cbTypes;if(s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)){var h=n.options1,_=t.cbTypes;return!!h.nonemptyintersection(_,h.includes)&&!h.nonemptyintersection(_,h.excludes)}return!1},oe.empty_intersection=function(n,e){for(var t=null,i=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,l=i.head;null!=l;){var r=l.elt;if(r.a==n&&r.b==e||r.a==e&&r.b==n){t=r;break}l=l.next}if(null==t){var a;null==he.zpp_pool?a=new he:(a=he.zpp_pool,he.zpp_pool=a.next,a.next=null),a.zip_listeners=!0,oe.setlt(n,e)?(a.a=n,a.b=e):(a.a=e,a.b=n),t=a,n.cbpairs.add(t),e!=n&&e.cbpairs.add(t)}return t.zip_listeners&&(t.zip_listeners=!1,t.__validate()),null==t.listeners.head},oe.single_intersection=function(n,e,t){for(var i=null,l=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,r=l.head;null!=r;){var a=r.elt;if(a.a==n&&a.b==e||a.a==e&&a.b==n){i=a;break}r=r.next}if(null==i){var p;null==he.zpp_pool?p=new he:(p=he.zpp_pool,he.zpp_pool=p.next,p.next=null),p.zip_listeners=!0,oe.setlt(n,e)?(p.a=n,p.b=e):(p.a=e,p.b=n),i=p,n.cbpairs.add(i),e!=n&&e.cbpairs.add(i)}i.zip_listeners&&(i.zip_listeners=!1,i.__validate());var s=i.listeners.head;return null!=s&&s.elt==t&&null==s.next},oe.find_all=function(n,e,t,i){for(var l=null,r=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,a=r.head;null!=a;){var p=a.elt;if(p.a==n&&p.b==e||p.a==e&&p.b==n){l=p;break}a=a.next}if(null==l){var s;null==he.zpp_pool?s=new he:(s=he.zpp_pool,he.zpp_pool=s.next,s.next=null),s.zip_listeners=!0,oe.setlt(n,e)?(s.a=n,s.b=e):(s.a=e,s.b=n),l=s,n.cbpairs.add(l),e!=n&&e.cbpairs.add(l)}l.zip_listeners&&(l.zip_listeners=!1,l.__validate());for(var o=l.listeners.head;null!=o;){var h=o.elt;h.event==t&&i(h),o=o.next}},oe.prototype={cbTypes:null,count:null,next:null,id:null,manager:null,cbpairs:null,increment:function(){this.count++},decrement:function(){return 0==--this.count},invalidate_pairs:function(){for(var n=this.cbpairs.head;null!=n;){n.elt.zip_listeners=!0,n=n.next}},listeners:null,zip_listeners:null,invalidate_listeners:function(){this.zip_listeners=!0,this.invalidate_pairs()},validate_listeners:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},realvalidate_listeners:function(){this.listeners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,t=null,i=this.listeners.head,l=e.listeners.head;null!=l;){var r=l.elt;if(null!=i&&i.elt==r)l=l.next,t=i,i=i.next;else{var a;if(null!=i){var p=i.elt;a=r.precedence>p.precedence||r.precedence==p.precedence&&r.id>p.id}else a=!0;if(a){if(r.space==this.manager.space){var s,o=this.listeners;null==Ei.zpp_pool?s=new Ei:(s=Ei.zpp_pool,Ei.zpp_pool=s.next,s.next=null),s.elt=r;var h=s;null==t?(h.next=o.head,o.head=h):(h.next=t.next,t.next=h),o.pushmod=o.modified=!0,o.length++,t=h}l=l.next}else t=i,i=i.next}}n=n.next}},bodylisteners:null,zip_bodylisteners:null,invalidate_bodylisteners:function(){this.zip_bodylisteners=!0},validate_bodylisteners:function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,t=null,i=this.bodylisteners.head,l=e.bodylisteners.head;null!=l;){var r=l.elt;if(null!=i&&i.elt==r)l=l.next,t=i,i=i.next;else{var a;if(null!=i){var p=i.elt;a=r.precedence>p.precedence||r.precedence==p.precedence&&r.id>p.id}else a=!0;if(a){var s=r.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&r.space==this.manager.space){var o,h=this.bodylisteners;null==Li.zpp_pool?o=new Li:(o=Li.zpp_pool,Li.zpp_pool=o.next,o.next=null),o.elt=r;var _=o;null==t?(_.next=h.head,h.head=_):(_.next=t.next,t.next=_),h.pushmod=h.modified=!0,h.length++,t=_}l=l.next}else t=i,i=i.next}}n=n.next}},conlisteners:null,zip_conlisteners:null,invalidate_conlisteners:function(){this.zip_conlisteners=!0},validate_conlisteners:function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},realvalidate_conlisteners:function(){this.conlisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,t=null,i=this.conlisteners.head,l=e.conlisteners.head;null!=l;){var r=l.elt;if(null!=i&&i.elt==r)l=l.next,t=i,i=i.next;else{var a;if(null!=i){var p=i.elt;a=r.precedence>p.precedence||r.precedence==p.precedence&&r.id>p.id}else a=!0;if(a){var s=r.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&r.space==this.manager.space){var o,h=this.conlisteners;null==Di.zpp_pool?o=new Di:(o=Di.zpp_pool,Di.zpp_pool=o.next,o.next=null),o.elt=r;var _=o;null==t?(_.next=h.head,h.head=_):(_.next=t.next,t.next=_),h.pushmod=h.modified=!0,h.length++,t=_}l=l.next}else t=i,i=i.next}}n=n.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},interactors:null,wrap_interactors:null,constraints:null,wrap_constraints:null,addConstraint:function(n){this.constraints.add(n)},addInteractor:function(n){this.interactors.add(n)},remConstraint:function(n){this.constraints.remove(n)},remInteractor:function(n){this.interactors.remove(n)},free:function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;){this.cbTypes.pop_unsafe().cbsets.remove(this)}},alloc:function(){},__class__:oe};var he=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new _e};l["zpp_nape.callbacks.ZPP_CbSetPair"]=he,he.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],he.get=function(n,e){var t;return null==he.zpp_pool?t=new he:(t=he.zpp_pool,he.zpp_pool=t.next,t.next=null),t.zip_listeners=!0,oe.setlt(n,e)?(t.a=n,t.b=e):(t.a=e,t.b=n),t},he.setlt=function(n,e){return!!oe.setlt(n.a,e.a)||n.a==e.a&&oe.setlt(n.b,e.b)},he.prototype={a:null,b:null,next:null,free:function(){this.a=this.b=null,this.listeners.clear()},alloc:function(){this.zip_listeners=!0},compatible:function(n){var e,t=n.options1,i=this.a.cbTypes;if(t.nonemptyintersection(i,t.includes)&&!t.nonemptyintersection(i,t.excludes)){var l=n.options2,r=this.b.cbTypes;e=!!l.nonemptyintersection(r,l.includes)&&!l.nonemptyintersection(r,l.excludes)}else e=!1;if(e)return!0;var a=n.options2,p=this.a.cbTypes;if(a.nonemptyintersection(p,a.includes)&&!a.nonemptyintersection(p,a.excludes)){var s=n.options1,o=this.b.cbTypes;return!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}return!1},zip_listeners:null,listeners:null,invalidate:function(){this.zip_listeners=!0},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},__validate:function(){this.listeners.clear();for(var n=this.a.listeners.head,e=this.b.listeners.head;null!=n&&null!=e;){var t=n.elt,i=e.elt;if(t==i){var l,r,a=t.options1,p=this.a.cbTypes;if(a.nonemptyintersection(p,a.includes)&&!a.nonemptyintersection(p,a.excludes)){var s=t.options2,o=this.b.cbTypes;r=!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}else r=!1;if(r)l=!0;else{var h=t.options2,_=this.a.cbTypes;if(h.nonemptyintersection(_,h.includes)&&!h.nonemptyintersection(_,h.excludes)){var u=t.options1,d=this.b.cbTypes;l=!!u.nonemptyintersection(d,u.includes)&&!u.nonemptyintersection(d,u.excludes)}else l=!1}l&&this.listeners.add(t),n=n.next,e=e.next}else t.precedence>i.precedence||t.precedence==i.precedence&&t.id>i.id?n=n.next:e=e.next}},empty_intersection:function(){return null==this.listeners.head},single_intersection:function(n){var e=this.listeners.head;return null!=e&&e.elt==n&&null==e.next},forall:function(n,e){for(var t=this.listeners.head;null!=t;){var i=t.elt;i.event==n&&e(i),t=t.next}},__class__:he};var _e=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_InteractionListener"]=_e,_e.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],_e.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ei.zpp_pool?e=new Ei:(e=Ei.zpp_pool,Ei.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ei.zpp_pool?e=new Ei:(e=Ei.zpp_pool,Ei.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ei.zpp_pool?t=new Ei:(t=Ei.zpp_pool,Ei.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ei.zpp_pool?t=new Ei:(t=Ei.zpp_pool,Ei.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ei.zpp_pool,Ei.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ei.zpp_pool,Ei.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ei.zpp_pool,Ei.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ei.zpp_pool,Ei.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ei.zpp_pool,Ei.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ei.zpp_pool,Ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ei.zpp_pool,Ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ei.zpp_pool,Ei.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ei.zpp_pool,Ei.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:_e};var ue=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_BodyListener"]=ue,ue.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],ue.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Li.zpp_pool?e=new Li:(e=Li.zpp_pool,Li.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Li.zpp_pool?e=new Li:(e=Li.zpp_pool,Li.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Li.zpp_pool?t=new Li:(t=Li.zpp_pool,Li.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Li.zpp_pool?t=new Li:(t=Li.zpp_pool,Li.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Li.zpp_pool,Li.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Li.zpp_pool,Li.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Li.zpp_pool,Li.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Li.zpp_pool,Li.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Li.zpp_pool,Li.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Li.zpp_pool,Li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Li.zpp_pool,Li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Li.zpp_pool,Li.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Li.zpp_pool,Li.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ue};var de=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ConstraintListener"]=de,de.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],de.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Di.zpp_pool?e=new Di:(e=Di.zpp_pool,Di.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Di.zpp_pool?e=new Di:(e=Di.zpp_pool,Di.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Di.zpp_pool,Di.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Di.zpp_pool,Di.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Di.zpp_pool,Di.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Di.zpp_pool,Di.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Di.zpp_pool,Di.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Di.zpp_pool,Di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Di.zpp_pool,Di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Di.zpp_pool,Di.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Di.zpp_pool,Di.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:de};var ce=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Constraint"]=ce,ce.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],ce.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ti.zpp_pool?e=new Ti:(e=Ti.zpp_pool,Ti.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ti.zpp_pool?e=new Ti:(e=Ti.zpp_pool,Ti.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ti.zpp_pool?t=new Ti:(t=Ti.zpp_pool,Ti.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ti.zpp_pool?t=new Ti:(t=Ti.zpp_pool,Ti.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ti.zpp_pool,Ti.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ti.zpp_pool,Ti.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ti.zpp_pool,Ti.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ti.zpp_pool,Ti.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ti.zpp_pool,Ti.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ti.zpp_pool,Ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ti.zpp_pool,Ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ti.zpp_pool,Ti.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ti.zpp_pool,Ti.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ce};var xe=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Interactor"]=xe,xe.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],xe.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Vi.zpp_pool?t=new Vi:(t=Vi.zpp_pool,Vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Vi.zpp_pool?t=new Vi:(t=Vi.zpp_pool,Vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vi.zpp_pool,Vi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vi.zpp_pool,Vi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Vi.zpp_pool,Vi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Vi.zpp_pool,Vi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Vi.zpp_pool,Vi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vi.zpp_pool,Vi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vi.zpp_pool,Vi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:xe};var ve=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbSet"]=ve,ve.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],ve.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ii.zpp_pool?e=new Ii:(e=Ii.zpp_pool,Ii.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ii.zpp_pool?e=new Ii:(e=Ii.zpp_pool,Ii.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ii.zpp_pool?t=new Ii:(t=Ii.zpp_pool,Ii.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ii.zpp_pool?t=new Ii:(t=Ii.zpp_pool,Ii.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ii.zpp_pool,Ii.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ii.zpp_pool,Ii.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ii.zpp_pool,Ii.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ii.zpp_pool,Ii.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ii.zpp_pool,Ii.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ii.zpp_pool,Ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ii.zpp_pool,Ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ii.zpp_pool,Ii.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ii.zpp_pool,Ii.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ve};var ze=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=pe.CbType(),this.listeners=new _e,this.bodylisteners=new ue,this.conlisteners=new de,this.constraints=new ce,this.interactors=new xe,this.cbsets=new ve};l["zpp_nape.callbacks.ZPP_CbType"]=ze,ze.__name__=["zpp_nape","callbacks","ZPP_CbType"],ze.setlt=function(n,e){return e.id>n.id},ze.prototype={outer:null,userData:null,id:null,cbsets:null,interactors:null,wrap_interactors:null,constraints:null,wrap_constraints:null,addConstraint:function(n){this.constraints.add(n)},addInteractor:function(n){this.interactors.add(n)},remConstraint:function(n){this.constraints.remove(n)},remInteractor:function(n){this.interactors.remove(n)},listeners:null,addint:function(n){for(var e=null,t=this.listeners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var l,r=this.listeners;null==Ei.zpp_pool?l=new Ei:(l=Ei.zpp_pool,Ei.zpp_pool=l.next,l.next=null),l.elt=n;var a=l;null==e?(a.next=r.head,r.head=a):(a.next=e.next,e.next=a),r.pushmod=r.modified=!0,r.length++;for(var p=this.cbsets.head;null!=p;){var s=p.elt;s.zip_listeners=!0,s.invalidate_pairs(),p=p.next}},removeint:function(n){this.listeners.remove(n);for(var e=this.cbsets.head;null!=e;){var t=e.elt;t.zip_listeners=!0,t.invalidate_pairs(),e=e.next}},invalidateint:function(){for(var n=this.cbsets.head;null!=n;){var e=n.elt;e.zip_listeners=!0,e.invalidate_pairs(),n=n.next}},bodylisteners:null,addbody:function(n){for(var e=null,t=this.bodylisteners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var l,r=this.bodylisteners;null==Li.zpp_pool?l=new Li:(l=Li.zpp_pool,Li.zpp_pool=l.next,l.next=null),l.elt=n;var a=l;null==e?(a.next=r.head,r.head=a):(a.next=e.next,e.next=a),r.pushmod=r.modified=!0,r.length++;for(var p=this.cbsets.head;null!=p;){p.elt.zip_bodylisteners=!0,p=p.next}},removebody:function(n){this.bodylisteners.remove(n);for(var e=this.cbsets.head;null!=e;){e.elt.zip_bodylisteners=!0,e=e.next}},invalidatebody:function(){for(var n=this.cbsets.head;null!=n;){n.elt.zip_bodylisteners=!0,n=n.next}},conlisteners:null,addconstraint:function(n){for(var e=null,t=this.conlisteners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var l,r=this.conlisteners;null==Di.zpp_pool?l=new Di:(l=Di.zpp_pool,Di.zpp_pool=l.next,l.next=null),l.elt=n;var a=l;null==e?(a.next=r.head,r.head=a):(a.next=e.next,e.next=a),r.pushmod=r.modified=!0,r.length++;for(var p=this.cbsets.head;null!=p;){p.elt.zip_conlisteners=!0,p=p.next}},removeconstraint:function(n){this.conlisteners.remove(n);for(var e=this.cbsets.head;null!=e;){e.elt.zip_conlisteners=!0,e=e.next}},invalidateconstraint:function(){for(var n=this.cbsets.head;null!=n;){n.elt.zip_conlisteners=!0,n=n.next}},__class__:ze};var ye=function(){};l["zpp_nape.util.ZPP_Flags"]=ye,ye.__name__=["zpp_nape","util","ZPP_Flags"],ye.GravMassMode_DEFAULT=null,ye.GravMassMode_FIXED=null,ye.GravMassMode_SCALED=null,ye.InertiaMode_DEFAULT=null,ye.InertiaMode_FIXED=null,ye.MassMode_DEFAULT=null,ye.MassMode_FIXED=null,ye.BodyType_STATIC=null,ye.BodyType_DYNAMIC=null,ye.BodyType_KINEMATIC=null,ye.ListenerType_BODY=null,ye.ListenerType_CONSTRAINT=null,ye.PreFlag_ACCEPT=null,ye.ListenerType_INTERACTION=null,ye.PreFlag_IGNORE=null,ye.ListenerType_PRE=null,ye.PreFlag_ACCEPT_ONCE=null,ye.PreFlag_IGNORE_ONCE=null,ye.CbEvent_BEGIN=null,ye.CbEvent_ONGOING=null,ye.InteractionType_COLLISION=null,ye.CbEvent_END=null,ye.InteractionType_SENSOR=null,ye.CbEvent_WAKE=null,ye.InteractionType_FLUID=null,ye.CbEvent_SLEEP=null,ye.InteractionType_ANY=null,ye.CbEvent_BREAK=null,ye.CbEvent_PRE=null,ye.Winding_UNDEFINED=null,ye.Winding_CLOCKWISE=null,ye.Winding_ANTICLOCKWISE=null,ye.ValidationResult_VALID=null,ye.ValidationResult_DEGENERATE=null,ye.ValidationResult_CONCAVE=null,ye.ValidationResult_SELF_INTERSECTING=null,ye.ShapeType_CIRCLE=null,ye.ShapeType_POLYGON=null,ye.Broadphase_DYNAMIC_AABB_TREE=null,ye.Broadphase_SWEEP_AND_PRUNE=null,ye.ArbiterType_COLLISION=null,ye.ArbiterType_SENSOR=null,ye.ArbiterType_FLUID=null;var fe=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=pe.Listener()};l["zpp_nape.callbacks.ZPP_Listener"]=fe,fe.__name__=["zpp_nape","callbacks","ZPP_Listener"],fe.setlt=function(n,e){return n.precedence>e.precedence||n.precedence==e.precedence&&n.id>e.id},fe.prototype={outer:null,id:null,type:null,event:null,precedence:null,body:null,constraint:null,interaction:null,space:null,swapEvent:function(n){},invalidate_precedence:function(){},addedToSpace:function(){},removedFromSpace:function(){},__class__:fe};var me=function(n,e,t){this.handler=null,this.options=null,this.outer_zn=null,fe.call(this),this.event=e,this.handler=t,this.body=this,this.type=ye.id_ListenerType_BODY,this.options=n.zpp_inner};l["zpp_nape.callbacks.ZPP_BodyListener"]=me,me.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],me.__super__=fe,me.prototype=e(fe.prototype,{outer_zn:null,options:null,handler:null,immutable_options:function(){},addedToSpace:function(){this.options.handler=t(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var e=n.elt,i=null,l=e.bodylisteners.head;null!=l;){var r=l.elt;if(this.precedence>r.precedence||this.precedence==r.precedence&&this.id>r.id)break;i=l,l=l.next}var a,p=e.bodylisteners;null==Li.zpp_pool?a=new Li:(a=Li.zpp_pool,Li.zpp_pool=a.next,a.next=null),a.elt=this;var s=a;null==i?(s.next=p.head,p.head=s):(s.next=i.next,i.next=s),p.pushmod=p.modified=!0,p.length++;for(var o=e.cbsets.head;null!=o;){o.elt.zip_bodylisteners=!0,o=o.next}n=n.next}},removedFromSpace:function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.bodylisteners.remove(this);for(var t=e.cbsets.head;null!=t;){t.elt.zip_bodylisteners=!0,t=t.next}n=n.next}this.options.handler=null},cbtype_change:function(n,e,t){this.removedFromSpace();var i=this.options;if(e)if(t){for(var l=null,r=i.includes.head;null!=r;){var a=r.elt;if(a.id>n.id)break;l=r,r=r.next}var p,s=i.includes;null==ki.zpp_pool?p=new ki:(p=ki.zpp_pool,ki.zpp_pool=p.next,p.next=null),p.elt=n;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else i.includes.remove(n);else if(t){for(var h=null,_=i.excludes.head;null!=_;){var u=_.elt;if(u.id>n.id)break;h=_,_=_.next}var d,c=i.excludes;null==ki.zpp_pool?d=new ki:(d=ki.zpp_pool,ki.zpp_pool=d.next,d.next=null),d.elt=n;var x=d;null==h?(x.next=c.head,c.head=x):(x.next=h.next,h.next=x),c.pushmod=c.modified=!0,c.length++}else i.excludes.remove(n);this.addedToSpace()},invalidate_precedence:function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:me});var be=function(n,e,t){this.handler=null,this.options=null,this.outer_zn=null,fe.call(this),this.event=e,this.handler=t,this.constraint=this,this.type=ye.id_ListenerType_CONSTRAINT,this.options=n.zpp_inner};l["zpp_nape.callbacks.ZPP_ConstraintListener"]=be,be.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],be.__super__=fe,be.prototype=e(fe.prototype,{outer_zn:null,options:null,handler:null,immutable_options:function(){},addedToSpace:function(){this.options.handler=t(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var e=n.elt,i=null,l=e.conlisteners.head;null!=l;){var r=l.elt;if(this.precedence>r.precedence||this.precedence==r.precedence&&this.id>r.id)break;i=l,l=l.next}var a,p=e.conlisteners;null==Di.zpp_pool?a=new Di:(a=Di.zpp_pool,Di.zpp_pool=a.next,a.next=null),a.elt=this;var s=a;null==i?(s.next=p.head,p.head=s):(s.next=i.next,i.next=s),p.pushmod=p.modified=!0,p.length++;for(var o=e.cbsets.head;null!=o;){o.elt.zip_conlisteners=!0,o=o.next}n=n.next}},removedFromSpace:function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.conlisteners.remove(this);for(var t=e.cbsets.head;null!=t;){t.elt.zip_conlisteners=!0,t=t.next}n=n.next}this.options.handler=null},cbtype_change:function(n,e,t){this.removedFromSpace();var i=this.options;if(e)if(t){for(var l=null,r=i.includes.head;null!=r;){var a=r.elt;if(a.id>n.id)break;l=r,r=r.next}var p,s=i.includes;null==ki.zpp_pool?p=new ki:(p=ki.zpp_pool,ki.zpp_pool=p.next,p.next=null),p.elt=n;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else i.includes.remove(n);else if(t){for(var h=null,_=i.excludes.head;null!=_;){var u=_.elt;if(u.id>n.id)break;h=_,_=_.next}var d,c=i.excludes;null==ki.zpp_pool?d=new ki:(d=ki.zpp_pool,ki.zpp_pool=d.next,d.next=null),d.elt=n;var x=d;null==h?(x.next=c.head,c.head=x):(x.next=h.next,h.next=x),c.pushmod=c.modified=!0,c.length++}else i.excludes.remove(n);this.addedToSpace()},invalidate_precedence:function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:be});var ge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbType"]=ge,ge.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],ge.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==ki.zpp_pool?e=new ki:(e=ki.zpp_pool,ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==ki.zpp_pool?e=new ki:(e=ki.zpp_pool,ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==ki.zpp_pool?t=new ki:(t=ki.zpp_pool,ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==ki.zpp_pool?t=new ki:(t=ki.zpp_pool,ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ki.zpp_pool,ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ki.zpp_pool,ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ki.zpp_pool,ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ki.zpp_pool,ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=ki.zpp_pool,ki.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ki.zpp_pool,ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ki.zpp_pool,ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ki.zpp_pool,ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ki.zpp_pool,ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ge};var we=function(n,e,t,i){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,fe.call(this),this.type=i,this.interaction=this,this.event=t,this.options1=n.zpp_inner,this.options2=e.zpp_inner,this.allowSleepingCallbacks=!1};l["zpp_nape.callbacks.ZPP_InteractionListener"]=we,we.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],we.__super__=fe,we.prototype=e(fe.prototype,{outer_zni:null,outer_znp:null,itype:null,options1:null,options2:null,handleri:null,allowSleepingCallbacks:null,pure:null,handlerp:null,setInteractionType:function(n){this.itype=n},wake:function(){for(var n=this.options1.includes.head,e=this.options2.includes.head;null!=n&&null!=e;){var t=n.elt,i=e.elt;if(t==i){for(var l=t.interactors.head;null!=l;){l.elt.wake(),l=l.next}n=n.next,e=e.next}else if(i.id>t.id){for(var r=t.interactors.head;null!=r;){var a=r.elt;a.wake(),r=r.next}n=n.next}else{for(var p=i.interactors.head;null!=p;){var s=p.elt;s.wake(),p=p.next}e=e.next}}for(;null!=n;){for(var o=n.elt.interactors.head;null!=o;){o.elt.wake(),o=o.next}n=n.next}for(;null!=e;){for(var h=e.elt.interactors.head;null!=h;){h.elt.wake(),h=h.next}e=e.next}},CbSetset:function(n,e,t){for(var i=we.UCbSet,l=we.VCbSet,r=we.WCbSet,a=n.head,p=e.head;null!=a&&null!=p;){var s=a.elt,o=p.elt;if(s==o){var h;null==Ii.zpp_pool?h=new Ii:(h=Ii.zpp_pool,Ii.zpp_pool=h.next,h.next=null),h.elt=s;var _=h;_.next=r.head,r.head=_,r.modified=!0,r.length++,a=a.next,p=p.next}else if(oe.setlt(s,o)){var u;null==Ii.zpp_pool?u=new Ii:(u=Ii.zpp_pool,Ii.zpp_pool=u.next,u.next=null),u.elt=s;var d=u;d.next=i.head,i.head=d,i.modified=!0,i.length++,a=a.next}else{var c;null==Ii.zpp_pool?c=new Ii:(c=Ii.zpp_pool,Ii.zpp_pool=c.next,c.next=null),c.elt=o;var x=c;x.next=l.head,l.head=x,l.modified=!0,l.length++,p=p.next}}for(;null!=a;){var v,z=a.elt;null==Ii.zpp_pool?v=new Ii:(v=Ii.zpp_pool,Ii.zpp_pool=v.next,v.next=null),v.elt=z;var y=v;y.next=i.head,i.head=y,i.modified=!0,i.length++,a=a.next}for(;null!=p;){var f,m=p.elt;null==Ii.zpp_pool?f=new Ii:(f=Ii.zpp_pool,Ii.zpp_pool=f.next,f.next=null),f.elt=m;var b=f;b.next=l.head,l.head=b,l.modified=!0,l.length++,p=p.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=e.head;null!=w;){var C=w.elt;t(g,C),w=w.next}for(;null!=l.head;)for(var M=l.pop_unsafe(),k=r.head;null!=k;){var O=k.elt;t(M,O),k=k.next}for(;null!=r.head;){var S=r.pop_unsafe();t(S,S);for(var P=r.head;null!=P;){t(S,P.elt),P=P.next}}},CbTypeset:function(n,e,t){for(var i=we.UCbType,l=we.VCbType,r=we.WCbType,a=n.head,p=e.head;null!=a&&null!=p;){var s=a.elt,o=p.elt;if(s==o){var h;null==ki.zpp_pool?h=new ki:(h=ki.zpp_pool,ki.zpp_pool=h.next,h.next=null),h.elt=s;var _=h;_.next=r.head,r.head=_,r.modified=!0,r.length++,a=a.next,p=p.next}else if(o.id>s.id){var u;null==ki.zpp_pool?u=new ki:(u=ki.zpp_pool,ki.zpp_pool=u.next,u.next=null),u.elt=s;var d=u;d.next=i.head,i.head=d,i.modified=!0,i.length++,a=a.next}else{var c;null==ki.zpp_pool?c=new ki:(c=ki.zpp_pool,ki.zpp_pool=c.next,c.next=null),c.elt=o;var x=c;x.next=l.head,l.head=x,l.modified=!0,l.length++,p=p.next}}for(;null!=a;){var v,z=a.elt;null==ki.zpp_pool?v=new ki:(v=ki.zpp_pool,ki.zpp_pool=v.next,v.next=null),v.elt=z;var y=v;y.next=i.head,i.head=y,i.modified=!0,i.length++,a=a.next}for(;null!=p;){var f,m=p.elt;null==ki.zpp_pool?f=new ki:(f=ki.zpp_pool,ki.zpp_pool=f.next,f.next=null),f.elt=m;var b=f;b.next=l.head,l.head=b,l.modified=!0,l.length++,p=p.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=e.head;null!=w;){var C=w.elt;t(g,C),w=w.next}for(;null!=l.head;)for(var M=l.pop_unsafe(),k=r.head;null!=k;){var O=k.elt;t(M,O),k=k.next}for(;null!=r.head;){var S=r.pop_unsafe();t(S,S);for(var P=r.head;null!=P;){t(S,P.elt),P=P.next}}},with_uniquesets:function(n){var e,t=this;null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.lt=he.setlt;for(var i=this.options2.includes,l=we.UCbType,r=we.VCbType,a=we.WCbType,p=this.options1.includes.head,s=i.head;null!=p&&null!=s;){var o=p.elt,h=s.elt;if(o==h){var _;null==ki.zpp_pool?_=new ki:(_=ki.zpp_pool,ki.zpp_pool=_.next,_.next=null),_.elt=o;var u=_;u.next=a.head,a.head=u,a.modified=!0,a.length++,p=p.next,s=s.next}else if(h.id>o.id){var d;null==ki.zpp_pool?d=new ki:(d=ki.zpp_pool,ki.zpp_pool=d.next,d.next=null),d.elt=o;var c=d;c.next=l.head,l.head=c,l.modified=!0,l.length++,p=p.next}else{var x;null==ki.zpp_pool?x=new ki:(x=ki.zpp_pool,ki.zpp_pool=x.next,x.next=null),x.elt=h;var v=x;v.next=r.head,r.head=v,r.modified=!0,r.length++,s=s.next}}for(;null!=p;){var z,y=p.elt;null==ki.zpp_pool?z=new ki:(z=ki.zpp_pool,ki.zpp_pool=z.next,z.next=null),z.elt=y;var f=z;f.next=l.head,l.head=f,l.modified=!0,l.length++,p=p.next}for(;null!=s;){var m,b=s.elt;null==ki.zpp_pool?m=new ki:(m=ki.zpp_pool,ki.zpp_pool=m.next,m.next=null),m.elt=b;var g=m;g.next=r.head,r.head=g,r.modified=!0,r.length++,s=s.next}for(;null!=l.head;)for(var w=l.pop_unsafe(),C=i.head;null!=C;){for(var M=C.elt,k=M.cbsets,O=we.UCbSet,S=we.VCbSet,P=we.WCbSet,T=w.cbsets.head,A=k.head;null!=T&&null!=A;){var E=T.elt,I=A.elt;if(E==I){var V;null==Ii.zpp_pool?V=new Ii:(V=Ii.zpp_pool,Ii.zpp_pool=V.next,V.next=null),V.elt=E;var L=V;L.next=P.head,P.head=L,P.modified=!0,P.length++,T=T.next,A=A.next}else if(oe.setlt(E,I)){var N;null==Ii.zpp_pool?N=new Ii:(N=Ii.zpp_pool,Ii.zpp_pool=N.next,N.next=null),N.elt=E;var D=N;D.next=O.head,O.head=D,O.modified=!0,O.length++,T=T.next}else{var j;null==Ii.zpp_pool?j=new Ii:(j=Ii.zpp_pool,Ii.zpp_pool=j.next,j.next=null),j.elt=I;var F=j;F.next=S.head,S.head=F,S.modified=!0,S.length++,A=A.next}}for(;null!=T;){var B,R=T.elt;null==Ii.zpp_pool?B=new Ii:(B=Ii.zpp_pool,Ii.zpp_pool=B.next,B.next=null),B.elt=R;var G=B;G.next=O.head,O.head=G,O.modified=!0,O.length++,T=T.next}for(;null!=A;){var Y,U=A.elt;null==Ii.zpp_pool?Y=new Ii:(Y=Ii.zpp_pool,Ii.zpp_pool=Y.next,Y.next=null),Y.elt=U;var Z=Y;Z.next=S.head,S.head=Z,S.modified=!0,S.length++,A=A.next}for(;null!=O.head;)for(var q=O.pop_unsafe(),W=k.head;null!=W;){var X=W.elt;if(q.validate(),X.validate(),oe.single_intersection(q,X,t)){var H;null==he.zpp_pool?H=new he:(H=he.zpp_pool,he.zpp_pool=H.next,H.next=null),H.zip_listeners=!0,oe.setlt(q,X)?(H.a=q,H.b=X):(H.a=X,H.b=q),e.try_insert(H)}W=W.next}for(;null!=S.head;)for(var K=S.pop_unsafe(),J=P.head;null!=J;){var Q=J.elt;if(K.validate(),Q.validate(),oe.single_intersection(K,Q,t)){var $;null==he.zpp_pool?$=new he:($=he.zpp_pool,he.zpp_pool=$.next,$.next=null),$.zip_listeners=!0,oe.setlt(K,Q)?($.a=K,$.b=Q):($.a=Q,$.b=K),e.try_insert($)}J=J.next}for(;null!=P.head;){var nn=P.pop_unsafe();if(nn.validate(),nn.validate(),oe.single_intersection(nn,nn,t)){var en;null==he.zpp_pool?en=new he:(en=he.zpp_pool,he.zpp_pool=en.next,en.next=null),en.zip_listeners=!0,oe.setlt(nn,nn),en.a=nn,en.b=nn,e.try_insert(en)}for(var tn=P.head;null!=tn;){var ln=tn.elt;if(nn.validate(),ln.validate(),oe.single_intersection(nn,ln,t)){var rn;null==he.zpp_pool?rn=new he:(rn=he.zpp_pool,he.zpp_pool=rn.next,rn.next=null),rn.zip_listeners=!0,oe.setlt(nn,ln)?(rn.a=nn,rn.b=ln):(rn.a=ln,rn.b=nn),e.try_insert(rn)}tn=tn.next}}C=C.next}for(;null!=r.head;)for(var an=r.pop_unsafe(),pn=a.head;null!=pn;){for(var sn=pn.elt,on=sn.cbsets,hn=we.UCbSet,_n=we.VCbSet,un=we.WCbSet,dn=an.cbsets.head,cn=on.head;null!=dn&&null!=cn;){var xn=dn.elt,vn=cn.elt;if(xn==vn){var zn;null==Ii.zpp_pool?zn=new Ii:(zn=Ii.zpp_pool,Ii.zpp_pool=zn.next,zn.next=null),zn.elt=xn;var yn=zn;yn.next=un.head,un.head=yn,un.modified=!0,un.length++,dn=dn.next,cn=cn.next}else if(oe.setlt(xn,vn)){var fn;null==Ii.zpp_pool?fn=new Ii:(fn=Ii.zpp_pool,Ii.zpp_pool=fn.next,fn.next=null),fn.elt=xn;var mn=fn;mn.next=hn.head,hn.head=mn,hn.modified=!0,hn.length++,dn=dn.next}else{var bn;null==Ii.zpp_pool?bn=new Ii:(bn=Ii.zpp_pool,Ii.zpp_pool=bn.next,bn.next=null),bn.elt=vn;var gn=bn;gn.next=_n.head,_n.head=gn,_n.modified=!0,_n.length++,cn=cn.next}}for(;null!=dn;){var wn,Cn=dn.elt;null==Ii.zpp_pool?wn=new Ii:(wn=Ii.zpp_pool,Ii.zpp_pool=wn.next,wn.next=null),wn.elt=Cn;var Mn=wn;Mn.next=hn.head,hn.head=Mn,hn.modified=!0,hn.length++,dn=dn.next}for(;null!=cn;){var kn,On=cn.elt;null==Ii.zpp_pool?kn=new Ii:(kn=Ii.zpp_pool,Ii.zpp_pool=kn.next,kn.next=null),kn.elt=On;var Sn=kn;Sn.next=_n.head,_n.head=Sn,_n.modified=!0,_n.length++,cn=cn.next}for(;null!=hn.head;)for(var Pn=hn.pop_unsafe(),Tn=on.head;null!=Tn;){var An=Tn.elt;if(Pn.validate(),An.validate(),oe.single_intersection(Pn,An,t)){var En;null==he.zpp_pool?En=new he:(En=he.zpp_pool,he.zpp_pool=En.next,En.next=null),En.zip_listeners=!0,oe.setlt(Pn,An)?(En.a=Pn,En.b=An):(En.a=An,En.b=Pn),e.try_insert(En)}Tn=Tn.next}for(;null!=_n.head;)for(var In=_n.pop_unsafe(),Vn=un.head;null!=Vn;){var Ln=Vn.elt;if(In.validate(),Ln.validate(),oe.single_intersection(In,Ln,t)){var Nn;null==he.zpp_pool?Nn=new he:(Nn=he.zpp_pool,he.zpp_pool=Nn.next,Nn.next=null),Nn.zip_listeners=!0,oe.setlt(In,Ln)?(Nn.a=In,Nn.b=Ln):(Nn.a=Ln,Nn.b=In),e.try_insert(Nn)}Vn=Vn.next}for(;null!=un.head;){var Dn=un.pop_unsafe();if(Dn.validate(),Dn.validate(),oe.single_intersection(Dn,Dn,t)){var jn;null==he.zpp_pool?jn=new he:(jn=he.zpp_pool,he.zpp_pool=jn.next,jn.next=null),jn.zip_listeners=!0,oe.setlt(Dn,Dn),jn.a=Dn,jn.b=Dn,e.try_insert(jn)}for(var Fn=un.head;null!=Fn;){var Bn=Fn.elt;if(Dn.validate(),Bn.validate(),oe.single_intersection(Dn,Bn,t)){var Rn;null==he.zpp_pool?Rn=new he:(Rn=he.zpp_pool,he.zpp_pool=Rn.next,Rn.next=null),Rn.zip_listeners=!0,oe.setlt(Dn,Bn)?(Rn.a=Dn,Rn.b=Bn):(Rn.a=Bn,Rn.b=Dn),e.try_insert(Rn)}Fn=Fn.next}}pn=pn.next}for(;null!=a.head;){for(var Gn=a.pop_unsafe(),Yn=Gn.cbsets,Un=we.UCbSet,Zn=we.VCbSet,qn=we.WCbSet,Wn=Gn.cbsets.head,Xn=Yn.head;null!=Wn&&null!=Xn;){var Hn=Wn.elt,Kn=Xn.elt;if(Hn==Kn){var Jn;null==Ii.zpp_pool?Jn=new Ii:(Jn=Ii.zpp_pool,Ii.zpp_pool=Jn.next,Jn.next=null),Jn.elt=Hn;var Qn=Jn;Qn.next=qn.head,qn.head=Qn,qn.modified=!0,qn.length++,Wn=Wn.next,Xn=Xn.next}else if(oe.setlt(Hn,Kn)){var $n;null==Ii.zpp_pool?$n=new Ii:($n=Ii.zpp_pool,Ii.zpp_pool=$n.next,$n.next=null),$n.elt=Hn;var ne=$n;ne.next=Un.head,Un.head=ne,Un.modified=!0,Un.length++,Wn=Wn.next}else{var ee;null==Ii.zpp_pool?ee=new Ii:(ee=Ii.zpp_pool,Ii.zpp_pool=ee.next,ee.next=null),ee.elt=Kn;var te=ee;te.next=Zn.head,Zn.head=te,Zn.modified=!0,Zn.length++,Xn=Xn.next}}for(;null!=Wn;){var ie,le=Wn.elt;null==Ii.zpp_pool?ie=new Ii:(ie=Ii.zpp_pool,Ii.zpp_pool=ie.next,ie.next=null),ie.elt=le;var re=ie;re.next=Un.head,Un.head=re,Un.modified=!0,Un.length++,Wn=Wn.next}for(;null!=Xn;){var ae,pe=Xn.elt;null==Ii.zpp_pool?ae=new Ii:(ae=Ii.zpp_pool,Ii.zpp_pool=ae.next,ae.next=null),ae.elt=pe;var se=ae;se.next=Zn.head,Zn.head=se,Zn.modified=!0,Zn.length++,Xn=Xn.next}for(;null!=Un.head;)for(var _e=Un.pop_unsafe(),ue=Yn.head;null!=ue;){var de=ue.elt;if(_e.validate(),de.validate(),oe.single_intersection(_e,de,t)){var ce;null==he.zpp_pool?ce=new he:(ce=he.zpp_pool,he.zpp_pool=ce.next,ce.next=null),ce.zip_listeners=!0,oe.setlt(_e,de)?(ce.a=_e,ce.b=de):(ce.a=de,ce.b=_e),e.try_insert(ce)}ue=ue.next}for(;null!=Zn.head;)for(var xe=Zn.pop_unsafe(),ve=qn.head;null!=ve;){var ze=ve.elt;if(xe.validate(),ze.validate(),oe.single_intersection(xe,ze,t)){var ye;null==he.zpp_pool?ye=new he:(ye=he.zpp_pool,he.zpp_pool=ye.next,ye.next=null),ye.zip_listeners=!0,oe.setlt(xe,ze)?(ye.a=xe,ye.b=ze):(ye.a=ze,ye.b=xe),e.try_insert(ye)}ve=ve.next}for(;null!=qn.head;){var fe=qn.pop_unsafe();if(fe.validate(),fe.validate(),oe.single_intersection(fe,fe,t)){var me;null==he.zpp_pool?me=new he:(me=he.zpp_pool,he.zpp_pool=me.next,me.next=null),me.zip_listeners=!0,oe.setlt(fe,fe),me.a=fe,me.b=fe,e.try_insert(me)}for(var be=qn.head;null!=be;){var ge=be.elt;if(fe.validate(),ge.validate(),oe.single_intersection(fe,ge,t)){var Ce;null==he.zpp_pool?Ce=new he:(Ce=he.zpp_pool,he.zpp_pool=Ce.next,Ce.next=null),Ce.zip_listeners=!0,oe.setlt(fe,ge)?(Ce.a=fe,Ce.b=ge):(Ce.a=ge,Ce.b=fe),e.try_insert(Ce)}be=be.next}}for(var Me=a.head;null!=Me;){for(var ke=Me.elt,Oe=ke.cbsets,Se=we.UCbSet,Pe=we.VCbSet,Te=we.WCbSet,Ae=Gn.cbsets.head,Ee=Oe.head;null!=Ae&&null!=Ee;){var Ie=Ae.elt,Ve=Ee.elt;if(Ie==Ve){var Le;null==Ii.zpp_pool?Le=new Ii:(Le=Ii.zpp_pool,Ii.zpp_pool=Le.next,Le.next=null),Le.elt=Ie;var Ne=Le;Ne.next=Te.head,Te.head=Ne,Te.modified=!0,Te.length++,Ae=Ae.next,Ee=Ee.next}else if(oe.setlt(Ie,Ve)){var De;null==Ii.zpp_pool?De=new Ii:(De=Ii.zpp_pool,Ii.zpp_pool=De.next,De.next=null),De.elt=Ie;var je=De;je.next=Se.head,Se.head=je,Se.modified=!0,Se.length++,Ae=Ae.next}else{var Fe;null==Ii.zpp_pool?Fe=new Ii:(Fe=Ii.zpp_pool,Ii.zpp_pool=Fe.next,Fe.next=null),Fe.elt=Ve;var Be=Fe;Be.next=Pe.head,Pe.head=Be,Pe.modified=!0,Pe.length++,Ee=Ee.next}}for(;null!=Ae;){var Re,Ge=Ae.elt;null==Ii.zpp_pool?Re=new Ii:(Re=Ii.zpp_pool,Ii.zpp_pool=Re.next,Re.next=null),Re.elt=Ge;var Ye=Re;Ye.next=Se.head,Se.head=Ye,Se.modified=!0,Se.length++,Ae=Ae.next}for(;null!=Ee;){var Ue,Ze=Ee.elt;null==Ii.zpp_pool?Ue=new Ii:(Ue=Ii.zpp_pool,Ii.zpp_pool=Ue.next,Ue.next=null),Ue.elt=Ze;var qe=Ue;qe.next=Pe.head,Pe.head=qe,Pe.modified=!0,Pe.length++,Ee=Ee.next}for(;null!=Se.head;)for(var We=Se.pop_unsafe(),Xe=Oe.head;null!=Xe;){var He=Xe.elt;if(We.validate(),He.validate(),oe.single_intersection(We,He,t)){var Ke;null==he.zpp_pool?Ke=new he:(Ke=he.zpp_pool,he.zpp_pool=Ke.next,Ke.next=null),Ke.zip_listeners=!0,oe.setlt(We,He)?(Ke.a=We,Ke.b=He):(Ke.a=He,Ke.b=We),e.try_insert(Ke)}Xe=Xe.next}for(;null!=Pe.head;)for(var Je=Pe.pop_unsafe(),Qe=Te.head;null!=Qe;){var $e=Qe.elt;if(Je.validate(),$e.validate(),oe.single_intersection(Je,$e,t)){var nt;null==he.zpp_pool?nt=new he:(nt=he.zpp_pool,he.zpp_pool=nt.next,nt.next=null),nt.zip_listeners=!0,oe.setlt(Je,$e)?(nt.a=Je,nt.b=$e):(nt.a=$e,nt.b=Je),e.try_insert(nt)}Qe=Qe.next}for(;null!=Te.head;){var et=Te.pop_unsafe();if(et.validate(),et.validate(),oe.single_intersection(et,et,t)){var tt;null==he.zpp_pool?tt=new he:(tt=he.zpp_pool,he.zpp_pool=tt.next,tt.next=null),tt.zip_listeners=!0,oe.setlt(et,et),tt.a=et,tt.b=et,e.try_insert(tt)}for(var it=Te.head;null!=it;){var lt=it.elt;if(et.validate(),lt.validate(),oe.single_intersection(et,lt,t)){var rt;null==he.zpp_pool?rt=new he:(rt=he.zpp_pool,he.zpp_pool=rt.next,rt.next=null),rt.zip_listeners=!0,oe.setlt(et,lt)?(rt.a=et,rt.b=lt):(rt.a=lt,rt.b=et),e.try_insert(rt)}it=it.next}}Me=Me.next}}if(null!=e.parent){for(var at=e.parent;null!=at;)if(null!=at.prev)at=at.prev;else if(null!=at.next)at=at.next;else{var pt=at.data;n?t.space.freshListenerType(pt.a,pt.b):t.space.nullListenerType(pt.a,pt.b);var st=pt;st.a=st.b=null,st.listeners.clear(),st.next=he.zpp_pool,he.zpp_pool=st;var ot=at.parent;null!=ot&&(at==ot.prev?ot.prev=null:ot.next=null,at.parent=null);var ht=at;ht.data=null,ht.lt=null,ht.swapped=null,ht.next=kl.zpp_pool,kl.zpp_pool=ht,at=ot}e.parent=null}var _t=e;_t.data=null,_t.lt=null,_t.swapped=null,_t.next=kl.zpp_pool,kl.zpp_pool=_t},with_union:function(n){for(var e=this.options1.includes.head,t=this.options2.includes.head;null!=e&&null!=t;){var i=e.elt,l=t.elt;i==l?(n(i),e=e.next,t=t.next):l.id>i.id?(n(i),e=e.next):(n(l),t=t.next)}for(;null!=e;)n(e.elt),e=e.next;for(;null!=t;)n(t.elt),t=t.next},addedToSpace:function(){for(var n=this,e=this.type==ye.id_ListenerType_PRE,i=this.options1.includes.head,l=this.options2.includes.head;null!=i&&null!=l;){var r=i.elt,a=l.elt;if(r==a){for(var p=null,s=r.listeners.head;null!=s;){var o=s.elt;if(n.precedence>o.precedence||n.precedence==o.precedence&&n.id>o.id)break;p=s,s=s.next}var h,_=r.listeners;null==Ei.zpp_pool?h=new Ei:(h=Ei.zpp_pool,Ei.zpp_pool=h.next,h.next=null),h.elt=n;var u=h;null==p?(u.next=_.head,_.head=u):(u.next=p.next,p.next=u),_.pushmod=_.modified=!0,_.length++;for(var d=r.cbsets.head;null!=d;){var c=d.elt;c.zip_listeners=!0,c.invalidate_pairs(),d=d.next}if(e)for(var x=r.interactors.head;null!=x;){var v=x.elt;v.wake(),x=x.next}i=i.next,l=l.next}else if(a.id>r.id){for(var z=null,y=r.listeners.head;null!=y;){var f=y.elt;if(n.precedence>f.precedence||n.precedence==f.precedence&&n.id>f.id)break;z=y,y=y.next}var m,b=r.listeners;null==Ei.zpp_pool?m=new Ei:(m=Ei.zpp_pool,Ei.zpp_pool=m.next,m.next=null),m.elt=n;var g=m;null==z?(g.next=b.head,b.head=g):(g.next=z.next,z.next=g),b.pushmod=b.modified=!0,b.length++;for(var w=r.cbsets.head;null!=w;){var C=w.elt;C.zip_listeners=!0,C.invalidate_pairs(),w=w.next}if(e)for(var M=r.interactors.head;null!=M;){var k=M.elt;k.wake(),M=M.next}i=i.next}else{for(var O=null,S=a.listeners.head;null!=S;){var P=S.elt;if(n.precedence>P.precedence||n.precedence==P.precedence&&n.id>P.id)break;O=S,S=S.next}var T,A=a.listeners;null==Ei.zpp_pool?T=new Ei:(T=Ei.zpp_pool,Ei.zpp_pool=T.next,T.next=null),T.elt=n;var E=T;null==O?(E.next=A.head,A.head=E):(E.next=O.next,O.next=E),A.pushmod=A.modified=!0,A.length++;for(var I=a.cbsets.head;null!=I;){var V=I.elt;V.zip_listeners=!0,V.invalidate_pairs(),I=I.next}if(e)for(var L=a.interactors.head;null!=L;){var N=L.elt;N.wake(),L=L.next}l=l.next}}for(;null!=i;){for(var D=i.elt,j=null,F=D.listeners.head;null!=F;){var B=F.elt;if(n.precedence>B.precedence||n.precedence==B.precedence&&n.id>B.id)break;j=F,F=F.next}var R,G=D.listeners;null==Ei.zpp_pool?R=new Ei:(R=Ei.zpp_pool,Ei.zpp_pool=R.next,R.next=null),R.elt=n;var Y=R;null==j?(Y.next=G.head,G.head=Y):(Y.next=j.next,j.next=Y),G.pushmod=G.modified=!0,G.length++;for(var U=D.cbsets.head;null!=U;){var Z=U.elt;Z.zip_listeners=!0,Z.invalidate_pairs(),U=U.next}if(e)for(var q=D.interactors.head;null!=q;){var W=q.elt;W.wake(),q=q.next}i=i.next}for(;null!=l;){for(var X=l.elt,H=null,K=X.listeners.head;null!=K;){var J=K.elt;if(n.precedence>J.precedence||n.precedence==J.precedence&&n.id>J.id)break;H=K,K=K.next}var Q,$=X.listeners;null==Ei.zpp_pool?Q=new Ei:(Q=Ei.zpp_pool,Ei.zpp_pool=Q.next,Q.next=null),Q.elt=n;var nn=Q;null==H?(nn.next=$.head,$.head=nn):(nn.next=H.next,H.next=nn),$.pushmod=$.modified=!0,$.length++;for(var en=X.cbsets.head;null!=en;){var tn=en.elt;tn.zip_listeners=!0,tn.invalidate_pairs(),en=en.next}if(e)for(var ln=X.interactors.head;null!=ln;){var rn=ln.elt;rn.wake(),ln=ln.next}l=l.next}this.options1.handler=t(this,this.cbtype_change1),this.options2.handler=t(this,this.cbtype_change2),this.with_uniquesets(!0)},removedFromSpace:function(){var n=this;this.with_uniquesets(!1);for(var e=this.type==ye.id_ListenerType_PRE,t=this.options1.includes.head,i=this.options2.includes.head;null!=t&&null!=i;){var l=t.elt,r=i.elt;if(l==r){l.listeners.remove(n);for(var a=l.cbsets.head;null!=a;){var p=a.elt;p.zip_listeners=!0,p.invalidate_pairs(),a=a.next}if(e)for(var s=l.interactors.head;null!=s;){var o=s.elt;o.wake(),s=s.next}t=t.next,i=i.next}else if(r.id>l.id){l.listeners.remove(n);for(var h=l.cbsets.head;null!=h;){var _=h.elt;_.zip_listeners=!0,_.invalidate_pairs(),h=h.next}if(e)for(var u=l.interactors.head;null!=u;){var d=u.elt;d.wake(),u=u.next}t=t.next}else{r.listeners.remove(n);for(var c=r.cbsets.head;null!=c;){var x=c.elt;x.zip_listeners=!0,x.invalidate_pairs(),c=c.next}if(e)for(var v=r.interactors.head;null!=v;){var z=v.elt;z.wake(),v=v.next}i=i.next}}for(;null!=t;){var y=t.elt;y.listeners.remove(n);for(var f=y.cbsets.head;null!=f;){var m=f.elt;m.zip_listeners=!0,m.invalidate_pairs(),f=f.next}if(e)for(var b=y.interactors.head;null!=b;){var g=b.elt;g.wake(),b=b.next}t=t.next}for(;null!=i;){var w=i.elt;w.listeners.remove(n);for(var C=w.cbsets.head;null!=C;){var M=C.elt;M.zip_listeners=!0,M.invalidate_pairs(),C=C.next}if(e)for(var k=w.interactors.head;null!=k;){var O=k.elt;O.wake(),k=k.next}i=i.next}this.options1.handler=null,this.options2.handler=null},invalidate_precedence:function(){var n=this;if(null!=this.space){for(var e=this.type==ye.id_ListenerType_PRE,t=this.options1.includes.head,i=this.options2.includes.head;null!=t&&null!=i;){var l=t.elt,r=i.elt;if(l==r){l.listeners.remove(n);for(var a=l.cbsets.head;null!=a;){var p=a.elt;p.zip_listeners=!0,p.invalidate_pairs(),a=a.next}for(var s=null,o=l.listeners.head;null!=o;){var h=o.elt;if(n.precedence>h.precedence||n.precedence==h.precedence&&n.id>h.id)break;s=o,o=o.next}var _,u=l.listeners;null==Ei.zpp_pool?_=new Ei:(_=Ei.zpp_pool,Ei.zpp_pool=_.next,_.next=null),_.elt=n;var d=_;null==s?(d.next=u.head,u.head=d):(d.next=s.next,s.next=d),u.pushmod=u.modified=!0,u.length++;for(var c=l.cbsets.head;null!=c;){var x=c.elt;x.zip_listeners=!0,x.invalidate_pairs(),c=c.next}if(e)for(var v=l.interactors.head;null!=v;){var z=v.elt;z.wake(),v=v.next}t=t.next,i=i.next}else if(r.id>l.id){l.listeners.remove(n);for(var y=l.cbsets.head;null!=y;){var f=y.elt;f.zip_listeners=!0,f.invalidate_pairs(),y=y.next}for(var m=null,b=l.listeners.head;null!=b;){var g=b.elt;if(n.precedence>g.precedence||n.precedence==g.precedence&&n.id>g.id)break;m=b,b=b.next}var w,C=l.listeners;null==Ei.zpp_pool?w=new Ei:(w=Ei.zpp_pool,Ei.zpp_pool=w.next,w.next=null),w.elt=n;var M=w;null==m?(M.next=C.head,C.head=M):(M.next=m.next,m.next=M),C.pushmod=C.modified=!0,C.length++;for(var k=l.cbsets.head;null!=k;){var O=k.elt;O.zip_listeners=!0,O.invalidate_pairs(),k=k.next}if(e)for(var S=l.interactors.head;null!=S;){var P=S.elt;P.wake(),S=S.next}t=t.next}else{r.listeners.remove(n);for(var T=r.cbsets.head;null!=T;){var A=T.elt;A.zip_listeners=!0,A.invalidate_pairs(),T=T.next}for(var E=null,I=r.listeners.head;null!=I;){var V=I.elt;if(n.precedence>V.precedence||n.precedence==V.precedence&&n.id>V.id)break;E=I,I=I.next}var L,N=r.listeners;null==Ei.zpp_pool?L=new Ei:(L=Ei.zpp_pool,Ei.zpp_pool=L.next,L.next=null),L.elt=n;var D=L;null==E?(D.next=N.head,N.head=D):(D.next=E.next,E.next=D),N.pushmod=N.modified=!0,N.length++;for(var j=r.cbsets.head;null!=j;){var F=j.elt;F.zip_listeners=!0,F.invalidate_pairs(),j=j.next}if(e)for(var B=r.interactors.head;null!=B;){var R=B.elt;R.wake(),B=B.next}i=i.next}}for(;null!=t;){var G=t.elt;G.listeners.remove(n);for(var Y=G.cbsets.head;null!=Y;){var U=Y.elt;U.zip_listeners=!0,U.invalidate_pairs(),Y=Y.next}for(var Z=null,q=G.listeners.head;null!=q;){var W=q.elt;if(n.precedence>W.precedence||n.precedence==W.precedence&&n.id>W.id)break;Z=q,q=q.next}var X,H=G.listeners;null==Ei.zpp_pool?X=new Ei:(X=Ei.zpp_pool,Ei.zpp_pool=X.next,X.next=null),X.elt=n;var K=X;null==Z?(K.next=H.head,H.head=K):(K.next=Z.next,Z.next=K),H.pushmod=H.modified=!0,H.length++;for(var J=G.cbsets.head;null!=J;){var Q=J.elt;Q.zip_listeners=!0,Q.invalidate_pairs(),J=J.next}if(e)for(var $=G.interactors.head;null!=$;){var nn=$.elt;nn.wake(),$=$.next}t=t.next}for(;null!=i;){var en=i.elt;en.listeners.remove(n);for(var tn=en.cbsets.head;null!=tn;){var ln=tn.elt;ln.zip_listeners=!0,ln.invalidate_pairs(),tn=tn.next}for(var rn=null,an=en.listeners.head;null!=an;){var pn=an.elt;if(n.precedence>pn.precedence||n.precedence==pn.precedence&&n.id>pn.id)break;rn=an,an=an.next}var sn,on=en.listeners;null==Ei.zpp_pool?sn=new Ei:(sn=Ei.zpp_pool,Ei.zpp_pool=sn.next,sn.next=null),sn.elt=n;var hn=sn;null==rn?(hn.next=on.head,on.head=hn):(hn.next=rn.next,rn.next=hn),on.pushmod=on.modified=!0,on.length++;for(var _n=en.cbsets.head;null!=_n;){var un=_n.elt;un.zip_listeners=!0,un.invalidate_pairs(),_n=_n.next}if(e)for(var dn=en.interactors.head;null!=dn;){var cn=dn.elt;cn.wake(),dn=dn.next}i=i.next}}},cbtype_change1:function(n,e,t){this.cbtype_change(this.options1,n,e,t)},cbtype_change2:function(n,e,t){this.cbtype_change(this.options2,n,e,t)},cbtype_change:function(n,e,t,i){if(this.removedFromSpace(),t)if(i){for(var l=null,r=n.includes.head;null!=r;){var a=r.elt;if(a.id>e.id)break;l=r,r=r.next}var p,s=n.includes;null==ki.zpp_pool?p=new ki:(p=ki.zpp_pool,ki.zpp_pool=p.next,p.next=null),p.elt=e;var o=p;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else n.includes.remove(e);else if(i){for(var h=null,_=n.excludes.head;null!=_;){var u=_.elt;if(u.id>e.id)break;h=_,_=_.next}var d,c=n.excludes;null==ki.zpp_pool?d=new ki:(d=ki.zpp_pool,ki.zpp_pool=d.next,d.next=null),d.elt=e;var x=d;null==h?(x.next=c.head,c.head=x):(x.next=h.next,h.next=x),c.pushmod=c.modified=!0,c.length++}else n.excludes.remove(e);this.addedToSpace()},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:we});var Ce=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new ge,this.excludes=new ge};l["zpp_nape.callbacks.ZPP_OptionType"]=Ce,Ce.__name__=["zpp_nape","callbacks","ZPP_OptionType"],Ce.argument=function(n){return null==n?new N:y.__instanceof(n,N)?n:(new N).including(n)},Ce.prototype={outer:null,handler:null,includes:null,excludes:null,wrap_includes:null,wrap_excludes:null,setup_includes:function(){this.wrap_includes=dl.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=dl.get(this.excludes,!0)},excluded:function(n){return this.nonemptyintersection(n,this.excludes)},included:function(n){return this.nonemptyintersection(n,this.includes)},compatible:function(n){return!!this.nonemptyintersection(n,this.includes)&&!this.nonemptyintersection(n,this.excludes)},nonemptyintersection:function(n,e){for(var t=!1,i=n.head,l=e.head;null!=l&&null!=i;){var r=l.elt,a=i.elt;if(r==a){t=!0;break}a.id>r.id?l=l.next:i=i.next}return t},effect_change:function(n,e,t){if(e)if(t){for(var i=null,l=this.includes.head;null!=l;){var r=l.elt;if(r.id>n.id)break;i=l,l=l.next}var a,p=this.includes;null==ki.zpp_pool?a=new ki:(a=ki.zpp_pool,ki.zpp_pool=a.next,a.next=null),a.elt=n;var s=a;null==i?(s.next=p.head,p.head=s):(s.next=i.next,i.next=s),p.pushmod=p.modified=!0,p.length++}else this.includes.remove(n);else if(t){for(var o=null,h=this.excludes.head;null!=h;){var _=h.elt;if(_.id>n.id)break;o=h,h=h.next}var u,d=this.excludes;null==ki.zpp_pool?u=new ki:(u=ki.zpp_pool,ki.zpp_pool=u.next,u.next=null),u.elt=n;var c=u;null==o?(c.next=d.head,d.head=c):(c.next=o.next,o.next=c),d.pushmod=d.modified=!0,d.length++}else this.excludes.remove(n)},append_type:function(n,e){if(n==this.includes){if(!this.includes.has(e))if(this.excludes.has(e))null!=this.handler?this.handler(e,!1,!1):this.excludes.remove(e);else if(null!=this.handler)this.handler(e,!0,!0);else{for(var t=null,i=this.includes.head;null!=i;){var l=i.elt;if(l.id>e.id)break;t=i,i=i.next}var r,a=this.includes;null==ki.zpp_pool?r=new ki:(r=ki.zpp_pool,ki.zpp_pool=r.next,r.next=null),r.elt=e;var p=r;null==t?(p.next=a.head,a.head=p):(p.next=t.next,t.next=p),a.pushmod=a.modified=!0,a.length++}}else if(!this.excludes.has(e))if(this.includes.has(e))null!=this.handler?this.handler(e,!0,!1):this.includes.remove(e);else if(null!=this.handler)this.handler(e,!1,!0);else{for(var s=null,o=this.excludes.head;null!=o;){var h=o.elt;if(h.id>e.id)break;s=o,o=o.next}var _,u=this.excludes;null==ki.zpp_pool?_=new ki:(_=ki.zpp_pool,ki.zpp_pool=_.next,_.next=null),_.elt=e;var d=_;null==s?(d.next=u.head,u.head=d):(d.next=s.next,s.next=d),u.pushmod=u.modified=!0,u.length++}},set:function(n){if(n!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var e=n.excludes.head;null!=e;){this.append_type(this.excludes,e.elt),e=e.next}for(var t=n.includes.head;null!=t;){this.append_type(this.includes,t.elt),t=t.next}}return this},append:function(n,e){if(y.__instanceof(e,M)){this.append_type(n,e.zpp_inner)}else if(y.__instanceof(e,O)){var t=e;t.zpp_inner.valmod();for(var i=k.get(t);;){i.zpp_inner.zpp_inner.valmod();var l=i.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var r=l.zpp_inner.user_length;i.zpp_critical=!0;var a;if(r>i.zpp_i?a=!0:(i.zpp_next=k.zpp_pool,k.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);this.append_type(n,p.zpp_inner)}}else if(e instanceof Array&&null==e.__enum__)for(var s=e,o=0;s.length>o;){var h=s[o];++o,y.__instanceof(h,M);var _=h;this.append_type(n,_.zpp_inner)}},__class__:Ce};var Me=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=pe.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=Infinity,this.maxError=Infinity,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new ge};l["zpp_nape.constraint.ZPP_Constraint"]=Me,Me.__name__=["zpp_nape","constraint","ZPP_Constraint"],Me.prototype={outer:null,clear:function(){},id:null,userData:null,compound:null,space:null,active:null,stiff:null,frequency:null,damping:null,maxForce:null,maxError:null,breakUnderForce:null,breakUnderError:null,removeOnBreak:null,component:null,ignore:null,__velocity:null,immutable_midstep:function(n){},cbTypes:null,cbSet:null,wrap_cbTypes:null,setupcbTypes:function(){this.wrap_cbTypes=dl.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=t(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=t(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=t(this,this.immutable_cbTypes)},immutable_cbTypes:function(){this.immutable_midstep("Constraint::cbTypes")},wrap_cbTypes_subber:function(n){var e=n.zpp_inner;this.cbTypes.has(e)&&(null!=this.space&&(this.dealloc_cbSet(),e.constraints.remove(this)),this.cbTypes.remove(e),null!=this.space&&(this.alloc_cbSet(),this.wake()))},wrap_cbTypes_adder:function(n){return this.insert_cbtype(n.zpp_inner),!1},insert_cbtype:function(n){if(!this.cbTypes.has(n)){null!=this.space&&(this.dealloc_cbSet(),n.constraints.add(this));for(var e=null,t=this.cbTypes.head;null!=t;){if(t.elt.id>n.id)break;e=t,t=t.next}var i,l=this.cbTypes;null==ki.zpp_pool?i=new ki:(i=ki.zpp_pool,ki.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},dealloc_cbSet:function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;){n.cbTypes.pop_unsafe().cbsets.remove(n)}n.next=oe.zpp_pool,oe.zpp_pool=n}this.cbSet=null}},activate:function(){null!=this.space&&this.activeInSpace()},deactivate:function(){null!=this.space&&this.inactiveOrOutSpace()},addedToSpace:function(){this.active&&this.activeInSpace(),this.activeBodies();for(var n=this.cbTypes.head;null!=n;){n.elt.constraints.add(this),n=n.next}},removedFromSpace:function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var n=this.cbTypes.head;null!=n;){n.elt.constraints.remove(this),n=n.next}},activeInSpace:function(){this.alloc_cbSet(),null==Gt.zpp_pool?this.component=new Gt:(this.component=Gt.zpp_pool,Gt.zpp_pool=this.component.next,this.component.next=null);this.component.isBody=!1,this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var n=this.component;n.body=null,n.constraint=null,n.next=Gt.zpp_pool,Gt.zpp_pool=n,this.component=null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},validate:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(n,e){return!1},broken:function(){},warmStart:function(){},pre_dt:null,preStep:function(n){return!1},applyImpulseVel:function(){return!1},applyImpulsePos:function(){return!1},wake:function(){null!=this.space&&this.space.wake_constraint(this)},draw:function(n){},copy:function(n,e){return null},copyto:function(n){var e=this.outer;null==e.zpp_inner.wrap_cbTypes&&e.zpp_inner.setupcbTypes();var t=e.zpp_inner.wrap_cbTypes;t.zpp_inner.valmod();for(var i=k.get(t);;){i.zpp_inner.zpp_inner.valmod();var l=i.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var r=l.zpp_inner.user_length;i.zpp_critical=!0;var a;if(r>i.zpp_i?a=!0:(i.zpp_next=k.zpp_pool,k.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner.wrap_cbTypes&&n.zpp_inner.setupcbTypes();var s=n.zpp_inner.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(p):s.unshift(p)}n.zpp_inner.removeOnBreak=e.zpp_inner.removeOnBreak;var o=e.zpp_inner.breakUnderError;n.zpp_inner.breakUnderError!=o&&(n.zpp_inner.breakUnderError=o,n.zpp_inner.wake());var h=e.zpp_inner.breakUnderForce;n.zpp_inner.breakUnderForce!=h&&(n.zpp_inner.breakUnderForce=h,n.zpp_inner.wake());var _=e.zpp_inner.maxError;n.zpp_inner.maxError!=_&&(n.zpp_inner.maxError=_,n.zpp_inner.wake());var u=e.zpp_inner.maxForce;n.zpp_inner.maxForce!=u&&(n.zpp_inner.maxForce=u,n.zpp_inner.wake());var d=e.zpp_inner.damping;n.zpp_inner.damping!=d&&(n.zpp_inner.damping=d,n.zpp_inner.stiff||n.zpp_inner.wake());var c=e.zpp_inner.frequency;n.zpp_inner.frequency!=c&&(n.zpp_inner.frequency=c,n.zpp_inner.stiff||n.zpp_inner.wake());var x=e.zpp_inner.stiff;n.zpp_inner.stiff!=x&&(n.zpp_inner.stiff=x,n.zpp_inner.wake());var v=e.zpp_inner.ignore;n.zpp_inner.ignore!=v&&(n.zpp_inner.ignore=v,n.zpp_inner.wake());var z=e.zpp_inner.active;n.zpp_inner.active!=z&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.woken=!1),n.zpp_inner.clearcache(),z?(n.zpp_inner.active=z,n.zpp_inner.activate(),null!=n.zpp_inner.space&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.sleeping=!0),n.zpp_inner.space.wake_constraint(n.zpp_inner,!0))):(null!=n.zpp_inner.space&&(n.zpp_inner.wake(),n.zpp_inner.space.live_constraints.remove(n.zpp_inner)),n.zpp_inner.active=z,n.zpp_inner.deactivate()))},__class__:Me};var ke=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,Me.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=Infinity,this.stepped=!1};l["zpp_nape.constraint.ZPP_AngleJoint"]=ke,ke.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],ke.__super__=Me,ke.prototype=e(Me.prototype,{outer_zn:null,ratio:null,jointMin:null,jointMax:null,slack:null,equal:null,scale:null,is_slack:function(){var n,e=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(e-=this.jointMax,n=!1,this.scale=1):this.jointMin>e?(e=this.jointMin-e,this.scale=-1,n=!1):e>this.jointMax?(e-=this.jointMax,this.scale=1,n=!1):(this.scale=0,e=0,n=!0),n},bodyImpulse:function(n){return this.stepped?n==this.b1?Tn.get(0,0,-this.scale*this.jAcc):Tn.get(0,0,this.ratio*this.scale*this.jAcc):Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,b2:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var t=new R(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(t),null!=n&&null!=this.b1){for(var i=null,l=0;n.length>l;){var r=n[l];if(++l,r.id==this.b1.id){i=r.bc;break}}null!=i?t.zpp_inner_zn.b1=i.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){t.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var a=null,p=0;n.length>p;){var s=n[p];if(++p,s.id==this.b2.id){a=s.bc;break}}null!=a?t.zpp_inner_zn.b2=a.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){t.zpp_inner_zn.b2=n.zpp_inner}))}return t},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var t=this.ratio*this.b2.rot-this.b1.rot;this.equal?(t-=this.jointMax,this.slack=!1,this.scale=1):this.jointMin>t?(t=this.jointMin-t,this.scale=-1,this.slack=!1):t>this.jointMax?(t-=this.jointMax,this.scale=1,this.slack=!1):(this.scale=0,t=0,this.slack=!0);var i=t;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var l,r=2*Math.PI*this.frequency;this.gamma=1/(n*r*(2*this.damping+r*n));var a=1/(1+this.gamma);l=n*r*r*this.gamma,this.gamma*=a,this.kMass*=a,this.bias=-i*l,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},applyImpulseVel:function(){if(this.slack)return!1;var n=this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel),e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,t=this.jAcc;return this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),!(!this.breakUnderForce||this.jMax>=this.jAcc&&this.jAcc>=-this.jMax)||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:-this.jMax>this.jAcc&&(this.jAcc=-this.jMax)),e=this.jAcc-t,this.b1.angvel-=this.scale*this.b1.iinertia*e,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*e,!1)},applyImpulsePos:function(){var n,e,t,i=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(i-=this.jointMax,t=!1,this.scale=1):this.jointMin>i?(i=this.jointMin-i,this.scale=-1,t=!1):i>this.jointMax?(i-=this.jointMax,this.scale=1,t=!1):(this.scale=0,i=0,t=!0),n=i,!t){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(n*=.5,e=-n*this.kMass,this.equal||0>e){var l=this.b1,r=-this.scale*e*this.b1.iinertia;if(l.rot+=r,r*r>1e-4)l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot);else{var a=r*r,p=1-.5*a,s=1-a*a/8,o=(p*l.axisx+r*l.axisy)*s;l.axisy=(p*l.axisy-r*l.axisx)*s,l.axisx=o}var h=this.b2,_=this.ratio*this.scale*e*this.b2.iinertia;if(h.rot+=_,_*_>1e-4)h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot);else{var u=_*_,d=1-.5*u,c=1-u*u/8,x=(d*h.axisx+_*h.axisy)*c;h.axisy=(d*h.axisy-_*h.axisx)*c,h.axisx=x}}}return!1},draw:function(n){},__class__:ke});var Oe=function(){this.cb=null,this.bc=null,this.id=0};l["zpp_nape.constraint.ZPP_CopyHelper"]=Oe,Oe.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],Oe.dict=function(n,e){var t=new Oe;return t.id=n,t.bc=e,t},Oe.todo=function(n,e){var t=new Oe;return t.id=n,t.cb=e,t},Oe.prototype={id:null,bc:null,cb:null,__class__:Oe};var Se=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,Me.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=Infinity,this.stepped=!1,this.cx1=this.cx2=0};l["zpp_nape.constraint.ZPP_DistanceJoint"]=Se,Se.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],Se.__super__=Me,Se.prototype=e(Me.prototype,{outer_zn:null,jointMin:null,jointMax:null,slack:null,equal:null,is_slack:function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=0,t=0;e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),t=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var i=e*e+t*t;if(f.epsilon>i)e=0,t=0,i=0,n=!0;else{i=Math.sqrt(i);var l=1/i;e*=l,t*=l,this.equal?(i-=this.jointMax,n=!1):this.jointMin>i?(i=this.jointMin-i,e=-e,t=-t,n=!1):i>this.jointMax?(i-=this.jointMax,n=!1):(e=0,t=0,i=0,n=!0)}return n},nx:null,ny:null,cx1:null,cx2:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Tn.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):Tn.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,i=this.a1localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=t(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=t(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,i=this.a2localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=t(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=t(this,this.invalidate_a2)},wrap_a2:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var r=new U(null,null,i,l.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(r),null!=n&&null!=this.b1){for(var a=null,p=0;n.length>p;){var s=n[p];if(++p,s.id==this.b1.id){a=s.bc;break}}null!=a?r.zpp_inner_zn.b1=a.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){r.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,h=0;n.length>h;){var _=n[h];if(++h,_.id==this.b2.id){o=_.bc;break}}null!=o?r.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){r.zpp_inner_zn.b2=n.zpp_inner}))}return r},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var t=this.nx*this.nx+this.ny*this.ny;if(f.epsilon>t)this.nx=0,this.ny=0,t=0,this.slack=!0;else{t=Math.sqrt(t);var i=1/t;this.nx*=i,this.ny*=i,this.equal?(t-=this.jointMax,this.slack=!1):this.jointMin>t?(t=this.jointMin-t,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):t>this.jointMax?(t-=this.jointMax,this.slack=!1):(this.nx=0,this.ny=0,t=0,this.slack=!0)}var l=t;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&l*l>this.maxError*this.maxError)return!0;var r,a=2*Math.PI*this.frequency;this.gamma=1/(n*a*(2*this.damping+a*n));var p=1/(1+this.gamma);r=n*a*a*this.gamma,this.gamma*=p,this.kMass*=p,this.bias=-l*r,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.nx*n,this.b1.vely-=this.ny*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.nx*e,this.b2.vely+=this.ny*e,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc}},applyImpulseVel:function(){if(this.slack)return!1;var n=this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1,e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&-this.jMax>this.jAcc)return!0;this.stiff||-this.jMax>this.jAcc&&(this.jAcc=-this.jMax),e=this.jAcc-t;var i=this.b1.imass*e;this.b1.velx-=this.nx*i,this.b1.vely-=this.ny*i;var l=this.b2.imass*e;return this.b2.velx+=this.nx*l,this.b2.vely+=this.ny*l,this.b1.angvel-=this.cx1*this.b1.iinertia*e,this.b2.angvel+=this.cx2*this.b2.iinertia*e,!1},applyImpulsePos:function(){var n,e,t=0,i=0;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,r=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,r=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var a,p=0,s=0;p=this.b2.posx+l-(this.b1.posx+t),s=this.b2.posy+r-(this.b1.posy+i);var o=p*p+s*s;if(f.epsilon>o)p=0,s=0,o=0,a=!0;else{o=Math.sqrt(o);var h=1/o;p*=h,s*=h,this.equal?(o-=this.jointMax,a=!1):this.jointMin>o?(o=this.jointMin-o,p=-p,s=-s,a=!1):o>this.jointMax?(o-=this.jointMax,a=!1):(p=0,s=0,o=0,a=!0)}if(n=o,!a){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(f.constraintLinearSlop*f.constraintLinearSlop>n*n)return!1;if((n*=.5)*n>6){var _=this.b1.smass+this.b2.smass;if(_>f.epsilon&&(_=.75/_,e=-n*_,this.equal||0>e)){var u=e*this.b1.imass;this.b1.posx-=p*u,this.b1.posy-=s*u;var d=e*this.b2.imass;this.b2.posx+=p*d,this.b2.posy+=s*d,p=this.b2.posx+l-(this.b1.posx+t),s=this.b2.posy+r-(this.b1.posy+i);var c=p*p+s*s;if(f.epsilon>c)p=0,s=0,c=0,a=!0;else{c=Math.sqrt(c);var x=1/c;p*=x,s*=x,this.equal?(c-=this.jointMax,a=!1):this.jointMin>c?(c=this.jointMin-c,p=-p,s=-s,a=!1):c>this.jointMax?(c-=this.jointMax,a=!1):(p=0,s=0,c=0,a=!0)}n=c,n*=.5}}var v,z;v=s*t-p*i,z=s*l-p*r;var y=this.b1.smass+this.b2.smass+v*v*this.b1.sinertia+z*z*this.b2.sinertia;if(0!=y&&(y=1/y),e=-n*y,this.equal||0>e){var m=this.b1.imass*e;this.b1.posx-=p*m,this.b1.posy-=s*m;var b=this.b2.imass*e;this.b2.posx+=p*b,this.b2.posy+=s*b;var g=this.b1,w=-v*this.b1.iinertia*e;if(g.rot+=w,w*w>1e-4)g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot);else{var C=w*w,M=1-.5*C,k=1-C*C/8,O=(M*g.axisx+w*g.axisy)*k;g.axisy=(M*g.axisy-w*g.axisx)*k,g.axisx=O}var S=this.b2,P=z*this.b2.iinertia*e;if(S.rot+=P,P*P>1e-4)S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot);else{var T=P*P,A=1-.5*T,E=1-T*T/8,I=(A*S.axisx+P*S.axisy)*E;S.axisy=(A*S.axisy-P*S.axisx)*E,S.axisx=I}}}return!1},draw:function(n){},__class__:Se});var Pe=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,Me.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=Infinity,this.jointMin=-Infinity,this.jointMax=Infinity,this.stepped=!1};l["zpp_nape.constraint.ZPP_LineJoint"]=Pe,Pe.__name__=["zpp_nape","constraint","ZPP_LineJoint"],Pe.__super__=Me,Pe.prototype=e(Me.prototype,{outer_zn:null,scale:null,jointMin:null,jointMax:null,equal:null,dot1:null,dot2:null,cx1:null,cx2:null,bodyImpulse:function(n){if(this.stepped){var e=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,t=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return n==this.b1?Tn.get(-e,-t,this.scale*this.cx1*t-this.dot1*e):Tn.get(e,t,this.scale*this.cx1*t-this.dot1*e)}return Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,i=this.a1localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=t(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=t(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,i=this.a2localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=t(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=t(this,this.invalidate_a2)},wrap_a2:null,zip_n:null,nlocalx:null,nlocaly:null,nrelx:null,nrely:null,validate_n:function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},invalidate_n:function(n){this.immutable_midstep("Constraint::n"),this.nlocalx=n.x,this.nlocaly=n.y,this.zip_n=!0,this.wake()},setup_n:function(){var n,e=this.nlocalx,i=this.nlocaly;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_n=n,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=t(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=t(this,this.invalidate_n)},wrap_n:null,validate_norm:function(){if(this.zip_n){this.zip_n=!1;var n=this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly,e=1/Math.sqrt(n),t=e;this.nlocalx*=t,this.nlocaly*=t}},kMassa:null,kMassb:null,kMassc:null,jAccx:null,jAccy:null,jMax:null,gamma:null,biasx:null,biasy:null,stepped:null,copy:function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var r=l.zpp_inner_zn.wrap_a2,a=this.outer_zn;null==a.zpp_inner_zn.wrap_n&&a.zpp_inner_zn.setup_n();var p=new Z(null,null,i,r,a.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(p),null!=n&&null!=this.b1){for(var s=null,o=0;n.length>o;){var h=n[o];if(++o,h.id==this.b1.id){s=h.bc;break}}null!=s?p.zpp_inner_zn.b1=s.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var _=null,u=0;n.length>u;){var d=n[u];if(++u,d.id==this.b2.id){_=d.bc;break}}null!=_?p.zpp_inner_zn.b2=_.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t=0,i=0,l=0,r=0;t=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,i=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely,l=i*this.nrelx-t*this.nrely,r=this.nrelx*t+this.nrely*i,this.equal?(r-=this.jointMin,this.scale=1):r>this.jointMax?(r-=this.jointMax,this.scale=1):this.jointMin>r?(r=this.jointMin-r,this.scale=-1):(r=0,this.scale=0);var a=0,p=0;a=t+this.a1relx,p=i+this.a1rely,this.dot1=this.nrelx*a+this.nrely*p,this.cx1=p*this.nrelx-a*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);var s,o=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(o!=o)this.kMassa=this.kMassb=this.kMassc=0,s=3;else if(0==o){var h=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,h|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,h|=2),this.kMassb=0,s=h}else{o=1/o;var _=this.kMassc*o;this.kMassc=this.kMassa*o,this.kMassa=_,this.kMassb*=-o,s=0}if(0!=(1&s)&&(this.jAccx=0),0!=(2&s)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&l*l+r*r>this.maxError*this.maxError)return!0;var u,d=2*Math.PI*this.frequency;this.gamma=1/(n*d*(2*this.damping+d*n));var c=1/(1+this.gamma);u=n*d*d*this.gamma,this.gamma*=c;var x=c;this.kMassa*=x,this.kMassb*=x,this.kMassc*=x,this.biasx=l,this.biasy=r;var v=-u;this.biasx*=v,this.biasy*=v;var z=this.maxError,y=this.biasx*this.biasx+this.biasy*this.biasy;if(y>z*z){var f=z*(1/Math.sqrt(y));this.biasx*=f,this.biasy*=f}}var m=e;return this.jAccx*=m,this.jAccy*=m,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,t=this.b1.imass;this.b1.velx-=n*t,this.b1.vely-=e*t;var i=this.b2.imass;this.b2.velx+=n*i,this.b2.vely+=e*i,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0,t=0,i=0;t=this.b2.velx-this.b1.velx,i=this.b2.vely-this.b1.vely,t+=this.b2.kinvelx-this.b1.kinvelx,i+=this.b2.kinvely-this.b1.kinvely,n=i*this.nrelx-t*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,e=this.scale*(this.nrelx*t+this.nrely*i-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var l=0,r=0;l=this.biasx-n,r=this.biasy-e;var a=this.kMassa*l+this.kMassb*r;r=this.kMassb*l+this.kMassc*r,l=a;var p=this.gamma;l-=this.jAccx*p,r-=this.jAccy*p;var s=0,o=0;s=this.jAccx,o=this.jAccy;if(this.jAccx+=1*l,this.jAccy+=1*r,this.jAccy>0&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var h=this.jMax,_=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(_>h*h){var u=h*(1/Math.sqrt(_));this.jAccx*=u,this.jAccy*=u}}l=this.jAccx-s,r=this.jAccy-o;var d=this.scale*this.nrelx*r-this.nrely*l,c=this.nrelx*l+this.scale*this.nrely*r,x=this.b1.imass;this.b1.velx-=d*x,this.b1.vely-=c*x;var v=this.b2.imass;return this.b2.velx+=d*v,this.b2.vely+=c*v,this.b1.angvel+=(this.scale*this.cx1*r-this.dot1*l)*this.b1.iinertia,this.b2.angvel+=(this.dot2*l-this.scale*this.cx2*r)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,e=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy;var t=0,i=0;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,r=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,r=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var a,p=0,s=0,o=0,h=0;if(p=this.b2.posx+l-this.b1.posx-t,s=this.b2.posy+r-this.b1.posy-i,o=s*n-p*e,h=n*p+e*s,this.equal?(h-=this.jointMin,a=1):h>this.jointMax?(h-=this.jointMax,a=1):this.jointMin>h?(h=this.jointMin-h,a=-1):(h=0,a=0),this.breakUnderError&&o*o+h*h>this.maxError*this.maxError)return!0;if(f.constraintLinearSlop*f.constraintLinearSlop>o*o+h*h)return!1;var _=0,u=0;if(o*=.5,h*=.5,o*o+h*h>6){var d=this.b1.smass+this.b2.smass;if(d>f.epsilon){d=.8/d;var c=d*(e*o-a*n*h),x=d*(n*o*a-e*o),v=this.b1.imass;this.b1.posx-=c*v,this.b1.posy-=x*v;var z=this.b2.imass;this.b2.posx+=c*z,this.b2.posy+=x*z,p=this.b2.posx+l-this.b1.posx-t,s=this.b2.posy+r-this.b1.posy-i,o=s*n-p*e,h=n*p+e*s,this.equal?(h-=this.jointMin,a=1):h>this.jointMax?(h-=this.jointMax,a=1):this.jointMin>h?(h=this.jointMin-h,a=-1):(h=0,a=0);o*=.5,h*=.5}}var y,m,b,g,w=0,C=0,M=0,k=0,O=0;k=p+t,O=s+i,y=n*k+e*O,b=O*n-k*e,m=n*l+e*r,g=r*n-l*e,w=this.b1.smass+this.b2.smass+y*y*this.b1.sinertia+m*m*this.b2.sinertia,C=-a*(y*b*this.b1.sinertia+m*g*this.b2.sinertia),M=a*a*(this.b1.smass+this.b2.smass+b*b*this.b1.sinertia+g*g*this.b2.sinertia),_=-o,u=-h;var S=w*M-C*C;if(S!=S)u=0,_=u;else if(0==S)0!=w?_/=w:_=0,0!=M?u/=M:u=0;else{S=1/S;var P=S*(M*_-C*u);u=S*(w*u-C*_),_=P}u>0&&(u=0);var T=a*n*u-e*_,A=n*_+a*e*u,E=this.b1.imass;this.b1.posx-=T*E,this.b1.posy-=A*E;var I=this.b2.imass;this.b2.posx+=T*I,this.b2.posy+=A*I;var V=this.b1,L=(a*b*u-y*_)*this.b1.iinertia;if(V.rot+=L,L*L>1e-4)V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot);else{var N=L*L,D=1-.5*N,j=1-N*N/8,F=(D*V.axisx+L*V.axisy)*j;V.axisy=(D*V.axisy-L*V.axisx)*j,V.axisx=F}var B=this.b2,R=(m*_-a*g*u)*this.b2.iinertia;if(B.rot+=R,R*R>1e-4)B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot);else{var G=R*R,Y=1-.5*G,U=1-G*G/8,Z=(Y*B.axisx+R*B.axisy)*U;B.axisy=(Y*B.axisy-R*B.axisx)*U,B.axisx=Z}return!1},draw:function(n){},__class__:Pe});var Te=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,Me.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};l["zpp_nape.constraint.ZPP_MotorJoint"]=Te,Te.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],Te.__super__=Me,Te.prototype=e(Me.prototype,{outer_zn:null,ratio:null,rate:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Tn.get(0,0,-this.jAcc):Tn.get(0,0,this.ratio*this.jAcc):Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,b2:null,kMass:null,jAcc:null,jMax:null,stepped:null,copy:function(n,e){var t=new q(null,null,this.rate,this.ratio);if(this.copyto(t),null!=n&&null!=this.b1){for(var i=null,l=0;n.length>l;){var r=n[l];if(++l,r.id==this.b1.id){i=r.bc;break}}null!=i?t.zpp_inner_zn.b1=i.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){t.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var a=null,p=0;n.length>p;){var s=n[p];if(++p,s.id==this.b2.id){a=s.bc;break}}null!=a?t.zpp_inner_zn.b2=a.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){t.zpp_inner_zn.b2=n.zpp_inner}))}return t},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;return this.pre_dt=n,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=e,this.jMax=this.maxForce*n,!1},warmStart:function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},applyImpulseVel:function(){var n=this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate,e=-this.kMass*n,t=this.jAcc;if(this.jAcc+=e,this.breakUnderForce){if(this.jAcc>this.jMax||-this.jMax>this.jAcc)return!0}else-this.jMax>this.jAcc?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return e=this.jAcc-t,this.b1.angvel-=this.b1.iinertia*e,this.b2.angvel+=this.ratio*this.b2.iinertia*e,!1},applyImpulsePos:function(){return!1},__class__:Te});var Ae=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Me.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=Infinity,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};l["zpp_nape.constraint.ZPP_PivotJoint"]=Ae,Ae.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],Ae.__super__=Me,Ae.prototype=e(Me.prototype,{outer_zn:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Tn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):Tn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,i=this.a1localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=t(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=t(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,i=this.a2localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=t(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=t(this,this.invalidate_a2)},wrap_a2:null,kMassa:null,kMassb:null,kMassc:null,jAccx:null,jAccy:null,jMax:null,gamma:null,biasx:null,biasy:null,stepped:null,copy:function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var r=new W(null,null,i,l.zpp_inner_zn.wrap_a2);if(this.copyto(r),null!=n&&null!=this.b1){for(var a=null,p=0;n.length>p;){var s=n[p];if(++p,s.id==this.b1.id){a=s.bc;break}}null!=a?r.zpp_inner_zn.b1=a.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){r.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,h=0;n.length>h;){var _=n[h];if(++h,_.id==this.b2.id){o=_.bc;break}}null!=o?r.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){r.zpp_inner_zn.b2=n.zpp_inner}))}return r},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t=this.b1.smass+this.b2.smass;if(this.kMassa=t,this.kMassb=0,this.kMassc=t,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,l=this.a1rely*this.b1.sinertia;this.kMassa+=l*this.a1rely,this.kMassb+=-l*this.a1relx,this.kMassc+=i*this.a1relx}if(0!=this.b2.sinertia){var r=this.a2relx*this.b2.sinertia,a=this.a2rely*this.b2.sinertia;this.kMassa+=a*this.a2rely,this.kMassb+=-a*this.a2relx,this.kMassc+=r*this.a2relx}var p,s=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(s!=s)this.kMassa=this.kMassb=this.kMassc=0,p=3;else if(0==s){var o=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,o|=2),this.kMassb=0,p=o}else{s=1/s;var h=this.kMassc*s;this.kMassc=this.kMassa*s,this.kMassa=h,this.kMassb*=-s,p=0}if(0!=(1&p)&&(this.jAccx=0),0!=(2&p)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var _,u=2*Math.PI*this.frequency;this.gamma=1/(n*u*(2*this.damping+u*n));var d=1/(1+this.gamma);_=n*u*u*this.gamma,this.gamma*=d;var c=d;if(this.kMassa*=c,this.kMassb*=c,this.kMassc*=c,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;var x=-_;this.biasx*=x,this.biasy*=x;var v=this.maxError,z=this.biasx*this.biasx+this.biasy*this.biasy;if(z>v*v){var y=v*(1/Math.sqrt(z));this.biasx*=y,this.biasy*=y}}var f=e;return this.jAccx*=f,this.jAccy*=f,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel));var t=0,i=0;t=this.biasx-n,i=this.biasy-e;var l=this.kMassa*t+this.kMassb*i;i=this.kMassb*t+this.kMassc*i,t=l;var r=this.gamma;t-=this.jAccx*r,i-=this.jAccy*r;var a=0,p=0;a=this.jAccx,p=this.jAccy;if(this.jAccx+=1*t,this.jAccy+=1*i,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var s=this.jMax,o=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(o>s*s){var h=s*(1/Math.sqrt(o));this.jAccx*=h,this.jAccy*=h}}t=this.jAccx-a,i=this.jAccy-p;var _=this.b1.imass;this.b1.velx-=t*_,this.b1.vely-=i*_;var u=this.b2.imass;return this.b2.velx+=t*u,this.b2.vely+=i*u,this.b1.angvel-=(i*this.a1relx-t*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(i*this.a2relx-t*this.a2rely)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var t=0,i=0;t=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var l=0,r=0;if(l=this.b2.posx+t-(this.b1.posx+n),r=this.b2.posy+i-(this.b1.posy+e),this.breakUnderError&&l*l+r*r>this.maxError*this.maxError)return!0;if(f.constraintLinearSlop*f.constraintLinearSlop>l*l+r*r)return!1;l*=.5,r*=.5;var a=0,p=0;if(l*l+r*r>6){var s=this.b1.smass+this.b2.smass;if(s>f.epsilon){s=.75/s,a=-l*s,p=-r*s;var o=a*a+p*p;if(o>400){var h=1/Math.sqrt(o)*20;a*=h,p*=h}var _=this.b1.imass;this.b1.posx-=a*_,this.b1.posy-=p*_;var u=this.b2.imass;this.b2.posx+=a*u,this.b2.posy+=p*u,l=this.b2.posx+t-(this.b1.posx+n),r=this.b2.posy+i-(this.b1.posy+e);l*=.5,r*=.5}}var d=0,c=0,x=0,v=this.b1.smass+this.b2.smass;if(d=v,c=0,x=v,0!=this.b1.sinertia){var z=n*this.b1.sinertia,y=e*this.b1.sinertia;d+=y*e,c+=-y*n,x+=z*n}if(0!=this.b2.sinertia){var m=t*this.b2.sinertia,b=i*this.b2.sinertia;d+=b*i,c+=-b*t,x+=m*t}a=-l,p=-r;var g=a*a+p*p;if(g>36){var w=1/Math.sqrt(g)*6;a*=w,p*=w}var C=d*x-c*c;if(C!=C)p=0,a=p;else if(0==C)0!=d?a/=d:a=0,0!=x?p/=x:p=0;else{C=1/C;var M=C*(x*a-c*p);p=C*(d*p-c*a),a=M}var k=this.b1.imass;this.b1.posx-=a*k,this.b1.posy-=p*k;var O=this.b2.imass;this.b2.posx+=a*O,this.b2.posy+=p*O;var S=this.b1,P=-(p*n-a*e)*this.b1.iinertia;if(S.rot+=P,P*P>1e-4)S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot);else{var T=P*P,A=1-.5*T,E=1-T*T/8,I=(A*S.axisx+P*S.axisy)*E;S.axisy=(A*S.axisy-P*S.axisx)*E,S.axisx=I}var V=this.b2,L=(p*t-a*i)*this.b2.iinertia;if(V.rot+=L,L*L>1e-4)V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot);else{var N=L*L,D=1-.5*N,j=1-N*N/8,F=(D*V.axisx+L*V.axisy)*j;V.axisy=(D*V.axisy-L*V.axisx)*j,V.axisx=F}return!1},draw:function(n){},__class__:Ae});var Ee=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,Me.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=Infinity,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};l["zpp_nape.constraint.ZPP_PulleyJoint"]=Ee,Ee.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],Ee.__super__=Me,Ee.prototype=e(Me.prototype,{outer_zn:null,ratio:null,jointMin:null,jointMax:null,slack:null,equal:null,is_slack:function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var e=0,t=0,i=0,l=0,r=0,a=0,p=0,s=0;r=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),a=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),p=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),s=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var o=Math.sqrt(r*r+a*a),h=Math.sqrt(p*p+s*s);if(0!=o){var _=1/o;e=r*_,t=a*_}if(0!=h){var u=1/h;i=p*u,l=s*u;var d=this.ratio;i*=d,l*=d}else{var c=this.ratio/Math.sqrt(i*i+l*l);i*=c,l*=c}var x=o+this.ratio*h;return this.equal?(x-=this.jointMax,n=!1):this.jointMin>x?(x=this.jointMin-x,e=-e,t=-t,i=-i,l=-l,n=!1):x>this.jointMax?(x-=this.jointMax,n=!1):(e=0,t=0,i=0,l=0,x=0,n=!0),n},n12x:null,n12y:null,n34x:null,n34y:null,cx1:null,cx2:null,cx3:null,cx4:null,bodyImpulse:function(n){if(this.stepped){var e=Tn.get();if(n==this.b1){var t=e,i=t.zpp_inner;null!=i._validate&&i._validate(),t.zpp_inner.x=t.zpp_inner.x-this.jAcc*this.n12x;var l=t.zpp_inner;null!=l._validate&&l._validate();var r=e,a=r.zpp_inner;null!=a._validate&&a._validate(),r.zpp_inner.y=r.zpp_inner.y-this.jAcc*this.n12y;var p=r.zpp_inner;null!=p._validate&&p._validate();var s=e,o=s.zpp_inner;null!=o._validate&&o._validate(),s.zpp_inner.z=s.zpp_inner.z-this.cx1*this.jAcc;var h=s.zpp_inner;null!=h._validate&&h._validate()}if(n==this.b2){var _=e,u=_.zpp_inner;null!=u._validate&&u._validate(),_.zpp_inner.x=_.zpp_inner.x+this.jAcc*this.n12x;var d=_.zpp_inner;null!=d._validate&&d._validate();var c=e,x=c.zpp_inner;null!=x._validate&&x._validate(),c.zpp_inner.y=c.zpp_inner.y+this.jAcc*this.n12y;var v=c.zpp_inner;null!=v._validate&&v._validate();var z=e,y=z.zpp_inner;null!=y._validate&&y._validate(),z.zpp_inner.z=z.zpp_inner.z+this.cx2*this.jAcc;var f=z.zpp_inner;null!=f._validate&&f._validate()}if(n==this.b3){var m=e,b=m.zpp_inner;null!=b._validate&&b._validate(),m.zpp_inner.x=m.zpp_inner.x-this.jAcc*this.n34x;var g=m.zpp_inner;null!=g._validate&&g._validate();var w=e,C=w.zpp_inner;null!=C._validate&&C._validate(),w.zpp_inner.y=w.zpp_inner.y-this.jAcc*this.n34y;var M=w.zpp_inner;null!=M._validate&&M._validate();var k=e,O=k.zpp_inner;null!=O._validate&&O._validate(),k.zpp_inner.z=k.zpp_inner.z-this.cx3*this.jAcc;var S=k.zpp_inner;null!=S._validate&&S._validate()}if(n==this.b4){var P=e,T=P.zpp_inner;null!=T._validate&&T._validate(),P.zpp_inner.x=P.zpp_inner.x+this.jAcc*this.n34x;var A=P.zpp_inner;null!=A._validate&&A._validate();var E=e,I=E.zpp_inner;null!=I._validate&&I._validate(),E.zpp_inner.y=E.zpp_inner.y+this.jAcc*this.n34y;var V=E.zpp_inner;null!=V._validate&&V._validate();var L=e,N=L.zpp_inner;null!=N._validate&&N._validate(),L.zpp_inner.z=L.zpp_inner.z+this.cx4*this.jAcc;var D=L.zpp_inner;null!=D._validate&&D._validate()}return e}return Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,i=this.a1localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=t(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=t(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,i=this.a2localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=t(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=t(this,this.invalidate_a2)},wrap_a2:null,b3:null,a3localx:null,a3localy:null,a3relx:null,a3rely:null,validate_a3:function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},invalidate_a3:function(n){this.immutable_midstep("Constraint::a3"),this.a3localx=n.x,this.a3localy=n.y,this.wake()},setup_a3:function(){var n,e=this.a3localx,i=this.a3localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a3=n,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=t(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=t(this,this.invalidate_a3)},wrap_a3:null,b4:null,a4localx:null,a4localy:null,a4relx:null,a4rely:null,validate_a4:function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},invalidate_a4:function(n){this.immutable_midstep("Constraint::a4"),this.a4localx=n.x,this.a4localy=n.y,this.wake()},setup_a4:function(){var n,e=this.a4localx,i=this.a4localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a4=n,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=t(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=t(this,this.invalidate_a4)},wrap_a4:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var r=l.zpp_inner_zn.wrap_a2,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a3&&a.zpp_inner_zn.setup_a3();var p=a.zpp_inner_zn.wrap_a3,s=this.outer_zn;null==s.zpp_inner_zn.wrap_a4&&s.zpp_inner_zn.setup_a4();var o=new X(null,null,null,null,i,r,p,s.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(o),null!=n&&null!=this.b1){for(var h=null,_=0;n.length>_;){var u=n[_];if(++_,u.id==this.b1.id){h=u.bc;break}}null!=h?o.zpp_inner_zn.b1=h.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){o.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var d=null,c=0;n.length>c;){var x=n[c];if(++c,x.id==this.b2.id){d=x.bc;break}}null!=d?o.zpp_inner_zn.b2=d.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){o.zpp_inner_zn.b2=n.zpp_inner}))}if(null!=n&&null!=this.b3){for(var v=null,z=0;n.length>z;){var y=n[z];if(++z,y.id==this.b3.id){v=y.bc;break}}null!=v?o.zpp_inner_zn.b3=v.zpp_inner:e.push(Oe.todo(this.b3.id,function(n){o.zpp_inner_zn.b3=n.zpp_inner}))}if(null!=n&&null!=this.b4){for(var f=null,m=0;n.length>m;){var b=n[m];if(++m,b.id==this.b4.id){f=b.bc;break}}null!=f?o.zpp_inner_zn.b4=f.zpp_inner:e.push(Oe.todo(this.b4.id,function(n){o.zpp_inner_zn.b4=n.zpp_inner}))}return o},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake(),null!=this.b3&&this.b3.type==ye.id_BodyType_DYNAMIC&&this.b3.wake(),null!=this.b4&&this.b4.type==ye.id_BodyType_DYNAMIC&&this.b4.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}if(this.b3.type==ye.id_BodyType_DYNAMIC){var m;if(this.b3.component==this.b3.component.parent)m=this.b3.component;else{for(var b=this.b3.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var C=g.parent;g.parent=b,g=C}m=b}var M;if(this.component==this.component.parent)M=this.component;else{for(var k=this.component,O=null;k!=k.parent;){var S=k.parent;k.parent=O,O=k,k=S}for(;null!=O;){var P=O.parent;O.parent=k,O=P}M=k}m!=M&&(M.rank>m.rank?m.parent=M:m.rank>M.rank?M.parent=m:(M.parent=m,m.rank++))}if(this.b4.type==ye.id_BodyType_DYNAMIC){var T;if(this.b4.component==this.b4.component.parent)T=this.b4.component;else{for(var A=this.b4.component,E=null;A!=A.parent;){var I=A.parent;A.parent=E,E=A,A=I}for(;null!=E;){var V=E.parent;E.parent=A,E=V}T=A}var L;if(this.component==this.component.parent)L=this.component;else{for(var N=this.component,D=null;N!=N.parent;){var j=N.parent;N.parent=D,D=N,N=j}for(;null!=D;){var F=D.parent;D.parent=N,D=F}L=N}T!=L&&(L.rank>T.rank?T.parent=L:T.rank>L.rank?L.parent=T:(L.parent=T,T.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&(this.b2.id==e||this.b3.id==e||this.b4.id==e)||this.b2.id==n&&(this.b3.id==e||this.b4.id==e||this.b1.id==e)||this.b3.id==n&&(this.b4.id==e||this.b1.id==e||this.b2.id==e)||this.b4.id==n&&(this.b1.id==e||this.b2.id==e||this.b3.id==e)},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var t=0,i=0,l=0,r=0;t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),l=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),r=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var a=Math.sqrt(t*t+i*i),p=Math.sqrt(l*l+r*r);if(0!=a){var s=1/a;this.n12x=t*s,this.n12y=i*s}if(0!=p){var o=1/p;this.n34x=l*o,this.n34y=r*o;var h=this.ratio;this.n34x*=h,this.n34y*=h}else{var _=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y);this.n34x*=_,this.n34y*=_}var u=a+this.ratio*p;this.equal?(u-=this.jointMax,this.slack=!1):this.jointMin>u?(u=this.jointMin-u,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):u>this.jointMax?(u-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,this.n34y=0,u=0,this.slack=!0);var d=u;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;var c=this.ratio*this.ratio,x=this.b1.smass+this.b2.smass+c*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(x-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(x+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(x-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(x+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=x,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&d*d>this.maxError*this.maxError)return!0;var v,z=2*Math.PI*this.frequency;this.gamma=1/(n*z*(2*this.damping+z*n));var y=1/(1+this.gamma);v=n*z*z*this.gamma,this.gamma*=y,this.kMass*=y,this.bias=-d*v,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.n12x*n,this.b1.vely-=this.n12y*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.n12x*e,this.b2.vely+=this.n12y*e;var t=this.b3.imass*this.jAcc;this.b3.velx-=this.n34x*t,this.b3.vely-=this.n34y*t;var i=this.b4.imass*this.jAcc;this.b4.velx+=this.n34x*i,this.b4.vely+=this.n34y*i,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc}},applyImpulseVel:function(){if(this.slack)return!1;var n=this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3,e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,t=this.jAcc;if(this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&-this.jMax>this.jAcc)return!0;this.stiff||-this.jMax>this.jAcc&&(this.jAcc=-this.jMax),e=this.jAcc-t;var i=this.b1.imass*e;this.b1.velx-=this.n12x*i,this.b1.vely-=this.n12y*i;var l=this.b2.imass*e;this.b2.velx+=this.n12x*l,this.b2.vely+=this.n12y*l;var r=this.b3.imass*e;this.b3.velx-=this.n34x*r,this.b3.vely-=this.n34y*r;var a=this.b4.imass*e;return this.b4.velx+=this.n34x*a,this.b4.vely+=this.n34y*a,this.b1.angvel-=this.cx1*this.b1.iinertia*e,this.b2.angvel+=this.cx2*this.b2.iinertia*e,this.b3.angvel-=this.cx3*this.b3.iinertia*e,this.b4.angvel+=this.cx4*this.b4.iinertia*e,!1},applyImpulsePos:function(){var n,e,t=0,i=0;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,r=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,r=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var a=0,p=0;a=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,p=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy;var s=0,o=0;s=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,o=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var h,_=0,u=0,d=0,c=0;_=this.n12x,u=this.n12y,d=this.n34x,c=this.n34y;var x=0,v=0,z=0,y=0;x=this.b2.posx+l-(this.b1.posx+t),v=this.b2.posy+r-(this.b1.posy+i),z=this.b4.posx+s-(this.b3.posx+a),y=this.b4.posy+o-(this.b3.posy+p);var m=Math.sqrt(x*x+v*v),b=Math.sqrt(z*z+y*y);if(0!=m){var g=1/m;_=x*g,u=v*g}if(0!=b){var w=1/b;d=z*w,c=y*w;var C=this.ratio;d*=C,c*=C}else{var M=this.ratio/Math.sqrt(d*d+c*c);d*=M,c*=M}var k=m+this.ratio*b;if(this.equal?(k-=this.jointMax,h=!1):this.jointMin>k?(k=this.jointMin-k,_=-_,u=-u,d=-d,c=-c,h=!1):k>this.jointMax?(k-=this.jointMax,h=!1):(_=0,u=0,d=0,c=0,k=0,h=!0),n=k,!h){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(f.constraintLinearSlop*f.constraintLinearSlop>n*n)return!1;if((n*=.5)*n>6){var O=this.b1.smass+this.b2.smass;if(O>f.epsilon&&(O=.75/O,e=-n*O,this.equal||0>e)){var S=e*this.b1.imass;this.b1.posx-=_*S,this.b1.posy-=u*S;var P=e*this.b2.imass;this.b2.posx+=_*P,this.b2.posy+=u*P;var T=e*this.b3.imass;this.b3.posx-=d*T,this.b3.posy-=c*T;var A=e*this.b4.imass;this.b4.posx+=d*A,this.b4.posy+=c*A;var E=0,I=0,V=0,L=0;E=this.b2.posx+l-(this.b1.posx+t),I=this.b2.posy+r-(this.b1.posy+i),V=this.b4.posx+s-(this.b3.posx+a),L=this.b4.posy+o-(this.b3.posy+p);var N=Math.sqrt(E*E+I*I),D=Math.sqrt(V*V+L*L);if(0!=N){var j=1/N;_=E*j,u=I*j}if(0!=D){var F=1/D;d=V*F,c=L*F;var B=this.ratio;d*=B,c*=B}else{var R=this.ratio/Math.sqrt(d*d+c*c);d*=R,c*=R}var G=N+this.ratio*D;this.equal?(G-=this.jointMax,h=!1):this.jointMin>G?(G=this.jointMin-G,_=-_,u=-u,d=-d,c=-c,h=!1):G>this.jointMax?(G-=this.jointMax,h=!1):(_=0,u=0,d=0,c=0,G=0,h=!0),n=G,n*=.5}}var Y,U,Z,q;Y=u*t-_*i,U=u*l-_*r,Z=c*a-d*p,q=c*s-d*o;var W=this.ratio*this.ratio,X=this.b1.smass+this.b2.smass+W*(this.b3.smass+this.b4.smass)+this.b1.sinertia*Y*Y+this.b2.sinertia*U*U+this.b3.sinertia*Z*Z+this.b4.sinertia*q*q;this.b1==this.b4&&(X-=2*((_*d+u*c)*this.b1.smass+Y*q*this.b1.sinertia)),this.b1==this.b3&&(X+=2*((_*d+u*c)*this.b1.smass+Y*Z*this.b1.sinertia)),this.b2==this.b3&&(X-=2*((_*d+u*c)*this.b2.smass+U*Z*this.b2.sinertia)),this.b2==this.b4&&(X+=2*((_*d+u*c)*this.b2.smass+U*q*this.b2.sinertia));var H=X;if(0!=H&&(H=1/H),e=-n*H,this.equal||0>e){var K=this.b1.imass*e;this.b1.posx-=_*K,this.b1.posy-=u*K;var J=this.b2.imass*e;this.b2.posx+=_*J,this.b2.posy+=u*J;var Q=this.b3.imass*e;this.b3.posx-=d*Q,this.b3.posy-=c*Q;var $=this.b4.imass*e;this.b4.posx+=d*$,this.b4.posy+=c*$;var nn=this.b1,en=-Y*this.b1.iinertia*e;if(nn.rot+=en,en*en>1e-4)nn.axisx=Math.sin(nn.rot),nn.axisy=Math.cos(nn.rot);else{var tn=en*en,ln=1-.5*tn,rn=1-tn*tn/8,an=(ln*nn.axisx+en*nn.axisy)*rn;nn.axisy=(ln*nn.axisy-en*nn.axisx)*rn,nn.axisx=an}var pn=this.b2,sn=U*this.b2.iinertia*e;if(pn.rot+=sn,sn*sn>1e-4)pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot);else{var on=sn*sn,hn=1-.5*on,_n=1-on*on/8,un=(hn*pn.axisx+sn*pn.axisy)*_n;pn.axisy=(hn*pn.axisy-sn*pn.axisx)*_n,pn.axisx=un}var dn=this.b3,cn=-Z*this.b3.iinertia*e;if(dn.rot+=cn,cn*cn>1e-4)dn.axisx=Math.sin(dn.rot),dn.axisy=Math.cos(dn.rot);else{var xn=cn*cn,vn=1-.5*xn,zn=1-xn*xn/8,yn=(vn*dn.axisx+cn*dn.axisy)*zn;dn.axisy=(vn*dn.axisy-cn*dn.axisx)*zn,dn.axisx=yn}var fn=this.b4,mn=q*this.b4.iinertia*e;if(fn.rot+=mn,mn*mn>1e-4)fn.axisx=Math.sin(fn.rot),fn.axisy=Math.cos(fn.rot);else{var bn=mn*mn,gn=1-.5*bn,wn=1-bn*bn/8,Cn=(gn*fn.axisx+mn*fn.axisy)*wn;fn.axisy=(gn*fn.axisy-mn*fn.axisx)*wn,fn.axisx=Cn}}}return!1},draw:function(n){},__class__:Ee});var Ie=function(n,e){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,Me.call(this),this.bodies=[],this.dim=n,this.velonly=e,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=Tn.get(0,0,0);for(var t=0,i=n;i>t;){var l=t++;this.jAcc[l]=this.bias[l]=this.J[l]=this.jOld[l]=this.y[l]=0;for(var r=0,a=n;a>r;){this.L[l*n+r++]=0}}this.stepped=!1};l["zpp_nape.constraint.ZPP_UserConstraint"]=Ie,Ie.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],Ie.__super__=Me,Ie.prototype=e(Me.prototype,{outer_zn:null,bindVec2_invalidate:function(n){this.outer_zn.__invalidate()},bodies:null,dim:null,jAcc:null,bias:null,addBody:function(n){for(var e=null,t=0,i=this.bodies;i.length>t;){var l=i[t];if(++t,l.body==n){e=l;break}}null==e?(this.bodies.push(new Ve(1,n)),this.active&&null!=this.space&&null!=n&&n.constraints.add(this)):e.cnt++},remBody:function(n){for(var e=null,t=0|this.bodies.length,i=0;t>i;){var l=this.bodies[i];if(l.body==n){l.cnt--,0==l.cnt&&(t>0&&(this.bodies[i]=this.bodies[t-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=n&&n.constraints.remove(this)),e=l;break}++i}return null!=e},bodyImpulse:function(n){for(var e=0,t=this.dim;t>e;){var i=e++;this.J[i]=this.jAcc[i]}var l=Tn.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,n.outer,l),l},activeBodies:function(){for(var n=0,e=this.bodies;e.length>n;){var t=e[n];++n,null!=t.body&&t.body.constraints.add(this)}},inactiveBodies:function(){for(var n=0,e=this.bodies;e.length>n;){var t=e[n];++n,null!=t.body&&t.body.constraints.remove(this)}},stepped:null,copy:function(n,e){this.copyto(this.outer_zn.__copy())},validate:function(){for(var n=0,e=this.bodies;e.length>n;){++n}this.outer_zn.__validate()},wake_connected:function(){for(var n=0,e=this.bodies;e.length>n;){var t=e[n];++n,t.body.type==ye.id_BodyType_DYNAMIC&&t.body.wake()}},forest:function(){for(var n=0,e=this.bodies;e.length>n;){var t=e[n];if(++n,t.body.type==ye.id_BodyType_DYNAMIC){var i;if(t.body.component==t.body.component.parent)i=t.body.component;else{for(var l=t.body.component,r=null;l!=l.parent;){var a=l.parent;l.parent=r,r=l,l=a}for(;null!=r;){var p=r.parent;r.parent=l,r=p}i=l}var s;if(this.component==this.component.parent)s=this.component;else{for(var o=this.component,h=null;o!=o.parent;){var _=o.parent;o.parent=h,h=o,o=_}for(;null!=h;){var u=h.parent;h.parent=o,h=u}s=o}i!=s&&(s.rank>i.rank?i.parent=s:i.rank>s.rank?s.parent=i:(s.parent=i,i.rank++))}}},pair_exists:function(n,e){for(var t=!1,i=0|this.bodies.length,l=0,r=i;r>l;){for(var a=l++,p=this.bodies[a].body,s=a+1,o=i;o>s;){var h=s++,_=this.bodies[h].body;if(p.id==n&&_.id==e||p.id==e&&_.id==n){t=!0;break}}if(t)break}return t},broken:function(){this.outer_zn.__broken()},clearcache:function(){for(var n=0,e=this.dim;e>n;){this.jAcc[n++]=0}this.pre_dt=-1},lsq:function(n){for(var e=0,t=0,i=this.dim;i>t;){var l=t++;e+=n[l]*n[l]}return e},_clamp:function(n,e){var t=this.lsq(n);if(t>e*e)for(var i=e/Math.sqrt(t),l=0,r=this.dim;r>l;){var a=l++;n[a]*=i}},L:null,solve:function(n){for(var e=0,t=0,i=this.dim;i>t;){for(var l=t++,r=0,a=0,p=l-1;p>a;){var s=a++;r+=this.L[l*this.dim+s]*this.L[l*this.dim+s]}var o=Math.sqrt(n[e++]-r);if(this.L[l*this.dim+l]=o,0!=o){o=1/o;for(var h=l+1,_=this.dim;_>h;){for(var u=h++,d=0,c=0,x=l-1;x>c;){var v=c++;d+=this.L[u*this.dim+v]*this.L[l*this.dim+v]}this.L[u*this.dim+l]=o*(n[e++]-d)}}else{for(var z=l+1,y=this.dim;y>z;){this.L[z++*this.dim+l]=0}e+=this.dim-l-1}}return this.L},y:null,transform:function(n,e){for(var t=0,i=this.dim;i>t;){var l=t++,r=e[l],a=n[l*this.dim+l];if(0!=a){for(var p=0,s=l;s>p;){var o=p++;r-=n[l*this.dim+o]*this.y[o]}this.y[l]=r/a}else this.y[l]=0}for(var h=0,_=this.dim;_>h;){var u=h++,d=this.dim-1-u,c=n[d*this.dim+d];if(0!=c){for(var x=this.y[d],v=d+1,z=this.dim;z>v;){var y=v++;x-=n[y*this.dim+d]*e[y]}e[d]=x/c}else e[d]=0}},soft:null,gamma:null,velonly:null,jMax:null,Keff:null,preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;if(this.pre_dt=n,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var t=0,i=this.dim;i>t;){this.bias[t++]=0}this.gamma=0,this.soft=1}else{var l,r=2*Math.PI*this.frequency;this.gamma=1/(n*r*(2*this.damping+r*n));var a=1/(1+this.gamma);if(l=n*r*r*this.gamma,this.gamma*=a,this.soft=a,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var p=0,s=this.dim;s>p;){this.bias[p++]*=-l}this._clamp(this.bias,this.maxError)}for(var o=0,h=this.dim;h>o;){this.jAcc[o++]*=e}return this.jMax=this.maxForce*n,!1},vec3:null,warmStart:function(){for(var n=0,e=this.bodies;e.length>n;){var t=e[n];++n;var i=t.body;this.outer_zn.__impulse(this.jAcc,i.outer,this.vec3);var l=i.imass,r=i,a=r.velx,p=this.vec3,s=p.zpp_inner;null!=s._validate&&s._validate(),r.velx=a+p.zpp_inner.x*l;var o=i,h=o.vely,_=this.vec3,u=_.zpp_inner;null!=u._validate&&u._validate(),o.vely=h+_.zpp_inner.y*l;var d=i,c=d.angvel,x=this.vec3,v=x.zpp_inner;null!=v._validate&&v._validate(),d.angvel=c+x.zpp_inner.z*i.iinertia}},J:null,jOld:null,applyImpulseVel:function(){this.outer_zn.__velocity(this.J);for(var n=0,e=this.dim;e>n;){var t=n++;this.J[t]=this.bias[t]-this.J[t]}this.transform(this.L,this.J);for(var i=0,l=this.dim;l>i;){var r=i++;this.jOld[r]=this.jAcc[r],this.jAcc[r]+=this.J[r]=this.J[r]*this.soft-this.jAcc[r]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var a=0,p=this.dim;p>a;){var s=a++;this.J[s]=this.jAcc[s]-this.jOld[s]}for(var o=0,h=this.bodies;h.length>o;){var _=h[o];++o;var u=_.body;this.outer_zn.__impulse(this.J,u.outer,this.vec3);var d=u.imass,c=u,x=c.velx,v=this.vec3,z=v.zpp_inner;null!=z._validate&&z._validate(),c.velx=x+v.zpp_inner.x*d;var y=u,f=y.vely,m=this.vec3,b=m.zpp_inner;null!=b._validate&&b._validate(),y.vely=f+m.zpp_inner.y*d;var g=u,w=g.angvel,C=this.vec3,M=C.zpp_inner;null!=M._validate&&M._validate(),g.angvel=w+C.zpp_inner.z*u.iinertia}return!1},applyImpulsePos:function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var n=this.lsq(this.J);if(this.breakUnderError&&n>this.maxError*this.maxError)return!0;if(f.constraintLinearSlop*f.constraintLinearSlop>n)return!1;for(var e=0,t=this.dim;t>e;){this.J[e++]*=-1}this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var i=0,l=this.bodies;l.length>i;){var r=l[i];++i;var a=r.body;this.outer_zn.__impulse(this.J,a.outer,this.vec3);var p=a.imass,s=a,o=s.posx,h=this.vec3,_=h.zpp_inner;null!=_._validate&&_._validate(),s.posx=o+h.zpp_inner.x*p;var u=a,d=u.posy,c=this.vec3,x=c.zpp_inner;null!=x._validate&&x._validate(),u.posy=d+c.zpp_inner.y*p;var v=this.vec3,z=v.zpp_inner;null!=z._validate&&z._validate();var y=v.zpp_inner.z*a.iinertia;if(a.rot+=y,y*y>1e-4)a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot);else{var m=y*y,b=1-.5*m,g=1-m*m/8,w=(b*a.axisx+y*a.axisy)*g;a.axisy=(b*a.axisy-y*a.axisx)*g,a.axisx=w}}return!1},draw:function(n){this.outer_zn.__draw(n)},__class__:Ie});var Ve=function(n,e){this.body=null,this.cnt=0,this.cnt=n,this.body=e};l["zpp_nape.constraint.ZPP_UserBody"]=Ve,Ve.__name__=["zpp_nape","constraint","ZPP_UserBody"],Ve.prototype={cnt:null,body:null,__class__:Ve};var Le=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Me.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=Infinity,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};l["zpp_nape.constraint.ZPP_WeldJoint"]=Le,Le.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],Le.__super__=Me,Le.prototype=e(Me.prototype,{outer_zn:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Tn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):Tn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):Tn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,i=this.a1localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=t(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=t(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,i=this.a2localy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=t(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=t(this,this.invalidate_a2)},wrap_a2:null,phase:null,kMassa:null,kMassb:null,kMassd:null,kMassc:null,kMasse:null,kMassf:null,jAccx:null,jAccy:null,jAccz:null,jMax:null,gamma:null,biasx:null,biasy:null,biasz:null,stepped:null,copy:function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var r=new W(null,null,i,l.zpp_inner_zn.wrap_a2);if(this.copyto(r),null!=n&&null!=this.b1){for(var a=null,p=0;n.length>p;){var s=n[p];if(++p,s.id==this.b1.id){a=s.bc;break}}null!=a?r.zpp_inner_zn.b1=a.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){r.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,h=0;n.length>h;){var _=n[h];if(++h,_.id==this.b2.id){o=_.bc;break}}null!=o?r.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){r.zpp_inner_zn.b2=n.zpp_inner}))}return r},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==ye.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==ye.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==ye.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,t=null;e!=e.parent;){var i=e.parent;e.parent=t,t=e,e=i}for(;null!=t;){var l=t.parent;t.parent=e,t=l}n=e}var r;if(this.component==this.component.parent)r=this.component;else{for(var a=this.component,p=null;a!=a.parent;){var s=a.parent;a.parent=p,p=a,a=s}for(;null!=p;){var o=p.parent;p.parent=a,p=o}r=a}n!=r&&(r.rank>n.rank?n.parent=r:n.rank>r.rank?r.parent=n:(r.parent=n,n.rank++))}if(this.b2.type==ye.id_BodyType_DYNAMIC){var h;if(this.b2.component==this.b2.component.parent)h=this.b2.component;else{for(var _=this.b2.component,u=null;_!=_.parent;){var d=_.parent;_.parent=u,u=_,_=d}for(;null!=u;){var c=u.parent;u.parent=_,u=c}h=_}var x;if(this.component==this.component.parent)x=this.component;else{for(var v=this.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}h!=x&&(x.rank>h.rank?h.parent=x:h.rank>x.rank?x.parent=h:(x.parent=h,h.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t=this.b1.smass+this.b2.smass;if(this.kMassa=t,this.kMassb=0,this.kMassd=t,this.kMassc=0,this.kMasse=0,this.kMassf=0,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,l=this.a1rely*this.b1.sinertia;this.kMassa+=l*this.a1rely,this.kMassb+=-l*this.a1relx,this.kMassd+=i*this.a1relx,this.kMassc+=-l,this.kMasse+=i,this.kMassf+=this.b1.sinertia}if(0!=this.b2.sinertia){var r=this.a2relx*this.b2.sinertia,a=this.a2rely*this.b2.sinertia;this.kMassa+=a*this.a2rely,this.kMassb+=-a*this.a2relx,this.kMassd+=r*this.a2relx,this.kMassc+=-a,this.kMasse+=r,this.kMassf+=this.b2.sinertia}var p,s=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(s!=s)this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,p=7;else if(0==s){var o=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o|=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,o|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,o|=4),this.kMassb=this.kMassc=this.kMasse=0,p=o}else{s=1/s;var h=s*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),_=s*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),u=s*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),d=s*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),c=s*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),x=s*(this.kMassa*this.kMassd-this.kMassb*this.kMassb);this.kMassa=h,this.kMassb=_,this.kMassd=u,this.kMassc=d,this.kMasse=c,this.kMassf=x,p=0}if(0!=(1&p)&&(this.jAccx=0),0!=(2&p)&&(this.jAccy=0),0!=(4&p)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var v,z=2*Math.PI*this.frequency;this.gamma=1/(n*z*(2*this.damping+z*n));var y=1/(1+this.gamma);v=n*z*z*this.gamma,this.gamma*=y;var f=y;if(this.kMassa*=f,this.kMassb*=f,this.kMassd*=f,this.kMassc*=f,this.kMasse*=f,this.kMassf*=f,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;var m=-v,b=m;this.biasx*=b,this.biasy*=b,this.biasz*=m;var g=this.maxError,w=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;if(w>g*g){var C=g*(1/Math.sqrt(w)),M=C;this.biasx*=M,this.biasy*=M,this.biasz*=C}}var k=e,O=k;return this.jAccx*=O,this.jAccy*=O,this.jAccz*=k,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0,t=0;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel;var i=0,l=0,r=0;i=this.biasx-n,l=this.biasy-e,r=this.biasz-t;var a=this.kMassa*i+this.kMassb*l+this.kMassc*r,p=this.kMassb*i+this.kMassd*l+this.kMasse*r;r=this.kMassc*i+this.kMasse*l+this.kMassf*r,i=a,l=p;var s=this.gamma,o=s;i-=this.jAccx*o,l-=this.jAccy*o,r-=this.jAccz*s;var h=0,_=0,u=0;h=this.jAccx,_=this.jAccy,u=this.jAccz;if(this.jAccx+=1*i,this.jAccy+=1*l,this.jAccz+=1*r,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else if(!this.stiff){var d=this.jMax,c=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz;if(c>d*d){var x=d*(1/Math.sqrt(c)),v=x;this.jAccx*=v,this.jAccy*=v,this.jAccz*=x}}i=this.jAccx-h,l=this.jAccy-_,r=this.jAccz-u;var z=this.b1.imass;this.b1.velx-=i*z,this.b1.vely-=l*z;var y=this.b2.imass;return this.b2.velx+=i*y,this.b2.vely+=l*y,this.b1.angvel-=(l*this.a1relx-i*this.a1rely+r)*this.b1.iinertia,this.b2.angvel+=(l*this.a2relx-i*this.a2rely+r)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var t=0,i=0;t=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var l=0,r=0,a=0;l=this.b2.posx+t-(this.b1.posx+n),r=this.b2.posy+i-(this.b1.posy+e),a=this.b2.rot-this.b1.rot-this.phase;var p=0,s=0,o=0;if(this.breakUnderError&&l*l+r*r+a*a>this.maxError*this.maxError)return!0;var h=!0;f.constraintLinearSlop*f.constraintLinearSlop>l*l+r*r&&(h=!1,l=0,r=0);var _=f.constraintAngularSlop;if(_*_>a*a){if(!h)return!1;a=0}if(l*=.5,r*=.5,a*=.5,l*l+r*r>6){var u=this.b1.smass+this.b2.smass;if(u>f.epsilon){u=.75/u,p=-l*u,s=-r*u;var d=p*p+s*s;if(d>400){var c=1/Math.sqrt(d)*20;p*=c,s*=c}var x=this.b1.imass;this.b1.posx-=p*x,this.b1.posy-=s*x;var v=this.b2.imass;this.b2.posx+=p*v,this.b2.posy+=s*v,l=this.b2.posx+t-(this.b1.posx+n),r=this.b2.posy+i-(this.b1.posy+e),a=this.b2.rot-this.b1.rot-this.phase;l*=.5,r*=.5,a*=.5}}var z=0,y=0,m=0,b=0,g=0,w=0,C=this.b1.smass+this.b2.smass;if(z=C,y=0,m=C,b=0,g=0,w=0,0!=this.b1.sinertia){var M=n*this.b1.sinertia,k=e*this.b1.sinertia;z+=k*e,y+=-k*n,m+=M*n,b+=-k,g+=M,w+=this.b1.sinertia}if(0!=this.b2.sinertia){var O=t*this.b2.sinertia,S=i*this.b2.sinertia;z+=S*i,y+=-S*t,m+=O*t,b+=-S,g+=O,w+=this.b2.sinertia}p=-l,s=-r,o=-a;var P=p*p+s*s;if(P>36){var T=1/Math.sqrt(P)*6;p*=T,s*=T}if(-.25<=o);var A=z*(m*w-g*g)+y*(b*g-y*w)+b*(y*g-b*m);if(A!=A)o=0,s=o,p=s;else if(0==A)0!=z?p/=z:p=0,0!=m?s/=m:s=0,0!=w?o/=w:o=0;else{A=1/A;var E=g*b-y*w,I=y*g-b*m,V=y*b-z*g,L=A*(p*(m*w-g*g)+s*E+o*I),N=A*(p*E+s*(z*w-b*b)+o*V);o=A*(p*I+s*V+o*(z*m-y*y)),p=L,s=N}var D=this.b1.imass;this.b1.posx-=p*D,this.b1.posy-=s*D;var j=this.b2.imass;this.b2.posx+=p*j,this.b2.posy+=s*j;var F=this.b1,B=-(s*n-p*e+o)*this.b1.iinertia;if(F.rot+=B,B*B>1e-4)F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot);else{var R=B*B,G=1-.5*R,Y=1-R*R/8,U=(G*F.axisx+B*F.axisy)*Y;F.axisy=(G*F.axisy-B*F.axisx)*Y,F.axisx=U}var Z=this.b2,q=(s*t-p*i+o)*this.b2.iinertia;if(Z.rot+=q,q*q>1e-4)Z.axisx=Math.sin(Z.rot),Z.axisy=Math.cos(Z.rot);else{var W=q*q,X=1-.5*W,H=1-W*W/8,K=(X*Z.axisx+q*Z.axisy)*H;Z.axisy=(X*Z.axisy-q*Z.axisx)*H,Z.axisx=K}return!1},draw:function(n){},__class__:Le});var Ne=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};l["zpp_nape.dynamics.ZPP_Arbiter"]=Ne,Ne.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],Ne.prototype={outer:null,wrapper:function(){return null==this.outer&&(Ne.internal=!0,this.type==Ne.COL?(this.colarb.outer_zn=new en,this.outer=this.colarb.outer_zn):this.type==Ne.FLUID?(this.fluidarb.outer_zn=new an,this.outer=this.fluidarb.outer_zn):this.outer=new J,this.outer.zpp_inner=this,Ne.internal=!1),this.outer},inactiveme:function(){return!this.active},hnext:null,id:null,di:null,stamp:null,up_stamp:null,sleep_stamp:null,endGenerated:null,active:null,cleared:null,sleeping:null,present:null,intchange:null,presentable:null,continuous:null,fresh:null,immState:null,acting:function(){return!!this.active&&0!=(this.immState&ye.id_ImmState_ACCEPT)},invalidated:null,b1:null,b2:null,ws1:null,ws2:null,pair:null,swap_features:function(){var n=this.b1;this.b1=this.b2,this.b2=n;var e=this.ws1;this.ws1=this.ws2,this.ws2=e;var t=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=t},type:null,colarb:null,fluidarb:null,sensorarb:null,lazyRetire:function(n,e){if(this.cleared=!0,null==e||this.b2==e)for(var t=this.b1.arbiters,i=null,l=t.head;null!=l;){if(l.elt==this){var r,a;null==i?(r=t.head,a=r.next,null==(t.head=a)&&(t.pushmod=!0)):(r=i.next,a=r.next,i.next=a,null==a&&(t.pushmod=!0));var p=r;p.elt=null,p.next=Ni.zpp_pool,Ni.zpp_pool=p,t.modified=!0,t.length--,t.pushmod=!0,!0;break}i=l,l=l.next}if(null==e||this.b1==e)for(var s=this.b2.arbiters,o=null,h=s.head;null!=h;){if(h.elt==this){var _,u;null==o?(_=s.head,u=_.next,null==(s.head=u)&&(s.pushmod=!0)):(_=o.next,u=_.next,o.next=u,null==u&&(s.pushmod=!0));var d=_;d.elt=null,d.next=Ni.zpp_pool,Ni.zpp_pool=d,s.modified=!0,s.length--,s.pushmod=!0,!0;break}o=h,h=h.next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,n.f_arbiters.modified=!0},sup_assign:function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var l,r=this.b1.arbiters;null==Ni.zpp_pool?l=new Ni:(l=Ni.zpp_pool,Ni.zpp_pool=l.next,l.next=null),l.elt=this;var a=l;a.next=r.head,r.head=a,r.modified=!0,r.length++;var p,s=this.b2.arbiters;null==Ni.zpp_pool?p=new Ni:(p=Ni.zpp_pool,Ni.zpp_pool=p.next,p.next=null),p.elt=this;var o=p;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},sup_retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,l;null==e?(i=n.head,l=i.next,null==(n.head=l)&&(n.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(n.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=t,t=t.next}for(var a=this.b2.arbiters,p=null,s=a.head;null!=s;){if(s.elt==this){var o,h;null==p?(o=a.head,h=o.next,null==(a.head=h)&&(a.pushmod=!0)):(o=p.next,h=o.next,p.next=h,null==h&&(a.pushmod=!0));var _=o;_.elt=null,_.next=Ni.zpp_pool,Ni.zpp_pool=_,a.modified=!0,a.length--,a.pushmod=!0,!0;break}p=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},__class__:Ne};var De=function(){this.next=null,Ne.call(this),this.type=Ne.SENSOR,this.sensorarb=this};l["zpp_nape.dynamics.ZPP_SensorArbiter"]=De,De.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],De.__super__=Ne,De.prototype=e(Ne.prototype,{next:null,alloc:function(){},free:function(){},assign:function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var l,r=this.b1.arbiters;null==Ni.zpp_pool?l=new Ni:(l=Ni.zpp_pool,Ni.zpp_pool=l.next,l.next=null),l.elt=this;var a=l;a.next=r.head,r.head=a,r.modified=!0,r.length++;var p,s=this.b2.arbiters;null==Ni.zpp_pool?p=new Ni:(p=Ni.zpp_pool,Ni.zpp_pool=p.next,p.next=null),p.elt=this;var o=p;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,l;null==e?(i=n.head,l=i.next,null==(n.head=l)&&(n.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(n.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=t,t=t.next}for(var a=this.b2.arbiters,p=null,s=a.head;null!=s;){if(s.elt==this){var o,h;null==p?(o=a.head,h=o.next,null==(a.head=h)&&(a.pushmod=!0)):(o=p.next,h=o.next,p.next=h,null==h&&(a.pushmod=!0));var _=o;_.elt=null,_.next=Ni.zpp_pool,Ni.zpp_pool=_,a.modified=!0,a.length--,a.pushmod=!0,!0;break}p=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;var u=this;u.next=De.zpp_pool,De.zpp_pool=u},makemutable:function(){},makeimmutable:function(){},__class__:De});var je=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,Ne.call(this),this.type=Ne.FLUID,this.fluidarb=this,this.buoyx=0,this.buoyy=0,this.pre_dt=-1};l["zpp_nape.dynamics.ZPP_FluidArbiter"]=je,je.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],je.__super__=Ne,je.prototype=e(Ne.prototype,{outer_zn:null,next:null,alloc:function(){},free:function(){},centroidx:null,centroidy:null,overlap:null,r1x:null,r1y:null,r2x:null,r2y:null,nodrag:null,wMass:null,adamp:null,agamma:null,vMassa:null,vMassb:null,vMassc:null,dampx:null,dampy:null,lgamma:null,nx:null,ny:null,buoyx:null,buoyy:null,position_validate:function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},position_invalidate:function(n){this.centroidx=n.x,this.centroidy=n.y},wrap_position:null,getposition:function(){var n;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var e;null==Ct.zpp_pool?e=new Ct:(e=Ct.zpp_pool,Ct.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),0==n.zpp_inner.x){var a=n.zpp_inner;null!=a._validate&&a._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var p=n.zpp_inner;null!=p._invalidate&&p._invalidate(p)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=t(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=t(this,this.position_invalidate)},assign:function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var l,r=this.b1.arbiters;null==Ni.zpp_pool?l=new Ni:(l=Ni.zpp_pool,Ni.zpp_pool=l.next,l.next=null),l.elt=this;var a=l;a.next=r.head,r.head=a,r.modified=!0,r.length++;var p,s=this.b2.arbiters;null==Ni.zpp_pool?p=new Ni:(p=Ni.zpp_pool,Ni.zpp_pool=p.next,p.next=null),p.elt=this;var o=p;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,l;null==e?(i=n.head,l=i.next,null==(n.head=l)&&(n.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(n.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=t,t=t.next}for(var a=this.b2.arbiters,p=null,s=a.head;null!=s;){if(s.elt==this){var o,h;null==p?(o=a.head,h=o.next,null==(a.head=h)&&(a.pushmod=!0)):(o=p.next,h=o.next,p.next=h,null==h&&(a.pushmod=!0));var _=o;_.elt=null,_.next=Ni.zpp_pool,Ni.zpp_pool=_,a.modified=!0,a.length--,a.pushmod=!0,!0;break}p=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;var u=this;u.next=je.zpp_pool,je.zpp_pool=u,this.pre_dt=-1},mutable:null,makemutable:function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},makeimmutable:function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},inject:function(n,e,t){this.overlap=n,this.centroidx=e,this.centroidy=t},pre_dt:null,preStep:function(n,e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var i=0,l=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(i=this.ws1.fluidProperties.gravityx,l=this.ws1.fluidProperties.gravityy):(i=n.gravityx,l=n.gravityy);var r=0,a=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(r=this.ws2.fluidProperties.gravityx,a=this.ws2.fluidProperties.gravityy):(r=n.gravityx,a=n.gravityy);var p=0,s=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var o=this.overlap*this.ws1.fluidProperties.density,h=this.overlap*this.ws2.fluidProperties.density;if(o>h){var _=o+h;p-=i*_,s-=l*_}else if(h>o){var u=o+h;p+=r*u,s+=a*u}else{var d=0,c=0;d=i+r,c=l+a;if(d*=.5,c*=.5,this.ws1.worldCOMx*d+this.ws1.worldCOMy*c>this.ws2.worldCOMx*d+this.ws2.worldCOMy*c){var x=o+h;p-=d*x,s-=c*x}else{var v=o+h;p+=d*v,s+=c*v}}}else if(this.ws1.fluidEnabled){var z=this.overlap*this.ws1.fluidProperties.density,y=z;p-=i*y,s-=l*y}else if(this.ws2.fluidEnabled){var m=this.overlap*this.ws2.fluidProperties.density,b=m;p+=r*b,s+=a*b}var g=e;if(p*=g,s*=g,this.buoyx=p,this.buoyy=s,this.b1.type==ye.id_BodyType_DYNAMIC){var w=this.b1.imass;this.b1.velx-=p*w,this.b1.vely-=s*w,this.b1.angvel-=(s*this.r1x-p*this.r1y)*this.b1.iinertia}if(this.b2.type==ye.id_BodyType_DYNAMIC){var C=this.b2.imass;this.b2.velx+=p*C,this.b2.vely+=s*C,this.b2.angvel+=(s*this.r2x-p*this.r2y)*this.b2.iinertia}if(this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var M=0;if(this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),M+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),M+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=M){var k=this.b1.sinertia+this.b2.sinertia;this.wMass=0!=k?1/k:0;M*=4e-4;var O=2*Math.PI*M;this.agamma=1/(e*O*(2+O*e));var S=1/(1+this.agamma);e*O*O*this.agamma,this.agamma*=S,this.wMass*=S}else this.wMass=0,this.agamma=0;var P=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),T=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));if(f.epsilon*f.epsilon<=P*P+T*T){var A=P*P+T*T,E=1/Math.sqrt(A),I=E;P*=I,T*=I,this.nx=P,this.ny=T}var V=0;if(this.ws1.fluidEnabled){var L=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(this.ws2.type==ye.id_ShapeType_CIRCLE)V-=L*this.ws2.circle.radius*f.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var N=this.ws2.polygon,D=0,j=0,F=N.edges.head;null!=F;){var B=F.elt;D+=B.length;var R=L*B.length*(B.gnormx*this.nx+B.gnormy*this.ny);R>0&&(R*=-f.fluidVacuumDrag,R=R),j-=.5*R*f.fluidLinearDrag,F=F.next}V+=j/D}}if(this.ws2.fluidEnabled){var G=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(this.ws1.type==ye.id_ShapeType_CIRCLE)V-=G*this.ws1.circle.radius*f.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var Y=this.ws1.polygon,U=0,Z=0,q=Y.edges.head;null!=q;){var W=q.elt;U+=W.length;var X=G*W.length*(W.gnormx*this.nx+W.gnormy*this.ny);X>0&&(X*=-f.fluidVacuumDrag,X=X),Z-=.5*X*f.fluidLinearDrag,q=q.next}V+=Z/U}}if(0!=V){var H=this.b1.smass+this.b2.smass,K=0,J=0,Q=0;if(K=H,J=0,Q=H,0!=this.b1.sinertia){var $=this.r1x*this.b1.sinertia,nn=this.r1y*this.b1.sinertia;K+=nn*this.r1y,J+=-nn*this.r1x,Q+=$*this.r1x}if(0!=this.b2.sinertia){var en=this.r2x*this.b2.sinertia,tn=this.r2y*this.b2.sinertia;K+=tn*this.r2y,J+=-tn*this.r2x,Q+=en*this.r2x}var ln=K*Q-J*J;if(ln!=ln)Q=0,J=Q,K=J;else if(0==ln){var rn=0;0!=K?K=1/K:(K=0,rn|=1),0!=Q?Q=1/Q:(Q=0,rn|=2),J=0}else{ln=1/ln;var an=Q*ln;Q=K*ln,K=an,J*=-ln}this.vMassa=K,this.vMassb=J,this.vMassc=Q;var pn=2*Math.PI*V;this.lgamma=1/(e*pn*(2+pn*e));var sn=1/(1+this.lgamma);e*pn*pn*this.lgamma,this.lgamma*=sn;var on=sn;this.vMassa*=on,this.vMassb*=on,this.vMassc*=on}else this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;var hn=t;this.dampx*=hn,this.dampy*=hn,this.adamp*=t},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.dampx*n,this.b1.vely-=this.dampy*n;var e=this.b2.imass;this.b2.velx+=this.dampx*e,this.b2.vely+=this.dampy*e,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},applyImpulseVel:function(){if(!this.nodrag){var n=this.b1.angvel+this.b1.kinangvel,e=this.b2.angvel+this.b2.kinangvel,t=this.b1.velx+this.b1.kinvelx-this.r1y*n-(this.b2.velx+this.b2.kinvelx-this.r2y*e),i=this.b1.vely+this.b1.kinvely+this.r1x*n-(this.b2.vely+this.b2.kinvely+this.r2x*e),l=this.vMassa*t+this.vMassb*i;i=this.vMassb*t+this.vMassc*i,t=l;var r=this.lgamma;t-=this.dampx*r,i-=this.dampy*r;this.dampx+=1*t,this.dampy+=1*i;var a=this.b1.imass;this.b1.velx-=t*a,this.b1.vely-=i*a;var p=this.b2.imass;this.b2.velx+=t*p,this.b2.vely+=i*p,this.b1.angvel-=this.b1.iinertia*(i*this.r1x-t*this.r1y),this.b2.angvel+=this.b2.iinertia*(i*this.r2x-t*this.r2y);var s=(n-e)*this.wMass-this.adamp*this.agamma;this.adamp+=s,this.b1.angvel-=s*this.b1.iinertia,this.b2.angvel+=s*this.b2.iinertia}},__class__:je});var Fe=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,Ne.call(this),this.pre_dt=-1,this.contacts=new Be,this.innards=new Re,this.type=Ne.COL,this.colarb=this};l["zpp_nape.dynamics.ZPP_ColArbiter"]=Fe,Fe.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Fe.__super__=Ne,Fe.prototype=e(Ne.prototype,{outer_zn:null,dyn_fric:null,stat_fric:null,restitution:null,rfric:null,userdef_dyn_fric:null,userdef_stat_fric:null,userdef_restitution:null,userdef_rfric:null,s1:null,s2:null,contacts:null,wrap_contacts:null,innards:null,nx:null,ny:null,normal_validate:function(){this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},wrap_normal:null,getnormal:function(){var n;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var e;null==Ct.zpp_pool?e=new Ct:(e=Ct.zpp_pool,Ct.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),0==n.zpp_inner.x){var a=n.zpp_inner;null!=a._validate&&a._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var p=n.zpp_inner;null!=p._invalidate&&p._invalidate(p)}}n.zpp_inner.weak=!1,this.wrap_normal=n,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=t(this,this.normal_validate)},kMassa:null,kMassb:null,kMassc:null,Ka:null,Kb:null,Kc:null,rMass:null,jrAcc:null,rn1a:null,rt1a:null,rn1b:null,rt1b:null,rn2a:null,rt2a:null,rn2b:null,rt2b:null,k1x:null,k1y:null,k2x:null,k2y:null,surfacex:null,surfacey:null,ptype:null,lnormx:null,lnormy:null,lproj:null,radius:null,rev:null,biasCoef:null,__ref_edge1:null,__ref_edge2:null,__ref_vertex:null,c1:null,oc1:null,c2:null,oc2:null,hc2:null,hpc2:null,next:null,alloc:function(){},free:function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},stat:null,injectContact:function(n,e,t,i,l,r,a){null==a&&(a=!1);for(var p=null,s=this.contacts.next;null!=s;){var o=s;if(r==o.hash){p=o;break}s=s.next}if(null==p){null==Be.zpp_pool?p=new Be:(p=Be.zpp_pool,Be.zpp_pool=p.next,p.next=null);var h=p.inner;h.jnAcc=h.jtAcc=0,p.hash=r,p.fresh=!0,p.arbiter=this,this.jrAcc=0;var _=this.contacts;p._inuse=!0;var u=p;u.next=_.next,_.next=u,_.modified=!0,_.length++,this.innards.add(h)}else p.fresh=!1;return p.px=n,p.py=e,this.nx=t,this.ny=i,p.dist=l,p.stamp=this.stamp,p.posOnly=a,p},assign:function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var l,r=this.b1.arbiters;null==Ni.zpp_pool?l=new Ni:(l=Ni.zpp_pool,Ni.zpp_pool=l.next,l.next=null),l.elt=this;var a=l;a.next=r.head,r.head=a,r.modified=!0,r.length++;var p,s=this.b2.arbiters;null==Ni.zpp_pool?p=new Ni:(p=Ni.zpp_pool,Ni.zpp_pool=p.next,p.next=null),p.elt=this;var o=p;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=n,this.s2=e,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},calcProperties:function(){this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},validate_props:function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,l;null==e?(i=n.head,l=i.next,null==(n.head=l)&&(n.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(n.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=t,t=t.next}for(var a=this.b2.arbiters,p=null,s=a.head;null!=s;){if(s.elt==this){var o,h;null==p?(o=a.head,h=o.next,null==(a.head=h)&&(a.pushmod=!0)):(o=p.next,h=o.next,p.next=h,null==h&&(a.pushmod=!0));var _=o;_.elt=null,_.next=Ni.zpp_pool,Ni.zpp_pool=_,a.modified=!0,a.length--,a.pushmod=!0,!0;break}p=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var u=this.contacts,d=u.next;u.pop();var c=d;c.arbiter=null,c.next=Be.zpp_pool,Be.zpp_pool=c;var x=this.innards,v=x.next;x.next=v.next,v._inuse=!1,null==x.next&&(x.pushmod=!0),x.modified=!0,x.length--}var z=this;z.userdef_dyn_fric=!1,z.userdef_stat_fric=!1,z.userdef_restitution=!1,z.userdef_rfric=!1,z.__ref_edge1=z.__ref_edge2=null,z.next=Fe.zpp_pool,Fe.zpp_pool=z,this.pre_dt=-1},mutable:null,makemutable:function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},makeimmutable:function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},contacts_adder:function(n){},contacts_subber:function(n){for(var e=null,t=null,i=this.innards.next,l=this.contacts.next;null!=l;){var r=l;if(r==n.zpp_inner){this.contacts.erase(e),this.innards.erase(t);var a=r;a.arbiter=null,a.next=Be.zpp_pool,Be.zpp_pool=a;break}e=l,t=i,i=i.next,l=l.next}},setupcontacts:function(){this.wrap_contacts=gl.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=t(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=t(this,this.contacts_subber)},cleanupContacts:function(){var n=!0,e=null,t=null,i=this.innards.next;this.hc2=!1;for(var l=this.contacts.next;null!=l;){var r=l;if(r.stamp+f.arbiterExpirationDelay<this.stamp){var a,p,s=this.contacts;null==e?(a=s.next,p=a.next,null==(s.next=p)&&(s.pushmod=!0)):(a=e.next,p=a.next,e.next=p,null==p&&(s.pushmod=!0)),a._inuse=!1,s.modified=!0,s.length--,s.pushmod=!0,l=p;var o,h,_=this.innards;null==t?(o=_.next,h=o.next,null==(_.next=h)&&(_.pushmod=!0)):(o=t.next,h=o.next,t.next=h,null==h&&(_.pushmod=!0)),o._inuse=!1,_.modified=!0,_.length--,_.pushmod=!0,i=h;var u=r;u.arbiter=null,u.next=Be.zpp_pool,Be.zpp_pool=u}else{var d=r.inner,c=r.active;r.active=r.stamp==this.stamp,r.active&&(n?(n=!1,this.c1=d,this.oc1=r):(this.hc2=!0,this.c2=d,this.oc2=r)),c!=r.active&&(this.contacts.modified=!0),e=l,t=i,i=i.next,l=l.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var x=this.c1;this.c1=this.c2,this.c2=x;var v=this.oc1;this.oc1=this.oc2,this.oc2=v,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(n=!0)}else this.hpc2=!1;return n},pre_dt:null,preStep:function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n;var t=this.b1.smass+this.b2.smass;this.hc2=!1;var i=!0;this.biasCoef=this.b1.type!=ye.id_BodyType_DYNAMIC||this.b2.type!=ye.id_BodyType_DYNAMIC?this.continuous?f.contactContinuousStaticBiasCoef:f.contactStaticBiasCoef:this.continuous?f.contactContinuousBiasCoef:f.contactBiasCoef,this.continuous=!1;for(var l=null,r=null,a=this.innards.next,p=this.contacts.next;null!=p;){var s=p;if(s.stamp+f.arbiterExpirationDelay<this.stamp){var o,h,_=this.contacts;null==l?(o=_.next,h=o.next,null==(_.next=h)&&(_.pushmod=!0)):(o=l.next,h=o.next,l.next=h,null==h&&(_.pushmod=!0)),o._inuse=!1,_.modified=!0,_.length--,_.pushmod=!0,p=h;var u,d,c=this.innards;null==r?(u=c.next,d=u.next,null==(c.next=d)&&(c.pushmod=!0)):(u=r.next,d=u.next,r.next=d,null==d&&(c.pushmod=!0)),u._inuse=!1,c.modified=!0,c.length--,c.pushmod=!0,a=d;var x=s;x.arbiter=null,x.next=Be.zpp_pool,Be.zpp_pool=x}else{var v=s.inner,z=s.active;if(s.active=s.stamp==this.stamp){i?(i=!1,this.c1=v,this.oc1=s):(this.hc2=!0,this.c2=v,this.oc2=s),v.r2x=s.px-this.b2.posx,v.r2y=s.py-this.b2.posy,v.r1x=s.px-this.b1.posx,v.r1y=s.py-this.b1.posy;var y=v.r2x*this.nx+v.r2y*this.ny,m=t+this.b2.sinertia*(y*y),b=v.r1x*this.nx+v.r1y*this.ny;m+=this.b1.sinertia*(b*b),v.tMass=f.epsilon*f.epsilon>m?0:1/m;var g=this.ny*v.r2x-this.nx*v.r2y,w=t+this.b2.sinertia*(g*g),C=this.ny*v.r1x-this.nx*v.r1y;w+=this.b1.sinertia*(C*C),v.nMass=f.epsilon*f.epsilon>w?0:1/w;var M=0,k=0,O=this.b2.angvel+this.b2.kinangvel;M=this.b2.velx+this.b2.kinvelx-v.r2y*O,k=this.b2.vely+this.b2.kinvely+v.r2x*O,O=this.b1.angvel+this.b1.kinangvel,M-=this.b1.velx+this.b1.kinvelx-v.r1y*O,k-=this.b1.vely+this.b1.kinvely+v.r1x*O;var S=this.nx*M+this.ny*k;s.elasticity=this.restitution,v.bounce=S*s.elasticity,v.bounce>-f.elasticThreshold&&(v.bounce=0),S=k*this.nx-M*this.ny;var P=f.staticFrictionThreshold;v.friction=S*S>P*P?this.dyn_fric:this.stat_fric,v.jnAcc*=e,v.jtAcc*=e}z!=s.active&&(this.contacts.modified=!0),l=p,r=a,a=a.next,p=p.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var T=this.c1;this.c1=this.c2,this.c2=T;var A=this.oc1;this.oc1=this.oc2,this.oc2=A,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(i=!0)}else this.hpc2=!1;if(this.jrAcc*=e,i||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2){this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=t+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=t+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=t+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b;if(f.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)>this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc){this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc;var E=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(E!=E)this.kMassa=this.kMassb=this.kMassc=0;else if(0==E){var I=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,I|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,I|=2),this.kMassb=0}else{E=1/E;var V=this.kMassc*E;this.kMassc=this.kMassa*E,this.kMassa=V,this.kMassb*=-E}}else{if(this.hc2=!1,this.oc1.dist>this.oc2.dist){var L=this.c1;this.c1=this.c2,this.c2=L}this.oc2.active=!1,this.contacts.modified=!0}}this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely;return this.surfacex+=1*this.b1.svelx,this.surfacey+=1*this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),i},warmStart:function(){var n=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,e=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,t=this.b1.imass;this.b1.velx-=n*t,this.b1.vely-=e*t,this.b1.angvel-=this.b1.iinertia*(e*this.c1.r1x-n*this.c1.r1y);var i=this.b2.imass;if(this.b2.velx+=n*i,this.b2.vely+=e*i,this.b2.angvel+=this.b2.iinertia*(e*this.c1.r2x-n*this.c1.r2y),this.hc2){var l=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,r=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,a=this.b1.imass;this.b1.velx-=l*a,this.b1.vely-=r*a,this.b1.angvel-=this.b1.iinertia*(r*this.c2.r1x-l*this.c2.r1y);var p=this.b2.imass;this.b2.velx+=l*p,this.b2.vely+=r*p,this.b2.angvel+=this.b2.iinertia*(r*this.c2.r2x-l*this.c2.r2y)}this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},applyImpulseVel:function(){var n,e,t,i,l,r,a=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),p=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);if(t=(p*this.nx-a*this.ny+this.surfacex)*this.c1.tMass,i=this.c1.friction*this.c1.jnAcc,l=this.c1.jtAcc,r=l-t,r>i?r=i:-i>r&&(r=-i),t=r-l,this.c1.jtAcc=r,n=-this.ny*t,e=this.nx*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt1b*t*this.b2.iinertia,this.b1.angvel-=this.rt1a*t*this.b1.iinertia,this.hc2){var s=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),o=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);t=(o*this.nx-s*this.ny+this.surfacex)*this.c2.tMass,i=this.c2.friction*this.c2.jnAcc,l=this.c2.jtAcc,r=l-t,r>i?r=i:-i>r&&(r=-i),t=r-l,this.c2.jtAcc=r,n=-this.ny*t,e=this.nx*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt2b*t*this.b2.iinertia,this.b1.angvel-=this.rt2a*t*this.b1.iinertia,a=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),p=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),s=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),o=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);var h=this.c1.jnAcc,_=this.c2.jnAcc,u=a*this.nx+p*this.ny+this.surfacey+this.c1.bounce-(this.Ka*h+this.Kb*_),d=s*this.nx+o*this.ny+this.surfacey+this.c2.bounce-(this.Kb*h+this.Kc*_),c=-(this.kMassa*u+this.kMassb*d),x=-(this.kMassb*u+this.kMassc*d);0>c||0>x?(c=-this.c1.nMass*u,0>c||0>this.Kb*c+d?(x=-this.c2.nMass*d,0>x||0>this.Kb*x+u?0>u||0>d?(u=0,d=0):(u=-h,d=-_,this.c1.jnAcc=this.c2.jnAcc=0):(u=-h,d=x-_,this.c1.jnAcc=0,this.c2.jnAcc=x)):(u=c-h,d=-_,this.c1.jnAcc=c,this.c2.jnAcc=0)):(u=c-h,d=x-_,this.c1.jnAcc=c,this.c2.jnAcc=x),t=u+d,n=this.nx*t,e=this.ny*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=(this.rn1b*u+this.rn2b*d)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*u+this.rn2a*d)*this.b1.iinertia}else{if(0!=this.radius){t=(this.b2.angvel-this.b1.angvel)*this.rMass,i=this.rfric*this.c1.jnAcc,l=this.jrAcc,this.jrAcc-=t,this.jrAcc>i?this.jrAcc=i:-i>this.jrAcc&&(this.jrAcc=-i),t=this.jrAcc-l,this.b2.angvel+=t*this.b2.iinertia,this.b1.angvel-=t*this.b1.iinertia}a=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),p=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),t=(this.c1.bounce+(this.nx*a+this.ny*p)+this.surfacey)*this.c1.nMass,l=this.c1.jnAcc,r=l-t,0>r&&(r=0),t=r-l,this.c1.jnAcc=r,n=this.nx*t,e=this.ny*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rn1b*t*this.b2.iinertia,this.b1.angvel-=this.rn1a*t*this.b1.iinertia}},applyImpulsePos:function(){if(2==this.ptype){var n=this.c1,e=0,t=0;e=this.b2.axisy*n.lr2x-this.b2.axisx*n.lr2y,t=n.lr2x*this.b2.axisx+n.lr2y*this.b2.axisy;e+=1*this.b2.posx,t+=1*this.b2.posy;var i=0,l=0;i=this.b1.axisy*n.lr1x-this.b1.axisx*n.lr1y,l=n.lr1x*this.b1.axisx+n.lr1y*this.b1.axisy;i+=1*this.b1.posx,l+=1*this.b1.posy;var r=0,a=0;r=e-i,a=t-l;var p=Math.sqrt(r*r+a*a),s=this.radius-f.collisionSlop,o=p-s;if(0>r*this.nx+a*this.ny&&(r=-r,a=-a,o-=this.radius),0>o)if(f.epsilon>p)0!=this.b1.smass?this.b1.posx+=10*f.epsilon:this.b2.posx+=10*f.epsilon;else{var h=1/p;r*=h,a*=h;var _=.5*(i+e),u=.5*(l+t),d=p-s;i=_-this.b1.posx,l=u-this.b1.posy,e=_-this.b2.posx,t=u-this.b2.posy;var c=a*i-r*l,x=a*e-r*t,v=this.b2.smass+x*x*this.b2.sinertia+this.b1.smass+c*c*this.b1.sinertia;if(0!=v){var z=-this.biasCoef*d/v,y=0,m=0,b=z;y=r*b,m=a*b;var g=this.b1.imass;this.b1.posx-=y*g,this.b1.posy-=m*g;var w=this.b1,C=-c*this.b1.iinertia*z;if(w.rot+=C,C*C>1e-4)w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot);else{var M=C*C,k=1-.5*M,O=1-M*M/8,S=(k*w.axisx+C*w.axisy)*O;w.axisy=(k*w.axisy-C*w.axisx)*O,w.axisx=S}var P=this.b2.imass;this.b2.posx+=y*P,this.b2.posy+=m*P;var T=this.b2,A=x*this.b2.iinertia*z;if(T.rot+=A,A*A>1e-4)T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot);else{var E=A*A,I=1-.5*E,V=1-E*E/8,L=(I*T.axisx+A*T.axisy)*V;T.axisy=(I*T.axisy-A*T.axisx)*V,T.axisx=L}}}}else{var N,D=0,j=0,F=0,B=0,R=0,G=0;if(0==this.ptype){D=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,j=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,N=this.lproj+(D*this.b1.posx+j*this.b1.posy),F=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,B=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy;if(F+=1*this.b2.posx,B+=1*this.b2.posy,this.hpc2){R=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,G=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy;R+=1*this.b2.posx,G+=1*this.b2.posy}}else{D=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,j=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,N=this.lproj+(D*this.b2.posx+j*this.b2.posy),F=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,B=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy;if(F+=1*this.b1.posx,B+=1*this.b1.posy,this.hpc2){R=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,G=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy;R+=1*this.b1.posx,G+=1*this.b1.posy}}var Y=F*D+B*j-N-this.radius;Y+=f.collisionSlop;var U=0;if(this.hpc2&&(U=R*D+G*j-N-this.radius,U+=f.collisionSlop),0>Y||0>U){this.rev&&(D=-D,j=-j);var Z=0,q=0;Z=F-this.b1.posx,q=B-this.b1.posy;var W=0,X=0;W=F-this.b2.posx,X=B-this.b2.posy;var H=0,K=0,J=0,Q=0;if(this.hpc2){H=R-this.b1.posx,K=G-this.b1.posy,J=R-this.b2.posx,Q=G-this.b2.posy;var $=j*Z-D*q,nn=j*W-D*X,en=j*H-D*K,tn=j*J-D*Q,ln=this.b1.smass+this.b2.smass;this.kMassa=ln+this.b1.sinertia*$*$+this.b2.sinertia*nn*nn,this.kMassb=ln+this.b1.sinertia*$*en+this.b2.sinertia*nn*tn,this.kMassc=ln+this.b1.sinertia*en*en+this.b2.sinertia*tn*tn;var rn=0,an=0,pn=0;rn=this.kMassa,an=this.kMassb,pn=this.kMassc;for(var sn=Y*this.biasCoef,on=U*this.biasCoef;;){var hn=0,_n=0;hn=sn,_n=on,hn=-hn,_n=-_n;var un=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(un!=un)_n=0,hn=_n;else if(0==un)0!=this.kMassa?hn/=this.kMassa:hn=0,0!=this.kMassc?_n/=this.kMassc:_n=0;else{un=1/un;var dn=un*(this.kMassc*hn-this.kMassb*_n);_n=un*(this.kMassa*_n-this.kMassb*hn),hn=dn}if(hn>=0&&_n>=0){var cn=(hn+_n)*this.b1.imass;this.b1.posx-=D*cn,this.b1.posy-=j*cn;var xn=this.b1,vn=-this.b1.iinertia*($*hn+en*_n);if(xn.rot+=vn,vn*vn>1e-4)xn.axisx=Math.sin(xn.rot),xn.axisy=Math.cos(xn.rot);else{var zn=vn*vn,yn=1-.5*zn,fn=1-zn*zn/8,mn=(yn*xn.axisx+vn*xn.axisy)*fn;xn.axisy=(yn*xn.axisy-vn*xn.axisx)*fn,xn.axisx=mn}var bn=(hn+_n)*this.b2.imass;this.b2.posx+=D*bn,this.b2.posy+=j*bn;var gn=this.b2,wn=this.b2.iinertia*(nn*hn+tn*_n);if(gn.rot+=wn,wn*wn>1e-4)gn.axisx=Math.sin(gn.rot),gn.axisy=Math.cos(gn.rot);else{var Cn=wn*wn,Mn=1-.5*Cn,kn=1-Cn*Cn/8,On=(Mn*gn.axisx+wn*gn.axisy)*kn;gn.axisy=(Mn*gn.axisy-wn*gn.axisx)*kn,gn.axisx=On}break}hn=-sn/rn,_n=0;var Sn=an*hn+on;if(hn>=0&&Sn>=0){var Pn=(hn+_n)*this.b1.imass;this.b1.posx-=D*Pn,this.b1.posy-=j*Pn;var Tn=this.b1,An=-this.b1.iinertia*($*hn+en*_n);if(Tn.rot+=An,An*An>1e-4)Tn.axisx=Math.sin(Tn.rot),Tn.axisy=Math.cos(Tn.rot);else{var En=An*An,In=1-.5*En,Vn=1-En*En/8,Ln=(In*Tn.axisx+An*Tn.axisy)*Vn;Tn.axisy=(In*Tn.axisy-An*Tn.axisx)*Vn,Tn.axisx=Ln}var Nn=(hn+_n)*this.b2.imass;this.b2.posx+=D*Nn,this.b2.posy+=j*Nn;var Dn=this.b2,jn=this.b2.iinertia*(nn*hn+tn*_n);if(Dn.rot+=jn,jn*jn>1e-4)Dn.axisx=Math.sin(Dn.rot),Dn.axisy=Math.cos(Dn.rot);else{var Fn=jn*jn,Bn=1-.5*Fn,Rn=1-Fn*Fn/8,Gn=(Bn*Dn.axisx+jn*Dn.axisy)*Rn;Dn.axisy=(Bn*Dn.axisy-jn*Dn.axisx)*Rn,Dn.axisx=Gn}break}hn=0,_n=-on/pn;var Yn=an*_n+sn;if(_n>=0&&Yn>=0){var Un=(hn+_n)*this.b1.imass;this.b1.posx-=D*Un,this.b1.posy-=j*Un;var Zn=this.b1,qn=-this.b1.iinertia*($*hn+en*_n);if(Zn.rot+=qn,qn*qn>1e-4)Zn.axisx=Math.sin(Zn.rot),Zn.axisy=Math.cos(Zn.rot);else{var Wn=qn*qn,Xn=1-.5*Wn,Hn=1-Wn*Wn/8,Kn=(Xn*Zn.axisx+qn*Zn.axisy)*Hn;Zn.axisy=(Xn*Zn.axisy-qn*Zn.axisx)*Hn,Zn.axisx=Kn}var Jn=(hn+_n)*this.b2.imass;this.b2.posx+=D*Jn,this.b2.posy+=j*Jn;var Qn=this.b2,$n=this.b2.iinertia*(nn*hn+tn*_n);if(Qn.rot+=$n,$n*$n>1e-4)Qn.axisx=Math.sin(Qn.rot),Qn.axisy=Math.cos(Qn.rot);else{var ne=$n*$n,ee=1-.5*ne,te=1-ne*ne/8,ie=(ee*Qn.axisx+$n*Qn.axisy)*te;Qn.axisy=(ee*Qn.axisy-$n*Qn.axisx)*te,Qn.axisx=ie}break}break}}else{var le=j*Z-D*q,re=j*W-D*X,ae=this.b2.smass+re*re*this.b2.sinertia+this.b1.smass+le*le*this.b1.sinertia;if(0!=ae){var pe=-this.biasCoef*Y/ae,se=0,oe=0,he=pe;se=D*he,oe=j*he;var _e=this.b1.imass;this.b1.posx-=se*_e,this.b1.posy-=oe*_e;var ue=this.b1,de=-le*this.b1.iinertia*pe;if(ue.rot+=de,de*de>1e-4)ue.axisx=Math.sin(ue.rot),ue.axisy=Math.cos(ue.rot);else{var ce=de*de,xe=1-.5*ce,ve=1-ce*ce/8,ze=(xe*ue.axisx+de*ue.axisy)*ve;ue.axisy=(xe*ue.axisy-de*ue.axisx)*ve,ue.axisx=ze}var ye=this.b2.imass;this.b2.posx+=se*ye,this.b2.posy+=oe*ye;var fe=this.b2,me=re*this.b2.iinertia*pe;if(fe.rot+=me,me*me>1e-4)fe.axisx=Math.sin(fe.rot),fe.axisy=Math.cos(fe.rot);else{var be=me*me,ge=1-.5*be,we=1-be*be/8,Ce=(ge*fe.axisx+me*fe.axisy)*we;fe.axisy=(ge*fe.axisy-me*fe.axisx)*we,fe.axisx=Ce}}}}}},__class__:Fe});var Be=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new Re};l["zpp_nape.dynamics.ZPP_Contact"]=Be,Be.__name__=["zpp_nape","dynamics","ZPP_Contact"],Be.prototype={outer:null,wrapper:function(){return null==this.outer&&(Be.internal=!0,this.outer=new tn,Be.internal=!1,this.outer.zpp_inner=this),this.outer},px:null,py:null,position_validate:function(){this.inactiveme(),this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},wrap_position:null,getposition:function(){var n;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var e;null==Ct.zpp_pool?e=new Ct:(e=Ct.zpp_pool,Ct.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),0==n.zpp_inner.x){var a=n.zpp_inner;null!=a._validate&&a._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var p=n.zpp_inner;null!=p._invalidate&&p._invalidate(p)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=t(this,this.position_validate)},inactiveme:function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},arbiter:null,inner:null,active:null,posOnly:null,stamp:null,hash:null,fresh:null,dist:null,elasticity:null,free:function(){this.arbiter=null},alloc:function(){},next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},__class__:Be};var Re=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};l["zpp_nape.dynamics.ZPP_IContact"]=Re,Re.__name__=["zpp_nape","dynamics","ZPP_IContact"],Re.prototype={r1x:null,r1y:null,r2x:null,r2y:null,nMass:null,tMass:null,bounce:null,friction:null,jnAcc:null,jtAcc:null,lr1x:null,lr1y:null,lr2x:null,lr2y:null,next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},__class__:Re};var Ge=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ni,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};l["zpp_nape.dynamics.ZPP_InteractionFilter"]=Ge,Ge.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],Ge.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new pn;var n=this.outer.zpp_inner;n.outer=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new ni},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},copy:function(){var n;return null==Ge.zpp_pool?n=new Ge:(n=Ge.zpp_pool,Ge.zpp_pool=n.next,n.next=null),n.collisionGroup=this.collisionGroup,n.collisionMask=this.collisionMask,n.sensorGroup=this.sensorGroup,n.sensorMask=this.sensorMask,n.fluidGroup=this.fluidGroup,n.fluidMask=this.fluidMask,n},collisionGroup:null,collisionMask:null,shouldCollide:function(n){return 0!=(this.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&this.collisionGroup)},sensorGroup:null,sensorMask:null,shouldSense:function(n){return 0!=(this.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&this.sensorGroup)},fluidGroup:null,fluidMask:null,shouldFlow:function(n){return 0!=(this.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&this.fluidGroup)},invalidate:function(){for(var n=this.shapes.head;null!=n;){n.elt.invalidate_filter(),n=n.next}},__class__:Ge};var Ye=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new zi,this.interactors=new xe};l["zpp_nape.dynamics.ZPP_InteractionGroup"]=Ye,Ye.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],Ye.prototype={outer:null,ignore:null,group:null,setGroup:function(n){this.group!=n&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),this.group=n,null!=n?(n.groups.add(this),this.depth=n.depth+1,n.invalidate(!0)):this.invalidate(!0))},groups:null,wrap_groups:null,interactors:null,wrap_interactors:null,depth:null,invalidate:function(n){if(null==n&&(n=!1),n||this.ignore){for(var e=this.interactors.head;null!=e;){var t=e.elt;null!=t.ibody?t.ibody.wake():null!=t.ishape?t.ishape.body.wake():t.icompound.wake(),e=e.next}for(var i=this.groups.head;null!=i;){i.elt.invalidate(n),i=i.next}}},addGroup:function(n){this.groups.add(n),n.depth=this.depth+1},remGroup:function(n){this.groups.remove(n),n.depth=0},addInteractor:function(n){this.interactors.add(n)},remInteractor:function(n,e){null==e&&(e=-1),this.interactors.remove(n)},__class__:Ye};var Ue=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,$.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var n=0;4>n;){n++;this.lengths.push(0)}};l["zpp_nape.dynamics.ZPP_SpaceArbiterList"]=Ue,Ue.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],Ue.__super__=$,Ue.prototype=e($.prototype,{space:null,_length:null,zip_length:null,zpp_gl:function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=0,e=0,t=this.space.c_arbiters_true.head;null!=t;){t.elt.active&&++e,t=t.next}this.lengths[n++]=e,this._length+=e;for(var i=0,l=this.space.c_arbiters_false.head;null!=l;){l.elt.active&&++i,l=l.next}this.lengths[n++]=i,this._length+=i;for(var r=0,a=this.space.f_arbiters.head;null!=a;){a.elt.active&&++r,a=a.next}this.lengths[n++]=r,this._length+=r;for(var p=0,s=this.space.s_arbiters.head;null!=s;){s.elt.active&&++p,s=s.next}this.lengths[n++]=p,this._length+=p,this.zip_length=!1}return this._length},lengths:null,ite_0:null,ite_1:null,ite_2:null,ite_3:null,at_index_0:null,at_index_1:null,at_index_2:null,at_index_3:null,zpp_vm:function(){var n=!1;this.space.c_arbiters_true.modified&&(n=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(n=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(n=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(n=!0,this.space.s_arbiters.modified=!1),n&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},push:function(n){},pop:function(){},unshift:function(n){},shift:function(){},remove:function(n){},clear:function(){},at:function(n){this.zpp_vm(),0>n||this.zpp_gl();var e=null,t=0;if(null==e)if(t+this.lengths[0]>n){var i=n-t;if(this.at_index_0>i||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;;){var l=this.ite_0.elt;if(l.active)break;this.ite_0=this.ite_0.next}for(;this.at_index_0!=i;)for(this.at_index_0++,this.ite_0=this.ite_0.next;;){var r=this.ite_0.elt;if(r.active)break;this.ite_0=this.ite_0.next}e=this.ite_0.elt.wrapper()}else t+=this.lengths[0];if(null==e)if(t+this.lengths[1]>n){var a=n-t;if(this.at_index_1>a||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;;){var p=this.ite_1.elt;if(p.active)break;this.ite_1=this.ite_1.next}for(;this.at_index_1!=a;)for(this.at_index_1++,this.ite_1=this.ite_1.next;;){var s=this.ite_1.elt;if(s.active)break;this.ite_1=this.ite_1.next}e=this.ite_1.elt.wrapper()}else t+=this.lengths[1];if(null==e)if(t+this.lengths[2]>n){var o=n-t;if(this.at_index_2>o||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;;){var h=this.ite_2.elt;if(h.active)break;this.ite_2=this.ite_2.next}for(;this.at_index_2!=o;)for(this.at_index_2++,this.ite_2=this.ite_2.next;;){var _=this.ite_2.elt;if(_.active)break;this.ite_2=this.ite_2.next}e=this.ite_2.elt.wrapper()}else t+=this.lengths[2];if(null==e)if(t+this.lengths[3]>n){var u=n-t;if(this.at_index_3>u||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;;){var d=this.ite_3.elt;if(d.active)break;this.ite_3=this.ite_3.next}for(;this.at_index_3!=u;)for(this.at_index_3++,this.ite_3=this.ite_3.next;;){var c=this.ite_3.elt;if(c.active)break;this.ite_3=this.ite_3.next}e=this.ite_3.elt.wrapper()}else t+=this.lengths[3];return e},__class__:Ue});var Ze=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};l["zpp_nape.geom.ZPP_AABB"]=Ze,Ze.__name__=["zpp_nape","geom","ZPP_AABB"],Ze.get=function(n,e,t,i){var l;return null==Ze.zpp_pool?l=new Ze:(l=Ze.zpp_pool,Ze.zpp_pool=l.next,l.next=null),l.minx=n,l.miny=e,l.maxx=t,l.maxy=i,l},Ze.prototype={_invalidate:null,_validate:null,_immutable:null,validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},outer:null,wrapper:function(){if(null==this.outer){this.outer=new _n;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},next:null,alloc:function(){},free:function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},copy:function(){var n,e=this.minx,t=this.miny,i=this.maxx,l=this.maxy;return null==Ze.zpp_pool?n=new Ze:(n=Ze.zpp_pool,Ze.zpp_pool=n.next,n.next=null),n.minx=e,n.miny=t,n.maxx=i,n.maxy=l,n},width:function(){return this.maxx-this.minx},height:function(){return this.maxy-this.miny},perimeter:function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},minx:null,miny:null,wrap_min:null,getmin:function(){if(null==this.wrap_min){var n,e=this.minx,i=this.miny;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_min=n,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=t(this,this.mod_min),this.wrap_min.zpp_inner._validate=t(this,this.dom_min)}return this.wrap_min},dom_min:function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},mod_min:function(n){n.x==this.minx&&n.y==this.miny||(this.minx=n.x,this.miny=n.y,null!=this._invalidate&&this._invalidate(this))},maxx:null,maxy:null,wrap_max:null,getmax:function(){if(null==this.wrap_max){var n,e=this.maxx,i=this.maxy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_max=n,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=t(this,this.mod_max),this.wrap_max.zpp_inner._validate=t(this,this.dom_max)}return this.wrap_max},dom_max:function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},mod_max:function(n){n.x==this.maxx&&n.y==this.maxy||(this.maxx=n.x,this.maxy=n.y,null!=this._invalidate&&this._invalidate(this))},intersectX:function(n){return!(n.minx>this.maxx||this.minx>n.maxx)},intersectY:function(n){return!(n.miny>this.maxy||this.miny>n.maxy)},intersect:function(n){return!(n.miny>this.maxy||this.miny>n.maxy||n.minx>this.maxx)&&n.maxx>=this.minx},combine:function(n){this.minx>n.minx&&(this.minx=n.minx),n.maxx>this.maxx&&(this.maxx=n.maxx),this.miny>n.miny&&(this.miny=n.miny),n.maxy>this.maxy&&(this.maxy=n.maxy)},contains:function(n){return!(this.minx>n.minx||this.miny>n.miny||n.maxx>this.maxx)&&this.maxy>=n.maxy},containsPoint:function(n){return!(this.minx>n.x||n.x>this.maxx||this.miny>n.y)&&this.maxy>=n.y},setCombine:function(n,e){this.minx=e.minx>n.minx?n.minx:e.minx,this.miny=e.miny>n.miny?n.miny:e.miny,this.maxx=n.maxx>e.maxx?n.maxx:e.maxx,this.maxy=n.maxy>e.maxy?n.maxy:e.maxy},setExpand:function(n,e){this.minx=n.minx-e,this.miny=n.miny-e,this.maxx=n.maxx+e,this.maxy=n.maxy+e},setExpandPoint:function(n,e){this.minx>n&&(this.minx=n),n>this.maxx&&(this.maxx=n),this.miny>e&&(this.miny=e),e>this.maxy&&(this.maxy=e)},toString:function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:Ze};var qe=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Vec2"]=qe,qe.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],qe.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Hi.zpp_pool?e=new Hi:(e=Hi.zpp_pool,Hi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Hi.zpp_pool?e=new Hi:(e=Hi.zpp_pool,Hi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Hi.zpp_pool?t=new Hi:(t=Hi.zpp_pool,Hi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Hi.zpp_pool?t=new Hi:(t=Hi.zpp_pool,Hi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Hi.zpp_pool,Hi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Hi.zpp_pool,Hi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Hi.zpp_pool,Hi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Hi.zpp_pool,Hi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Hi.zpp_pool,Hi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Hi.zpp_pool,Hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Hi.zpp_pool,Hi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Hi.zpp_pool,Hi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Hi.zpp_pool,Hi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:qe};var We=function(){};l["zpp_nape.geom.ZPP_Collide"]=We,We.__name__=["zpp_nape","geom","ZPP_Collide"],We.circleContains=function(n,e){var t=0,i=0;return t=e.x-n.worldCOMx,i=e.y-n.worldCOMy,n.radius*n.radius>t*t+i*i},We.polyContains=function(n,e){var t;t=!0;for(var i=n.edges.head;null!=i;){var l=i.elt;if(l.gnormx*e.x+l.gnormy*e.y>l.gprojection){t=!1;break}i=i.next}return t},We.shapeContains=function(n,e){return n.type==ye.id_ShapeType_CIRCLE?We.circleContains(n.circle,e):We.polyContains(n.polygon,e)},We.bodyContains=function(n,e){var t;t=!1;for(var i=n.shapes.head;null!=i;){if(We.shapeContains(i.elt,e)){t=!0;break}i=i.next}return t},We.containTest=function(n,e){var t=n.aabb,i=e.aabb;if(t.minx>i.minx||t.miny>i.miny||i.maxx>t.maxx||i.maxy>t.maxy)return!1;if(n.type==ye.id_ShapeType_CIRCLE){if(e.type==ye.id_ShapeType_CIRCLE){var l=n.circle.radius+-e.circle.radius,r=0,a=0;r=e.circle.worldCOMx-n.circle.worldCOMx,a=e.circle.worldCOMy-n.circle.worldCOMy;return l*l>=r*r+a*a}var p;p=!0;for(var s=e.polygon.gverts.next;null!=s;){var o=s,h=n.circle.radius,_=0,u=0;_=o.x-n.circle.worldCOMx,u=o.y-n.circle.worldCOMy;if(_*_+u*u>h*h){p=!1;break}s=s.next}return p}if(e.type==ye.id_ShapeType_CIRCLE){var d;d=!0;for(var c=n.polygon.edges.head;null!=c;){var x=c.elt;if(x.gnormx*e.circle.worldCOMx+x.gnormy*e.circle.worldCOMy+e.circle.radius>x.gprojection){d=!1;break}c=c.next}return d}var v;v=!0;for(var z=n.polygon.edges.head;null!=z;){for(var y=z.elt,f=-1e100,m=e.polygon.gverts.next;null!=m;){var b=m,g=y.gnormx*b.x+y.gnormy*b.y;g>f&&(f=g),m=m.next}if(f>y.gprojection){v=!1;break}z=z.next}return v},We.contactCollide=function(n,e,t,i){if(e.type==ye.id_ShapeType_POLYGON){if(n.type==ye.id_ShapeType_POLYGON){for(var l=!0,r=-1e100,a=-1,p=null,s=null,o=n.polygon.edges.head;null!=o;){for(var h=o.elt,_=1e100,u=e.polygon.gverts.next;null!=u;){var d=u,c=h.gnormx*d.x+h.gnormy*d.y;if(_>c&&(_=c),r>=_-h.gprojection)break;u=u.next}if((_-=h.gprojection)>=0){l=!1;break}_>r&&(r=_,p=h,a=1),o=o.next}if(l){for(var x=e.polygon.edges.head;null!=x;){for(var v=x.elt,z=1e100,y=n.polygon.gverts.next;null!=y;){var m=y,b=v.gnormx*m.x+v.gnormy*m.y;if(z>b&&(z=b),r>=z-v.gprojection)break;y=y.next}if((z-=v.gprojection)>=0){l=!1;break}z>r&&(r=z,s=v,a=2),x=x.next}if(l){var g,w,C;1==a?(n.polygon,g=e.polygon,w=p,C=1):(e.polygon,g=n.polygon,w=s,C=-1);for(var M=null,k=1e100,O=g.edges.head;null!=O;){var S=O.elt,P=w.gnormx*S.gnormx+w.gnormy*S.gnormy;k>P&&(k=P,M=S),O=O.next}var T=0,A=0;T=M.gp0.x,A=M.gp0.y;var E=0,I=0;E=M.gp1.x,I=M.gp1.y;var V=0,L=0;V=E-T,L=I-A;var N=w.gnormy*T-w.gnormx*A,D=w.gnormy*E-w.gnormx*I,j=1/(D-N),F=(-w.tp1-N)*j;if(F>f.epsilon){var B=F;T+=V*B,A+=L*B}var R=(-w.tp0-D)*j;if(-f.epsilon>R){var G=R;E+=V*G,I+=L*G}var Y=0,U=0,Z=C;Y=w.gnormx*Z,U=w.gnormy*Z,t.lnormx=w.lnormx,t.lnormy=w.lnormy,t.lproj=w.lprojection,t.radius=0,t.rev=i!=(-1==C),t.ptype=t.rev?1:0;var q=T*w.gnormx+A*w.gnormy-w.gprojection,W=E*w.gnormx+I*w.gnormy-w.gprojection;if(q>0&&W>0)return!1;i&&(Y=-Y,U=-U);for(var X=T-w.gnormx*q*.5,H=A-w.gnormy*q*.5,K=t.rev?1:0,J=null,Q=t.contacts.next;null!=Q;){var $=Q;if(K==$.hash){J=$;break}Q=Q.next}if(null==J){null==Be.zpp_pool?J=new Be:(J=Be.zpp_pool,Be.zpp_pool=J.next,J.next=null);var nn=J.inner;nn.jnAcc=nn.jtAcc=0,J.hash=K,J.fresh=!0,J.arbiter=t,t.jrAcc=0;var en=t.contacts;J._inuse=!0;var tn=J;tn.next=en.next,en.next=tn,en.modified=!0,en.length++,t.innards.add(nn)}else J.fresh=!1;J.px=X,J.py=H,t.nx=Y,t.ny=U,J.dist=q,J.stamp=t.stamp,J.posOnly=q>0;var ln=J;T-=1*g.body.posx,A-=1*g.body.posy,ln.inner.lr1x=T*g.body.axisy+A*g.body.axisx,ln.inner.lr1y=A*g.body.axisy-T*g.body.axisx;for(var rn=E-w.gnormx*W*.5,an=I-w.gnormy*W*.5,pn=t.rev?0:1,sn=null,on=t.contacts.next;null!=on;){var hn=on;if(pn==hn.hash){sn=hn;break}on=on.next}if(null==sn){null==Be.zpp_pool?sn=new Be:(sn=Be.zpp_pool,Be.zpp_pool=sn.next,sn.next=null);var _n=sn.inner;_n.jnAcc=_n.jtAcc=0,sn.hash=pn,sn.fresh=!0,sn.arbiter=t,t.jrAcc=0;var un=t.contacts;sn._inuse=!0;var dn=sn;dn.next=un.next,un.next=dn,un.modified=!0,un.length++,t.innards.add(_n)}else sn.fresh=!1;sn.px=rn,sn.py=an,t.nx=Y,t.ny=U,sn.dist=W,sn.stamp=t.stamp,sn.posOnly=W>0,ln=sn;return E-=1*g.body.posx,I-=1*g.body.posy,ln.inner.lr1x=E*g.body.axisy+I*g.body.axisx,ln.inner.lr1y=I*g.body.axisy-E*g.body.axisx,1==a?(t.__ref_edge1=w,t.__ref_edge2=M):(t.__ref_edge2=w,t.__ref_edge1=M),!0}return!1}return!1}for(var cn=-1e100,xn=!0,vn=null,zn=null,yn=e.polygon.gverts.next,fn=e.polygon.edges.head;null!=fn;){var mn=fn.elt,bn=mn.gnormx*n.circle.worldCOMx+mn.gnormy*n.circle.worldCOMy-mn.gprojection-n.circle.radius;if(bn>0){xn=!1;break}bn>cn&&(cn=bn,vn=mn,zn=yn),yn=yn.next,fn=fn.next}if(xn){var gn=zn,wn=null==zn.next?e.polygon.gverts.next:zn.next,Cn=n.circle.worldCOMy*vn.gnormx-n.circle.worldCOMx*vn.gnormy;if(Cn>gn.y*vn.gnormx-gn.x*vn.gnormy){if(wn.y*vn.gnormx-wn.x*vn.gnormy>Cn){var Mn=0,kn=0,On=n.circle.radius+.5*cn;Mn=vn.gnormx*On,kn=vn.gnormy*On;var Sn=0,Pn=0;Sn=n.circle.worldCOMx-Mn,Pn=n.circle.worldCOMy-kn;var Tn;if(i){for(var An=vn.gnormx,En=vn.gnormy,In=null,Vn=t.contacts.next;null!=Vn;){var Ln=Vn;if(0==Ln.hash){In=Ln;break}Vn=Vn.next}if(null==In){null==Be.zpp_pool?In=new Be:(In=Be.zpp_pool,Be.zpp_pool=In.next,In.next=null);var Nn=In.inner;Nn.jnAcc=Nn.jtAcc=0,In.hash=0,In.fresh=!0,In.arbiter=t,t.jrAcc=0;var Dn=t.contacts;In._inuse=!0;var jn=In;jn.next=Dn.next,Dn.next=jn,Dn.modified=!0,Dn.length++,t.innards.add(Nn)}else In.fresh=!1;In.px=Sn,In.py=Pn,t.nx=An,t.ny=En,In.dist=cn,In.stamp=t.stamp,In.posOnly=!1,Tn=In}else{for(var Fn=-vn.gnormx,Bn=-vn.gnormy,Rn=null,Gn=t.contacts.next;null!=Gn;){var Yn=Gn;if(0==Yn.hash){Rn=Yn;break}Gn=Gn.next}if(null==Rn){null==Be.zpp_pool?Rn=new Be:(Rn=Be.zpp_pool,Be.zpp_pool=Rn.next,Rn.next=null);var Un=Rn.inner;Un.jnAcc=Un.jtAcc=0,Rn.hash=0,Rn.fresh=!0,Rn.arbiter=t,t.jrAcc=0;var Zn=t.contacts;Rn._inuse=!0;var qn=Rn;qn.next=Zn.next,Zn.next=qn,Zn.modified=!0,Zn.length++,t.innards.add(Un)}else Rn.fresh=!1;Rn.px=Sn,Rn.py=Pn,t.nx=Fn,t.ny=Bn,Rn.dist=cn,Rn.stamp=t.stamp,Rn.posOnly=!1,Tn=Rn}return t.ptype=i?0:1,t.lnormx=vn.lnormx,t.lnormy=vn.lnormy,t.rev=!i,t.lproj=vn.lprojection,t.radius=n.circle.radius,Tn.inner.lr1x=n.circle.localCOMx,Tn.inner.lr1y=n.circle.localCOMy,t.__ref_edge1=vn,t.__ref_vertex=0,!0}var Wn=n.circle.radius,Xn=0,Hn=0;Xn=wn.x-n.circle.worldCOMx,Hn=wn.y-n.circle.worldCOMy;var Kn,Jn=Xn*Xn+Hn*Hn;if(Jn>Wn*Wn)Kn=null;else if(f.epsilon*f.epsilon>Jn){for(var Qn=n.circle.worldCOMx,$n=n.circle.worldCOMy,ne=null,ee=t.contacts.next;null!=ee;){var te=ee;if(0==te.hash){ne=te;break}ee=ee.next}if(null==ne){null==Be.zpp_pool?ne=new Be:(ne=Be.zpp_pool,Be.zpp_pool=ne.next,ne.next=null);var ie=ne.inner;ie.jnAcc=ie.jtAcc=0,ne.hash=0,ne.fresh=!0,ne.arbiter=t,t.jrAcc=0;var le=t.contacts;ne._inuse=!0;var re=ne;re.next=le.next,le.next=re,le.modified=!0,le.length++,t.innards.add(ie)}else ne.fresh=!1;ne.px=Qn,ne.py=$n,t.nx=1,t.ny=0,ne.dist=-Wn,ne.stamp=t.stamp,ne.posOnly=!1,Kn=ne}else{var ae=1/Math.sqrt(Jn),pe=f.epsilon>ae?1e100:1/ae,se=.5+(n.circle.radius-.5*Wn)*ae;if(i){for(var oe=n.circle.worldCOMx+Xn*se,he=n.circle.worldCOMy+Hn*se,_e=null,ue=t.contacts.next;null!=ue;){var de=ue;if(0==de.hash){_e=de;break}ue=ue.next}if(null==_e){null==Be.zpp_pool?_e=new Be:(_e=Be.zpp_pool,Be.zpp_pool=_e.next,_e.next=null);var ce=_e.inner;ce.jnAcc=ce.jtAcc=0,_e.hash=0,_e.fresh=!0,_e.arbiter=t,t.jrAcc=0;var xe=t.contacts;_e._inuse=!0;var ve=_e;ve.next=xe.next,xe.next=ve,xe.modified=!0,xe.length++,t.innards.add(ce)}else _e.fresh=!1;_e.px=oe,_e.py=he,t.nx=-Xn*ae,t.ny=-Hn*ae,_e.dist=pe-Wn,_e.stamp=t.stamp,_e.posOnly=!1,Kn=_e}else{for(var ze=n.circle.worldCOMx+Xn*se,fe=n.circle.worldCOMy+Hn*se,me=null,be=t.contacts.next;null!=be;){var ge=be;if(0==ge.hash){me=ge;break}be=be.next}if(null==me){null==Be.zpp_pool?me=new Be:(me=Be.zpp_pool,Be.zpp_pool=me.next,me.next=null);var we=me.inner;we.jnAcc=we.jtAcc=0,me.hash=0,me.fresh=!0,me.arbiter=t,t.jrAcc=0;var Ce=t.contacts;me._inuse=!0;var Me=me;Me.next=Ce.next,Ce.next=Me,Ce.modified=!0,Ce.length++,t.innards.add(we)}else me.fresh=!1;me.px=ze,me.py=fe,t.nx=Xn*ae,t.ny=Hn*ae,me.dist=pe-Wn,me.stamp=t.stamp,me.posOnly=!1,Kn=me}}if(null!=Kn){var ke=Kn.inner;t.ptype=2;var Oe=0,Se=0;Oe=wn.x-e.polygon.body.posx,Se=wn.y-e.polygon.body.posy,t.__ref_edge1=vn,t.__ref_vertex=1,i?(ke.lr1x=Oe*e.polygon.body.axisy+Se*e.polygon.body.axisx,ke.lr1y=Se*e.polygon.body.axisy-Oe*e.polygon.body.axisx,ke.lr2x=n.circle.localCOMx,ke.lr2y=n.circle.localCOMy):(ke.lr2x=Oe*e.polygon.body.axisy+Se*e.polygon.body.axisx,ke.lr2y=Se*e.polygon.body.axisy-Oe*e.polygon.body.axisx,ke.lr1x=n.circle.localCOMx,ke.lr1y=n.circle.localCOMy),t.radius=n.circle.radius}return null!=Kn}var Pe=n.circle.radius,Te=0,Ae=0;Te=gn.x-n.circle.worldCOMx,Ae=gn.y-n.circle.worldCOMy;var Ee,Ie=Te*Te+Ae*Ae;if(Ie>Pe*Pe)Ee=null;else if(f.epsilon*f.epsilon>Ie){for(var Ve=n.circle.worldCOMx,Le=n.circle.worldCOMy,Ne=null,De=t.contacts.next;null!=De;){var je=De;if(0==je.hash){Ne=je;break}De=De.next}if(null==Ne){null==Be.zpp_pool?Ne=new Be:(Ne=Be.zpp_pool,Be.zpp_pool=Ne.next,Ne.next=null);var Fe=Ne.inner;Fe.jnAcc=Fe.jtAcc=0,Ne.hash=0,Ne.fresh=!0,Ne.arbiter=t,t.jrAcc=0;var Re=t.contacts;Ne._inuse=!0;var Ge=Ne;Ge.next=Re.next,Re.next=Ge,Re.modified=!0,Re.length++,t.innards.add(Fe)}else Ne.fresh=!1;Ne.px=Ve,Ne.py=Le,t.nx=1,t.ny=0,Ne.dist=-Pe,Ne.stamp=t.stamp,Ne.posOnly=!1,Ee=Ne}else{var Ye=1/Math.sqrt(Ie),Ue=f.epsilon>Ye?1e100:1/Ye,Ze=.5+(n.circle.radius-.5*Pe)*Ye;if(i){for(var qe=n.circle.worldCOMx+Te*Ze,We=n.circle.worldCOMy+Ae*Ze,Xe=null,He=t.contacts.next;null!=He;){var Ke=He;if(0==Ke.hash){Xe=Ke;break}He=He.next}if(null==Xe){null==Be.zpp_pool?Xe=new Be:(Xe=Be.zpp_pool,Be.zpp_pool=Xe.next,Xe.next=null);var Je=Xe.inner;Je.jnAcc=Je.jtAcc=0,Xe.hash=0,Xe.fresh=!0,Xe.arbiter=t,t.jrAcc=0;var Qe=t.contacts;Xe._inuse=!0;var $e=Xe;$e.next=Qe.next,Qe.next=$e,Qe.modified=!0,Qe.length++,t.innards.add(Je)}else Xe.fresh=!1;Xe.px=qe,Xe.py=We,t.nx=-Te*Ye,t.ny=-Ae*Ye,Xe.dist=Ue-Pe,Xe.stamp=t.stamp,Xe.posOnly=!1,Ee=Xe}else{for(var nt=n.circle.worldCOMx+Te*Ze,et=n.circle.worldCOMy+Ae*Ze,tt=null,it=t.contacts.next;null!=it;){var lt=it;if(0==lt.hash){tt=lt;break}it=it.next}if(null==tt){null==Be.zpp_pool?tt=new Be:(tt=Be.zpp_pool,Be.zpp_pool=tt.next,tt.next=null);var rt=tt.inner;rt.jnAcc=rt.jtAcc=0,tt.hash=0,tt.fresh=!0,tt.arbiter=t,t.jrAcc=0;var at=t.contacts;tt._inuse=!0;var pt=tt;pt.next=at.next,at.next=pt,at.modified=!0,at.length++,t.innards.add(rt)}else tt.fresh=!1;tt.px=nt,tt.py=et,t.nx=Te*Ye,t.ny=Ae*Ye,tt.dist=Ue-Pe,tt.stamp=t.stamp,tt.posOnly=!1,Ee=tt}}if(null!=Ee){var st=Ee.inner;t.ptype=2;var ot=0,ht=0;ot=gn.x-e.polygon.body.posx,ht=gn.y-e.polygon.body.posy,t.__ref_edge1=vn,t.__ref_vertex=-1,i?(st.lr1x=ot*e.polygon.body.axisy+ht*e.polygon.body.axisx,st.lr1y=ht*e.polygon.body.axisy-ot*e.polygon.body.axisx,st.lr2x=n.circle.localCOMx,st.lr2y=n.circle.localCOMy):(st.lr2x=ot*e.polygon.body.axisy+ht*e.polygon.body.axisx,st.lr2y=ht*e.polygon.body.axisy-ot*e.polygon.body.axisx,st.lr1x=n.circle.localCOMx,st.lr1y=n.circle.localCOMy),t.radius=n.circle.radius}return null!=Ee}return!1}var _t=n.circle.radius+e.circle.radius,ut=0,dt=0;ut=e.circle.worldCOMx-n.circle.worldCOMx,dt=e.circle.worldCOMy-n.circle.worldCOMy;var ct,xt=ut*ut+dt*dt;if(xt>_t*_t)ct=null;else if(f.epsilon*f.epsilon>xt){for(var vt=n.circle.worldCOMx,zt=n.circle.worldCOMy,yt=null,ft=t.contacts.next;null!=ft;){var mt=ft;if(0==mt.hash){yt=mt;break}ft=ft.next}if(null==yt){null==Be.zpp_pool?yt=new Be:(yt=Be.zpp_pool,Be.zpp_pool=yt.next,yt.next=null);var bt=yt.inner;bt.jnAcc=bt.jtAcc=0,yt.hash=0,yt.fresh=!0,yt.arbiter=t,t.jrAcc=0;var gt=t.contacts;yt._inuse=!0;var wt=yt;wt.next=gt.next,gt.next=wt,gt.modified=!0,gt.length++,t.innards.add(bt)}else yt.fresh=!1;yt.px=vt,yt.py=zt,t.nx=1,t.ny=0,yt.dist=-_t,yt.stamp=t.stamp,yt.posOnly=!1,ct=yt}else{var Ct=1/Math.sqrt(xt),Mt=f.epsilon>Ct?1e100:1/Ct,kt=.5+(n.circle.radius-.5*_t)*Ct;if(i){for(var Ot=n.circle.worldCOMx+ut*kt,St=n.circle.worldCOMy+dt*kt,Pt=null,Tt=t.contacts.next;null!=Tt;){var At=Tt;if(0==At.hash){Pt=At;break}Tt=Tt.next}if(null==Pt){null==Be.zpp_pool?Pt=new Be:(Pt=Be.zpp_pool,Be.zpp_pool=Pt.next,Pt.next=null);var Et=Pt.inner;Et.jnAcc=Et.jtAcc=0,Pt.hash=0,Pt.fresh=!0,Pt.arbiter=t,t.jrAcc=0;var It=t.contacts;Pt._inuse=!0;var Vt=Pt;Vt.next=It.next,It.next=Vt,It.modified=!0,It.length++,t.innards.add(Et)}else Pt.fresh=!1;Pt.px=Ot,Pt.py=St,t.nx=-ut*Ct,t.ny=-dt*Ct,Pt.dist=Mt-_t,Pt.stamp=t.stamp,Pt.posOnly=!1,ct=Pt}else{for(var Lt=n.circle.worldCOMx+ut*kt,Nt=n.circle.worldCOMy+dt*kt,Dt=null,jt=t.contacts.next;null!=jt;){var Ft=jt;if(0==Ft.hash){Dt=Ft;break}jt=jt.next}if(null==Dt){null==Be.zpp_pool?Dt=new Be:(Dt=Be.zpp_pool,Be.zpp_pool=Dt.next,Dt.next=null);var Bt=Dt.inner;Bt.jnAcc=Bt.jtAcc=0,Dt.hash=0,Dt.fresh=!0,Dt.arbiter=t,t.jrAcc=0;var Rt=t.contacts;Dt._inuse=!0;var Gt=Dt;Gt.next=Rt.next,Rt.next=Gt,Rt.modified=!0,Rt.length++,t.innards.add(Bt)}else Dt.fresh=!1;Dt.px=Lt,Dt.py=Nt,t.nx=ut*Ct,t.ny=dt*Ct,Dt.dist=Mt-_t,Dt.stamp=t.stamp,Dt.posOnly=!1,ct=Dt}}if(null!=ct){var Yt=ct.inner;return i?(Yt.lr1x=e.circle.localCOMx,Yt.lr1y=e.circle.localCOMy,Yt.lr2x=n.circle.localCOMx,Yt.lr2y=n.circle.localCOMy):(Yt.lr1x=n.circle.localCOMx,Yt.lr1y=n.circle.localCOMy,Yt.lr2x=e.circle.localCOMx,Yt.lr2y=e.circle.localCOMy),t.radius=n.circle.radius+e.circle.radius,t.ptype=2,!0}return!1},We.testCollide_safe=function(n,e){if(e.type==ye.id_ShapeType_CIRCLE){var t=n;n=e,e=t}return We.testCollide(n,e)},We.testCollide=function(n,e){if(e.type==ye.id_ShapeType_POLYGON){if(n.type==ye.id_ShapeType_POLYGON){for(var t=!0,i=n.polygon.edges.head;null!=i;){for(var l=i.elt,r=1e100,a=e.polygon.gverts.next;null!=a;){var p=a,s=l.gnormx*p.x+l.gnormy*p.y;r>s&&(r=s),a=a.next}if((r-=l.gprojection)>0){t=!1;break}i=i.next}if(t){for(var o=e.polygon.edges.head;null!=o;){for(var h=o.elt,_=1e100,u=n.polygon.gverts.next;null!=u;){var d=u,c=h.gnormx*d.x+h.gnormy*d.y;_>c&&(_=c),u=u.next}if((_-=h.gprojection)>0){t=!1;break}o=o.next}return t}return!1}for(var x=null,v=null,z=!0,y=-1e100,f=e.polygon.gverts.next,m=e.polygon.edges.head;null!=m;){var b=m.elt,g=b.gnormx*n.circle.worldCOMx+b.gnormy*n.circle.worldCOMy-b.gprojection-n.circle.radius;if(g>0){z=!1;break}g>y&&(y=g,x=b,v=f),f=f.next,m=m.next}if(z){var w=v,C=null==v.next?e.polygon.gverts.next:v.next,M=n.circle.worldCOMy*x.gnormx-n.circle.worldCOMx*x.gnormy;if(M>w.y*x.gnormx-w.x*x.gnormy){if(C.y*x.gnormx-C.x*x.gnormy>M)return!0;var k=n.circle.radius,O=0,S=0;O=C.x-n.circle.worldCOMx,S=C.y-n.circle.worldCOMy;return k*k>=O*O+S*S}var P=n.circle.radius,T=0,A=0;T=w.x-n.circle.worldCOMx,A=w.y-n.circle.worldCOMy;return P*P>=T*T+A*A}return!1}var E=n.circle.radius+e.circle.radius,I=0,V=0;return I=e.circle.worldCOMx-n.circle.worldCOMx,V=e.circle.worldCOMy-n.circle.worldCOMy,E*E>=I*I+V*V},We.flowCollide=function(n,e,t){if(e.type==ye.id_ShapeType_POLYGON){if(n.type==ye.id_ShapeType_POLYGON){for(var i=[],l=[],r=!0,a=!0,p=n.polygon.edges.head;null!=p;){for(var s=p.elt,o=1e100,h=0,_=e.polygon.gverts.next;null!=_;){var u=_,d=s.gnormx*u.x+s.gnormy*u.y;o>d&&(o=d),s.gprojection+f.epsilon>d||(l[h]=!0,a=!1),++h,_=_.next}if((o-=s.gprojection)>0){r=!1;break}p=p.next}if(a){var c=e.polygon;if(c.zip_worldCOM&&null!=c.body){if(c.zip_worldCOM=!1,c.zip_localCOM){if(c.zip_localCOM=!1,c.type==ye.id_ShapeType_POLYGON){var x=c.polygon;if(null==x.lverts.next.next)x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y;else if(null==x.lverts.next.next.next){x.localCOMx=x.lverts.next.x,x.localCOMy=x.lverts.next.y;x.localCOMx+=1*x.lverts.next.next.x,x.localCOMy+=1*x.lverts.next.next.y;x.localCOMx*=.5,x.localCOMy*=.5}else{x.localCOMx=0,x.localCOMy=0;var v=0,z=x.lverts.next,y=z;z=z.next;var m=z;for(z=z.next;null!=z;){var b=z;v+=m.x*(b.y-y.y);var g=b.y*m.x-b.x*m.y;x.localCOMx+=(m.x+b.x)*g,x.localCOMy+=(m.y+b.y)*g,y=m,m=b,z=z.next}z=x.lverts.next;var w=z;v+=m.x*(w.y-y.y);var C=w.y*m.x-w.x*m.y;x.localCOMx+=(m.x+w.x)*C,x.localCOMy+=(m.y+w.y)*C,y=m,m=w,z=z.next;var M=z;v+=m.x*(M.y-y.y);var k=M.y*m.x-M.x*m.y;x.localCOMx+=(m.x+M.x)*k,x.localCOMy+=(m.y+M.y)*k,v=1/(3*v);var O=v;x.localCOMx*=O,x.localCOMy*=O}}null!=c.wrap_localCOM&&(c.wrap_localCOM.zpp_inner.x=c.localCOMx,c.wrap_localCOM.zpp_inner.y=c.localCOMy)}var S=c.body;S.zip_axis&&(S.zip_axis=!1,S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)),c.worldCOMx=c.body.posx+(c.body.axisy*c.localCOMx-c.body.axisx*c.localCOMy),c.worldCOMy=c.body.posy+(c.localCOMx*c.body.axisx+c.localCOMy*c.body.axisy)}return t.overlap=e.polygon.area,t.centroidx=e.polygon.worldCOMx,t.centroidy=e.polygon.worldCOMy,!0}if(r){a=!0;for(var P=e.polygon.edges.head;null!=P;){for(var T=P.elt,A=1e100,E=0,I=n.polygon.gverts.next;null!=I;){var V=I,L=T.gnormx*V.x+T.gnormy*V.y;A>L&&(A=L),T.gprojection+f.epsilon>L||(i[E]=!0,a=!1),++E,I=I.next}if((A-=T.gprojection)>0){r=!1;break}P=P.next}if(a){var N=n.polygon;if(N.zip_worldCOM&&null!=N.body){if(N.zip_worldCOM=!1,N.zip_localCOM){if(N.zip_localCOM=!1,N.type==ye.id_ShapeType_POLYGON){var D=N.polygon;if(null==D.lverts.next.next)D.localCOMx=D.lverts.next.x,D.localCOMy=D.lverts.next.y;else if(null==D.lverts.next.next.next){D.localCOMx=D.lverts.next.x,D.localCOMy=D.lverts.next.y;D.localCOMx+=1*D.lverts.next.next.x,D.localCOMy+=1*D.lverts.next.next.y;D.localCOMx*=.5,D.localCOMy*=.5}else{D.localCOMx=0,D.localCOMy=0;var j=0,F=D.lverts.next,B=F;F=F.next;var R=F;for(F=F.next;null!=F;){var G=F;j+=R.x*(G.y-B.y);var Y=G.y*R.x-G.x*R.y;D.localCOMx+=(R.x+G.x)*Y,D.localCOMy+=(R.y+G.y)*Y,B=R,R=G,F=F.next}F=D.lverts.next;var U=F;j+=R.x*(U.y-B.y);var Z=U.y*R.x-U.x*R.y;D.localCOMx+=(R.x+U.x)*Z,D.localCOMy+=(R.y+U.y)*Z,B=R,R=U,F=F.next;var q=F;j+=R.x*(q.y-B.y);var W=q.y*R.x-q.x*R.y;D.localCOMx+=(R.x+q.x)*W,D.localCOMy+=(R.y+q.y)*W,j=1/(3*j);var X=j;D.localCOMx*=X,D.localCOMy*=X}}null!=N.wrap_localCOM&&(N.wrap_localCOM.zpp_inner.x=N.localCOMx,N.wrap_localCOM.zpp_inner.y=N.localCOMy)}var H=N.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),N.worldCOMx=N.body.posx+(N.body.axisy*N.localCOMx-N.body.axisx*N.localCOMy),N.worldCOMy=N.body.posy+(N.localCOMx*N.body.axisx+N.localCOMy*N.body.axisy)}return t.overlap=n.polygon.area,t.centroidx=n.polygon.worldCOMx,t.centroidy=n.polygon.worldCOMy,!0}if(r){for(;null!=We.flowpoly.head;){var K=We.flowpoly.pop_unsafe();if(!K._inuse){var J=K;null!=J.outer&&(J.outer.zpp_inner=null,J.outer=null),J._isimmutable=null,J._validate=null,J._invalidate=null,J.next=Ct.zpp_pool,Ct.zpp_pool=J}}for(var Q=null,$=!1,nn=n.polygon.gverts.next,en=0,tn=e.polygon.gverts.next,ln=0,rn=0,an=e.polygon.edgeCnt;an>rn;){var pn=rn++;if(!l[pn]){ln=pn;break}tn=tn.next}if(null==tn){tn=e.polygon.gverts.next,$=!0;for(var sn=0,on=n.polygon.edgeCnt;on>sn;){var hn=sn++;if(!i[hn]){en=hn;break}nn=nn.next}null==nn?nn=n.polygon.gverts.next:(We.flowpoly.add(nn),Q=We.flowpoly.head.elt)}else We.flowpoly.add(tn),Q=We.flowpoly.head.elt;var _n=1;if(null==We.flowpoly.head){for(var un=!0,dn=n.polygon.gverts.next,cn=dn,xn=dn.next;null!=xn;){for(var vn=xn,zn=2,yn=e.polygon.gverts.next,fn=yn,mn=yn.next;null!=mn;){var bn=mn,gn=0,wn=0,Cn=0;wn=cn.x-fn.x,Cn=cn.y-fn.y;var Mn=0,kn=0;Mn=vn.x-cn.x,kn=vn.y-cn.y;var On=0,Sn=0;On=bn.x-fn.x,Sn=bn.y-fn.y;var Pn,Tn=kn*On-Mn*Sn;if(Tn*Tn>f.epsilon*f.epsilon){Tn=1/Tn;var An=(Sn*wn-On*Cn)*Tn;if(An>f.epsilon&&1-f.epsilon>An){var En=(kn*wn-Mn*Cn)*Tn;En>f.epsilon&&1-f.epsilon>En?(gn=An,Pn=!0):Pn=!1}else Pn=!1}else Pn=!1;Pn&&zn>gn&&(zn=gn,tn=yn),yn=mn,fn=bn,mn=mn.next}for(;;){mn=e.polygon.gverts.next;var In=mn,Vn=0,Ln=0,Nn=0;Ln=cn.x-fn.x,Nn=cn.y-fn.y;var Dn=0,jn=0;Dn=vn.x-cn.x,jn=vn.y-cn.y;var Fn=0,Bn=0;Fn=In.x-fn.x,Bn=In.y-fn.y;var Rn,Gn=jn*Fn-Dn*Bn;if(Gn*Gn>f.epsilon*f.epsilon){Gn=1/Gn;var Yn=(Bn*Ln-Fn*Nn)*Gn;if(Yn>f.epsilon&&1-f.epsilon>Yn){var Un=(jn*Ln-Dn*Nn)*Gn;Un>f.epsilon&&1-f.epsilon>Un?(Vn=Yn,Rn=!0):Rn=!1}else Rn=!1}else Rn=!1;Rn&&zn>Vn&&(zn=Vn,tn=yn);break}if(2!=zn){var Zn=0,qn=0,Wn=zn;Zn=cn.x+(vn.x-cn.x)*Wn,qn=cn.y+(vn.y-cn.y)*Wn;var Xn;null==Ct.zpp_pool?Xn=new Ct:(Xn=Ct.zpp_pool,Ct.zpp_pool=Xn.next,Xn.next=null),Xn.weak=!1,Xn._immutable=!1,Xn.x=Zn,Xn.y=qn,Q=Xn,We.flowpoly.add(Q),$=!0,nn=dn,un=!1;break}dn=xn,cn=vn,xn=xn.next}if(un)for(;;){xn=n.polygon.gverts.next;for(var Hn=xn,Kn=2,Jn=e.polygon.gverts.next,Qn=Jn,$n=Jn.next;null!=$n;){var ne=$n,ee=0,te=0,ie=0;te=cn.x-Qn.x,ie=cn.y-Qn.y;var le=0,re=0;le=Hn.x-cn.x,re=Hn.y-cn.y;var ae=0,pe=0;ae=ne.x-Qn.x,pe=ne.y-Qn.y;var se,oe=re*ae-le*pe;if(oe*oe>f.epsilon*f.epsilon){oe=1/oe;var he=(pe*te-ae*ie)*oe;if(he>f.epsilon&&1-f.epsilon>he){var _e=(re*te-le*ie)*oe;_e>f.epsilon&&1-f.epsilon>_e?(ee=he,se=!0):se=!1}else se=!1}else se=!1;se&&Kn>ee&&(Kn=ee,tn=Jn),Jn=$n,Qn=ne,$n=$n.next}for(;;){$n=e.polygon.gverts.next;var ue=$n,de=0,ce=0,xe=0;ce=cn.x-Qn.x,xe=cn.y-Qn.y;var ve=0,ze=0;ve=Hn.x-cn.x,ze=Hn.y-cn.y;var fe=0,me=0;fe=ue.x-Qn.x,me=ue.y-Qn.y;var be,ge=ze*fe-ve*me;if(ge*ge>f.epsilon*f.epsilon){ge=1/ge;var we=(me*ce-fe*xe)*ge;if(we>f.epsilon&&1-f.epsilon>we){var Ce=(ze*ce-ve*xe)*ge;Ce>f.epsilon&&1-f.epsilon>Ce?(de=we,be=!0):be=!1}else be=!1}else be=!1;be&&Kn>de&&(Kn=de,tn=Jn);break}if(2!=Kn){var Me=0,ke=0,Oe=Kn;Me=cn.x+(Hn.x-cn.x)*Oe,ke=cn.y+(Hn.y-cn.y)*Oe;var Se;null==Ct.zpp_pool?Se=new Ct:(Se=Ct.zpp_pool,Ct.zpp_pool=Se.next,Se.next=null),Se.weak=!1,Se._immutable=!1,Se.x=Me,Se.y=ke,Q=Se,We.flowpoly.add(Q),$=!0,nn=dn;break}break}_n=2}for(;;)if($)if(nn=nn.next,++en,null==nn&&(nn=n.polygon.gverts.next,en=0),i[en]){var Pe=We.flowpoly.head.elt,Te=nn,Ae=tn,Ee=tn.next;null==Ee&&(Ee=e.polygon.gverts.next);for(var Ie=-1,Ve=null,Le=0,Ne=0,De=Ee,je=Ee;;){var Fe=je,Be=0,Re=0,Ge=0;Re=Ae.x-Pe.x,Ge=Ae.y-Pe.y;var Ye=0,Ue=0;Ye=Fe.x-Ae.x,Ue=Fe.y-Ae.y;var Ze=0,qe=0;Ze=Te.x-Pe.x,qe=Te.y-Pe.y;var Xe,He=Ue*Ze-Ye*qe;if(He*He>f.epsilon*f.epsilon){He=1/He;var Ke=(qe*Re-Ze*Ge)*He;if(Ke>f.epsilon&&1-f.epsilon>Ke){var Je=(Ue*Re-Ye*Ge)*He;Je>f.epsilon&&1-f.epsilon>Je?(Be=Ke,Xe=!0):Xe=!1}else Xe=!1}else Xe=!1;if(Xe&&Be>=Ie){if(Ve=tn,Le=ln,++Ne==_n){Ie=Be,je=De;break}Ie=Be}Ae=Fe,tn=je,++ln,e.polygon.edgeCnt>ln||(ln=0),je=je.next,null==je&&(je=e.polygon.gverts.next);break}for(;je!=De;){var Qe=je,$e=0,nt=0,et=0;nt=Ae.x-Pe.x,et=Ae.y-Pe.y;var tt=0,it=0;tt=Qe.x-Ae.x,it=Qe.y-Ae.y;var lt=0,rt=0;lt=Te.x-Pe.x,rt=Te.y-Pe.y;var at,pt=it*lt-tt*rt;if(pt*pt>f.epsilon*f.epsilon){pt=1/pt;var st=(rt*nt-lt*et)*pt;if(st>f.epsilon&&1-f.epsilon>st){var ot=(it*nt-tt*et)*pt;ot>f.epsilon&&1-f.epsilon>ot?($e=st,at=!0):at=!1}else at=!1}else at=!1;if(at&&$e>=Ie){if(Ve=tn,Le=ln,++Ne==_n){Ie=$e,je=De;break}Ie=$e}Ae=Qe,tn=je,++ln,e.polygon.edgeCnt>ln||(ln=0),je=je.next,null==je&&(je=e.polygon.gverts.next)}if(null==Ve)break;var ht=Ve,_t=Ve.next;null==_t&&(_t=e.polygon.gverts.next);var ut=_t,dt=0,ct=0,xt=Ie;dt=ht.x+(ut.x-ht.x)*xt,ct=ht.y+(ut.y-ht.y)*xt;var vt;if(null!=Q){var zt=0,yt=0;zt=dt-Q.x,yt=ct-Q.y,vt=f.epsilon>zt*zt+yt*yt}else vt=!1;if(vt)break;var ft,mt=We.flowpoly;null==Ct.zpp_pool?ft=new Ct:(ft=Ct.zpp_pool,Ct.zpp_pool=ft.next,ft.next=null),ft.weak=!1,ft._immutable=!1,ft.x=dt,ft.y=ct,mt.add(ft),null==Q&&(Q=We.flowpoly.head.elt),tn=Ve,ln=Le,$=!$,_n=2}else{var bt,gt=nn;if(null!=Q){var wt=0,Mt=0;wt=gt.x-Q.x,Mt=gt.y-Q.y,bt=f.epsilon>wt*wt+Mt*Mt}else bt=!1;if(bt)break;We.flowpoly.add(gt),null==Q&&(Q=We.flowpoly.head.elt),_n=1}else if(tn=tn.next,++ln,null==tn&&(tn=e.polygon.gverts.next,ln=0),l[ln]){var kt=We.flowpoly.head.elt,Ot=tn,St=nn,Pt=nn.next;null==Pt&&(Pt=n.polygon.gverts.next);for(var Tt=-1,At=null,Et=0,It=0,Vt=Pt,Lt=Pt;;){var Nt=Lt,Dt=0,jt=0,Ft=0;jt=St.x-kt.x,Ft=St.y-kt.y;var Bt=0,Rt=0;Bt=Nt.x-St.x,Rt=Nt.y-St.y;var Gt=0,Yt=0;Gt=Ot.x-kt.x,Yt=Ot.y-kt.y;var Ut,Zt=Rt*Gt-Bt*Yt;if(Zt*Zt>f.epsilon*f.epsilon){Zt=1/Zt;var qt=(Yt*jt-Gt*Ft)*Zt;if(qt>f.epsilon&&1-f.epsilon>qt){var Wt=(Rt*jt-Bt*Ft)*Zt;Wt>f.epsilon&&1-f.epsilon>Wt?(Dt=qt,Ut=!0):Ut=!1}else Ut=!1}else Ut=!1;if(Ut&&Dt>=Tt){if(At=nn,Et=en,++It==_n){Tt=Dt,Lt=Vt;break}Tt=Dt}St=Nt,nn=Lt,++en,n.polygon.edgeCnt>en||(en=0),Lt=Lt.next,null==Lt&&(Lt=n.polygon.gverts.next);break}for(;Lt!=Vt;){var Xt=Lt,Ht=0,Kt=0,Jt=0;Kt=St.x-kt.x,Jt=St.y-kt.y;var Qt=0,$t=0;Qt=Xt.x-St.x,$t=Xt.y-St.y;var ni=0,ei=0;ni=Ot.x-kt.x,ei=Ot.y-kt.y;var ti,ii=$t*ni-Qt*ei;if(ii*ii>f.epsilon*f.epsilon){ii=1/ii;var li=(ei*Kt-ni*Jt)*ii;if(li>f.epsilon&&1-f.epsilon>li){var ri=($t*Kt-Qt*Jt)*ii;ri>f.epsilon&&1-f.epsilon>ri?(Ht=li,ti=!0):ti=!1}else ti=!1}else ti=!1;if(ti&&Ht>=Tt){if(At=nn,Et=en,++It==_n){Tt=Ht,Lt=Vt;break}Tt=Ht}St=Xt,nn=Lt,++en,n.polygon.edgeCnt>en||(en=0),Lt=Lt.next,null==Lt&&(Lt=n.polygon.gverts.next)}if(null==At)break;var ai=At,pi=At.next;null==pi&&(pi=n.polygon.gverts.next);var si=pi,oi=0,hi=0,_i=Tt;oi=ai.x+(si.x-ai.x)*_i,hi=ai.y+(si.y-ai.y)*_i;var ui;if(null!=Q){var di=0,ci=0;di=oi-Q.x,ci=hi-Q.y,ui=f.epsilon>di*di+ci*ci}else ui=!1;if(ui)break;var xi,vi=We.flowpoly;null==Ct.zpp_pool?xi=new Ct:(xi=Ct.zpp_pool,Ct.zpp_pool=xi.next,xi.next=null),xi.weak=!1,xi._immutable=!1,xi.x=oi,xi.y=hi,vi.add(xi),null==Q&&(Q=We.flowpoly.head.elt),nn=At,en=Et,$=!$,_n=2}else{var zi,yi=tn;if(null!=Q){var fi=0,mi=0;fi=yi.x-Q.x,mi=yi.y-Q.y,zi=f.epsilon>fi*fi+mi*mi}else zi=!1;if(zi)break;We.flowpoly.add(yi),null==Q&&(Q=We.flowpoly.head.elt),_n=1}if(null!=We.flowpoly.head&&null!=We.flowpoly.head.next&&null!=We.flowpoly.head.next.next){var bi=0,gi=0,wi=0;gi=0,wi=0,bi=0;var Ci=We.flowpoly.head,Mi=Ci.elt;Ci=Ci.next;var ki=Ci.elt;for(Ci=Ci.next;null!=Ci;){var Oi=Ci.elt;bi+=ki.x*(Oi.y-Mi.y);var Si=Oi.y*ki.x-Oi.x*ki.y;gi+=(ki.x+Oi.x)*Si,wi+=(ki.y+Oi.y)*Si,Mi=ki,ki=Oi,Ci=Ci.next}Ci=We.flowpoly.head;var Pi=Ci.elt;bi+=ki.x*(Pi.y-Mi.y);var Ti=Pi.y*ki.x-Pi.x*ki.y;gi+=(ki.x+Pi.x)*Ti,wi+=(ki.y+Pi.y)*Ti,Mi=ki,ki=Pi,Ci=Ci.next;var Ai=Ci.elt;bi+=ki.x*(Ai.y-Mi.y);var Ei=Ai.y*ki.x-Ai.x*ki.y;gi+=(ki.x+Ai.x)*Ei,wi+=(ki.y+Ai.y)*Ei,bi*=.5;var Ii=1/(6*bi),Vi=Ii;return gi*=Vi,wi*=Vi,t.overlap=-bi,t.centroidx=gi,t.centroidy=wi,!0}return!1}return!1}return!1}for(var Li=[],Ni=!0,Di=null,ji=null,Fi=-1e100,Bi=!0,Ri=e.polygon.gverts.next,Gi=0,Yi=e.polygon.edges.head;null!=Yi;){var Ui=Yi.elt,Zi=Ui.gnormx*n.circle.worldCOMx+Ui.gnormy*n.circle.worldCOMy;if(Zi>Ui.gprojection+n.circle.radius){Bi=!1;break}Zi+n.circle.radius>Ui.gprojection+f.epsilon&&(Ni=!1,Li[Gi]=!0),Zi-=Ui.gprojection+n.circle.radius,Zi>Fi&&(Fi=Zi,Di=Ui,ji=Ri),Ri=Ri.next,++Gi,Yi=Yi.next}if(Bi){if(Ni)return t.overlap=n.circle.area,t.centroidx=n.circle.worldCOMx,t.centroidy=n.circle.worldCOMy,!0;var qi,Wi=ji,Xi=null==ji.next?e.polygon.gverts.next:ji.next,Hi=n.circle.worldCOMy*Di.gnormx-n.circle.worldCOMx*Di.gnormy;if(Wi.y*Di.gnormx-Wi.x*Di.gnormy<Hi)if(Hi<Xi.y*Di.gnormx-Xi.x*Di.gnormy)qi=!0;else{var Ki=n.circle.radius,Ji=0,Qi=0;Ji=Xi.x-n.circle.worldCOMx,Qi=Xi.y-n.circle.worldCOMy;var $i=Ji*Ji+Qi*Qi;qi=Ki*Ki>=$i}else{var nl=n.circle.radius,el=0,tl=0;el=Wi.x-n.circle.worldCOMx,tl=Wi.y-n.circle.worldCOMy;qi=nl*nl>=el*el+tl*tl}if(qi){for(var il=[],ll=0,rl=!0,al=null,pl=0,sl=e.polygon.gverts.next;null!=sl;){var ol=sl,hl=0,_l=0;hl=ol.x-n.circle.worldCOMx,_l=ol.y-n.circle.worldCOMy;(il[ll]=n.circle.radius*n.circle.radius>=hl*hl+_l*_l)?(pl=ll,al=sl):rl=!1,++ll,sl=sl.next}if(rl){var ul=e.polygon;if(ul.zip_worldCOM&&null!=ul.body){if(ul.zip_worldCOM=!1,ul.zip_localCOM){if(ul.zip_localCOM=!1,ul.type==ye.id_ShapeType_POLYGON){var dl=ul.polygon;if(null==dl.lverts.next.next)dl.localCOMx=dl.lverts.next.x,dl.localCOMy=dl.lverts.next.y;else if(null==dl.lverts.next.next.next){dl.localCOMx=dl.lverts.next.x,dl.localCOMy=dl.lverts.next.y;dl.localCOMx+=1*dl.lverts.next.next.x,dl.localCOMy+=1*dl.lverts.next.next.y;dl.localCOMx*=.5,dl.localCOMy*=.5}else{dl.localCOMx=0,dl.localCOMy=0;var cl=0,xl=dl.lverts.next,vl=xl;xl=xl.next;var zl=xl;for(xl=xl.next;null!=xl;){var yl=xl;cl+=zl.x*(yl.y-vl.y);var fl=yl.y*zl.x-yl.x*zl.y;dl.localCOMx+=(zl.x+yl.x)*fl,dl.localCOMy+=(zl.y+yl.y)*fl,vl=zl,zl=yl,xl=xl.next}xl=dl.lverts.next;var ml=xl;cl+=zl.x*(ml.y-vl.y);var bl=ml.y*zl.x-ml.x*zl.y;dl.localCOMx+=(zl.x+ml.x)*bl,dl.localCOMy+=(zl.y+ml.y)*bl,vl=zl,zl=ml,xl=xl.next;var gl=xl;cl+=zl.x*(gl.y-vl.y);var wl=gl.y*zl.x-gl.x*zl.y;dl.localCOMx+=(zl.x+gl.x)*wl,dl.localCOMy+=(zl.y+gl.y)*wl,cl=1/(3*cl);var Cl=cl;dl.localCOMx*=Cl,dl.localCOMy*=Cl}}null!=ul.wrap_localCOM&&(ul.wrap_localCOM.zpp_inner.x=ul.localCOMx,ul.wrap_localCOM.zpp_inner.y=ul.localCOMy)}var Ml=ul.body;Ml.zip_axis&&(Ml.zip_axis=!1,Ml.axisx=Math.sin(Ml.rot),Ml.axisy=Math.cos(Ml.rot)),ul.worldCOMx=ul.body.posx+(ul.body.axisy*ul.localCOMx-ul.body.axisx*ul.localCOMy),ul.worldCOMy=ul.body.posy+(ul.localCOMx*ul.body.axisx+ul.localCOMy*ul.body.axisy)}return t.overlap=e.polygon.area,t.centroidx=e.polygon.worldCOMx,t.centroidy=e.polygon.worldCOMy,!0}for(;null!=We.flowpoly.head;){var kl=We.flowpoly.pop_unsafe();if(!kl._inuse){var Ol=kl;null!=Ol.outer&&(Ol.outer.zpp_inner=null,Ol.outer=null),Ol._isimmutable=null,Ol._validate=null,Ol._invalidate=null,Ol.next=Ct.zpp_pool,Ct.zpp_pool=Ol}}We.flowsegs.clear();var Sl=null,Pl=1;for(null==al?(al=e.polygon.gverts.next,Pl=2):(Sl=al,We.flowpoly.add(Sl));0!=Pl;)if(1==Pl)if(al=al.next,null==al&&(al=e.polygon.gverts.next),++pl,e.polygon.edgeCnt>pl||(pl=0),il[pl]){var Tl=0,Al=0;if(Tl=Sl.x-al.x,Al=Sl.y-al.y,f.epsilon>Tl*Tl+Al*Al)break;We.flowpoly.add(al)}else{var El=We.flowpoly.head.elt,Il=al,Vl=0,Ll=0;Vl=Il.x-El.x,Ll=Il.y-El.y;var Nl=0,Dl=0;Nl=El.x-n.circle.worldCOMx,Dl=El.y-n.circle.worldCOMy;var jl=Vl*Vl+Ll*Ll,Fl=2*(Nl*Vl+Dl*Ll),Bl=Nl*Nl+Dl*Dl-n.circle.radius*n.circle.radius,Rl=Math.sqrt(Fl*Fl-4*jl*Bl);jl=1/(2*jl);var Gl=(-Fl-Rl)*jl,Yl=f.epsilon>Gl?(-Fl+Rl)*jl:Gl,Ul=0,Zl=0,ql=Yl;Ul=El.x+(Il.x-El.x)*ql,Zl=El.y+(Il.y-El.y)*ql;var Wl=0,Xl=0;if(Wl=Sl.x-Ul,Xl=Sl.y-Zl,f.epsilon>Wl*Wl+Xl*Xl)break;var Hl,Kl=We.flowpoly;null==Ct.zpp_pool?Hl=new Ct:(Hl=Ct.zpp_pool,Ct.zpp_pool=Hl.next,Hl.next=null),Hl.weak=!1,Hl._immutable=!1,Hl.x=Ul,Hl.y=Zl,Kl.add(Hl),Pl=2}else if(2==Pl){var Jl=al.next;null==Jl&&(Jl=e.polygon.gverts.next);var Ql=al;Pl=0;for(var $l=Jl,nr=Jl;;){var er=nr,tr=pl+1;if(tr==e.polygon.edgeCnt&&(tr=0),Li[pl]){if(il[tr]){var ir=0,lr=0;ir=er.x-Ql.x,lr=er.y-Ql.y;var rr=0,ar=0;rr=Ql.x-n.circle.worldCOMx,ar=Ql.y-n.circle.worldCOMy;var pr=ir*ir+lr*lr,sr=2*(rr*ir+ar*lr),or=rr*rr+ar*ar-n.circle.radius*n.circle.radius,hr=Math.sqrt(sr*sr-4*pr*or);pr=1/(2*pr);var _r=(-sr-hr)*pr,ur=f.epsilon>_r?(-sr+hr)*pr:_r,dr=0,cr=0,xr=ur;dr=Ql.x+(er.x-Ql.x)*xr,cr=Ql.y+(er.y-Ql.y)*xr;var vr=0,zr=0;if(vr=Sl.x-dr,zr=Sl.y-cr,f.epsilon>vr*vr+zr*zr){Pl=0,nr=$l;break}var yr;null==Ct.zpp_pool?yr=new Ct:(yr=Ct.zpp_pool,Ct.zpp_pool=yr.next,yr.next=null),yr.weak=!1,yr._immutable=!1,yr.x=dr,yr.y=cr;var fr=yr;We.flowsegs.add(We.flowpoly.head.elt),We.flowsegs.add(fr),We.flowpoly.add(fr),Pl=1,nr=$l;break}var mr=0,br=0,gr=0,wr=0;gr=er.x-Ql.x,wr=er.y-Ql.y;var Cr=0,Mr=0;Cr=Ql.x-n.circle.worldCOMx,Mr=Ql.y-n.circle.worldCOMy;var kr,Or=gr*gr+wr*wr,Sr=2*(Cr*gr+Mr*wr),Pr=Cr*Cr+Mr*Mr-n.circle.radius*n.circle.radius,Tr=Sr*Sr-4*Or*Pr;if(f.epsilon>Tr*Tr?(0>Tr?mr=10:(br=-Sr/(2*Or),mr=br),kr=!1):(Tr=Math.sqrt(Tr),Or=1/(2*Or),mr=(-Sr-Tr)*Or,br=(-Sr+Tr)*Or,kr=!0),1-f.epsilon>mr&&br>f.epsilon){var Ar=0,Er=0,Ir=mr;Ar=Ql.x+(er.x-Ql.x)*Ir,Er=Ql.y+(er.y-Ql.y)*Ir;var Vr;if(null!=Sl){var Lr=0,Nr=0;Lr=Sl.x-Ar,Nr=Sl.y-Er,Vr=f.epsilon>Lr*Lr+Nr*Nr}else Vr=!1;if(Vr){Pl=0,nr=$l;break}var Dr;null==Ct.zpp_pool?Dr=new Ct:(Dr=Ct.zpp_pool,Ct.zpp_pool=Dr.next,Dr.next=null),Dr.weak=!1,Dr._immutable=!1,Dr.x=Ar,Dr.y=Er;var jr=Dr;if(null!=We.flowpoly.head&&(We.flowsegs.add(We.flowpoly.head.elt),We.flowsegs.add(jr)),We.flowpoly.add(jr),null==Sl&&(Sl=We.flowpoly.head.elt),kr){var Fr=0,Br=0,Rr=br;Fr=Ql.x+(er.x-Ql.x)*Rr,Br=Ql.y+(er.y-Ql.y)*Rr;var Gr,Yr=We.flowpoly;null==Ct.zpp_pool?Gr=new Ct:(Gr=Ct.zpp_pool,Ct.zpp_pool=Gr.next,Gr.next=null),Gr.weak=!1,Gr._immutable=!1,Gr.x=Fr,Gr.y=Br,Yr.add(Gr)}}}Ql=er,al=nr,pl=tr,nr=nr.next,null==nr&&(nr=e.polygon.gverts.next);break}for(;nr!=$l;){var Ur=nr,Zr=pl+1;if(Zr==e.polygon.edgeCnt&&(Zr=0),Li[pl]){if(il[Zr]){var qr=0,Wr=0;qr=Ur.x-Ql.x,Wr=Ur.y-Ql.y;var Xr=0,Hr=0;Xr=Ql.x-n.circle.worldCOMx,Hr=Ql.y-n.circle.worldCOMy;var Kr=qr*qr+Wr*Wr,Jr=2*(Xr*qr+Hr*Wr),Qr=Xr*Xr+Hr*Hr-n.circle.radius*n.circle.radius,$r=Math.sqrt(Jr*Jr-4*Kr*Qr);Kr=1/(2*Kr);var na=(-Jr-$r)*Kr,ea=f.epsilon>na?(-Jr+$r)*Kr:na,ta=0,ia=0,la=ea;ta=Ql.x+(Ur.x-Ql.x)*la,ia=Ql.y+(Ur.y-Ql.y)*la;var ra=0,aa=0;if(ra=Sl.x-ta,aa=Sl.y-ia,f.epsilon>ra*ra+aa*aa){Pl=0,nr=$l;break}var pa;null==Ct.zpp_pool?pa=new Ct:(pa=Ct.zpp_pool,Ct.zpp_pool=pa.next,pa.next=null),pa.weak=!1,pa._immutable=!1,pa.x=ta,pa.y=ia;var sa=pa;We.flowsegs.add(We.flowpoly.head.elt),We.flowsegs.add(sa),We.flowpoly.add(sa),Pl=1,nr=$l;break}var oa=0,ha=0,_a=0,ua=0;_a=Ur.x-Ql.x,ua=Ur.y-Ql.y;var da=0,ca=0;da=Ql.x-n.circle.worldCOMx,ca=Ql.y-n.circle.worldCOMy;var xa,va=_a*_a+ua*ua,za=2*(da*_a+ca*ua),ya=da*da+ca*ca-n.circle.radius*n.circle.radius,fa=za*za-4*va*ya;if(f.epsilon>fa*fa?(0>fa?oa=10:(ha=-za/(2*va),oa=ha),xa=!1):(fa=Math.sqrt(fa),va=1/(2*va),oa=(-za-fa)*va,ha=(-za+fa)*va,xa=!0),1-f.epsilon>oa&&ha>f.epsilon){var ma=0,ba=0,ga=oa;ma=Ql.x+(Ur.x-Ql.x)*ga,ba=Ql.y+(Ur.y-Ql.y)*ga;var wa;if(null!=Sl){var Ca=0,Ma=0;Ca=Sl.x-ma,Ma=Sl.y-ba,wa=f.epsilon>Ca*Ca+Ma*Ma}else wa=!1;if(wa){Pl=0,nr=$l;break}var ka;null==Ct.zpp_pool?ka=new Ct:(ka=Ct.zpp_pool,Ct.zpp_pool=ka.next,ka.next=null),ka.weak=!1,ka._immutable=!1,ka.x=ma,ka.y=ba;var Oa=ka;if(null!=We.flowpoly.head&&(We.flowsegs.add(We.flowpoly.head.elt),We.flowsegs.add(Oa)),We.flowpoly.add(Oa),null==Sl&&(Sl=We.flowpoly.head.elt),xa){var Sa=0,Pa=0,Ta=ha;Sa=Ql.x+(Ur.x-Ql.x)*Ta,Pa=Ql.y+(Ur.y-Ql.y)*Ta;var Aa,Ea=We.flowpoly;null==Ct.zpp_pool?Aa=new Ct:(Aa=Ct.zpp_pool,Ct.zpp_pool=Aa.next,Aa.next=null),Aa.weak=!1,Aa._immutable=!1,Aa.x=Sa,Aa.y=Pa,Ea.add(Aa)}}}Ql=Ur,al=nr,pl=Zr,nr=nr.next,null==nr&&(nr=e.polygon.gverts.next)}}if(null==We.flowpoly.head)return!1;if(null==We.flowpoly.head.next){for(var Ia=!0,Va=e.polygon.edges.head;null!=Va;){var La=Va.elt;if(La.gnormx*n.circle.worldCOMx+La.gnormy*n.circle.worldCOMy>La.gprojection){Ia=!1;break}Va=Va.next}return!!Ia&&(t.overlap=n.circle.area,t.centroidx=n.circle.worldCOMx,t.centroidy=n.circle.worldCOMy,!0)}var Na=0,Da=0,ja=0;if(null!=We.flowpoly.head.next.next){var Fa=0,Ba=0,Ra=0;Ba=0,Ra=0,Fa=0;var Ga=We.flowpoly.head,Ya=Ga.elt;Ga=Ga.next;var Ua=Ga.elt;for(Ga=Ga.next;null!=Ga;){var Za=Ga.elt;Fa+=Ua.x*(Za.y-Ya.y);var qa=Za.y*Ua.x-Za.x*Ua.y;Ba+=(Ua.x+Za.x)*qa,Ra+=(Ua.y+Za.y)*qa,Ya=Ua,Ua=Za,Ga=Ga.next}Ga=We.flowpoly.head;var Wa=Ga.elt;Fa+=Ua.x*(Wa.y-Ya.y);var Xa=Wa.y*Ua.x-Wa.x*Ua.y;Ba+=(Ua.x+Wa.x)*Xa,Ra+=(Ua.y+Wa.y)*Xa,Ya=Ua,Ua=Wa,Ga=Ga.next;var Ha=Ga.elt;Fa+=Ua.x*(Ha.y-Ya.y);var Ka=Ha.y*Ua.x-Ha.x*Ua.y;Ba+=(Ua.x+Ha.x)*Ka,Ra+=(Ua.y+Ha.y)*Ka,Fa*=.5;var Ja=1/(6*Fa),Qa=Ja;Ba*=Qa,Ra*=Qa;var $a=-Fa;Na+=Ba*$a,Da+=Ra*$a,ja-=Fa}else We.flowsegs.add(We.flowpoly.head.elt),We.flowsegs.add(We.flowpoly.head.next.elt);for(;null!=We.flowsegs.head;){var np=We.flowsegs.pop_unsafe(),ep=We.flowsegs.pop_unsafe(),tp=0,ip=0;tp=ep.x-np.x,ip=ep.y-np.y;var lp=0,rp=0;lp=tp,rp=ip;var ap=lp*lp+rp*rp,pp=1/Math.sqrt(ap),sp=pp;lp*=sp,rp*=sp;var op=lp;lp=-rp,rp=op;var hp=0,_p=0;hp=np.x+ep.x,_p=np.y+ep.y;hp*=.5,_p*=.5;hp-=1*n.circle.worldCOMx,_p-=1*n.circle.worldCOMy;var up=lp*hp+rp*_p,dp=0,cp=0,xp=up,vp=xp/n.circle.radius,zp=Math.sqrt(1-vp*vp),yp=Math.acos(vp);dp=n.circle.radius*(n.circle.radius*yp-xp*zp),cp=.6666666666666666*n.circle.radius*zp*zp*zp/(yp-vp*zp),hp=n.circle.worldCOMx,_p=n.circle.worldCOMy;var fp=cp;hp+=lp*fp,_p+=rp*fp;var mp=dp;Na+=hp*mp,Da+=_p*mp,ja+=dp}var bp=1/ja;return Na*=bp,Da*=bp,t.overlap=ja,t.centroidx=Na,t.centroidy=Da,!0}return!1}return!1}var gp=n.circle,wp=e.circle,Cp=0,Mp=0;Cp=wp.worldCOMx-gp.worldCOMx,Mp=wp.worldCOMy-gp.worldCOMy;var kp=gp.radius+wp.radius,Op=Cp*Cp+Mp*Mp;if(Op>kp*kp)return!1;if(f.epsilon*f.epsilon>Op)return wp.radius>gp.radius?(t.overlap=gp.area,t.centroidx=gp.worldCOMx,t.centroidy=gp.worldCOMy):(t.overlap=wp.area,t.centroidx=wp.worldCOMx,t.centroidy=wp.worldCOMy),!0;var Sp=Math.sqrt(Op),Pp=1/Sp,Tp=.5*(Sp-(wp.radius*wp.radius-gp.radius*gp.radius)*Pp);if(-gp.radius<Tp){var Ap=Sp-Tp;if(-wp.radius<Ap){var Ep=0,Ip=0,Vp=0,Lp=0,Np=Tp,Dp=Np/gp.radius,jp=Math.sqrt(1-Dp*Dp),Fp=Math.acos(Dp);Ep=gp.radius*(gp.radius*Fp-Np*jp),Ip=.6666666666666666*gp.radius*jp*jp*jp/(Fp-Dp*jp);var Bp=Ap,Rp=Bp/wp.radius,Gp=Math.sqrt(1-Rp*Rp),Yp=Math.acos(Rp);Vp=wp.radius*(wp.radius*Yp-Bp*Gp),Lp=.6666666666666666*wp.radius*Gp*Gp*Gp/(Yp-Rp*Gp);var Up=Ep+Vp,Zp=(Ip*Ep+(Sp-Lp)*Vp)/Up*Pp;t.overlap=Up,t.centroidx=gp.worldCOMx+Cp*Zp,t.centroidy=gp.worldCOMy+Mp*Zp}else t.overlap=wp.area,t.centroidx=wp.worldCOMx,t.centroidy=wp.worldCOMy}else t.overlap=gp.area,t.centroidx=gp.worldCOMx,t.centroidy=gp.worldCOMy;return!0};var Xe=function(){};l["zpp_nape.geom.ZPP_Convex"]=Xe,Xe.__name__=["zpp_nape","geom","ZPP_Convex"],Xe.isinner=function(n,e,t){var i=0,l=0;i=n.x-e.x,l=n.y-e.y;var r=0;return r=t.x-e.x,(t.y-e.y)*i-r*l>=0},Xe.optimise=function(n){var e=n.vertices,t=n.vertices;if(null!=e)for(var i=e;;){var l=i;if(l.sort(),(i=i.next)==t)break}var r=n.vertices,a=n.vertices;if(null!=r)for(var p=r;;){for(var s=p,o=s.prev,h=null,_=s.diagonals.head;null!=_;){var u=_.elt,d=null==_.next?s.next:_.next.elt;if(Xe.isinner(d,s,o)){for(var c=!0,x=u,v=x.prev,z=null,y=x.diagonals.head;null!=y;){var f=y.elt;if(f==s){var m=null==y.next?x.next:y.next.elt;c=Xe.isinner(m,x,v);break}v=f,z=y,y=y.next}c?(_=s.diagonals.erase(h),x.diagonals.erase(z)):(o=u,h=_,_=_.next)}else h=_,o=u,_=_.next}if((p=p.next)==a)break}};var He=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};l["zpp_nape.geom.ZPP_ConvexRayResult"]=He,He.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],He.getRay=function(n,e,t,i){var l;null==He.rayPool?(He.internal=!0,l=new Cn,l.zpp_inner=new He,l.zpp_inner.ray=l,He.internal=!1):(l=He.rayPool.ray,He.rayPool=He.rayPool.next,l.zpp_inner.next=null);var r=l.zpp_inner;return r.normal=n,n.zpp_inner._immutable=!0,r.toiDistance=e,r.inner=t,r.shape=i,l},He.getConvex=function(n,e,t,i){var l;null==He.convexPool?(He.internal=!0,l=new un,l.zpp_inner=new He,l.zpp_inner.convex=l,He.internal=!1):(l=He.convexPool.convex,He.convexPool=He.convexPool.next,l.zpp_inner.next=null);var r=l.zpp_inner;return r.normal=n,r.position=e,n.zpp_inner._immutable=!0,e.zpp_inner._immutable=!0,r.toiDistance=t,r.shape=i,l},He.prototype={normal:null,shape:null,convex:null,position:null,ray:null,inner:null,next:null,toiDistance:null,disposed:function(){},free:function(){this.normal.zpp_inner._immutable=!1;var n=this.normal,e=n.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var i=n;i.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=i:Cl.poolVec2=i,Cl.nextVec2=i,i.zpp_disp=!0;var l=t;if(null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,null!=this.position){this.position.zpp_inner._immutable=!1;var r=this.position,a=r.zpp_inner;null!=a._isimmutable&&a._isimmutable();var p=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var s=r;s.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=s:Cl.poolVec2=s,Cl.nextVec2=s,s.zpp_disp=!0;var o=p;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Ct.zpp_pool,Ct.zpp_pool=o}this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=He.convexPool,He.convexPool=this):(this.next=He.rayPool,He.rayPool=this)},__class__:He};var Ke=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};l["zpp_nape.geom.ZPP_CutVert"]=Ke,Ke.__name__=["zpp_nape","geom","ZPP_CutVert"],Ke.path=function(n){var e;return null==Ke.zpp_pool?e=new Ke:(e=Ke.zpp_pool,Ke.zpp_pool=e.next,e.next=null),e.vert=n,e.parent=e,e.rank=0,e.used=!1,e},Ke.prototype={prev:null,next:null,posx:null,posy:null,vert:null,value:null,positive:null,parent:null,rank:null,used:null,alloc:function(){},free:function(){this.vert=null,this.parent=null},__class__:Ke};var Je=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};l["zpp_nape.geom.ZPP_CutInt"]=Je,Je.__name__=["zpp_nape","geom","ZPP_CutInt"],Je.get=function(n,e,t,i,l,r,a){null==a&&(a=!1),null==r&&(r=!1);var p;return null==Je.zpp_pool?p=new Je:(p=Je.zpp_pool,Je.zpp_pool=p.next,p.next=null),p.virtualint=r,p.end=e,p.start=t,p.path0=i,p.path1=l,p.time=n,p.vertex=a,p},Je.prototype={next:null,time:null,virtualint:null,vertex:null,path0:null,end:null,start:null,path1:null,alloc:function(){},free:function(){this.end=this.start=null,this.path0=this.path1=null},__class__:Je};var Qe=function(){};l["zpp_nape.geom.ZPP_Cutter"]=Qe,Qe.__name__=["zpp_nape","geom","ZPP_Cutter"],Qe.run=function(n,e,t,i,l,r){var a=0,p=0,s=e.zpp_inner;null!=s._validate&&s._validate(),a=e.zpp_inner.x;var o=e.zpp_inner;null!=o._validate&&o._validate(),p=e.zpp_inner.y;var h=0,_=0,u=t.zpp_inner;null!=u._validate&&u._validate(),h=t.zpp_inner.x-a;var d=t.zpp_inner;null!=d._validate&&d._validate(),_=t.zpp_inner.y-p;for(var c=i?0:-Infinity,x=l?1:Infinity,v=-(p*h-a*_),z=null,y=!1,f=n;;){var m;null==Ke.zpp_pool?m=new Ke:(m=Ke.zpp_pool,Ke.zpp_pool=m.next,m.next=null),m.vert=f,m.posx=m.vert.x,m.posy=m.vert.y,m.value=m.posy*h-m.posx*_+v,m.positive=m.value>0,0==m.value&&(y=!0);var b=m;if(null==z?z=b.prev=b.next=b:(b.prev=z,b.next=z.next,z.next.prev=b,z.next=b),z=b,(f=f.next)==n)break}if(y){var g=null,w=z,C=z;if(null!=w)for(var M=w;;){var k=M;if(0!=k.value){g=k;break}if((M=M.next)==C)break}var O=0,S=0;O=h,S=_;var P=O*O+S*S,T=1/Math.sqrt(P),A=T;O*=A,S*=A;var E=O;O=-S,S=E;for(var I=null,V=g;;)if(0==V.value||null!=I&&V!=I.next){var L=I.value*V.value;if(0!=L){var N,D=I.next;if(L>0)N=I.positive;else{var j=D.next,F=0,B=0;F=D.posx+j.posx,B=D.posy+j.posy;F*=.5,B*=.5;var R=F+1e-8*O,G=B+1e-8*S,Y=!1,U=n,Z=n;if(null!=U)for(var q=U;;){var W=q,X=W.prev;if(!(G>W.y&&X.y>=G||G>X.y&&W.y>=G)||W.x>R&&X.x>R||R>W.x+(G-W.y)/(X.y-W.y)*(X.x-W.x)&&(Y=!Y),(q=q.next)==Z)break}N=Y}var H=D,K=V;if(null!=H)for(var J=H;;){var Q=J;if(Q.positive=N,(J=J.next)==K)break}if(I=V,(V=V.next)==g)break}else if((V=V.next)==g)break}else if(I=V,(V=V.next)==g)break;for(;;){if(0!=V.value&&(null==I||V==I.next)){I=V,V=V.next;break}var $=I.value*V.value;if(0==$){V=V.next;break}var nn,en=I.next;if($>0)nn=I.positive;else{var tn=en.next,ln=0,rn=0;ln=en.posx+tn.posx,rn=en.posy+tn.posy;ln*=.5,rn*=.5;var an=ln+1e-8*O,pn=rn+1e-8*S,sn=!1,on=n,hn=n;if(null!=on)for(var _n=on;;){var un=_n,dn=un.prev;if(!(pn>un.y&&dn.y>=pn||pn>dn.y&&un.y>=pn)||un.x>an&&dn.x>an||an>un.x+(pn-un.y)/(dn.y-un.y)*(dn.x-un.x)&&(sn=!sn),(_n=_n.next)==hn)break}nn=sn}var cn=en,xn=V;if(null!=cn)for(var zn=cn;;){var fn=zn;if(fn.positive=nn,(zn=zn.next)==xn)break}I=V,V=V.next;break}}null==Qe.ints&&(Qe.ints=new ri),null==Qe.paths&&(Qe.paths=new ai);var mn,bn=null,gn=z.posx,wn=z.posy;null==nt.zpp_pool?mn=new nt:(mn=nt.zpp_pool,nt.zpp_pool=mn.next,mn.next=null),mn.forced=!1,mn.x=gn,mn.y=wn;var Cn=mn;null==bn?bn=Cn.prev=Cn.next=Cn:(Cn.next=bn,Cn.prev=bn.prev,bn.prev.next=Cn,bn.prev=Cn);var Mn,kn=bn;null==Ke.zpp_pool?Mn=new Ke:(Mn=Ke.zpp_pool,Ke.zpp_pool=Mn.next,Mn.next=null),Mn.vert=bn,Mn.parent=Mn,Mn.rank=0,Mn.used=!1;var On=Mn;Qe.paths.add(On);for(var Sn=z;;){var Pn,Tn=Sn.next,An=Tn.posx,En=Tn.posy;null==nt.zpp_pool?Pn=new nt:(Pn=nt.zpp_pool,nt.zpp_pool=Pn.next,Pn.next=null),Pn.forced=!1,Pn.x=An,Pn.y=En;var In=Pn;if(Sn.positive==Tn.positive){var Vn=In;null==bn?bn=Vn.prev=Vn.next=Vn:(Vn.next=bn,Vn.prev=bn.prev,bn.prev.next=Vn,bn.prev=Vn)}else{var Ln=0,Nn=0;Ln=Tn.posx-Sn.posx,Nn=Tn.posy-Sn.posy;var Dn=_*Ln-h*Nn;Dn=1/Dn;var jn=0,Fn=0;jn=a-Sn.posx,Fn=p-Sn.posy;var Bn=(Nn*jn-Ln*Fn)*Dn;if(c>Bn||Bn>x){var Rn,Gn=Qe.ints;null==Je.zpp_pool?Rn=new Je:(Rn=Je.zpp_pool,Je.zpp_pool=Rn.next,Rn.next=null),Rn.virtualint=!0,Rn.end=null,Rn.start=null,Rn.path0=null,Rn.path1=null,Rn.time=Bn,Rn.vertex=!1,Gn.add(Rn);var Yn=In;null==bn?bn=Yn.prev=Yn.next=Yn:(Yn.next=bn,Yn.prev=bn.prev,bn.prev.next=Yn,bn.prev=Yn)}else if(0==Sn.value){var Un=bn.prev;bn=null;var Zn,qn=Un.x,Wn=Un.y;null==nt.zpp_pool?Zn=new nt:(Zn=nt.zpp_pool,nt.zpp_pool=Zn.next,Zn.next=null),Zn.forced=!1,Zn.x=qn,Zn.y=Wn;var Xn=Zn;null==bn?bn=Xn.prev=Xn.next=Xn:(Xn.next=bn,Xn.prev=bn.prev,bn.prev.next=Xn,bn.prev=Xn);var Hn=In;null==bn?bn=Hn.prev=Hn.next=Hn:(Hn.next=bn,Hn.prev=bn.prev,bn.prev.next=Hn,bn.prev=Hn);var Kn,Jn=Qe.paths.head.elt,Qn=Qe.paths;null==Ke.zpp_pool?Kn=new Ke:(Kn=Ke.zpp_pool,Ke.zpp_pool=Kn.next,Kn.next=null),Kn.vert=bn,Kn.parent=Kn,Kn.rank=0,Kn.used=!1,Qn.add(Kn);var $n,ne=Qe.paths.head.elt,ee=Qe.ints;null==Je.zpp_pool?$n=new Je:($n=Je.zpp_pool,Je.zpp_pool=$n.next,$n.next=null),$n.virtualint=!0,$n.end=Un,$n.start=bn,$n.path0=Jn,$n.path1=ne,$n.time=Bn,$n.vertex=!1,ee.add($n)}else if(0==Tn.value){var te=In;null==bn?bn=te.prev=te.next=te:(te.next=bn,te.prev=bn.prev,bn.prev.next=te,bn.prev=te);var ie=bn.prev;bn=null;var le,re=Tn.posx,ae=Tn.posy;null==nt.zpp_pool?le=new nt:(le=nt.zpp_pool,nt.zpp_pool=le.next,le.next=null),le.forced=!1,le.x=re,le.y=ae;var pe=le;null==bn?bn=pe.prev=pe.next=pe:(pe.next=bn,pe.prev=bn.prev,bn.prev.next=pe,bn.prev=pe);var se,oe=Qe.paths.head.elt,he=Qe.paths;null==Ke.zpp_pool?se=new Ke:(se=Ke.zpp_pool,Ke.zpp_pool=se.next,se.next=null),se.vert=bn,se.parent=se,se.rank=0,se.used=!1,he.add(se);var _e,ue=Qe.paths.head.elt,de=Qe.ints;null==Je.zpp_pool?_e=new Je:(_e=Je.zpp_pool,Je.zpp_pool=_e.next,_e.next=null),_e.virtualint=!0,_e.end=ie,_e.start=bn,_e.path0=oe,_e.path1=ue,_e.time=Bn,_e.vertex=!1,de.add(_e)}else{var ce=(_*jn-h*Fn)*Dn,xe=0,ve=0;xe=Sn.posx,ve=Sn.posy;var ze=ce;xe+=Ln*ze,ve+=Nn*ze;var ye;null==nt.zpp_pool?ye=new nt:(ye=nt.zpp_pool,nt.zpp_pool=ye.next,ye.next=null),ye.forced=!1,ye.x=xe,ye.y=ve;var fe=ye;null==bn?bn=fe.prev=fe.next=fe:(fe.next=bn,fe.prev=bn.prev,bn.prev.next=fe,bn.prev=fe);var me=bn.prev;bn=null;var be;null==nt.zpp_pool?be=new nt:(be=nt.zpp_pool,nt.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=xe,be.y=ve;var ge=be;null==bn?bn=ge.prev=ge.next=ge:(ge.next=bn,ge.prev=bn.prev,bn.prev.next=ge,bn.prev=ge);var we=In;null==bn?bn=we.prev=we.next=we:(we.next=bn,we.prev=bn.prev,bn.prev.next=we,bn.prev=we);var Ce,Me=Qe.paths.head.elt,ke=Qe.paths;null==Ke.zpp_pool?Ce=new Ke:(Ce=Ke.zpp_pool,Ke.zpp_pool=Ce.next,Ce.next=null),Ce.vert=bn,Ce.parent=Ce,Ce.rank=0,Ce.used=!1,ke.add(Ce);var Oe,Se=Qe.paths.head.elt,Pe=Qe.ints;null==Je.zpp_pool?Oe=new Je:(Oe=Je.zpp_pool,Je.zpp_pool=Oe.next,Oe.next=null),Oe.virtualint=!1,Oe.end=me,Oe.start=bn,Oe.path0=Me,Oe.path1=Se,Oe.time=Bn,Oe.vertex=!1,Pe.add(Oe)}}if((Sn=Sn.next)==z)break}var Te=bn.prev;Te.next.prev=kn.prev,kn.prev.next=Te.next,Te.next=kn,kn.prev=Te;var Ae,Ee=Qe.paths.head.elt;if(On==On.parent)Ae=On;else{for(var Ie=On,Ve=null;Ie!=Ie.parent;){var Le=Ie.parent;Ie.parent=Ve,Ve=Ie,Ie=Le}for(;null!=Ve;){var Ne=Ve.parent;Ve.parent=Ie,Ve=Ne}Ae=Ie}var De;if(Ee==Ee.parent)De=Ee;else{for(var je=Ee,Fe=null;je!=je.parent;){var Be=je.parent;je.parent=Fe,Fe=je,je=Be}for(;null!=Fe;){var Re=Fe.parent;Fe.parent=je,Fe=Re}De=je}Ae!=De&&(De.rank>Ae.rank?Ae.parent=De:Ae.rank>De.rank?De.parent=Ae:(De.parent=Ae,Ae.rank++));var Ge=Qe.ints;if(null!=Ge.head&&null!=Ge.head.next){for(var Ye,Ue,Ze,qe=Ge.head,We=null,Xe=null,He=null,$e=null,et=1;;){for(Ye=0,Xe=qe,qe=null,We=qe;null!=Xe;){for(++Ye,He=Xe,Ue=0,Ze=et;null!=He&&et>Ue;)++Ue,He=He.next;for(;Ue>0||Ze>0&&null!=He;)0==Ue?($e=He,He=He.next,--Ze):0==Ze||null==He?($e=Xe,Xe=Xe.next,--Ue):He.elt.time>Xe.elt.time?($e=Xe,Xe=Xe.next,--Ue):($e=He,He=He.next,--Ze),null!=We?We.next=$e:qe=$e,We=$e;Xe=He}if(We.next=null,et<<=1,Ye<=1)break}Ge.head=qe,Ge.modified=!0,Ge.pushmod=!0}for(;null!=Qe.ints.head;){var tt=Qe.ints.pop_unsafe(),it=Qe.ints.pop_unsafe();if(tt.virtualint||it.virtualint){if(tt.virtualint&&!it.virtualint){var lt;if(null!=it.end&&it.end.prev==it.end){it.end.next=it.end.prev=null;var rt=it.end;if(null!=rt.wrap){rt.wrap.zpp_inner._inuse=!1;var at=rt.wrap,pt=at.zpp_inner;null!=pt._isimmutable&&pt._isimmutable();var st=at.zpp_inner;at.zpp_inner.outer=null,at.zpp_inner=null;var ot=at;ot.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=ot:Cl.poolVec2=ot,Cl.nextVec2=ot,ot.zpp_disp=!0;var ht=st;null!=ht.outer&&(ht.outer.zpp_inner=null,ht.outer=null),ht._isimmutable=null,ht._validate=null,ht._invalidate=null,ht.next=Ct.zpp_pool,Ct.zpp_pool=ht,rt.wrap=null}rt.prev=rt.next=null,rt.next=nt.zpp_pool,nt.zpp_pool=rt,lt=null}else{var _t=it.end.prev;it.end.prev.next=it.end.next,it.end.next.prev=it.end.prev,it.end.next=it.end.prev=null;var ut=it.end;if(null!=ut.wrap){ut.wrap.zpp_inner._inuse=!1;var dt=ut.wrap,ct=dt.zpp_inner;null!=ct._isimmutable&&ct._isimmutable();var xt=dt.zpp_inner;dt.zpp_inner.outer=null,dt.zpp_inner=null;var vt=dt;vt.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=vt:Cl.poolVec2=vt,Cl.nextVec2=vt,vt.zpp_disp=!0;var zt=xt;null!=zt.outer&&(zt.outer.zpp_inner=null,zt.outer=null),zt._isimmutable=null,zt._validate=null,zt._invalidate=null,zt.next=Ct.zpp_pool,Ct.zpp_pool=zt,ut.wrap=null}ut.prev=ut.next=null,ut.next=nt.zpp_pool,nt.zpp_pool=ut,it.end=null,lt=_t}if(it.end=lt,!it.vertex)if(it.end!=it.path0.vert){it.start.x=it.end.x,it.start.y=it.end.y;var yt;if(null!=it.end&&it.end.prev==it.end){it.end.next=it.end.prev=null;var ft=it.end;if(null!=ft.wrap){ft.wrap.zpp_inner._inuse=!1;var mt=ft.wrap,bt=mt.zpp_inner;null!=bt._isimmutable&&bt._isimmutable();var gt=mt.zpp_inner;mt.zpp_inner.outer=null,mt.zpp_inner=null;var wt=mt;wt.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=wt:Cl.poolVec2=wt,Cl.nextVec2=wt,wt.zpp_disp=!0;var Mt=gt;null!=Mt.outer&&(Mt.outer.zpp_inner=null,Mt.outer=null),Mt._isimmutable=null,Mt._validate=null,Mt._invalidate=null,Mt.next=Ct.zpp_pool,Ct.zpp_pool=Mt,ft.wrap=null}ft.prev=ft.next=null,ft.next=nt.zpp_pool,nt.zpp_pool=ft,yt=null}else{var kt=it.end.prev;it.end.prev.next=it.end.next,it.end.next.prev=it.end.prev,it.end.next=it.end.prev=null;var Ot=it.end;if(null!=Ot.wrap){Ot.wrap.zpp_inner._inuse=!1;var St=Ot.wrap,Pt=St.zpp_inner;null!=Pt._isimmutable&&Pt._isimmutable();var Tt=St.zpp_inner;St.zpp_inner.outer=null,St.zpp_inner=null;var At=St;At.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=At:Cl.poolVec2=At,Cl.nextVec2=At,At.zpp_disp=!0;var Et=Tt;null!=Et.outer&&(Et.outer.zpp_inner=null,Et.outer=null),Et._isimmutable=null,Et._validate=null,Et._invalidate=null,Et.next=Ct.zpp_pool,Ct.zpp_pool=Et,Ot.wrap=null}Ot.prev=Ot.next=null,Ot.next=nt.zpp_pool,nt.zpp_pool=Ot,it.end=null,yt=kt}it.end=yt}else{var It=it.start.next;if(it.start.x=It.x,it.start.y=It.y,null!=It&&It.prev==It){It.next=It.prev=null;var Vt=It;if(null!=Vt.wrap){Vt.wrap.zpp_inner._inuse=!1;var Lt=Vt.wrap,Nt=Lt.zpp_inner;null!=Nt._isimmutable&&Nt._isimmutable();var Dt=Lt.zpp_inner;Lt.zpp_inner.outer=null,Lt.zpp_inner=null;var jt=Lt;jt.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=jt:Cl.poolVec2=jt,Cl.nextVec2=jt,jt.zpp_disp=!0;var Ft=Dt;null!=Ft.outer&&(Ft.outer.zpp_inner=null,Ft.outer=null),Ft._isimmutable=null,Ft._validate=null,Ft._invalidate=null,Ft.next=Ct.zpp_pool,Ct.zpp_pool=Ft,Vt.wrap=null}Vt.prev=Vt.next=null,Vt.next=nt.zpp_pool,nt.zpp_pool=Vt,It=null}else{It.prev.next=It.next,It.next.prev=It.prev,It.next=It.prev=null;var Bt=It;if(null!=Bt.wrap){Bt.wrap.zpp_inner._inuse=!1;var Rt=Bt.wrap,Gt=Rt.zpp_inner;null!=Gt._isimmutable&&Gt._isimmutable();var Yt=Rt.zpp_inner;Rt.zpp_inner.outer=null,Rt.zpp_inner=null;var Ut=Rt;Ut.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Ut:Cl.poolVec2=Ut,Cl.nextVec2=Ut,Ut.zpp_disp=!0;var Zt=Yt;null!=Zt.outer&&(Zt.outer.zpp_inner=null,Zt.outer=null),Zt._isimmutable=null,Zt._validate=null,Zt._invalidate=null,Zt.next=Ct.zpp_pool,Ct.zpp_pool=Zt,Bt.wrap=null}Bt.prev=Bt.next=null,Bt.next=nt.zpp_pool,nt.zpp_pool=Bt}}it.end.next.prev=it.start.prev,it.start.prev.next=it.end.next,it.end.next=it.start,it.start.prev=it.end;var qt;if(it.path0==it.path0.parent)qt=it.path0;else{for(var Wt=it.path0,Xt=null;Wt!=Wt.parent;){var Ht=Wt.parent;Wt.parent=Xt,Xt=Wt,Wt=Ht}for(;null!=Xt;){var Kt=Xt.parent;Xt.parent=Wt,Xt=Kt}qt=Wt}var Jt;if(it.path1==it.path1.parent)Jt=it.path1;else{for(var Qt=it.path1,$t=null;Qt!=Qt.parent;){var ni=Qt.parent;Qt.parent=$t,$t=Qt,Qt=ni}for(;null!=$t;){var ei=$t.parent;$t.parent=Qt,$t=ei}Jt=Qt}qt!=Jt&&(Jt.rank>qt.rank?qt.parent=Jt:qt.rank>Jt.rank?Jt.parent=qt:(Jt.parent=qt,qt.rank++))}else if(it.virtualint&&!tt.virtualint){var ti;if(null!=tt.end&&tt.end.prev==tt.end){tt.end.next=tt.end.prev=null;var ii=tt.end;if(null!=ii.wrap){ii.wrap.zpp_inner._inuse=!1;var li=ii.wrap,pi=li.zpp_inner;null!=pi._isimmutable&&pi._isimmutable();var si=li.zpp_inner;li.zpp_inner.outer=null,li.zpp_inner=null;var oi=li;oi.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=oi:Cl.poolVec2=oi,Cl.nextVec2=oi,oi.zpp_disp=!0;var hi=si;null!=hi.outer&&(hi.outer.zpp_inner=null,hi.outer=null),hi._isimmutable=null,hi._validate=null,hi._invalidate=null,hi.next=Ct.zpp_pool,Ct.zpp_pool=hi,ii.wrap=null}ii.prev=ii.next=null,ii.next=nt.zpp_pool,nt.zpp_pool=ii,ti=null}else{var _i=tt.end.prev;tt.end.prev.next=tt.end.next,tt.end.next.prev=tt.end.prev,tt.end.next=tt.end.prev=null;var ui=tt.end;if(null!=ui.wrap){ui.wrap.zpp_inner._inuse=!1;var di=ui.wrap,ci=di.zpp_inner;null!=ci._isimmutable&&ci._isimmutable();var xi=di.zpp_inner;di.zpp_inner.outer=null,di.zpp_inner=null;var vi=di;vi.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=vi:Cl.poolVec2=vi,Cl.nextVec2=vi,vi.zpp_disp=!0;var zi=xi;null!=zi.outer&&(zi.outer.zpp_inner=null,zi.outer=null),zi._isimmutable=null,zi._validate=null,zi._invalidate=null,zi.next=Ct.zpp_pool,Ct.zpp_pool=zi,ui.wrap=null}ui.prev=ui.next=null,ui.next=nt.zpp_pool,nt.zpp_pool=ui,tt.end=null,ti=_i}if(tt.end=ti,!tt.vertex)if(tt.end!=tt.path0.vert){tt.start.x=tt.end.x,tt.start.y=tt.end.y;var yi;if(null!=tt.end&&tt.end.prev==tt.end){tt.end.next=tt.end.prev=null;var fi=tt.end;if(null!=fi.wrap){fi.wrap.zpp_inner._inuse=!1;var mi=fi.wrap,bi=mi.zpp_inner;null!=bi._isimmutable&&bi._isimmutable();var gi=mi.zpp_inner;mi.zpp_inner.outer=null,mi.zpp_inner=null;var wi=mi;wi.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=wi:Cl.poolVec2=wi,Cl.nextVec2=wi,wi.zpp_disp=!0;var Ci=gi;null!=Ci.outer&&(Ci.outer.zpp_inner=null,Ci.outer=null),Ci._isimmutable=null,Ci._validate=null,Ci._invalidate=null,Ci.next=Ct.zpp_pool,Ct.zpp_pool=Ci,fi.wrap=null}fi.prev=fi.next=null,fi.next=nt.zpp_pool,nt.zpp_pool=fi,yi=null}else{var Mi=tt.end.prev;tt.end.prev.next=tt.end.next,tt.end.next.prev=tt.end.prev,tt.end.next=tt.end.prev=null;var ki=tt.end;if(null!=ki.wrap){ki.wrap.zpp_inner._inuse=!1;var Oi=ki.wrap,Si=Oi.zpp_inner;null!=Si._isimmutable&&Si._isimmutable();var Pi=Oi.zpp_inner;Oi.zpp_inner.outer=null,Oi.zpp_inner=null;var Ti=Oi;Ti.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Ti:Cl.poolVec2=Ti,Cl.nextVec2=Ti,Ti.zpp_disp=!0;var Ai=Pi;null!=Ai.outer&&(Ai.outer.zpp_inner=null,Ai.outer=null),Ai._isimmutable=null,Ai._validate=null,Ai._invalidate=null,Ai.next=Ct.zpp_pool,Ct.zpp_pool=Ai,ki.wrap=null}ki.prev=ki.next=null,ki.next=nt.zpp_pool,nt.zpp_pool=ki,tt.end=null,yi=Mi}tt.end=yi}else{var Ei=tt.start.next;if(tt.start.x=Ei.x,tt.start.y=Ei.y,null!=Ei&&Ei.prev==Ei){Ei.next=Ei.prev=null;var Ii=Ei;if(null!=Ii.wrap){Ii.wrap.zpp_inner._inuse=!1;var Vi=Ii.wrap,Li=Vi.zpp_inner;null!=Li._isimmutable&&Li._isimmutable();var Ni=Vi.zpp_inner;Vi.zpp_inner.outer=null,Vi.zpp_inner=null;var Di=Vi;Di.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Di:Cl.poolVec2=Di,Cl.nextVec2=Di,Di.zpp_disp=!0;var ji=Ni;null!=ji.outer&&(ji.outer.zpp_inner=null,ji.outer=null),ji._isimmutable=null,ji._validate=null,ji._invalidate=null,ji.next=Ct.zpp_pool,Ct.zpp_pool=ji,Ii.wrap=null}Ii.prev=Ii.next=null,Ii.next=nt.zpp_pool,nt.zpp_pool=Ii,Ei=null}else{Ei.prev.next=Ei.next,Ei.next.prev=Ei.prev,Ei.next=Ei.prev=null;var Fi=Ei;if(null!=Fi.wrap){Fi.wrap.zpp_inner._inuse=!1;var Bi=Fi.wrap,Ri=Bi.zpp_inner;null!=Ri._isimmutable&&Ri._isimmutable();var Gi=Bi.zpp_inner;Bi.zpp_inner.outer=null,Bi.zpp_inner=null;var Yi=Bi;Yi.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=Yi:Cl.poolVec2=Yi,Cl.nextVec2=Yi,Yi.zpp_disp=!0;var Ui=Gi;null!=Ui.outer&&(Ui.outer.zpp_inner=null,Ui.outer=null),Ui._isimmutable=null,Ui._validate=null,Ui._invalidate=null,Ui.next=Ct.zpp_pool,Ct.zpp_pool=Ui,Fi.wrap=null}Fi.prev=Fi.next=null,Fi.next=nt.zpp_pool,nt.zpp_pool=Fi}}tt.end.next.prev=tt.start.prev,tt.start.prev.next=tt.end.next,tt.end.next=tt.start,tt.start.prev=tt.end;var Zi;if(tt.path0==tt.path0.parent)Zi=tt.path0;else{for(var qi=tt.path0,Wi=null;qi!=qi.parent;){var Xi=qi.parent;qi.parent=Wi,Wi=qi,qi=Xi}for(;null!=Wi;){var Hi=Wi.parent;Wi.parent=qi,Wi=Hi}Zi=qi}var Ki;if(tt.path1==tt.path1.parent)Ki=tt.path1;else{for(var Ji=tt.path1,Qi=null;Ji!=Ji.parent;){var $i=Ji.parent;Ji.parent=Qi,Qi=Ji,Ji=$i}for(;null!=Qi;){var nl=Qi.parent;Qi.parent=Ji,Qi=nl}Ki=Ji}Zi!=Ki&&(Ki.rank>Zi.rank?Zi.parent=Ki:Zi.rank>Ki.rank?Ki.parent=Zi:(Ki.parent=Zi,Zi.rank++))}}else{tt.end.next.prev=it.start.prev,it.start.prev.next=tt.end.next,tt.end.next=it.start,it.start.prev=tt.end,it.end.next.prev=tt.start.prev,tt.start.prev.next=it.end.next,it.end.next=tt.start,tt.start.prev=it.end;var el;if(tt.path0==tt.path0.parent)el=tt.path0;else{for(var tl=tt.path0,il=null;tl!=tl.parent;){var ll=tl.parent;tl.parent=il,il=tl,tl=ll}for(;null!=il;){var rl=il.parent;il.parent=tl,il=rl}el=tl}var al;if(it.path1==it.path1.parent)al=it.path1;else{for(var pl=it.path1,sl=null;pl!=pl.parent;){var ol=pl.parent;pl.parent=sl,sl=pl,pl=ol}for(;null!=sl;){var hl=sl.parent;sl.parent=pl,sl=hl}al=pl}el!=al&&(al.rank>el.rank?el.parent=al:el.rank>al.rank?al.parent=el:(al.parent=el,el.rank++));var _l;if(tt.path1==tt.path1.parent)_l=tt.path1;else{for(var ul=tt.path1,dl=null;ul!=ul.parent;){var cl=ul.parent;ul.parent=dl,dl=ul,ul=cl}for(;null!=dl;){var xl=dl.parent;dl.parent=ul,dl=xl}_l=ul}var vl;if(it.path0==it.path0.parent)vl=it.path0;else{for(var zl=it.path0,yl=null;zl!=zl.parent;){var fl=zl.parent;zl.parent=yl,yl=zl,zl=fl}for(;null!=yl;){var ml=yl.parent;yl.parent=zl,yl=ml}vl=zl}_l!=vl&&(vl.rank>_l.rank?_l.parent=vl:_l.rank>vl.rank?vl.parent=_l:(vl.parent=_l,_l.rank++))}var bl=tt;bl.end=bl.start=null,bl.path0=bl.path1=null,bl.next=Je.zpp_pool,Je.zpp_pool=bl;var gl=it;gl.end=gl.start=null,gl.path0=gl.path1=null,gl.next=Je.zpp_pool,Je.zpp_pool=gl}for(var wl=null==r?new yn:r,Ml=Qe.paths.head;null!=Ml;){var kl,Ol=Ml.elt;if(Ol==Ol.parent)kl=Ol;else{for(var Sl=Ol,Pl=null;Sl!=Sl.parent;){var Tl=Sl.parent;Sl.parent=Pl,Pl=Sl,Sl=Tl}for(;null!=Pl;){var Al=Pl.parent;Pl.parent=Sl,Pl=Al}kl=Sl}if(kl.used)Ml=Ml.next;else{kl.used=!0;for(var El=kl.vert,Il=!0;null!=kl.vert&&(Il||El!=kl.vert);)if(Il=!1,El.x==El.next.x&&El.y==El.next.y)if(El==kl.vert&&(kl.vert=El.next==El?null:El.next,Il=!0),null!=El&&El.prev==El)El.next=El.prev=null,El=null,El=El;else{var Vl=El.next;El.prev.next=El.next,El.next.prev=El.prev,El.next=El.prev=null,El=null,El=Vl}else El=El.next;if(null!=kl.vert){var Ll=vn.get();Ll.zpp_inner.vertices=kl.vert,wl.zpp_inner.reverse_flag?wl.push(Ll):wl.unshift(Ll)}Ml=Ml.next}}for(;null!=Qe.paths.head;){var Nl=Qe.paths.pop_unsafe(),Dl=Nl;Dl.vert=null,Dl.parent=null,Dl.next=Ke.zpp_pool,Ke.zpp_pool=Dl}for(;null!=z;)if(null!=z&&z.prev==z){z.next=z.prev=null;var jl=z;jl.vert=null,jl.parent=null,jl.next=Ke.zpp_pool,Ke.zpp_pool=jl,z=null,z=z}else{var Fl=z.next;z.prev.next=z.next,z.next.prev=z.prev,z.next=z.prev=null;var Bl=z;Bl.vert=null,Bl.parent=null,Bl.next=Ke.zpp_pool,Ke.zpp_pool=Bl,z=null,z=Fl}return wl};var $e=function(){};l["zpp_nape.geom.ZPP_Geom"]=$e,$e.__name__=["zpp_nape","geom","ZPP_Geom"],$e.validateShape=function(n){if(n.type==ye.id_ShapeType_POLYGON){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var l=e.lverts.next,r=e.gverts.next;null!=r;){var a=r,p=l;l=l.next,a.x=e.body.posx+(e.body.axisy*p.x-e.body.axisx*p.y),a.y=e.body.posy+(p.x*e.body.axisx+p.y*e.body.axisy),r=r.next}}var s=e.edges.head,o=e.gverts.next,h=o;for(o=o.next;null!=o;){var _=o,u=s.elt;s=s.next,u.gp0=h,u.gp1=_,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,h=_,o=o.next}var d=e.gverts.next,c=s.elt;s=s.next,c.gp0=h,c.gp1=d,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var x=n.circle;if(x.zip_worldCOM&&null!=x.body){if(x.zip_worldCOM=!1,x.zip_localCOM){if(x.zip_localCOM=!1,x.type==ye.id_ShapeType_POLYGON){var v=x.polygon;if(null==v.lverts.next.next)v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;else if(null==v.lverts.next.next.next){v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;v.localCOMx+=1*v.lverts.next.next.x,v.localCOMy+=1*v.lverts.next.next.y;v.localCOMx*=.5,v.localCOMy*=.5}else{v.localCOMx=0,v.localCOMy=0;var z=0,y=v.lverts.next,f=y;y=y.next;var m=y;for(y=y.next;null!=y;){var b=y;z+=m.x*(b.y-f.y);var g=b.y*m.x-b.x*m.y;v.localCOMx+=(m.x+b.x)*g,v.localCOMy+=(m.y+b.y)*g,f=m,m=b,y=y.next}y=v.lverts.next;var w=y;z+=m.x*(w.y-f.y);var C=w.y*m.x-w.x*m.y;v.localCOMx+=(m.x+w.x)*C,v.localCOMy+=(m.y+w.y)*C,f=m,m=w,y=y.next;var M=y;z+=m.x*(M.y-f.y);var k=M.y*m.x-M.x*m.y;v.localCOMx+=(m.x+M.x)*k,v.localCOMy+=(m.y+M.y)*k,z=1/(3*z);var O=z;v.localCOMx*=O,v.localCOMy*=O}}null!=x.wrap_localCOM&&(x.wrap_localCOM.zpp_inner.x=x.localCOMx,x.wrap_localCOM.zpp_inner.y=x.localCOMy)}var S=x.body;S.zip_axis&&(S.zip_axis=!1,S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)),x.worldCOMx=x.body.posx+(x.body.axisy*x.localCOMx-x.body.axisx*x.localCOMy),x.worldCOMy=x.body.posy+(x.localCOMx*x.body.axisx+x.localCOMy*x.body.axisy)}var P=x.radius,T=x.radius;x.aabb.minx=x.worldCOMx-P,x.aabb.miny=x.worldCOMy-T,x.aabb.maxx=x.worldCOMx+P,x.aabb.maxy=x.worldCOMy+T}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var E=A.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot));for(var I=A.lverts.next,V=A.gverts.next;null!=V;){var L=V,N=I;I=I.next,L.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),L.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),V=V.next}}var D=A.gverts.next;A.aabb.minx=D.x,A.aabb.miny=D.y,A.aabb.maxx=D.x,A.aabb.maxy=D.y;for(var j=A.gverts.next.next;null!=j;){var F=j;A.aabb.minx>F.x&&(A.aabb.minx=F.x),F.x>A.aabb.maxx&&(A.aabb.maxx=F.x),A.aabb.miny>F.y&&(A.aabb.miny=F.y),F.y>A.aabb.maxy&&(A.aabb.maxy=F.y),j=j.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var B=n.polygon;if(null==B.lverts.next.next)B.localCOMx=B.lverts.next.x,B.localCOMy=B.lverts.next.y;else if(null==B.lverts.next.next.next){B.localCOMx=B.lverts.next.x,B.localCOMy=B.lverts.next.y;B.localCOMx+=1*B.lverts.next.next.x,B.localCOMy+=1*B.lverts.next.next.y;B.localCOMx*=.5,B.localCOMy*=.5}else{B.localCOMx=0,B.localCOMy=0;var R=0,G=B.lverts.next,Y=G;G=G.next;var U=G;for(G=G.next;null!=G;){var Z=G;R+=U.x*(Z.y-Y.y);var q=Z.y*U.x-Z.x*U.y;B.localCOMx+=(U.x+Z.x)*q,B.localCOMy+=(U.y+Z.y)*q,Y=U,U=Z,G=G.next}G=B.lverts.next;var W=G;R+=U.x*(W.y-Y.y);var X=W.y*U.x-W.x*U.y;B.localCOMx+=(U.x+W.x)*X,B.localCOMy+=(U.y+W.y)*X,Y=U,U=W,G=G.next;var H=G;R+=U.x*(H.y-Y.y);var K=H.y*U.x-H.x*U.y;B.localCOMx+=(U.x+H.x)*K,B.localCOMy+=(U.y+H.y)*K,R=1/(3*R);var J=R;B.localCOMx*=J,B.localCOMy*=J}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var Q=n.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}};var nt=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};l["zpp_nape.geom.ZPP_GeomVert"]=nt,nt.__name__=["zpp_nape","geom","ZPP_GeomVert"],nt.get=function(n,e){var t;return null==nt.zpp_pool?t=new nt:(t=nt.zpp_pool,nt.zpp_pool=t.next,t.next=null),t.forced=!1,t.x=n,t.y=e,t},nt.prototype={x:null,y:null,prev:null,next:null,wrap:null,forced:null,free:function(){if(null!=this.wrap){this.wrap.zpp_inner._inuse=!1;var n=this.wrap,e=n.zpp_inner;null!=e._isimmutable&&e._isimmutable();var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var i=n;i.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=i:Cl.poolVec2=i,Cl.nextVec2=i,i.zpp_disp=!0;var l=t;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,this.wrap=null}this.prev=this.next=null},alloc:function(){this.forced=!1},wrapper:function(){if(null==this.wrap){var n,e=this.x,i=this.y;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap=n,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=t(this,this.modwrap),this.wrap.zpp_inner._validate=t(this,this.getwrap)}return this.wrap},modwrap:function(n){this.x=n.x,this.y=n.y},getwrap:function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},__class__:nt};var et=function(n){this.vertices=null,this.outer=null,this.outer=n};l["zpp_nape.geom.ZPP_GeomPoly"]=et,et.__name__=["zpp_nape","geom","ZPP_GeomPoly"],et.prototype={outer:null,vertices:null,__class__:et};var tt=function Xl(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,Xl.internal=!0,this.outer=new fn,Xl.internal=!1};l["zpp_nape.geom.ZPP_GeomVertexIterator"]=tt,tt.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],tt.get=function(n,e){var t;return null==tt.zpp_pool?t=new tt:(t=tt.zpp_pool,tt.zpp_pool=t.next,t.next=null),t.outer.zpp_inner=t,t.ptr=n,t.forward=e,t.start=n,t.first=null!=n,t.outer},tt.prototype={ptr:null,start:null,first:null,forward:null,outer:null,next:null,free:function(){this.outer.zpp_inner=null,this.ptr=this.start=null},alloc:function(){},__class__:tt};var it=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};l["zpp_nape.geom.ZPP_MarchSpan"]=it,it.__name__=["zpp_nape","geom","ZPP_MarchSpan"],it.prototype={parent:null,rank:null,out:null,next:null,free:function(){this.parent=this},alloc:function(){this.out=!1,this.rank=0},__class__:it};var lt=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};l["zpp_nape.geom.ZPP_MarchPair"]=lt,lt.__name__=["zpp_nape","geom","ZPP_MarchPair"],lt.prototype={p1:null,key1:null,okey1:null,p2:null,key2:null,okey2:null,pr:null,keyr:null,okeyr:null,pd:null,span1:null,span2:null,spanr:null,next:null,free:function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},alloc:function(){},__class__:lt};var rt=function(){};l["zpp_nape.geom.ZPP_MarchingSquares"]=rt,rt.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],rt.isos=null,rt.ints=null,rt.map=null,rt.run=function(n,e,t,i,l,r,a,p,s){var o=r.zpp_inner;null!=o._validate&&o._validate();var h=(i-e)/r.zpp_inner.x,_=0|h,u=r.zpp_inner;null!=u._validate&&u._validate();var d=(l-t)/r.zpp_inner.y,c=0|d;h!=_&&++_,d!=c&&++c,p&&(null==rt.map?rt.map=new Kt(_,c):rt.map.resize(_,c,null)),null==rt.isos?rt.isos=new Xt(_+1,c+1):rt.isos.resize(_+1,c+1,0);for(var x=0,v=c+1;v>x;){var z,y=x++;if(0==y)z=t;else if(c<y)z=l;else{var f=r.zpp_inner;null!=f._validate&&f._validate(),z=t+r.zpp_inner.y*y}for(var m=0,b=_+1;b>m;){var g,w=m++;if(0==w)g=e;else if(_<w)g=i;else{var C=r.zpp_inner;null!=C._validate&&C._validate(),g=e+r.zpp_inner.x*w}var M=rt.isos;M.list[y*M.width+w]=n(g,z)}}null==rt.ints?rt.ints=new Ht(_+1,1+(c<<1)):rt.ints.resize(_+1,1+(c<<1),null);var k=null;p&&(null==it.zpp_pool?k=new it:(k=it.zpp_pool,it.zpp_pool=k.next,k.next=null),k.out=!1,k.rank=0);for(var O=t,S=0,P=c;P>S;){var T,A=S++,E=O;if(A==c-1)T=l;else{var I=r.zpp_inner;null!=I._validate&&I._validate(),T=t+r.zpp_inner.y*(A+1)}O=T;for(var V=e,L=null,N=0,D=_;D>N;){var j,F=N++,B=V;if(F==_-1)j=i;else{var R=r.zpp_inner;null!=R._validate&&R._validate(),j=e+r.zpp_inner.x*(F+1)}V=j;var G=0==F||!p,Y=0==A||!p,U=F==_-1||!p,Z=A==c-1||!p,q=rt.me.marchSquare(n,rt.isos,rt.ints,B,E,j,T,F,A,G,Y,U,Z,a);if(null!=q)if(p){var W=null!=q.p2&&14!=q.okey2?q.p2:q.p1;q.pd=0==(128&(W==q.p2?q.okey2:q.okey1))?W.prev:W.prev.prev;var X=rt.map;X.list[A*X.width+F]=q;var H;if(null!=L){var K=q.key1,J=1&K|(192&K)>>5,Q=0;0!=(1&J)&&++Q,0!=(2&J)&&++Q,0!=(4&J)&&++Q,H=Q>=2}else H=!1;if(H)rt.me.combLR(L,q),q.span1=L.spanr;else{null==it.zpp_pool?q.span1=new it:(q.span1=it.zpp_pool,it.zpp_pool=q.span1.next,q.span1.next=null);var $=q.span1;$.out=!1,$.rank=0,q.span1.next=k,k=q.span1}if(null!=q.p2){null==it.zpp_pool?q.span2=new it:(q.span2=it.zpp_pool,it.zpp_pool=q.span2.next,q.span2.next=null);var nn=q.span2;nn.out=!1,nn.rank=0,q.span2.next=k,k=q.span2,q.spanr=q.span2}else q.spanr=q.span1;var en=(28&q.keyr)>>2,tn=0;0!=(1&en)&&++tn,0!=(2&en)&&++tn,0!=(4&en)&&++tn,L=2>tn?null:q}else{rt.me.output(s,q.p1),null!=q.p2&&rt.me.output(s,q.p2);var ln=q;ln.p1=ln.p2=ln.pr=ln.pd=null,ln.span1=ln.span2=ln.spanr=null,ln.next=lt.zpp_pool,lt.zpp_pool=ln}else L=null}}if(p){for(var rn=1,an=c;an>rn;)for(var pn=rn++,sn=null,on=0,hn=_;hn>on;){var _n=on++,un=rt.map,dn=un.list[pn*un.width+_n];if(null!=dn){var cn=null!=dn.p2&&14==dn.okey2?dn.okey2:dn.okey1,xn=7&cn,vn=0;if(0!=(1&xn)&&++vn,0!=(2&xn)&&++vn,0!=(4&xn)&&++vn,2>vn)sn=null;else{var zn=rt.map,yn=zn.list[(pn-1)*zn.width+_n];if(null!=yn){var fn=null!=yn.p2&&56==yn.okey2?yn.okey2:yn.okey1,mn=(112&fn)>>4,bn=0;if(0!=(1&mn)&&++bn,0!=(2&mn)&&++bn,0!=(4&mn)&&++bn,2>bn)sn=null;else{var gn,wn=null!=yn.p2&&56==yn.okey2?yn.span2:yn.span1,Cn=null!=dn.p2&&14==dn.okey2?dn.span2:dn.span1;if(wn==wn.parent)gn=wn;else{for(var Mn=wn,kn=null;Mn!=Mn.parent;){var On=Mn.parent;Mn.parent=kn,kn=Mn,Mn=On}for(;null!=kn;){var Sn=kn.parent;kn.parent=Mn,kn=Sn}gn=Mn}var Pn;if(Cn==Cn.parent)Pn=Cn;else{for(var Tn=Cn,An=null;Tn!=Tn.parent;){var En=Tn.parent;Tn.parent=An,An=Tn,Tn=En}for(;null!=An;){var In=An.parent;An.parent=Tn,An=In}Pn=Tn}if(gn==Pn)sn!=Cn&&rt.me.combUD_virtual(yn,dn);else{var Vn;if(wn==wn.parent)Vn=wn;else{for(var Ln=wn,Nn=null;Ln!=Ln.parent;){var Dn=Ln.parent;Ln.parent=Nn,Nn=Ln,Ln=Dn}for(;null!=Nn;){var jn=Nn.parent;Nn.parent=Ln,Nn=jn}Vn=Ln}var Fn;if(Cn==Cn.parent)Fn=Cn;else{for(var Bn=Cn,Rn=null;Bn!=Bn.parent;){var Gn=Bn.parent;Bn.parent=Rn,Rn=Bn,Bn=Gn}for(;null!=Rn;){var Yn=Rn.parent;Rn.parent=Bn,Rn=Yn}Fn=Bn}Vn!=Fn&&(Fn.rank>Vn.rank?Vn.parent=Fn:Vn.rank>Fn.rank?Fn.parent=Vn:(Fn.parent=Vn,Vn.rank++)),rt.me.combUD(yn,dn)}var Un=Cn==dn.span2?dn.okey2:dn.okey1;sn=0!=(4&Un)?Cn:null}}else sn=null}}else sn=null}for(var Zn=0,qn=c;qn>Zn;)for(var Wn=Zn++,Xn=0,Hn=_;Hn>Xn;){var Kn=Xn++,Jn=rt.map,Qn=Jn.list[Wn*Jn.width+Kn];if(null!=Qn){var $n;if(Qn.span1==Qn.span1.parent)$n=Qn.span1;else{for(var ne=Qn.span1,ee=null;ne!=ne.parent;){var te=ne.parent;ne.parent=ee,ee=ne,ne=te}for(;null!=ee;){var ie=ee.parent;ee.parent=ne,ee=ie}$n=ne}if($n.out||($n.out=!0,rt.me.output(s,Qn.p1)),null!=Qn.p2){if(Qn.span2==Qn.span2.parent)$n=Qn.span2;else{for(var le=Qn.span2,re=null;le!=le.parent;){var ae=le.parent;le.parent=re,re=le,le=ae}for(;null!=re;){var pe=re.parent;re.parent=le,re=pe}$n=le}$n.out||($n.out=!0,rt.me.output(s,Qn.p2))}var se=Qn;se.p1=se.p2=se.pr=se.pd=null,se.span1=se.span2=se.spanr=null,se.next=lt.zpp_pool,lt.zpp_pool=se;var oe=rt.map;oe.list[Wn*oe.width+Kn]=null}}for(;null!=k;){var he=k;k=he.next;var _e=he;_e.parent=_e,_e.next=it.zpp_pool,it.zpp_pool=_e}}},rt.ISO=function(n,e,t){return n(e,t)},rt.prototype={output:function(n,e){var t;if(null==e||e.next==e||e.next==e.prev)t=!0;else{var i=0,l=e,r=e;if(null!=l)for(var a=l;;){var p=a;if(i+=p.x*(p.next.y-p.prev.y),(a=a.next)==r)break}var s=.5*i;t=f.epsilon*f.epsilon>s*s}if(t)for(;null!=e;)if(null!=e&&e.prev==e)e.next=e.prev=null,e=null,e=e;else{var o=e.next;e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,e=null,e=o}else{var h=vn.get();h.zpp_inner.vertices=e,n.zpp_inner.reverse_flag?n.push(h):n.unshift(h)}},linkright:function(n,e){var t=7&e;return 0==t?n:3==t?n.next.next:n.next},linkleft:function(n,e){return 0==(1&e)?n.prev:n},linkdown:function(n,e){return 0==(128&e)?n.prev:n.prev.prev},linkup:function(n,e){return n},combLR:function(n,e){var t=n.pr,i=7&n.okeyr,l=0==i?t:3==i?t.next.next:t.next,r=e.p1,a=0==(1&e.okey1)?r.prev:r,p=l.next,s=a.prev;if(0!=(4&n.keyr)){e.pr==e.p1&&(e.pr=l.prev),e.p1=l.prev,l.prev.next=a.next,a.next.prev=l.prev;var o=l;if(null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var h=o.wrap,_=h.zpp_inner;null!=_._isimmutable&&_._isimmutable();var u=h.zpp_inner;h.zpp_inner.outer=null,h.zpp_inner=null;var d=h;d.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=d:Cl.poolVec2=d,Cl.nextVec2=d,d.zpp_disp=!0;var c=u;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Ct.zpp_pool,Ct.zpp_pool=c,o.wrap=null}o.prev=o.next=null,o.next=nt.zpp_pool,nt.zpp_pool=o}else l.next=a.next,a.next.prev=l;var x=a;if(null!=x.wrap){x.wrap.zpp_inner._inuse=!1;var v=x.wrap,z=v.zpp_inner;null!=z._isimmutable&&z._isimmutable();var y=v.zpp_inner;v.zpp_inner.outer=null,v.zpp_inner=null;var f=v;f.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=f:Cl.poolVec2=f,Cl.nextVec2=f,f.zpp_disp=!0;var m=y;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Ct.zpp_pool,Ct.zpp_pool=m,x.wrap=null}if(x.prev=x.next=null,x.next=nt.zpp_pool,nt.zpp_pool=x,0!=(16&n.keyr)){e.pd=p.next,p.next.prev=s.prev,s.prev.next=p.next;var b=p;if(null!=b.wrap){b.wrap.zpp_inner._inuse=!1;var g=b.wrap,w=g.zpp_inner;null!=w._isimmutable&&w._isimmutable();var C=g.zpp_inner;g.zpp_inner.outer=null,g.zpp_inner=null;var M=g;M.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=M:Cl.poolVec2=M,Cl.nextVec2=M,M.zpp_disp=!0;var k=C;null!=k.outer&&(k.outer.zpp_inner=null,k.outer=null),k._isimmutable=null,k._validate=null,k._invalidate=null,k.next=Ct.zpp_pool,Ct.zpp_pool=k,b.wrap=null}b.prev=b.next=null,b.next=nt.zpp_pool,nt.zpp_pool=b}else p.prev=s.prev,s.prev.next=p;var O=s;if(null!=O.wrap){O.wrap.zpp_inner._inuse=!1;var S=O.wrap,P=S.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T=S.zpp_inner;S.zpp_inner.outer=null,S.zpp_inner=null;var A=S;A.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=A:Cl.poolVec2=A,Cl.nextVec2=A,A.zpp_disp=!0;var E=T;null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=Ct.zpp_pool,Ct.zpp_pool=E,O.wrap=null}O.prev=O.next=null,O.next=nt.zpp_pool,nt.zpp_pool=O},combUD:function(n,e){var t=null!=e.p2&&14==e.key2?e.p2:e.p1,i=n.pd,l=t,r=i.prev,a=l.next;l.next=i.next,i.next.prev=l;var p=i;if(null!=p.wrap){p.wrap.zpp_inner._inuse=!1;var s=p.wrap,o=s.zpp_inner;null!=o._isimmutable&&o._isimmutable();var h=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var _=s;_.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=_:Cl.poolVec2=_,Cl.nextVec2=_,_.zpp_disp=!0;var u=h;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u,p.wrap=null}p.prev=p.next=null,p.next=nt.zpp_pool,nt.zpp_pool=p,a.prev=r.prev,r.prev.next=a,r==n.p1&&(n.p1=a);var d=r;if(null!=d.wrap){d.wrap.zpp_inner._inuse=!1;var c=d.wrap,x=c.zpp_inner;null!=x._isimmutable&&x._isimmutable();var v=c.zpp_inner;c.zpp_inner.outer=null,c.zpp_inner=null;var z=c;z.zpp_pool=null,null!=Cl.nextVec2?Cl.nextVec2.zpp_pool=z:Cl.poolVec2=z,Cl.nextVec2=z,z.zpp_disp=!0;var y=v;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Ct.zpp_pool,Ct.zpp_pool=y,d.wrap=null}d.prev=d.next=null,d.next=nt.zpp_pool,nt.zpp_pool=d},combUD_virtual:function(n,e){var t=null!=e.p2&&14==e.key2?e.p2:e.p1,i=n.pd,l=t;i.forced=l.forced=i.prev.forced=l.next.forced=!0},combLeft:function(n){var e=1&n|(192&n)>>5,t=0;return 0!=(1&e)&&++t,0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},combRight:function(n){var e=(28&n)>>2,t=0;return 0!=(1&e)&&++t,0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},combUp:function(n){var e=7&n,t=0;return 0!=(1&e)&&++t,0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},combDown:function(n){var e=(112&n)>>4,t=0;return 0!=(1&e)&&++t,0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},comb:function(n){var e=0;return 0!=(1&n)&&++e,0!=(2&n)&&++e,0!=(4&n)&&++e,e>=2},marchSquare:function(n,e,t,i,l,r,a,p,s,o,h,_,u,d){var c=0,x=e.list[s*e.width+p];0>x&&(c|=8);var v=e.list[s*e.width+(p+1)];0>v&&(c|=4);var z=e.list[(s+1)*e.width+(p+1)];0>z&&(c|=2);var y=e.list[(s+1)*e.width+p];if(0>y&&(c|=1),0==c)return null;var f;if(null==lt.zpp_pool?f=new lt:(f=lt.zpp_pool,lt.zpp_pool=f.next,f.next=null),10!=c&&5!=c){var m=rt.look_march[c];f.okey1=m;for(var b=0;8>b;){var g=b++;if(0!=(m&1<<g)){var w=null;if(0==g){var C;null==nt.zpp_pool?C=new nt:(C=nt.zpp_pool,nt.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=i,C.y=l,w=C,(o||h)&&(w.forced=!0)}else if(2==g){var M;null==nt.zpp_pool?M=new nt:(M=nt.zpp_pool,nt.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=r,M.y=l,w=M,(_||h)&&(w.forced=!0)}else if(4==g){var k;null==nt.zpp_pool?k=new nt:(k=nt.zpp_pool,nt.zpp_pool=k.next,k.next=null),k.forced=!1,k.x=r,k.y=a,w=k,(_||u)&&(w.forced=!0)}else if(6==g){var O;null==nt.zpp_pool?O=new nt:(O=nt.zpp_pool,nt.zpp_pool=O.next,O.next=null),O.forced=!1,O.x=i,O.y=a,w=O,(o||u)&&(w.forced=!0)}else if(1==g){if(null==(w=t.list[(s<<1)*t.width+p])){var S,P=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?S=new nt:(S=nt.zpp_pool,nt.zpp_pool=S.next,S.next=null),S.forced=!1,S.x=P,S.y=l,w=S,t.list[(s<<1)*t.width+p]=w}else{var T,A=w.x,E=w.y;null==nt.zpp_pool?T=new nt:(T=nt.zpp_pool,nt.zpp_pool=T.next,T.next=null),T.forced=!1,T.x=A,T.y=E,w=T}h&&(w.forced=!0),w.x!=i&&w.x!=r||(w.x==i&&0!=(1&m)||w.x==r&&0!=(4&m))&&(m^=2)}else if(5==g){if(null==(w=t.list[(2+(s<<1))*t.width+p])){var I,V=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?I=new nt:(I=nt.zpp_pool,nt.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=V,I.y=a,w=I,t.list[(2+(s<<1))*t.width+p]=w}else{var L,N=w.x,D=w.y;null==nt.zpp_pool?L=new nt:(L=nt.zpp_pool,nt.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=N,L.y=D,w=L}u&&(w.forced=!0),w.x!=i&&w.x!=r||(w.x==i&&0!=(64&m)||w.x==r&&0!=(16&m))&&(m^=32)}else if(3==g){if(null==(w=t.list[(1+(s<<1))*t.width+(p+1)])){var j,F=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?j=new nt:(j=nt.zpp_pool,nt.zpp_pool=j.next,j.next=null),j.forced=!1,j.x=r,j.y=F,w=j,t.list[(1+(s<<1))*t.width+(p+1)]=w}else{var B,R=w.x,G=w.y;null==nt.zpp_pool?B=new nt:(B=nt.zpp_pool,nt.zpp_pool=B.next,B.next=null),B.forced=!1,B.x=R,B.y=G,w=B}_&&(w.forced=!0),w.y!=l&&w.y!=a||(w.y==l&&0!=(4&m)||w.y==a&&0!=(16&m))&&(m^=8)}else{if(null==(w=t.list[(1+(s<<1))*t.width+p])){var Y,U=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?Y=new nt:(Y=nt.zpp_pool,nt.zpp_pool=Y.next,Y.next=null),Y.forced=!1,Y.x=i,Y.y=U,w=Y,t.list[(1+(s<<1))*t.width+p]=w}else{var Z,q=w.x,W=w.y;null==nt.zpp_pool?Z=new nt:(Z=nt.zpp_pool,nt.zpp_pool=Z.next,Z.next=null),Z.forced=!1,Z.x=q,Z.y=W,w=Z}o&&(w.forced=!0),w.y!=l&&w.y!=a||(w.y==l&&0!=(1&m)||w.y==a&&0!=(64&m))&&(m^=128)}var X=w;null==f.p1?f.p1=X.prev=X.next=X:(X.prev=f.p1,X.next=f.p1.next,f.p1.next.prev=X,f.p1.next=X),f.p1=X}}f.p1=f.p1.next,f.key1=m,1!=m&&4!=m&&16!=m&&64!=m&&3!=m&&12!=m&&48!=m&&192!=m&&129!=m&&6!=m&&24!=m&&96!=m&&5!=m&&20!=m&&80!=m&&65!=m&&17!=m&&68!=m||(m=0,f.key1=0,f.p1=null),0==m?f=null:(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1)}else{var H=0>n(.5*(i+r),.5*(l+a));if(10==c)if(H){var K=187;f.okey1=K;for(var J=0;8>J;){var Q=J++;if(0!=(K&1<<Q)){var $=null;if(0==Q){var nn;null==nt.zpp_pool?nn=new nt:(nn=nt.zpp_pool,nt.zpp_pool=nn.next,nn.next=null),nn.forced=!1,nn.x=i,nn.y=l,$=nn,(o||h)&&($.forced=!0)}else if(2==Q){var en;null==nt.zpp_pool?en=new nt:(en=nt.zpp_pool,nt.zpp_pool=en.next,en.next=null),en.forced=!1,en.x=r,en.y=l,$=en,(_||h)&&($.forced=!0)}else if(4==Q){var tn;null==nt.zpp_pool?tn=new nt:(tn=nt.zpp_pool,nt.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=r,tn.y=a,$=tn,(_||u)&&($.forced=!0)}else if(6==Q){var ln;null==nt.zpp_pool?ln=new nt:(ln=nt.zpp_pool,nt.zpp_pool=ln.next,ln.next=null),ln.forced=!1,ln.x=i,ln.y=a,$=ln,(o||u)&&($.forced=!0)}else if(1==Q){if(null==($=t.list[(s<<1)*t.width+p])){var rn,an=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?rn=new nt:(rn=nt.zpp_pool,nt.zpp_pool=rn.next,rn.next=null),rn.forced=!1,rn.x=an,rn.y=l,$=rn,t.list[(s<<1)*t.width+p]=$}else{var pn,sn=$.x,on=$.y;null==nt.zpp_pool?pn=new nt:(pn=nt.zpp_pool,nt.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=sn,pn.y=on,$=pn}h&&($.forced=!0),$.x!=i&&$.x!=r||($.x==i&&0!=(1&K)||$.x==r&&0!=(4&K))&&(K^=2)}else if(5==Q){if(null==($=t.list[(2+(s<<1))*t.width+p])){var hn,_n=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?hn=new nt:(hn=nt.zpp_pool,nt.zpp_pool=hn.next,hn.next=null),hn.forced=!1,hn.x=_n,hn.y=a,$=hn,t.list[(2+(s<<1))*t.width+p]=$}else{var un,dn=$.x,cn=$.y;null==nt.zpp_pool?un=new nt:(un=nt.zpp_pool,nt.zpp_pool=un.next,un.next=null),un.forced=!1,un.x=dn,un.y=cn,$=un}u&&($.forced=!0),$.x!=i&&$.x!=r||($.x==i&&0!=(64&K)||$.x==r&&0!=(16&K))&&(K^=32)}else if(3==Q){if(null==($=t.list[(1+(s<<1))*t.width+(p+1)])){var xn,vn=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?xn=new nt:(xn=nt.zpp_pool,nt.zpp_pool=xn.next,xn.next=null),xn.forced=!1,xn.x=r,xn.y=vn,$=xn,t.list[(1+(s<<1))*t.width+(p+1)]=$}else{var zn,yn=$.x,fn=$.y;null==nt.zpp_pool?zn=new nt:(zn=nt.zpp_pool,nt.zpp_pool=zn.next,zn.next=null),zn.forced=!1,zn.x=yn,zn.y=fn,$=zn}_&&($.forced=!0),$.y!=l&&$.y!=a||($.y==l&&0!=(4&K)||$.y==a&&0!=(16&K))&&(K^=8)}else{if(null==($=t.list[(1+(s<<1))*t.width+p])){var mn,bn=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?mn=new nt:(mn=nt.zpp_pool,nt.zpp_pool=mn.next,mn.next=null),mn.forced=!1,mn.x=i,mn.y=bn,$=mn,t.list[(1+(s<<1))*t.width+p]=$}else{var gn,wn=$.x,Cn=$.y;null==nt.zpp_pool?gn=new nt:(gn=nt.zpp_pool,nt.zpp_pool=gn.next,gn.next=null),gn.forced=!1,gn.x=wn,gn.y=Cn,$=gn}o&&($.forced=!0),$.y!=l&&$.y!=a||($.y==l&&0!=(1&K)||$.y==a&&0!=(64&K))&&(K^=128)}var Mn=$;null==f.p1?f.p1=Mn.prev=Mn.next=Mn:(Mn.prev=f.p1,Mn.next=f.p1.next,f.p1.next.prev=Mn,f.p1.next=Mn),f.p1=Mn}}f.p1=f.p1.next,f.key1=K,1!=K&&4!=K&&16!=K&&64!=K&&3!=K&&12!=K&&48!=K&&192!=K&&129!=K&&6!=K&&24!=K&&96!=K&&5!=K&&20!=K&&80!=K&&65!=K&&17!=K&&68!=K||(K=0,f.key1=0,f.p1=null),0==K?f=null:(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1)}else{var kn=131;f.okey1=kn;for(var On=0;8>On;){var Sn=On++;if(0!=(kn&1<<Sn)){var Pn=null;if(0==Sn){var Tn;null==nt.zpp_pool?Tn=new nt:(Tn=nt.zpp_pool,nt.zpp_pool=Tn.next,Tn.next=null),Tn.forced=!1,Tn.x=i,Tn.y=l,Pn=Tn,(o||h)&&(Pn.forced=!0)}else if(2==Sn){var An;null==nt.zpp_pool?An=new nt:(An=nt.zpp_pool,nt.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=r,An.y=l,Pn=An,(_||h)&&(Pn.forced=!0)}else if(4==Sn){var En;null==nt.zpp_pool?En=new nt:(En=nt.zpp_pool,nt.zpp_pool=En.next,En.next=null),En.forced=!1,En.x=r,En.y=a,Pn=En,(_||u)&&(Pn.forced=!0)}else if(6==Sn){var In;null==nt.zpp_pool?In=new nt:(In=nt.zpp_pool,nt.zpp_pool=In.next,In.next=null),In.forced=!1,In.x=i,In.y=a,Pn=In,(o||u)&&(Pn.forced=!0)}else if(1==Sn){if(null==(Pn=t.list[(s<<1)*t.width+p])){var Vn,Ln=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?Vn=new nt:(Vn=nt.zpp_pool,nt.zpp_pool=Vn.next,Vn.next=null),Vn.forced=!1,Vn.x=Ln,Vn.y=l,Pn=Vn,t.list[(s<<1)*t.width+p]=Pn}else{var Nn,Dn=Pn.x,jn=Pn.y;null==nt.zpp_pool?Nn=new nt:(Nn=nt.zpp_pool,nt.zpp_pool=Nn.next,Nn.next=null),Nn.forced=!1,Nn.x=Dn,Nn.y=jn,Pn=Nn}h&&(Pn.forced=!0),Pn.x!=i&&Pn.x!=r||(Pn.x==i&&0!=(1&kn)||Pn.x==r&&0!=(4&kn))&&(kn^=2)}else if(5==Sn){if(null==(Pn=t.list[(2+(s<<1))*t.width+p])){var Fn,Bn=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?Fn=new nt:(Fn=nt.zpp_pool,nt.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=Bn,Fn.y=a,Pn=Fn,t.list[(2+(s<<1))*t.width+p]=Pn}else{var Rn,Gn=Pn.x,Yn=Pn.y;null==nt.zpp_pool?Rn=new nt:(Rn=nt.zpp_pool,nt.zpp_pool=Rn.next,Rn.next=null),Rn.forced=!1,Rn.x=Gn,Rn.y=Yn,Pn=Rn}u&&(Pn.forced=!0),Pn.x!=i&&Pn.x!=r||(Pn.x==i&&0!=(64&kn)||Pn.x==r&&0!=(16&kn))&&(kn^=32)}else if(3==Sn){if(null==(Pn=t.list[(1+(s<<1))*t.width+(p+1)])){var Un,Zn=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?Un=new nt:(Un=nt.zpp_pool,nt.zpp_pool=Un.next,Un.next=null),Un.forced=!1,Un.x=r,Un.y=Zn,Pn=Un,t.list[(1+(s<<1))*t.width+(p+1)]=Pn}else{var qn,Wn=Pn.x,Xn=Pn.y;null==nt.zpp_pool?qn=new nt:(qn=nt.zpp_pool,nt.zpp_pool=qn.next,qn.next=null),qn.forced=!1,qn.x=Wn,qn.y=Xn,Pn=qn}_&&(Pn.forced=!0),Pn.y!=l&&Pn.y!=a||(Pn.y==l&&0!=(4&kn)||Pn.y==a&&0!=(16&kn))&&(kn^=8)}else{if(null==(Pn=t.list[(1+(s<<1))*t.width+p])){var Hn,Kn=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?Hn=new nt:(Hn=nt.zpp_pool,nt.zpp_pool=Hn.next,Hn.next=null),Hn.forced=!1,Hn.x=i,Hn.y=Kn,Pn=Hn,t.list[(1+(s<<1))*t.width+p]=Pn}else{var Jn,Qn=Pn.x,$n=Pn.y;null==nt.zpp_pool?Jn=new nt:(Jn=nt.zpp_pool,nt.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=Qn,Jn.y=$n,Pn=Jn}o&&(Pn.forced=!0),Pn.y!=l&&Pn.y!=a||(Pn.y==l&&0!=(1&kn)||Pn.y==a&&0!=(64&kn))&&(kn^=128)}var ne=Pn;null==f.p1?f.p1=ne.prev=ne.next=ne:(ne.prev=f.p1,ne.next=f.p1.next,f.p1.next.prev=ne,f.p1.next=ne),f.p1=ne}}if(f.p1=f.p1.next,f.key1=kn,1!=kn&&4!=kn&&16!=kn&&64!=kn&&3!=kn&&12!=kn&&48!=kn&&192!=kn&&129!=kn&&6!=kn&&24!=kn&&96!=kn&&5!=kn&&20!=kn&&80!=kn&&65!=kn&&17!=kn&&68!=kn||(kn=0,f.key1=0,f.p1=null),0!=kn){var ee=56;f.okey2=ee;for(var te=0;8>te;){var ie=te++;if(0!=(ee&1<<ie)){var le=null;if(0==ie){var re;null==nt.zpp_pool?re=new nt:(re=nt.zpp_pool,nt.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=i,re.y=l,le=re,(o||h)&&(le.forced=!0)}else if(2==ie){var ae;null==nt.zpp_pool?ae=new nt:(ae=nt.zpp_pool,nt.zpp_pool=ae.next,ae.next=null),ae.forced=!1,ae.x=r,ae.y=l,le=ae,(_||h)&&(le.forced=!0)}else if(4==ie){var pe;null==nt.zpp_pool?pe=new nt:(pe=nt.zpp_pool,nt.zpp_pool=pe.next,pe.next=null),pe.forced=!1,pe.x=r,pe.y=a,le=pe,(_||u)&&(le.forced=!0)}else if(6==ie){var se;null==nt.zpp_pool?se=new nt:(se=nt.zpp_pool,nt.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=i,se.y=a,le=se,(o||u)&&(le.forced=!0)}else if(1==ie){if(null==(le=t.list[(s<<1)*t.width+p])){var oe,he=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?oe=new nt:(oe=nt.zpp_pool,nt.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=he,oe.y=l,le=oe,t.list[(s<<1)*t.width+p]=le}else{var _e,ue=le.x,de=le.y;null==nt.zpp_pool?_e=new nt:(_e=nt.zpp_pool,nt.zpp_pool=_e.next,_e.next=null),_e.forced=!1,_e.x=ue,_e.y=de,le=_e}h&&(le.forced=!0),le.x!=i&&le.x!=r||(le.x==i&&0!=(1&ee)||le.x==r&&0!=(4&ee))&&(ee^=2)}else if(5==ie){if(null==(le=t.list[(2+(s<<1))*t.width+p])){var ce,xe=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?ce=new nt:(ce=nt.zpp_pool,nt.zpp_pool=ce.next,ce.next=null),ce.forced=!1,ce.x=xe,ce.y=a,le=ce,t.list[(2+(s<<1))*t.width+p]=le}else{var ve,ze=le.x,ye=le.y;null==nt.zpp_pool?ve=new nt:(ve=nt.zpp_pool,nt.zpp_pool=ve.next,ve.next=null),ve.forced=!1,ve.x=ze,ve.y=ye,le=ve}u&&(le.forced=!0),le.x!=i&&le.x!=r||(le.x==i&&0!=(64&ee)||le.x==r&&0!=(16&ee))&&(ee^=32)}else if(3==ie){if(null==(le=t.list[(1+(s<<1))*t.width+(p+1)])){var fe,me=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?fe=new nt:(fe=nt.zpp_pool,nt.zpp_pool=fe.next,fe.next=null),fe.forced=!1,fe.x=r,fe.y=me,le=fe,t.list[(1+(s<<1))*t.width+(p+1)]=le}else{var be,ge=le.x,we=le.y;null==nt.zpp_pool?be=new nt:(be=nt.zpp_pool,nt.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=ge,be.y=we,le=be}_&&(le.forced=!0),le.y!=l&&le.y!=a||(le.y==l&&0!=(4&ee)||le.y==a&&0!=(16&ee))&&(ee^=8)}else{if(null==(le=t.list[(1+(s<<1))*t.width+p])){var Ce,Me=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?Ce=new nt:(Ce=nt.zpp_pool,nt.zpp_pool=Ce.next,Ce.next=null),Ce.forced=!1,Ce.x=i,Ce.y=Me,le=Ce,t.list[(1+(s<<1))*t.width+p]=le}else{var ke,Oe=le.x,Se=le.y;null==nt.zpp_pool?ke=new nt:(ke=nt.zpp_pool,nt.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Oe,ke.y=Se,le=ke}o&&(le.forced=!0),le.y!=l&&le.y!=a||(le.y==l&&0!=(1&ee)||le.y==a&&0!=(64&ee))&&(ee^=128)}var Pe=le;null==f.p2?f.p2=Pe.prev=Pe.next=Pe:(Pe.prev=f.p2,Pe.next=f.p2.next,f.p2.next.prev=Pe,f.p2.next=Pe),f.p2=Pe}}f.p2=f.p2.next,f.key2=ee,1!=ee&&4!=ee&&16!=ee&&64!=ee&&3!=ee&&12!=ee&&48!=ee&&192!=ee&&129!=ee&&6!=ee&&24!=ee&&96!=ee&&5!=ee&&20!=ee&&80!=ee&&65!=ee&&17!=ee&&68!=ee||(ee=0,f.key2=0,f.p2=null),0==ee?(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1):(f.pr=f.p2,f.okeyr=f.okey2,f.keyr=f.key2)}else{var Te=56;f.okey1=Te;for(var Ae=0;8>Ae;){var Ee=Ae++;if(0!=(Te&1<<Ee)){var Ie=null;if(0==Ee){var Ve;null==nt.zpp_pool?Ve=new nt:(Ve=nt.zpp_pool,nt.zpp_pool=Ve.next,Ve.next=null),Ve.forced=!1,Ve.x=i,Ve.y=l,Ie=Ve,(o||h)&&(Ie.forced=!0)}else if(2==Ee){var Le;null==nt.zpp_pool?Le=new nt:(Le=nt.zpp_pool,nt.zpp_pool=Le.next,Le.next=null),Le.forced=!1,Le.x=r,Le.y=l,Ie=Le,(_||h)&&(Ie.forced=!0)}else if(4==Ee){var Ne;null==nt.zpp_pool?Ne=new nt:(Ne=nt.zpp_pool,nt.zpp_pool=Ne.next,Ne.next=null),Ne.forced=!1,Ne.x=r,Ne.y=a,Ie=Ne,(_||u)&&(Ie.forced=!0)}else if(6==Ee){var De;null==nt.zpp_pool?De=new nt:(De=nt.zpp_pool,nt.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=i,De.y=a,Ie=De,(o||u)&&(Ie.forced=!0)}else if(1==Ee){if(null==(Ie=t.list[(s<<1)*t.width+p])){var je,Fe=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?je=new nt:(je=nt.zpp_pool,nt.zpp_pool=je.next,je.next=null),je.forced=!1,je.x=Fe,je.y=l,Ie=je,t.list[(s<<1)*t.width+p]=Ie}else{var Be,Re=Ie.x,Ge=Ie.y;null==nt.zpp_pool?Be=new nt:(Be=nt.zpp_pool,nt.zpp_pool=Be.next,Be.next=null),Be.forced=!1,Be.x=Re,Be.y=Ge,Ie=Be}h&&(Ie.forced=!0),Ie.x!=i&&Ie.x!=r||(Ie.x==i&&0!=(1&Te)||Ie.x==r&&0!=(4&Te))&&(Te^=2)}else if(5==Ee){if(null==(Ie=t.list[(2+(s<<1))*t.width+p])){var Ye,Ue=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?Ye=new nt:(Ye=nt.zpp_pool,nt.zpp_pool=Ye.next,Ye.next=null),Ye.forced=!1,Ye.x=Ue,Ye.y=a,Ie=Ye,t.list[(2+(s<<1))*t.width+p]=Ie}else{var Ze,qe=Ie.x,We=Ie.y;null==nt.zpp_pool?Ze=new nt:(Ze=nt.zpp_pool,nt.zpp_pool=Ze.next,Ze.next=null),Ze.forced=!1,Ze.x=qe,Ze.y=We,Ie=Ze}u&&(Ie.forced=!0),Ie.x!=i&&Ie.x!=r||(Ie.x==i&&0!=(64&Te)||Ie.x==r&&0!=(16&Te))&&(Te^=32)}else if(3==Ee){if(null==(Ie=t.list[(1+(s<<1))*t.width+(p+1)])){var Xe,He=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?Xe=new nt:(Xe=nt.zpp_pool,nt.zpp_pool=Xe.next,Xe.next=null),Xe.forced=!1,Xe.x=r,Xe.y=He,Ie=Xe,t.list[(1+(s<<1))*t.width+(p+1)]=Ie}else{var Ke,Je=Ie.x,Qe=Ie.y;null==nt.zpp_pool?Ke=new nt:(Ke=nt.zpp_pool,nt.zpp_pool=Ke.next,Ke.next=null),Ke.forced=!1,Ke.x=Je,Ke.y=Qe,Ie=Ke}_&&(Ie.forced=!0),Ie.y!=l&&Ie.y!=a||(Ie.y==l&&0!=(4&Te)||Ie.y==a&&0!=(16&Te))&&(Te^=8)}else{if(null==(Ie=t.list[(1+(s<<1))*t.width+p])){var $e,et=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?$e=new nt:($e=nt.zpp_pool,nt.zpp_pool=$e.next,$e.next=null),$e.forced=!1,$e.x=i,$e.y=et,Ie=$e,t.list[(1+(s<<1))*t.width+p]=Ie}else{var tt,it=Ie.x,at=Ie.y;null==nt.zpp_pool?tt=new nt:(tt=nt.zpp_pool,nt.zpp_pool=tt.next,tt.next=null),tt.forced=!1,tt.x=it,tt.y=at,Ie=tt}o&&(Ie.forced=!0),Ie.y!=l&&Ie.y!=a||(Ie.y==l&&0!=(1&Te)||Ie.y==a&&0!=(64&Te))&&(Te^=128)}var pt=Ie;null==f.p1?f.p1=pt.prev=pt.next=pt:(pt.prev=f.p1,pt.next=f.p1.next,f.p1.next.prev=pt,f.p1.next=pt),f.p1=pt}}f.p1=f.p1.next,f.key1=Te,1!=Te&&4!=Te&&16!=Te&&64!=Te&&3!=Te&&12!=Te&&48!=Te&&192!=Te&&129!=Te&&6!=Te&&24!=Te&&96!=Te&&5!=Te&&20!=Te&&80!=Te&&65!=Te&&17!=Te&&68!=Te||(Te=0,f.key1=0,f.p1=null),0==Te?f=null:(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1)}}else if(H){var st=238;f.okey1=st;for(var ot=0;8>ot;){var ht=ot++;if(0!=(st&1<<ht)){var _t=null;if(0==ht){var ut;null==nt.zpp_pool?ut=new nt:(ut=nt.zpp_pool,nt.zpp_pool=ut.next,ut.next=null),ut.forced=!1,ut.x=i,ut.y=l,_t=ut,(o||h)&&(_t.forced=!0)}else if(2==ht){var dt;null==nt.zpp_pool?dt=new nt:(dt=nt.zpp_pool,nt.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=r,dt.y=l,_t=dt,(_||h)&&(_t.forced=!0)}else if(4==ht){var ct;null==nt.zpp_pool?ct=new nt:(ct=nt.zpp_pool,nt.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=r,ct.y=a,_t=ct,(_||u)&&(_t.forced=!0)}else if(6==ht){var xt;null==nt.zpp_pool?xt=new nt:(xt=nt.zpp_pool,nt.zpp_pool=xt.next,xt.next=null),xt.forced=!1,xt.x=i,xt.y=a,_t=xt,(o||u)&&(_t.forced=!0)}else if(1==ht){if(null==(_t=t.list[(s<<1)*t.width+p])){var vt,zt=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?vt=new nt:(vt=nt.zpp_pool,nt.zpp_pool=vt.next,vt.next=null),vt.forced=!1,vt.x=zt,vt.y=l,_t=vt,t.list[(s<<1)*t.width+p]=_t}else{var yt,ft=_t.x,mt=_t.y;null==nt.zpp_pool?yt=new nt:(yt=nt.zpp_pool,nt.zpp_pool=yt.next,yt.next=null),yt.forced=!1,yt.x=ft,yt.y=mt,_t=yt}h&&(_t.forced=!0),_t.x!=i&&_t.x!=r||(_t.x==i&&0!=(1&st)||_t.x==r&&0!=(4&st))&&(st^=2)}else if(5==ht){if(null==(_t=t.list[(2+(s<<1))*t.width+p])){var bt,gt=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?bt=new nt:(bt=nt.zpp_pool,nt.zpp_pool=bt.next,bt.next=null),bt.forced=!1,bt.x=gt,bt.y=a,_t=bt,t.list[(2+(s<<1))*t.width+p]=_t}else{var wt,Ct=_t.x,Mt=_t.y;null==nt.zpp_pool?wt=new nt:(wt=nt.zpp_pool,nt.zpp_pool=wt.next,wt.next=null),wt.forced=!1,wt.x=Ct,wt.y=Mt,_t=wt}u&&(_t.forced=!0),_t.x!=i&&_t.x!=r||(_t.x==i&&0!=(64&st)||_t.x==r&&0!=(16&st))&&(st^=32)}else if(3==ht){if(null==(_t=t.list[(1+(s<<1))*t.width+(p+1)])){var kt,Ot=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?kt=new nt:(kt=nt.zpp_pool,nt.zpp_pool=kt.next,kt.next=null),kt.forced=!1,kt.x=r,kt.y=Ot,_t=kt,t.list[(1+(s<<1))*t.width+(p+1)]=_t}else{var St,Pt=_t.x,Tt=_t.y;null==nt.zpp_pool?St=new nt:(St=nt.zpp_pool,nt.zpp_pool=St.next,St.next=null),St.forced=!1,St.x=Pt,St.y=Tt,_t=St}_&&(_t.forced=!0),_t.y!=l&&_t.y!=a||(_t.y==l&&0!=(4&st)||_t.y==a&&0!=(16&st))&&(st^=8)}else{if(null==(_t=t.list[(1+(s<<1))*t.width+p])){var At,Et=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?At=new nt:(At=nt.zpp_pool,nt.zpp_pool=At.next,At.next=null),At.forced=!1,At.x=i,At.y=Et,_t=At,t.list[(1+(s<<1))*t.width+p]=_t}else{var It,Vt=_t.x,Lt=_t.y;null==nt.zpp_pool?It=new nt:(It=nt.zpp_pool,nt.zpp_pool=It.next,It.next=null),It.forced=!1,It.x=Vt,It.y=Lt,_t=It}o&&(_t.forced=!0),_t.y!=l&&_t.y!=a||(_t.y==l&&0!=(1&st)||_t.y==a&&0!=(64&st))&&(st^=128)}var Nt=_t;null==f.p1?f.p1=Nt.prev=Nt.next=Nt:(Nt.prev=f.p1,Nt.next=f.p1.next,f.p1.next.prev=Nt,f.p1.next=Nt),f.p1=Nt}}f.p1=f.p1.next,f.key1=st,1!=st&&4!=st&&16!=st&&64!=st&&3!=st&&12!=st&&48!=st&&192!=st&&129!=st&&6!=st&&24!=st&&96!=st&&5!=st&&20!=st&&80!=st&&65!=st&&17!=st&&68!=st||(st=0,f.key1=0,f.p1=null),0==st?f=null:(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1)}else{var Dt=224;f.okey1=Dt;for(var jt=0;8>jt;){var Ft=jt++;if(0!=(Dt&1<<Ft)){var Bt=null;if(0==Ft){var Rt;null==nt.zpp_pool?Rt=new nt:(Rt=nt.zpp_pool,nt.zpp_pool=Rt.next,Rt.next=null),Rt.forced=!1,Rt.x=i,Rt.y=l,Bt=Rt,(o||h)&&(Bt.forced=!0)}else if(2==Ft){var Gt;null==nt.zpp_pool?Gt=new nt:(Gt=nt.zpp_pool,nt.zpp_pool=Gt.next,Gt.next=null),Gt.forced=!1,Gt.x=r,Gt.y=l,Bt=Gt,(_||h)&&(Bt.forced=!0)}else if(4==Ft){var Yt;null==nt.zpp_pool?Yt=new nt:(Yt=nt.zpp_pool,nt.zpp_pool=Yt.next,Yt.next=null),Yt.forced=!1,Yt.x=r,Yt.y=a,Bt=Yt,(_||u)&&(Bt.forced=!0)}else if(6==Ft){var Ut;null==nt.zpp_pool?Ut=new nt:(Ut=nt.zpp_pool,nt.zpp_pool=Ut.next,Ut.next=null),Ut.forced=!1,Ut.x=i,Ut.y=a,Bt=Ut,(o||u)&&(Bt.forced=!0)}else if(1==Ft){if(null==(Bt=t.list[(s<<1)*t.width+p])){var Zt,qt=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?Zt=new nt:(Zt=nt.zpp_pool,nt.zpp_pool=Zt.next,Zt.next=null),Zt.forced=!1,Zt.x=qt,Zt.y=l,Bt=Zt,t.list[(s<<1)*t.width+p]=Bt}else{var Wt,Xt=Bt.x,Ht=Bt.y;null==nt.zpp_pool?Wt=new nt:(Wt=nt.zpp_pool,nt.zpp_pool=Wt.next,Wt.next=null),Wt.forced=!1,Wt.x=Xt,Wt.y=Ht,Bt=Wt}h&&(Bt.forced=!0),Bt.x!=i&&Bt.x!=r||(Bt.x==i&&0!=(1&Dt)||Bt.x==r&&0!=(4&Dt))&&(Dt^=2)}else if(5==Ft){if(null==(Bt=t.list[(2+(s<<1))*t.width+p])){var Kt,Jt=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?Kt=new nt:(Kt=nt.zpp_pool,nt.zpp_pool=Kt.next,Kt.next=null),Kt.forced=!1,Kt.x=Jt,Kt.y=a,Bt=Kt,t.list[(2+(s<<1))*t.width+p]=Bt}else{var Qt,$t=Bt.x,ni=Bt.y;null==nt.zpp_pool?Qt=new nt:(Qt=nt.zpp_pool,nt.zpp_pool=Qt.next,Qt.next=null),Qt.forced=!1,Qt.x=$t,Qt.y=ni,Bt=Qt}u&&(Bt.forced=!0),Bt.x!=i&&Bt.x!=r||(Bt.x==i&&0!=(64&Dt)||Bt.x==r&&0!=(16&Dt))&&(Dt^=32)}else if(3==Ft){if(null==(Bt=t.list[(1+(s<<1))*t.width+(p+1)])){var ei,ti=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?ei=new nt:(ei=nt.zpp_pool,nt.zpp_pool=ei.next,ei.next=null),ei.forced=!1,ei.x=r,ei.y=ti,Bt=ei,t.list[(1+(s<<1))*t.width+(p+1)]=Bt}else{var ii,li=Bt.x,ri=Bt.y;null==nt.zpp_pool?ii=new nt:(ii=nt.zpp_pool,nt.zpp_pool=ii.next,ii.next=null),ii.forced=!1,ii.x=li,ii.y=ri,Bt=ii}_&&(Bt.forced=!0),Bt.y!=l&&Bt.y!=a||(Bt.y==l&&0!=(4&Dt)||Bt.y==a&&0!=(16&Dt))&&(Dt^=8)}else{if(null==(Bt=t.list[(1+(s<<1))*t.width+p])){var ai,pi=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?ai=new nt:(ai=nt.zpp_pool,nt.zpp_pool=ai.next,ai.next=null),ai.forced=!1,ai.x=i,ai.y=pi,Bt=ai,t.list[(1+(s<<1))*t.width+p]=Bt}else{var si,oi=Bt.x,hi=Bt.y;null==nt.zpp_pool?si=new nt:(si=nt.zpp_pool,nt.zpp_pool=si.next,si.next=null),si.forced=!1,si.x=oi,si.y=hi,Bt=si}o&&(Bt.forced=!0),Bt.y!=l&&Bt.y!=a||(Bt.y==l&&0!=(1&Dt)||Bt.y==a&&0!=(64&Dt))&&(Dt^=128)}var _i=Bt;null==f.p1?f.p1=_i.prev=_i.next=_i:(_i.prev=f.p1,_i.next=f.p1.next,f.p1.next.prev=_i,f.p1.next=_i),f.p1=_i}}if(f.p1=f.p1.next,f.key1=Dt,1!=Dt&&4!=Dt&&16!=Dt&&64!=Dt&&3!=Dt&&12!=Dt&&48!=Dt&&192!=Dt&&129!=Dt&&6!=Dt&&24!=Dt&&96!=Dt&&5!=Dt&&20!=Dt&&80!=Dt&&65!=Dt&&17!=Dt&&68!=Dt||(Dt=0,f.key1=0,f.p1=null),0!=Dt){var ui=14;f.okey2=ui;for(var di=0;8>di;){var ci=di++;if(0!=(ui&1<<ci)){var xi=null;if(0==ci){var vi;null==nt.zpp_pool?vi=new nt:(vi=nt.zpp_pool,nt.zpp_pool=vi.next,vi.next=null),vi.forced=!1,vi.x=i,vi.y=l,xi=vi,(o||h)&&(xi.forced=!0)}else if(2==ci){var zi;null==nt.zpp_pool?zi=new nt:(zi=nt.zpp_pool,nt.zpp_pool=zi.next,zi.next=null),zi.forced=!1,zi.x=r,zi.y=l,xi=zi,(_||h)&&(xi.forced=!0)}else if(4==ci){var yi;null==nt.zpp_pool?yi=new nt:(yi=nt.zpp_pool,nt.zpp_pool=yi.next,yi.next=null),yi.forced=!1,yi.x=r,yi.y=a,xi=yi,(_||u)&&(xi.forced=!0)}else if(6==ci){var fi;null==nt.zpp_pool?fi=new nt:(fi=nt.zpp_pool,nt.zpp_pool=fi.next,fi.next=null),fi.forced=!1,fi.x=i,fi.y=a,xi=fi,(o||u)&&(xi.forced=!0)}else if(1==ci){if(null==(xi=t.list[(s<<1)*t.width+p])){var mi,bi=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?mi=new nt:(mi=nt.zpp_pool,nt.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=bi,mi.y=l,xi=mi,t.list[(s<<1)*t.width+p]=xi}else{var gi,wi=xi.x,Ci=xi.y;null==nt.zpp_pool?gi=new nt:(gi=nt.zpp_pool,nt.zpp_pool=gi.next,gi.next=null),gi.forced=!1,gi.x=wi,gi.y=Ci,xi=gi}h&&(xi.forced=!0),xi.x!=i&&xi.x!=r||(xi.x==i&&0!=(1&ui)||xi.x==r&&0!=(4&ui))&&(ui^=2)}else if(5==ci){if(null==(xi=t.list[(2+(s<<1))*t.width+p])){var Mi,ki=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?Mi=new nt:(Mi=nt.zpp_pool,nt.zpp_pool=Mi.next,Mi.next=null),Mi.forced=!1,Mi.x=ki,Mi.y=a,xi=Mi,t.list[(2+(s<<1))*t.width+p]=xi}else{var Oi,Si=xi.x,Pi=xi.y;null==nt.zpp_pool?Oi=new nt:(Oi=nt.zpp_pool,nt.zpp_pool=Oi.next,Oi.next=null),Oi.forced=!1,Oi.x=Si,Oi.y=Pi,xi=Oi}u&&(xi.forced=!0),xi.x!=i&&xi.x!=r||(xi.x==i&&0!=(64&ui)||xi.x==r&&0!=(16&ui))&&(ui^=32)}else if(3==ci){if(null==(xi=t.list[(1+(s<<1))*t.width+(p+1)])){var Ti,Ai=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?Ti=new nt:(Ti=nt.zpp_pool,nt.zpp_pool=Ti.next,Ti.next=null),Ti.forced=!1,Ti.x=r,Ti.y=Ai,xi=Ti,t.list[(1+(s<<1))*t.width+(p+1)]=xi}else{var Ei,Ii=xi.x,Vi=xi.y;null==nt.zpp_pool?Ei=new nt:(Ei=nt.zpp_pool,nt.zpp_pool=Ei.next,Ei.next=null),Ei.forced=!1,Ei.x=Ii,Ei.y=Vi,xi=Ei}_&&(xi.forced=!0),xi.y!=l&&xi.y!=a||(xi.y==l&&0!=(4&ui)||xi.y==a&&0!=(16&ui))&&(ui^=8)}else{if(null==(xi=t.list[(1+(s<<1))*t.width+p])){var Li,Ni=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?Li=new nt:(Li=nt.zpp_pool,nt.zpp_pool=Li.next,Li.next=null),Li.forced=!1,Li.x=i,Li.y=Ni,xi=Li,t.list[(1+(s<<1))*t.width+p]=xi}else{var Di,ji=xi.x,Fi=xi.y;null==nt.zpp_pool?Di=new nt:(Di=nt.zpp_pool,nt.zpp_pool=Di.next,Di.next=null),Di.forced=!1,Di.x=ji,Di.y=Fi,xi=Di}o&&(xi.forced=!0),xi.y!=l&&xi.y!=a||(xi.y==l&&0!=(1&ui)||xi.y==a&&0!=(64&ui))&&(ui^=128)}var Bi=xi;null==f.p2?f.p2=Bi.prev=Bi.next=Bi:(Bi.prev=f.p2,Bi.next=f.p2.next,f.p2.next.prev=Bi,f.p2.next=Bi),f.p2=Bi}}f.p2=f.p2.next,f.key2=ui,1!=ui&&4!=ui&&16!=ui&&64!=ui&&3!=ui&&12!=ui&&48!=ui&&192!=ui&&129!=ui&&6!=ui&&24!=ui&&96!=ui&&5!=ui&&20!=ui&&80!=ui&&65!=ui&&17!=ui&&68!=ui||(ui=0,f.key2=0,f.p2=null),0==ui?(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1):(f.pr=f.p2,f.okeyr=f.okey2,f.keyr=f.key2)}else{var Ri=14;f.okey1=Ri;for(var Gi=0;8>Gi;){var Yi=Gi++;if(0!=(Ri&1<<Yi)){var Ui=null;if(0==Yi){var Zi;null==nt.zpp_pool?Zi=new nt:(Zi=nt.zpp_pool,nt.zpp_pool=Zi.next,Zi.next=null),Zi.forced=!1,Zi.x=i,Zi.y=l,Ui=Zi,(o||h)&&(Ui.forced=!0)}else if(2==Yi){var qi;null==nt.zpp_pool?qi=new nt:(qi=nt.zpp_pool,nt.zpp_pool=qi.next,qi.next=null),qi.forced=!1,qi.x=r,qi.y=l,Ui=qi,(_||h)&&(Ui.forced=!0)}else if(4==Yi){var Wi;null==nt.zpp_pool?Wi=new nt:(Wi=nt.zpp_pool,nt.zpp_pool=Wi.next,Wi.next=null),Wi.forced=!1,Wi.x=r,Wi.y=a,Ui=Wi,(_||u)&&(Ui.forced=!0)}else if(6==Yi){var Xi;null==nt.zpp_pool?Xi=new nt:(Xi=nt.zpp_pool,nt.zpp_pool=Xi.next,Xi.next=null),Xi.forced=!1,Xi.x=i,Xi.y=a,Ui=Xi,(o||u)&&(Ui.forced=!0)}else if(1==Yi){if(null==(Ui=t.list[(s<<1)*t.width+p])){var Hi,Ki=this.xlerp(i,r,l,x,v,n,d);null==nt.zpp_pool?Hi=new nt:(Hi=nt.zpp_pool,nt.zpp_pool=Hi.next,Hi.next=null),Hi.forced=!1,Hi.x=Ki,Hi.y=l,Ui=Hi,t.list[(s<<1)*t.width+p]=Ui}else{var Ji,Qi=Ui.x,$i=Ui.y;null==nt.zpp_pool?Ji=new nt:(Ji=nt.zpp_pool,nt.zpp_pool=Ji.next,Ji.next=null),Ji.forced=!1,Ji.x=Qi,Ji.y=$i,Ui=Ji}h&&(Ui.forced=!0),Ui.x!=i&&Ui.x!=r||(Ui.x==i&&0!=(1&Ri)||Ui.x==r&&0!=(4&Ri))&&(Ri^=2)}else if(5==Yi){if(null==(Ui=t.list[(2+(s<<1))*t.width+p])){var nl,el=this.xlerp(i,r,a,y,z,n,d);null==nt.zpp_pool?nl=new nt:(nl=nt.zpp_pool,nt.zpp_pool=nl.next,nl.next=null),nl.forced=!1,nl.x=el,nl.y=a,Ui=nl,t.list[(2+(s<<1))*t.width+p]=Ui}else{var tl,il=Ui.x,ll=Ui.y;null==nt.zpp_pool?tl=new nt:(tl=nt.zpp_pool,nt.zpp_pool=tl.next,tl.next=null),tl.forced=!1,tl.x=il,tl.y=ll,Ui=tl}u&&(Ui.forced=!0),Ui.x!=i&&Ui.x!=r||(Ui.x==i&&0!=(64&Ri)||Ui.x==r&&0!=(16&Ri))&&(Ri^=32)}else if(3==Yi){if(null==(Ui=t.list[(1+(s<<1))*t.width+(p+1)])){var rl,al=this.ylerp(l,a,r,v,z,n,d);null==nt.zpp_pool?rl=new nt:(rl=nt.zpp_pool,nt.zpp_pool=rl.next,rl.next=null),rl.forced=!1,rl.x=r,rl.y=al,Ui=rl,t.list[(1+(s<<1))*t.width+(p+1)]=Ui}else{var pl,sl=Ui.x,ol=Ui.y;null==nt.zpp_pool?pl=new nt:(pl=nt.zpp_pool,nt.zpp_pool=pl.next,pl.next=null),pl.forced=!1,pl.x=sl,pl.y=ol,Ui=pl}_&&(Ui.forced=!0),Ui.y!=l&&Ui.y!=a||(Ui.y==l&&0!=(4&Ri)||Ui.y==a&&0!=(16&Ri))&&(Ri^=8)}else{if(null==(Ui=t.list[(1+(s<<1))*t.width+p])){var hl,_l=this.ylerp(l,a,i,x,y,n,d);null==nt.zpp_pool?hl=new nt:(hl=nt.zpp_pool,nt.zpp_pool=hl.next,hl.next=null),hl.forced=!1,hl.x=i,hl.y=_l,Ui=hl,t.list[(1+(s<<1))*t.width+p]=Ui}else{var ul,dl=Ui.x,cl=Ui.y;null==nt.zpp_pool?ul=new nt:(ul=nt.zpp_pool,nt.zpp_pool=ul.next,ul.next=null),ul.forced=!1,ul.x=dl,ul.y=cl,Ui=ul}o&&(Ui.forced=!0),Ui.y!=l&&Ui.y!=a||(Ui.y==l&&0!=(1&Ri)||Ui.y==a&&0!=(64&Ri))&&(Ri^=128)}var xl=Ui;null==f.p1?f.p1=xl.prev=xl.next=xl:(xl.prev=f.p1,xl.next=f.p1.next,f.p1.next.prev=xl,f.p1.next=xl),f.p1=xl}}f.p1=f.p1.next,f.key1=Ri,1!=Ri&&4!=Ri&&16!=Ri&&64!=Ri&&3!=Ri&&12!=Ri&&48!=Ri&&192!=Ri&&129!=Ri&&6!=Ri&&24!=Ri&&96!=Ri&&5!=Ri&&20!=Ri&&80!=Ri&&65!=Ri&&17!=Ri&&68!=Ri||(Ri=0,f.key1=0,f.p1=null),0==Ri?f=null:(f.pr=f.p1,f.okeyr=f.okey1,f.keyr=f.key1)}}}return f},lerp:function(n,e,t,i){if(0==t)return n;if(0==i)return e;var l=t-i,r=f.epsilon*f.epsilon>l*l?.5:t/l;return 0>r?r=0:r>1&&(r=1),n+r*(e-n)},xlerp:function(n,e,t,i,l,r,a){var p;if(0==i)p=n;else if(0==l)p=e;else{var s=i-l,o=f.epsilon*f.epsilon>s*s?.5:i/s;0>o?o=0:o>1&&(o=1),p=n+o*(e-n)}for(;0!=a--&&p>n&&e>p;){var h=r(p,t);if(0==h)break;if(0>i*h?(e=p,l=h):(n=p,i=h),0==i)p=n;else if(0==l)p=e;else{var _=i-l,u=f.epsilon*f.epsilon>_*_?.5:i/_;0>u?u=0:u>1&&(u=1),p=n+u*(e-n)}}return p},ylerp:function(n,e,t,i,l,r,a){var p;if(0==i)p=n;else if(0==l)p=e;else{var s=i-l,o=f.epsilon*f.epsilon>s*s?.5:i/s;0>o?o=0:o>1&&(o=1),p=n+o*(e-n)}for(;0!=a--&&p>n&&e>p;){var h=r(t,p);if(0==h)break;if(0>i*h?(e=p,l=h):(n=p,i=h),0==i)p=n;else if(0==l)p=e;else{var _=i-l,u=f.epsilon*f.epsilon>_*_?.5:i/_;0>u?u=0:u>1&&(u=1),p=n+u*(e-n)}}return p},__class__:rt};var at=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};l["zpp_nape.geom.ZPP_Mat23"]=at,at.__name__=["zpp_nape","geom","ZPP_Mat23"],at.get=function(){var n;return null==at.zpp_pool?n=new at:(n=at.zpp_pool,at.zpp_pool=n.next,n.next=null),n},at.identity=function(){var n=at.get();return n.setas(1,0,0,1,0,0),n},at.prototype={outer:null,wrapper:function(){if(null==this.outer){this.outer=new bn;var n=this.outer.zpp_inner;n.next=at.zpp_pool,at.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},a:null,b:null,c:null,d:null,tx:null,ty:null,_invalidate:null,invalidate:function(){null!=this._invalidate&&this._invalidate()},set:function(n){this.setas(n.a,n.b,n.c,n.d,n.tx,n.ty)},setas:function(n,e,t,i,l,r){this.tx=l,this.ty=r,this.a=n,this.b=e,this.c=t,this.d=i},next:null,free:function(){},alloc:function(){},__class__:at};var pt=function(n,e){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=n,this.n=e,this.x=[];for(var t=0,i=n*e;i>t;){t++;this.x.push(0)}};l["zpp_nape.geom.ZPP_MatMN"]=pt,pt.__name__=["zpp_nape","geom","ZPP_MatMN"],pt.prototype={outer:null,m:null,n:null,x:null,__class__:pt};var st=function(){};l["zpp_nape.geom.ZPP_Monotone"]=st,st.__name__=["zpp_nape","geom","ZPP_Monotone"],st.bisector=function(n){var e=n.prev,t=n.next,i=0,l=0;i=n.x-e.x,l=n.y-e.y;var r=0,a=0;r=t.x-n.x,a=t.y-n.y;var p;null==Ct.zpp_pool?p=new Ct:(p=Ct.zpp_pool,Ct.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=-l-a,p.y=i+r;var s=p,o=s.x*s.x+s.y*s.y,h=1/Math.sqrt(o),_=h;return s.x*=_,s.y*=_,0>a*i-r*l&&(s.x=-s.x,s.y=-s.y),s},st.below=function(n,e){if(e.y>n.y)return!0;if(n.y>e.y)return!1;if(e.x>n.x)return!0;if(n.x>e.x)return!1;var t=st.bisector(n),i=st.bisector(e);t.x+=1*n.x,t.y+=1*n.y;i.x+=1*e.x,i.y+=1*e.y;var l=i.x>t.x||t.x==i.x&&i.y>t.y,r=t;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ct.zpp_pool,Ct.zpp_pool=r;var a=i;return null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,l},st.above=function(n,e){return st.below(e,n)},st.left_vertex=function(n){var e=n.prev;return e.y>n.y||e.y==n.y&&n.y>n.next.y},st.isMonotone=function(n){var e=n,t=n,i=n.next,l=n;if(null!=i)for(var r=i;;){var a=r;if(e.y>a.y&&(e=a),a.y>t.y&&(t=a),(r=r.next)==l)break}var p=!0,s=e;if(t!=e.next){var o=e.next,h=t;if(null!=o)for(var _=o;;){var u=_;if(s.y>u.y){p=!1;break}if(s=u,(_=_.next)==h)break}}if(!p)return!1;if(s=e,t!=e.prev){var d=e.prev,c=t;if(null!=d)for(var x=d;;){var v=x;if(s.y>v.y){p=!1;break}if(s=v,(x=x.prev)==c)break}}return p},st.sharedPPoly=null,st.getShared=function(){return null==st.sharedPPoly&&(st.sharedPPoly=new ht),st.sharedPPoly},st.decompose=function(n,e){if(null==e?e=new ht(n):e.init(n),null==e.vertices)return e;null==st.queue&&(st.queue=new pi);var t=e.vertices,i=e.vertices;if(null!=t)for(var l=t;;){var r=l;st.queue.add(r);var a=0,p=0;a=r.next.x-r.x,p=r.next.y-r.y;var s=0,o=0;s=r.prev.x-r.x,o=r.prev.y-r.y;var h=o*a-s*p>0;if(r.type=st.below(r.prev,r)?st.below(r.next,r)?h?0:3:4:st.below(r,r.next)?h?1:2:4,(l=l.next)==i)break}var _=st.queue;if(null!=_.head&&null!=_.head.next){for(var u,d,c,x=_.head,v=null,z=null,y=null,f=null,m=1;;){for(u=0,z=x,x=null,v=x;null!=z;){for(++u,y=z,d=0,c=m;null!=y&&m>d;)++d,y=y.next;for(;d>0||c>0&&null!=y;)0==d?(f=y,y=y.next,--c):0==c||null==y?(f=z,z=z.next,--d):st.above(z.elt,y.elt)?(f=z,z=z.next,--d):(f=y,y=y.next,--c),null!=v?v.next=f:x=f,v=f;z=y}if(v.next=null,m<<=1,u<=1)break}_.head=x,_.modified=!0,_.pushmod=!0}if(null==st.edges){null==Ol.zpp_pool?st.edges=new Ol:(st.edges=Ol.zpp_pool,Ol.zpp_pool=st.edges.next,st.edges.next=null);st.edges.lt=ot.edge_lt,st.edges.swapped=ot.edge_swap}for(;null!=st.queue.head;){var b=st.queue.pop_unsafe();switch(b.type){case 0:b.helper=b,b.node=st.edges.insert(b);break;case 1:var g=b.prev;2==g.helper.type&&e.add_diagonal(b,g.helper),st.edges.remove_node(g.node),g.helper=null;break;case 2:var w=b.prev;2==w.helper.type&&e.add_diagonal(b,w.helper),st.edges.remove_node(w.node),w.helper=null;var C=null;if(!st.edges.empty()){for(var M=st.edges.parent;null!=M.prev;)M=M.prev;for(;null!=M;){var k=M.data;if(!ot.vert_lt(k,b)){C=k;break}if(null!=M.next)for(M=M.next;null!=M.prev;)M=M.prev;else{for(;null!=M.parent&&M==M.parent.next;)M=M.parent;M=M.parent}}}var O=C;null!=O&&(2==O.helper.type&&e.add_diagonal(b,O.helper),O.helper=b);break;case 3:var S=null;if(!st.edges.empty()){for(var P=st.edges.parent;null!=P.prev;)P=P.prev;for(;null!=P;){var T=P.data;if(!ot.vert_lt(T,b)){S=T;break}if(null!=P.next)for(P=P.next;null!=P.prev;)P=P.prev;else{for(;null!=P.parent&&P==P.parent.next;)P=P.parent;P=P.parent}}}var A=S;null!=A&&(e.add_diagonal(b,A.helper),A.helper=b),b.node=st.edges.insert(b),b.helper=b;break;case 4:var E=b.prev;if(st.left_vertex(b))2==E.helper.type&&e.add_diagonal(b,E.helper),st.edges.remove_node(E.node),E.helper=null,b.node=st.edges.insert(b),b.helper=b;else{var I=null;if(!st.edges.empty()){for(var V=st.edges.parent;null!=V.prev;)V=V.prev;for(;null!=V;){var L=V.data;if(!ot.vert_lt(L,b)){I=L;break}if(null!=V.next)for(V=V.next;null!=V.prev;)V=V.prev;else{for(;null!=V.parent&&V==V.parent.next;)V=V.parent;V=V.parent}}}var N=I;2==N.helper.type&&e.add_diagonal(b,N.helper),N.helper=b}}}return e};var ot=function Hl(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=Hl.nextId++,this.diagonals=new pi};l["zpp_nape.geom.ZPP_PartitionVertex"]=ot,ot.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],ot.get=function(n){var e;return null==ot.zpp_pool?e=new ot:(e=ot.zpp_pool,ot.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e},ot.rightdistance=function(n,e){var t=n.next.y>n.y,i=0,l=0;i=n.next.x-n.x,l=n.next.y-n.y;var r=0,a=0;return r=e.x-n.x,a=e.y-n.y,(t?-1:1)*(a*i-r*l)},ot.vert_lt=function(n,e){if(e==n||e==n.next)return!0;if(n.y==n.next.y){var t=n.x,i=n.next.x;return e.x>=(i>t?t:i)}return 0>=ot.rightdistance(n,e)},ot.edge_swap=function(n,e){var t=n.node;n.node=e.node,e.node=t},ot.edge_lt=function(n,e){if(n==e&&n.next==e.next)return!1;if(n==e.next)return!ot.vert_lt(n,e);if(e==n.next)return ot.vert_lt(e,n);if(n.y==n.next.y){if(e.y==e.next.y){var t=n.x,i=n.next.x,l=e.x,r=e.next.x;return(t>i?t:i)>(l>r?l:r)}return ot.rightdistance(e,n)>0||ot.rightdistance(e,n.next)>0}var a=ot.rightdistance(n,e),p=ot.rightdistance(n,e.next);if(0==a&&0==p){var s=n.x,o=n.next.x,h=e.x,_=e.next.x;return(s>o?s:o)>(h>_?h:_)}if(a*p>=0)return 0>a||0>p;var u=ot.rightdistance(e,n),d=ot.rightdistance(e,n.next);return u*d>=0&&(u>0||d>0)},ot.prototype={id:null,mag:null,x:null,y:null,forced:null,diagonals:null,type:null,helper:null,rightchain:null,next:null,prev:null,alloc:function(){},free:function(){this.helper=null},copy:function(){var n;return null==ot.zpp_pool?n=new ot:(n=ot.zpp_pool,ot.zpp_pool=n.next,n.next=null),n.x=this.x,n.y=this.y,n.forced=this.forced,n},sort:function(){var n=0,e=0,t=0,i=0;n=this.prev.x-this.x,e=this.prev.y-this.y,t=this.next.x-this.x,i=this.next.y-this.y;var l=i*n-t*e,r=l>0?-1:0==l?0:1,a=this.diagonals;if(null!=a.head&&null!=a.head.next){for(var p,s,o,h=a.head,_=null,u=null,d=null,c=null,x=1;;){for(p=0,u=h,h=null,_=h;null!=u;){for(++p,d=u,s=0,o=x;null!=d&&x>s;)++s,d=d.next;for(;s>0||o>0&&null!=d;){if(0==s)c=d,d=d.next,--o;else if(0==o||null==d)c=u,u=u.next,--s;else{var v;if(1==r){n=u.elt.x-this.x,e=u.elt.y-this.y,t=d.elt.x-this.x,i=d.elt.y-this.y;var z=i*n-t*e;v=1==(z>0?-1:0==z?0:1)}else{n=this.prev.x-this.x,e=this.prev.y-this.y,t=u.elt.x-this.x,i=u.elt.y-this.y;var y=i*n-t*e,f=y>0?-1:0==y?0:1;n=this.prev.x-this.x,e=this.prev.y-this.y,t=d.elt.x-this.x,i=d.elt.y-this.y;var m=i*n-t*e,b=m>0?-1:0==m?0:1;if(f*b==1||f*b==0&&(1==f||1==b)){n=u.elt.x-this.x,e=u.elt.y-this.y,t=d.elt.x-this.x,i=d.elt.y-this.y;var g=i*n-t*e;v=1==(g>0?-1:0==g?0:1)}else if(-1==f||-1==b)v=-1==b;else if(0==f&&0==b){n=this.x-this.prev.x,e=this.y-this.prev.y,t=u.elt.x-this.x,i=u.elt.y-this.y;var w=n*t+e*i;t=d.elt.x-this.x,i=d.elt.y-this.y;var C=n*t+e*i;v=0>w&&C>0||(C>=0||0>=w)}else v=!0}v?(c=u,u=u.next,--s):(c=d,d=d.next,--o)}null!=_?_.next=c:h=c,_=c}u=d}if(_.next=null,x<<=1,p<=1)break}a.head=h,a.modified=!0,a.pushmod=!0}},node:null,__class__:ot};var ht=function(n){this.next=null,this.vertices=null,this.init(n)};l["zpp_nape.geom.ZPP_PartitionedPoly"]=ht,ht.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],ht.sharedPPList=null,ht.getSharedPP=function(){return null==ht.sharedPPList&&(ht.sharedPPList=new si),ht.sharedPPList},ht.sharedGVList=null,ht.getShared=function(){return null==ht.sharedGVList&&(ht.sharedGVList=new oi),ht.sharedGVList},ht.prototype={vertices:null,eq:function(n,e){var t=0,i=0;return t=n.x-e.x,i=n.y-e.y,f.epsilon*f.epsilon>t*t+i*i},next:null,alloc:function(){},free:function(){},init:function(n){if(null!=n){var e=0,t=n,i=n;if(null!=t)for(var l=t;;){var r=l;if(e+=r.x*(r.next.y-r.prev.y),(l=l.next)==i)break}for(var a=.5*e>0,p=n;;){var s;if(a){var o;null==ot.zpp_pool?o=new ot:(o=ot.zpp_pool,ot.zpp_pool=o.next,o.next=null),o.x=p.x,o.y=p.y;var h=o;null==this.vertices?this.vertices=h.prev=h.next=h:(h.prev=this.vertices,h.next=this.vertices.next,this.vertices.next.prev=h,this.vertices.next=h),s=h}else{var _;null==ot.zpp_pool?_=new ot:(_=ot.zpp_pool,ot.zpp_pool=_.next,_.next=null),_.x=p.x,_.y=p.y;var u=_;null==this.vertices?this.vertices=u.prev=u.next=u:(u.next=this.vertices,u.prev=this.vertices.prev,this.vertices.prev.next=u,this.vertices.prev=u),s=u}if(this.vertices=s,this.vertices.forced=p.forced,(p=p.next)==n)break}this.remove_collinear_vertices()}},remove_collinear_vertices:function(){for(var n=this.vertices,e=!0;e||n!=this.vertices;)if(e=!1,this.eq(n,n.next)){if(n==this.vertices&&(this.vertices=n.next,e=!0),n.forced&&(n.next.forced=!0),null!=n&&n.prev==n){n.next=n.prev=null;var t=n;t.helper=null,t.next=ot.zpp_pool,ot.zpp_pool=t,n=null,n=n}else{var i=n.next;n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null;var l=n;l.helper=null,l.next=ot.zpp_pool,ot.zpp_pool=l,n=null,n=i}if(null==n){this.vertices=null;break}}else n=n.next;if(null==this.vertices)return!0;for(var r;;){for(r=!1,n=this.vertices,e=!0;e||n!=this.vertices;){e=!1;var a=n.prev,p=0,s=0;p=n.x-a.x,s=n.y-a.y;var o=0,h=0;o=n.next.x-n.x,h=n.next.y-n.y;var _=h*p-o*s;if(_*_<f.epsilon*f.epsilon){if(n==this.vertices&&(this.vertices=n.next,e=!0),null!=n&&n.prev==n){n.next=n.prev=null;var u=n;u.helper=null,u.next=ot.zpp_pool,ot.zpp_pool=u,n=null,n=n}else{var d=n.next;n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null;var c=n;c.helper=null,c.next=ot.zpp_pool,ot.zpp_pool=c,n=null,n=d}if(r=!0,null==n){r=!1,this.vertices=null;break}}else n=n.next}if(!r)break}return null==this.vertices},add_diagonal:function(n,e){n.diagonals.add(e),e.diagonals.add(n),n.forced=e.forced=!0},extract_partitions:function(n){if(null==n&&(n=new si),null!=this.vertices){var e=this.vertices,t=this.vertices;if(null!=e)for(var i=e;;){var l=i;if(l.sort(),(i=i.next)==t)break}for(this.pull_partitions(this.vertices,n);null!=this.vertices;){var r;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var a=this.vertices;a.helper=null,a.next=ot.zpp_pool,ot.zpp_pool=a,r=this.vertices=null}else{var p=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var s=this.vertices;s.helper=null,s.next=ot.zpp_pool,ot.zpp_pool=s,this.vertices=null,r=p}this.vertices=r}for(var o=null,h=n.head;null!=h;){h.elt.remove_collinear_vertices()?n.erase(o):(o=h,h=h.next)}}return n},pull_partitions:function(n,e){var t;null==ht.zpp_pool?t=new ht:(t=ht.zpp_pool,ht.zpp_pool=t.next,t.next=null);for(var i=n;;){var l;null==ot.zpp_pool?l=new ot:(l=ot.zpp_pool,ot.zpp_pool=l.next,l.next=null),l.x=i.x,l.y=i.y,l.forced=i.forced;var r=l;if(null==t.vertices?t.vertices=r.prev=r.next=r:(r.prev=t.vertices,r.next=t.vertices.next,t.vertices.next.prev=r,t.vertices.next=r),t.vertices=r,t.vertices.forced=i.forced,null!=i.diagonals.head){var a=i.diagonals,p=a.head.elt;a.pop();if(p==n)break;i=this.pull_partitions(i,e)}else i=i.next;if(i==n)break}var s=0,o=t.vertices,h=t.vertices;if(null!=o)for(var _=o;;){var u=_;if(s+=u.x*(u.next.y-u.prev.y),(_=_.next)==h)break}return.5*s!=0&&e.add(t),i},extract:function(n){if(null==n&&(n=new oi),null!=this.vertices){var e=this.vertices,t=this.vertices;if(null!=e)for(var i=e;;){var l=i;if(l.sort(),(i=i.next)==t)break}for(this.pull(this.vertices,n);null!=this.vertices;){var r;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var a=this.vertices;a.helper=null,a.next=ot.zpp_pool,ot.zpp_pool=a,r=this.vertices=null}else{var p=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var s=this.vertices;s.helper=null,s.next=ot.zpp_pool,ot.zpp_pool=s,this.vertices=null,r=p}this.vertices=r}}return n},pull:function(n,e){for(var t=null,i=n;;){var l,r=i.x,a=i.y;null==nt.zpp_pool?l=new nt:(l=nt.zpp_pool,nt.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=r,l.y=a;var p=l;if(null==t?t=p.prev=p.next=p:(p.prev=t,p.next=t.next,t.next.prev=p,t.next=p),t=p,t.forced=i.forced,null!=i.diagonals.head){var s=i.diagonals,o=s.head.elt;s.pop();if(o==n)break;i=this.pull(i,e)}else i=i.next;if(i==n)break}var h=0,_=t,u=t;if(null!=_)for(var d=_;;){var c=d;if(h+=c.x*(c.next.y-c.prev.y),(d=d.next)==u)break}var x=.5*h;if(x*x>=f.epsilon*f.epsilon){for(var v=t,z=!0;z||v!=t;){z=!1;var y=0,m=0;if(y=v.x-v.next.x,m=v.y-v.next.y,f.epsilon*f.epsilon>y*y+m*m){if(v==t&&(t=v.next,z=!0),v.forced&&(v.next.forced=!0),null!=v&&v.prev==v)v.next=v.prev=null,v=null,v=v;else{var b=v.next;v.prev.next=v.next,v.next.prev=v.prev,v.next=v.prev=null,v=null,v=b}if(null==v){t=null;break}}else v=v.next}if(null!=t)for(var g;;){for(g=!1,v=t,z=!0;z||v!=t;){z=!1;var w=v.prev,C=0,M=0;C=v.x-w.x,M=v.y-w.y;var k=0,O=0;k=v.next.x-v.x,O=v.next.y-v.y;var S=O*C-k*M;if(S*S<f.epsilon*f.epsilon){if(v==t&&(t=v.next,z=!0),null!=v&&v.prev==v)v.next=v.prev=null,v=null,v=v;else{var P=v.next;v.prev.next=v.next,v.next.prev=v.prev,v.next=v.prev=null,v=null,v=P}if(g=!0,null==v){g=!1,t=null;break}}else v=v.next}if(!g)break}null!=t&&e.add(t)}return i},__class__:ht};var _t=function(){this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,this.origin=null;var n;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var e;null==Ct.zpp_pool?e=new Ct:(e=Ct.zpp_pool,Ct.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),0==n.zpp_inner.x){var a=n.zpp_inner;null!=a._validate&&a._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var p=n.zpp_inner;null!=p._invalidate&&p._invalidate(p)}}n.zpp_inner.weak=!1,this.origin=n,this.origin.zpp_inner._invalidate=t(this,this.origin_invalidate);var s;if(null==Cl.poolVec2?s=new On:(s=Cl.poolVec2,Cl.poolVec2=s.zpp_pool,s.zpp_pool=null,s.zpp_disp=!1,s==Cl.nextVec2&&(Cl.nextVec2=null)),null==s.zpp_inner){var o;null==Ct.zpp_pool?o=new Ct:(o=Ct.zpp_pool,Ct.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=0,o.y=0,s.zpp_inner=o,s.zpp_inner.outer=s}else{var h=s.zpp_inner;null!=h._isimmutable&&h._isimmutable();var _,u=s.zpp_inner;if(null!=u._validate&&u._validate(),0==s.zpp_inner.x){var d=s.zpp_inner;null!=d._validate&&d._validate(),_=0==s.zpp_inner.y}else _=!1;if(!_){s.zpp_inner.x=0,s.zpp_inner.y=0;var c=s.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}s.zpp_inner.weak=!1,this.direction=s,this.direction.zpp_inner._invalidate=t(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};l["zpp_nape.geom.ZPP_Ray"]=_t,_t.__name__=["zpp_nape","geom","ZPP_Ray"],_t.prototype={origin:null,direction:null,maxdist:null,userData:null,originx:null,originy:null,dirx:null,diry:null,idirx:null,idiry:null,normalx:null,normaly:null,absnormalx:null,absnormaly:null,origin_invalidate:function(n){this.originx=n.x,this.originy=n.y},direction_invalidate:function(n){this.dirx=n.x,this.diry=n.y,this.zip_dir=!0},zip_dir:null,invalidate_dir:function(){this.zip_dir=!0},validate_dir:function(){if(this.zip_dir){this.zip_dir=!1;var n=this.dirx*this.dirx+this.diry*this.diry,e=1/Math.sqrt(n),t=e;this.dirx*=t,this.diry*=t,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx;var i=this.normalx;this.absnormalx=0>i?-i:i;var l=this.normaly;this.absnormaly=0>l?-l:l}},rayAABB:function(){var n=this.originx,e=n,t=this.originy,i=t;if(this.maxdist<Infinity?(e+=this.maxdist*this.dirx,i+=this.maxdist*this.diry):(this.dirx>0?e=Infinity:0>this.dirx&&(e=-Infinity),this.diry>0?i=Infinity:0>this.diry&&(i=-Infinity)),n>e){var l=n;n=e,e=l}if(t>i){var r=t;t=i,i=r}var a;return null==Ze.zpp_pool?a=new Ze:(a=Ze.zpp_pool,Ze.zpp_pool=a.next,a.next=null),a.minx=n,a.miny=t,a.maxx=e,a.maxy=i,a},aabbtest:function(n){var e=this.normalx*(this.originx-.5*(n.minx+n.maxx))+this.normaly*(this.originy-.5*(n.miny+n.maxy)),t=.5*this.absnormalx*(n.maxx-n.minx)+.5*this.absnormaly*(n.maxy-n.miny),i=e;return t>(0>i?-i:i)},aabbsect:function(n){var e=this.originx>=n.minx&&n.maxx>=this.originx,t=this.originy>=n.miny&&n.maxy>=this.originy;if(e&&t)return 0;for(var i=-1;(0>this.dirx||n.maxx>this.originx)&&(this.dirx>0||this.originx>n.minx)&&(0>this.diry||n.maxy>this.originy)&&(this.diry>0||this.originy>n.miny);){if(this.dirx>0){var l=(n.minx-this.originx)*this.idirx;if(l>=0&&this.maxdist>=l){var r=this.originy+l*this.diry;if(r>=n.miny&&n.maxy>=r){i=l;break}}}else if(0>this.dirx){var a=(n.maxx-this.originx)*this.idirx;if(a>=0&&this.maxdist>=a){var p=this.originy+a*this.diry;if(p>=n.miny&&n.maxy>=p){i=a;break}}}if(this.diry>0){var s=(n.miny-this.originy)*this.idiry;if(s>=0&&this.maxdist>=s){var o=this.originx+s*this.dirx;if(o>=n.minx&&n.maxx>=o){i=s;break}}}else if(0>this.diry){var h=(n.maxy-this.originy)*this.idiry;if(h>=0&&this.maxdist>=h){var _=this.originx+h*this.dirx;if(_>=n.minx&&n.maxx>=_){i=h;break}}}break}return i},circlesect:function(n,e,t){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var l=0,r=i.lverts.next,a=r;r=r.next;var p=r;for(r=r.next;null!=r;){var s=r;l+=p.x*(s.y-a.y);var o=s.y*p.x-s.x*p.y;i.localCOMx+=(p.x+s.x)*o,i.localCOMy+=(p.y+s.y)*o,a=p,p=s,r=r.next}r=i.lverts.next;var h=r;l+=p.x*(h.y-a.y);var _=h.y*p.x-h.x*p.y;i.localCOMx+=(p.x+h.x)*_,i.localCOMy+=(p.y+h.y)*_,a=p,p=h,r=r.next;var u=r;l+=p.x*(u.y-a.y);var d=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*d,i.localCOMy+=(p.y+u.y)*d,l=1/(3*l);var c=l;i.localCOMx*=c,i.localCOMy*=c}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var v=0,z=0;v=this.originx-n.worldCOMx,z=this.originy-n.worldCOMy;var y=this.dirx*this.dirx+this.diry*this.diry,f=2*(v*this.dirx+z*this.diry),m=v*v+z*z-n.radius*n.radius,b=f*f-4*y*m;if(0==b){var g=-f/2*y;if(e&&0>=m||0>=g||g>=t||g>this.maxdist)return null;var w=0,C=0;w=this.originx,C=this.originy;var M=g;w+=this.dirx*M,C+=this.diry*M;w-=1*n.worldCOMx,C-=1*n.worldCOMy;var k=w*w+C*C,O=1/Math.sqrt(k),S=O;w*=S,C*=S,m>0||(w=-w,C=-C);var P;if(null==Cl.poolVec2?P=new On:(P=Cl.poolVec2,Cl.poolVec2=P.zpp_pool,P.zpp_pool=null,P.zpp_disp=!1,P==Cl.nextVec2&&(Cl.nextVec2=null)),null==P.zpp_inner){var T;null==Ct.zpp_pool?T=new Ct:(T=Ct.zpp_pool,Ct.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=w,T.y=C,P.zpp_inner=T,P.zpp_inner.outer=P}else{var A=P.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E,I=P.zpp_inner;if(null!=I._validate&&I._validate(),P.zpp_inner.x==w){var V=P.zpp_inner;null!=V._validate&&V._validate(),E=P.zpp_inner.y==C}else E=!1;if(!E){P.zpp_inner.x=w,P.zpp_inner.y=C;var L=P.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}return P.zpp_inner.weak=!1,He.getRay(P,g,0>=m,n.outer)}b=Math.sqrt(b),y=1/(2*y);var N=(-f-b)*y,D=(-f+b)*y;if(N>0){if(t>N&&this.maxdist>=N){var j=0,F=0;j=this.originx,F=this.originy;var B=N;j+=this.dirx*B,F+=this.diry*B;j-=1*n.worldCOMx,F-=1*n.worldCOMy;var R=j*j+F*F,G=1/Math.sqrt(R),Y=G;j*=Y,F*=Y;var U;if(null==Cl.poolVec2?U=new On:(U=Cl.poolVec2,Cl.poolVec2=U.zpp_pool,U.zpp_pool=null,U.zpp_disp=!1,U==Cl.nextVec2&&(Cl.nextVec2=null)),null==U.zpp_inner){var Z;null==Ct.zpp_pool?Z=new Ct:(Z=Ct.zpp_pool,Ct.zpp_pool=Z.next,Z.next=null),Z.weak=!1,Z._immutable=!1,Z.x=j,Z.y=F,U.zpp_inner=Z,U.zpp_inner.outer=U}else{var q=U.zpp_inner;null!=q._isimmutable&&q._isimmutable();var W,X=U.zpp_inner;if(null!=X._validate&&X._validate(),U.zpp_inner.x==j){var H=U.zpp_inner;null!=H._validate&&H._validate(),W=U.zpp_inner.y==F}else W=!1;if(!W){U.zpp_inner.x=j,U.zpp_inner.y=F;var K=U.zpp_inner;null!=K._invalidate&&K._invalidate(K)}}return U.zpp_inner.weak=!1,He.getRay(U,N,!1,n.outer)}return null}if(D>0&&e){if(t>D&&this.maxdist>=D){var J=0,Q=0;J=this.originx,Q=this.originy;var $=D;J+=this.dirx*$,Q+=this.diry*$;J-=1*n.worldCOMx,Q-=1*n.worldCOMy;var nn=J*J+Q*Q,en=1/Math.sqrt(nn),tn=en;J*=tn,Q*=tn,J=-J,Q=-Q;var ln;if(null==Cl.poolVec2?ln=new On:(ln=Cl.poolVec2,Cl.poolVec2=ln.zpp_pool,ln.zpp_pool=null,ln.zpp_disp=!1,ln==Cl.nextVec2&&(Cl.nextVec2=null)),null==ln.zpp_inner){var rn;null==Ct.zpp_pool?rn=new Ct:(rn=Ct.zpp_pool,Ct.zpp_pool=rn.next,rn.next=null),rn.weak=!1,rn._immutable=!1,rn.x=J,rn.y=Q,ln.zpp_inner=rn,ln.zpp_inner.outer=ln}else{var an=ln.zpp_inner;null!=an._isimmutable&&an._isimmutable();var pn,sn=ln.zpp_inner;if(null!=sn._validate&&sn._validate(),ln.zpp_inner.x==J){var on=ln.zpp_inner;null!=on._validate&&on._validate(),pn=ln.zpp_inner.y==Q}else pn=!1;if(!pn){ln.zpp_inner.x=J,ln.zpp_inner.y=Q;var hn=ln.zpp_inner;null!=hn._invalidate&&hn._invalidate(hn)}}return ln.zpp_inner.weak=!1,He.getRay(ln,D,!0,n.outer)}return null}return null},circlesect2:function(n,e,t){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var l=0,r=i.lverts.next,a=r;r=r.next;var p=r;for(r=r.next;null!=r;){var s=r;l+=p.x*(s.y-a.y);var o=s.y*p.x-s.x*p.y;i.localCOMx+=(p.x+s.x)*o,i.localCOMy+=(p.y+s.y)*o,a=p,p=s,r=r.next}r=i.lverts.next;var h=r;l+=p.x*(h.y-a.y);var _=h.y*p.x-h.x*p.y;i.localCOMx+=(p.x+h.x)*_,i.localCOMy+=(p.y+h.y)*_,a=p,p=h,r=r.next;var u=r;l+=p.x*(u.y-a.y);var d=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*d,i.localCOMy+=(p.y+u.y)*d,l=1/(3*l);var c=l;i.localCOMx*=c,i.localCOMy*=c}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var v=0,z=0;v=this.originx-n.worldCOMx,z=this.originy-n.worldCOMy;var y=this.dirx*this.dirx+this.diry*this.diry,f=2*(v*this.dirx+z*this.diry),m=v*v+z*z-n.radius*n.radius,b=f*f-4*y*m;if(0==b){var g=-f/2*y;if((!e||m>0)&&g>0&&this.maxdist>=g){var w=0,C=0;w=this.originx,C=this.originy;var M=g;w+=this.dirx*M,C+=this.diry*M;w-=1*n.worldCOMx,C-=1*n.worldCOMy;var k=w*w+C*C,O=1/Math.sqrt(k),S=O;w*=S,C*=S,m>0||(w=-w,C=-C);var P;if(null==Cl.poolVec2?P=new On:(P=Cl.poolVec2,Cl.poolVec2=P.zpp_pool,P.zpp_pool=null,P.zpp_disp=!1,P==Cl.nextVec2&&(Cl.nextVec2=null)),null==P.zpp_inner){var T;null==Ct.zpp_pool?T=new Ct:(T=Ct.zpp_pool,Ct.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=w,T.y=C,P.zpp_inner=T,P.zpp_inner.outer=P}else{var A=P.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E,I=P.zpp_inner;if(null!=I._validate&&I._validate(),P.zpp_inner.x==w){var V=P.zpp_inner;null!=V._validate&&V._validate(),E=P.zpp_inner.y==C}else E=!1;if(!E){P.zpp_inner.x=w,P.zpp_inner.y=C;var L=P.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}P.zpp_inner.weak=!1;for(var N=He.getRay(P,g,0>=m,n.outer),D=null,j=t.zpp_inner.inner.head;null!=j;){var F=j.elt;if(F.zpp_inner.toiDistance>N.zpp_inner.toiDistance)break;D=j,j=j.next}var B,R=t.zpp_inner.inner;null==al.zpp_pool?B=new al:(B=al.zpp_pool,al.zpp_pool=B.next,B.next=null),B.elt=N;var G=B;null==D?(G.next=R.head,R.head=G):(G.next=D.next,D.next=G),R.pushmod=R.modified=!0,R.length++}}else{b=Math.sqrt(b),y=1/(2*y);var Y=(-f-b)*y,U=(-f+b)*y;if(Y>0&&this.maxdist>=Y){var Z=0,q=0;Z=this.originx,q=this.originy;var W=Y;Z+=this.dirx*W,q+=this.diry*W;Z-=1*n.worldCOMx,q-=1*n.worldCOMy;var X=Z*Z+q*q,H=1/Math.sqrt(X),K=H;Z*=K,q*=K;var J;if(null==Cl.poolVec2?J=new On:(J=Cl.poolVec2,Cl.poolVec2=J.zpp_pool,J.zpp_pool=null,J.zpp_disp=!1,J==Cl.nextVec2&&(Cl.nextVec2=null)),null==J.zpp_inner){var Q;null==Ct.zpp_pool?Q=new Ct:(Q=Ct.zpp_pool,Ct.zpp_pool=Q.next,Q.next=null),Q.weak=!1,Q._immutable=!1,Q.x=Z,Q.y=q,J.zpp_inner=Q,J.zpp_inner.outer=J}else{var $=J.zpp_inner;null!=$._isimmutable&&$._isimmutable();var nn,en=J.zpp_inner;if(null!=en._validate&&en._validate(),J.zpp_inner.x==Z){var tn=J.zpp_inner;null!=tn._validate&&tn._validate(),nn=J.zpp_inner.y==q}else nn=!1;if(!nn){J.zpp_inner.x=Z,J.zpp_inner.y=q;var ln=J.zpp_inner;null!=ln._invalidate&&ln._invalidate(ln)}}J.zpp_inner.weak=!1;for(var rn=He.getRay(J,Y,!1,n.outer),an=null,pn=t.zpp_inner.inner.head;null!=pn;){var sn=pn.elt;if(sn.zpp_inner.toiDistance>rn.zpp_inner.toiDistance)break;an=pn,pn=pn.next}var on,hn=t.zpp_inner.inner;null==al.zpp_pool?on=new al:(on=al.zpp_pool,al.zpp_pool=on.next,on.next=null),on.elt=rn;var _n=on;null==an?(_n.next=hn.head,hn.head=_n):(_n.next=an.next,an.next=_n),hn.pushmod=hn.modified=!0,hn.length++}if(U>0&&this.maxdist>=U&&e){var un=0,dn=0;un=this.originx,dn=this.originy;var cn=U;un+=this.dirx*cn,dn+=this.diry*cn;un-=1*n.worldCOMx,dn-=1*n.worldCOMy;var xn=un*un+dn*dn,vn=1/Math.sqrt(xn),zn=vn;un*=zn,dn*=zn,un=-un,dn=-dn;var yn;if(null==Cl.poolVec2?yn=new On:(yn=Cl.poolVec2,Cl.poolVec2=yn.zpp_pool,yn.zpp_pool=null,yn.zpp_disp=!1,yn==Cl.nextVec2&&(Cl.nextVec2=null)),null==yn.zpp_inner){var fn;null==Ct.zpp_pool?fn=new Ct:(fn=Ct.zpp_pool,Ct.zpp_pool=fn.next,fn.next=null),fn.weak=!1,fn._immutable=!1,fn.x=un,fn.y=dn,yn.zpp_inner=fn,yn.zpp_inner.outer=yn}else{var mn=yn.zpp_inner;null!=mn._isimmutable&&mn._isimmutable();var bn,gn=yn.zpp_inner;if(null!=gn._validate&&gn._validate(),yn.zpp_inner.x==un){var wn=yn.zpp_inner;null!=wn._validate&&wn._validate(),bn=yn.zpp_inner.y==dn}else bn=!1;if(!bn){yn.zpp_inner.x=un,yn.zpp_inner.y=dn;var Cn=yn.zpp_inner;null!=Cn._invalidate&&Cn._invalidate(Cn)}}yn.zpp_inner.weak=!1;for(var Mn=He.getRay(yn,U,!0,n.outer),kn=null,Sn=t.zpp_inner.inner.head;null!=Sn;){var Pn=Sn.elt;if(Pn.zpp_inner.toiDistance>Mn.zpp_inner.toiDistance)break;kn=Sn,Sn=Sn.next}var Tn,An=t.zpp_inner.inner;null==al.zpp_pool?Tn=new al:(Tn=al.zpp_pool,al.zpp_pool=Tn.next,Tn.next=null),Tn.elt=Mn;var En=Tn;null==kn?(En.next=An.head,An.head=En):(En.next=kn.next,kn.next=En),An.pushmod=An.modified=!0,An.length++}}},polysect:function(n,e,t){for(var i=t,l=null,r=n.edges.head,a=n.gverts.next,p=a,s=a.next;null!=s;){var o=s,h=r.elt;if(e||0>h.gnormx*this.dirx+h.gnormy*this.diry){var _=0,u=0;_=o.x-p.x,u=o.y-p.y;var d=0,c=0;d=p.x-this.originx,c=p.y-this.originy;var x=u*this.dirx-_*this.diry;if(x*x>f.epsilon){x=1/x;var v=(u*d-_*c)*x;if(v>0&&i>v&&this.maxdist>=v){var z=(this.diry*d-this.dirx*c)*x;z>-f.epsilon&&1+f.epsilon>z&&(i=v,l=r.elt)}}}r=r.next,a=s,p=o,s=s.next}for(;;){s=n.gverts.next;var y=s,m=r.elt;if(e||0>m.gnormx*this.dirx+m.gnormy*this.diry){var b=0,g=0;b=y.x-p.x,g=y.y-p.y;var w=0,C=0;w=p.x-this.originx,C=p.y-this.originy;var M=g*this.dirx-b*this.diry;if(M*M>f.epsilon){M=1/M;var k=(g*w-b*C)*M;if(k>0&&i>k&&this.maxdist>=k){var O=(this.diry*w-this.dirx*C)*M;O>-f.epsilon&&1+f.epsilon>O&&(i=k,l=r.elt)}}}r=r.next;break}if(null!=l){var S=0,P=0;S=l.gnormx,P=l.gnormy;var T=S*this.dirx+P*this.diry>0;T&&(S=-S,P=-P);var A;if(null==Cl.poolVec2?A=new On:(A=Cl.poolVec2,Cl.poolVec2=A.zpp_pool,A.zpp_pool=null,A.zpp_disp=!1,A==Cl.nextVec2&&(Cl.nextVec2=null)),null==A.zpp_inner){var E;null==Ct.zpp_pool?E=new Ct:(E=Ct.zpp_pool,Ct.zpp_pool=E.next,E.next=null),E.weak=!1,E._immutable=!1,E.x=S,E.y=P,A.zpp_inner=E,A.zpp_inner.outer=A}else{var I=A.zpp_inner;null!=I._isimmutable&&I._isimmutable();var V,L=A.zpp_inner;if(null!=L._validate&&L._validate(),A.zpp_inner.x==S){var N=A.zpp_inner;null!=N._validate&&N._validate(),V=A.zpp_inner.y==P}else V=!1;if(!V){A.zpp_inner.x=S,A.zpp_inner.y=P;var D=A.zpp_inner;null!=D._invalidate&&D._invalidate(D)}}return A.zpp_inner.weak=!1,He.getRay(A,i,T,n.outer)}return null},polysect2:function(n,e,t){for(var i=Infinity,l=-1,r=null,a=null,p=n.edges.head,s=n.gverts.next,o=s,h=s.next;null!=h;){var _=h,u=p.elt;if(e||0>u.gnormx*this.dirx+u.gnormy*this.diry){var d=0,c=0;d=_.x-o.x,c=_.y-o.y;var x=0,v=0;x=o.x-this.originx,v=o.y-this.originy;var z=c*this.dirx-d*this.diry;if(z*z>f.epsilon){z=1/z;var y=(c*x-d*v)*z;if(y>0&&this.maxdist>=y&&(i>y||y>l)){var m=(this.diry*x-this.dirx*v)*z;m>-f.epsilon&&1+f.epsilon>m&&(i>y&&(i=y,r=p.elt),y>l&&(l=y,a=p.elt))}}}p=p.next,s=h,o=_,h=h.next}for(;;){h=n.gverts.next;var b=h,g=p.elt;if(e||0>g.gnormx*this.dirx+g.gnormy*this.diry){var w=0,C=0;w=b.x-o.x,C=b.y-o.y;var M=0,k=0;M=o.x-this.originx,k=o.y-this.originy;var O=C*this.dirx-w*this.diry;if(O*O>f.epsilon){O=1/O;var S=(C*M-w*k)*O;if(S>0&&this.maxdist>=S&&(i>S||S>l)){var P=(this.diry*M-this.dirx*k)*O;P>-f.epsilon&&1+f.epsilon>P&&(i>S&&(i=S,r=p.elt),S>l&&(l=S,a=p.elt))}}}p=p.next;break}if(null!=r){var T=0,A=0;T=r.gnormx,A=r.gnormy;var E=T*this.dirx+A*this.diry>0;E&&(T=-T,A=-A);var I;if(null==Cl.poolVec2?I=new On:(I=Cl.poolVec2,Cl.poolVec2=I.zpp_pool,I.zpp_pool=null,I.zpp_disp=!1,I==Cl.nextVec2&&(Cl.nextVec2=null)),null==I.zpp_inner){var V;null==Ct.zpp_pool?V=new Ct:(V=Ct.zpp_pool,Ct.zpp_pool=V.next,V.next=null),V.weak=!1,V._immutable=!1,V.x=T,V.y=A,I.zpp_inner=V,I.zpp_inner.outer=I}else{var L=I.zpp_inner;null!=L._isimmutable&&L._isimmutable();var N,D=I.zpp_inner;if(null!=D._validate&&D._validate(),I.zpp_inner.x==T){var j=I.zpp_inner;null!=j._validate&&j._validate(),N=I.zpp_inner.y==A}else N=!1;if(!N){I.zpp_inner.x=T,I.zpp_inner.y=A;var F=I.zpp_inner;null!=F._invalidate&&F._invalidate(F)}}I.zpp_inner.weak=!1;for(var B=He.getRay(I,i,E,n.outer),R=null,G=t.zpp_inner.inner.head;null!=G;){var Y=G.elt;if(Y.zpp_inner.toiDistance>B.zpp_inner.toiDistance)break;R=G,G=G.next}var U,Z=t.zpp_inner.inner;null==al.zpp_pool?U=new al:(U=al.zpp_pool,al.zpp_pool=U.next,U.next=null),U.elt=B;var q=U;null==R?(q.next=Z.head,Z.head=q):(q.next=R.next,R.next=q),Z.pushmod=Z.modified=!0,Z.length++}if(null!=a&&r!=a){var W=0,X=0;W=a.gnormx,X=a.gnormy;var H=W*this.dirx+X*this.diry>0;H&&(W=-W,X=-X);var K;if(null==Cl.poolVec2?K=new On:(K=Cl.poolVec2,Cl.poolVec2=K.zpp_pool,K.zpp_pool=null,K.zpp_disp=!1,K==Cl.nextVec2&&(Cl.nextVec2=null)),null==K.zpp_inner){var J;null==Ct.zpp_pool?J=new Ct:(J=Ct.zpp_pool,Ct.zpp_pool=J.next,J.next=null),J.weak=!1,J._immutable=!1,J.x=W,J.y=X,K.zpp_inner=J,K.zpp_inner.outer=K}else{var Q=K.zpp_inner;null!=Q._isimmutable&&Q._isimmutable();var $,nn=K.zpp_inner;if(null!=nn._validate&&nn._validate(),K.zpp_inner.x==W){var en=K.zpp_inner;null!=en._validate&&en._validate(),$=K.zpp_inner.y==X}else $=!1;if(!$){K.zpp_inner.x=W,K.zpp_inner.y=X;var tn=K.zpp_inner;null!=tn._invalidate&&tn._invalidate(tn)}}K.zpp_inner.weak=!1;for(var ln=He.getRay(K,l,H,n.outer),rn=null,an=t.zpp_inner.inner.head;null!=an;){var pn=an.elt;if(pn.zpp_inner.toiDistance>ln.zpp_inner.toiDistance)break;rn=an,an=an.next}var sn,on=t.zpp_inner.inner;null==al.zpp_pool?sn=new al:(sn=al.zpp_pool,al.zpp_pool=sn.next,sn.next=null),sn.elt=ln;var hn=sn;null==rn?(hn.next=on.head,on.head=hn):(hn.next=rn.next,rn.next=hn),on.pushmod=on.modified=!0,on.length++}},__class__:_t};var ut=function Kl(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=pe.ZPP_SimpleVert(),null==Pl.zpp_pool?this.links=new Pl:(this.links=Pl.zpp_pool,Pl.zpp_pool=this.links.next,this.links.next=null);this.links.lt=Kl.less_xy};l["zpp_nape.geom.ZPP_SimpleVert"]=ut,ut.__name__=["zpp_nape","geom","ZPP_SimpleVert"],ut.less_xy=function(n,e){return e.y>n.y||n.y==e.y&&e.x>n.x},ut.swap_nodes=function(n,e){var t=n.node;n.node=e.node,e.node=t},ut.get=function(n,e){var t;return null==ut.zpp_pool?t=new ut:(t=ut.zpp_pool,ut.zpp_pool=t.next,t.next=null),t.x=n,t.y=e,t},ut.prototype={forced:null,x:null,y:null,links:null,id:null,next:null,node:null,free:function(){this.links.clear(),this.node=null,this.forced=!1},alloc:function(){},__class__:ut};var dt=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=pe.ZPP_SimpleSeg(),null==Pl.zpp_pool?this.vertices=new Pl:(this.vertices=Pl.zpp_pool,Pl.zpp_pool=this.vertices.next,this.vertices.next=null);this.vertices.lt=t(this,this.less_xy)};l["zpp_nape.geom.ZPP_SimpleSeg"]=dt,dt.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],dt.get=function(n,e){var t;return null==dt.zpp_pool?t=new dt:(t=dt.zpp_pool,dt.zpp_pool=t.next,t.next=null),t.left=n,t.right=e,t.vertices.insert(n),t.vertices.insert(e),t},dt.prototype={left:null,right:null,vertices:null,id:null,next:null,free:function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},alloc:function(){},prev:null,node:null,less_xy:function(n,e){return e.x>n.x||n.x==e.x&&e.y>n.y},__class__:dt};var ct=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};l["zpp_nape.geom.ZPP_SimpleEvent"]=ct,ct.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],ct.swap_nodes=function(n,e){var t=n.node;n.node=e.node,e.node=t},ct.less_xy=function(n,e){return e.vertex.x>n.vertex.x||e.vertex.x>=n.vertex.x&&(e.vertex.y>n.vertex.y||e.vertex.y>=n.vertex.y&&e.type>n.type)},ct.get=function(n){var e;return null==ct.zpp_pool?e=new ct:(e=ct.zpp_pool,ct.zpp_pool=e.next,e.next=null),e.vertex=n,e},ct.prototype={type:null,vertex:null,segment:null,segment2:null,node:null,next:null,free:function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},alloc:function(){},__class__:ct};var xt=function(){this.tree=null,this.sweepx=0,null==Tl.zpp_pool?this.tree=new Tl:(this.tree=Tl.zpp_pool,Tl.zpp_pool=this.tree.next,this.tree.next=null);this.tree.lt=t(this,this.edge_lt),this.tree.swapped=t(this,this.swap_nodes)};l["zpp_nape.geom.ZPP_SimpleSweep"]=xt,xt.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],xt.prototype={sweepx:null,tree:null,swap_nodes:function(n,e){var t=n.node;n.node=e.node,e.node=t},edge_lt:function(n,e){var t,i=0,l=0,r=0,a=0;if(n.left==e.left&&n.right==e.right)return!1;if(n.left==e.right)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.left.y:n.right.y>e.left.y:(t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,a=e.left.y-n.left.y,0>(t?l*r-i*a:a*i-r*l));if(n.right==e.left){var p;return e.left.x==e.right.x?p=e.right.y>e.left.y?e.left.y>n.left.y:e.right.y>n.left.y:(t=e.left.x>e.right.x,i=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,a=n.left.y-e.left.y,p=0>(t?l*r-i*a:a*i-r*l)),!p}if(n.left==e.left)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.right.y:n.right.y>e.right.y:(t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,a=e.right.y-n.left.y,0>(t?l*r-i*a:a*i-r*l));if(n.right==e.right)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.left.y:n.right.y>e.left.y:(t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,a=e.left.y-n.left.y,0>(t?l*r-i*a:a*i-r*l));if(n.left.x==n.right.x){if(e.left.x==e.right.x){return(n.right.y>n.left.y?n.right:n.left).y>(e.right.y>e.left.y?e.right:e.left).y}t=e.left.x>e.right.x,i=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,a=n.left.y-e.left.y;var s=t?l*r-i*a:a*i-r*l;t=e.left.x>e.right.x,i=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.right.x-e.left.x,a=n.right.y-e.left.y;return 0>s*(t?l*r-i*a:a*i-r*l)?this.sweepx>=n.left.x:s>=0}if(e.left.x==e.right.x){t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,a=e.left.y-n.left.y;var o=t?l*r-i*a:a*i-r*l;t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,a=e.right.y-n.left.y;return 0>o*(t?l*r-i*a:a*i-r*l)?e.left.x>this.sweepx:0>o}t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,a=e.left.y-n.left.y;var h=0>(t?l*r-i*a:a*i-r*l);if(t=n.left.x>n.right.x,i=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,a=e.right.y-n.left.y,h==0>(t?l*r-i*a:a*i-r*l))return h;t=e.left.x>e.right.x,i=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,a=n.left.y-e.left.y;var _=(t?l*r-i*a:a*i-r*l)>=0;return t=e.left.x>e.right.x,i=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.right.x-e.left.x,a=n.right.y-e.left.y,_==(t?l*r-i*a:a*i-r*l)>=0?_:(this.sweepx-n.left.x)/(n.right.x-n.left.x)*(n.right.y-n.left.y)+n.left.y>(this.sweepx-e.left.x)/(e.right.x-e.left.x)*(e.right.y-e.left.y)+e.left.y},clear:function(){this.tree.clear()},add:function(n){n.node=this.tree.insert(n);var e=this.tree.successor_node(n.node),t=this.tree.predecessor_node(n.node);return null!=e&&(n.next=e.data,e.data.prev=n),null!=t&&(n.prev=t.data,t.data.next=n),n},remove:function(n){var e=this.tree.successor_node(n.node),t=this.tree.predecessor_node(n.node);null!=e&&(e.data.prev=n.prev),null!=t&&(t.data.next=n.next),this.tree.remove_node(n.node),n.node=null},intersect:function(n,e){if(null==n||null==e)return!1;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return!1;var t=(e.left.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.left.y-n.left.y),i=(e.right.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.right.y-n.left.y);if(t*i>0)return!1;var l=(n.left.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.left.y-e.left.y),r=(n.right.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.right.y-e.left.y);return l*r<=0},intersection:function(n,e){if(null==n||null==e)return null;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return null;var t=0,i=0;t=n.right.x-n.left.x,i=n.right.y-n.left.y;var l=0,r=0;l=e.right.x-e.left.x,r=e.right.y-e.left.y;var a=r*t-l*i;if(0==a)return null;a=1/a;var p=0,s=0;p=e.left.x-n.left.x,s=e.left.y-n.left.y;var o=(r*p-l*s)*a;if(0>o||o>1)return null;var h=(i*p-t*s)*a;if(0>h||h>1)return null;var _;if(0==h||1==h||0==o||1==o){var u=0==h;1==h&&u||1==h&&(u=!0),0==o&&u||0==o&&(u=!0),_=0==h?e.left:1==h?e.right:0==o?n.left:n.right}else{var d,c=.5*(n.left.x+t*o+e.left.x+l*h),x=.5*(n.left.y+i*o+e.left.y+r*h);null==ut.zpp_pool?d=new ut:(d=ut.zpp_pool,ut.zpp_pool=d.next,d.next=null),d.x=c,d.y=x,_=d}var v;null==ct.zpp_pool?v=new ct:(v=ct.zpp_pool,ct.zpp_pool=v.next,v.next=null),v.vertex=_;var z=v;return z.type=0,z.segment=n,z.segment2=e,z},__class__:xt};var vt=function(){};l["zpp_nape.geom.ZPP_Simple"]=vt,vt.__name__=["zpp_nape","geom","ZPP_Simple"],vt.decompose=function(n,e){if(null==vt.sweep&&(vt.sweep=new xt,vt.inthash=new Qt),null==vt.vertices){null==Pl.zpp_pool?vt.vertices=new Pl:(vt.vertices=Pl.zpp_pool,Pl.zpp_pool=vt.vertices.next,vt.vertices.next=null);vt.vertices.lt=ut.less_xy,vt.vertices.swapped=ut.swap_nodes}if(null==vt.queue){null==Al.zpp_pool?vt.queue=new Al:(vt.queue=Al.zpp_pool,Al.zpp_pool=vt.queue.next,vt.queue.next=null);vt.queue.lt=ct.less_xy,vt.queue.swapped=ct.swap_nodes}var t=null,i=null,l=n,r=n;if(null!=l)for(var a=l;;){var p,s=a,o=s.x,h=s.y;null==ut.zpp_pool?p=new ut:(p=ut.zpp_pool,ut.zpp_pool=p.next,p.next=null),p.x=o,p.y=h;for(var _=p,u=vt.vertices.parent;null!=u;)if(vt.vertices.lt(_,u.data))u=u.prev;else{if(!vt.vertices.lt(u.data,_))break;u=u.next}var d=u;if(null!=d){var c=_;c.links.clear(),c.node=null,c.forced=!1,c.next=ut.zpp_pool,ut.zpp_pool=c,_=d.data}else _.node=vt.vertices.insert(_);if(null!=i){var x;null==ct.zpp_pool?x=new ct:(x=ct.zpp_pool,ct.zpp_pool=x.next,x.next=null),x.vertex=i;var v,z=x;null==ct.zpp_pool?v=new ct:(v=ct.zpp_pool,ct.zpp_pool=v.next,v.next=null),v.vertex=_;var y,f=v;ct.less_xy(z,f)?(z.type=1,f.type=2,y=dt.get(i,_)):(z.type=2,f.type=1,y=dt.get(_,i)),z.segment=f.segment=y,vt.queue.insert(z),vt.queue.insert(f),i.links.insert(_),_.links.insert(i)}if(i=_,null==t&&(t=_),(a=a.next)==r)break}var m;null==ct.zpp_pool?m=new ct:(m=ct.zpp_pool,ct.zpp_pool=m.next,m.next=null),m.vertex=i;var b,g=m;null==ct.zpp_pool?b=new ct:(b=ct.zpp_pool,ct.zpp_pool=b.next,b.next=null),b.vertex=t;var w,C=b;if(ct.less_xy(g,C)?(g.type=1,C.type=2,w=dt.get(i,t)):(g.type=2,C.type=1,w=dt.get(t,i)),g.segment=C.segment=w,vt.queue.insert(g),vt.queue.insert(C),i.links.insert(t),t.links.insert(i),null==vt.ints){null==Al.zpp_pool?vt.ints=new Al:(vt.ints=Al.zpp_pool,Al.zpp_pool=vt.ints.next,vt.ints.next=null);vt.ints.lt=ct.less_xy}for(;!vt.queue.empty();){var M=vt.queue.pop_front();if(vt.sweep.sweepx=M.vertex.x,1==M.type){var k=M.segment;if(vt.sweep.add(k),null!=k.next&&null!=k&&!(k.id>k.next.id?vt.inthash.has(k.next.id,k.id):vt.inthash.has(k.id,k.next.id))){var O=vt.sweep.intersection(k.next,k);if(null!=O)if(O.vertex.x<vt.sweep.sweepx){var S=O.vertex;S.links.clear(),S.node=null,S.forced=!1,S.next=ut.zpp_pool,ut.zpp_pool=S;var P=O;P.vertex=null,P.segment=P.segment2=null,P.node=null,P.next=ct.zpp_pool,ct.zpp_pool=P}else{for(var T=vt.queue.parent;null!=T;)if(vt.queue.lt(O,T.data))T=T.prev;else{if(!vt.queue.lt(T.data,O))break;T=T.next}var A=T;if(null==A){for(var E=vt.ints.parent;null!=E;)if(vt.ints.lt(O,E.data))E=E.prev;else{if(!vt.ints.lt(E.data,O))break;E=E.next}var I=E;if(null!=I){var V=O.vertex;V.links.clear(),V.node=null,V.forced=!1,V.next=ut.zpp_pool,ut.zpp_pool=V,O.vertex=I.data.vertex,I.data=O,vt.queue.insert(O)}else vt.queue.insert(O),vt.ints.insert(O);if(k.id>k.next.id){var L,N=vt.inthash,D=k.next.id,j=k.id;null==Jt.zpp_pool?L=new Jt:(L=Jt.zpp_pool,Jt.zpp_pool=L.next,L.next=null),L.id=D,L.di=j;var F=L;F.value=!0,N.add(F)}else{var B,R=vt.inthash,G=k.id,Y=k.next.id;null==Jt.zpp_pool?B=new Jt:(B=Jt.zpp_pool,Jt.zpp_pool=B.next,B.next=null),B.id=G,B.di=Y;var U=B;U.value=!0,R.add(U)}}else{var Z=O.vertex;Z.links.clear(),Z.node=null,Z.forced=!1,Z.next=ut.zpp_pool,ut.zpp_pool=Z;var q=O;q.vertex=null,q.segment=q.segment2=null,q.node=null,q.next=ct.zpp_pool,ct.zpp_pool=q}}}if(null!=k&&null!=k.prev&&!(k.prev.id>k.id?vt.inthash.has(k.id,k.prev.id):vt.inthash.has(k.prev.id,k.id))){var W=vt.sweep.intersection(k,k.prev);if(null!=W)if(W.vertex.x<vt.sweep.sweepx){var X=W.vertex;X.links.clear(),X.node=null,X.forced=!1,X.next=ut.zpp_pool,ut.zpp_pool=X;var H=W;H.vertex=null,H.segment=H.segment2=null,H.node=null,H.next=ct.zpp_pool,ct.zpp_pool=H}else{for(var K=vt.queue.parent;null!=K;)if(vt.queue.lt(W,K.data))K=K.prev;else{if(!vt.queue.lt(K.data,W))break;K=K.next}var J=K;if(null==J){for(var Q=vt.ints.parent;null!=Q;)if(vt.ints.lt(W,Q.data))Q=Q.prev;else{if(!vt.ints.lt(Q.data,W))break;Q=Q.next}var $=Q;if(null!=$){var nn=W.vertex;nn.links.clear(),nn.node=null,nn.forced=!1,nn.next=ut.zpp_pool,ut.zpp_pool=nn,W.vertex=$.data.vertex,$.data=W,vt.queue.insert(W)}else vt.queue.insert(W),vt.ints.insert(W);if(k.prev.id>k.id){var en,tn=vt.inthash,ln=k.id,rn=k.prev.id;null==Jt.zpp_pool?en=new Jt:(en=Jt.zpp_pool,Jt.zpp_pool=en.next,en.next=null),en.id=ln,en.di=rn;var an=en;an.value=!0,tn.add(an)}else{var pn,sn=vt.inthash,on=k.prev.id,hn=k.id;null==Jt.zpp_pool?pn=new Jt:(pn=Jt.zpp_pool,Jt.zpp_pool=pn.next,pn.next=null),pn.id=on,pn.di=hn;var _n=pn;_n.value=!0,sn.add(_n)}}else{var un=W.vertex;un.links.clear(),un.node=null,un.forced=!1,un.next=ut.zpp_pool,ut.zpp_pool=un;var dn=W;dn.vertex=null,dn.segment=dn.segment2=null,dn.node=null,dn.next=ct.zpp_pool,ct.zpp_pool=dn}}}}else if(2==M.type){var cn=M.segment;if(null!=cn.node){var xn=cn.next,vn=cn.prev;vt.sweep.remove(cn);var zn=cn;if(zn.left=zn.right=null,zn.prev=null,zn.node=null,zn.vertices.clear(),zn.next=dt.zpp_pool,dt.zpp_pool=zn,null!=xn&&null!=vn&&!(vn.id>xn.id?vt.inthash.has(xn.id,vn.id):vt.inthash.has(vn.id,xn.id))){var yn=vt.sweep.intersection(xn,vn);if(null!=yn)if(yn.vertex.x<vt.sweep.sweepx){var fn=yn.vertex;fn.links.clear(),fn.node=null,fn.forced=!1,fn.next=ut.zpp_pool,ut.zpp_pool=fn;var mn=yn;mn.vertex=null,mn.segment=mn.segment2=null,mn.node=null,mn.next=ct.zpp_pool,ct.zpp_pool=mn}else{for(var bn=vt.queue.parent;null!=bn;)if(vt.queue.lt(yn,bn.data))bn=bn.prev;else{if(!vt.queue.lt(bn.data,yn))break;bn=bn.next}var gn=bn;if(null==gn){for(var wn=vt.ints.parent;null!=wn;)if(vt.ints.lt(yn,wn.data))wn=wn.prev;else{if(!vt.ints.lt(wn.data,yn))break;wn=wn.next}var Cn=wn;if(null!=Cn){var Mn=yn.vertex;Mn.links.clear(),Mn.node=null,Mn.forced=!1,Mn.next=ut.zpp_pool,ut.zpp_pool=Mn,yn.vertex=Cn.data.vertex,Cn.data=yn,vt.queue.insert(yn)}else vt.queue.insert(yn),vt.ints.insert(yn);if(vn.id>xn.id){var kn,On=vt.inthash,Sn=xn.id,Pn=vn.id;null==Jt.zpp_pool?kn=new Jt:(kn=Jt.zpp_pool,Jt.zpp_pool=kn.next,kn.next=null),kn.id=Sn,kn.di=Pn;var Tn=kn;Tn.value=!0,On.add(Tn)}else{var An,En=vt.inthash,In=vn.id,Vn=xn.id;null==Jt.zpp_pool?An=new Jt:(An=Jt.zpp_pool,Jt.zpp_pool=An.next,An.next=null),An.id=In,An.di=Vn;var Ln=An;Ln.value=!0,En.add(Ln)}}else{var Nn=yn.vertex;Nn.links.clear(),Nn.node=null,Nn.forced=!1,Nn.next=ut.zpp_pool,ut.zpp_pool=Nn;var Dn=yn;Dn.vertex=null,Dn.segment=Dn.segment2=null,Dn.node=null,Dn.next=ct.zpp_pool,ct.zpp_pool=Dn}}}}}else{var jn=M.vertex,Fn=null==jn.node,Bn=M.segment,Rn=M.segment2;if(Rn.next!=Bn){var Gn=Bn;Bn=Rn,Rn=Gn}for(var Yn=Bn.vertices.parent;null!=Yn;)if(Bn.vertices.lt(jn,Yn.data))Yn=Yn.prev;else{if(!Bn.vertices.lt(Yn.data,jn))break;Yn=Yn.next}for(var Un=null==Yn,Zn=Rn.vertices.parent;null!=Zn;)if(Rn.vertices.lt(jn,Zn.data))Zn=Zn.prev;else{if(!Rn.vertices.lt(Zn.data,jn))break;Zn=Zn.next}var qn=null==Zn;if(Un){var Wn=Bn.vertices.insert(jn),Xn=jn==Bn.left?jn:Bn.vertices.predecessor_node(Wn).data,Hn=jn==Bn.right?jn:Bn.vertices.successor_node(Wn).data;Xn.links.remove(Hn),jn!=Xn&&Xn.links.insert(jn),Hn.links.remove(Xn),jn!=Hn&&Hn.links.insert(jn),jn!=Xn&&jn.links.insert(Xn),jn!=Hn&&jn.links.insert(Hn)}if(qn){var Kn=Rn.vertices.insert(jn),Jn=jn==Rn.left?jn:Rn.vertices.predecessor_node(Kn).data,Qn=jn==Rn.right?jn:Rn.vertices.successor_node(Kn).data;Jn.links.remove(Qn),jn!=Jn&&Jn.links.insert(jn),Qn.links.remove(Jn),jn!=Qn&&Qn.links.insert(jn),jn!=Jn&&jn.links.insert(Jn),jn!=Qn&&jn.links.insert(Qn)}if(Fn&&(jn.node=vt.vertices.insert(jn)),jn.forced=!0,Fn){var $n=Bn.node,ne=Rn.node;$n.data=Rn,ne.data=Bn,Bn.node=ne,Rn.node=$n,Rn.next=Bn.next,Bn.next=Rn,Bn.prev=Rn.prev,Rn.prev=Bn,null!=Bn.prev&&(Bn.prev.next=Bn),null!=Rn.next&&(Rn.next.prev=Rn)}if(null!=Rn.next&&null!=Rn&&!(Rn.id>Rn.next.id?vt.inthash.has(Rn.next.id,Rn.id):vt.inthash.has(Rn.id,Rn.next.id))){var ee=vt.sweep.intersection(Rn.next,Rn);if(null!=ee)if(ee.vertex.x<vt.sweep.sweepx){var te=ee.vertex;te.links.clear(),te.node=null,te.forced=!1,te.next=ut.zpp_pool,ut.zpp_pool=te;var ie=ee;ie.vertex=null,ie.segment=ie.segment2=null,ie.node=null,ie.next=ct.zpp_pool,ct.zpp_pool=ie}else{for(var le=vt.queue.parent;null!=le;)if(vt.queue.lt(ee,le.data))le=le.prev;else{if(!vt.queue.lt(le.data,ee))break;le=le.next}var re=le;if(null==re){for(var ae=vt.ints.parent;null!=ae;)if(vt.ints.lt(ee,ae.data))ae=ae.prev;else{if(!vt.ints.lt(ae.data,ee))break;ae=ae.next}var pe=ae;if(null!=pe){var se=ee.vertex;se.links.clear(),se.node=null,se.forced=!1,se.next=ut.zpp_pool,ut.zpp_pool=se,ee.vertex=pe.data.vertex,pe.data=ee,vt.queue.insert(ee)}else vt.queue.insert(ee),vt.ints.insert(ee);if(Rn.id>Rn.next.id){var oe,he=vt.inthash,_e=Rn.next.id,ue=Rn.id;null==Jt.zpp_pool?oe=new Jt:(oe=Jt.zpp_pool,Jt.zpp_pool=oe.next,oe.next=null),oe.id=_e,oe.di=ue;var de=oe;de.value=!0,he.add(de)}else{var ce,xe=vt.inthash,ve=Rn.id,ze=Rn.next.id;null==Jt.zpp_pool?ce=new Jt:(ce=Jt.zpp_pool,Jt.zpp_pool=ce.next,ce.next=null),ce.id=ve,ce.di=ze;var ye=ce;ye.value=!0,xe.add(ye)}}else{var fe=ee.vertex;fe.links.clear(),fe.node=null,fe.forced=!1,fe.next=ut.zpp_pool,ut.zpp_pool=fe;var me=ee;me.vertex=null,me.segment=me.segment2=null,me.node=null,me.next=ct.zpp_pool,ct.zpp_pool=me}}}if(null!=Bn&&null!=Bn.prev&&!(Bn.prev.id>Bn.id?vt.inthash.has(Bn.id,Bn.prev.id):vt.inthash.has(Bn.prev.id,Bn.id))){var be=vt.sweep.intersection(Bn,Bn.prev);if(null!=be)if(be.vertex.x<vt.sweep.sweepx){var ge=be.vertex;ge.links.clear(),ge.node=null,ge.forced=!1,ge.next=ut.zpp_pool,ut.zpp_pool=ge;var we=be;we.vertex=null,we.segment=we.segment2=null,we.node=null,we.next=ct.zpp_pool,ct.zpp_pool=we}else{for(var Ce=vt.queue.parent;null!=Ce;)if(vt.queue.lt(be,Ce.data))Ce=Ce.prev;else{if(!vt.queue.lt(Ce.data,be))break;Ce=Ce.next}var Me=Ce;if(null==Me){for(var ke=vt.ints.parent;null!=ke;)if(vt.ints.lt(be,ke.data))ke=ke.prev;else{if(!vt.ints.lt(ke.data,be))break;ke=ke.next}var Oe=ke;if(null!=Oe){var Se=be.vertex;Se.links.clear(),Se.node=null,Se.forced=!1,Se.next=ut.zpp_pool,ut.zpp_pool=Se,be.vertex=Oe.data.vertex,Oe.data=be,vt.queue.insert(be)}else vt.queue.insert(be),vt.ints.insert(be);if(Bn.prev.id>Bn.id){var Pe,Te=vt.inthash,Ae=Bn.id,Ee=Bn.prev.id;null==Jt.zpp_pool?Pe=new Jt:(Pe=Jt.zpp_pool,Jt.zpp_pool=Pe.next,Pe.next=null),Pe.id=Ae,Pe.di=Ee;var Ie=Pe;Ie.value=!0,Te.add(Ie)}else{var Ve,Le=vt.inthash,Ne=Bn.prev.id,De=Bn.id;null==Jt.zpp_pool?Ve=new Jt:(Ve=Jt.zpp_pool,Jt.zpp_pool=Ve.next,Ve.next=null),Ve.id=Ne,Ve.di=De;var je=Ve;je.value=!0,Le.add(je)}}else{var Fe=be.vertex;Fe.links.clear(),Fe.node=null,Fe.forced=!1,Fe.next=ut.zpp_pool,ut.zpp_pool=Fe;var Be=be;Be.vertex=null,Be.segment=Be.segment2=null,Be.node=null,Be.next=ct.zpp_pool,ct.zpp_pool=Be}}}vt.ints.remove(M)}var Re=M;Re.vertex=null,Re.segment=Re.segment2=null,Re.node=null,Re.next=ct.zpp_pool,ct.zpp_pool=Re}for(var Ge=0,Ye=vt.inthash.table.length;Ye>Ge;){var Ue=Ge++,Ze=vt.inthash.table[Ue];if(null!=Ze){for(;null!=Ze;){var qe=Ze.hnext;Ze.hnext=null;var We=Ze;We.next=Jt.zpp_pool,Jt.zpp_pool=We,Ze=qe}vt.inthash.table[Ue]=null}}for(null==e&&(e=new oi);!vt.vertices.empty();)vt.clip_polygon(vt.vertices,e);return e},vt.clip_polygon=function(n,e){var t=null,i=n.first(),l=i,r=i.links.parent,a=null==r.prev?r.next:r.prev,p=r.data,s=a.data,o=0,h=0;o=i.x-p.x,h=i.y-p.y;var _=0,u=0;_=s.x-i.x,0>(u=s.y-i.y)*o-_*h&&(s=p);var d,c=i.x,x=i.y;null==nt.zpp_pool?d=new nt:(d=nt.zpp_pool,nt.zpp_pool=d.next,d.next=null),d.forced=!1,d.x=c,d.y=x;var v=d;for(null==t?t=v.prev=v.next=v:(v.prev=t,v.next=t.next,t.next.prev=v,t.next=v),t=v,t.forced=i.forced;;){if(i.links.remove(s),s.links.remove(i),s==l){if(i.links.empty()){n.remove(i);var z=i;z.links.clear(),z.node=null,z.forced=!1,z.next=ut.zpp_pool,ut.zpp_pool=z}break}var y,f=s.x,m=s.y;null==nt.zpp_pool?y=new nt:(y=nt.zpp_pool,nt.zpp_pool=y.next,y.next=null),y.forced=!1,y.x=f,y.y=m;var b=y;if(null==t?t=b.prev=b.next=b:(b.prev=t,b.next=t.next,t.next.prev=b,t.next=b),t=b,t.forced=s.forced,s.links.singular()){if(i.links.empty()){n.remove(i);var g=i;g.links.clear(),g.node=null,g.forced=!1,g.next=ut.zpp_pool,ut.zpp_pool=g}i=s,s=s.links.parent.data}else{var w=null,C=0;if(!s.links.empty()){for(var M=s.links.parent;null!=M.prev;)M=M.prev;for(;null!=M;){var k=M.data;if(null==w){w=k;var O=0,S=0;O=s.x-i.x,S=s.y-i.y;var P=0,T=0;P=k.x-s.x,T=k.y-s.y,C=T*O-P*S}else{var A=0,E=0;A=s.x-i.x,E=s.y-i.y;var I=0,V=0;I=k.x-s.x,V=k.y-s.y;var L=V*A-I*E;if(L>0&&0>=C)w=k,C=L;else if(C*L>=0){var N=0,D=0;N=s.x-k.x,D=s.y-k.y;var j=0,F=0;j=w.x-s.x,F=w.y-s.y;var B=F*N-j*D;B>0&&(w=k,C=L)}}if(null!=M.next)for(M=M.next;null!=M.prev;)M=M.prev;else{for(;null!=M.parent&&M==M.parent.next;)M=M.parent;M=M.parent}}}if(i.links.empty()){n.remove(i);var R=i;R.links.clear(),R.node=null,R.forced=!1,R.next=ut.zpp_pool,ut.zpp_pool=R}i=s,s=w}}n.remove(l);var G=l;G.links.clear(),G.node=null,G.forced=!1,G.next=ut.zpp_pool,ut.zpp_pool=G,e.add(t)},vt.isSimple=function(n){null==vt.sweep&&(vt.sweep=new xt,vt.inthash=new Qt);var e=vt.list_vertices;null==e&&(e=vt.list_vertices=new _i);var t=n,i=n;if(null!=t)for(var l=t;;){var r,a=l,p=a.x,s=a.y;if(null==ut.zpp_pool?r=new ut:(r=ut.zpp_pool,ut.zpp_pool=r.next,r.next=null),r.x=p,r.y=s,e.add(r),(l=l.next)==i)break}var o=vt.list_queue;null==o&&(o=vt.list_queue=new ui);var h=e.head,_=h.elt;for(h=h.next;null!=h;){var u,d=h.elt;null==ct.zpp_pool?u=new ct:(u=ct.zpp_pool,ct.zpp_pool=u.next,u.next=null),u.vertex=_;var c,x=o.add(u);null==ct.zpp_pool?c=new ct:(c=ct.zpp_pool,ct.zpp_pool=c.next,c.next=null),c.vertex=d;var v,z=o.add(c);ct.less_xy(x,z)?(x.type=1,z.type=2,v=dt.get(_,d)):(x.type=2,z.type=1,v=dt.get(d,_)),x.segment=z.segment=v,_=d,h=h.next}var y,f=e.head.elt;null==ct.zpp_pool?y=new ct:(y=ct.zpp_pool,ct.zpp_pool=y.next,y.next=null),y.vertex=_;var m,b=o.add(y);null==ct.zpp_pool?m=new ct:(m=ct.zpp_pool,ct.zpp_pool=m.next,m.next=null),m.vertex=f;var g,w=o.add(m);ct.less_xy(b,w)?(b.type=1,w.type=2,g=dt.get(_,f)):(b.type=2,w.type=1,g=dt.get(f,_)),b.segment=w.segment=g;var C=o;if(null!=C.head&&null!=C.head.next){for(var M,k,O,S=C.head,P=null,T=null,A=null,E=null,I=1;;){for(M=0,T=S,S=null,P=S;null!=T;){for(++M,A=T,k=0,O=I;null!=A&&I>k;)++k,A=A.next;for(;k>0||O>0&&null!=A;)0==k?(E=A,A=A.next,--O):0==O||null==A?(E=T,T=T.next,--k):ct.less_xy(T.elt,A.elt)?(E=T,T=T.next,--k):(E=A,A=A.next,--O),null!=P?P.next=E:S=E,P=E;T=A}if(P.next=null,I<<=1,M<=1)break}C.head=S,C.modified=!0,C.pushmod=!0}for(var V=!0;null!=o.head;){var L=o.pop_unsafe(),N=L.segment;if(1==L.type){if(vt.sweep.add(N),vt.sweep.intersect(N,N.next)||vt.sweep.intersect(N,N.prev)){V=!1;break}}else if(2==L.type){if(vt.sweep.intersect(N.prev,N.next)){V=!1;break}vt.sweep.remove(N);var D=N;D.left=D.right=null,D.prev=null,D.node=null,D.vertices.clear(),D.next=dt.zpp_pool,dt.zpp_pool=D}var j=L;j.vertex=null,j.segment=j.segment2=null,j.node=null,j.next=ct.zpp_pool,ct.zpp_pool=j}for(;null!=o.head;){var F=o.pop_unsafe();if(2==F.type){var B=F.segment;B.left=B.right=null,B.prev=null,B.node=null,B.vertices.clear(),B.next=dt.zpp_pool,dt.zpp_pool=B}var R=F;R.vertex=null,R.segment=R.segment2=null,R.node=null,R.next=ct.zpp_pool,ct.zpp_pool=R}for(vt.sweep.clear();null!=e.head;){var G=e.pop_unsafe();G.links.clear(),G.node=null,G.forced=!1,G.next=ut.zpp_pool,ut.zpp_pool=G}return V};var zt=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};l["zpp_nape.geom.ZPP_SimplifyV"]=zt,zt.__name__=["zpp_nape","geom","ZPP_SimplifyV"],zt.get=function(n){var e;return null==zt.zpp_pool?e=new zt:(e=zt.zpp_pool,zt.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e.flag=!1,e},zt.prototype={x:null,y:null,next:null,prev:null,flag:null,forced:null,free:function(){},alloc:function(){},__class__:zt};var yt=function(){this.max=null,this.min=null,this.next=null};l["zpp_nape.geom.ZPP_SimplifyP"]=yt,yt.__name__=["zpp_nape","geom","ZPP_SimplifyP"],yt.get=function(n,e){var t;return null==yt.zpp_pool?t=new yt:(t=yt.zpp_pool,yt.zpp_pool=t.next,t.next=null),t.min=n,t.max=e,t},yt.prototype={next:null,min:null,max:null,free:function(){this.min=this.max=null},alloc:function(){},__class__:yt};var ft=function(){};l["zpp_nape.geom.ZPP_Simplify"]=ft,ft.__name__=["zpp_nape","geom","ZPP_Simplify"],ft.lessval=function(n,e){return n.x-e.x+(n.y-e.y)},ft.less=function(n,e){return 0>n.x-e.x+(n.y-e.y)},ft.distance=function(n,e,t){var i=0,l=0;i=t.x-e.x,l=t.y-e.y;var r=0,a=0;if(r=n.x-e.x,a=n.y-e.y,0==i*i+l*l)return r*r+a*a;var p=(r*i+a*l)/(i*i+l*l);if(p>0){if(1>p){var s=p;return r-=i*s,a-=l*s,r*r+a*a}var o=0,h=0;return o=n.x-t.x,h=n.y-t.y,o*o+h*h}return r*r+a*a},ft.simplify=function(n,e){var t=null,i=null,l=null;e*=e,null==ft.stack&&(ft.stack=new hi);for(var r=null,a=null,p=n;;){var s;null==zt.zpp_pool?s=new zt:(s=zt.zpp_pool,zt.zpp_pool=s.next,s.next=null),s.x=p.x,s.y=p.y,s.flag=!1;var o=s;if(o.forced=p.forced){if(o.flag=!0,null!=r){var h,_=ft.stack;null==yt.zpp_pool?h=new yt:(h=yt.zpp_pool,yt.zpp_pool=h.next,h.next=null),h.min=r,h.max=o,_.add(h)}else a=o;r=o}var u=o;if(null==t?t=u.prev=u.next=u:(u.prev=t,u.next=t.next,t.next.prev=u,t.next=u),t=u,null==i?(i=t,l=t):(0>t.x-i.x+(t.y-i.y)&&(i=t),0>l.x-t.x+(l.y-t.y)&&(l=t)),(p=p.next)==n)break}if(null==ft.stack.head)if(null==a){i.flag=l.flag=!0;var d,c=ft.stack;null==yt.zpp_pool?d=new yt:(d=yt.zpp_pool,yt.zpp_pool=d.next,d.next=null),d.min=i,d.max=l,c.add(d);var x,v=ft.stack;null==yt.zpp_pool?x=new yt:(x=yt.zpp_pool,yt.zpp_pool=x.next,x.next=null),x.min=l,x.max=i,v.add(x)}else{var z=i.x-a.x+(i.y-a.y);0>z&&(z=-z);var y=l.x-a.x+(l.y-a.y);if(0>y&&(y=-y),z>y){i.flag=a.flag=!0;var f,m=ft.stack;null==yt.zpp_pool?f=new yt:(f=yt.zpp_pool,yt.zpp_pool=f.next,f.next=null),f.min=i,f.max=a,m.add(f);var b,g=ft.stack;null==yt.zpp_pool?b=new yt:(b=yt.zpp_pool,yt.zpp_pool=b.next,b.next=null),b.min=a,b.max=i,g.add(b)}else{l.flag=a.flag=!0;var w,C=ft.stack;null==yt.zpp_pool?w=new yt:(w=yt.zpp_pool,yt.zpp_pool=w.next,w.next=null),w.min=l,w.max=a,C.add(w);var M,k=ft.stack;null==yt.zpp_pool?M=new yt:(M=yt.zpp_pool,yt.zpp_pool=M.next,M.next=null),M.min=a,M.max=l,k.add(M)}}else{var O,S=ft.stack;null==yt.zpp_pool?O=new yt:(O=yt.zpp_pool,yt.zpp_pool=O.next,O.next=null),O.min=r,O.max=a,S.add(O)}for(;null!=ft.stack.head;){var P=ft.stack.pop_unsafe(),T=P.min,A=P.max,E=P;E.min=E.max=null,E.next=yt.zpp_pool,yt.zpp_pool=E;for(var I=e,V=null,L=T.next;L!=A;){var N=ft.distance(L,T,A);N>I&&(I=N,V=L),L=L.next}if(null!=V){V.flag=!0;var D,j=ft.stack;null==yt.zpp_pool?D=new yt:(D=yt.zpp_pool,yt.zpp_pool=D.next,D.next=null),D.min=T,D.max=V,j.add(D);var F,B=ft.stack;null==yt.zpp_pool?F=new yt:(F=yt.zpp_pool,yt.zpp_pool=F.next,F.next=null),F.min=V,F.max=A,B.add(F)}}for(var R=null;null!=t;){if(t.flag){var G,Y=t.x,U=t.y;null==nt.zpp_pool?G=new nt:(G=nt.zpp_pool,nt.zpp_pool=G.next,G.next=null),G.forced=!1,G.x=Y,G.y=U;var Z=G;null==R?R=Z.prev=Z.next=Z:(Z.prev=R,Z.next=R.next,R.next.prev=Z,R.next=Z),R=Z,R.forced=t.forced}if(null!=t&&t.prev==t){t.next=t.prev=null;var q=t;q.next=zt.zpp_pool,zt.zpp_pool=q,t=null,t=t}else{var W=t.next;t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null;var X=t;X.next=zt.zpp_pool,zt.zpp_pool=X,t=null,t=W}}return R};var mt=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new Ct,this.c2=new Ct,this.axis=new Ct};l["zpp_nape.geom.ZPP_ToiEvent"]=mt,mt.__name__=["zpp_nape","geom","ZPP_ToiEvent"],mt.prototype={next:null,alloc:function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},free:function(){},toi:null,s1:null,s2:null,arbiter:null,frozen1:null,frozen2:null,c1:null,c2:null,axis:null,slipped:null,failed:null,kinematic:null,__class__:mt};var bt=function(){};l["zpp_nape.geom.ZPP_SweepDistance"]=bt,bt.__name__=["zpp_nape","geom","ZPP_SweepDistance"],bt.dynamicSweep=function(n,e,t,i,l){null==l&&(l=!1);var r=n.s1,a=n.s2,p=r.body,s=a.body,o=0,h=0;o=s.velx-p.velx,h=s.vely-p.vely;var _=p.angvel;0>_&&(_=-_);var u=s.angvel;0>u&&(u=-u);var d=r.sweepCoef*_+a.sweepCoef*u;if(!l&&!n.kinematic&&f.dynamicSweepLinearThreshold*f.dynamicSweepLinearThreshold>o*o+h*h&&f.dynamicSweepAngularThreshold>d)return n.toi=-1,void(n.failed=!0);for(var c=n.c1,x=n.c2,v=n.axis,z=t,y=0;;){var m=z*e,b=m-p.sweepTime;if(0!=b){p.sweepTime=m;var g=b;if(p.posx+=p.velx*g,p.posy+=p.vely*g,0!=p.angvel){var w=p.sweep_angvel*b;if(p.rot+=w,w*w>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var C=w*w,M=1-.5*C,k=1-C*C/8,O=(M*p.axisx+w*p.axisy)*k;p.axisy=(M*p.axisy-w*p.axisx)*k,p.axisx=O}}}if(r.type==ye.id_ShapeType_CIRCLE)r.worldCOMx=p.posx+(p.axisy*r.localCOMx-p.axisx*r.localCOMy),r.worldCOMy=p.posy+(r.localCOMx*p.axisx+r.localCOMy*p.axisy);else{for(var S=r.polygon,P=S.lverts.next,T=S.gverts.next;null!=T;){var A=T,E=P;P=P.next,A.x=p.posx+(p.axisy*E.x-p.axisx*E.y),A.y=p.posy+(E.x*p.axisx+E.y*p.axisy),T=T.next}var I=S.edges.head,V=S.gverts.next,L=V;for(V=V.next;null!=V;){var N=V,D=I.elt;I=I.next,D.gnormx=p.axisy*D.lnormx-p.axisx*D.lnormy,D.gnormy=D.lnormx*p.axisx+D.lnormy*p.axisy,D.gprojection=p.posx*D.gnormx+p.posy*D.gnormy+D.lprojection,D.tp0=L.y*D.gnormx-L.x*D.gnormy,D.tp1=N.y*D.gnormx-N.x*D.gnormy,L=N,V=V.next}var j=S.gverts.next,F=I.elt;I=I.next,F.gnormx=p.axisy*F.lnormx-p.axisx*F.lnormy,F.gnormy=F.lnormx*p.axisx+F.lnormy*p.axisy,F.gprojection=p.posx*F.gnormx+p.posy*F.gnormy+F.lprojection,F.tp0=L.y*F.gnormx-L.x*F.gnormy,F.tp1=j.y*F.gnormx-j.x*F.gnormy}var B=z*e,R=B-s.sweepTime;if(0!=R){s.sweepTime=B;var G=R;if(s.posx+=s.velx*G,s.posy+=s.vely*G,0!=s.angvel){var Y=s.sweep_angvel*R;if(s.rot+=Y,Y*Y>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var U=Y*Y,Z=1-.5*U,q=1-U*U/8,W=(Z*s.axisx+Y*s.axisy)*q;s.axisy=(Z*s.axisy-Y*s.axisx)*q,s.axisx=W}}}if(a.type==ye.id_ShapeType_CIRCLE)a.worldCOMx=s.posx+(s.axisy*a.localCOMx-s.axisx*a.localCOMy),a.worldCOMy=s.posy+(a.localCOMx*s.axisx+a.localCOMy*s.axisy);else{for(var X=a.polygon,H=X.lverts.next,K=X.gverts.next;null!=K;){var J=K,Q=H;H=H.next,J.x=s.posx+(s.axisy*Q.x-s.axisx*Q.y),J.y=s.posy+(Q.x*s.axisx+Q.y*s.axisy),K=K.next}var $=X.edges.head,nn=X.gverts.next,en=nn;for(nn=nn.next;null!=nn;){var tn=nn,ln=$.elt;$=$.next,ln.gnormx=s.axisy*ln.lnormx-s.axisx*ln.lnormy,ln.gnormy=ln.lnormx*s.axisx+ln.lnormy*s.axisy,ln.gprojection=s.posx*ln.gnormx+s.posy*ln.gnormy+ln.lprojection,ln.tp0=en.y*ln.gnormx-en.x*ln.gnormy,ln.tp1=tn.y*ln.gnormx-tn.x*ln.gnormy,en=tn,nn=nn.next}var rn=X.gverts.next,an=$.elt;$=$.next,an.gnormx=s.axisy*an.lnormx-s.axisx*an.lnormy,an.gnormy=an.lnormx*s.axisx+an.lnormy*s.axisy,an.gprojection=s.posx*an.gnormx+s.posy*an.gnormy+an.lprojection,an.tp0=en.y*an.gnormx-en.x*an.gnormy,an.tp1=rn.y*an.gnormx-rn.x*an.gnormy}var pn,sn=r,on=a,hn=c,_n=x;if(sn.type==ye.id_ShapeType_CIRCLE&&on.type==ye.id_ShapeType_CIRCLE){var un,dn=sn.circle,cn=on.circle,xn=0,vn=0;xn=cn.worldCOMx-dn.worldCOMx,vn=cn.worldCOMy-dn.worldCOMy;var zn=Math.sqrt(xn*xn+vn*vn);if(1e100>(un=zn-(dn.radius+cn.radius))){if(0==zn)xn=1,vn=0;else{var yn=1/zn;xn*=yn,vn*=yn}var fn=dn.radius;hn.x=dn.worldCOMx+xn*fn,hn.y=dn.worldCOMy+vn*fn;var mn=-cn.radius;_n.x=cn.worldCOMx+xn*mn,_n.y=cn.worldCOMy+vn*mn,v.x=xn,v.y=vn}pn=un}else{var bn=!1;if(sn.type==ye.id_ShapeType_CIRCLE&&on.type==ye.id_ShapeType_POLYGON){var gn=sn;sn=on,on=gn;var wn=hn;hn=_n,_n=wn,bn=!0}if(sn.type==ye.id_ShapeType_POLYGON&&on.type==ye.id_ShapeType_CIRCLE){for(var Cn=sn.polygon,Mn=on.circle,kn=-1e100,On=null,Sn=Cn.edges.head;null!=Sn;){var Pn=Sn.elt,Tn=Pn.gnormx*Mn.worldCOMx+Pn.gnormy*Mn.worldCOMy-Pn.gprojection-Mn.radius;if(Tn>1e100){kn=Tn;break}Tn>0?Tn>kn&&(kn=Tn,On=Pn):0>kn&&Tn>kn&&(kn=Tn,On=Pn),Sn=Sn.next}if(1e100>kn){var An=On.gp0,En=On.gp1,In=Mn.worldCOMy*On.gnormx-Mn.worldCOMx*On.gnormy;if(An.y*On.gnormx-An.x*On.gnormy<In)if(In<En.y*On.gnormx-En.x*On.gnormy){var Vn=-Mn.radius;_n.x=Mn.worldCOMx+On.gnormx*Vn,_n.y=Mn.worldCOMy+On.gnormy*Vn;var Ln=-kn;hn.x=_n.x+On.gnormx*Ln,hn.y=_n.y+On.gnormy*Ln,v.x=On.gnormx,v.y=On.gnormy}else{var Nn=0,Dn=0;Nn=Mn.worldCOMx-En.x,Dn=Mn.worldCOMy-En.y;var jn=Math.sqrt(Nn*Nn+Dn*Dn);if(1e100>(kn=jn-Mn.radius)){if(0==jn)Nn=1,Dn=0;else{var Fn=1/jn;Nn*=Fn,Dn*=Fn}hn.x=En.x+0*Nn,hn.y=En.y+0*Dn;var Bn=-Mn.radius;_n.x=Mn.worldCOMx+Nn*Bn,_n.y=Mn.worldCOMy+Dn*Bn,v.x=Nn,v.y=Dn}}else{var Rn=0,Gn=0;Rn=Mn.worldCOMx-An.x,Gn=Mn.worldCOMy-An.y;var Yn=Math.sqrt(Rn*Rn+Gn*Gn);if(1e100>(kn=Yn-Mn.radius)){if(0==Yn)Rn=1,Gn=0;else{var Un=1/Yn;Rn*=Un,Gn*=Un}hn.x=An.x+0*Rn,hn.y=An.y+0*Gn;var Zn=-Mn.radius;_n.x=Mn.worldCOMx+Rn*Zn,_n.y=Mn.worldCOMy+Gn*Zn,v.x=Rn,v.y=Gn}}}bn&&(v.x=-v.x,v.y=-v.y),pn=kn}else{for(var qn=sn.polygon,Wn=on.polygon,Xn=-1e100,Hn=null,Kn=null,Jn=0,Qn=qn.edges.head;null!=Qn;){for(var $n=Qn.elt,ne=1e100,ee=Wn.gverts.next;null!=ee;){var te=ee,ie=$n.gnormx*te.x+$n.gnormy*te.y;ne>ie&&(ne=ie),ee=ee.next}if((ne-=$n.gprojection)>1e100){Xn=ne;break}ne>0?ne>Xn&&(Xn=ne,Hn=$n,Jn=1):0>Xn&&ne>Xn&&(Xn=ne,Hn=$n,Jn=1),Qn=Qn.next}if(1e100>Xn){for(var le=Wn.edges.head;null!=le;){for(var re=le.elt,ae=1e100,pe=qn.gverts.next;null!=pe;){var se=pe,oe=re.gnormx*se.x+re.gnormy*se.y;ae>oe&&(ae=oe),pe=pe.next}if((ae-=re.gprojection)>1e100){Xn=ae;break}ae>0?ae>Xn&&(Xn=ae,Kn=re,Jn=2):0>Xn&&ae>Xn&&(Xn=ae,Kn=re,Jn=2),le=le.next}if(1e100>Xn){var he,_e;if(1==Jn)qn,he=Wn,_e=Hn;else{Wn,he=qn,_e=Kn;var ue=hn;hn=_n,_n=ue,bn=!bn}for(var de=null,ce=1e100,xe=he.edges.head;null!=xe;){var ve=xe.elt,ze=_e.gnormx*ve.gnormx+_e.gnormy*ve.gnormy;ce>ze&&(ce=ze,de=ve),xe=xe.next}if(bn?(v.x=-_e.gnormx,v.y=-_e.gnormy):(v.x=_e.gnormx,v.y=_e.gnormy),0>Xn){var fe=0,me=0;fe=de.gp0.x,me=de.gp0.y;var be=0,ge=0;be=de.gp1.x,ge=de.gp1.y;var we=0,Ce=0;we=be-fe,Ce=ge-me;var Me=_e.gnormy*fe-_e.gnormx*me,ke=_e.gnormy*be-_e.gnormx*ge,Oe=1/(ke-Me),Se=(-_e.tp1-Me)*Oe;if(Se>f.epsilon){var Pe=Se;fe+=we*Pe,me+=Ce*Pe}var Te=(-_e.tp0-ke)*Oe;if(-f.epsilon>Te){var Ae=Te;be+=we*Ae,ge+=Ce*Ae}var Ee=fe*_e.gnormx+me*_e.gnormy-_e.gprojection,Ie=be*_e.gnormx+ge*_e.gnormy-_e.gprojection;if(Ie>Ee){_n.x=fe,_n.y=me;var Ve=-Ee;hn.x=_n.x+_e.gnormx*Ve,hn.y=_n.y+_e.gnormy*Ve,pn=Ee}else{_n.x=be,_n.y=ge;var Le=-Ie;hn.x=_n.x+_e.gnormx*Le,hn.y=_n.y+_e.gnormy*Le,pn=Ie}}else{var Ne=_e.gp0,De=_e.gp1,je=de.gp0,Fe=de.gp1,Be=0,Re=0,Ge=0,Ye=0;Be=De.x-Ne.x,Re=De.y-Ne.y,Ge=Fe.x-je.x,Ye=Fe.y-je.y;var Ue=1/(Be*Be+Re*Re),Ze=1/(Ge*Ge+Ye*Ye),qe=-(Be*(Ne.x-je.x)+Re*(Ne.y-je.y))*Ue,We=-(Be*(Ne.x-Fe.x)+Re*(Ne.y-Fe.y))*Ue,Xe=-(Ge*(je.x-Ne.x)+Ye*(je.y-Ne.y))*Ze,He=-(Ge*(je.x-De.x)+Ye*(je.y-De.y))*Ze;0>qe?qe=0:qe>1&&(qe=1),0>We?We=0:We>1&&(We=1),0>Xe?Xe=0:Xe>1&&(Xe=1),0>He?He=0:He>1&&(He=1);var Ke=0,Je=0,Qe=qe;Ke=Ne.x+Be*Qe,Je=Ne.y+Re*Qe;var $e=0,nt=0,et=We;$e=Ne.x+Be*et,nt=Ne.y+Re*et;var tt=0,it=0,lt=Xe;tt=je.x+Ge*lt,it=je.y+Ye*lt;var rt=0,at=0,pt=He;rt=je.x+Ge*pt,at=je.y+Ye*pt;var st=0,ot=0;st=Ke-je.x,ot=Je-je.y;var ht=st*st+ot*ot,_t=0,ut=0;_t=$e-Fe.x,ut=nt-Fe.y;var dt=_t*_t+ut*ut,ct=0,xt=0;ct=tt-Ne.x,xt=it-Ne.y;var vt=ct*ct+xt*xt,zt=0,yt=0;zt=rt-De.x,yt=at-De.y;var ft=zt*zt+yt*yt,mt=0,bt=0,gt=null;dt>ht?(mt=Ke,bt=Je,gt=je):(mt=$e,bt=nt,gt=Fe,ht=dt);var wt=0,Ct=0,Mt=null;if(ft>vt?(wt=tt,Ct=it,Mt=Ne):(wt=rt,Ct=at,Mt=De,vt=ft),vt>ht?(hn.x=mt,hn.y=bt,_n.x=gt.x,_n.y=gt.y,Xn=Math.sqrt(ht)):(_n.x=wt,_n.y=Ct,hn.x=Mt.x,hn.y=Mt.y,Xn=Math.sqrt(vt)),0!=Xn){v.x=_n.x-hn.x,v.y=_n.y-hn.y;var kt=1/Xn;v.x*=kt,v.y*=kt,bn&&(v.x=-v.x,v.y=-v.y)}pn=Xn}}else pn=1e100}else pn=1e100}}var Ot=pn+i,St=o*v.x+h*v.y;if(f.distanceThresholdCCD>Ot){if(l)break;var Pt=0,Tt=0;Pt=c.x-p.posx,Tt=c.y-p.posy;var At=0,Et=0;At=x.x-s.posx,Et=x.y-s.posy;var It=St-p.sweep_angvel*(v.y*Pt-v.x*Tt)+s.sweep_angvel*(v.y*At-v.x*Et);if(It>0&&(n.slipped=!0),0>=It||.5*f.distanceThresholdCCD>Ot)break}var Vt=(d-St)*e;if(0>=Vt){z=-1;break}var Lt=Ot/Vt;if(1e-6>Lt&&(Lt=1e-6),(z+=Lt)>=1){z=1;var Nt=z*e,Dt=Nt-p.sweepTime;if(0!=Dt){p.sweepTime=Nt;var jt=Dt;if(p.posx+=p.velx*jt,p.posy+=p.vely*jt,0!=p.angvel){var Ft=p.sweep_angvel*Dt;if(p.rot+=Ft,Ft*Ft>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var Bt=Ft*Ft,Rt=1-.5*Bt,Gt=1-Bt*Bt/8,Yt=(Rt*p.axisx+Ft*p.axisy)*Gt;p.axisy=(Rt*p.axisy-Ft*p.axisx)*Gt,p.axisx=Yt}}}if(r.type==ye.id_ShapeType_CIRCLE)r.worldCOMx=p.posx+(p.axisy*r.localCOMx-p.axisx*r.localCOMy),r.worldCOMy=p.posy+(r.localCOMx*p.axisx+r.localCOMy*p.axisy);else{for(var Ut=r.polygon,Zt=Ut.lverts.next,qt=Ut.gverts.next;null!=qt;){var Wt=qt,Xt=Zt;Zt=Zt.next,Wt.x=p.posx+(p.axisy*Xt.x-p.axisx*Xt.y),Wt.y=p.posy+(Xt.x*p.axisx+Xt.y*p.axisy),qt=qt.next}var Ht=Ut.edges.head,Kt=Ut.gverts.next,Jt=Kt;for(Kt=Kt.next;null!=Kt;){var Qt=Kt,$t=Ht.elt;Ht=Ht.next,$t.gnormx=p.axisy*$t.lnormx-p.axisx*$t.lnormy,$t.gnormy=$t.lnormx*p.axisx+$t.lnormy*p.axisy,$t.gprojection=p.posx*$t.gnormx+p.posy*$t.gnormy+$t.lprojection,$t.tp0=Jt.y*$t.gnormx-Jt.x*$t.gnormy,$t.tp1=Qt.y*$t.gnormx-Qt.x*$t.gnormy,Jt=Qt,Kt=Kt.next}var ni=Ut.gverts.next,ei=Ht.elt;Ht=Ht.next,ei.gnormx=p.axisy*ei.lnormx-p.axisx*ei.lnormy,ei.gnormy=ei.lnormx*p.axisx+ei.lnormy*p.axisy,ei.gprojection=p.posx*ei.gnormx+p.posy*ei.gnormy+ei.lprojection,ei.tp0=Jt.y*ei.gnormx-Jt.x*ei.gnormy,ei.tp1=ni.y*ei.gnormx-ni.x*ei.gnormy}var ti=z*e,ii=ti-s.sweepTime;if(0!=ii){s.sweepTime=ti;var li=ii;if(s.posx+=s.velx*li,s.posy+=s.vely*li,0!=s.angvel){var ri=s.sweep_angvel*ii;if(s.rot+=ri,ri*ri>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var ai=ri*ri,pi=1-.5*ai,si=1-ai*ai/8,oi=(pi*s.axisx+ri*s.axisy)*si;s.axisy=(pi*s.axisy-ri*s.axisx)*si,s.axisx=oi}}}if(a.type==ye.id_ShapeType_CIRCLE)a.worldCOMx=s.posx+(s.axisy*a.localCOMx-s.axisx*a.localCOMy),a.worldCOMy=s.posy+(a.localCOMx*s.axisx+a.localCOMy*s.axisy);else{for(var hi=a.polygon,_i=hi.lverts.next,ui=hi.gverts.next;null!=ui;){var di=ui,ci=_i;_i=_i.next,di.x=s.posx+(s.axisy*ci.x-s.axisx*ci.y),di.y=s.posy+(ci.x*s.axisx+ci.y*s.axisy),ui=ui.next}var xi=hi.edges.head,vi=hi.gverts.next,zi=vi;for(vi=vi.next;null!=vi;){var yi=vi,fi=xi.elt;xi=xi.next,fi.gnormx=s.axisy*fi.lnormx-s.axisx*fi.lnormy,fi.gnormy=fi.lnormx*s.axisx+fi.lnormy*s.axisy,fi.gprojection=s.posx*fi.gnormx+s.posy*fi.gnormy+fi.lprojection,fi.tp0=zi.y*fi.gnormx-zi.x*fi.gnormy,fi.tp1=yi.y*fi.gnormx-yi.x*fi.gnormy,zi=yi,vi=vi.next}var mi=hi.gverts.next,bi=xi.elt;xi=xi.next,bi.gnormx=s.axisy*bi.lnormx-s.axisx*bi.lnormy,bi.gnormy=bi.lnormx*s.axisx+bi.lnormy*s.axisy,bi.gprojection=s.posx*bi.gnormx+s.posy*bi.gnormy+bi.lprojection,bi.tp0=zi.y*bi.gnormx-zi.x*bi.gnormy,bi.tp1=mi.y*bi.gnormx-mi.x*bi.gnormy}var gi,wi=r,Ci=a,Mi=c,ki=x;if(wi.type==ye.id_ShapeType_CIRCLE&&Ci.type==ye.id_ShapeType_CIRCLE){var Oi,Si=wi.circle,Pi=Ci.circle,Ti=0,Ai=0;Ti=Pi.worldCOMx-Si.worldCOMx,Ai=Pi.worldCOMy-Si.worldCOMy;var Ei=Math.sqrt(Ti*Ti+Ai*Ai);if(1e100>(Oi=Ei-(Si.radius+Pi.radius))){if(0==Ei)Ti=1,Ai=0;else{var Ii=1/Ei;Ti*=Ii,Ai*=Ii}var Vi=Si.radius;Mi.x=Si.worldCOMx+Ti*Vi,Mi.y=Si.worldCOMy+Ai*Vi;var Li=-Pi.radius;ki.x=Pi.worldCOMx+Ti*Li,ki.y=Pi.worldCOMy+Ai*Li,v.x=Ti,v.y=Ai}gi=Oi}else{var Ni=!1;if(wi.type==ye.id_ShapeType_CIRCLE&&Ci.type==ye.id_ShapeType_POLYGON){var Di=wi;wi=Ci,Ci=Di;var ji=Mi;Mi=ki,ki=ji,Ni=!0}if(wi.type==ye.id_ShapeType_POLYGON&&Ci.type==ye.id_ShapeType_CIRCLE){for(var Fi=wi.polygon,Bi=Ci.circle,Ri=-1e100,Gi=null,Yi=Fi.edges.head;null!=Yi;){var Ui=Yi.elt,Zi=Ui.gnormx*Bi.worldCOMx+Ui.gnormy*Bi.worldCOMy-Ui.gprojection-Bi.radius;if(Zi>1e100){Ri=Zi;break}Zi>0?Zi>Ri&&(Ri=Zi,Gi=Ui):0>Ri&&Zi>Ri&&(Ri=Zi,Gi=Ui),Yi=Yi.next}if(1e100>Ri){var qi=Gi.gp0,Wi=Gi.gp1,Xi=Bi.worldCOMy*Gi.gnormx-Bi.worldCOMx*Gi.gnormy;if(qi.y*Gi.gnormx-qi.x*Gi.gnormy<Xi)if(Xi<Wi.y*Gi.gnormx-Wi.x*Gi.gnormy){var Hi=-Bi.radius;ki.x=Bi.worldCOMx+Gi.gnormx*Hi,ki.y=Bi.worldCOMy+Gi.gnormy*Hi;var Ki=-Ri;Mi.x=ki.x+Gi.gnormx*Ki,Mi.y=ki.y+Gi.gnormy*Ki,v.x=Gi.gnormx,v.y=Gi.gnormy}else{var Ji=0,Qi=0;Ji=Bi.worldCOMx-Wi.x,Qi=Bi.worldCOMy-Wi.y;var $i=Math.sqrt(Ji*Ji+Qi*Qi);if(1e100>(Ri=$i-Bi.radius)){if(0==$i)Ji=1,Qi=0;else{var nl=1/$i;Ji*=nl,Qi*=nl}Mi.x=Wi.x+0*Ji,Mi.y=Wi.y+0*Qi;var el=-Bi.radius;ki.x=Bi.worldCOMx+Ji*el,ki.y=Bi.worldCOMy+Qi*el,v.x=Ji,v.y=Qi}}else{var tl=0,il=0;tl=Bi.worldCOMx-qi.x,il=Bi.worldCOMy-qi.y;var ll=Math.sqrt(tl*tl+il*il);if(1e100>(Ri=ll-Bi.radius)){if(0==ll)tl=1,il=0;else{var rl=1/ll;tl*=rl,il*=rl}Mi.x=qi.x+0*tl,Mi.y=qi.y+0*il;var al=-Bi.radius;ki.x=Bi.worldCOMx+tl*al,ki.y=Bi.worldCOMy+il*al,v.x=tl,v.y=il}}}Ni&&(v.x=-v.x,v.y=-v.y),gi=Ri}else{for(var pl=wi.polygon,sl=Ci.polygon,ol=-1e100,hl=null,_l=null,ul=0,dl=pl.edges.head;null!=dl;){for(var cl=dl.elt,xl=1e100,vl=sl.gverts.next;null!=vl;){var zl=vl,yl=cl.gnormx*zl.x+cl.gnormy*zl.y;xl>yl&&(xl=yl),vl=vl.next}if((xl-=cl.gprojection)>1e100){ol=xl;break}xl>0?xl>ol&&(ol=xl,hl=cl,ul=1):0>ol&&xl>ol&&(ol=xl,hl=cl,ul=1),dl=dl.next}if(1e100>ol){for(var fl=sl.edges.head;null!=fl;){for(var ml=fl.elt,bl=1e100,gl=pl.gverts.next;null!=gl;){var wl=gl,Cl=ml.gnormx*wl.x+ml.gnormy*wl.y;bl>Cl&&(bl=Cl),gl=gl.next}if((bl-=ml.gprojection)>1e100){ol=bl;break}bl>0?bl>ol&&(ol=bl,_l=ml,ul=2):0>ol&&bl>ol&&(ol=bl,_l=ml,ul=2),fl=fl.next}if(1e100>ol){var Ml,kl;if(1==ul)pl,Ml=sl,kl=hl;else{sl,Ml=pl,kl=_l;var Ol=Mi;Mi=ki,ki=Ol,Ni=!Ni}for(var Sl=null,Pl=1e100,Tl=Ml.edges.head;null!=Tl;){var Al=Tl.elt,El=kl.gnormx*Al.gnormx+kl.gnormy*Al.gnormy;Pl>El&&(Pl=El,Sl=Al),Tl=Tl.next}if(Ni?(v.x=-kl.gnormx,v.y=-kl.gnormy):(v.x=kl.gnormx,v.y=kl.gnormy),0>ol){var Il=0,Vl=0;Il=Sl.gp0.x,Vl=Sl.gp0.y;var Ll=0,Nl=0;Ll=Sl.gp1.x,Nl=Sl.gp1.y;var Dl=0,jl=0;Dl=Ll-Il,jl=Nl-Vl;var Fl=kl.gnormy*Il-kl.gnormx*Vl,Bl=kl.gnormy*Ll-kl.gnormx*Nl,Rl=1/(Bl-Fl),Gl=(-kl.tp1-Fl)*Rl;if(Gl>f.epsilon){var Yl=Gl;Il+=Dl*Yl,Vl+=jl*Yl}var Ul=(-kl.tp0-Bl)*Rl;if(-f.epsilon>Ul){var Zl=Ul;Ll+=Dl*Zl,Nl+=jl*Zl}var ql=Il*kl.gnormx+Vl*kl.gnormy-kl.gprojection,Wl=Ll*kl.gnormx+Nl*kl.gnormy-kl.gprojection;if(Wl>ql){ki.x=Il,ki.y=Vl;var Xl=-ql;Mi.x=ki.x+kl.gnormx*Xl,Mi.y=ki.y+kl.gnormy*Xl,gi=ql}else{ki.x=Ll,ki.y=Nl;var Hl=-Wl;Mi.x=ki.x+kl.gnormx*Hl,Mi.y=ki.y+kl.gnormy*Hl,gi=Wl}}else{var Kl=kl.gp0,Jl=kl.gp1,Ql=Sl.gp0,$l=Sl.gp1,nr=0,er=0,tr=0,ir=0;nr=Jl.x-Kl.x,er=Jl.y-Kl.y,tr=$l.x-Ql.x,ir=$l.y-Ql.y;var lr=1/(nr*nr+er*er),rr=1/(tr*tr+ir*ir),ar=-(nr*(Kl.x-Ql.x)+er*(Kl.y-Ql.y))*lr,pr=-(nr*(Kl.x-$l.x)+er*(Kl.y-$l.y))*lr,sr=-(tr*(Ql.x-Kl.x)+ir*(Ql.y-Kl.y))*rr,or=-(tr*(Ql.x-Jl.x)+ir*(Ql.y-Jl.y))*rr;0>ar?ar=0:ar>1&&(ar=1),0>pr?pr=0:pr>1&&(pr=1),0>sr?sr=0:sr>1&&(sr=1),0>or?or=0:or>1&&(or=1);var hr=0,_r=0,ur=ar;hr=Kl.x+nr*ur,_r=Kl.y+er*ur;var dr=0,cr=0,xr=pr;dr=Kl.x+nr*xr,cr=Kl.y+er*xr;var vr=0,zr=0,yr=sr;vr=Ql.x+tr*yr,zr=Ql.y+ir*yr;var fr=0,mr=0,br=or;fr=Ql.x+tr*br,mr=Ql.y+ir*br;var gr=0,wr=0;gr=hr-Ql.x,wr=_r-Ql.y;var Cr=gr*gr+wr*wr,Mr=0,kr=0;Mr=dr-$l.x,kr=cr-$l.y;var Or=Mr*Mr+kr*kr,Sr=0,Pr=0;Sr=vr-Kl.x,Pr=zr-Kl.y;var Tr=Sr*Sr+Pr*Pr,Ar=0,Er=0;Ar=fr-Jl.x,Er=mr-Jl.y;var Ir=Ar*Ar+Er*Er,Vr=0,Lr=0,Nr=null;Or>Cr?(Vr=hr,Lr=_r,Nr=Ql):(Vr=dr,Lr=cr,Nr=$l,Cr=Or);var Dr=0,jr=0,Fr=null;if(Ir>Tr?(Dr=vr,jr=zr,Fr=Kl):(Dr=fr,jr=mr,Fr=Jl,Tr=Ir),Tr>Cr?(Mi.x=Vr,Mi.y=Lr,ki.x=Nr.x,ki.y=Nr.y,ol=Math.sqrt(Cr)):(ki.x=Dr,ki.y=jr,Mi.x=Fr.x,Mi.y=Fr.y,ol=Math.sqrt(Tr)),0!=ol){v.x=ki.x-Mi.x,v.y=ki.y-Mi.y;var Br=1/ol;v.x*=Br,v.y*=Br,Ni&&(v.x=-v.x,v.y=-v.y)}gi=ol}}else gi=1e100}else gi=1e100}}var Rr=gi+i,Gr=o*v.x+h*v.y;if(f.distanceThresholdCCD>Rr){if(l)break;var Yr=0,Ur=0;Yr=c.x-p.posx,Ur=c.y-p.posy;var Zr=0,qr=0;Zr=x.x-s.posx,qr=x.y-s.posy;var Wr=Gr-p.sweep_angvel*(v.y*Yr-v.x*Ur)+s.sweep_angvel*(v.y*Zr-v.x*qr);if(Wr>0&&(n.slipped=!0),0>=Wr||.5*f.distanceThresholdCCD>Rr)break}z=-1;break}if(++y>=40){Ot>i&&(n.failed=!0);break}}n.toi=z},bt.staticSweep=function(n,e,t,i){var l=n.s1,r=n.s2,a=l.body,p=0,s=0;p=-a.velx,s=-a.vely;var o=a.sweep_angvel;0>o&&(o=-o);for(var h=l.sweepCoef*o,_=n.c1,u=n.c2,d=n.axis,c=t,x=0;;){var v=c*e,z=v-a.sweepTime;if(0!=z){a.sweepTime=v;var y=z;if(a.posx+=a.velx*y,a.posy+=a.vely*y,0!=a.angvel){var m=a.sweep_angvel*z;if(a.rot+=m,m*m>1e-4)a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot);else{var b=m*m,g=1-.5*b,w=1-b*b/8,C=(g*a.axisx+m*a.axisy)*w;a.axisy=(g*a.axisy-m*a.axisx)*w,a.axisx=C}}}if(l.type==ye.id_ShapeType_CIRCLE)l.worldCOMx=a.posx+(a.axisy*l.localCOMx-a.axisx*l.localCOMy),l.worldCOMy=a.posy+(l.localCOMx*a.axisx+l.localCOMy*a.axisy);else{for(var M=l.polygon,k=M.lverts.next,O=M.gverts.next;null!=O;){var S=O,P=k;k=k.next,S.x=a.posx+(a.axisy*P.x-a.axisx*P.y),S.y=a.posy+(P.x*a.axisx+P.y*a.axisy),O=O.next}var T=M.edges.head,A=M.gverts.next,E=A;for(A=A.next;null!=A;){var I=A,V=T.elt;T=T.next,V.gnormx=a.axisy*V.lnormx-a.axisx*V.lnormy,V.gnormy=V.lnormx*a.axisx+V.lnormy*a.axisy,V.gprojection=a.posx*V.gnormx+a.posy*V.gnormy+V.lprojection,V.tp0=E.y*V.gnormx-E.x*V.gnormy,V.tp1=I.y*V.gnormx-I.x*V.gnormy,E=I,A=A.next}var L=M.gverts.next,N=T.elt;T=T.next,N.gnormx=a.axisy*N.lnormx-a.axisx*N.lnormy,N.gnormy=N.lnormx*a.axisx+N.lnormy*a.axisy,N.gprojection=a.posx*N.gnormx+a.posy*N.gnormy+N.lprojection,N.tp0=E.y*N.gnormx-E.x*N.gnormy,N.tp1=L.y*N.gnormx-L.x*N.gnormy}var D,j=l,F=r,B=_,R=u;if(j.type==ye.id_ShapeType_CIRCLE&&F.type==ye.id_ShapeType_CIRCLE){var G,Y=j.circle,U=F.circle,Z=0,q=0;Z=U.worldCOMx-Y.worldCOMx,q=U.worldCOMy-Y.worldCOMy;var W=Math.sqrt(Z*Z+q*q);if(1e100>(G=W-(Y.radius+U.radius))){if(0==W)Z=1,q=0;else{var X=1/W;Z*=X,q*=X}var H=Y.radius;B.x=Y.worldCOMx+Z*H,B.y=Y.worldCOMy+q*H;var K=-U.radius;R.x=U.worldCOMx+Z*K,R.y=U.worldCOMy+q*K,d.x=Z,d.y=q}D=G}else{var J=!1;if(j.type==ye.id_ShapeType_CIRCLE&&F.type==ye.id_ShapeType_POLYGON){var Q=j;j=F,F=Q;var $=B;B=R,R=$,J=!0}if(j.type==ye.id_ShapeType_POLYGON&&F.type==ye.id_ShapeType_CIRCLE){for(var nn=j.polygon,en=F.circle,tn=-1e100,ln=null,rn=nn.edges.head;null!=rn;){var an=rn.elt,pn=an.gnormx*en.worldCOMx+an.gnormy*en.worldCOMy-an.gprojection-en.radius;if(pn>1e100){tn=pn;break}pn>0?pn>tn&&(tn=pn,ln=an):0>tn&&pn>tn&&(tn=pn,ln=an),rn=rn.next}if(1e100>tn){var sn=ln.gp0,on=ln.gp1,hn=en.worldCOMy*ln.gnormx-en.worldCOMx*ln.gnormy;if(sn.y*ln.gnormx-sn.x*ln.gnormy<hn)if(hn<on.y*ln.gnormx-on.x*ln.gnormy){var _n=-en.radius;R.x=en.worldCOMx+ln.gnormx*_n,R.y=en.worldCOMy+ln.gnormy*_n;var un=-tn;B.x=R.x+ln.gnormx*un,B.y=R.y+ln.gnormy*un,d.x=ln.gnormx,d.y=ln.gnormy}else{var dn=0,cn=0;dn=en.worldCOMx-on.x,cn=en.worldCOMy-on.y;var xn=Math.sqrt(dn*dn+cn*cn);if(1e100>(tn=xn-en.radius)){if(0==xn)dn=1,cn=0;else{var vn=1/xn;dn*=vn,cn*=vn}B.x=on.x+0*dn,B.y=on.y+0*cn;var zn=-en.radius;R.x=en.worldCOMx+dn*zn,R.y=en.worldCOMy+cn*zn,d.x=dn,d.y=cn}}else{var yn=0,fn=0;yn=en.worldCOMx-sn.x,fn=en.worldCOMy-sn.y;var mn=Math.sqrt(yn*yn+fn*fn);if(1e100>(tn=mn-en.radius)){if(0==mn)yn=1,fn=0;else{var bn=1/mn;yn*=bn,fn*=bn}B.x=sn.x+0*yn,B.y=sn.y+0*fn;var gn=-en.radius;R.x=en.worldCOMx+yn*gn,R.y=en.worldCOMy+fn*gn,d.x=yn,d.y=fn}}}J&&(d.x=-d.x,d.y=-d.y),D=tn}else{for(var wn=j.polygon,Cn=F.polygon,Mn=-1e100,kn=null,On=null,Sn=0,Pn=wn.edges.head;null!=Pn;){for(var Tn=Pn.elt,An=1e100,En=Cn.gverts.next;null!=En;){var In=En,Vn=Tn.gnormx*In.x+Tn.gnormy*In.y;An>Vn&&(An=Vn),En=En.next}if((An-=Tn.gprojection)>1e100){Mn=An;break}An>0?An>Mn&&(Mn=An,kn=Tn,Sn=1):0>Mn&&An>Mn&&(Mn=An,kn=Tn,Sn=1),Pn=Pn.next}if(1e100>Mn){for(var Ln=Cn.edges.head;null!=Ln;){for(var Nn=Ln.elt,Dn=1e100,jn=wn.gverts.next;null!=jn;){var Fn=jn,Bn=Nn.gnormx*Fn.x+Nn.gnormy*Fn.y;Dn>Bn&&(Dn=Bn),jn=jn.next}if((Dn-=Nn.gprojection)>1e100){Mn=Dn;break}Dn>0?Dn>Mn&&(Mn=Dn,On=Nn,Sn=2):0>Mn&&Dn>Mn&&(Mn=Dn,On=Nn,Sn=2),Ln=Ln.next}if(1e100>Mn){var Rn,Gn;if(1==Sn)wn,Rn=Cn,Gn=kn;else{Cn,Rn=wn,Gn=On;var Yn=B;B=R,R=Yn,J=!J}for(var Un=null,Zn=1e100,qn=Rn.edges.head;null!=qn;){var Wn=qn.elt,Xn=Gn.gnormx*Wn.gnormx+Gn.gnormy*Wn.gnormy;Zn>Xn&&(Zn=Xn,Un=Wn),qn=qn.next}if(J?(d.x=-Gn.gnormx,d.y=-Gn.gnormy):(d.x=Gn.gnormx,d.y=Gn.gnormy),0>Mn){var Hn=0,Kn=0;Hn=Un.gp0.x,Kn=Un.gp0.y;var Jn=0,Qn=0;Jn=Un.gp1.x,Qn=Un.gp1.y;var $n=0,ne=0;$n=Jn-Hn,ne=Qn-Kn;var ee=Gn.gnormy*Hn-Gn.gnormx*Kn,te=Gn.gnormy*Jn-Gn.gnormx*Qn,ie=1/(te-ee),le=(-Gn.tp1-ee)*ie;if(le>f.epsilon){var re=le;Hn+=$n*re,Kn+=ne*re}var ae=(-Gn.tp0-te)*ie;if(-f.epsilon>ae){var pe=ae;Jn+=$n*pe,Qn+=ne*pe}var se=Hn*Gn.gnormx+Kn*Gn.gnormy-Gn.gprojection,oe=Jn*Gn.gnormx+Qn*Gn.gnormy-Gn.gprojection;if(oe>se){R.x=Hn,R.y=Kn;var he=-se;B.x=R.x+Gn.gnormx*he,B.y=R.y+Gn.gnormy*he,D=se}else{R.x=Jn,R.y=Qn;var _e=-oe;B.x=R.x+Gn.gnormx*_e,B.y=R.y+Gn.gnormy*_e,D=oe}}else{var ue=Gn.gp0,de=Gn.gp1,ce=Un.gp0,xe=Un.gp1,ve=0,ze=0,fe=0,me=0;ve=de.x-ue.x,ze=de.y-ue.y,fe=xe.x-ce.x,me=xe.y-ce.y;var be=1/(ve*ve+ze*ze),ge=1/(fe*fe+me*me),we=-(ve*(ue.x-ce.x)+ze*(ue.y-ce.y))*be,Ce=-(ve*(ue.x-xe.x)+ze*(ue.y-xe.y))*be,Me=-(fe*(ce.x-ue.x)+me*(ce.y-ue.y))*ge,ke=-(fe*(ce.x-de.x)+me*(ce.y-de.y))*ge;0>we?we=0:we>1&&(we=1),0>Ce?Ce=0:Ce>1&&(Ce=1),0>Me?Me=0:Me>1&&(Me=1),0>ke?ke=0:ke>1&&(ke=1);var Oe=0,Se=0,Pe=we;Oe=ue.x+ve*Pe,Se=ue.y+ze*Pe;var Te=0,Ae=0,Ee=Ce;Te=ue.x+ve*Ee,Ae=ue.y+ze*Ee;var Ie=0,Ve=0,Le=Me;Ie=ce.x+fe*Le,Ve=ce.y+me*Le;var Ne=0,De=0,je=ke;Ne=ce.x+fe*je,De=ce.y+me*je;var Fe=0,Be=0;Fe=Oe-ce.x,Be=Se-ce.y;var Re=Fe*Fe+Be*Be,Ge=0,Ye=0;Ge=Te-xe.x,Ye=Ae-xe.y;var Ue=Ge*Ge+Ye*Ye,Ze=0,qe=0;Ze=Ie-ue.x,qe=Ve-ue.y;var We=Ze*Ze+qe*qe,Xe=0,He=0;Xe=Ne-de.x,He=De-de.y;var Ke=Xe*Xe+He*He,Je=0,Qe=0,$e=null;Ue>Re?(Je=Oe,Qe=Se,$e=ce):(Je=Te,Qe=Ae,$e=xe,Re=Ue);var nt=0,et=0,tt=null;if(Ke>We?(nt=Ie,et=Ve,tt=ue):(nt=Ne,et=De,tt=de,We=Ke),We>Re?(B.x=Je,B.y=Qe,R.x=$e.x,R.y=$e.y,Mn=Math.sqrt(Re)):(R.x=nt,R.y=et,B.x=tt.x,B.y=tt.y,Mn=Math.sqrt(We)),0!=Mn){d.x=R.x-B.x,d.y=R.y-B.y;var it=1/Mn;d.x*=it,d.y*=it,J&&(d.x=-d.x,d.y=-d.y)}D=Mn}}else D=1e100}else D=1e100}}var lt=D+i,rt=p*d.x+s*d.y;if(f.distanceThresholdCCD>lt){var at=0,pt=0;at=_.x-a.posx,pt=_.y-a.posy;var st=rt-a.sweep_angvel*(d.y*at-d.x*pt);if(st>0&&(n.slipped=!0),0>=st||.5*f.distanceThresholdCCD>lt)break}var ot=(h-rt)*e;if(0>=ot){c=-1;break}var ht=lt/ot;if(1e-6>ht&&(ht=1e-6),(c+=ht)>=1){c=1;var _t=c*e,ut=_t-a.sweepTime;if(0!=ut){a.sweepTime=_t;var dt=ut;if(a.posx+=a.velx*dt,a.posy+=a.vely*dt,0!=a.angvel){var ct=a.sweep_angvel*ut;if(a.rot+=ct,ct*ct>1e-4)a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot);else{var xt=ct*ct,vt=1-.5*xt,zt=1-xt*xt/8,yt=(vt*a.axisx+ct*a.axisy)*zt;a.axisy=(vt*a.axisy-ct*a.axisx)*zt,a.axisx=yt}}}if(l.type==ye.id_ShapeType_CIRCLE)l.worldCOMx=a.posx+(a.axisy*l.localCOMx-a.axisx*l.localCOMy),l.worldCOMy=a.posy+(l.localCOMx*a.axisx+l.localCOMy*a.axisy);else{for(var ft=l.polygon,mt=ft.lverts.next,bt=ft.gverts.next;null!=bt;){var gt=bt,wt=mt;mt=mt.next,gt.x=a.posx+(a.axisy*wt.x-a.axisx*wt.y),gt.y=a.posy+(wt.x*a.axisx+wt.y*a.axisy),bt=bt.next}var Ct=ft.edges.head,Mt=ft.gverts.next,kt=Mt;for(Mt=Mt.next;null!=Mt;){var Ot=Mt,St=Ct.elt;Ct=Ct.next,St.gnormx=a.axisy*St.lnormx-a.axisx*St.lnormy,St.gnormy=St.lnormx*a.axisx+St.lnormy*a.axisy,St.gprojection=a.posx*St.gnormx+a.posy*St.gnormy+St.lprojection,St.tp0=kt.y*St.gnormx-kt.x*St.gnormy,St.tp1=Ot.y*St.gnormx-Ot.x*St.gnormy,kt=Ot,Mt=Mt.next}var Pt=ft.gverts.next,Tt=Ct.elt;Ct=Ct.next,Tt.gnormx=a.axisy*Tt.lnormx-a.axisx*Tt.lnormy,Tt.gnormy=Tt.lnormx*a.axisx+Tt.lnormy*a.axisy,Tt.gprojection=a.posx*Tt.gnormx+a.posy*Tt.gnormy+Tt.lprojection,Tt.tp0=kt.y*Tt.gnormx-kt.x*Tt.gnormy,Tt.tp1=Pt.y*Tt.gnormx-Pt.x*Tt.gnormy}var At,Et=l,It=r,Vt=_,Lt=u;if(Et.type==ye.id_ShapeType_CIRCLE&&It.type==ye.id_ShapeType_CIRCLE){var Nt,Dt=Et.circle,jt=It.circle,Ft=0,Bt=0;Ft=jt.worldCOMx-Dt.worldCOMx,Bt=jt.worldCOMy-Dt.worldCOMy;var Rt=Math.sqrt(Ft*Ft+Bt*Bt);if(1e100>(Nt=Rt-(Dt.radius+jt.radius))){if(0==Rt)Ft=1,Bt=0;else{var Gt=1/Rt;Ft*=Gt,Bt*=Gt}var Yt=Dt.radius;Vt.x=Dt.worldCOMx+Ft*Yt,Vt.y=Dt.worldCOMy+Bt*Yt;var Ut=-jt.radius;Lt.x=jt.worldCOMx+Ft*Ut,Lt.y=jt.worldCOMy+Bt*Ut,d.x=Ft,d.y=Bt}At=Nt}else{var Zt=!1;if(Et.type==ye.id_ShapeType_CIRCLE&&It.type==ye.id_ShapeType_POLYGON){var qt=Et;Et=It,It=qt;var Wt=Vt;Vt=Lt,Lt=Wt,Zt=!0}if(Et.type==ye.id_ShapeType_POLYGON&&It.type==ye.id_ShapeType_CIRCLE){for(var Xt=Et.polygon,Ht=It.circle,Kt=-1e100,Jt=null,Qt=Xt.edges.head;null!=Qt;){var $t=Qt.elt,ni=$t.gnormx*Ht.worldCOMx+$t.gnormy*Ht.worldCOMy-$t.gprojection-Ht.radius;if(ni>1e100){Kt=ni;break}ni>0?ni>Kt&&(Kt=ni,Jt=$t):0>Kt&&ni>Kt&&(Kt=ni,Jt=$t),Qt=Qt.next}if(1e100>Kt){var ei=Jt.gp0,ti=Jt.gp1,ii=Ht.worldCOMy*Jt.gnormx-Ht.worldCOMx*Jt.gnormy;if(ei.y*Jt.gnormx-ei.x*Jt.gnormy<ii)if(ii<ti.y*Jt.gnormx-ti.x*Jt.gnormy){var li=-Ht.radius;Lt.x=Ht.worldCOMx+Jt.gnormx*li,Lt.y=Ht.worldCOMy+Jt.gnormy*li;var ri=-Kt;Vt.x=Lt.x+Jt.gnormx*ri,Vt.y=Lt.y+Jt.gnormy*ri,d.x=Jt.gnormx,d.y=Jt.gnormy}else{var ai=0,pi=0;ai=Ht.worldCOMx-ti.x,pi=Ht.worldCOMy-ti.y;var si=Math.sqrt(ai*ai+pi*pi);if(1e100>(Kt=si-Ht.radius)){if(0==si)ai=1,pi=0;else{var oi=1/si;ai*=oi,pi*=oi}Vt.x=ti.x+0*ai,Vt.y=ti.y+0*pi;var hi=-Ht.radius;Lt.x=Ht.worldCOMx+ai*hi,Lt.y=Ht.worldCOMy+pi*hi,d.x=ai,d.y=pi}}else{var _i=0,ui=0;_i=Ht.worldCOMx-ei.x,ui=Ht.worldCOMy-ei.y;var di=Math.sqrt(_i*_i+ui*ui);if(1e100>(Kt=di-Ht.radius)){if(0==di)_i=1,ui=0;else{var ci=1/di;_i*=ci,ui*=ci}Vt.x=ei.x+0*_i,Vt.y=ei.y+0*ui;var xi=-Ht.radius;Lt.x=Ht.worldCOMx+_i*xi,Lt.y=Ht.worldCOMy+ui*xi,d.x=_i,d.y=ui}}}Zt&&(d.x=-d.x,d.y=-d.y),At=Kt}else{for(var vi=Et.polygon,zi=It.polygon,yi=-1e100,fi=null,mi=null,bi=0,gi=vi.edges.head;null!=gi;){for(var wi=gi.elt,Ci=1e100,Mi=zi.gverts.next;null!=Mi;){var ki=Mi,Oi=wi.gnormx*ki.x+wi.gnormy*ki.y;Ci>Oi&&(Ci=Oi),Mi=Mi.next}if((Ci-=wi.gprojection)>1e100){yi=Ci;break}Ci>0?Ci>yi&&(yi=Ci,fi=wi,bi=1):0>yi&&Ci>yi&&(yi=Ci,fi=wi,bi=1),gi=gi.next}if(1e100>yi){for(var Si=zi.edges.head;null!=Si;){for(var Pi=Si.elt,Ti=1e100,Ai=vi.gverts.next;null!=Ai;){var Ei=Ai,Ii=Pi.gnormx*Ei.x+Pi.gnormy*Ei.y;Ti>Ii&&(Ti=Ii),Ai=Ai.next}if((Ti-=Pi.gprojection)>1e100){yi=Ti;break}Ti>0?Ti>yi&&(yi=Ti,mi=Pi,bi=2):0>yi&&Ti>yi&&(yi=Ti,mi=Pi,bi=2),Si=Si.next}if(1e100>yi){var Vi,Li;if(1==bi)vi,Vi=zi,Li=fi;else{zi,Vi=vi,Li=mi;var Ni=Vt;Vt=Lt,Lt=Ni,Zt=!Zt}for(var Di=null,ji=1e100,Fi=Vi.edges.head;null!=Fi;){var Bi=Fi.elt,Ri=Li.gnormx*Bi.gnormx+Li.gnormy*Bi.gnormy;ji>Ri&&(ji=Ri,Di=Bi),Fi=Fi.next}if(Zt?(d.x=-Li.gnormx,d.y=-Li.gnormy):(d.x=Li.gnormx,d.y=Li.gnormy),0>yi){var Gi=0,Yi=0;Gi=Di.gp0.x,Yi=Di.gp0.y;var Ui=0,Zi=0;Ui=Di.gp1.x,Zi=Di.gp1.y;var qi=0,Wi=0;qi=Ui-Gi,Wi=Zi-Yi;var Xi=Li.gnormy*Gi-Li.gnormx*Yi,Hi=Li.gnormy*Ui-Li.gnormx*Zi,Ki=1/(Hi-Xi),Ji=(-Li.tp1-Xi)*Ki;if(Ji>f.epsilon){var Qi=Ji;Gi+=qi*Qi,Yi+=Wi*Qi}var $i=(-Li.tp0-Hi)*Ki;if(-f.epsilon>$i){var nl=$i;Ui+=qi*nl,Zi+=Wi*nl}var el=Gi*Li.gnormx+Yi*Li.gnormy-Li.gprojection,tl=Ui*Li.gnormx+Zi*Li.gnormy-Li.gprojection;if(tl>el){Lt.x=Gi,Lt.y=Yi;var il=-el;Vt.x=Lt.x+Li.gnormx*il,Vt.y=Lt.y+Li.gnormy*il,At=el}else{Lt.x=Ui,Lt.y=Zi;var ll=-tl;Vt.x=Lt.x+Li.gnormx*ll,Vt.y=Lt.y+Li.gnormy*ll,At=tl}}else{var rl=Li.gp0,al=Li.gp1,pl=Di.gp0,sl=Di.gp1,ol=0,hl=0,_l=0,ul=0;ol=al.x-rl.x,hl=al.y-rl.y,_l=sl.x-pl.x,ul=sl.y-pl.y;var dl=1/(ol*ol+hl*hl),cl=1/(_l*_l+ul*ul),xl=-(ol*(rl.x-pl.x)+hl*(rl.y-pl.y))*dl,vl=-(ol*(rl.x-sl.x)+hl*(rl.y-sl.y))*dl,zl=-(_l*(pl.x-rl.x)+ul*(pl.y-rl.y))*cl,yl=-(_l*(pl.x-al.x)+ul*(pl.y-al.y))*cl;0>xl?xl=0:xl>1&&(xl=1),0>vl?vl=0:vl>1&&(vl=1),0>zl?zl=0:zl>1&&(zl=1),0>yl?yl=0:yl>1&&(yl=1);var fl=0,ml=0,bl=xl;fl=rl.x+ol*bl,ml=rl.y+hl*bl;var gl=0,wl=0,Cl=vl;gl=rl.x+ol*Cl,wl=rl.y+hl*Cl;var Ml=0,kl=0,Ol=zl;Ml=pl.x+_l*Ol,kl=pl.y+ul*Ol;var Sl=0,Pl=0,Tl=yl;Sl=pl.x+_l*Tl,Pl=pl.y+ul*Tl;var Al=0,El=0;Al=fl-pl.x,El=ml-pl.y;var Il=Al*Al+El*El,Vl=0,Ll=0;Vl=gl-sl.x,Ll=wl-sl.y;var Nl=Vl*Vl+Ll*Ll,Dl=0,jl=0;Dl=Ml-rl.x,jl=kl-rl.y;var Fl=Dl*Dl+jl*jl,Bl=0,Rl=0;Bl=Sl-al.x,Rl=Pl-al.y;var Gl=Bl*Bl+Rl*Rl,Yl=0,Ul=0,Zl=null;Nl>Il?(Yl=fl,Ul=ml,Zl=pl):(Yl=gl,Ul=wl,Zl=sl,Il=Nl);var ql=0,Wl=0,Xl=null;if(Gl>Fl?(ql=Ml,Wl=kl,Xl=rl):(ql=Sl,Wl=Pl,Xl=al,Fl=Gl),Fl>Il?(Vt.x=Yl,Vt.y=Ul,Lt.x=Zl.x,Lt.y=Zl.y,yi=Math.sqrt(Il)):(Lt.x=ql,Lt.y=Wl,Vt.x=Xl.x,Vt.y=Xl.y,yi=Math.sqrt(Fl)),0!=yi){d.x=Lt.x-Vt.x,d.y=Lt.y-Vt.y;var Hl=1/yi;d.x*=Hl,d.y*=Hl,Zt&&(d.x=-d.x,d.y=-d.y)}At=yi}}else At=1e100}else At=1e100}}var Kl=At+i,Jl=p*d.x+s*d.y;if(f.distanceThresholdCCD>Kl){var Ql=0,$l=0;Ql=_.x-a.posx,$l=_.y-a.posy;var nr=Jl-a.sweep_angvel*(d.y*Ql-d.x*$l);if(nr>0&&(n.slipped=!0),0>=nr||.5*f.distanceThresholdCCD>Kl)break}c=-1;break}if(++x>=40){lt>i&&(n.failed=!0);break}}n.toi=c},bt.distanceBody=function(n,e,t,i){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1;var r;null==Ct.zpp_pool?r=new Ct:(r=Ct.zpp_pool,Ct.zpp_pool=r.next,r.next=null),r.weak=!1;var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1;for(var p=1e100,s=n.shapes.head;null!=s;){for(var o=s.elt,h=e.shapes.head;null!=h;){var _,u=h.elt,d=o,c=u,x=l,v=r;if(d.type==ye.id_ShapeType_CIRCLE&&c.type==ye.id_ShapeType_CIRCLE){var z,y=d.circle,m=c.circle,b=0,g=0;b=m.worldCOMx-y.worldCOMx,g=m.worldCOMy-y.worldCOMy;var w=Math.sqrt(b*b+g*g);if(z=w-(y.radius+m.radius),p>z){if(0==w)b=1,g=0;else{var C=1/w;b*=C,g*=C}var M=y.radius;x.x=y.worldCOMx+b*M,x.y=y.worldCOMy+g*M;var k=-m.radius;v.x=m.worldCOMx+b*k,v.y=m.worldCOMy+g*k,a.x=b,a.y=g}_=z}else{var O=!1;if(d.type==ye.id_ShapeType_CIRCLE&&c.type==ye.id_ShapeType_POLYGON){var S=d;d=c,c=S;var P=x;x=v,v=P,O=!0}if(d.type==ye.id_ShapeType_POLYGON&&c.type==ye.id_ShapeType_CIRCLE){for(var T=d.polygon,A=c.circle,E=-1e100,I=null,V=T.edges.head;null!=V;){var L=V.elt,N=L.gnormx*A.worldCOMx+L.gnormy*A.worldCOMy-L.gprojection-A.radius;if(N>p){E=N;break}N>0?N>E&&(E=N,I=L):0>E&&N>E&&(E=N,I=L),V=V.next}if(p>E){var D=I.gp0,j=I.gp1,F=A.worldCOMy*I.gnormx-A.worldCOMx*I.gnormy;if(D.y*I.gnormx-D.x*I.gnormy<F)if(F<j.y*I.gnormx-j.x*I.gnormy){var B=-A.radius;v.x=A.worldCOMx+I.gnormx*B,v.y=A.worldCOMy+I.gnormy*B;var R=-E;x.x=v.x+I.gnormx*R,x.y=v.y+I.gnormy*R,a.x=I.gnormx,a.y=I.gnormy}else{var G=0,Y=0;G=A.worldCOMx-j.x,Y=A.worldCOMy-j.y;var U=Math.sqrt(G*G+Y*Y);if(E=U-A.radius,p>E){if(0==U)G=1,Y=0;else{var Z=1/U;G*=Z,Y*=Z}x.x=j.x+0*G,x.y=j.y+0*Y;var q=-A.radius;v.x=A.worldCOMx+G*q,v.y=A.worldCOMy+Y*q,a.x=G,a.y=Y}}else{var W=0,X=0;W=A.worldCOMx-D.x,X=A.worldCOMy-D.y;var H=Math.sqrt(W*W+X*X);if(E=H-A.radius,p>E){if(0==H)W=1,X=0;else{var K=1/H;W*=K,X*=K}x.x=D.x+0*W,x.y=D.y+0*X;var J=-A.radius;v.x=A.worldCOMx+W*J,v.y=A.worldCOMy+X*J,a.x=W,a.y=X}}}O&&(a.x=-a.x,a.y=-a.y),_=E}else{for(var Q=d.polygon,$=c.polygon,nn=-1e100,en=null,tn=null,ln=0,rn=Q.edges.head;null!=rn;){for(var an=rn.elt,pn=1e100,sn=$.gverts.next;null!=sn;){var on=sn,hn=an.gnormx*on.x+an.gnormy*on.y;pn>hn&&(pn=hn),sn=sn.next}if((pn-=an.gprojection)>p){nn=pn;break}pn>0?pn>nn&&(nn=pn,en=an,ln=1):0>nn&&pn>nn&&(nn=pn,en=an,ln=1),rn=rn.next}if(p>nn){for(var _n=$.edges.head;null!=_n;){for(var un=_n.elt,dn=1e100,cn=Q.gverts.next;null!=cn;){var xn=cn,vn=un.gnormx*xn.x+un.gnormy*xn.y;dn>vn&&(dn=vn),cn=cn.next}if((dn-=un.gprojection)>p){nn=dn;break}dn>0?dn>nn&&(nn=dn,tn=un,ln=2):0>nn&&dn>nn&&(nn=dn,tn=un,ln=2),_n=_n.next}if(p>nn){var zn,yn;if(1==ln)Q,zn=$,yn=en;else{$,zn=Q,yn=tn;var fn=x;x=v,v=fn,O=!O}for(var mn=null,bn=1e100,gn=zn.edges.head;null!=gn;){var wn=gn.elt,Cn=yn.gnormx*wn.gnormx+yn.gnormy*wn.gnormy;bn>Cn&&(bn=Cn,mn=wn),gn=gn.next}if(O?(a.x=-yn.gnormx,a.y=-yn.gnormy):(a.x=yn.gnormx,a.y=yn.gnormy),0>nn){var Mn=0,kn=0;Mn=mn.gp0.x,kn=mn.gp0.y;var On=0,Sn=0;On=mn.gp1.x,Sn=mn.gp1.y;var Pn=0,Tn=0;Pn=On-Mn,Tn=Sn-kn;var An=yn.gnormy*Mn-yn.gnormx*kn,En=yn.gnormy*On-yn.gnormx*Sn,In=1/(En-An),Vn=(-yn.tp1-An)*In;if(Vn>f.epsilon){var Ln=Vn;Mn+=Pn*Ln,kn+=Tn*Ln}var Nn=(-yn.tp0-En)*In;if(-f.epsilon>Nn){var Dn=Nn;On+=Pn*Dn,Sn+=Tn*Dn}var jn=Mn*yn.gnormx+kn*yn.gnormy-yn.gprojection,Fn=On*yn.gnormx+Sn*yn.gnormy-yn.gprojection;if(Fn>jn){v.x=Mn,v.y=kn;var Bn=-jn;x.x=v.x+yn.gnormx*Bn,x.y=v.y+yn.gnormy*Bn,_=jn}else{v.x=On,v.y=Sn;var Rn=-Fn;x.x=v.x+yn.gnormx*Rn,x.y=v.y+yn.gnormy*Rn,_=Fn}}else{var Gn=yn.gp0,Yn=yn.gp1,Un=mn.gp0,Zn=mn.gp1,qn=0,Wn=0,Xn=0,Hn=0;qn=Yn.x-Gn.x,Wn=Yn.y-Gn.y,Xn=Zn.x-Un.x,Hn=Zn.y-Un.y;var Kn=1/(qn*qn+Wn*Wn),Jn=1/(Xn*Xn+Hn*Hn),Qn=-(qn*(Gn.x-Un.x)+Wn*(Gn.y-Un.y))*Kn,$n=-(qn*(Gn.x-Zn.x)+Wn*(Gn.y-Zn.y))*Kn,ne=-(Xn*(Un.x-Gn.x)+Hn*(Un.y-Gn.y))*Jn,ee=-(Xn*(Un.x-Yn.x)+Hn*(Un.y-Yn.y))*Jn;0>Qn?Qn=0:Qn>1&&(Qn=1),0>$n?$n=0:$n>1&&($n=1),0>ne?ne=0:ne>1&&(ne=1),0>ee?ee=0:ee>1&&(ee=1);var te=0,ie=0,le=Qn;te=Gn.x+qn*le,ie=Gn.y+Wn*le;var re=0,ae=0,pe=$n;re=Gn.x+qn*pe,ae=Gn.y+Wn*pe;var se=0,oe=0,he=ne;se=Un.x+Xn*he,oe=Un.y+Hn*he;var _e=0,ue=0,de=ee;_e=Un.x+Xn*de,ue=Un.y+Hn*de;var ce=0,xe=0;ce=te-Un.x,xe=ie-Un.y;var ve=ce*ce+xe*xe,ze=0,fe=0;ze=re-Zn.x,fe=ae-Zn.y;var me=ze*ze+fe*fe,be=0,ge=0;be=se-Gn.x,ge=oe-Gn.y;var we=be*be+ge*ge,Ce=0,Me=0;Ce=_e-Yn.x,Me=ue-Yn.y;var ke=Ce*Ce+Me*Me,Oe=0,Se=0,Pe=null;me>ve?(Oe=te,Se=ie,Pe=Un):(Oe=re,Se=ae,Pe=Zn,ve=me);var Te=0,Ae=0,Ee=null;if(ke>we?(Te=se,Ae=oe,Ee=Gn):(Te=_e,Ae=ue,Ee=Yn,we=ke),we>ve?(x.x=Oe,x.y=Se,v.x=Pe.x,v.y=Pe.y,nn=Math.sqrt(ve)):(v.x=Te,v.y=Ae,x.x=Ee.x,x.y=Ee.y,nn=Math.sqrt(we)),0!=nn){a.x=v.x-x.x,a.y=v.y-x.y;var Ie=1/nn;a.x*=Ie,a.y*=Ie,O&&(a.x=-a.x,a.y=-a.y)}_=nn}}else _=p}else _=p}}p>_&&(p=_,t.x=l.x,t.y=l.y,i.x=r.x,i.y=r.y),h=h.next}s=s.next}var Ve=l;null!=Ve.outer&&(Ve.outer.zpp_inner=null,Ve.outer=null),Ve._isimmutable=null,Ve._validate=null,Ve._invalidate=null,Ve.next=Ct.zpp_pool,Ct.zpp_pool=Ve;var Le=r;null!=Le.outer&&(Le.outer.zpp_inner=null,Le.outer=null),Le._isimmutable=null,Le._validate=null,Le._invalidate=null,Le.next=Ct.zpp_pool,Ct.zpp_pool=Le;var Ne=a;return null!=Ne.outer&&(Ne.outer.zpp_inner=null,Ne.outer=null),Ne._isimmutable=null,Ne._validate=null,Ne._invalidate=null,Ne.next=Ct.zpp_pool,Ct.zpp_pool=Ne,p},bt.distance=function(n,e,t,i,l,r){if(null==r&&(r=1e100),n.type==ye.id_ShapeType_CIRCLE&&e.type==ye.id_ShapeType_CIRCLE){var a,p=n.circle,s=e.circle,o=0,h=0;o=s.worldCOMx-p.worldCOMx,h=s.worldCOMy-p.worldCOMy;var _=Math.sqrt(o*o+h*h);if(a=_-(p.radius+s.radius),r>a){if(0==_)o=1,h=0;else{var u=1/_;o*=u,h*=u}var d=p.radius;t.x=p.worldCOMx+o*d,t.y=p.worldCOMy+h*d;var c=-s.radius;i.x=s.worldCOMx+o*c,i.y=s.worldCOMy+h*c,l.x=o,l.y=h}return a}var x=!1;if(n.type==ye.id_ShapeType_CIRCLE&&e.type==ye.id_ShapeType_POLYGON){var v=n;n=e,e=v;var z=t;t=i,i=z,x=!0}if(n.type==ye.id_ShapeType_POLYGON&&e.type==ye.id_ShapeType_CIRCLE){for(var y=n.polygon,m=e.circle,b=-1e100,g=null,w=y.edges.head;null!=w;){var C=w.elt,M=C.gnormx*m.worldCOMx+C.gnormy*m.worldCOMy-C.gprojection-m.radius;if(M>r){b=M;break}M>0?M>b&&(b=M,g=C):0>b&&M>b&&(b=M,g=C),w=w.next}if(r>b){var k=g.gp0,O=g.gp1,S=m.worldCOMy*g.gnormx-m.worldCOMx*g.gnormy;if(k.y*g.gnormx-k.x*g.gnormy<S)if(S<O.y*g.gnormx-O.x*g.gnormy){var P=-m.radius;i.x=m.worldCOMx+g.gnormx*P,i.y=m.worldCOMy+g.gnormy*P;var T=-b;t.x=i.x+g.gnormx*T,t.y=i.y+g.gnormy*T,l.x=g.gnormx,l.y=g.gnormy}else{var A=0,E=0;A=m.worldCOMx-O.x,E=m.worldCOMy-O.y;var I=Math.sqrt(A*A+E*E);if(b=I-m.radius,r>b){if(0==I)A=1,E=0;else{var V=1/I;A*=V,E*=V}t.x=O.x+0*A,t.y=O.y+0*E;var L=-m.radius;i.x=m.worldCOMx+A*L,i.y=m.worldCOMy+E*L,l.x=A,l.y=E}}else{var N=0,D=0;N=m.worldCOMx-k.x,D=m.worldCOMy-k.y;var j=Math.sqrt(N*N+D*D);if(b=j-m.radius,r>b){if(0==j)N=1,D=0;else{var F=1/j;N*=F,D*=F}t.x=k.x+0*N,t.y=k.y+0*D;var B=-m.radius;i.x=m.worldCOMx+N*B,i.y=m.worldCOMy+D*B,l.x=N,l.y=D}}}return x&&(l.x=-l.x,l.y=-l.y),b}for(var R=n.polygon,G=e.polygon,Y=-1e100,U=null,Z=null,q=0,W=R.edges.head;null!=W;){for(var X=W.elt,H=1e100,K=G.gverts.next;null!=K;){var J=K,Q=X.gnormx*J.x+X.gnormy*J.y;H>Q&&(H=Q),K=K.next}if((H-=X.gprojection)>r){Y=H;break}H>0?H>Y&&(Y=H,U=X,q=1):0>Y&&H>Y&&(Y=H,U=X,q=1),W=W.next}if(r>Y){for(var $=G.edges.head;null!=$;){for(var nn=$.elt,en=1e100,tn=R.gverts.next;null!=tn;){var ln=tn,rn=nn.gnormx*ln.x+nn.gnormy*ln.y;en>rn&&(en=rn),tn=tn.next}if((en-=nn.gprojection)>r){Y=en;break}en>0?en>Y&&(Y=en,Z=nn,q=2):0>Y&&en>Y&&(Y=en,Z=nn,q=2),$=$.next}if(r>Y){var an,pn;if(1==q)R,an=G,pn=U;else{G,an=R,pn=Z;var sn=t;t=i,i=sn,x=!x}for(var on=null,hn=1e100,_n=an.edges.head;null!=_n;){var un=_n.elt,dn=pn.gnormx*un.gnormx+pn.gnormy*un.gnormy;hn>dn&&(hn=dn,on=un),_n=_n.next}if(x?(l.x=-pn.gnormx,l.y=-pn.gnormy):(l.x=pn.gnormx,l.y=pn.gnormy),0>Y){var cn=0,xn=0;cn=on.gp0.x,xn=on.gp0.y;var vn=0,zn=0;vn=on.gp1.x,zn=on.gp1.y;var yn=0,fn=0;yn=vn-cn,fn=zn-xn;var mn=pn.gnormy*cn-pn.gnormx*xn,bn=pn.gnormy*vn-pn.gnormx*zn,gn=1/(bn-mn),wn=(-pn.tp1-mn)*gn;if(wn>f.epsilon){var Cn=wn;cn+=yn*Cn,xn+=fn*Cn}var Mn=(-pn.tp0-bn)*gn;if(-f.epsilon>Mn){var kn=Mn;vn+=yn*kn,zn+=fn*kn}var On=cn*pn.gnormx+xn*pn.gnormy-pn.gprojection,Sn=vn*pn.gnormx+zn*pn.gnormy-pn.gprojection;if(Sn>On){i.x=cn,i.y=xn;var Pn=-On;return t.x=i.x+pn.gnormx*Pn,t.y=i.y+pn.gnormy*Pn,On}i.x=vn,i.y=zn;var Tn=-Sn;return t.x=i.x+pn.gnormx*Tn,t.y=i.y+pn.gnormy*Tn,Sn}var An=pn.gp0,En=pn.gp1,In=on.gp0,Vn=on.gp1,Ln=0,Nn=0,Dn=0,jn=0;Ln=En.x-An.x,Nn=En.y-An.y,Dn=Vn.x-In.x,jn=Vn.y-In.y;var Fn=1/(Ln*Ln+Nn*Nn),Bn=1/(Dn*Dn+jn*jn),Rn=-(Ln*(An.x-In.x)+Nn*(An.y-In.y))*Fn,Gn=-(Ln*(An.x-Vn.x)+Nn*(An.y-Vn.y))*Fn,Yn=-(Dn*(In.x-An.x)+jn*(In.y-An.y))*Bn,Un=-(Dn*(In.x-En.x)+jn*(In.y-En.y))*Bn;0>Rn?Rn=0:Rn>1&&(Rn=1),0>Gn?Gn=0:Gn>1&&(Gn=1),0>Yn?Yn=0:Yn>1&&(Yn=1),0>Un?Un=0:Un>1&&(Un=1);var Zn=0,qn=0,Wn=Rn;Zn=An.x+Ln*Wn,qn=An.y+Nn*Wn;var Xn=0,Hn=0,Kn=Gn;Xn=An.x+Ln*Kn,Hn=An.y+Nn*Kn;var Jn=0,Qn=0,$n=Yn;Jn=In.x+Dn*$n,Qn=In.y+jn*$n;var ne=0,ee=0,te=Un;ne=In.x+Dn*te,ee=In.y+jn*te;var ie=0,le=0;ie=Zn-In.x,le=qn-In.y;var re=ie*ie+le*le,ae=0,pe=0;ae=Xn-Vn.x,pe=Hn-Vn.y;var se=ae*ae+pe*pe,oe=0,he=0;oe=Jn-An.x,he=Qn-An.y;var _e=oe*oe+he*he,ue=0,de=0;ue=ne-En.x,de=ee-En.y;var ce=ue*ue+de*de,xe=0,ve=0,ze=null;se>re?(xe=Zn,ve=qn,ze=In):(xe=Xn,ve=Hn,ze=Vn,re=se);var fe=0,me=0,be=null;if(ce>_e?(fe=Jn,me=Qn,be=An):(fe=ne,me=ee,be=En,_e=ce),_e>re?(t.x=xe,t.y=ve,i.x=ze.x,i.y=ze.y,Y=Math.sqrt(re)):(i.x=fe,i.y=me,t.x=be.x,t.y=be.y,Y=Math.sqrt(_e)),0!=Y){l.x=i.x-t.x,l.y=i.y-t.y;var ge=1/Y;l.x*=ge,l.y*=ge,x&&(l.x=-l.x,l.y=-l.y)}return Y}return r}return r};var gt=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};l["zpp_nape.geom.ZPP_PartitionPair"]=gt,gt.__name__=["zpp_nape","geom","ZPP_PartitionPair"],gt.get=function(n,e){var t;return null==gt.zpp_pool?t=new gt:(t=gt.zpp_pool,gt.zpp_pool=t.next,t.next=null),t.a=n,t.b=e,e.id>n.id?(t.id=n.id,t.di=e.id):(t.id=e.id,t.di=n.id),t},gt.edge_swap=function(n,e){var t=n.node;n.node=e.node,e.node=t},gt.edge_lt=function(n,e){return e.id>n.id||n.id==e.id&&e.di>n.di},gt.prototype={next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},free:function(){this.a=this.b=null,this.node=null},alloc:function(){},a:null,b:null,id:null,di:null,node:null,__class__:gt};var wt=function(){};l["zpp_nape.geom.ZPP_Triangular"]=wt,wt.__name__=["zpp_nape","geom","ZPP_Triangular"],wt.lt=function(n,e){return e.y>n.y||n.y==e.y&&e.x>n.x},wt.right_turn=function(n,e,t){var i=0,l=0;i=t.x-e.x,l=t.y-e.y;var r=0;return r=e.x-n.x,(e.y-n.y)*i-r*l},wt.delaunay=function(n,e,t,i){var l,r,a,p=0,s=0,o=0,h=0;return p=t.x-e.x,s=t.y-e.y,o=e.x-n.x,h=e.y-n.y,h*p-o*s<0?(p=i.x-t.x,s=i.y-t.y,o=t.x-e.x,h=t.y-e.y,a=h*p-o*s>=0):a=!0,a?r=!0:(p=n.x-i.x,s=n.y-i.y,o=i.x-t.x,h=i.y-t.y,r=h*p-o*s>=0),r?l=!0:(p=e.x-n.x,s=e.y-n.y,o=n.x-i.x,h=n.y-i.y,l=h*p-o*s>=0),!!l||e.x*(t.y*i.mag-t.mag*i.y)-t.x*(e.y*i.mag-e.mag*i.y)+i.x*(e.y*t.mag-e.mag*t.y)-(n.x*(t.y*i.mag-t.mag*i.y)-t.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*t.mag-n.mag*t.y))+(n.x*(e.y*i.mag-e.mag*i.y)-e.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*e.mag-n.mag*e.y))-(n.x*(e.y*t.mag-e.mag*t.y)-e.x*(n.y*t.mag-n.mag*t.y)+t.x*(n.y*e.mag-n.mag*e.y))>0},wt.optimise=function(n){var e=n.vertices,t=n.vertices;if(null!=e)for(var i=e;;){var l=i;if(l.sort(),l.mag=l.x*l.x+l.y*l.y,(i=i.next)==t)break}if(null==wt.edgeSet){null==Sl.zpp_pool?wt.edgeSet=new Sl:(wt.edgeSet=Sl.zpp_pool,Sl.zpp_pool=wt.edgeSet.next,wt.edgeSet.next=null);wt.edgeSet.lt=gt.edge_lt,wt.edgeSet.swapped=gt.edge_swap}var r;null==gt.zpp_pool?r=new gt:(r=gt.zpp_pool,gt.zpp_pool=r.next,r.next=null);var a=n.vertices,p=n.vertices;if(null!=a)for(var s=a;;){var o=s,h=o.next;o.diagonals.reverse();for(var _=o.diagonals.head;null!=_;){var u=_.elt;if(u.id<o.id)h=u,_=_.next;else{var d=null==_.next?o.prev:_.next.elt;if(!wt.delaunay(o,h,u,d)){var c;null==gt.zpp_pool?c=new gt:(c=gt.zpp_pool,gt.zpp_pool=c.next,c.next=null),c.a=o,c.b=u,u.id>o.id?(c.id=o.id,c.di=u.id):(c.id=u.id,c.di=o.id);var x=c;r.add(x),x.node=wt.edgeSet.insert(x)}h=u,_=_.next}}if((s=s.next)==p)break}for(;null!=r.next;){for(var v=r.pop_unsafe(),z=v.a,y=v.b,f=z.next,m=null,b=z.diagonals.head;null!=b;){var g=b.elt;if(g==y){b=b.next,m=null==b?z.prev:b.elt;break}f=g,b=b.next}if(z.diagonals.remove(y),y.diagonals.remove(z),y==f.next)f.diagonals.add(m);else for(var w=f.diagonals.head;null!=w;){var C=w.elt;if(C==y){f.diagonals.insert(w,m);break}w=w.next}if(z==m.next)m.diagonals.add(f);else for(var M=m.diagonals.head;null!=M;){var k=M.elt;if(k==z){m.diagonals.insert(M,f);break}M=M.next}wt.edgeSet.remove_node(v.node);var O=v;O.a=O.b=null,O.node=null,O.next=gt.zpp_pool,gt.zpp_pool=O}var S=r;S.a=S.b=null,S.node=null,S.next=gt.zpp_pool,gt.zpp_pool=S},wt.triangulate=function(n){var e=n.vertices,t=n.vertices,i=n.vertices.next,l=n.vertices;if(null!=i)for(var r=i;;){var a=r;if((e.y>a.y||a.y==e.y&&e.x>a.x)&&(e=a),(a.y>t.y||t.y==a.y&&a.x>t.x)&&(t=a),(r=r.next)==l)break}null==wt.queue&&(wt.queue=new pi);var p=t.prev,s=t.next;for(wt.queue.add(t);p!=e||s!=e;)p==e||s!=e&&(s.y>p.y||p.y==s.y&&s.x>p.x)?(wt.queue.add(s),s.rightchain=!1,s=s.next):(wt.queue.add(p),p.rightchain=!0,p=p.prev);wt.queue.add(e),null==wt.stack&&(wt.stack=new pi),wt.stack.add(wt.queue.pop_unsafe());var o=wt.queue.pop_unsafe();for(wt.stack.add(o);;){var h=wt.queue.pop_unsafe();if(null==wt.queue.head)break;if(h.rightchain!=wt.stack.head.elt.rightchain){for(;;){var _=wt.stack.pop_unsafe();if(null==wt.stack.head)break;n.add_diagonal(_,h)}wt.stack.add(o)}else{for(var u=wt.stack.pop_unsafe();null!=wt.stack.head;){var d=wt.stack.head.elt,c=0,x=0;c=h.x-u.x,x=h.y-u.y;var v=0,z=0;v=u.x-d.x,z=u.y-d.y;var y=z*c-v*x;if(h.rightchain&&y>=0||!h.rightchain&&0>=y)break;n.add_diagonal(d,h),u=d,wt.stack.pop()}wt.stack.add(u)}wt.stack.add(h),o=h}if(null!=wt.stack.head)for(wt.stack.pop();null!=wt.stack.head;){var f=wt.stack.pop_unsafe();if(null==wt.stack.head)break;n.add_diagonal(t,f)}return n};var Ct=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};l["zpp_nape.geom.ZPP_Vec2"]=Ct,Ct.__name__=["zpp_nape","geom","ZPP_Vec2"],Ct.get=function(n,e,t){null==t&&(t=!1);var i;return null==Ct.zpp_pool?i=new Ct:(i=Ct.zpp_pool,Ct.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=t,i.x=n,i.y=e,i},Ct.prototype={_invalidate:null,_validate:null,validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},_immutable:null,_isimmutable:null,immutable:function(){null!=this._isimmutable&&this._isimmutable()},outer:null,wrapper:function(){if(null==this.outer){this.outer=new On;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Ct.zpp_pool,Ct.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},weak:null,free:function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},alloc:function(){this.weak=!1},next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},x:null,y:null,copy:function(){var n,e=this.x,t=this.y;return null==Ct.zpp_pool?n=new Ct:(n=Ct.zpp_pool,Ct.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=e,n.y=t,n},toString:function(){return"{ x: "+this.x+" y: "+this.y+" }"},__class__:Ct};var Mt=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};l["zpp_nape.geom.ZPP_Vec3"]=Mt,Mt.__name__=["zpp_nape","geom","ZPP_Vec3"],Mt.prototype={outer:null,x:null,y:null,z:null,immutable:null,_validate:null,validate:function(){null!=this._validate&&this._validate()},__class__:Mt};var kt=function(){};l["zpp_nape.geom.ZPP_VecMath"]=kt,kt.__name__=["zpp_nape","geom","ZPP_VecMath"],kt.vec_dsq=function(n,e,t,i){var l=0,r=0;return l=n-t,r=e-i,l*l+r*r},kt.vec_distance=function(n,e,t,i){var l=0,r=0;return l=n-t,r=e-i,Math.sqrt(l*l+r*r)};var Ot=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=pe.Interactor(),this.cbsets=new $t,this.cbTypes=new ge};l["zpp_nape.phys.ZPP_Interactor"]=Ot,Ot.__name__=["zpp_nape","phys","ZPP_Interactor"],Ot.get=function(n,e){for(var t=e.id>n.id?n.id:e.id,i=e.id>n.id?e.id:n.id,l=e.cbsets.length>n.cbsets.length?n.cbsets:e.cbsets,r=null,a=l.head;null!=a;){var p=a.elt;if(p.id==t&&p.di==i){r=p;break}a=a.next}return r},Ot.int_callback=function(n,e,t){var i,l=n.int1,r=n.int2,a=e.options1,p=l.cbTypes;if(a.nonemptyintersection(p,a.includes)&&!a.nonemptyintersection(p,a.excludes)){var s=e.options2,o=r.cbTypes;i=!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}else i=!1;i?(t.int1=l,t.int2=r):(t.int1=r,t.int2=l)},Ot.prototype={outer_i:null,id:null,userData:null,ishape:null,ibody:null,icompound:null,isShape:function(){return null!=this.ishape},isBody:function(){return null!=this.ibody},isCompound:function(){return null!=this.icompound},__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var n=this.cbTypes.head;null!=n;){n.elt.interactors.add(this),n=n.next}this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);for(var n=this.cbTypes.head;null!=n;){n.elt.interactors.remove(this),n=n.next}this.dealloc_cbSet()},wake:function(){if(null!=this.ishape){var n=this.ishape.body;null!=n&&null!=n.space&&n.space.non_inlined_wake(n)}else null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},cbsets:null,getSpace:function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space},group:null,cbTypes:null,cbSet:null,wrap_cbTypes:null,setupcbTypes:function(){this.wrap_cbTypes=dl.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=t(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=t(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=t(this,this.immutable_cbTypes)},immutable_cbTypes:function(){this.immutable_midstep("Interactor::cbTypes")},wrap_cbTypes_subber:function(n){var e=n.zpp_inner;if(this.cbTypes.has(e)){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=t&&(this.dealloc_cbSet(),e.interactors.remove(this)),this.cbTypes.remove(e),null!=t&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(n){return this.insert_cbtype(n.zpp_inner),!1},insert_cbtype:function(n){if(!this.cbTypes.has(n)){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=e&&(this.dealloc_cbSet(),n.interactors.add(this));for(var t=null,i=this.cbTypes.head;null!=i;){if(i.elt.id>n.id)break;t=i,i=i.next}var l,r=this.cbTypes;null==ki.zpp_pool?l=new ki:(l=ki.zpp_pool,ki.zpp_pool=l.next,l.next=null),l.elt=n;var a=l;null==t?(a.next=r.head,r.head=a):(a.next=t.next,t.next=a),r.pushmod=r.modified=!0,r.length++,null!=e&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=n.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),n.freshInteractorType(this))},dealloc_cbSet:function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),n.nullInteractorType(this),0==--this.cbSet.count){n.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;){e.cbTypes.pop_unsafe().cbsets.remove(e)}e.next=oe.zpp_pool,oe.zpp_pool=e}this.cbSet=null}},setGroup:function(n){if(this.group!=n){var e=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space);e&&null!=this.group&&this.group.interactors.remove(this),this.group=n,e&&null!=n&&n.interactors.add(this),e&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():this.icompound.wake())}},immutable_midstep:function(n){if(null!=this.ibody);else null!=this.ishape?this.ishape.__immutable_midstep(n):this.icompound.__imutable_midstep(n)},lookup_group:function(){for(var n=this;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:null!=n.icompound?n.icompound.compound:n.ibody.compound;return null==n?null:n.group},copyto:function(n){n.zpp_inner_i.group=this.group;var e=this.outer_i;null==e.zpp_inner_i.wrap_cbTypes&&e.zpp_inner_i.setupcbTypes();var t=e.zpp_inner_i.wrap_cbTypes;t.zpp_inner.valmod();for(var i=k.get(t);;){i.zpp_inner.zpp_inner.valmod();var l=i.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var r=l.zpp_inner.user_length;i.zpp_critical=!0;var a;if(r>i.zpp_i?a=!0:(i.zpp_next=k.zpp_pool,k.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();var s=n.zpp_inner_i.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(p):s.unshift(p)}null!=this.userData&&(n.zpp_inner_i.userData=o.copy(this.userData))},__class__:Ot};var St=function(){this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,Ot.call(this),this.ibody=this,this.world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=Infinity,this.pre_posy=Infinity,this.pre_rot=Infinity,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0;var n;null==Ze.zpp_pool?n=new Ze:(n=Ze.zpp_pool,Ze.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0;this.aabb._validate=t(this,this.aabb_validate),this.massMode=ye.id_MassMode_DEFAULT,this.gravMassMode=ye.id_GravMassMode_DEFAULT,this.gravMassScale=1,this.inertiaMode=ye.id_InertiaMode_DEFAULT,this.arbiters=new ii,this.constraints=new ce,this.shapes=new ni,this.wrap_shapes=fl.get(this.shapes),this.wrap_shapes.zpp_inner.adder=t(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=t(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=t(this,this.shapes_invalidate),this.wrap_shapes.zpp_inner._modifiable=t(this,this.shapes_modifiable),this.kinematicDelaySleep=!1};l["zpp_nape.phys.ZPP_Body"]=St,St.__name__=["zpp_nape","phys","ZPP_Body"],St.bodysetlt=function(n,e){return e.id>n.id},St.__static=function(){null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1);var n=new In(ye.BodyType_STATIC),e=n.zpp_inner;return e.world=!0,e.wrap_shapes.zpp_inner.immutable=!0,e.smass=e.imass=e.cmass=e.mass=e.gravMass=0,e.sinertia=e.iinertia=e.cinertia=e.inertia=0,e.cbTypes.clear(),n},St.__super__=Ot,St.prototype=e(Ot.prototype,{outer:null,world:null,type:null,isStatic:function(){return this.type==ye.id_BodyType_STATIC},isDynamic:function(){return this.type==ye.id_BodyType_DYNAMIC},isKinematic:function(){return this.type==ye.id_BodyType_KINEMATIC},invalidate_type:function(){this.invalidate_mass(),this.invalidate_inertia()},compound:null,shapes:null,wrap_shapes:null,invalidate_shapes:function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},space:null,arbiters:null,wrap_arbiters:null,constraints:null,wrap_constraints:null,component:null,graph_depth:null,init_bodysetlist:function(){null==St.bodyset&&(St.bodyset=new Ml,St.bodyset.lt=St.bodysetlt,St.bodystack=new ei)},connectedBodies_cont:function(n){n!=n.zpp_inner.space.__static&&St.bodyset.try_insert_bool(n.zpp_inner)&&(St.bodystack.add(n.zpp_inner),n.zpp_inner.graph_depth=St.cur_graph_depth+1)},connectedBodies:function(n,e){var i=this;null==St.bodyset&&(St.bodyset=new Ml,St.bodyset.lt=St.bodysetlt,St.bodystack=new ei);var l=null==e?new Ln:e;for(St.bodystack.add(this),St.bodyset.insert(this),this.graph_depth=0;null!=St.bodystack.head;){var r=St.bodystack.pop_unsafe();if(r.graph_depth!=n){St.cur_graph_depth=r.graph_depth;for(var a=r.constraints.head;null!=a;){a.elt.outer.visitBodies(t(this,this.connectedBodies_cont)),a=a.next}}}var p=St.bodyset;if(null!=p.parent){for(var s=p.parent;null!=s;)if(null!=s.prev)s=s.prev;else if(null!=s.next)s=s.next;else{var o=s.data;if(o!=i){var h=o.outer;l.zpp_inner.reverse_flag?l.push(h):l.unshift(h)}var _=s.parent;null!=_&&(s==_.prev?_.prev=null:_.next=null,s.parent=null);var u=s;u.data=null,u.lt=null,u.swapped=null,u.next=Ml.zpp_pool,Ml.zpp_pool=u,s=_}p.parent=null}return l},interactingBodies:function(n,e,t){var i=this;null==St.bodyset&&(St.bodyset=new Ml,St.bodyset.lt=St.bodysetlt,St.bodystack=new ei);var l=null==t?new Ln:t;for(St.bodyset.insert(this),St.bodystack.add(this),this.graph_depth=0;null!=St.bodystack.head;){var r=St.bodystack.pop_unsafe();if(r.graph_depth!=e)for(var a=r.arbiters.head;null!=a;){var p=a.elt;if(0!=(p.type&n)){var s=p.b1==r?p.b2:p.b1;St.bodyset.try_insert_bool(s)&&(St.bodystack.add(s),s.graph_depth=r.graph_depth+1)}a=a.next}}var o=St.bodyset;if(null!=o.parent){for(var h=o.parent;null!=h;)if(null!=h.prev)h=h.prev;else if(null!=h.next)h=h.next;else{var _=h.data;if(_!=i){var u=_.outer;l.zpp_inner.reverse_flag?l.push(u):l.unshift(u)}var d=h.parent;null!=d&&(h==d.prev?d.prev=null:d.next=null,h.parent=null);var c=h;c.data=null,c.lt=null,c.swapped=null,c.next=Ml.zpp_pool,Ml.zpp_pool=c,h=d}o.parent=null}return l},atRest:function(n){if(this.type!=ye.id_BodyType_DYNAMIC)return this.component.sleeping;var e=f.linearSleepThreshold;e*=e;var t;if(this.velx*this.velx+this.vely*this.vely>e)t=!1;else{var i=0,l=0;if(i=this.posx-this.pre_posx,l=this.posy-this.pre_posy,i*i+l*l>.25*e*n*n)t=!1;else{var r=0,a=0;r=this.aabb.maxx-this.aabb.minx,a=this.aabb.maxy-this.aabb.miny;var p=r*r+a*a,s=f.angularSleepThreshold;if(s*=s,4*this.angvel*this.angvel*p>s)t=!1;else{var o=this.rot-this.pre_rot;t=o*o*p<=s*n*n}}}return t||(this.component.waket=this.space.stamp),this.space.stamp>this.component.waket+f.sleepDelay},refreshArbiters:function(){for(var n=this.arbiters.head;null!=n;){n.elt.invalidated=!0,n=n.next}},sweepTime:null,sweep_angvel:null,sweepFrozen:null,sweepRadius:null,bullet:null,bulletEnabled:null,disableCCD:null,sweepIntegrate:function(n){var e=n-this.sweepTime;if(0!=e){this.sweepTime=n;var t=e;if(this.posx+=this.velx*t,this.posy+=this.vely*t,0!=this.angvel){var i=this.sweep_angvel*e;if(this.rot+=i,i*i>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var l=i*i,r=1-.5*l,a=1-l*l/8,p=(r*this.axisx+i*this.axisy)*a;this.axisy=(r*this.axisy-i*this.axisx)*a,this.axisx=p}}}},sweepValidate:function(n){if(n.type==ye.id_ShapeType_CIRCLE)n.worldCOMx=this.posx+(this.axisy*n.localCOMx-this.axisx*n.localCOMy),n.worldCOMy=this.posy+(n.localCOMx*this.axisx+n.localCOMy*this.axisy);else{for(var e=n.polygon,t=e.lverts.next,i=e.gverts.next;null!=i;){var l=i,r=t;t=t.next,l.x=this.posx+(this.axisy*r.x-this.axisx*r.y),l.y=this.posy+(r.x*this.axisx+r.y*this.axisy),i=i.next}var a=e.edges.head,p=e.gverts.next,s=p;for(p=p.next;null!=p;){var o=p,h=a.elt;a=a.next,h.gnormx=this.axisy*h.lnormx-this.axisx*h.lnormy,h.gnormy=h.lnormx*this.axisx+h.lnormy*this.axisy,h.gprojection=this.posx*h.gnormx+this.posy*h.gnormy+h.lprojection,h.tp0=s.y*h.gnormx-s.x*h.gnormy,h.tp1=o.y*h.gnormx-o.x*h.gnormy,s=o,p=p.next}var _=e.gverts.next,u=a.elt;a=a.next,u.gnormx=this.axisy*u.lnormx-this.axisx*u.lnormy,u.gnormy=u.lnormx*this.axisx+u.lnormy*this.axisy,u.gprojection=this.posx*u.gnormx+this.posy*u.gnormy+u.lprojection,u.tp0=s.y*u.gnormx-s.x*u.gnormy,u.tp1=_.y*u.gnormx-_.x*u.gnormy}},pre_posx:null,pre_posy:null,posx:null,posy:null,wrap_pos:null,velx:null,vely:null,wrap_vel:null,forcex:null,forcey:null,wrap_force:null,kinvelx:null,kinvely:null,wrap_kinvel:null,svelx:null,svely:null,wrap_svel:null,invalidate_pos:function(){for(var n=this.shapes.head;null!=n;){var e=n.elt;e.type==ye.id_ShapeType_POLYGON&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},pos_invalidate:function(n){if(this.immutable_midstep("Body::position"),this.posx!=n.x||this.posy!=n.y){this.posx=n.x,this.posy=n.y;for(var e=this.shapes.head;null!=e;){var t=e.elt;t.type==ye.id_ShapeType_POLYGON&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.wake()}},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(n){this.velx=n.x,this.vely=n.y,this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},kinvel_invalidate:function(n){this.kinvelx=n.x,this.kinvely=n.y,this.wake()},kinvel_validate:function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},svel_invalidate:function(n){this.svelx=n.x,this.svely=n.y,this.wake()},svel_validate:function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},force_invalidate:function(n){this.forcex=n.x,this.forcey=n.y,this.wake()},force_validate:function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},setupPosition:function(){var n,e=this.posx,i=this.posy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_pos=n,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=t(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=t(this,this.pos_validate))},setupVelocity:function(){var n,e=this.velx,i=this.vely;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_vel=n,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=t(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=t(this,this.vel_validate))},setupkinvel:function(){var n,e=this.kinvelx,i=this.kinvely;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_kinvel=n,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=t(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=t(this,this.kinvel_validate))},setupsvel:function(){var n,e=this.svelx,i=this.svely;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_svel=n,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=t(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=t(this,this.svel_validate))},setupForce:function(){var n,e=this.forcex,i=this.forcey;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_force=n,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=t(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=t(this,this.force_validate))},cvel_validate:function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},wrapcvel:null,setup_cvel:function(){this.wrapcvel=Tn.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=t(this,this.cvel_validate)},angvel:null,torque:null,kinangvel:null,pre_rot:null,rot:null,invalidate_rot:function(){this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.type==ye.id_ShapeType_POLYGON&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},axisx:null,axisy:null,zip_axis:null,validate_axis:function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},quick_validate_axis:function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},delta_rot:function(n){if(this.rot+=n,n*n>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var e=n*n,t=1-.5*e,i=1-e*e/8,l=(t*this.axisx+n*this.axisy)*i;this.axisy=(t*this.axisy-n*this.axisx)*i,this.axisx=l}},kinematicDelaySleep:null,mass:null,zip_mass:null,massMode:null,imass:null,smass:null,cmass:null,nomove:null,invalidate_mass:function(){this.zip_mass=!0,this.invalidate_gravMass()},validate_mass:function(){if(this.zip_mass){if(this.zip_mass=!1,this.massMode==ye.id_MassMode_DEFAULT){this.cmass=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cmass+=e.area*e.material.density,n=n.next}}this.type!=ye.id_BodyType_DYNAMIC||this.nomove?(this.mass=Infinity,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},gravMass:null,zip_gravMass:null,gravMassMode:null,gravMassScale:null,zip_gravMassScale:null,invalidate_gravMass:function(){this.gravMassMode!=ye.id_GravMassMode_FIXED&&(this.zip_gravMass=!0),this.gravMassMode!=ye.id_GravMassMode_SCALED&&(this.zip_gravMassScale=!0),this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),this.gravMassMode==ye.id_GravMassMode_DEFAULT?(this.validate_mass(),this.gravMass=this.cmass):this.gravMassMode==ye.id_GravMassMode_SCALED&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_gravMassScale:function(){this.gravMassMode!=ye.id_GravMassMode_SCALED?this.zip_gravMassScale=!0:this.invalidate_gravMass()},validate_gravMassScale:function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,this.gravMassMode==ye.id_GravMassMode_DEFAULT?this.gravMassScale=1:this.gravMassMode==ye.id_GravMassMode_FIXED&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},inertiaMode:null,inertia:null,zip_inertia:null,cinertia:null,iinertia:null,sinertia:null,norotate:null,invalidate_inertia:function(){this.zip_inertia=!0,this.wake()},validate_inertia:function(){if(this.zip_inertia){if(this.zip_inertia=!1,this.inertiaMode==ye.id_InertiaMode_DEFAULT){this.cinertia=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cinertia+=e.inertia*e.area*e.material.density,n=n.next}}this.type!=ye.id_BodyType_DYNAMIC||this.norotate?(this.inertia=Infinity,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},invalidate_wake:function(){this.wake()},aabb:null,zip_aabb:null,validate_aabb:function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=Infinity,this.aabb.miny=Infinity,this.aabb.maxx=-Infinity,this.aabb.maxy=-Infinity;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==ye.id_ShapeType_CIRCLE){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,t.type==ye.id_ShapeType_POLYGON){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var l=0,r=i.lverts.next,a=r;r=r.next;var p=r;for(r=r.next;null!=r;){var s=r;l+=p.x*(s.y-a.y);var o=s.y*p.x-s.x*p.y;i.localCOMx+=(p.x+s.x)*o,i.localCOMy+=(p.y+s.y)*o,a=p,p=s,r=r.next}r=i.lverts.next;var h=r;l+=p.x*(h.y-a.y);var _=h.y*p.x-h.x*p.y;i.localCOMx+=(p.x+h.x)*_,i.localCOMy+=(p.y+h.y)*_,a=p,p=h,r=r.next;var u=r;l+=p.x*(u.y-a.y);var d=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*d,i.localCOMy+=(p.y+u.y)*d,l=1/(3*l);var c=l;i.localCOMx*=c,i.localCOMy*=c}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var x=t.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var v=t.radius,z=t.radius;t.aabb.minx=t.worldCOMx-v,t.aabb.miny=t.worldCOMy-z,t.aabb.maxx=t.worldCOMx+v,t.aabb.maxy=t.worldCOMy+z}else{var y=e.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var f=y.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=y.lverts.next,b=y.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),g.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}var C=y.gverts.next;y.aabb.minx=C.x,y.aabb.miny=C.y,y.aabb.maxx=C.x,y.aabb.maxy=C.y;for(var M=y.gverts.next.next;null!=M;){var k=M;y.aabb.minx>k.x&&(y.aabb.minx=k.x),k.x>y.aabb.maxx&&(y.aabb.maxx=k.x),y.aabb.miny>k.y&&(y.aabb.miny=k.y),k.y>y.aabb.maxy&&(y.aabb.maxy=k.y),M=M.next}}var O=this.aabb,S=e.aabb;O.minx>S.minx&&(O.minx=S.minx),S.maxx>O.maxx&&(O.maxx=S.maxx),O.miny>S.miny&&(O.miny=S.miny),S.maxy>O.maxy&&(O.maxy=S.maxy),n=n.next}}},invalidate_aabb:function(){this.zip_aabb=!0},localCOMx:null,localCOMy:null,zip_localCOM:null,worldCOMx:null,worldCOMy:null,zip_worldCOM:null,wrap_localCOM:null,wrap_worldCOM:null,invalidate_localCOM:function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},invalidate_worldCOM:function(){this.zip_worldCOM=!0},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var n=0,e=0,t=0,i=this.shapes.head;null!=i;){var l=i.elt;if(l.zip_localCOM){if(l.zip_localCOM=!1,l.type==ye.id_ShapeType_POLYGON){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next){r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;r.localCOMx+=1*r.lverts.next.next.x,r.localCOMy+=1*r.lverts.next.next.y;r.localCOMx*=.5,r.localCOMy*=.5}else{r.localCOMx=0,r.localCOMy=0;var a=0,p=r.lverts.next,s=p;p=p.next;var o=p;for(p=p.next;null!=p;){var h=p;a+=o.x*(h.y-s.y);var _=h.y*o.x-h.x*o.y;r.localCOMx+=(o.x+h.x)*_,r.localCOMy+=(o.y+h.y)*_,s=o,o=h,p=p.next}p=r.lverts.next;var u=p;a+=o.x*(u.y-s.y);var d=u.y*o.x-u.x*o.y;r.localCOMx+=(o.x+u.x)*d,r.localCOMy+=(o.y+u.y)*d,s=o,o=u,p=p.next;var c=p;a+=o.x*(c.y-s.y);var x=c.y*o.x-c.x*o.y;r.localCOMx+=(o.x+c.x)*x,r.localCOMy+=(o.y+c.y)*x,a=1/(3*a);var v=a;r.localCOMx*=v,r.localCOMy*=v}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}l.validate_area_inertia();var z=l.area*l.material.density;n+=l.localCOMx*z,e+=l.localCOMy*z,t+=l.area*l.material.density,i=i.next}if(0!=t){var y=1/t;this.localCOMx=n*y,this.localCOMy=e*y}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&this.massMode==ye.id_MassMode_DEFAULT&&(this.zip_mass=!1,this.cmass=t,this.type==ye.id_BodyType_DYNAMIC?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Infinity,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},getlocalCOM:function(){this.validate_localCOM()},getworldCOM:function(){this.validate_worldCOM()},__immutable_midstep:function(n){},clear:function(){for(;null!=this.shapes.head;){var n=this.shapes.pop_unsafe();n.removedFromBody(),n.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var e=this.shapes.head;null!=e;){var t=e.elt;t.type==ye.id_ShapeType_POLYGON&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var i=this.shapes.head;null!=i;){var l=i.elt;l.type==ye.id_ShapeType_POLYGON&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),i=i.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=ye.id_MassMode_DEFAULT,this.gravMassMode=ye.id_GravMassMode_DEFAULT,this.gravMassScale=1,this.inertiaMode=ye.id_InertiaMode_DEFAULT,this.norotate=!1,this.nomove=!1},aabb_validate:function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=Infinity,this.aabb.miny=Infinity,this.aabb.maxx=-Infinity,this.aabb.maxy=-Infinity;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==ye.id_ShapeType_CIRCLE){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,t.type==ye.id_ShapeType_POLYGON){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var l=0,r=i.lverts.next,a=r;r=r.next;var p=r;for(r=r.next;null!=r;){var s=r;l+=p.x*(s.y-a.y);var o=s.y*p.x-s.x*p.y;i.localCOMx+=(p.x+s.x)*o,i.localCOMy+=(p.y+s.y)*o,a=p,p=s,r=r.next}r=i.lverts.next;var h=r;l+=p.x*(h.y-a.y);var _=h.y*p.x-h.x*p.y;i.localCOMx+=(p.x+h.x)*_,i.localCOMy+=(p.y+h.y)*_,a=p,p=h,r=r.next;var u=r;l+=p.x*(u.y-a.y);var d=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*d,i.localCOMy+=(p.y+u.y)*d,l=1/(3*l);var c=l;i.localCOMx*=c,i.localCOMy*=c}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var x=t.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var v=t.radius,z=t.radius;t.aabb.minx=t.worldCOMx-v,t.aabb.miny=t.worldCOMy-z,t.aabb.maxx=t.worldCOMx+v,t.aabb.maxy=t.worldCOMy+z}else{var y=e.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var f=y.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=y.lverts.next,b=y.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),g.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}var C=y.gverts.next;y.aabb.minx=C.x,y.aabb.miny=C.y,y.aabb.maxx=C.x,y.aabb.maxy=C.y;for(var M=y.gverts.next.next;null!=M;){var k=M;y.aabb.minx>k.x&&(y.aabb.minx=k.x),k.x>y.aabb.maxx&&(y.aabb.maxx=k.x),y.aabb.miny>k.y&&(y.aabb.miny=k.y),k.y>y.aabb.maxy&&(y.aabb.maxy=k.y),M=M.next}}var O=this.aabb,S=e.aabb;O.minx>S.minx&&(O.minx=S.minx),S.maxx>O.maxx&&(O.maxx=S.maxx),O.miny>S.miny&&(O.miny=S.miny),S.maxy>O.maxy&&(O.maxy=S.maxy),n=n.next}}},shapes_adder:function(n){if(n.zpp_inner.body!=this){if(null!=n.zpp_inner.body&&n.zpp_inner.body.wrap_shapes.remove(n),n.zpp_inner.body=this,n.zpp_inner.addedToBody(),null!=this.space){var e=this.space,t=n.zpp_inner,i=t.body;i.world||(i.component.waket=e.stamp+(e.midstep?0:1),i.type==ye.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&e.really_wake(i,!1)),e.bphase.insert(t),t.addedToSpace()}return n.zpp_inner.type==ye.id_ShapeType_POLYGON&&(n.zpp_inner.polygon.invalidate_gaxi(),n.zpp_inner.polygon.invalidate_gverts()),!0}return!1},shapes_subber:function(n){null!=this.space&&this.space.removed_shape(n.zpp_inner),n.zpp_inner.body=null,n.zpp_inner.removedFromBody()},shapes_invalidate:function(n){this.invalidate_shapes()},shapes_modifiable:function(){this.immutable_midstep("Body::shapes")},addedToSpace:function(){null==Gt.zpp_pool?this.component=new Gt:(this.component=Gt.zpp_pool,Gt.zpp_pool=this.component.next,this.component.next=null);this.component.isBody=!0,this.component.body=this,this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=this.arbiters.head;){var n=this.arbiters.pop_unsafe(),e=this.space;if(n.cleared=!0,n.b2==this)for(var t=n.b1.arbiters,i=null,l=t.head;null!=l;){if(l.elt==n){var r,a;null==i?(r=t.head,a=r.next,null==(t.head=a)&&(t.pushmod=!0)):(r=i.next,a=r.next,i.next=a,null==a&&(t.pushmod=!0));var p=r;p.elt=null,p.next=Ni.zpp_pool,Ni.zpp_pool=p,t.modified=!0,t.length--,t.pushmod=!0,!0;break}i=l,l=l.next}if(n.b1==this)for(var s=n.b2.arbiters,o=null,h=s.head;null!=h;){if(h.elt==n){var _,u;null==o?(_=s.head,u=_.next,null==(s.head=u)&&(s.pushmod=!0)):(_=o.next,u=_.next,o.next=u,null==u&&(s.pushmod=!0));var d=_;d.elt=null,d.next=Ni.zpp_pool,Ni.zpp_pool=d,s.modified=!0,s.length--,s.pushmod=!0,!0;break}o=h,h=h.next}null!=n.pair&&(n.pair.arb=null,n.pair=null),n.active=!1,e.f_arbiters.modified=!0}var c=this.component;c.body=null,c.constraint=null,c.next=Gt.zpp_pool,Gt.zpp_pool=c,this.component=null,this.__iremovedFromSpace()},copy:function(){var n=(new In).zpp_inner;n.type=this.type,n.bulletEnabled=this.bulletEnabled,n.disableCCD=this.disableCCD;for(var e=this.shapes.head;null!=e;){var t=e.elt,i=n.outer.zpp_inner.wrap_shapes,l=t.outer.copy();i.zpp_inner.reverse_flag?i.push(l):i.unshift(l),e=e.next}if(n.posx=this.posx,n.posy=this.posy,n.velx=this.velx,n.vely=this.vely,n.forcex=this.forcex,n.forcey=this.forcey,n.rot=this.rot,n.angvel=this.angvel,n.torque=this.torque,n.kinvelx=this.kinvelx,n.kinvely=this.kinvely,n.kinangvel=this.kinangvel,n.svelx=this.svelx,n.svely=this.svely,this.zip_axis){n.zip_axis=!0;for(var r=n.shapes.head;null!=r;){var a=r.elt;a.type==ye.id_ShapeType_POLYGON&&(a.polygon.invalidate_gverts(),a.polygon.invalidate_gaxi()),a.invalidate_worldCOM(),r=r.next}n.zip_worldCOM=!0}else n.axisx=this.axisx,n.axisy=this.axisy;return n.rot=this.rot,n.massMode=this.massMode,n.gravMassMode=this.gravMassMode,n.inertiaMode=this.inertiaMode,n.norotate=this.norotate,n.nomove=this.nomove,n.cmass=this.cmass,n.cinertia=this.cinertia,this.zip_mass?n.invalidate_mass():n.mass=this.mass,this.zip_gravMass?n.invalidate_gravMass():n.gravMass=this.gravMass,this.zip_gravMassScale?n.invalidate_gravMassScale():n.gravMassScale=this.gravMassScale,this.zip_inertia?n.invalidate_inertia():n.inertia=this.inertia,this.zip_aabb?n.zip_aabb=!0:(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(n.zip_localCOM=!0,n.zip_worldCOM=!0):(n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy),this.zip_worldCOM?n.zip_worldCOM=!0:(n.worldCOMx=this.worldCOMx,n.worldCOMy=this.worldCOMy),this.copyto(n.outer),n.outer},__class__:St});var Pt=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,Ot.call(this),this.icompound=this,this.depth=1;this.bodies=new ei,this.wrap_bodies=ol.get(this.bodies),this.wrap_bodies.zpp_inner.adder=t(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=t(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=t(this,this.bodies_modifiable),this.constraints=new ce,this.wrap_constraints=sl.get(this.constraints),this.wrap_constraints.zpp_inner.adder=t(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=t(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=t(this,this.constraints_modifiable),this.compounds=new ti,this.wrap_compounds=_l.get(this.compounds),this.wrap_compounds.zpp_inner.adder=t(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=t(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=t(this,this.compounds_modifiable)};l["zpp_nape.phys.ZPP_Compound"]=Pt,Pt.__name__=["zpp_nape","phys","ZPP_Compound"],Pt.__super__=Ot,Pt.prototype=e(Ot.prototype,{outer:null,bodies:null,constraints:null,compounds:null,wrap_bodies:null,wrap_constraints:null,wrap_compounds:null,depth:null,compound:null,space:null,__imutable_midstep:function(n){},addedToSpace:function(){this.__iaddedToSpace()},removedFromSpace:function(){this.__iremovedFromSpace()},breakApart:function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var n=this.bodies.pop_unsafe();null!=(n.compound=this.compound)?this.compound.bodies.add(n):null!=this.space&&this.space.bodies.add(n),null!=this.space&&this.space.freshInteractorType(n)}for(;null!=this.constraints.head;){var e=this.constraints.pop_unsafe();null!=(e.compound=this.compound)?this.compound.constraints.add(e):null!=this.space&&this.space.constraints.add(e)}for(;null!=this.compounds.head;){var t=this.compounds.pop_unsafe();null!=(t.compound=this.compound)?this.compound.compounds.add(t):null!=this.space&&this.space.compounds.add(t),null!=this.space&&this.space.freshInteractorType(t)}this.compound=null,this.space=null},bodies_adder:function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_bodies.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_bodies.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addBody(n.zpp_inner),!0)},bodies_subber:function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remBody(n.zpp_inner)},bodies_modifiable:function(){this.immutable_midstep("Compound::bodies")},constraints_adder:function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_constraints.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_constraints.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addConstraint(n.zpp_inner),!0)},constraints_subber:function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remConstraint(n.zpp_inner)},constraints_modifiable:function(){this.immutable_midstep("Compound::constraints")},compounds_adder:function(n){for(var e=this;null!=e&&e!=n.zpp_inner;)e=e.compound;return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_compounds.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),n.zpp_inner.compound=this,n.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(n.zpp_inner),!0)},compounds_subber:function(n){n.zpp_inner.compound=null,n.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(n.zpp_inner)},compounds_modifiable:function(){this.immutable_midstep("Compound::compounds")},copy:function(n,e){var t=null==n;null==n&&(n=[]),null==e&&(e=[]);for(var i=new Dn,l=this.compounds.head;null!=l;){var r=l.elt,a=r.copy(n,e);if(a.zpp_inner.immutable_midstep("Compound::compound"),(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)!=i&&(null!=(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer)&&(null==a.zpp_inner.compound?null:a.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(a),null!=i)){var p=i.zpp_inner.wrap_compounds;p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}l=l.next}for(var s=this.bodies.head;null!=s;){var o=s.elt,h=o.outer.copy();if(n.push(Oe.dict(o.id,h)),(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer)!=i&&(null!=(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer)&&(null==h.zpp_inner.compound?null:h.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(h),null!=i)){var _=i.zpp_inner.wrap_bodies;_.zpp_inner.reverse_flag?_.push(h):_.unshift(h)}s=s.next}for(var u=this.constraints.head;null!=u;){var d=u.elt,c=d.copy(n,e);if((null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer)!=i&&(null!=(null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer)&&(null==c.zpp_inner.compound?null:c.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(c),null!=i)){var x=i.zpp_inner.wrap_constraints;x.zpp_inner.reverse_flag?x.push(c):x.unshift(c)}u=u.next}if(t)for(;e.length>0;)for(var v=e.pop(),z=0;n.length>z;){var y=n[z];if(++z,y.id==v.id){v.cb(y.bc);break}}return this.copyto(i),i},__class__:Pt});var Tt=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ni,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};l["zpp_nape.phys.ZPP_FluidProperties"]=Tt,Tt.__name__=["zpp_nape","phys","ZPP_FluidProperties"],Tt.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new Bn;var n=this.outer.zpp_inner;n.outer=null,n.next=Tt.zpp_pool,Tt.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new ni},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},copy:function(){var n;return null==Tt.zpp_pool?n=new Tt:(n=Tt.zpp_pool,Tt.zpp_pool=n.next,n.next=null),n.viscosity=this.viscosity,n.density=this.density,n},viscosity:null,density:null,gravityx:null,gravityy:null,wrap_gravity:null,gravity_invalidate:function(n){this.gravityx=n.x,this.gravityy=n.y,this.invalidate()},gravity_validate:function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},getgravity:function(){var n,e=this.gravityx,i=this.gravityy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=t(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=t(this,this.gravity_validate)},invalidate:function(){for(var n=this.shapes.head;null!=n;){n.elt.invalidate_fluidprops(),n=n.next}},__class__:Tt};var At=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new ni,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};l["zpp_nape.phys.ZPP_Material"]=At,At.__name__=["zpp_nape","phys","ZPP_Material"],At.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new qn;var n=this.outer.zpp_inner;n.outer=null,n.next=At.zpp_pool,At.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new ni},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},dynamicFriction:null,staticFriction:null,density:null,elasticity:null,rollingFriction:null,copy:function(){var n=new At;return n.dynamicFriction=this.dynamicFriction,n.staticFriction=this.staticFriction,n.density=this.density,n.elasticity=this.elasticity,n.rollingFriction=this.rollingFriction,n},set:function(n){this.dynamicFriction=n.dynamicFriction,this.staticFriction=n.staticFriction,this.density=n.density,this.elasticity=n.elasticity,this.rollingFriction=n.rollingFriction},invalidate:function(n){for(var e=this.shapes.head;null!=e;){e.elt.invalidate_material(n),e=e.next}},__class__:At};var Et=function(n){this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,Ot.call(this),this.pairs=new di,this.ishape=this,this.type=n;var e;null==Ze.zpp_pool?e=new Ze:(e=Ze.zpp_pool,Ze.zpp_pool=e.next,e.next=null),e.minx=0,e.miny=0,e.maxx=0,e.maxy=0,this.aabb=e,this.aabb._immutable=!0;this.aabb._validate=t(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new At,this.sweepRadius=this.sweepCoef=0};l["zpp_nape.shape.ZPP_Shape"]=Et,Et.__name__=["zpp_nape","shape","ZPP_Shape"],Et.__super__=Ot,Et.prototype=e(Ot.prototype,{outer:null,body:null,type:null,isCircle:function(){return this.type==ye.id_ShapeType_CIRCLE},isPolygon:function(){return this.type==ye.id_ShapeType_POLYGON},area:null,zip_area_inertia:null,inertia:null,angDrag:null,zip_angDrag:null,localCOMx:null,localCOMy:null,zip_localCOM:null,worldCOMx:null,worldCOMy:null,zip_worldCOM:null,wrap_localCOM:null,wrap_worldCOM:null,sweepRadius:null,zip_sweepRadius:null,sweepCoef:null,invalidate_sweepRadius:function(){this.zip_sweepRadius=!0},validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,this.type==ye.id_ShapeType_CIRCLE?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},circle:null,polygon:null,refmaterial:null,material:null,filter:null,fluidProperties:null,fluidEnabled:null,sensorEnabled:null,sweep:null,node:null,pairs:null,clear:function(){this.type==ye.id_ShapeType_CIRCLE?this.circle.__clear():this.polygon.__clear()},aabb:null,zip_aabb:null,validate_aabb:function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,this.type==ye.id_ShapeType_CIRCLE){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,l=i;i=i.next;var r=i;for(i=i.next;null!=i;){var a=i;t+=r.x*(a.y-l.y);var p=a.y*r.x-a.x*r.y;e.localCOMx+=(r.x+a.x)*p,e.localCOMy+=(r.y+a.y)*p,l=r,r=a,i=i.next}i=e.lverts.next;var s=i;t+=r.x*(s.y-l.y);var o=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*o,e.localCOMy+=(r.y+s.y)*o,l=r,r=s,i=i.next;var h=i;t+=r.x*(h.y-l.y);var _=h.y*r.x-h.x*r.y;e.localCOMx+=(r.x+h.x)*_,e.localCOMy+=(r.y+h.y)*_,t=1/(3*t);var u=t;e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var d=n.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var c=n.radius,x=n.radius;n.aabb.minx=n.worldCOMx-c,n.aabb.miny=n.worldCOMy-x,n.aabb.maxx=n.worldCOMx+c,n.aabb.maxy=n.worldCOMy+x}else{var v=this.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var z=v.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot));for(var y=v.lverts.next,f=v.gverts.next;null!=f;){var m=f,b=y;y=y.next,m.x=v.body.posx+(v.body.axisy*b.x-v.body.axisx*b.y),m.y=v.body.posy+(b.x*v.body.axisx+b.y*v.body.axisy),f=f.next}}var g=v.gverts.next;v.aabb.minx=g.x,v.aabb.miny=g.y,v.aabb.maxx=g.x,v.aabb.maxy=g.y;for(var w=v.gverts.next.next;null!=w;){var C=w;v.aabb.minx>C.x&&(v.aabb.minx=C.x),C.x>v.aabb.maxx&&(v.aabb.maxx=C.x),v.aabb.miny>C.y&&(v.aabb.miny=C.y),C.y>v.aabb.maxy&&(v.aabb.maxy=C.y),w=w.next}}},force_validate_aabb:function(){if(this.type==ye.id_ShapeType_CIRCLE){var n=this.circle;n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy),n.aabb.minx=n.worldCOMx-n.radius,n.aabb.miny=n.worldCOMy-n.radius,n.aabb.maxx=n.worldCOMx+n.radius,n.aabb.maxy=n.worldCOMy+n.radius}else{var e=this.polygon,t=e.lverts.next,i=e.gverts.next,l=t;t=t.next,i.x=e.body.posx+(e.body.axisy*l.x-e.body.axisx*l.y),i.y=e.body.posy+(l.x*e.body.axisx+l.y*e.body.axisy),e.aabb.minx=i.x,e.aabb.miny=i.y,e.aabb.maxx=i.x,e.aabb.maxy=i.y;for(var r=e.gverts.next.next;null!=r;){var a=r,p=t;t=t.next,a.x=e.body.posx+(e.body.axisy*p.x-e.body.axisx*p.y),a.y=e.body.posy+(p.x*e.body.axisx+p.y*e.body.axisy),e.aabb.minx>a.x&&(e.aabb.minx=a.x),a.x>e.aabb.maxx&&(e.aabb.maxx=a.x),e.aabb.miny>a.y&&(e.aabb.miny=a.y),a.y>e.aabb.maxy&&(e.aabb.maxy=a.y),r=r.next}}},invalidate_aabb:function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},validate_area_inertia:function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,this.type==ye.id_ShapeType_CIRCLE?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)&&(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,this.type==ye.id_ShapeType_CIRCLE?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},validate_localCOM:function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t;e+=l.x*(r.y-i.y);var a=r.y*l.x-r.x*l.y;n.localCOMx+=(l.x+r.x)*a,n.localCOMy+=(l.y+r.y)*a,i=l,l=r,t=t.next}t=n.lverts.next;var p=t;e+=l.x*(p.y-i.y);var s=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*s,n.localCOMy+=(l.y+p.y)*s,i=l,l=p,t=t.next;var o=t;e+=l.x*(o.y-i.y);var h=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*h,n.localCOMy+=(l.y+o.y)*h,e=1/(3*e);var _=e;n.localCOMx*=_,n.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},validate_worldCOM:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t;e+=l.x*(r.y-i.y);var a=r.y*l.x-r.x*l.y;n.localCOMx+=(l.x+r.x)*a,n.localCOMy+=(l.y+r.y)*a,i=l,l=r,t=t.next}t=n.lverts.next;var p=t;e+=l.x*(p.y-i.y);var s=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*s,n.localCOMy+=(l.y+p.y)*s,i=l,l=p,t=t.next;var o=t;e+=l.x*(o.y-i.y);var h=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*h,n.localCOMy+=(l.y+o.y)*h,e=1/(3*e);var _=e;n.localCOMx*=_,n.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},getworldCOM:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t;e+=l.x*(r.y-i.y);var a=r.y*l.x-r.x*l.y;n.localCOMx+=(l.x+r.x)*a,n.localCOMy+=(l.y+r.y)*a,i=l,l=r,t=t.next}t=n.lverts.next;var p=t;e+=l.x*(p.y-i.y);var s=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*s,n.localCOMy+=(l.y+p.y)*s,i=l,l=p,t=t.next;var o=t;e+=l.x*(o.y-i.y);var h=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*h,n.localCOMy+=(l.y+o.y)*h,e=1/(3*e);var _=e;n.localCOMx*=_,n.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},invalidate_area_inertia:function(){if(this.zip_area_inertia=!0,null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){if(this.zip_localCOM=!0,this.invalidate_area_inertia(),this.type==ye.id_ShapeType_CIRCLE&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0}},invalidate_worldCOM:function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},invalidate_material:function(n){if(0!=(n&At.WAKE)&&this.wake(),0!=(n&At.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(n&At.PROPS)&&null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}0!=(n&At.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},invalidate_fluidprops:function(){this.fluidEnabled&&this.wake()},aabb_validate:function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,this.type==ye.id_ShapeType_CIRCLE){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,l=i;i=i.next;var r=i;for(i=i.next;null!=i;){var a=i;t+=r.x*(a.y-l.y);var p=a.y*r.x-a.x*r.y;e.localCOMx+=(r.x+a.x)*p,e.localCOMy+=(r.y+a.y)*p,l=r,r=a,i=i.next}i=e.lverts.next;var s=i;t+=r.x*(s.y-l.y);var o=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*o,e.localCOMy+=(r.y+s.y)*o,l=r,r=s,i=i.next;var h=i;t+=r.x*(h.y-l.y);var _=h.y*r.x-h.x*r.y;e.localCOMx+=(r.x+h.x)*_,e.localCOMy+=(r.y+h.y)*_,t=1/(3*t);var u=t;e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var d=n.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var c=n.radius,x=n.radius;n.aabb.minx=n.worldCOMx-c,n.aabb.miny=n.worldCOMy-x,n.aabb.maxx=n.worldCOMx+c,n.aabb.maxy=n.worldCOMy+x}else{var v=this.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var z=v.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot));for(var y=v.lverts.next,f=v.gverts.next;null!=f;){var m=f,b=y;y=y.next,m.x=v.body.posx+(v.body.axisy*b.x-v.body.axisx*b.y),m.y=v.body.posy+(b.x*v.body.axisx+b.y*v.body.axisy),f=f.next}}var g=v.gverts.next;v.aabb.minx=g.x,v.aabb.miny=g.y,v.aabb.maxx=g.x,v.aabb.maxy=g.y;for(var w=v.gverts.next.next;null!=w;){var C=w;v.aabb.minx>C.x&&(v.aabb.minx=C.x),C.x>v.aabb.maxx&&(v.aabb.maxx=C.x),v.aabb.miny>C.y&&(v.aabb.miny=C.y),C.y>v.aabb.maxy&&(v.aabb.maxy=C.y),w=w.next}}},setMaterial:function(n){this.material!=n&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(n){this.filter!=n&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake())},setFluid:function(n){this.fluidProperties!=n&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.fluidEnabled&&this.wake())},__immutable_midstep:function(n){},addedToBody:function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},copy:function(){var n=null;n=this.type==ye.id_ShapeType_CIRCLE?this.circle.__copy():this.polygon.__copy(),this.zip_area_inertia?n.invalidate_area_inertia():(n.area=this.area,n.inertia=this.inertia),this.zip_sweepRadius?n.zip_sweepRadius=!0:(n.sweepRadius=this.sweepRadius,n.sweepCoef=this.sweepCoef),this.zip_angDrag?n.invalidate_angDrag():n.angDrag=this.angDrag,this.zip_aabb?(n.zip_aabb=!0,null!=n.body&&(n.body.zip_aabb=!0)):(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy);var e=n.material;e.outer=null,e.next=At.zpp_pool,At.zpp_pool=e;var t=n.filter;return t.outer=null,t.next=Ge.zpp_pool,Ge.zpp_pool=t,n.material=this.material,n.filter=this.filter,null!=this.fluidProperties&&(n.fluidProperties=this.fluidProperties),n.fluidEnabled=this.fluidEnabled,n.sensorEnabled=this.sensorEnabled,null!=this.userData&&(n.userData=o.copy(this.userData)),this.copyto(n.outer),n.outer},__class__:Et});var It=function(){this.radius=0,this.outer_zn=null,Et.call(this,ye.id_ShapeType_CIRCLE),this.circle=this,this.zip_localCOM=!1};l["zpp_nape.shape.ZPP_Circle"]=It,It.__name__=["zpp_nape","shape","ZPP_Circle"],It.__super__=Et,It.prototype=e(Et.prototype,{outer_zn:null,radius:null,__clear:function(){},invalidate_radius:function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},localCOM_validate:function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},localCOM_invalidate:function(n){this.localCOMx=n.x,this.localCOMy=n.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},localCOM_immutable:function(){},setupLocalCOM:function(){var n,e=this.localCOMx,i=this.localCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=t(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=t(this,this.localCOM_invalidate),this.wrap_localCOM.zpp_inner._isimmutable=t(this,this.localCOM_immutable)},__validate_aabb:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t;e+=l.x*(r.y-i.y);var a=r.y*l.x-r.x*l.y;n.localCOMx+=(l.x+r.x)*a,n.localCOMy+=(l.y+r.y)*a,i=l,l=r,t=t.next}t=n.lverts.next;var p=t;e+=l.x*(p.y-i.y);var s=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*s,n.localCOMy+=(l.y+p.y)*s,i=l,l=p,t=t.next;var o=t;e+=l.x*(o.y-i.y);var h=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*h,n.localCOMy+=(l.y+o.y)*h,e=1/(3*e);var _=e;n.localCOMx*=_,n.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}var d=this.radius,c=this.radius;this.aabb.minx=this.worldCOMx-d,this.aabb.miny=this.worldCOMy-c,this.aabb.maxx=this.worldCOMx+d,this.aabb.maxy=this.worldCOMy+c},_force_validate_aabb:function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var n=this.radius*this.radius;this.area=n*Math.PI,this.inertia=.5*n+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},__validate_angDrag:function(){var n=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,e=this.radius*this.radius;this.angDrag=(n+2*e)*(this.material.dynamicFriction*f.fluidAngularDragFriction)+.5*f.fluidAngularDrag*(1+f.fluidVacuumDrag)*n,this.angDrag/=2*(n+.5*e)},__scale:function(n,e){var t=((0>n?-n:n)+(0>e?-e:e))/2;this.radius*=0>t?-t:t,this.invalidate_radius(),this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0&&(this.localCOMx*=n,this.localCOMy*=e,this.invalidate_localCOM())},__translate:function(n,e){this.localCOMx+=1*n,this.localCOMy+=1*e,this.invalidate_localCOM()},__rotate:function(n,e){if(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0){var t=0,i=0;t=e*this.localCOMx-n*this.localCOMy,i=this.localCOMx*n+this.localCOMy*e,this.localCOMx=t,this.localCOMy=i,this.invalidate_localCOM()}},__transform:function(n){var e=n.zpp_inner.a*n.zpp_inner.d-n.zpp_inner.b*n.zpp_inner.c;0>e&&(e=-e),this.radius*=Math.sqrt(e);var t=n.zpp_inner.a*this.localCOMx+n.zpp_inner.b*this.localCOMy+n.zpp_inner.tx;this.localCOMy=n.zpp_inner.c*this.localCOMx+n.zpp_inner.d*this.localCOMy+n.zpp_inner.ty,this.localCOMx=t,this.invalidate_radius(),this.invalidate_localCOM()},__copy:function(){var n=new Xn(this.radius).zpp_inner_zn;return n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy,n.zip_localCOM=!1,n},__class__:It});var Vt=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};l["zpp_nape.shape.ZPP_Edge"]=Vt,Vt.__name__=["zpp_nape","shape","ZPP_Edge"],Vt.prototype={next:null,free:function(){this.polygon=null},alloc:function(){},polygon:null,outer:null,wrapper:function(){return null==this.outer&&(Vt.internal=!0,this.outer=new Hn,Vt.internal=!1,this.outer.zpp_inner=this),this.outer},lnormx:null,lnormy:null,wrap_lnorm:null,gnormx:null,gnormy:null,wrap_gnorm:null,length:null,lprojection:null,gprojection:null,lp0:null,gp0:null,lp1:null,gp1:null,tp0:null,tp1:null,lnorm_validate:function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},gnorm_validate:function(){var n=this.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,l=n.gverts.next;null!=l;){var r=l,a=i;i=i.next,r.x=n.body.posx+(n.body.axisy*a.x-n.body.axisx*a.y),r.y=n.body.posy+(a.x*n.body.axisx+a.y*n.body.axisy),l=l.next}}var p=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var h=s,_=p.elt;p=p.next,_.gp0=o,_.gp1=h,_.gnormx=n.body.axisy*_.lnormx-n.body.axisx*_.lnormy,_.gnormy=_.lnormx*n.body.axisx+_.lnormy*n.body.axisy,_.gprojection=n.body.posx*_.gnormx+n.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,o=h,s=s.next}var u=n.gverts.next,d=p.elt;p=p.next,d.gp0=o,d.gp1=u,d.gnormx=n.body.axisy*d.lnormx-n.body.axisx*d.lnormy,d.gnormy=d.lnormx*n.body.axisx+d.lnormy*n.body.axisy,d.gprojection=n.body.posx*d.gnormx+n.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},getlnorm:function(){var n,e=this.lnormx,i=this.lnormy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_lnorm=n,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=t(this,this.lnorm_validate)},getgnorm:function(){var n,e=this.gnormx,i=this.gnormy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gnorm=n,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=t(this,this.gnorm_validate)},__class__:Vt};var Lt=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,Et.call(this,ye.id_ShapeType_POLYGON),this.polygon=this,this.lverts=new Ct,this.gverts=new Ct,this.edges=new ci,this.edgeCnt=0};l["zpp_nape.shape.ZPP_Polygon"]=Lt,Lt.__name__=["zpp_nape","shape","ZPP_Polygon"],Lt.__super__=Et,Lt.prototype=e(Et.prototype,{outer_zn:null,lverts:null,wrap_lverts:null,gverts:null,wrap_gverts:null,edges:null,wrap_edges:null,edgeCnt:null,reverse_flag:null,__clear:function(){},lverts_pa_invalidate:function(n){this.invalidate_lverts()},lverts_pa_immutable:function(){},gverts_pa_validate:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,l=e;e=e.next,i.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),i.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),t=t.next}}},lverts_post_adder:function(n){n.zpp_inner._invalidate=t(this,this.lverts_pa_invalidate),n.zpp_inner._isimmutable=t(this,this.lverts_pa_immutable);for(var e=null,i=null,l=this.lverts.next;null!=l;){if(l==n.zpp_inner)break;e=null==e?this.gverts.next:e.next,i=null==i?this.edges.head:i.next,l=l.next}var r;null==Ct.zpp_pool?r=new Ct:(r=Ct.zpp_pool,Ct.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!0,r.x=0,r.y=0;var a=r;if(this.gverts.insert(e,a),null!=this.lverts.next.next)if(null==this.lverts.next.next.next){var p;null==Vt.zpp_pool?p=new Vt:(p=Vt.zpp_pool,Vt.zpp_pool=p.next,p.next=null),p.polygon=this,this.edges.add(p);var s;null==Vt.zpp_pool?s=new Vt:(s=Vt.zpp_pool,Vt.zpp_pool=s.next,s.next=null),s.polygon=this,this.edges.add(s),this.edgeCnt+=2}else{var o;null==Vt.zpp_pool?o=new Vt:(o=Vt.zpp_pool,Vt.zpp_pool=o.next,o.next=null),o.polygon=this,this.edges.insert(i,o),this.edgeCnt++}a._validate=t(this,this.gverts_pa_validate)},lverts_subber:function(n){this.cleanup_lvert(n.zpp_inner)},lverts_invalidate:function(n){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},lverts_modifiable:function(){this.immutable_midstep("Polygon::localVerts")},gverts_validate:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,l=e;e=e.next,i.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),i.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),t=t.next}}},edges_validate:function(){this.validate_lverts()},getlverts:function(){this.wrap_lverts=pl.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=t(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=t(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=t(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=t(this,this.lverts_validate),this.wrap_lverts.zpp_inner._modifiable=t(this,this.lverts_modifiable),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},getgverts:function(){this.wrap_gverts=pl.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=t(this,this.gverts_validate)},getedges:function(){this.wrap_edges=yl.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=t(this,this.edges_validate)},zip_lverts:null,invalidate_lverts:function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},zip_laxi:null,invalidate_laxi:function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},zip_gverts:null,invalidate_gverts:function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},zip_gaxi:null,invalidate_gaxi:function(){this.zip_gaxi=!0},zip_valid:null,validation:null,valid:function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),3>this.lverts.length)return null==ye.ValidationResult_DEGENERATE&&(ye.internal=!0,ye.ValidationResult_DEGENERATE=new te,ye.internal=!1),this.validation=ye.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),f.epsilon>this.area)return null==ye.ValidationResult_DEGENERATE&&(ye.internal=!0,ye.ValidationResult_DEGENERATE=new te,ye.internal=!1),this.validation=ye.ValidationResult_DEGENERATE;var n=!1,e=!1,t=!0,i=this.lverts.next,l=i;i=i.next;var r=i;for(i=i.next;null!=i;){var a=i,p=0,s=0;p=a.x-r.x,s=a.y-r.y;var o=0,h=0;o=r.x-l.x,h=r.y-l.y;var _=h*p-o*s;if(_>f.epsilon?e=!0:-f.epsilon>_&&(n=!0),e&&n){t=!1;break}l=r,r=a,i=i.next}if(t){i=this.lverts.next;for(var u=i;;){var d=0,c=0;d=u.x-r.x,c=u.y-r.y;var x=0,v=0;x=r.x-l.x,v=r.y-l.y;var z=v*d-x*c;if(z>f.epsilon?e=!0:-f.epsilon>z&&(n=!0),e&&n){t=!1;break}break}if(t){l=r,r=u,i=i.next;for(var y=i;;){var m=0,b=0;m=y.x-r.x,b=y.y-r.y;var g=0,w=0;g=r.x-l.x,w=r.y-l.y;var C=w*m-g*b;if(C>f.epsilon?e=!0:-f.epsilon>C&&(n=!0),e&&n)break;break}}}if(e&&n)return null==ye.ValidationResult_CONCAVE&&(ye.internal=!0,ye.ValidationResult_CONCAVE=new te,ye.internal=!1),this.validation=ye.ValidationResult_CONCAVE;var M=!0,k=!0,O=this.lverts.next,S=O;for(O=O.next;null!=O;){var P=O;if(!M){k=!1;break}var T=!0,A=this.lverts.next,E=A;for(A=A.next;null!=A;){var I=A;if(S!=E&&S!=I&&P!=E&&P!=I){var V=0,L=0;V=S.x-E.x,L=S.y-E.y;var N=0,D=0;N=P.x-S.x,D=P.y-S.y;var j=0,F=0;j=I.x-E.x,F=I.y-E.y;var B=D*j-N*F;if(B*B>f.epsilon){B=1/B;var R=(F*V-j*L)*B;if(R>f.epsilon&&1-f.epsilon>R){var G=(D*V-N*L)*B;if(G>f.epsilon&&1-f.epsilon>G){M=!1,T=!1;break}}}E=I,A=A.next}else E=I,A=A.next}if(T)for(;;){var Y=this.lverts.next;if(S==E||S==Y||P==E||P==Y)break;var U=0,Z=0;U=S.x-E.x,Z=S.y-E.y;var q=0,W=0;q=P.x-S.x,W=P.y-S.y;var X=0,H=0;X=Y.x-E.x,H=Y.y-E.y;var K=W*X-q*H;if(K*K>f.epsilon){K=1/K;var J=(H*U-X*Z)*K;if(J>f.epsilon&&1-f.epsilon>J){var Q=(W*U-q*Z)*K;if(Q>f.epsilon&&1-f.epsilon>Q){M=!1;break}}}break}S=P,O=O.next}if(k)for(;;){var $=this.lverts.next;if(!M)break;var nn=!0,en=this.lverts.next,tn=en;for(en=en.next;null!=en;){var ln=en;if(S!=tn&&S!=ln&&$!=tn&&$!=ln){var rn=0,an=0;rn=S.x-tn.x,an=S.y-tn.y;var pn=0,sn=0;pn=$.x-S.x,sn=$.y-S.y;var on=0,hn=0;on=ln.x-tn.x,hn=ln.y-tn.y;var _n=sn*on-pn*hn;if(_n*_n>f.epsilon){_n=1/_n;var un=(hn*rn-on*an)*_n;if(un>f.epsilon&&1-f.epsilon>un){var dn=(sn*rn-pn*an)*_n;if(dn>f.epsilon&&1-f.epsilon>dn){M=!1,nn=!1;break}}}tn=ln,en=en.next}else tn=ln,en=en.next}if(nn)for(;;){var cn=this.lverts.next;if(S==tn||S==cn||$==tn||$==cn)break;var xn=0,vn=0;xn=S.x-tn.x,vn=S.y-tn.y;var zn=0,yn=0;zn=$.x-S.x,yn=$.y-S.y;var fn=0,mn=0;fn=cn.x-tn.x,mn=cn.y-tn.y;var bn=yn*fn-zn*mn;if(bn*bn>f.epsilon){bn=1/bn;var gn=(mn*xn-fn*vn)*bn;if(gn>f.epsilon&&1-f.epsilon>gn){var wn=(yn*xn-zn*vn)*bn;if(wn>f.epsilon&&1-f.epsilon>wn){M=!1;break}}}break}break}return M?(null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1),this.validation=ye.ValidationResult_VALID):(null==ye.ValidationResult_SELF_INTERSECTING&&(ye.internal=!0,ye.ValidationResult_SELF_INTERSECTING=new te,ye.internal=!1),this.validation=ye.ValidationResult_SELF_INTERSECTING)}return this.validation},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,this.lverts.length>2&&(this.validate_area_inertia(),0>this.area&&(this.reverse_vertices(),this.area=-this.area)))},cleanup_lvert:function(n){for(var e=null,t=null,i=this.lverts.next;null!=i;){if(i==n)break;e=null==e?this.gverts.next:e.next,t=null==t?this.edges.head:t.next,i=i.next}var l=null==e?this.gverts.next:e.next;this.gverts.erase(e);var r=l;if(null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Ct.zpp_pool,Ct.zpp_pool=r,2==this.edgeCnt){var a=this.edges.pop_unsafe(),p=a;p.polygon=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,a=this.edges.pop_unsafe();var s=a;s.polygon=null,s.next=Vt.zpp_pool,Vt.zpp_pool=s,this.edgeCnt=0}else if(0!=this.edgeCnt){var o=null==t?this.edges.head.elt:t.next.elt;this.edges.erase(t);var h=o;h.polygon=null,h.next=Vt.zpp_pool,Vt.zpp_pool=h,this.edgeCnt--}},zip_sanitation:null,splice_collinear:function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},splice_collinear_real:function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var n=null,e=this.lverts.next;null!=e;){var t=null==e.next?this.lverts.next:e.next,i=e,l=t,r=0,a=0;r=i.x-l.x,a=i.y-l.y,f.epsilon*f.epsilon>r*r+a*a?(this.cleanup_lvert(e),e=this.lverts.erase(n)):(n=e,e=e.next)}if(null!=this.lverts.next)for(var p;;){p=!1;for(var s=this.lverts.next;null!=s;){var o=null==s.next?this.lverts.next:s.next,h=null==o.next?this.lverts.next:o.next,_=s,u=o,d=h,c=0,x=0;c=u.x-_.x,x=u.y-_.y;var v=0,z=0;v=d.x-u.x,z=d.y-u.y;var y=z*c-v*x;f.epsilon*f.epsilon>y*y?(this.cleanup_lvert(o),this.lverts.erase(null==s.next?null:s),p=!0,s=s.next):s=s.next}if(!p)break}}},reverse_vertices:function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();var n=this.edges.head,e=this.lverts.next,t=e;for(e=e.next;null!=e;){var i=e,l=n.elt;n=n.next,l.lp0=t,l.lp1=i;var r=0,a=0;r=t.x-i.x,a=t.y-i.y;var p=Math.sqrt(r*r+a*a);l.length=p;var s=1/p;r*=s,a*=s;var o=r;r=-a,a=o,l.lprojection=r*t.x+a*t.y,l.lnormx=r,l.lnormy=a,null!=l.wrap_lnorm&&(l.wrap_lnorm.zpp_inner.x=r,l.wrap_lnorm.zpp_inner.y=a),t=i,e=e.next}var h=this.lverts.next,_=n.elt;n=n.next,_.lp0=t,_.lp1=h;var u=0,d=0;u=t.x-h.x,d=t.y-h.y;var c=Math.sqrt(u*u+d*d);_.length=c;var x=1/c;u*=x,d*=x;var v=u;u=-d,d=v,_.lprojection=u*t.x+d*t.y,_.lnormx=u,_.lnormy=d,null!=_.wrap_lnorm&&(_.wrap_lnorm.zpp_inner.x=u,_.wrap_lnorm.zpp_inner.y=d)}},validate_gverts:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,l=e;e=e.next,i.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),i.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),t=t.next}}},validate_gaxi:function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var n=this.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,i=this.gverts.next;null!=i;){var l=i,r=t;t=t.next,l.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),l.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),i=i.next}}var a=this.edges.head,p=this.gverts.next,s=p;for(p=p.next;null!=p;){var o=p,h=a.elt;a=a.next,h.gp0=s,h.gp1=o,h.gnormx=this.body.axisy*h.lnormx-this.body.axisx*h.lnormy,h.gnormy=h.lnormx*this.body.axisx+h.lnormy*this.body.axisy,h.gprojection=this.body.posx*h.gnormx+this.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=o,p=p.next}var _=this.gverts.next,u=a.elt;a=a.next,u.gp0=s,u.gp1=_,u.gnormx=this.body.axisy*u.lnormx-this.body.axisx*u.lnormy,u.gnormy=u.lnormx*this.body.axisx+u.lnormy*this.body.axisy,u.gprojection=this.body.posx*u.gnormx+this.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}},__validate_aabb:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,l=e;e=e.next,i.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),i.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),t=t.next}}var r=this.gverts.next;this.aabb.minx=r.x,this.aabb.miny=r.y,this.aabb.maxx=r.x,this.aabb.maxy=r.y;for(var a=this.gverts.next.next;null!=a;){var p=a;this.aabb.minx>p.x&&(this.aabb.minx=p.x),p.x>this.aabb.maxx&&(this.aabb.maxx=p.x),this.aabb.miny>p.y&&(this.aabb.miny=p.y),p.y>this.aabb.maxy&&(this.aabb.maxy=p.y),a=a.next}},_force_validate_aabb:function(){var n=this.lverts.next,e=this.gverts.next,t=n;n=n.next,e.x=this.body.posx+(this.body.axisy*t.x-this.body.axisx*t.y),e.y=this.body.posy+(t.x*this.body.axisx+t.y*this.body.axisy),this.aabb.minx=e.x,this.aabb.miny=e.y,this.aabb.maxx=e.x,this.aabb.maxy=e.y;for(var i=this.gverts.next.next;null!=i;){var l=i,r=n;n=n.next,l.x=this.body.posx+(this.body.axisy*r.x-this.body.axisx*r.y),l.y=this.body.posy+(r.x*this.body.axisx+r.y*this.body.axisy),this.aabb.minx>l.x&&(this.aabb.minx=l.x),l.x>this.aabb.maxx&&(this.aabb.maxx=l.x),this.aabb.miny>l.y&&(this.aabb.miny=l.y),l.y>this.aabb.maxy&&(this.aabb.maxy=l.y),i=i.next}},__validate_sweepRadius:function(){var n=0,e=0;this.validate_laxi();for(var t=this.lverts.next;null!=t;){var i=t,l=i.x*i.x+i.y*i.y;l>n&&(n=l),t=t.next}for(var r=this.edges.head;null!=r;){var a=r.elt;if(e>a.lprojection&&0>(e=a.lprojection))break;r=r.next}0>e&&(e=0),this.sweepRadius=Math.sqrt(n),this.sweepCoef=this.sweepRadius-e},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{this.area=0;var n=0,e=0,t=this.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t,a=l.y*i.x-l.x*i.y;n+=a*(l.x*l.x+l.y*l.y+(l.x*i.x+l.y*i.y)+(i.x*i.x+i.y*i.y)),e+=a,this.area+=l.x*(r.y-i.y),i=l,l=r,t=t.next}t=this.lverts.next;var p=t,s=l.y*i.x-l.x*i.y;n+=s*(l.x*l.x+l.y*l.y+(l.x*i.x+l.y*i.y)+(i.x*i.x+i.y*i.y)),e+=s,this.area+=l.x*(p.y-i.y),i=l,l=p,t=t.next;var o=t,h=l.y*i.x-l.x*i.y;n+=h*(l.x*l.x+l.y*l.y+(l.x*i.x+l.y*i.y)+(i.x*i.x+i.y*i.y)),e+=h,this.area+=l.x*(o.y-i.y),this.inertia=n/(6*e),this.area*=.5,0>this.area&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){this.validate_area_inertia(),this.validate_laxi();for(var n=0,e=this.edges.head,t=0,i=this.lverts.next,l=i,r=i.next;null!=r;){var a=r,p=e.elt;e=e.next,t+=p.length;var s=0,o=0;s=a.x-l.x,o=a.y-l.y,n+=p.length*f.fluidAngularDragFriction*this.material.dynamicFriction*p.lprojection*p.lprojection;var h=-(l.y*p.lnormx-l.x*p.lnormy)/(o*p.lnormx-s*p.lnormy);if(h>0){var _=h>1?1:h,u=0,d=0;u=l.x,d=l.y;var c=_;u+=s*c,d+=o*c;var x=p.lnormy*l.x-p.lnormx*l.y,v=p.lnormy*u-p.lnormx*d;n+=(v*v*v-x*x*x)/(3*(v-x))*_*p.length*f.fluidAngularDrag}if(1>h){var z=0>h?0:h,y=0,m=0;y=l.x,m=l.y;var b=z;y+=s*b,m+=o*b;var g=p.lnormy*y-p.lnormx*m,w=p.lnormy*a.x-p.lnormx*a.y;n+=(w*w*w-g*g*g)/(3*(w-g))*f.fluidVacuumDrag*(1-z)*p.length*f.fluidAngularDrag}i=r,l=a,r=r.next}for(;;){r=this.lverts.next;var C=r,M=e.elt;e=e.next,t+=M.length;var k=0,O=0;k=C.x-l.x,O=C.y-l.y,n+=M.length*f.fluidAngularDragFriction*this.material.dynamicFriction*M.lprojection*M.lprojection;var S=-(l.y*M.lnormx-l.x*M.lnormy)/(O*M.lnormx-k*M.lnormy);if(S>0){var P=S>1?1:S,T=0,A=0;T=l.x,A=l.y;var E=P;T+=k*E,A+=O*E;var I=M.lnormy*l.x-M.lnormx*l.y,V=M.lnormy*T-M.lnormx*A;n+=(V*V*V-I*I*I)/(3*(V-I))*P*M.length*f.fluidAngularDrag}if(1>S){var L=0>S?0:S,N=0,D=0;N=l.x,D=l.y;var j=L;N+=k*j,D+=O*j;var F=M.lnormy*N-M.lnormx*D,B=M.lnormy*C.x-M.lnormx*C.y;n+=(B*B*B-F*F*F)/(3*(B-F))*f.fluidVacuumDrag*(1-L)*M.length*f.fluidAngularDrag}break}this.angDrag=n/(this.inertia*t)},__validate_localCOM:function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next){this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y;this.localCOMx*=.5,this.localCOMy*=.5}else{this.localCOMx=0,this.localCOMy=0;var n=0,e=this.lverts.next,t=e;e=e.next;var i=e;for(e=e.next;null!=e;){var l=e;n+=i.x*(l.y-t.y);var r=l.y*i.x-l.x*i.y;this.localCOMx+=(i.x+l.x)*r,this.localCOMy+=(i.y+l.y)*r,t=i,i=l,e=e.next}e=this.lverts.next;var a=e;n+=i.x*(a.y-t.y);var p=a.y*i.x-a.x*i.y;this.localCOMx+=(i.x+a.x)*p,this.localCOMy+=(i.y+a.y)*p,t=i,i=a,e=e.next;var s=e;n+=i.x*(s.y-t.y);var o=s.y*i.x-s.x*i.y;this.localCOMx+=(i.x+s.x)*o,this.localCOMy+=(i.y+s.y)*o,n=1/(3*n);var h=n;this.localCOMx*=h,this.localCOMy*=h}},localCOM_validate:function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t;t=t.next;var l=t;for(t=t.next;null!=t;){var r=t;e+=l.x*(r.y-i.y);var a=r.y*l.x-r.x*l.y;n.localCOMx+=(l.x+r.x)*a,n.localCOMy+=(l.y+r.y)*a,i=l,l=r,t=t.next}t=n.lverts.next;var p=t;e+=l.x*(p.y-i.y);var s=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*s,n.localCOMy+=(l.y+p.y)*s,i=l,l=p,t=t.next;var o=t;e+=l.x*(o.y-i.y);var h=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*h,n.localCOMy+=(l.y+o.y)*h,e=1/(3*e);var _=e;n.localCOMx*=_,n.localCOMy*=_}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},localCOM_invalidate:function(n){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==ye.id_ShapeType_POLYGON){var e=this.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,l=i;i=i.next;var r=i;for(i=i.next;null!=i;){var a=i;t+=r.x*(a.y-l.y);var p=a.y*r.x-a.x*r.y;e.localCOMx+=(r.x+a.x)*p,e.localCOMy+=(r.y+a.y)*p,l=r,r=a,i=i.next}i=e.lverts.next;var s=i;t+=r.x*(s.y-l.y);var o=s.y*r.x-s.x*r.y;e.localCOMx+=(r.x+s.x)*o,e.localCOMy+=(r.y+s.y)*o,l=r,r=s,i=i.next;var h=i;t+=r.x*(h.y-l.y);var _=h.y*r.x-h.x*r.y;e.localCOMx+=(r.x+h.x)*_,e.localCOMy+=(r.y+h.y)*_,t=1/(3*t);var u=t;e.localCOMx*=u,e.localCOMy*=u}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var d=0,c=0;d=n.x-this.localCOMx,c=n.y-this.localCOMy;for(var x=this.lverts.next;null!=x;){var v=x;v.x+=1*d,v.y+=1*c,x=x.next}this.invalidate_lverts()},setupLocalCOM:function(){var n,e=this.localCOMx,i=this.localCOMy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=t(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=t(this,this.localCOM_invalidate)},__translate:function(n,e){for(var t=this.lverts.next;null!=t;){var i=t;i.x+=1*n,i.y+=1*e,t=t.next}this.invalidate_lverts()},__scale:function(n,e){for(var t=this.lverts.next;null!=t;){var i=t;i.x*=n,i.y*=e,t=t.next}this.invalidate_lverts()},__rotate:function(n,e){for(var t=this.lverts.next;null!=t;){var i=t,l=0,r=0;l=e*i.x-n*i.y,r=i.x*n+i.y*e,i.x=l,i.y=r,t=t.next}this.invalidate_lverts()},__transform:function(n){for(var e=this.lverts.next;null!=e;){var t=e,i=n.zpp_inner.a*t.x+n.zpp_inner.b*t.y+n.zpp_inner.tx;t.y=n.zpp_inner.c*t.x+n.zpp_inner.d*t.y+n.zpp_inner.ty,t.x=i,e=e.next}this.invalidate_lverts()},__copy:function(){var n=this.outer_zn;return null==n.zpp_inner_zn.wrap_lverts&&n.zpp_inner_zn.getlverts(),new Qn(n.zpp_inner_zn.wrap_lverts).zpp_inner_zn},__class__:Lt});var Nt=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};l["zpp_nape.space.ZPP_Broadphase"]=Nt,Nt.__name__=["zpp_nape","space","ZPP_Broadphase"],Nt.prototype={space:null,is_sweep:null,sweep:null,dynab:null,insert:function(n){this.is_sweep?this.sweep.__insert(n):this.dynab.__insert(n)},remove:function(n){this.is_sweep?this.sweep.__remove(n):this.dynab.__remove(n)},sync:function(n){if(this.is_sweep){if(!this.sweep.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==ye.id_ShapeType_POLYGON){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var i=0,l=t.lverts.next,r=l;l=l.next;var a=l;for(l=l.next;null!=l;){var p=l;i+=a.x*(p.y-r.y);var s=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*s,t.localCOMy+=(a.y+p.y)*s,r=a,a=p,l=l.next}l=t.lverts.next;var o=l;i+=a.x*(o.y-r.y);var h=o.y*a.x-o.x*a.y;t.localCOMx+=(a.x+o.x)*h,t.localCOMy+=(a.y+o.y)*h,r=a,a=o,l=l.next;var _=l;i+=a.x*(_.y-r.y);var u=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*u,t.localCOMy+=(a.y+_.y)*u,i=1/(3*i);var d=i;t.localCOMx*=d,t.localCOMy*=d}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var c=e.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var x=e.radius,v=e.radius;e.aabb.minx=e.worldCOMx-x,e.aabb.miny=e.worldCOMy-v,e.aabb.maxx=e.worldCOMx+x,e.aabb.maxy=e.worldCOMy+v}else{var z=n.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var y=z.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=z.lverts.next,m=z.gverts.next;null!=m;){var b=m,g=f;f=f.next,b.x=z.body.posx+(z.body.axisy*g.x-z.body.axisx*g.y),b.y=z.body.posy+(g.x*z.body.axisx+g.y*z.body.axisy),m=m.next}}var w=z.gverts.next;z.aabb.minx=w.x,z.aabb.miny=w.y,z.aabb.maxx=w.x,z.aabb.maxy=w.y;for(var C=z.gverts.next.next;null!=C;){var M=C;z.aabb.minx>M.x&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),z.aabb.miny>M.y&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),C=C.next}}}else{var k=this.dynab,O=n.node;if(!O.synced){if(!k.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var S=n.circle;if(S.zip_worldCOM&&null!=S.body){if(S.zip_worldCOM=!1,S.zip_localCOM){if(S.zip_localCOM=!1,S.type==ye.id_ShapeType_POLYGON){var P=S.polygon;if(null==P.lverts.next.next)P.localCOMx=P.lverts.next.x,P.localCOMy=P.lverts.next.y;else if(null==P.lverts.next.next.next){P.localCOMx=P.lverts.next.x,P.localCOMy=P.lverts.next.y;P.localCOMx+=1*P.lverts.next.next.x,P.localCOMy+=1*P.lverts.next.next.y;P.localCOMx*=.5,P.localCOMy*=.5}else{P.localCOMx=0,P.localCOMy=0;var T=0,A=P.lverts.next,E=A;A=A.next;var I=A;for(A=A.next;null!=A;){var V=A;T+=I.x*(V.y-E.y);var L=V.y*I.x-V.x*I.y;P.localCOMx+=(I.x+V.x)*L,P.localCOMy+=(I.y+V.y)*L,E=I,I=V,A=A.next}A=P.lverts.next;var N=A;T+=I.x*(N.y-E.y);var D=N.y*I.x-N.x*I.y;P.localCOMx+=(I.x+N.x)*D,P.localCOMy+=(I.y+N.y)*D,E=I,I=N,A=A.next;var j=A;T+=I.x*(j.y-E.y);var F=j.y*I.x-j.x*I.y;P.localCOMx+=(I.x+j.x)*F,P.localCOMy+=(I.y+j.y)*F,T=1/(3*T);var B=T;P.localCOMx*=B,P.localCOMy*=B}}null!=S.wrap_localCOM&&(S.wrap_localCOM.zpp_inner.x=S.localCOMx,S.wrap_localCOM.zpp_inner.y=S.localCOMy)}var R=S.body;R.zip_axis&&(R.zip_axis=!1,R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot)),S.worldCOMx=S.body.posx+(S.body.axisy*S.localCOMx-S.body.axisx*S.localCOMy),S.worldCOMy=S.body.posy+(S.localCOMx*S.body.axisx+S.localCOMy*S.body.axisy)}var G=S.radius,Y=S.radius;S.aabb.minx=S.worldCOMx-G,S.aabb.miny=S.worldCOMy-Y,S.aabb.maxx=S.worldCOMx+G,S.aabb.maxy=S.worldCOMy+Y}else{var U=n.polygon;if(U.zip_gverts&&null!=U.body){U.zip_gverts=!1,U.validate_lverts();var Z=U.body;Z.zip_axis&&(Z.zip_axis=!1,Z.axisx=Math.sin(Z.rot),Z.axisy=Math.cos(Z.rot));for(var q=U.lverts.next,W=U.gverts.next;null!=W;){var X=W,H=q;q=q.next,X.x=U.body.posx+(U.body.axisy*H.x-U.body.axisx*H.y),X.y=U.body.posy+(H.x*U.body.axisx+H.y*U.body.axisy),W=W.next}}var K=U.gverts.next;U.aabb.minx=K.x,U.aabb.miny=K.y,U.aabb.maxx=K.x,U.aabb.maxy=K.y;for(var J=U.gverts.next.next;null!=J;){var Q=J;U.aabb.minx>Q.x&&(U.aabb.minx=Q.x),Q.x>U.aabb.maxx&&(U.aabb.maxx=Q.x),U.aabb.miny>Q.y&&(U.aabb.miny=Q.y),Q.y>U.aabb.maxy&&(U.aabb.maxy=Q.y),J=J.next}}var $;if(O.dyn==(n.body.type!=ye.id_BodyType_STATIC&&!n.body.component.sleeping)){var nn=O.aabb,en=n.aabb;$=!!(nn.minx>en.minx||nn.miny>en.miny||en.maxx>nn.maxx||en.maxy>nn.maxy)}else $=!0;$&&(O.synced=!0,O.snext=k.syncs,k.syncs=O)}}},broadphase:function(n,e){},clear:function(){},shapesUnderPoint:function(n,e,t,i){return null},bodiesUnderPoint:function(n,e,t,i){return null},aabbShape:null,matrix:null,updateAABBShape:function(n){if(null==this.aabbShape){null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1);var e=new In(ye.BodyType_STATIC),t=e.zpp_inner.wrap_shapes,i=this.aabbShape=new Qn(Qn.rect(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny));t.zpp_inner.reverse_flag?t.push(i):t.unshift(i)}else{var l=this.aabbShape.zpp_inner.aabb,r=(n.maxx-n.minx)/(l.maxx-l.minx),a=(n.maxy-n.miny)/(l.maxy-l.miny);null==this.matrix&&(this.matrix=new bn);var p=this.matrix;p.zpp_inner.a=r;var s=p.zpp_inner;null!=s._invalidate&&s._invalidate();var o=this.matrix,h=this.matrix;h.zpp_inner.c=0;var _=h.zpp_inner;null!=_._invalidate&&_._invalidate();var u=h.zpp_inner.c;o.zpp_inner.b=u;var d=o.zpp_inner;null!=d._invalidate&&d._invalidate();var c=this.matrix;c.zpp_inner.d=a;var x=c.zpp_inner;null!=x._invalidate&&x._invalidate();var v=this.matrix,z=n.minx-r*l.minx;v.zpp_inner.tx=z;var y=v.zpp_inner;null!=y._invalidate&&y._invalidate();var f=this.matrix,m=n.miny-a*l.miny;f.zpp_inner.ty=m;var b=f.zpp_inner;null!=b._invalidate&&b._invalidate(),this.aabbShape.transform(this.matrix)}var g=this.aabbShape.zpp_inner;if(g.zip_aabb&&null!=g.body)if(g.zip_aabb=!1,g.type==ye.id_ShapeType_CIRCLE){var w=g.circle;if(w.zip_worldCOM&&null!=w.body){if(w.zip_worldCOM=!1,w.zip_localCOM){if(w.zip_localCOM=!1,w.type==ye.id_ShapeType_POLYGON){var C=w.polygon;if(null==C.lverts.next.next)C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;else if(null==C.lverts.next.next.next){C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;C.localCOMx+=1*C.lverts.next.next.x,C.localCOMy+=1*C.lverts.next.next.y;C.localCOMx*=.5,C.localCOMy*=.5}else{C.localCOMx=0,C.localCOMy=0;var M=0,k=C.lverts.next,O=k;k=k.next;var S=k;for(k=k.next;null!=k;){var P=k;M+=S.x*(P.y-O.y);var T=P.y*S.x-P.x*S.y;C.localCOMx+=(S.x+P.x)*T,C.localCOMy+=(S.y+P.y)*T,O=S,S=P,k=k.next}k=C.lverts.next;var A=k;M+=S.x*(A.y-O.y);var E=A.y*S.x-A.x*S.y;C.localCOMx+=(S.x+A.x)*E,C.localCOMy+=(S.y+A.y)*E,O=S,S=A,k=k.next;var I=k;M+=S.x*(I.y-O.y);var V=I.y*S.x-I.x*S.y;C.localCOMx+=(S.x+I.x)*V,C.localCOMy+=(S.y+I.y)*V,M=1/(3*M);var L=M;C.localCOMx*=L,C.localCOMy*=L}}null!=w.wrap_localCOM&&(w.wrap_localCOM.zpp_inner.x=w.localCOMx,w.wrap_localCOM.zpp_inner.y=w.localCOMy)}var N=w.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),w.worldCOMx=w.body.posx+(w.body.axisy*w.localCOMx-w.body.axisx*w.localCOMy),w.worldCOMy=w.body.posy+(w.localCOMx*w.body.axisx+w.localCOMy*w.body.axisy)}var D=w.radius,j=w.radius;w.aabb.minx=w.worldCOMx-D,w.aabb.miny=w.worldCOMy-j,w.aabb.maxx=w.worldCOMx+D,w.aabb.maxy=w.worldCOMy+j}else{var F=g.polygon;if(F.zip_gverts&&null!=F.body){F.zip_gverts=!1,F.validate_lverts();var B=F.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var R=F.lverts.next,G=F.gverts.next;null!=G;){var Y=G,U=R;R=R.next,Y.x=F.body.posx+(F.body.axisy*U.x-F.body.axisx*U.y),Y.y=F.body.posy+(U.x*F.body.axisx+U.y*F.body.axisy),G=G.next}}var Z=F.gverts.next;F.aabb.minx=Z.x,F.aabb.miny=Z.y,F.aabb.maxx=Z.x,F.aabb.maxy=Z.y;for(var q=F.gverts.next.next;null!=q;){var W=q;F.aabb.minx>W.x&&(F.aabb.minx=W.x),W.x>F.aabb.maxx&&(F.aabb.maxx=W.x),F.aabb.miny>W.y&&(F.aabb.miny=W.y),W.y>F.aabb.maxy&&(F.aabb.maxy=W.y),q=q.next}}var X=this.aabbShape.zpp_inner.polygon;if(X.zip_gaxi&&null!=X.body){X.zip_gaxi=!1,X.validate_laxi();var H=X.body;if(H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),X.zip_gverts&&null!=X.body){X.zip_gverts=!1,X.validate_lverts();var K=X.body;K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot));for(var J=X.lverts.next,Q=X.gverts.next;null!=Q;){var $=Q,nn=J;J=J.next,$.x=X.body.posx+(X.body.axisy*nn.x-X.body.axisx*nn.y),$.y=X.body.posy+(nn.x*X.body.axisx+nn.y*X.body.axisy),Q=Q.next}}var en=X.edges.head,tn=X.gverts.next,ln=tn;for(tn=tn.next;null!=tn;){var rn=tn,an=en.elt;en=en.next,an.gp0=ln,an.gp1=rn,an.gnormx=X.body.axisy*an.lnormx-X.body.axisx*an.lnormy,an.gnormy=an.lnormx*X.body.axisx+an.lnormy*X.body.axisy,an.gprojection=X.body.posx*an.gnormx+X.body.posy*an.gnormy+an.lprojection,null!=an.wrap_gnorm&&(an.wrap_gnorm.zpp_inner.x=an.gnormx,an.wrap_gnorm.zpp_inner.y=an.gnormy),an.tp0=an.gp0.y*an.gnormx-an.gp0.x*an.gnormy,an.tp1=an.gp1.y*an.gnormx-an.gp1.x*an.gnormy,ln=rn,tn=tn.next}var pn=X.gverts.next,sn=en.elt;en=en.next,sn.gp0=ln,sn.gp1=pn,sn.gnormx=X.body.axisy*sn.lnormx-X.body.axisx*sn.lnormy,sn.gnormy=sn.lnormx*X.body.axisx+sn.lnormy*X.body.axisy,sn.gprojection=X.body.posx*sn.gnormx+X.body.posy*sn.gnormy+sn.lprojection,null!=sn.wrap_gnorm&&(sn.wrap_gnorm.zpp_inner.x=sn.gnormx,sn.wrap_gnorm.zpp_inner.y=sn.gnormy),sn.tp0=sn.gp0.y*sn.gnormx-sn.gp0.x*sn.gnormy,sn.tp1=sn.gp1.y*sn.gnormx-sn.gp1.x*sn.gnormy}},shapesInAABB:function(n,e,t,i,l){return null},bodiesInAABB:function(n,e,t,i,l){return null},circShape:null,updateCircShape:function(n,e,t){if(null==this.circShape){null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1);var i,l=new In(ye.BodyType_STATIC),r=l.zpp_inner.wrap_shapes;if(null==Cl.poolVec2?i=new On:(i=Cl.poolVec2,Cl.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==Cl.nextVec2&&(Cl.nextVec2=null)),null==i.zpp_inner){var a;null==Ct.zpp_pool?a=new Ct:(a=Ct.zpp_pool,Ct.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=n,a.y=e,i.zpp_inner=a,i.zpp_inner.outer=i}else{var p=i.zpp_inner;null!=p._isimmutable&&p._isimmutable();var s,o=i.zpp_inner;if(null!=o._validate&&o._validate(),i.zpp_inner.x==n){var h=i.zpp_inner;null!=h._validate&&h._validate(),s=i.zpp_inner.y==e}else s=!1;if(!s){i.zpp_inner.x=n,i.zpp_inner.y=e;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}i.zpp_inner.weak=!1;var u=this.circShape=new Xn(t,i);r.zpp_inner.reverse_flag?r.push(u):r.unshift(u)}else{var d=this.circShape.zpp_inner.circle,c=t/d.radius;null==this.matrix&&(this.matrix=new bn);var x=this.matrix,v=this.matrix;v.zpp_inner.d=c;var z=v.zpp_inner;null!=z._invalidate&&z._invalidate();var y=v.zpp_inner.d;x.zpp_inner.a=y;var f=x.zpp_inner;null!=f._invalidate&&f._invalidate();var m=this.matrix,b=this.matrix;b.zpp_inner.c=0;var g=b.zpp_inner;null!=g._invalidate&&g._invalidate();var w=b.zpp_inner.c;m.zpp_inner.b=w;var C=m.zpp_inner;null!=C._invalidate&&C._invalidate();var M=this.matrix,k=n-c*d.localCOMx;M.zpp_inner.tx=k;var O=M.zpp_inner;null!=O._invalidate&&O._invalidate();var S=this.matrix,P=e-c*d.localCOMy;S.zpp_inner.ty=P;var T=S.zpp_inner;null!=T._invalidate&&T._invalidate(),this.circShape.transform(this.matrix)}var A=this.circShape.zpp_inner;if(A.zip_aabb&&null!=A.body)if(A.zip_aabb=!1,A.type==ye.id_ShapeType_CIRCLE){var E=A.circle;if(E.zip_worldCOM&&null!=E.body){if(E.zip_worldCOM=!1,E.zip_localCOM){if(E.zip_localCOM=!1,E.type==ye.id_ShapeType_POLYGON){var I=E.polygon;if(null==I.lverts.next.next)I.localCOMx=I.lverts.next.x,I.localCOMy=I.lverts.next.y;else if(null==I.lverts.next.next.next){I.localCOMx=I.lverts.next.x,I.localCOMy=I.lverts.next.y;I.localCOMx+=1*I.lverts.next.next.x,I.localCOMy+=1*I.lverts.next.next.y;I.localCOMx*=.5,I.localCOMy*=.5}else{I.localCOMx=0,I.localCOMy=0;var V=0,L=I.lverts.next,N=L;L=L.next;var D=L;for(L=L.next;null!=L;){var j=L;V+=D.x*(j.y-N.y);var F=j.y*D.x-j.x*D.y;I.localCOMx+=(D.x+j.x)*F,I.localCOMy+=(D.y+j.y)*F,N=D,D=j,L=L.next}L=I.lverts.next;var B=L;V+=D.x*(B.y-N.y);var R=B.y*D.x-B.x*D.y;I.localCOMx+=(D.x+B.x)*R,I.localCOMy+=(D.y+B.y)*R,N=D,D=B,L=L.next;var G=L;V+=D.x*(G.y-N.y);var Y=G.y*D.x-G.x*D.y;I.localCOMx+=(D.x+G.x)*Y,I.localCOMy+=(D.y+G.y)*Y,V=1/(3*V);var U=V;I.localCOMx*=U,I.localCOMy*=U}}null!=E.wrap_localCOM&&(E.wrap_localCOM.zpp_inner.x=E.localCOMx,E.wrap_localCOM.zpp_inner.y=E.localCOMy)}var Z=E.body;Z.zip_axis&&(Z.zip_axis=!1,Z.axisx=Math.sin(Z.rot),Z.axisy=Math.cos(Z.rot)),E.worldCOMx=E.body.posx+(E.body.axisy*E.localCOMx-E.body.axisx*E.localCOMy),E.worldCOMy=E.body.posy+(E.localCOMx*E.body.axisx+E.localCOMy*E.body.axisy)}var q=E.radius,W=E.radius;E.aabb.minx=E.worldCOMx-q,E.aabb.miny=E.worldCOMy-W,E.aabb.maxx=E.worldCOMx+q,E.aabb.maxy=E.worldCOMy+W}else{var X=A.polygon;if(X.zip_gverts&&null!=X.body){X.zip_gverts=!1,X.validate_lverts();var H=X.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot));for(var K=X.lverts.next,J=X.gverts.next;null!=J;){var Q=J,$=K;K=K.next,Q.x=X.body.posx+(X.body.axisy*$.x-X.body.axisx*$.y),Q.y=X.body.posy+($.x*X.body.axisx+$.y*X.body.axisy),J=J.next}}var nn=X.gverts.next;X.aabb.minx=nn.x,X.aabb.miny=nn.y,X.aabb.maxx=nn.x,X.aabb.maxy=nn.y;for(var en=X.gverts.next.next;null!=en;){var tn=en;X.aabb.minx>tn.x&&(X.aabb.minx=tn.x),tn.x>X.aabb.maxx&&(X.aabb.maxx=tn.x),X.aabb.miny>tn.y&&(X.aabb.miny=tn.y),tn.y>X.aabb.maxy&&(X.aabb.maxy=tn.y),en=en.next}}},shapesInCircle:function(n,e,t,i,l,r){return null},bodiesInCircle:function(n,e,t,i,l,r){return null},validateShape:function(n){if(n.type==ye.id_ShapeType_POLYGON){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var l=e.lverts.next,r=e.gverts.next;null!=r;){var a=r,p=l;l=l.next,a.x=e.body.posx+(e.body.axisy*p.x-e.body.axisx*p.y),a.y=e.body.posy+(p.x*e.body.axisx+p.y*e.body.axisy),r=r.next}}var s=e.edges.head,o=e.gverts.next,h=o;for(o=o.next;null!=o;){var _=o,u=s.elt;s=s.next,u.gp0=h,u.gp1=_,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,h=_,o=o.next}var d=e.gverts.next,c=s.elt;s=s.next,c.gp0=h,c.gp1=d,c.gnormx=e.body.axisy*c.lnormx-e.body.axisx*c.lnormy,c.gnormy=c.lnormx*e.body.axisx+c.lnormy*e.body.axisy,c.gprojection=e.body.posx*c.gnormx+e.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var x=n.circle;if(x.zip_worldCOM&&null!=x.body){if(x.zip_worldCOM=!1,x.zip_localCOM){if(x.zip_localCOM=!1,x.type==ye.id_ShapeType_POLYGON){var v=x.polygon;if(null==v.lverts.next.next)v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;else if(null==v.lverts.next.next.next){v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;v.localCOMx+=1*v.lverts.next.next.x,v.localCOMy+=1*v.lverts.next.next.y;v.localCOMx*=.5,v.localCOMy*=.5}else{v.localCOMx=0,v.localCOMy=0;var z=0,y=v.lverts.next,f=y;y=y.next;var m=y;for(y=y.next;null!=y;){var b=y;z+=m.x*(b.y-f.y);var g=b.y*m.x-b.x*m.y;v.localCOMx+=(m.x+b.x)*g,v.localCOMy+=(m.y+b.y)*g,f=m,m=b,y=y.next}y=v.lverts.next;var w=y;z+=m.x*(w.y-f.y);var C=w.y*m.x-w.x*m.y;v.localCOMx+=(m.x+w.x)*C,v.localCOMy+=(m.y+w.y)*C,f=m,m=w,y=y.next;var M=y;z+=m.x*(M.y-f.y);var k=M.y*m.x-M.x*m.y;v.localCOMx+=(m.x+M.x)*k,v.localCOMy+=(m.y+M.y)*k,z=1/(3*z);var O=z;v.localCOMx*=O,v.localCOMy*=O}}null!=x.wrap_localCOM&&(x.wrap_localCOM.zpp_inner.x=x.localCOMx,x.wrap_localCOM.zpp_inner.y=x.localCOMy)}var S=x.body;S.zip_axis&&(S.zip_axis=!1,S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot)),x.worldCOMx=x.body.posx+(x.body.axisy*x.localCOMx-x.body.axisx*x.localCOMy),x.worldCOMy=x.body.posy+(x.localCOMx*x.body.axisx+x.localCOMy*x.body.axisy)}var P=x.radius,T=x.radius;x.aabb.minx=x.worldCOMx-P,x.aabb.miny=x.worldCOMy-T,x.aabb.maxx=x.worldCOMx+P,x.aabb.maxy=x.worldCOMy+T}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var E=A.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot));for(var I=A.lverts.next,V=A.gverts.next;null!=V;){var L=V,N=I;I=I.next,L.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),L.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),V=V.next}}var D=A.gverts.next;A.aabb.minx=D.x,A.aabb.miny=D.y,A.aabb.maxx=D.x,A.aabb.maxy=D.y;for(var j=A.gverts.next.next;null!=j;){var F=j;A.aabb.minx>F.x&&(A.aabb.minx=F.x),F.x>A.aabb.maxx&&(A.aabb.maxx=F.x),A.aabb.miny>F.y&&(A.aabb.miny=F.y),F.y>A.aabb.maxy&&(A.aabb.maxy=F.y),j=j.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==ye.id_ShapeType_POLYGON){var B=n.polygon;if(null==B.lverts.next.next)B.localCOMx=B.lverts.next.x,B.localCOMy=B.lverts.next.y;else if(null==B.lverts.next.next.next){B.localCOMx=B.lverts.next.x,B.localCOMy=B.lverts.next.y;B.localCOMx+=1*B.lverts.next.next.x,B.localCOMy+=1*B.lverts.next.next.y;B.localCOMx*=.5,B.localCOMy*=.5}else{B.localCOMx=0,B.localCOMy=0;var R=0,G=B.lverts.next,Y=G;G=G.next;var U=G;for(G=G.next;null!=G;){var Z=G;R+=U.x*(Z.y-Y.y);var q=Z.y*U.x-Z.x*U.y;B.localCOMx+=(U.x+Z.x)*q,B.localCOMy+=(U.y+Z.y)*q,Y=U,U=Z,G=G.next}G=B.lverts.next;var W=G;R+=U.x*(W.y-Y.y);var X=W.y*U.x-W.x*U.y;B.localCOMx+=(U.x+W.x)*X,B.localCOMy+=(U.y+W.y)*X,Y=U,U=W,G=G.next;var H=G;R+=U.x*(H.y-Y.y);var K=H.y*U.x-H.x*U.y;B.localCOMx+=(U.x+H.x)*K,B.localCOMy+=(U.y+H.y)*K,R=1/(3*R);var J=R;B.localCOMx*=J,B.localCOMy*=J}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var Q=n.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},shapesInShape:function(n,e,t,i){return null},bodiesInShape:function(n,e,t,i){return null},rayCast:function(n,e,t){return null},rayMultiCast:function(n,e,t,i){return null},__class__:Nt};var Dt=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};l["zpp_nape.space.ZPP_AABBNode"]=Dt,Dt.__name__=["zpp_nape","space","ZPP_AABBNode"],Dt.prototype={aabb:null,shape:null,dyn:null,parent:null,child1:null,child2:null,height:null,rayt:null,next:null,alloc:function(){null==Ze.zpp_pool?this.aabb=new Ze:(this.aabb=Ze.zpp_pool,Ze.zpp_pool=this.aabb.next,this.aabb.next=null);this.moved=!1,this.synced=!1,this.first_sync=!1},free:function(){this.height=-1;var n=this.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Ze.zpp_pool,Ze.zpp_pool=n,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},mnext:null,moved:null,snext:null,synced:null,first_sync:null,isLeaf:function(){return null==this.child1},__class__:Dt};var jt=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};l["zpp_nape.space.ZPP_AABBPair"]=jt,jt.__name__=["zpp_nape","space","ZPP_AABBPair"],jt.prototype={n1:null,n2:null,first:null,sleeping:null,id:null,di:null,arb:null,next:null,alloc:function(){},free:function(){this.n1=this.n2=null,this.sleeping=!1},__class__:jt};var Ft=function(){this.root=null};l["zpp_nape.space.ZPP_AABBTree"]=Ft,Ft.__name__=["zpp_nape","space","ZPP_AABBTree"],Ft.prototype={root:null,clear:function(){if(null!=this.root){var n=null;for(this.root.next=n,n=this.root;null!=n;){var e=n;n=e.next,e.next=null;var t=e;null==t.child1?(t.shape.node=null,t.shape.removedFromSpace(),t.shape=null):(null!=t.child1&&(t.child1.next=n,n=t.child1),null!=t.child2&&(t.child2.next=n,n=t.child2));var i=t;i.height=-1;var l=i.aabb;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l.wrap_min=l.wrap_max=null,l._invalidate=null,l._validate=null,l.next=Ze.zpp_pool,Ze.zpp_pool=l,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=Dt.zpp_pool,Dt.zpp_pool=i}this.root=null}},insertLeaf:function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,t=this.root;null!=t.child1;){var i=t.child1,l=t.child2,r=t.aabb,a=2*(r.maxx-r.minx+(r.maxy-r.miny)),p=Ft.tmpaabb,s=t.aabb;p.minx=e.minx>s.minx?s.minx:e.minx,p.miny=e.miny>s.miny?s.miny:e.miny,p.maxx=s.maxx>e.maxx?s.maxx:e.maxx,p.maxy=s.maxy>e.maxy?s.maxy:e.maxy;var o=Ft.tmpaabb,h=2*(o.maxx-o.minx+(o.maxy-o.miny)),_=2*h,u=2*(h-a),d=Ft.tmpaabb,c=i.aabb;d.minx=c.minx>e.minx?e.minx:c.minx,d.miny=c.miny>e.miny?e.miny:c.miny,d.maxx=e.maxx>c.maxx?e.maxx:c.maxx,d.maxy=e.maxy>c.maxy?e.maxy:c.maxy;var x;if(null==i.child1){var v=Ft.tmpaabb;x=2*(v.maxx-v.minx+(v.maxy-v.miny))+u}else{var z=i.aabb,y=2*(z.maxx-z.minx+(z.maxy-z.miny)),f=Ft.tmpaabb;x=2*(f.maxx-f.minx+(f.maxy-f.miny))-y+u}var m=Ft.tmpaabb,b=l.aabb;m.minx=b.minx>e.minx?e.minx:b.minx,m.miny=b.miny>e.miny?e.miny:b.miny,m.maxx=e.maxx>b.maxx?e.maxx:b.maxx,m.maxy=e.maxy>b.maxy?e.maxy:b.maxy;var g;if(null==l.child1){var w=Ft.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+u}else{var C=l.aabb,M=2*(C.maxx-C.minx+(C.maxy-C.miny)),k=Ft.tmpaabb;g=2*(k.maxx-k.minx+(k.maxy-k.miny))-M+u}if(x>_&&g>_)break;t=g>x?i:l}var O,S=t,P=S.parent;null==Dt.zpp_pool?O=new Dt:(O=Dt.zpp_pool,Dt.zpp_pool=O.next,O.next=null),null==Ze.zpp_pool?O.aabb=new Ze:(O.aabb=Ze.zpp_pool,Ze.zpp_pool=O.aabb.next,O.aabb.next=null);O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=P;var T=O.aabb,A=S.aabb;for(T.minx=A.minx>e.minx?e.minx:A.minx,T.miny=A.miny>e.miny?e.miny:A.miny,T.maxx=e.maxx>A.maxx?e.maxx:A.maxx,T.maxy=e.maxy>A.maxy?e.maxy:A.maxy,O.height=S.height+1,null!=P?(P.child1==S?P.child1=O:P.child2=O,O.child1=S,O.child2=n,S.parent=O,n.parent=O):(O.child1=S,O.child2=n,S.parent=O,n.parent=O,this.root=O),t=n.parent;null!=t;){if(null==t.child1||2>t.height)t=t;else{var E=t.child1,I=t.child2,V=I.height-E.height;if(V>1){var L=I.child1,N=I.child2;if(I.child1=t,I.parent=t.parent,t.parent=I,null!=I.parent?I.parent.child1==t?I.parent.child1=I:I.parent.child2=I:this.root=I,L.height>N.height){I.child2=L,t.child2=N,N.parent=t;var D=t.aabb,j=E.aabb,F=N.aabb;D.minx=F.minx>j.minx?j.minx:F.minx,D.miny=F.miny>j.miny?j.miny:F.miny,D.maxx=j.maxx>F.maxx?j.maxx:F.maxx,D.maxy=j.maxy>F.maxy?j.maxy:F.maxy;var B=I.aabb,R=t.aabb,G=L.aabb;B.minx=G.minx>R.minx?R.minx:G.minx,B.miny=G.miny>R.miny?R.miny:G.miny,B.maxx=R.maxx>G.maxx?R.maxx:G.maxx,B.maxy=R.maxy>G.maxy?R.maxy:G.maxy;var Y=E.height,U=N.height;t.height=1+(Y>U?Y:U);var Z=t.height,q=L.height;I.height=1+(Z>q?Z:q)}else{I.child2=N,t.child2=L,L.parent=t;var W=t.aabb,X=E.aabb,H=L.aabb;W.minx=H.minx>X.minx?X.minx:H.minx,W.miny=H.miny>X.miny?X.miny:H.miny,W.maxx=X.maxx>H.maxx?X.maxx:H.maxx,W.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var K=I.aabb,J=t.aabb,Q=N.aabb;K.minx=Q.minx>J.minx?J.minx:Q.minx,K.miny=Q.miny>J.miny?J.miny:Q.miny,K.maxx=J.maxx>Q.maxx?J.maxx:Q.maxx,K.maxy=J.maxy>Q.maxy?J.maxy:Q.maxy;var $=E.height,nn=L.height;t.height=1+($>nn?$:nn);var en=t.height,tn=N.height;I.height=1+(en>tn?en:tn)}t=I}else if(-1>V){var ln=E.child1,rn=E.child2;if(E.child1=t,E.parent=t.parent,t.parent=E,null!=E.parent?E.parent.child1==t?E.parent.child1=E:E.parent.child2=E:this.root=E,ln.height>rn.height){E.child2=ln,t.child1=rn,rn.parent=t;var an=t.aabb,pn=I.aabb,sn=rn.aabb;an.minx=sn.minx>pn.minx?pn.minx:sn.minx,an.miny=sn.miny>pn.miny?pn.miny:sn.miny,an.maxx=pn.maxx>sn.maxx?pn.maxx:sn.maxx,an.maxy=pn.maxy>sn.maxy?pn.maxy:sn.maxy;var on=E.aabb,hn=t.aabb,_n=ln.aabb;on.minx=_n.minx>hn.minx?hn.minx:_n.minx,on.miny=_n.miny>hn.miny?hn.miny:_n.miny,on.maxx=hn.maxx>_n.maxx?hn.maxx:_n.maxx,on.maxy=hn.maxy>_n.maxy?hn.maxy:_n.maxy;var un=I.height,dn=rn.height;t.height=1+(un>dn?un:dn);var cn=t.height,xn=ln.height;E.height=1+(cn>xn?cn:xn)}else{E.child2=rn,t.child1=ln,ln.parent=t;var vn=t.aabb,zn=I.aabb,yn=ln.aabb;vn.minx=yn.minx>zn.minx?zn.minx:yn.minx,vn.miny=yn.miny>zn.miny?zn.miny:yn.miny,vn.maxx=zn.maxx>yn.maxx?zn.maxx:yn.maxx,vn.maxy=zn.maxy>yn.maxy?zn.maxy:yn.maxy;var fn=E.aabb,mn=t.aabb,bn=rn.aabb;fn.minx=bn.minx>mn.minx?mn.minx:bn.minx,fn.miny=bn.miny>mn.miny?mn.miny:bn.miny,fn.maxx=mn.maxx>bn.maxx?mn.maxx:bn.maxx,fn.maxy=mn.maxy>bn.maxy?mn.maxy:bn.maxy;var gn=I.height,wn=ln.height;t.height=1+(gn>wn?gn:wn);var Cn=t.height,Mn=rn.height;E.height=1+(Cn>Mn?Cn:Mn)}t=E}else t=t}var kn=t.child1,On=t.child2,Sn=kn.height,Pn=On.height;t.height=1+(Sn>Pn?Sn:Pn);var Tn=t.aabb,An=kn.aabb,En=On.aabb;Tn.minx=En.minx>An.minx?An.minx:En.minx,Tn.miny=En.miny>An.miny?An.miny:En.miny,Tn.maxx=An.maxx>En.maxx?An.maxx:En.maxx,Tn.maxy=An.maxy>En.maxy?An.maxy:En.maxy,t=t.parent}}},inlined_insertLeaf:function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,t=this.root;null!=t.child1;){var i=t.child1,l=t.child2,r=t.aabb,a=2*(r.maxx-r.minx+(r.maxy-r.miny)),p=Ft.tmpaabb,s=t.aabb;p.minx=e.minx>s.minx?s.minx:e.minx,p.miny=e.miny>s.miny?s.miny:e.miny,p.maxx=s.maxx>e.maxx?s.maxx:e.maxx,p.maxy=s.maxy>e.maxy?s.maxy:e.maxy;var o=Ft.tmpaabb,h=2*(o.maxx-o.minx+(o.maxy-o.miny)),_=2*h,u=2*(h-a),d=Ft.tmpaabb,c=i.aabb;d.minx=c.minx>e.minx?e.minx:c.minx,d.miny=c.miny>e.miny?e.miny:c.miny,d.maxx=e.maxx>c.maxx?e.maxx:c.maxx,d.maxy=e.maxy>c.maxy?e.maxy:c.maxy;var x;if(null==i.child1){var v=Ft.tmpaabb;x=2*(v.maxx-v.minx+(v.maxy-v.miny))+u}else{var z=i.aabb,y=2*(z.maxx-z.minx+(z.maxy-z.miny)),f=Ft.tmpaabb;x=2*(f.maxx-f.minx+(f.maxy-f.miny))-y+u}var m=Ft.tmpaabb,b=l.aabb;m.minx=b.minx>e.minx?e.minx:b.minx,m.miny=b.miny>e.miny?e.miny:b.miny,m.maxx=e.maxx>b.maxx?e.maxx:b.maxx,m.maxy=e.maxy>b.maxy?e.maxy:b.maxy;var g;if(null==l.child1){var w=Ft.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+u}else{var C=l.aabb,M=2*(C.maxx-C.minx+(C.maxy-C.miny)),k=Ft.tmpaabb;g=2*(k.maxx-k.minx+(k.maxy-k.miny))-M+u}if(x>_&&g>_)break;t=g>x?i:l}var O,S=t,P=S.parent;null==Dt.zpp_pool?O=new Dt:(O=Dt.zpp_pool,Dt.zpp_pool=O.next,O.next=null),null==Ze.zpp_pool?O.aabb=new Ze:(O.aabb=Ze.zpp_pool,Ze.zpp_pool=O.aabb.next,O.aabb.next=null);O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=P;var T=O.aabb,A=S.aabb;for(T.minx=A.minx>e.minx?e.minx:A.minx,T.miny=A.miny>e.miny?e.miny:A.miny,T.maxx=e.maxx>A.maxx?e.maxx:A.maxx,T.maxy=e.maxy>A.maxy?e.maxy:A.maxy,O.height=S.height+1,null!=P?(P.child1==S?P.child1=O:P.child2=O,O.child1=S,O.child2=n,S.parent=O,n.parent=O):(O.child1=S,O.child2=n,S.parent=O,n.parent=O,this.root=O),t=n.parent;null!=t;){if(null==t.child1||2>t.height)t=t;else{var E=t.child1,I=t.child2,V=I.height-E.height;if(V>1){var L=I.child1,N=I.child2;if(I.child1=t,I.parent=t.parent,t.parent=I,null!=I.parent?I.parent.child1==t?I.parent.child1=I:I.parent.child2=I:this.root=I,L.height>N.height){I.child2=L,t.child2=N,N.parent=t;var D=t.aabb,j=E.aabb,F=N.aabb;D.minx=F.minx>j.minx?j.minx:F.minx,D.miny=F.miny>j.miny?j.miny:F.miny,D.maxx=j.maxx>F.maxx?j.maxx:F.maxx,D.maxy=j.maxy>F.maxy?j.maxy:F.maxy;var B=I.aabb,R=t.aabb,G=L.aabb;B.minx=G.minx>R.minx?R.minx:G.minx,B.miny=G.miny>R.miny?R.miny:G.miny,B.maxx=R.maxx>G.maxx?R.maxx:G.maxx,B.maxy=R.maxy>G.maxy?R.maxy:G.maxy;var Y=E.height,U=N.height;t.height=1+(Y>U?Y:U);var Z=t.height,q=L.height;I.height=1+(Z>q?Z:q)}else{I.child2=N,t.child2=L,L.parent=t;var W=t.aabb,X=E.aabb,H=L.aabb;W.minx=H.minx>X.minx?X.minx:H.minx,W.miny=H.miny>X.miny?X.miny:H.miny,W.maxx=X.maxx>H.maxx?X.maxx:H.maxx,W.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var K=I.aabb,J=t.aabb,Q=N.aabb;K.minx=Q.minx>J.minx?J.minx:Q.minx,K.miny=Q.miny>J.miny?J.miny:Q.miny,K.maxx=J.maxx>Q.maxx?J.maxx:Q.maxx,K.maxy=J.maxy>Q.maxy?J.maxy:Q.maxy;var $=E.height,nn=L.height;t.height=1+($>nn?$:nn);var en=t.height,tn=N.height;I.height=1+(en>tn?en:tn)}t=I}else if(-1>V){var ln=E.child1,rn=E.child2;if(E.child1=t,E.parent=t.parent,t.parent=E,null!=E.parent?E.parent.child1==t?E.parent.child1=E:E.parent.child2=E:this.root=E,ln.height>rn.height){E.child2=ln,t.child1=rn,rn.parent=t;var an=t.aabb,pn=I.aabb,sn=rn.aabb;an.minx=sn.minx>pn.minx?pn.minx:sn.minx,an.miny=sn.miny>pn.miny?pn.miny:sn.miny,an.maxx=pn.maxx>sn.maxx?pn.maxx:sn.maxx,an.maxy=pn.maxy>sn.maxy?pn.maxy:sn.maxy;var on=E.aabb,hn=t.aabb,_n=ln.aabb;on.minx=_n.minx>hn.minx?hn.minx:_n.minx,on.miny=_n.miny>hn.miny?hn.miny:_n.miny,on.maxx=hn.maxx>_n.maxx?hn.maxx:_n.maxx,on.maxy=hn.maxy>_n.maxy?hn.maxy:_n.maxy;var un=I.height,dn=rn.height;t.height=1+(un>dn?un:dn);var cn=t.height,xn=ln.height;E.height=1+(cn>xn?cn:xn)}else{E.child2=rn,t.child1=ln,ln.parent=t;var vn=t.aabb,zn=I.aabb,yn=ln.aabb;vn.minx=yn.minx>zn.minx?zn.minx:yn.minx,vn.miny=yn.miny>zn.miny?zn.miny:yn.miny,vn.maxx=zn.maxx>yn.maxx?zn.maxx:yn.maxx,vn.maxy=zn.maxy>yn.maxy?zn.maxy:yn.maxy;var fn=E.aabb,mn=t.aabb,bn=rn.aabb;fn.minx=bn.minx>mn.minx?mn.minx:bn.minx,fn.miny=bn.miny>mn.miny?mn.miny:bn.miny,fn.maxx=mn.maxx>bn.maxx?mn.maxx:bn.maxx,fn.maxy=mn.maxy>bn.maxy?mn.maxy:bn.maxy;var gn=I.height,wn=ln.height;t.height=1+(gn>wn?gn:wn);var Cn=t.height,Mn=rn.height;E.height=1+(Cn>Mn?Cn:Mn)}t=E}else t=t}var kn=t.child1,On=t.child2,Sn=kn.height,Pn=On.height;t.height=1+(Sn>Pn?Sn:Pn);var Tn=t.aabb,An=kn.aabb,En=On.aabb;Tn.minx=En.minx>An.minx?An.minx:En.minx,Tn.miny=En.miny>An.miny?An.miny:En.miny,Tn.maxx=An.maxx>En.maxx?An.maxx:En.maxx,Tn.maxy=An.maxy>En.maxy?An.maxy:En.maxy,t=t.parent}}},removeLeaf:function(n){if(n==this.root)this.root=null;else{var e=n.parent,t=e.parent,i=e.child1==n?e.child2:e.child1;if(null!=t){t.child1==e?t.child1=i:t.child2=i,i.parent=t;var l=e;l.height=-1;var r=l.aabb;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Ze.zpp_pool,Ze.zpp_pool=r,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=Dt.zpp_pool,Dt.zpp_pool=l;for(var a=t;null!=a;){if(null==a.child1||2>a.height)a=a;else{var p=a.child1,s=a.child2,o=s.height-p.height;if(o>1){var h=s.child1,_=s.child2;if(s.child1=a,s.parent=a.parent,a.parent=s,null!=s.parent?s.parent.child1==a?s.parent.child1=s:s.parent.child2=s:this.root=s,h.height>_.height){s.child2=h,a.child2=_,_.parent=a;var u=a.aabb,d=p.aabb,c=_.aabb;u.minx=c.minx>d.minx?d.minx:c.minx,u.miny=c.miny>d.miny?d.miny:c.miny,u.maxx=d.maxx>c.maxx?d.maxx:c.maxx,u.maxy=d.maxy>c.maxy?d.maxy:c.maxy;var x=s.aabb,v=a.aabb,z=h.aabb;x.minx=z.minx>v.minx?v.minx:z.minx,x.miny=z.miny>v.miny?v.miny:z.miny,x.maxx=v.maxx>z.maxx?v.maxx:z.maxx,x.maxy=v.maxy>z.maxy?v.maxy:z.maxy;var y=p.height,f=_.height;a.height=1+(y>f?y:f);var m=a.height,b=h.height;s.height=1+(m>b?m:b)}else{s.child2=_,a.child2=h,h.parent=a;var g=a.aabb,w=p.aabb,C=h.aabb;g.minx=C.minx>w.minx?w.minx:C.minx,g.miny=C.miny>w.miny?w.miny:C.miny,g.maxx=w.maxx>C.maxx?w.maxx:C.maxx,g.maxy=w.maxy>C.maxy?w.maxy:C.maxy;var M=s.aabb,k=a.aabb,O=_.aabb;M.minx=O.minx>k.minx?k.minx:O.minx,M.miny=O.miny>k.miny?k.miny:O.miny,M.maxx=k.maxx>O.maxx?k.maxx:O.maxx,M.maxy=k.maxy>O.maxy?k.maxy:O.maxy;var S=p.height,P=h.height;a.height=1+(S>P?S:P);var T=a.height,A=_.height;s.height=1+(T>A?T:A)}a=s}else if(-1>o){var E=p.child1,I=p.child2;if(p.child1=a,p.parent=a.parent,a.parent=p,null!=p.parent?p.parent.child1==a?p.parent.child1=p:p.parent.child2=p:this.root=p,E.height>I.height){p.child2=E,a.child1=I,I.parent=a;var V=a.aabb,L=s.aabb,N=I.aabb;V.minx=N.minx>L.minx?L.minx:N.minx,V.miny=N.miny>L.miny?L.miny:N.miny,V.maxx=L.maxx>N.maxx?L.maxx:N.maxx,V.maxy=L.maxy>N.maxy?L.maxy:N.maxy;var D=p.aabb,j=a.aabb,F=E.aabb;D.minx=F.minx>j.minx?j.minx:F.minx,D.miny=F.miny>j.miny?j.miny:F.miny,D.maxx=j.maxx>F.maxx?j.maxx:F.maxx,D.maxy=j.maxy>F.maxy?j.maxy:F.maxy;var B=s.height,R=I.height;a.height=1+(B>R?B:R);var G=a.height,Y=E.height;p.height=1+(G>Y?G:Y)}else{p.child2=I,a.child1=E,E.parent=a;var U=a.aabb,Z=s.aabb,q=E.aabb;U.minx=q.minx>Z.minx?Z.minx:q.minx,U.miny=q.miny>Z.miny?Z.miny:q.miny,U.maxx=Z.maxx>q.maxx?Z.maxx:q.maxx,U.maxy=Z.maxy>q.maxy?Z.maxy:q.maxy;var W=p.aabb,X=a.aabb,H=I.aabb;W.minx=H.minx>X.minx?X.minx:H.minx,W.miny=H.miny>X.miny?X.miny:H.miny,W.maxx=X.maxx>H.maxx?X.maxx:H.maxx,W.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var K=s.height,J=E.height;a.height=1+(K>J?K:J);var Q=a.height,$=I.height;p.height=1+(Q>$?Q:$)}a=p}else a=a}var nn=a.child1,en=a.child2,tn=a.aabb,ln=nn.aabb,rn=en.aabb;tn.minx=rn.minx>ln.minx?ln.minx:rn.minx,tn.miny=rn.miny>ln.miny?ln.miny:rn.miny,tn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,tn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy;var an=nn.height,pn=en.height;a.height=1+(an>pn?an:pn),a=a.parent}}else{this.root=i,i.parent=null;var sn=e;sn.height=-1;var on=sn.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Ze.zpp_pool,Ze.zpp_pool=on,sn.child1=sn.child2=sn.parent=null,sn.next=null,sn.snext=null,sn.mnext=null,sn.next=Dt.zpp_pool,Dt.zpp_pool=sn}}},inlined_removeLeaf:function(n){if(n==this.root)return void(this.root=null);var e=n.parent,t=e.parent,i=e.child1==n?e.child2:e.child1;if(null!=t){t.child1==e?t.child1=i:t.child2=i,i.parent=t;var l=e;l.height=-1;var r=l.aabb;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Ze.zpp_pool,Ze.zpp_pool=r,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=Dt.zpp_pool,Dt.zpp_pool=l;for(var a=t;null!=a;){if(null==a.child1||2>a.height)a=a;else{var p=a.child1,s=a.child2,o=s.height-p.height;if(o>1){var h=s.child1,_=s.child2;if(s.child1=a,s.parent=a.parent,a.parent=s,null!=s.parent?s.parent.child1==a?s.parent.child1=s:s.parent.child2=s:this.root=s,h.height>_.height){s.child2=h,a.child2=_,_.parent=a;var u=a.aabb,d=p.aabb,c=_.aabb;u.minx=c.minx>d.minx?d.minx:c.minx,u.miny=c.miny>d.miny?d.miny:c.miny,u.maxx=d.maxx>c.maxx?d.maxx:c.maxx,u.maxy=d.maxy>c.maxy?d.maxy:c.maxy;var x=s.aabb,v=a.aabb,z=h.aabb;x.minx=z.minx>v.minx?v.minx:z.minx,x.miny=z.miny>v.miny?v.miny:z.miny,x.maxx=v.maxx>z.maxx?v.maxx:z.maxx,x.maxy=v.maxy>z.maxy?v.maxy:z.maxy;var y=p.height,f=_.height;a.height=1+(y>f?y:f);var m=a.height,b=h.height;s.height=1+(m>b?m:b)}else{s.child2=_,a.child2=h,h.parent=a;var g=a.aabb,w=p.aabb,C=h.aabb;g.minx=C.minx>w.minx?w.minx:C.minx,g.miny=C.miny>w.miny?w.miny:C.miny,g.maxx=w.maxx>C.maxx?w.maxx:C.maxx,g.maxy=w.maxy>C.maxy?w.maxy:C.maxy;var M=s.aabb,k=a.aabb,O=_.aabb;M.minx=O.minx>k.minx?k.minx:O.minx,M.miny=O.miny>k.miny?k.miny:O.miny,M.maxx=k.maxx>O.maxx?k.maxx:O.maxx,M.maxy=k.maxy>O.maxy?k.maxy:O.maxy;var S=p.height,P=h.height;a.height=1+(S>P?S:P);var T=a.height,A=_.height;s.height=1+(T>A?T:A)}a=s}else if(-1>o){var E=p.child1,I=p.child2;if(p.child1=a,p.parent=a.parent,a.parent=p,null!=p.parent?p.parent.child1==a?p.parent.child1=p:p.parent.child2=p:this.root=p,E.height>I.height){p.child2=E,a.child1=I,I.parent=a;var V=a.aabb,L=s.aabb,N=I.aabb;V.minx=N.minx>L.minx?L.minx:N.minx,V.miny=N.miny>L.miny?L.miny:N.miny,V.maxx=L.maxx>N.maxx?L.maxx:N.maxx,V.maxy=L.maxy>N.maxy?L.maxy:N.maxy;var D=p.aabb,j=a.aabb,F=E.aabb;D.minx=F.minx>j.minx?j.minx:F.minx,D.miny=F.miny>j.miny?j.miny:F.miny,D.maxx=j.maxx>F.maxx?j.maxx:F.maxx,D.maxy=j.maxy>F.maxy?j.maxy:F.maxy;var B=s.height,R=I.height;a.height=1+(B>R?B:R);var G=a.height,Y=E.height;p.height=1+(G>Y?G:Y)}else{p.child2=I,a.child1=E,E.parent=a;var U=a.aabb,Z=s.aabb,q=E.aabb;U.minx=q.minx>Z.minx?Z.minx:q.minx,U.miny=q.miny>Z.miny?Z.miny:q.miny,U.maxx=Z.maxx>q.maxx?Z.maxx:q.maxx,U.maxy=Z.maxy>q.maxy?Z.maxy:q.maxy;var W=p.aabb,X=a.aabb,H=I.aabb;W.minx=H.minx>X.minx?X.minx:H.minx,W.miny=H.miny>X.miny?X.miny:H.miny,W.maxx=X.maxx>H.maxx?X.maxx:H.maxx,W.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var K=s.height,J=E.height;a.height=1+(K>J?K:J);var Q=a.height,$=I.height;p.height=1+(Q>$?Q:$)}a=p}else a=a}var nn=a.child1,en=a.child2,tn=a.aabb,ln=nn.aabb,rn=en.aabb;tn.minx=rn.minx>ln.minx?ln.minx:rn.minx,tn.miny=rn.miny>ln.miny?ln.miny:rn.miny,tn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,tn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy;var an=nn.height,pn=en.height;a.height=1+(an>pn?an:pn),a=a.parent}}else{this.root=i,i.parent=null;var sn=e;sn.height=-1;var on=sn.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Ze.zpp_pool,Ze.zpp_pool=on,sn.child1=sn.child2=sn.parent=null,sn.next=null,sn.snext=null,sn.mnext=null,sn.next=Dt.zpp_pool,Dt.zpp_pool=sn}},balance:function(n){if(null==n.child1||2>n.height)return n;var e=n.child1,t=n.child2,i=t.height-e.height;if(i>1){var l=t.child1,r=t.child2;if(t.child1=n,t.parent=n.parent,n.parent=t,null!=t.parent?t.parent.child1==n?t.parent.child1=t:t.parent.child2=t:this.root=t,l.height>r.height){t.child2=l,n.child2=r,r.parent=n;var a=n.aabb,p=e.aabb,s=r.aabb;a.minx=s.minx>p.minx?p.minx:s.minx,a.miny=s.miny>p.miny?p.miny:s.miny,a.maxx=p.maxx>s.maxx?p.maxx:s.maxx,a.maxy=p.maxy>s.maxy?p.maxy:s.maxy;var o=t.aabb,h=n.aabb,_=l.aabb;o.minx=_.minx>h.minx?h.minx:_.minx,o.miny=_.miny>h.miny?h.miny:_.miny,o.maxx=h.maxx>_.maxx?h.maxx:_.maxx,o.maxy=h.maxy>_.maxy?h.maxy:_.maxy;var u=e.height,d=r.height;n.height=1+(u>d?u:d);var c=n.height,x=l.height;t.height=1+(c>x?c:x)}else{t.child2=r,n.child2=l,l.parent=n;var v=n.aabb,z=e.aabb,y=l.aabb;v.minx=y.minx>z.minx?z.minx:y.minx,v.miny=y.miny>z.miny?z.miny:y.miny,v.maxx=z.maxx>y.maxx?z.maxx:y.maxx,v.maxy=z.maxy>y.maxy?z.maxy:y.maxy;var f=t.aabb,m=n.aabb,b=r.aabb;f.minx=b.minx>m.minx?m.minx:b.minx,f.miny=b.miny>m.miny?m.miny:b.miny,f.maxx=m.maxx>b.maxx?m.maxx:b.maxx,f.maxy=m.maxy>b.maxy?m.maxy:b.maxy;var g=e.height,w=l.height;n.height=1+(g>w?g:w);var C=n.height,M=r.height;t.height=1+(C>M?C:M)}return t}if(-1>i){var k=e.child1,O=e.child2;if(e.child1=n,e.parent=n.parent,n.parent=e,null!=e.parent?e.parent.child1==n?e.parent.child1=e:e.parent.child2=e:this.root=e,k.height>O.height){e.child2=k,n.child1=O,O.parent=n;var S=n.aabb,P=t.aabb,T=O.aabb;S.minx=T.minx>P.minx?P.minx:T.minx,S.miny=T.miny>P.miny?P.miny:T.miny,S.maxx=P.maxx>T.maxx?P.maxx:T.maxx,S.maxy=P.maxy>T.maxy?P.maxy:T.maxy;var A=e.aabb,E=n.aabb,I=k.aabb;A.minx=I.minx>E.minx?E.minx:I.minx,A.miny=I.miny>E.miny?E.miny:I.miny,A.maxx=E.maxx>I.maxx?E.maxx:I.maxx,A.maxy=E.maxy>I.maxy?E.maxy:I.maxy;var V=t.height,L=O.height;n.height=1+(V>L?V:L);var N=n.height,D=k.height;e.height=1+(N>D?N:D)}else{e.child2=O,n.child1=k,k.parent=n;var j=n.aabb,F=t.aabb,B=k.aabb;j.minx=B.minx>F.minx?F.minx:B.minx,j.miny=B.miny>F.miny?F.miny:B.miny,j.maxx=F.maxx>B.maxx?F.maxx:B.maxx,j.maxy=F.maxy>B.maxy?F.maxy:B.maxy;var R=e.aabb,G=n.aabb,Y=O.aabb;R.minx=Y.minx>G.minx?G.minx:Y.minx,R.miny=Y.miny>G.miny?G.miny:Y.miny,R.maxx=G.maxx>Y.maxx?G.maxx:Y.maxx,R.maxy=G.maxy>Y.maxy?G.maxy:Y.maxy;var U=t.height,Z=k.height;n.height=1+(U>Z?U:Z);var q=n.height,W=O.height;e.height=1+(q>W?q:W)}return e}return n},__class__:Ft};var Bt=function(n){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,Nt.call(this),this.space=n,this.is_sweep=!1,this.dynab=this,this.stree=new Ft,this.dtree=new Ft};l["zpp_nape.space.ZPP_DynAABBPhase"]=Bt,Bt.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],Bt.__super__=Nt,Bt.prototype=e(Nt.prototype,{stree:null,dtree:null,pairs:null,syncs:null,moves:null,dyn:function(n){return n.body.type!=ye.id_BodyType_STATIC&&!n.body.component.sleeping},__insert:function(n){var e;null==Dt.zpp_pool?e=new Dt:(e=Dt.zpp_pool,Dt.zpp_pool=e.next,e.next=null),null==Ze.zpp_pool?e.aabb=new Ze:(e.aabb=Ze.zpp_pool,Ze.zpp_pool=e.aabb.next,e.aabb.next=null);e.moved=!1,e.synced=!1,e.first_sync=!1,e.shape=n,n.node=e,e.synced=!0,e.first_sync=!0,e.snext=this.syncs,this.syncs=e},__remove:function(n){var e=n.node;if(e.first_sync||(e.dyn?this.dtree.removeLeaf(e):this.stree.removeLeaf(e)),n.node=null,e.synced){for(var t=null,i=this.syncs;null!=i&&i!=e;)t=i,i=i.snext;null==t?this.syncs=i.snext:t.snext=i.snext,i.snext=null,e.synced=!1}if(e.moved){for(var l=null,r=this.moves;null!=r&&r!=e;)l=r,r=r.mnext;null==l?this.moves=r.mnext:l.mnext=r.mnext,r.mnext=null,e.moved=!1}for(var a=null,p=this.pairs;null!=p;){var s=p.next;if(p.n1!=e&&p.n2!=e)a=p,p=s;else{null==a?this.pairs=s:a.next=s,null!=p.arb&&(p.arb.pair=null),p.arb=null,p.n1.shape.pairs.remove(p),p.n2.shape.pairs.remove(p);var o=p;o.n1=o.n2=null,o.sleeping=!1,o.next=jt.zpp_pool,jt.zpp_pool=o,p=s}}for(;null!=n.pairs.head;){var h=n.pairs.pop_unsafe();h.n1==e?h.n2.shape.pairs.remove(h):h.n1.shape.pairs.remove(h),null!=h.arb&&(h.arb.pair=null),h.arb=null;var _=h;_.n1=_.n2=null,_.sleeping=!1,_.next=jt.zpp_pool,jt.zpp_pool=_}var u=e;u.height=-1;var d=u.aabb;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d.wrap_min=d.wrap_max=null,d._invalidate=null,d._validate=null,d.next=Ze.zpp_pool,Ze.zpp_pool=d,u.child1=u.child2=u.parent=null,u.next=null,u.snext=null,u.mnext=null,u.next=Dt.zpp_pool,Dt.zpp_pool=u},__sync:function(n){var e=n.node;if(!e.synced){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,t.type==ye.id_ShapeType_POLYGON){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var l=0,r=i.lverts.next,a=r;r=r.next;var p=r;for(r=r.next;null!=r;){var s=r;l+=p.x*(s.y-a.y);var o=s.y*p.x-s.x*p.y;i.localCOMx+=(p.x+s.x)*o,i.localCOMy+=(p.y+s.y)*o,a=p,p=s,r=r.next}r=i.lverts.next;var h=r;l+=p.x*(h.y-a.y);var _=h.y*p.x-h.x*p.y;i.localCOMx+=(p.x+h.x)*_,i.localCOMy+=(p.y+h.y)*_,a=p,p=h,r=r.next;var u=r;l+=p.x*(u.y-a.y);var d=u.y*p.x-u.x*p.y;i.localCOMx+=(p.x+u.x)*d,i.localCOMy+=(p.y+u.y)*d,l=1/(3*l);var c=l;i.localCOMx*=c,i.localCOMy*=c}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var x=t.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var v=t.radius,z=t.radius;t.aabb.minx=t.worldCOMx-v,t.aabb.miny=t.worldCOMy-z,t.aabb.maxx=t.worldCOMx+v,t.aabb.maxy=t.worldCOMy+z}else{var y=n.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var f=y.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=y.lverts.next,b=y.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=y.body.posx+(y.body.axisy*w.x-y.body.axisx*w.y),g.y=y.body.posy+(w.x*y.body.axisx+w.y*y.body.axisy),b=b.next}}var C=y.gverts.next;y.aabb.minx=C.x,y.aabb.miny=C.y,y.aabb.maxx=C.x,y.aabb.maxy=C.y;for(var M=y.gverts.next.next;null!=M;){var k=M;y.aabb.minx>k.x&&(y.aabb.minx=k.x),k.x>y.aabb.maxx&&(y.aabb.maxx=k.x),y.aabb.miny>k.y&&(y.aabb.miny=k.y),k.y>y.aabb.maxy&&(y.aabb.maxy=k.y),M=M.next}}var O;if(e.dyn==(n.body.type!=ye.id_BodyType_STATIC&&!n.body.component.sleeping)){var S=e.aabb,P=n.aabb;O=!!(S.minx>P.minx||S.miny>P.miny||P.maxx>S.maxx||P.maxy>S.maxy)}else O=!0;O&&(e.synced=!0,e.snext=this.syncs,this.syncs=e)}},sync_broadphase:function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var n=this.syncs;null!=n;){var e=n.shape;if(n.first_sync)n.first_sync=!1;else{var t=n.dyn?this.dtree:this.stree;if(n==t.root)t.root=null;else{var i=n.parent,l=i.parent,r=i.child1==n?i.child2:i.child1;if(null!=l){l.child1==i?l.child1=r:l.child2=r,r.parent=l;var a=i;a.height=-1;var p=a.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Ze.zpp_pool,Ze.zpp_pool=p,a.child1=a.child2=a.parent=null,a.next=null,a.snext=null,a.mnext=null,a.next=Dt.zpp_pool,Dt.zpp_pool=a;for(var s=l;null!=s;){if(null==s.child1||2>s.height)s=s;else{var o=s.child1,h=s.child2,_=h.height-o.height;if(_>1){var u=h.child1,d=h.child2;if(h.child1=s,h.parent=s.parent,s.parent=h,null!=h.parent?h.parent.child1==s?h.parent.child1=h:h.parent.child2=h:t.root=h,u.height>d.height){h.child2=u,s.child2=d,d.parent=s;var c=s.aabb,x=o.aabb,v=d.aabb;c.minx=v.minx>x.minx?x.minx:v.minx,c.miny=v.miny>x.miny?x.miny:v.miny,c.maxx=x.maxx>v.maxx?x.maxx:v.maxx,c.maxy=x.maxy>v.maxy?x.maxy:v.maxy;var z=h.aabb,y=s.aabb,f=u.aabb;z.minx=f.minx>y.minx?y.minx:f.minx,z.miny=f.miny>y.miny?y.miny:f.miny,z.maxx=y.maxx>f.maxx?y.maxx:f.maxx,z.maxy=y.maxy>f.maxy?y.maxy:f.maxy;var m=o.height,b=d.height;s.height=1+(m>b?m:b);var g=s.height,w=u.height;h.height=1+(g>w?g:w)}else{h.child2=d,s.child2=u,u.parent=s;var C=s.aabb,M=o.aabb,k=u.aabb;C.minx=k.minx>M.minx?M.minx:k.minx,C.miny=k.miny>M.miny?M.miny:k.miny,C.maxx=M.maxx>k.maxx?M.maxx:k.maxx,C.maxy=M.maxy>k.maxy?M.maxy:k.maxy;var O=h.aabb,S=s.aabb,P=d.aabb;O.minx=P.minx>S.minx?S.minx:P.minx,O.miny=P.miny>S.miny?S.miny:P.miny,O.maxx=S.maxx>P.maxx?S.maxx:P.maxx,O.maxy=S.maxy>P.maxy?S.maxy:P.maxy;var T=o.height,A=u.height;s.height=1+(T>A?T:A);var E=s.height,I=d.height;h.height=1+(E>I?E:I)}s=h}else if(-1>_){var V=o.child1,L=o.child2;if(o.child1=s,o.parent=s.parent,s.parent=o,null!=o.parent?o.parent.child1==s?o.parent.child1=o:o.parent.child2=o:t.root=o,V.height>L.height){o.child2=V,s.child1=L,L.parent=s;var N=s.aabb,D=h.aabb,j=L.aabb;N.minx=j.minx>D.minx?D.minx:j.minx,N.miny=j.miny>D.miny?D.miny:j.miny,N.maxx=D.maxx>j.maxx?D.maxx:j.maxx,N.maxy=D.maxy>j.maxy?D.maxy:j.maxy;var F=o.aabb,B=s.aabb,R=V.aabb;F.minx=R.minx>B.minx?B.minx:R.minx,F.miny=R.miny>B.miny?B.miny:R.miny,F.maxx=B.maxx>R.maxx?B.maxx:R.maxx,F.maxy=B.maxy>R.maxy?B.maxy:R.maxy;var G=h.height,Y=L.height;s.height=1+(G>Y?G:Y);var U=s.height,Z=V.height;o.height=1+(U>Z?U:Z)}else{o.child2=L,s.child1=V,V.parent=s;var q=s.aabb,W=h.aabb,X=V.aabb;q.minx=X.minx>W.minx?W.minx:X.minx,q.miny=X.miny>W.miny?W.miny:X.miny,q.maxx=W.maxx>X.maxx?W.maxx:X.maxx,q.maxy=W.maxy>X.maxy?W.maxy:X.maxy;var H=o.aabb,K=s.aabb,J=L.aabb;H.minx=J.minx>K.minx?K.minx:J.minx,H.miny=J.miny>K.miny?K.miny:J.miny,H.maxx=K.maxx>J.maxx?K.maxx:J.maxx,H.maxy=K.maxy>J.maxy?K.maxy:J.maxy;var Q=h.height,$=V.height;s.height=1+(Q>$?Q:$);var nn=s.height,en=L.height;o.height=1+(nn>en?nn:en)}s=o}else s=s}var tn=s.child1,ln=s.child2,rn=s.aabb,an=tn.aabb,pn=ln.aabb;rn.minx=pn.minx>an.minx?an.minx:pn.minx,rn.miny=pn.miny>an.miny?an.miny:pn.miny,rn.maxx=an.maxx>pn.maxx?an.maxx:pn.maxx,rn.maxy=an.maxy>pn.maxy?an.maxy:pn.maxy;var sn=tn.height,on=ln.height;s.height=1+(sn>on?sn:on),s=s.parent}}else{t.root=r,r.parent=null;var hn=i;hn.height=-1;var _n=hn.aabb;null!=_n.outer&&(_n.outer.zpp_inner=null,_n.outer=null),_n.wrap_min=_n.wrap_max=null,_n._invalidate=null,_n._validate=null,_n.next=Ze.zpp_pool,Ze.zpp_pool=_n,hn.child1=hn.child2=hn.parent=null,hn.next=null,hn.snext=null,hn.mnext=null,hn.next=Dt.zpp_pool,Dt.zpp_pool=hn}}}var un=n.aabb;if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==ye.id_ShapeType_CIRCLE){var dn=e.circle;if(dn.zip_worldCOM&&null!=dn.body){if(dn.zip_worldCOM=!1,dn.zip_localCOM){if(dn.zip_localCOM=!1,dn.type==ye.id_ShapeType_POLYGON){var cn=dn.polygon;if(null==cn.lverts.next.next)cn.localCOMx=cn.lverts.next.x,cn.localCOMy=cn.lverts.next.y;else if(null==cn.lverts.next.next.next){cn.localCOMx=cn.lverts.next.x,cn.localCOMy=cn.lverts.next.y;cn.localCOMx+=1*cn.lverts.next.next.x,cn.localCOMy+=1*cn.lverts.next.next.y;cn.localCOMx*=.5,cn.localCOMy*=.5}else{cn.localCOMx=0,cn.localCOMy=0;var xn=0,vn=cn.lverts.next,zn=vn;vn=vn.next;var yn=vn;for(vn=vn.next;null!=vn;){var fn=vn;xn+=yn.x*(fn.y-zn.y);var mn=fn.y*yn.x-fn.x*yn.y;cn.localCOMx+=(yn.x+fn.x)*mn,cn.localCOMy+=(yn.y+fn.y)*mn,zn=yn,yn=fn,vn=vn.next}vn=cn.lverts.next;var bn=vn;xn+=yn.x*(bn.y-zn.y);var gn=bn.y*yn.x-bn.x*yn.y;cn.localCOMx+=(yn.x+bn.x)*gn,cn.localCOMy+=(yn.y+bn.y)*gn,zn=yn,yn=bn,vn=vn.next;var wn=vn;xn+=yn.x*(wn.y-zn.y);var Cn=wn.y*yn.x-wn.x*yn.y;cn.localCOMx+=(yn.x+wn.x)*Cn,cn.localCOMy+=(yn.y+wn.y)*Cn,xn=1/(3*xn);var Mn=xn;cn.localCOMx*=Mn,cn.localCOMy*=Mn}}null!=dn.wrap_localCOM&&(dn.wrap_localCOM.zpp_inner.x=dn.localCOMx,dn.wrap_localCOM.zpp_inner.y=dn.localCOMy)}var kn=dn.body;kn.zip_axis&&(kn.zip_axis=!1,kn.axisx=Math.sin(kn.rot),kn.axisy=Math.cos(kn.rot)),dn.worldCOMx=dn.body.posx+(dn.body.axisy*dn.localCOMx-dn.body.axisx*dn.localCOMy),dn.worldCOMy=dn.body.posy+(dn.localCOMx*dn.body.axisx+dn.localCOMy*dn.body.axisy)}var On=dn.radius,Sn=dn.radius;dn.aabb.minx=dn.worldCOMx-On,dn.aabb.miny=dn.worldCOMy-Sn,dn.aabb.maxx=dn.worldCOMx+On,dn.aabb.maxy=dn.worldCOMy+Sn}else{var Pn=e.polygon;if(Pn.zip_gverts&&null!=Pn.body){Pn.zip_gverts=!1,Pn.validate_lverts();var Tn=Pn.body;Tn.zip_axis&&(Tn.zip_axis=!1,Tn.axisx=Math.sin(Tn.rot),Tn.axisy=Math.cos(Tn.rot));for(var An=Pn.lverts.next,En=Pn.gverts.next;null!=En;){var In=En,Vn=An;An=An.next,In.x=Pn.body.posx+(Pn.body.axisy*Vn.x-Pn.body.axisx*Vn.y),In.y=Pn.body.posy+(Vn.x*Pn.body.axisx+Vn.y*Pn.body.axisy),En=En.next}}var Ln=Pn.gverts.next;Pn.aabb.minx=Ln.x,Pn.aabb.miny=Ln.y,Pn.aabb.maxx=Ln.x,Pn.aabb.maxy=Ln.y;for(var Nn=Pn.gverts.next.next;null!=Nn;){var Dn=Nn;Pn.aabb.minx>Dn.x&&(Pn.aabb.minx=Dn.x),Dn.x>Pn.aabb.maxx&&(Pn.aabb.maxx=Dn.x),Pn.aabb.miny>Dn.y&&(Pn.aabb.miny=Dn.y),Dn.y>Pn.aabb.maxy&&(Pn.aabb.maxy=Dn.y),Nn=Nn.next}}var jn=e.aabb;un.minx=jn.minx-3,un.miny=jn.miny-3,un.maxx=jn.maxx+3,un.maxy=jn.maxy+3;var Fn=(n.dyn=e.body.type!=ye.id_BodyType_STATIC&&!e.body.component.sleeping)?this.dtree:this.stree;if(null==Fn.root)Fn.root=n,Fn.root.parent=null;else{for(var Bn=n.aabb,Rn=Fn.root;null!=Rn.child1;){var Gn=Rn.child1,Yn=Rn.child2,Un=Rn.aabb,Zn=2*(Un.maxx-Un.minx+(Un.maxy-Un.miny)),qn=Ft.tmpaabb,Wn=Rn.aabb;qn.minx=Bn.minx>Wn.minx?Wn.minx:Bn.minx,qn.miny=Bn.miny>Wn.miny?Wn.miny:Bn.miny,qn.maxx=Wn.maxx>Bn.maxx?Wn.maxx:Bn.maxx,qn.maxy=Wn.maxy>Bn.maxy?Wn.maxy:Bn.maxy;var Xn=Ft.tmpaabb,Hn=2*(Xn.maxx-Xn.minx+(Xn.maxy-Xn.miny)),Kn=2*Hn,Jn=2*(Hn-Zn),Qn=Ft.tmpaabb,$n=Gn.aabb;Qn.minx=$n.minx>Bn.minx?Bn.minx:$n.minx,Qn.miny=$n.miny>Bn.miny?Bn.miny:$n.miny,Qn.maxx=Bn.maxx>$n.maxx?Bn.maxx:$n.maxx,Qn.maxy=Bn.maxy>$n.maxy?Bn.maxy:$n.maxy;var ne;if(null==Gn.child1){var ee=Ft.tmpaabb;ne=2*(ee.maxx-ee.minx+(ee.maxy-ee.miny))+Jn}else{var te=Gn.aabb,ie=2*(te.maxx-te.minx+(te.maxy-te.miny)),le=Ft.tmpaabb,re=2*(le.maxx-le.minx+(le.maxy-le.miny));ne=re-ie+Jn}var ae=Ft.tmpaabb,pe=Yn.aabb;ae.minx=pe.minx>Bn.minx?Bn.minx:pe.minx,ae.miny=pe.miny>Bn.miny?Bn.miny:pe.miny,ae.maxx=Bn.maxx>pe.maxx?Bn.maxx:pe.maxx,ae.maxy=Bn.maxy>pe.maxy?Bn.maxy:pe.maxy;var se;if(null==Yn.child1){var oe=Ft.tmpaabb;se=2*(oe.maxx-oe.minx+(oe.maxy-oe.miny))+Jn}else{var he=Yn.aabb,_e=2*(he.maxx-he.minx+(he.maxy-he.miny)),ue=Ft.tmpaabb,de=2*(ue.maxx-ue.minx+(ue.maxy-ue.miny));se=de-_e+Jn}if(ne>Kn&&se>Kn)break;Rn=se>ne?Gn:Yn}var ce,xe=Rn,ve=xe.parent;null==Dt.zpp_pool?ce=new Dt:(ce=Dt.zpp_pool,Dt.zpp_pool=ce.next,ce.next=null),null==Ze.zpp_pool?ce.aabb=new Ze:(ce.aabb=Ze.zpp_pool,Ze.zpp_pool=ce.aabb.next,ce.aabb.next=null);ce.moved=!1,ce.synced=!1,ce.first_sync=!1,ce.parent=ve;var ze=ce.aabb,fe=xe.aabb;for(ze.minx=fe.minx>Bn.minx?Bn.minx:fe.minx,ze.miny=fe.miny>Bn.miny?Bn.miny:fe.miny,ze.maxx=Bn.maxx>fe.maxx?Bn.maxx:fe.maxx,ze.maxy=Bn.maxy>fe.maxy?Bn.maxy:fe.maxy,ce.height=xe.height+1,null!=ve?(ve.child1==xe?ve.child1=ce:ve.child2=ce,ce.child1=xe,ce.child2=n,xe.parent=ce,n.parent=ce):(ce.child1=xe,ce.child2=n,xe.parent=ce,n.parent=ce,Fn.root=ce),Rn=n.parent;null!=Rn;){if(null==Rn.child1||2>Rn.height)Rn=Rn;else{var me=Rn.child1,be=Rn.child2,ge=be.height-me.height;if(ge>1){var we=be.child1,Ce=be.child2;if(be.child1=Rn,be.parent=Rn.parent,Rn.parent=be,null!=be.parent?be.parent.child1==Rn?be.parent.child1=be:be.parent.child2=be:Fn.root=be,we.height>Ce.height){be.child2=we,Rn.child2=Ce,Ce.parent=Rn;var Me=Rn.aabb,ke=me.aabb,Oe=Ce.aabb;Me.minx=Oe.minx>ke.minx?ke.minx:Oe.minx,Me.miny=Oe.miny>ke.miny?ke.miny:Oe.miny,Me.maxx=ke.maxx>Oe.maxx?ke.maxx:Oe.maxx,Me.maxy=ke.maxy>Oe.maxy?ke.maxy:Oe.maxy;var Se=be.aabb,Pe=Rn.aabb,Te=we.aabb;Se.minx=Te.minx>Pe.minx?Pe.minx:Te.minx,Se.miny=Te.miny>Pe.miny?Pe.miny:Te.miny,Se.maxx=Pe.maxx>Te.maxx?Pe.maxx:Te.maxx,Se.maxy=Pe.maxy>Te.maxy?Pe.maxy:Te.maxy;var Ae=me.height,Ee=Ce.height;Rn.height=1+(Ae>Ee?Ae:Ee);var Ie=Rn.height,Ve=we.height;be.height=1+(Ie>Ve?Ie:Ve)}else{be.child2=Ce,Rn.child2=we,we.parent=Rn;var Le=Rn.aabb,Ne=me.aabb,De=we.aabb;Le.minx=De.minx>Ne.minx?Ne.minx:De.minx,Le.miny=De.miny>Ne.miny?Ne.miny:De.miny,Le.maxx=Ne.maxx>De.maxx?Ne.maxx:De.maxx,Le.maxy=Ne.maxy>De.maxy?Ne.maxy:De.maxy;var je=be.aabb,Fe=Rn.aabb,Be=Ce.aabb;je.minx=Be.minx>Fe.minx?Fe.minx:Be.minx,je.miny=Be.miny>Fe.miny?Fe.miny:Be.miny,je.maxx=Fe.maxx>Be.maxx?Fe.maxx:Be.maxx,je.maxy=Fe.maxy>Be.maxy?Fe.maxy:Be.maxy;var Re=me.height,Ge=we.height;Rn.height=1+(Re>Ge?Re:Ge);var Ye=Rn.height,Ue=Ce.height;be.height=1+(Ye>Ue?Ye:Ue)}Rn=be}else if(-1>ge){var qe=me.child1,We=me.child2;if(me.child1=Rn,me.parent=Rn.parent,Rn.parent=me,null!=me.parent?me.parent.child1==Rn?me.parent.child1=me:me.parent.child2=me:Fn.root=me,qe.height>We.height){me.child2=qe,Rn.child1=We,We.parent=Rn;var Xe=Rn.aabb,He=be.aabb,Ke=We.aabb;Xe.minx=Ke.minx>He.minx?He.minx:Ke.minx,Xe.miny=Ke.miny>He.miny?He.miny:Ke.miny,Xe.maxx=He.maxx>Ke.maxx?He.maxx:Ke.maxx,Xe.maxy=He.maxy>Ke.maxy?He.maxy:Ke.maxy;var Je=me.aabb,Qe=Rn.aabb,$e=qe.aabb;Je.minx=$e.minx>Qe.minx?Qe.minx:$e.minx,Je.miny=$e.miny>Qe.miny?Qe.miny:$e.miny,Je.maxx=Qe.maxx>$e.maxx?Qe.maxx:$e.maxx,Je.maxy=Qe.maxy>$e.maxy?Qe.maxy:$e.maxy;var nt=be.height,et=We.height;Rn.height=1+(nt>et?nt:et);var tt=Rn.height,it=qe.height;me.height=1+(tt>it?tt:it)}else{me.child2=We,Rn.child1=qe,qe.parent=Rn;var lt=Rn.aabb,rt=be.aabb,at=qe.aabb;lt.minx=at.minx>rt.minx?rt.minx:at.minx,lt.miny=at.miny>rt.miny?rt.miny:at.miny,lt.maxx=rt.maxx>at.maxx?rt.maxx:at.maxx,lt.maxy=rt.maxy>at.maxy?rt.maxy:at.maxy;var pt=me.aabb,st=Rn.aabb,ot=We.aabb;pt.minx=ot.minx>st.minx?st.minx:ot.minx,pt.miny=ot.miny>st.miny?st.miny:ot.miny,pt.maxx=st.maxx>ot.maxx?st.maxx:ot.maxx,pt.maxy=st.maxy>ot.maxy?st.maxy:ot.maxy;var ht=be.height,_t=qe.height;Rn.height=1+(ht>_t?ht:_t);var ut=Rn.height,dt=We.height;me.height=1+(ut>dt?ut:dt)}Rn=me}else Rn=Rn}var ct=Rn.child1,xt=Rn.child2,vt=ct.height,zt=xt.height;Rn.height=1+(vt>zt?vt:zt);var yt=Rn.aabb,ft=ct.aabb,mt=xt.aabb;yt.minx=mt.minx>ft.minx?ft.minx:mt.minx,yt.miny=mt.miny>ft.miny?ft.miny:mt.miny,yt.maxx=ft.maxx>mt.maxx?ft.maxx:mt.maxx,yt.maxy=ft.maxy>mt.maxy?ft.maxy:mt.maxy,Rn=Rn.parent}}n.synced=!1,n.moved=!0,n.mnext=n.snext,n.snext=null,n=n.mnext}var bt=this.syncs;this.syncs=this.moves,this.moves=bt}else for(;null!=this.syncs;){var gt=this.syncs;this.syncs=gt.snext,gt.snext=null;var wt=gt,Ct=wt.shape;if(wt.first_sync)wt.first_sync=!1;else{var Mt=wt.dyn?this.dtree:this.stree;if(wt==Mt.root)Mt.root=null;else{var kt=wt.parent,Ot=kt.parent,St=kt.child1==wt?kt.child2:kt.child1;if(null!=Ot){Ot.child1==kt?Ot.child1=St:Ot.child2=St,St.parent=Ot;var Pt=kt;Pt.height=-1;var Tt=Pt.aabb;null!=Tt.outer&&(Tt.outer.zpp_inner=null,Tt.outer=null),Tt.wrap_min=Tt.wrap_max=null,Tt._invalidate=null,Tt._validate=null,Tt.next=Ze.zpp_pool,Ze.zpp_pool=Tt,Pt.child1=Pt.child2=Pt.parent=null,Pt.next=null,Pt.snext=null,Pt.mnext=null,Pt.next=Dt.zpp_pool,Dt.zpp_pool=Pt;for(var At=Ot;null!=At;){if(null==At.child1||2>At.height)At=At;else{var Et=At.child1,It=At.child2,Vt=It.height-Et.height;if(Vt>1){var Lt=It.child1,Nt=It.child2;if(It.child1=At,It.parent=At.parent,At.parent=It,null!=It.parent?It.parent.child1==At?It.parent.child1=It:It.parent.child2=It:Mt.root=It,Lt.height>Nt.height){It.child2=Lt,At.child2=Nt,Nt.parent=At;var jt=At.aabb,Bt=Et.aabb,Rt=Nt.aabb;jt.minx=Rt.minx>Bt.minx?Bt.minx:Rt.minx,jt.miny=Rt.miny>Bt.miny?Bt.miny:Rt.miny,jt.maxx=Bt.maxx>Rt.maxx?Bt.maxx:Rt.maxx,jt.maxy=Bt.maxy>Rt.maxy?Bt.maxy:Rt.maxy;var Gt=It.aabb,Yt=At.aabb,Ut=Lt.aabb;Gt.minx=Ut.minx>Yt.minx?Yt.minx:Ut.minx,Gt.miny=Ut.miny>Yt.miny?Yt.miny:Ut.miny,Gt.maxx=Yt.maxx>Ut.maxx?Yt.maxx:Ut.maxx,Gt.maxy=Yt.maxy>Ut.maxy?Yt.maxy:Ut.maxy;var Zt=Et.height,qt=Nt.height;At.height=1+(Zt>qt?Zt:qt);var Wt=At.height,Xt=Lt.height;It.height=1+(Wt>Xt?Wt:Xt)}else{It.child2=Nt,At.child2=Lt,Lt.parent=At;var Ht=At.aabb,Kt=Et.aabb,Jt=Lt.aabb;Ht.minx=Jt.minx>Kt.minx?Kt.minx:Jt.minx,Ht.miny=Jt.miny>Kt.miny?Kt.miny:Jt.miny,Ht.maxx=Kt.maxx>Jt.maxx?Kt.maxx:Jt.maxx,Ht.maxy=Kt.maxy>Jt.maxy?Kt.maxy:Jt.maxy;var Qt=It.aabb,$t=At.aabb,ni=Nt.aabb;Qt.minx=ni.minx>$t.minx?$t.minx:ni.minx,Qt.miny=ni.miny>$t.miny?$t.miny:ni.miny,Qt.maxx=$t.maxx>ni.maxx?$t.maxx:ni.maxx,Qt.maxy=$t.maxy>ni.maxy?$t.maxy:ni.maxy;var ei=Et.height,ti=Lt.height;At.height=1+(ei>ti?ei:ti);var ii=At.height,li=Nt.height;It.height=1+(ii>li?ii:li)}At=It}else if(-1>Vt){var ri=Et.child1,ai=Et.child2;if(Et.child1=At,Et.parent=At.parent,At.parent=Et,null!=Et.parent?Et.parent.child1==At?Et.parent.child1=Et:Et.parent.child2=Et:Mt.root=Et,ri.height>ai.height){Et.child2=ri,At.child1=ai,ai.parent=At;var pi=At.aabb,si=It.aabb,oi=ai.aabb;pi.minx=oi.minx>si.minx?si.minx:oi.minx,pi.miny=oi.miny>si.miny?si.miny:oi.miny,pi.maxx=si.maxx>oi.maxx?si.maxx:oi.maxx,pi.maxy=si.maxy>oi.maxy?si.maxy:oi.maxy;var hi=Et.aabb,_i=At.aabb,ui=ri.aabb;hi.minx=ui.minx>_i.minx?_i.minx:ui.minx,hi.miny=ui.miny>_i.miny?_i.miny:ui.miny,hi.maxx=_i.maxx>ui.maxx?_i.maxx:ui.maxx,hi.maxy=_i.maxy>ui.maxy?_i.maxy:ui.maxy;var di=It.height,ci=ai.height;At.height=1+(di>ci?di:ci);var xi=At.height,vi=ri.height;Et.height=1+(xi>vi?xi:vi)}else{Et.child2=ai,At.child1=ri,ri.parent=At;var zi=At.aabb,yi=It.aabb,fi=ri.aabb;zi.minx=fi.minx>yi.minx?yi.minx:fi.minx,zi.miny=fi.miny>yi.miny?yi.miny:fi.miny,zi.maxx=yi.maxx>fi.maxx?yi.maxx:fi.maxx,zi.maxy=yi.maxy>fi.maxy?yi.maxy:fi.maxy;var mi=Et.aabb,bi=At.aabb,gi=ai.aabb;mi.minx=gi.minx>bi.minx?bi.minx:gi.minx,mi.miny=gi.miny>bi.miny?bi.miny:gi.miny,mi.maxx=bi.maxx>gi.maxx?bi.maxx:gi.maxx,mi.maxy=bi.maxy>gi.maxy?bi.maxy:gi.maxy;var wi=It.height,Ci=ri.height;At.height=1+(wi>Ci?wi:Ci);var Mi=At.height,ki=ai.height;Et.height=1+(Mi>ki?Mi:ki)}At=Et}else At=At}var Oi=At.child1,Si=At.child2,Pi=At.aabb,Ti=Oi.aabb,Ai=Si.aabb;Pi.minx=Ai.minx>Ti.minx?Ti.minx:Ai.minx,Pi.miny=Ai.miny>Ti.miny?Ti.miny:Ai.miny,Pi.maxx=Ti.maxx>Ai.maxx?Ti.maxx:Ai.maxx,Pi.maxy=Ti.maxy>Ai.maxy?Ti.maxy:Ai.maxy;var Ei=Oi.height,Ii=Si.height;At.height=1+(Ei>Ii?Ei:Ii),At=At.parent}}else{Mt.root=St,St.parent=null;var Vi=kt;Vi.height=-1;var Li=Vi.aabb;null!=Li.outer&&(Li.outer.zpp_inner=null,Li.outer=null),Li.wrap_min=Li.wrap_max=null,Li._invalidate=null,Li._validate=null,Li.next=Ze.zpp_pool,Ze.zpp_pool=Li,Vi.child1=Vi.child2=Vi.parent=null,Vi.next=null,Vi.snext=null,Vi.mnext=null,Vi.next=Dt.zpp_pool,Dt.zpp_pool=Vi}}}var Ni=wt.aabb;if(!this.space.continuous&&Ct.zip_aabb&&null!=Ct.body)if(Ct.zip_aabb=!1,Ct.type==ye.id_ShapeType_CIRCLE){var Di=Ct.circle;if(Di.zip_worldCOM&&null!=Di.body){if(Di.zip_worldCOM=!1,Di.zip_localCOM){if(Di.zip_localCOM=!1,Di.type==ye.id_ShapeType_POLYGON){var ji=Di.polygon;if(null==ji.lverts.next.next)ji.localCOMx=ji.lverts.next.x,ji.localCOMy=ji.lverts.next.y;else if(null==ji.lverts.next.next.next){ji.localCOMx=ji.lverts.next.x,ji.localCOMy=ji.lverts.next.y;ji.localCOMx+=1*ji.lverts.next.next.x,ji.localCOMy+=1*ji.lverts.next.next.y;ji.localCOMx*=.5,ji.localCOMy*=.5}else{ji.localCOMx=0,ji.localCOMy=0;var Fi=0,Bi=ji.lverts.next,Ri=Bi;Bi=Bi.next;var Gi=Bi;for(Bi=Bi.next;null!=Bi;){var Yi=Bi;Fi+=Gi.x*(Yi.y-Ri.y);var Ui=Yi.y*Gi.x-Yi.x*Gi.y;ji.localCOMx+=(Gi.x+Yi.x)*Ui,ji.localCOMy+=(Gi.y+Yi.y)*Ui,Ri=Gi,Gi=Yi,Bi=Bi.next}Bi=ji.lverts.next;var Zi=Bi;Fi+=Gi.x*(Zi.y-Ri.y);var qi=Zi.y*Gi.x-Zi.x*Gi.y;ji.localCOMx+=(Gi.x+Zi.x)*qi,ji.localCOMy+=(Gi.y+Zi.y)*qi,Ri=Gi,Gi=Zi,Bi=Bi.next;var Wi=Bi;Fi+=Gi.x*(Wi.y-Ri.y);var Xi=Wi.y*Gi.x-Wi.x*Gi.y;ji.localCOMx+=(Gi.x+Wi.x)*Xi,ji.localCOMy+=(Gi.y+Wi.y)*Xi,Fi=1/(3*Fi);var Hi=Fi;ji.localCOMx*=Hi,ji.localCOMy*=Hi}}null!=Di.wrap_localCOM&&(Di.wrap_localCOM.zpp_inner.x=Di.localCOMx,Di.wrap_localCOM.zpp_inner.y=Di.localCOMy)}var Ki=Di.body;Ki.zip_axis&&(Ki.zip_axis=!1,Ki.axisx=Math.sin(Ki.rot),Ki.axisy=Math.cos(Ki.rot)),Di.worldCOMx=Di.body.posx+(Di.body.axisy*Di.localCOMx-Di.body.axisx*Di.localCOMy),Di.worldCOMy=Di.body.posy+(Di.localCOMx*Di.body.axisx+Di.localCOMy*Di.body.axisy)}var Ji=Di.radius,Qi=Di.radius;Di.aabb.minx=Di.worldCOMx-Ji,Di.aabb.miny=Di.worldCOMy-Qi,Di.aabb.maxx=Di.worldCOMx+Ji,Di.aabb.maxy=Di.worldCOMy+Qi}else{var $i=Ct.polygon;if($i.zip_gverts&&null!=$i.body){$i.zip_gverts=!1,$i.validate_lverts();var nl=$i.body;nl.zip_axis&&(nl.zip_axis=!1,nl.axisx=Math.sin(nl.rot),nl.axisy=Math.cos(nl.rot));for(var el=$i.lverts.next,tl=$i.gverts.next;null!=tl;){var il=tl,ll=el;el=el.next,il.x=$i.body.posx+($i.body.axisy*ll.x-$i.body.axisx*ll.y),il.y=$i.body.posy+(ll.x*$i.body.axisx+ll.y*$i.body.axisy),tl=tl.next}}var rl=$i.gverts.next;$i.aabb.minx=rl.x,$i.aabb.miny=rl.y,$i.aabb.maxx=rl.x,$i.aabb.maxy=rl.y;for(var al=$i.gverts.next.next;null!=al;){var pl=al;$i.aabb.minx>pl.x&&($i.aabb.minx=pl.x),pl.x>$i.aabb.maxx&&($i.aabb.maxx=pl.x),$i.aabb.miny>pl.y&&($i.aabb.miny=pl.y),pl.y>$i.aabb.maxy&&($i.aabb.maxy=pl.y),al=al.next}}var sl=Ct.aabb;Ni.minx=sl.minx-3,Ni.miny=sl.miny-3,Ni.maxx=sl.maxx+3,Ni.maxy=sl.maxy+3;var ol=(wt.dyn=Ct.body.type!=ye.id_BodyType_STATIC&&!Ct.body.component.sleeping)?this.dtree:this.stree;if(null==ol.root)ol.root=wt,ol.root.parent=null;else{for(var hl=wt.aabb,_l=ol.root;null!=_l.child1;){var ul=_l.child1,dl=_l.child2,cl=_l.aabb,xl=2*(cl.maxx-cl.minx+(cl.maxy-cl.miny)),vl=Ft.tmpaabb,zl=_l.aabb;vl.minx=hl.minx>zl.minx?zl.minx:hl.minx,vl.miny=hl.miny>zl.miny?zl.miny:hl.miny,vl.maxx=zl.maxx>hl.maxx?zl.maxx:hl.maxx,vl.maxy=zl.maxy>hl.maxy?zl.maxy:hl.maxy;var yl=Ft.tmpaabb,fl=2*(yl.maxx-yl.minx+(yl.maxy-yl.miny)),ml=2*fl,bl=2*(fl-xl),gl=Ft.tmpaabb,wl=ul.aabb;gl.minx=wl.minx>hl.minx?hl.minx:wl.minx,gl.miny=wl.miny>hl.miny?hl.miny:wl.miny,gl.maxx=hl.maxx>wl.maxx?hl.maxx:wl.maxx,gl.maxy=hl.maxy>wl.maxy?hl.maxy:wl.maxy;var Cl;if(null==ul.child1){var Ml=Ft.tmpaabb;Cl=2*(Ml.maxx-Ml.minx+(Ml.maxy-Ml.miny))+bl}else{var kl=ul.aabb,Ol=2*(kl.maxx-kl.minx+(kl.maxy-kl.miny)),Sl=Ft.tmpaabb,Pl=2*(Sl.maxx-Sl.minx+(Sl.maxy-Sl.miny));Cl=Pl-Ol+bl}var Tl=Ft.tmpaabb,Al=dl.aabb;Tl.minx=Al.minx>hl.minx?hl.minx:Al.minx,Tl.miny=Al.miny>hl.miny?hl.miny:Al.miny,Tl.maxx=hl.maxx>Al.maxx?hl.maxx:Al.maxx,Tl.maxy=hl.maxy>Al.maxy?hl.maxy:Al.maxy;var El;if(null==dl.child1){var Il=Ft.tmpaabb;El=2*(Il.maxx-Il.minx+(Il.maxy-Il.miny))+bl}else{var Vl=dl.aabb,Ll=2*(Vl.maxx-Vl.minx+(Vl.maxy-Vl.miny)),Nl=Ft.tmpaabb,Dl=2*(Nl.maxx-Nl.minx+(Nl.maxy-Nl.miny));El=Dl-Ll+bl}if(Cl>ml&&El>ml)break;_l=El>Cl?ul:dl}var jl,Fl=_l,Bl=Fl.parent;null==Dt.zpp_pool?jl=new Dt:(jl=Dt.zpp_pool,Dt.zpp_pool=jl.next,jl.next=null),null==Ze.zpp_pool?jl.aabb=new Ze:(jl.aabb=Ze.zpp_pool,Ze.zpp_pool=jl.aabb.next,jl.aabb.next=null);jl.moved=!1,jl.synced=!1,jl.first_sync=!1,jl.parent=Bl;var Rl=jl.aabb,Gl=Fl.aabb;for(Rl.minx=Gl.minx>hl.minx?hl.minx:Gl.minx,Rl.miny=Gl.miny>hl.miny?hl.miny:Gl.miny,Rl.maxx=hl.maxx>Gl.maxx?hl.maxx:Gl.maxx,Rl.maxy=hl.maxy>Gl.maxy?hl.maxy:Gl.maxy,jl.height=Fl.height+1,null!=Bl?(Bl.child1==Fl?Bl.child1=jl:Bl.child2=jl,jl.child1=Fl,jl.child2=wt,Fl.parent=jl,wt.parent=jl):(jl.child1=Fl,jl.child2=wt,Fl.parent=jl,wt.parent=jl,ol.root=jl),_l=wt.parent;null!=_l;){if(null==_l.child1||2>_l.height)_l=_l;else{var Yl=_l.child1,Ul=_l.child2,Zl=Ul.height-Yl.height;if(Zl>1){var ql=Ul.child1,Wl=Ul.child2;if(Ul.child1=_l,Ul.parent=_l.parent,_l.parent=Ul,null!=Ul.parent?Ul.parent.child1==_l?Ul.parent.child1=Ul:Ul.parent.child2=Ul:ol.root=Ul,ql.height>Wl.height){Ul.child2=ql,_l.child2=Wl,Wl.parent=_l;var Xl=_l.aabb,Hl=Yl.aabb,Kl=Wl.aabb;Xl.minx=Kl.minx>Hl.minx?Hl.minx:Kl.minx,Xl.miny=Kl.miny>Hl.miny?Hl.miny:Kl.miny,Xl.maxx=Hl.maxx>Kl.maxx?Hl.maxx:Kl.maxx,Xl.maxy=Hl.maxy>Kl.maxy?Hl.maxy:Kl.maxy;var Jl=Ul.aabb,Ql=_l.aabb,$l=ql.aabb;Jl.minx=$l.minx>Ql.minx?Ql.minx:$l.minx,Jl.miny=$l.miny>Ql.miny?Ql.miny:$l.miny,Jl.maxx=Ql.maxx>$l.maxx?Ql.maxx:$l.maxx,Jl.maxy=Ql.maxy>$l.maxy?Ql.maxy:$l.maxy;var nr=Yl.height,er=Wl.height;_l.height=1+(nr>er?nr:er);var tr=_l.height,ir=ql.height;Ul.height=1+(tr>ir?tr:ir)}else{Ul.child2=Wl,_l.child2=ql,ql.parent=_l;var lr=_l.aabb,rr=Yl.aabb,ar=ql.aabb;lr.minx=ar.minx>rr.minx?rr.minx:ar.minx,lr.miny=ar.miny>rr.miny?rr.miny:ar.miny,lr.maxx=rr.maxx>ar.maxx?rr.maxx:ar.maxx,lr.maxy=rr.maxy>ar.maxy?rr.maxy:ar.maxy;var pr=Ul.aabb,sr=_l.aabb,or=Wl.aabb;pr.minx=or.minx>sr.minx?sr.minx:or.minx,pr.miny=or.miny>sr.miny?sr.miny:or.miny,pr.maxx=sr.maxx>or.maxx?sr.maxx:or.maxx,pr.maxy=sr.maxy>or.maxy?sr.maxy:or.maxy;var hr=Yl.height,_r=ql.height;_l.height=1+(hr>_r?hr:_r);var ur=_l.height,dr=Wl.height;Ul.height=1+(ur>dr?ur:dr)}_l=Ul}else if(-1>Zl){var cr=Yl.child1,xr=Yl.child2;if(Yl.child1=_l,Yl.parent=_l.parent,_l.parent=Yl,null!=Yl.parent?Yl.parent.child1==_l?Yl.parent.child1=Yl:Yl.parent.child2=Yl:ol.root=Yl,cr.height>xr.height){Yl.child2=cr,_l.child1=xr,xr.parent=_l;var vr=_l.aabb,zr=Ul.aabb,yr=xr.aabb;vr.minx=yr.minx>zr.minx?zr.minx:yr.minx,vr.miny=yr.miny>zr.miny?zr.miny:yr.miny,vr.maxx=zr.maxx>yr.maxx?zr.maxx:yr.maxx,vr.maxy=zr.maxy>yr.maxy?zr.maxy:yr.maxy;var fr=Yl.aabb,mr=_l.aabb,br=cr.aabb;fr.minx=br.minx>mr.minx?mr.minx:br.minx,fr.miny=br.miny>mr.miny?mr.miny:br.miny,fr.maxx=mr.maxx>br.maxx?mr.maxx:br.maxx,fr.maxy=mr.maxy>br.maxy?mr.maxy:br.maxy;var gr=Ul.height,wr=xr.height;_l.height=1+(gr>wr?gr:wr);var Cr=_l.height,Mr=cr.height;Yl.height=1+(Cr>Mr?Cr:Mr)}else{Yl.child2=xr,_l.child1=cr,cr.parent=_l;var kr=_l.aabb,Or=Ul.aabb,Sr=cr.aabb;kr.minx=Sr.minx>Or.minx?Or.minx:Sr.minx,kr.miny=Sr.miny>Or.miny?Or.miny:Sr.miny,kr.maxx=Or.maxx>Sr.maxx?Or.maxx:Sr.maxx,kr.maxy=Or.maxy>Sr.maxy?Or.maxy:Sr.maxy;var Pr=Yl.aabb,Tr=_l.aabb,Ar=xr.aabb;Pr.minx=Ar.minx>Tr.minx?Tr.minx:Ar.minx,Pr.miny=Ar.miny>Tr.miny?Tr.miny:Ar.miny,Pr.maxx=Tr.maxx>Ar.maxx?Tr.maxx:Ar.maxx,Pr.maxy=Tr.maxy>Ar.maxy?Tr.maxy:Ar.maxy;var Er=Ul.height,Ir=cr.height;_l.height=1+(Er>Ir?Er:Ir);var Vr=_l.height,Lr=xr.height;Yl.height=1+(Vr>Lr?Vr:Lr)}_l=Yl}else _l=_l}var Nr=_l.child1,Dr=_l.child2,jr=Nr.height,Fr=Dr.height;_l.height=1+(jr>Fr?jr:Fr);var Br=_l.aabb,Rr=Nr.aabb,Gr=Dr.aabb;Br.minx=Gr.minx>Rr.minx?Rr.minx:Gr.minx,Br.miny=Gr.miny>Rr.miny?Rr.miny:Gr.miny,Br.maxx=Rr.maxx>Gr.maxx?Rr.maxx:Gr.maxx,Br.maxy=Rr.maxy>Gr.maxy?Rr.maxy:Gr.maxy,_l=_l.parent}}wt.synced=!1,wt.moved||(wt.moved=!0,wt.mnext=this.moves,this.moves=wt)}},broadphase:function(n,e){for(var t=this.syncs;null!=t;){var i=t.shape;if(t.first_sync)t.first_sync=!1;else{var l=t.dyn?this.dtree:this.stree;if(t==l.root)l.root=null;else{var r=t.parent,a=r.parent,p=r.child1==t?r.child2:r.child1;if(null!=a){a.child1==r?a.child1=p:a.child2=p,p.parent=a;var s=r;s.height=-1;var o=s.aabb;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o.wrap_min=o.wrap_max=null,o._invalidate=null,o._validate=null,o.next=Ze.zpp_pool,Ze.zpp_pool=o,s.child1=s.child2=s.parent=null,s.next=null,s.snext=null,s.mnext=null,s.next=Dt.zpp_pool,Dt.zpp_pool=s;for(var h=a;null!=h;){if(null==h.child1||2>h.height)h=h;else{var _=h.child1,u=h.child2,d=u.height-_.height;if(d>1){var c=u.child1,x=u.child2;if(u.child1=h,u.parent=h.parent,h.parent=u,null!=u.parent?u.parent.child1==h?u.parent.child1=u:u.parent.child2=u:l.root=u,c.height>x.height){u.child2=c,h.child2=x,x.parent=h;var v=h.aabb,z=_.aabb,y=x.aabb;v.minx=y.minx>z.minx?z.minx:y.minx,v.miny=y.miny>z.miny?z.miny:y.miny,v.maxx=z.maxx>y.maxx?z.maxx:y.maxx,v.maxy=z.maxy>y.maxy?z.maxy:y.maxy;var f=u.aabb,m=h.aabb,b=c.aabb;f.minx=b.minx>m.minx?m.minx:b.minx,f.miny=b.miny>m.miny?m.miny:b.miny,f.maxx=m.maxx>b.maxx?m.maxx:b.maxx,f.maxy=m.maxy>b.maxy?m.maxy:b.maxy;var g=_.height,w=x.height;h.height=1+(g>w?g:w);var C=h.height,M=c.height;u.height=1+(C>M?C:M)}else{u.child2=x,h.child2=c,c.parent=h;var k=h.aabb,O=_.aabb,S=c.aabb;k.minx=S.minx>O.minx?O.minx:S.minx,k.miny=S.miny>O.miny?O.miny:S.miny,k.maxx=O.maxx>S.maxx?O.maxx:S.maxx,k.maxy=O.maxy>S.maxy?O.maxy:S.maxy;var P=u.aabb,T=h.aabb,A=x.aabb;P.minx=A.minx>T.minx?T.minx:A.minx,P.miny=A.miny>T.miny?T.miny:A.miny,P.maxx=T.maxx>A.maxx?T.maxx:A.maxx,P.maxy=T.maxy>A.maxy?T.maxy:A.maxy;var E=_.height,I=c.height;h.height=1+(E>I?E:I);var V=h.height,L=x.height;u.height=1+(V>L?V:L)}h=u}else if(-1>d){var N=_.child1,D=_.child2;if(_.child1=h,_.parent=h.parent,h.parent=_,null!=_.parent?_.parent.child1==h?_.parent.child1=_:_.parent.child2=_:l.root=_,N.height>D.height){_.child2=N,h.child1=D,D.parent=h;var j=h.aabb,F=u.aabb,B=D.aabb;j.minx=B.minx>F.minx?F.minx:B.minx,j.miny=B.miny>F.miny?F.miny:B.miny,j.maxx=F.maxx>B.maxx?F.maxx:B.maxx,j.maxy=F.maxy>B.maxy?F.maxy:B.maxy;var R=_.aabb,G=h.aabb,Y=N.aabb;R.minx=Y.minx>G.minx?G.minx:Y.minx,R.miny=Y.miny>G.miny?G.miny:Y.miny,R.maxx=G.maxx>Y.maxx?G.maxx:Y.maxx,R.maxy=G.maxy>Y.maxy?G.maxy:Y.maxy;var U=u.height,Z=D.height;h.height=1+(U>Z?U:Z);var q=h.height,W=N.height;_.height=1+(q>W?q:W)}else{_.child2=D,h.child1=N,N.parent=h;var X=h.aabb,H=u.aabb,K=N.aabb;X.minx=K.minx>H.minx?H.minx:K.minx,X.miny=K.miny>H.miny?H.miny:K.miny,X.maxx=H.maxx>K.maxx?H.maxx:K.maxx,X.maxy=H.maxy>K.maxy?H.maxy:K.maxy;var J=_.aabb,Q=h.aabb,$=D.aabb;J.minx=$.minx>Q.minx?Q.minx:$.minx,J.miny=$.miny>Q.miny?Q.miny:$.miny,J.maxx=Q.maxx>$.maxx?Q.maxx:$.maxx,J.maxy=Q.maxy>$.maxy?Q.maxy:$.maxy;var nn=u.height,en=N.height;h.height=1+(nn>en?nn:en);var tn=h.height,ln=D.height;_.height=1+(tn>ln?tn:ln)}h=_}else h=h}var rn=h.child1,an=h.child2,pn=h.aabb,sn=rn.aabb,on=an.aabb;pn.minx=on.minx>sn.minx?sn.minx:on.minx,pn.miny=on.miny>sn.miny?sn.miny:on.miny,pn.maxx=sn.maxx>on.maxx?sn.maxx:on.maxx,pn.maxy=sn.maxy>on.maxy?sn.maxy:on.maxy;var hn=rn.height,_n=an.height;h.height=1+(hn>_n?hn:_n),h=h.parent}}else{l.root=p,p.parent=null;var un=r;un.height=-1;var dn=un.aabb;null!=dn.outer&&(dn.outer.zpp_inner=null,dn.outer=null),dn.wrap_min=dn.wrap_max=null,dn._invalidate=null,dn._validate=null,dn.next=Ze.zpp_pool,Ze.zpp_pool=dn,un.child1=un.child2=un.parent=null,un.next=null,un.snext=null,un.mnext=null,un.next=Dt.zpp_pool,Dt.zpp_pool=un}}}var cn=t.aabb;if(!n.continuous&&i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,i.type==ye.id_ShapeType_CIRCLE){var xn=i.circle;if(xn.zip_worldCOM&&null!=xn.body){if(xn.zip_worldCOM=!1,xn.zip_localCOM){if(xn.zip_localCOM=!1,xn.type==ye.id_ShapeType_POLYGON){var vn=xn.polygon;if(null==vn.lverts.next.next)vn.localCOMx=vn.lverts.next.x,vn.localCOMy=vn.lverts.next.y;else if(null==vn.lverts.next.next.next){vn.localCOMx=vn.lverts.next.x,vn.localCOMy=vn.lverts.next.y;vn.localCOMx+=1*vn.lverts.next.next.x,vn.localCOMy+=1*vn.lverts.next.next.y;vn.localCOMx*=.5,vn.localCOMy*=.5}else{vn.localCOMx=0,vn.localCOMy=0;var zn=0,yn=vn.lverts.next,fn=yn;yn=yn.next;var mn=yn;for(yn=yn.next;null!=yn;){var bn=yn;zn+=mn.x*(bn.y-fn.y);var gn=bn.y*mn.x-bn.x*mn.y;vn.localCOMx+=(mn.x+bn.x)*gn,vn.localCOMy+=(mn.y+bn.y)*gn,fn=mn,mn=bn,yn=yn.next}yn=vn.lverts.next;var wn=yn;zn+=mn.x*(wn.y-fn.y);var Cn=wn.y*mn.x-wn.x*mn.y;vn.localCOMx+=(mn.x+wn.x)*Cn,vn.localCOMy+=(mn.y+wn.y)*Cn,fn=mn,mn=wn,yn=yn.next;var Mn=yn;zn+=mn.x*(Mn.y-fn.y);var kn=Mn.y*mn.x-Mn.x*mn.y;vn.localCOMx+=(mn.x+Mn.x)*kn,vn.localCOMy+=(mn.y+Mn.y)*kn,zn=1/(3*zn);var On=zn;vn.localCOMx*=On,vn.localCOMy*=On}}null!=xn.wrap_localCOM&&(xn.wrap_localCOM.zpp_inner.x=xn.localCOMx,xn.wrap_localCOM.zpp_inner.y=xn.localCOMy)}var Sn=xn.body;Sn.zip_axis&&(Sn.zip_axis=!1,Sn.axisx=Math.sin(Sn.rot),Sn.axisy=Math.cos(Sn.rot)),xn.worldCOMx=xn.body.posx+(xn.body.axisy*xn.localCOMx-xn.body.axisx*xn.localCOMy),xn.worldCOMy=xn.body.posy+(xn.localCOMx*xn.body.axisx+xn.localCOMy*xn.body.axisy)}var Pn=xn.radius,Tn=xn.radius;xn.aabb.minx=xn.worldCOMx-Pn,xn.aabb.miny=xn.worldCOMy-Tn,xn.aabb.maxx=xn.worldCOMx+Pn,xn.aabb.maxy=xn.worldCOMy+Tn}else{var An=i.polygon;if(An.zip_gverts&&null!=An.body){An.zip_gverts=!1,An.validate_lverts();var En=An.body;En.zip_axis&&(En.zip_axis=!1,En.axisx=Math.sin(En.rot),En.axisy=Math.cos(En.rot));for(var In=An.lverts.next,Vn=An.gverts.next;null!=Vn;){var Ln=Vn,Nn=In;In=In.next,Ln.x=An.body.posx+(An.body.axisy*Nn.x-An.body.axisx*Nn.y),Ln.y=An.body.posy+(Nn.x*An.body.axisx+Nn.y*An.body.axisy),Vn=Vn.next}}var Dn=An.gverts.next;An.aabb.minx=Dn.x,An.aabb.miny=Dn.y,An.aabb.maxx=Dn.x,An.aabb.maxy=Dn.y;for(var jn=An.gverts.next.next;null!=jn;){var Fn=jn;An.aabb.minx>Fn.x&&(An.aabb.minx=Fn.x),Fn.x>An.aabb.maxx&&(An.aabb.maxx=Fn.x),An.aabb.miny>Fn.y&&(An.aabb.miny=Fn.y),Fn.y>An.aabb.maxy&&(An.aabb.maxy=Fn.y),jn=jn.next}}var Bn=i.aabb;cn.minx=Bn.minx-3,cn.miny=Bn.miny-3,cn.maxx=Bn.maxx+3,cn.maxy=Bn.maxy+3;var Rn=(t.dyn=i.body.type!=ye.id_BodyType_STATIC&&!i.body.component.sleeping)?this.dtree:this.stree;if(null==Rn.root)Rn.root=t,Rn.root.parent=null;else{for(var Gn=t.aabb,Yn=Rn.root;null!=Yn.child1;){var Un=Yn.child1,Zn=Yn.child2,qn=Yn.aabb,Wn=2*(qn.maxx-qn.minx+(qn.maxy-qn.miny)),Xn=Ft.tmpaabb,Hn=Yn.aabb;Xn.minx=Gn.minx>Hn.minx?Hn.minx:Gn.minx,Xn.miny=Gn.miny>Hn.miny?Hn.miny:Gn.miny,Xn.maxx=Hn.maxx>Gn.maxx?Hn.maxx:Gn.maxx,Xn.maxy=Hn.maxy>Gn.maxy?Hn.maxy:Gn.maxy;var Kn=Ft.tmpaabb,Jn=2*(Kn.maxx-Kn.minx+(Kn.maxy-Kn.miny)),Qn=2*Jn,$n=2*(Jn-Wn),ne=Ft.tmpaabb,ee=Un.aabb;ne.minx=ee.minx>Gn.minx?Gn.minx:ee.minx,ne.miny=ee.miny>Gn.miny?Gn.miny:ee.miny,ne.maxx=Gn.maxx>ee.maxx?Gn.maxx:ee.maxx,ne.maxy=Gn.maxy>ee.maxy?Gn.maxy:ee.maxy;var te;if(null==Un.child1){var ie=Ft.tmpaabb;te=2*(ie.maxx-ie.minx+(ie.maxy-ie.miny))+$n}else{var le=Un.aabb,re=2*(le.maxx-le.minx+(le.maxy-le.miny)),ae=Ft.tmpaabb;te=2*(ae.maxx-ae.minx+(ae.maxy-ae.miny))-re+$n}var pe=Ft.tmpaabb,se=Zn.aabb;pe.minx=se.minx>Gn.minx?Gn.minx:se.minx,pe.miny=se.miny>Gn.miny?Gn.miny:se.miny,pe.maxx=Gn.maxx>se.maxx?Gn.maxx:se.maxx,pe.maxy=Gn.maxy>se.maxy?Gn.maxy:se.maxy;var oe;if(null==Zn.child1){var he=Ft.tmpaabb;oe=2*(he.maxx-he.minx+(he.maxy-he.miny))+$n}else{var _e=Zn.aabb,ue=2*(_e.maxx-_e.minx+(_e.maxy-_e.miny)),de=Ft.tmpaabb;oe=2*(de.maxx-de.minx+(de.maxy-de.miny))-ue+$n}if(te>Qn&&oe>Qn)break;Yn=oe>te?Un:Zn}var ce,xe=Yn,ve=xe.parent;null==Dt.zpp_pool?ce=new Dt:(ce=Dt.zpp_pool,Dt.zpp_pool=ce.next,ce.next=null),null==Ze.zpp_pool?ce.aabb=new Ze:(ce.aabb=Ze.zpp_pool,Ze.zpp_pool=ce.aabb.next,ce.aabb.next=null);ce.moved=!1,ce.synced=!1,ce.first_sync=!1,ce.parent=ve;var ze=ce.aabb,fe=xe.aabb;for(ze.minx=fe.minx>Gn.minx?Gn.minx:fe.minx,ze.miny=fe.miny>Gn.miny?Gn.miny:fe.miny,ze.maxx=Gn.maxx>fe.maxx?Gn.maxx:fe.maxx,ze.maxy=Gn.maxy>fe.maxy?Gn.maxy:fe.maxy,ce.height=xe.height+1,null!=ve?(ve.child1==xe?ve.child1=ce:ve.child2=ce,ce.child1=xe,ce.child2=t,xe.parent=ce,t.parent=ce):(ce.child1=xe,ce.child2=t,xe.parent=ce,t.parent=ce,Rn.root=ce),Yn=t.parent;null!=Yn;){if(null==Yn.child1||2>Yn.height)Yn=Yn;else{var me=Yn.child1,be=Yn.child2,ge=be.height-me.height;if(ge>1){var we=be.child1,Ce=be.child2;if(be.child1=Yn,be.parent=Yn.parent,Yn.parent=be,null!=be.parent?be.parent.child1==Yn?be.parent.child1=be:be.parent.child2=be:Rn.root=be,we.height>Ce.height){be.child2=we,Yn.child2=Ce,Ce.parent=Yn;var Me=Yn.aabb,ke=me.aabb,Oe=Ce.aabb;Me.minx=Oe.minx>ke.minx?ke.minx:Oe.minx,Me.miny=Oe.miny>ke.miny?ke.miny:Oe.miny,Me.maxx=ke.maxx>Oe.maxx?ke.maxx:Oe.maxx,Me.maxy=ke.maxy>Oe.maxy?ke.maxy:Oe.maxy;var Se=be.aabb,Pe=Yn.aabb,Te=we.aabb;Se.minx=Te.minx>Pe.minx?Pe.minx:Te.minx,Se.miny=Te.miny>Pe.miny?Pe.miny:Te.miny,Se.maxx=Pe.maxx>Te.maxx?Pe.maxx:Te.maxx,Se.maxy=Pe.maxy>Te.maxy?Pe.maxy:Te.maxy;var Ae=me.height,Ee=Ce.height;Yn.height=1+(Ae>Ee?Ae:Ee);var Ie=Yn.height,Ve=we.height;be.height=1+(Ie>Ve?Ie:Ve)}else{be.child2=Ce,Yn.child2=we,we.parent=Yn;var Le=Yn.aabb,Ne=me.aabb,De=we.aabb;Le.minx=De.minx>Ne.minx?Ne.minx:De.minx,Le.miny=De.miny>Ne.miny?Ne.miny:De.miny,Le.maxx=Ne.maxx>De.maxx?Ne.maxx:De.maxx,Le.maxy=Ne.maxy>De.maxy?Ne.maxy:De.maxy;var je=be.aabb,Fe=Yn.aabb,Be=Ce.aabb;je.minx=Be.minx>Fe.minx?Fe.minx:Be.minx,je.miny=Be.miny>Fe.miny?Fe.miny:Be.miny,je.maxx=Fe.maxx>Be.maxx?Fe.maxx:Be.maxx,je.maxy=Fe.maxy>Be.maxy?Fe.maxy:Be.maxy;var Re=me.height,Ge=we.height;Yn.height=1+(Re>Ge?Re:Ge);var Ye=Yn.height,Ue=Ce.height;be.height=1+(Ye>Ue?Ye:Ue)}Yn=be}else if(-1>ge){var qe=me.child1,We=me.child2;if(me.child1=Yn,me.parent=Yn.parent,Yn.parent=me,null!=me.parent?me.parent.child1==Yn?me.parent.child1=me:me.parent.child2=me:Rn.root=me,qe.height>We.height){me.child2=qe,Yn.child1=We,We.parent=Yn;var Xe=Yn.aabb,He=be.aabb,Ke=We.aabb;Xe.minx=Ke.minx>He.minx?He.minx:Ke.minx,Xe.miny=Ke.miny>He.miny?He.miny:Ke.miny,Xe.maxx=He.maxx>Ke.maxx?He.maxx:Ke.maxx,Xe.maxy=He.maxy>Ke.maxy?He.maxy:Ke.maxy;var Je=me.aabb,Qe=Yn.aabb,$e=qe.aabb;Je.minx=$e.minx>Qe.minx?Qe.minx:$e.minx,Je.miny=$e.miny>Qe.miny?Qe.miny:$e.miny,Je.maxx=Qe.maxx>$e.maxx?Qe.maxx:$e.maxx,Je.maxy=Qe.maxy>$e.maxy?Qe.maxy:$e.maxy;var nt=be.height,et=We.height;Yn.height=1+(nt>et?nt:et);var tt=Yn.height,it=qe.height;me.height=1+(tt>it?tt:it)}else{me.child2=We,Yn.child1=qe,qe.parent=Yn;var lt=Yn.aabb,rt=be.aabb,at=qe.aabb;lt.minx=at.minx>rt.minx?rt.minx:at.minx,lt.miny=at.miny>rt.miny?rt.miny:at.miny,lt.maxx=rt.maxx>at.maxx?rt.maxx:at.maxx,lt.maxy=rt.maxy>at.maxy?rt.maxy:at.maxy;var pt=me.aabb,st=Yn.aabb,ot=We.aabb;pt.minx=ot.minx>st.minx?st.minx:ot.minx,pt.miny=ot.miny>st.miny?st.miny:ot.miny,pt.maxx=st.maxx>ot.maxx?st.maxx:ot.maxx,pt.maxy=st.maxy>ot.maxy?st.maxy:ot.maxy;var ht=be.height,_t=qe.height;Yn.height=1+(ht>_t?ht:_t);var ut=Yn.height,dt=We.height;me.height=1+(ut>dt?ut:dt)}Yn=me}else Yn=Yn}var ct=Yn.child1,xt=Yn.child2,vt=ct.height,zt=xt.height;Yn.height=1+(vt>zt?vt:zt);var yt=Yn.aabb,ft=ct.aabb,mt=xt.aabb;yt.minx=mt.minx>ft.minx?ft.minx:mt.minx,yt.miny=mt.miny>ft.miny?ft.miny:mt.miny,yt.maxx=ft.maxx>mt.maxx?ft.maxx:mt.maxx,yt.maxy=ft.maxy>mt.maxy?ft.maxy:mt.maxy,Yn=Yn.parent}}t.synced=!1,t=t.snext}for(;null!=this.syncs;){var bt=this.syncs;this.syncs=bt.snext,bt.snext=null;var gt=bt;if(!gt.moved){gt.moved=!1;var wt=gt.shape;if(!wt.body.component.sleeping){var Ct=gt.aabb,Mt=null;for(null!=this.dtree.root&&(this.dtree.root.next=Mt,Mt=this.dtree.root);null!=Mt;){var kt=Mt;Mt=kt.next,kt.next=null;var Ot=kt;if(Ot!=gt)if(null==Ot.child1){var St=Ot.shape;if(St.body!=wt.body&&(St.body.type!=ye.id_BodyType_STATIC||wt.body.type!=ye.id_BodyType_STATIC)){var Pt=Ot.aabb;if(!(Pt.miny>Ct.maxy||Ct.miny>Pt.maxy||Pt.minx>Ct.maxx||Ct.minx>Pt.maxx)){var Tt,At;St.id>wt.id?(Tt=wt.id,At=St.id):(Tt=St.id,At=wt.id);for(var Et=St.pairs.length>wt.pairs.length?wt:St,It=null,Vt=Et.pairs.head;null!=Vt;){var Lt=Vt.elt;if(Lt.id==Tt&&Lt.di==At){It=Lt;break}Vt=Vt.next}if(null!=It){It.sleeping&&(It.sleeping=!1,It.next=this.pairs,this.pairs=It,It.first=!0);continue}null==jt.zpp_pool?It=new jt:(It=jt.zpp_pool,jt.zpp_pool=It.next,It.next=null),It.n1=gt,It.n2=Ot,It.id=Tt,It.di=At,It.next=this.pairs,this.pairs=It,It.first=!0;var Nt,Bt=wt.pairs;null==Wi.zpp_pool?Nt=new Wi:(Nt=Wi.zpp_pool,Wi.zpp_pool=Nt.next,Nt.next=null),Nt.elt=It;var Rt=Nt;Rt.next=Bt.head,Bt.head=Rt,Bt.modified=!0,Bt.length++;var Gt,Yt=St.pairs;null==Wi.zpp_pool?Gt=new Wi:(Gt=Wi.zpp_pool,Wi.zpp_pool=Gt.next,Gt.next=null),Gt.elt=It;var Ut=Gt;Ut.next=Yt.head,Yt.head=Ut,Yt.modified=!0,Yt.length++}}}else{var Zt=Ot.aabb;Zt.miny>Ct.maxy||Ct.miny>Zt.maxy||Zt.minx>Ct.maxx||Ct.minx>Zt.maxx||(null!=Ot.child1&&(Ot.child1.next=Mt,Mt=Ot.child1),null!=Ot.child2&&(Ot.child2.next=Mt,Mt=Ot.child2))}}for(null!=this.stree.root&&(this.stree.root.next=Mt,Mt=this.stree.root);null!=Mt;){var qt=Mt;Mt=qt.next,qt.next=null;var Wt=qt;if(Wt!=gt)if(null==Wt.child1){var Xt=Wt.shape;if(Xt.body!=wt.body&&(Xt.body.type!=ye.id_BodyType_STATIC||wt.body.type!=ye.id_BodyType_STATIC)){var Ht=Wt.aabb;if(!(Ht.miny>Ct.maxy||Ct.miny>Ht.maxy||Ht.minx>Ct.maxx||Ct.minx>Ht.maxx)){var Kt,Jt;Xt.id>wt.id?(Kt=wt.id,Jt=Xt.id):(Kt=Xt.id,Jt=wt.id);for(var Qt=Xt.pairs.length>wt.pairs.length?wt:Xt,$t=null,ni=Qt.pairs.head;null!=ni;){var ei=ni.elt;if(ei.id==Kt&&ei.di==Jt){$t=ei;break}ni=ni.next}if(null!=$t){$t.sleeping&&($t.sleeping=!1,$t.next=this.pairs,this.pairs=$t,$t.first=!0);continue}null==jt.zpp_pool?$t=new jt:($t=jt.zpp_pool,jt.zpp_pool=$t.next,$t.next=null),$t.n1=gt,$t.n2=Wt,$t.id=Kt,$t.di=Jt,$t.next=this.pairs,this.pairs=$t,$t.first=!0;var ti,ii=wt.pairs;null==Wi.zpp_pool?ti=new Wi:(ti=Wi.zpp_pool,Wi.zpp_pool=ti.next,ti.next=null),ti.elt=$t;var li=ti;li.next=ii.head,ii.head=li,ii.modified=!0,ii.length++;var ri,ai=Xt.pairs;null==Wi.zpp_pool?ri=new Wi:(ri=Wi.zpp_pool,Wi.zpp_pool=ri.next,ri.next=null),ri.elt=$t;var pi=ri;pi.next=ai.head,ai.head=pi,ai.modified=!0,ai.length++}}}else{var si=Wt.aabb;si.miny>Ct.maxy||Ct.miny>si.maxy||si.minx>Ct.maxx||Ct.minx>si.maxx||(null!=Wt.child1&&(Wt.child1.next=Mt,Mt=Wt.child1),null!=Wt.child2&&(Wt.child2.next=Mt,Mt=Wt.child2))}}}}}for(;null!=this.moves;){var oi=this.moves;this.moves=oi.mnext,oi.mnext=null;var hi=oi;hi.moved=!1;var _i=hi.shape;if(!_i.body.component.sleeping){var ui=hi.aabb,di=null;for(null!=this.dtree.root&&(this.dtree.root.next=di,di=this.dtree.root);null!=di;){var ci=di;di=ci.next,ci.next=null;var xi=ci;if(xi!=hi)if(null==xi.child1){var vi=xi.shape;if(vi.body!=_i.body&&(vi.body.type!=ye.id_BodyType_STATIC||_i.body.type!=ye.id_BodyType_STATIC)){var zi=xi.aabb;if(!(zi.miny>ui.maxy||ui.miny>zi.maxy||zi.minx>ui.maxx||ui.minx>zi.maxx)){var yi,fi;vi.id>_i.id?(yi=_i.id,fi=vi.id):(yi=vi.id,fi=_i.id);for(var mi=vi.pairs.length>_i.pairs.length?_i:vi,bi=null,gi=mi.pairs.head;null!=gi;){var wi=gi.elt;if(wi.id==yi&&wi.di==fi){bi=wi;break}gi=gi.next}if(null!=bi){bi.sleeping&&(bi.sleeping=!1,bi.next=this.pairs,this.pairs=bi,bi.first=!0);continue}null==jt.zpp_pool?bi=new jt:(bi=jt.zpp_pool,jt.zpp_pool=bi.next,bi.next=null),bi.n1=hi,bi.n2=xi,bi.id=yi,bi.di=fi,bi.next=this.pairs,this.pairs=bi,bi.first=!0;var Ci,Mi=_i.pairs;null==Wi.zpp_pool?Ci=new Wi:(Ci=Wi.zpp_pool,Wi.zpp_pool=Ci.next,Ci.next=null),Ci.elt=bi;var ki=Ci;ki.next=Mi.head,Mi.head=ki,Mi.modified=!0,Mi.length++;var Oi,Si=vi.pairs;null==Wi.zpp_pool?Oi=new Wi:(Oi=Wi.zpp_pool,Wi.zpp_pool=Oi.next,Oi.next=null),Oi.elt=bi;var Pi=Oi;Pi.next=Si.head,Si.head=Pi,Si.modified=!0,Si.length++}}}else{var Ti=xi.aabb;Ti.miny>ui.maxy||ui.miny>Ti.maxy||Ti.minx>ui.maxx||ui.minx>Ti.maxx||(null!=xi.child1&&(xi.child1.next=di,di=xi.child1),null!=xi.child2&&(xi.child2.next=di,di=xi.child2))}}for(null!=this.stree.root&&(this.stree.root.next=di,di=this.stree.root);null!=di;){var Ai=di;di=Ai.next,Ai.next=null;var Ei=Ai;if(Ei!=hi)if(null==Ei.child1){var Ii=Ei.shape;if(Ii.body!=_i.body&&(Ii.body.type!=ye.id_BodyType_STATIC||_i.body.type!=ye.id_BodyType_STATIC)){var Vi=Ei.aabb;if(!(Vi.miny>ui.maxy||ui.miny>Vi.maxy||Vi.minx>ui.maxx||ui.minx>Vi.maxx)){var Li,Ni;Ii.id>_i.id?(Li=_i.id,Ni=Ii.id):(Li=Ii.id,Ni=_i.id);for(var Di=Ii.pairs.length>_i.pairs.length?_i:Ii,ji=null,Fi=Di.pairs.head;null!=Fi;){var Bi=Fi.elt;if(Bi.id==Li&&Bi.di==Ni){ji=Bi;break}Fi=Fi.next}if(null!=ji){ji.sleeping&&(ji.sleeping=!1,ji.next=this.pairs,this.pairs=ji,ji.first=!0);continue}null==jt.zpp_pool?ji=new jt:(ji=jt.zpp_pool,jt.zpp_pool=ji.next,ji.next=null),ji.n1=hi,ji.n2=Ei,ji.id=Li,ji.di=Ni,ji.next=this.pairs,this.pairs=ji,ji.first=!0;var Ri,Gi=_i.pairs;null==Wi.zpp_pool?Ri=new Wi:(Ri=Wi.zpp_pool,Wi.zpp_pool=Ri.next,Ri.next=null),Ri.elt=ji;var Yi=Ri;Yi.next=Gi.head,Gi.head=Yi,Gi.modified=!0,Gi.length++;var Ui,Zi=Ii.pairs;null==Wi.zpp_pool?Ui=new Wi:(Ui=Wi.zpp_pool,Wi.zpp_pool=Ui.next,Ui.next=null),Ui.elt=ji;var qi=Ui;qi.next=Zi.head,Zi.head=qi,Zi.modified=!0,Zi.length++}}}else{var Xi=Ei.aabb;Xi.miny>ui.maxy||ui.miny>Xi.maxy||Xi.minx>ui.maxx||ui.minx>Xi.maxx||(null!=Ei.child1&&(Ei.child1.next=di,di=Ei.child1),null!=Ei.child2&&(Ei.child2.next=di,di=Ei.child2))}}}}for(var Hi=null,Ki=this.pairs;null!=Ki;){var Ji;if(Ki.first)Ji=!1;else{var Qi=Ki.n1.aabb,$i=Ki.n2.aabb;Ji=!!($i.miny>Qi.maxy||Qi.miny>$i.maxy||$i.minx>Qi.maxx||Qi.minx>$i.maxx)}if(Ji){null==Hi?this.pairs=Ki.next:Hi.next=Ki.next;for(var nl=Ki.n1.shape.pairs,el=null,tl=nl.head;null!=tl;){if(tl.elt==Ki){var il,ll;null==el?(il=nl.head,ll=il.next,null==(nl.head=ll)&&(nl.pushmod=!0)):(il=el.next,ll=il.next,el.next=ll,null==ll&&(nl.pushmod=!0));var rl=il;rl.elt=null,rl.next=Wi.zpp_pool,Wi.zpp_pool=rl,nl.modified=!0,nl.length--,nl.pushmod=!0,!0;break}el=tl,tl=tl.next}for(var al=Ki.n2.shape.pairs,pl=null,sl=al.head;null!=sl;){if(sl.elt==Ki){var ol,hl;null==pl?(ol=al.head,hl=ol.next,null==(al.head=hl)&&(al.pushmod=!0)):(ol=pl.next,hl=ol.next,pl.next=hl,null==hl&&(al.pushmod=!0));var _l=ol;_l.elt=null,_l.next=Wi.zpp_pool,Wi.zpp_pool=_l,al.modified=!0,al.length--,al.pushmod=!0,!0;break}pl=sl,sl=sl.next}var ul=Ki.next;null!=Ki.arb&&(Ki.arb.pair=null),Ki.arb=null;var dl=Ki;dl.n1=dl.n2=null,dl.sleeping=!1,dl.next=jt.zpp_pool,jt.zpp_pool=dl,Ki=ul}else{var cl=Ki.n1.shape,xl=cl.body,vl=Ki.n2.shape,zl=vl.body;if(Ki.first||!xl.component.sleeping&&xl.type!=ye.id_BodyType_STATIC||!zl.component.sleeping&&zl.type!=ye.id_BodyType_STATIC){Ki.first=!1;var yl=cl.aabb,fl=vl.aabb;if(!(fl.miny>yl.maxy||yl.miny>fl.maxy||fl.minx>yl.maxx||yl.minx>fl.maxx)){var ml=Ki.arb;Ki.arb=e?n.narrowPhase(cl,vl,xl.type!=ye.id_BodyType_DYNAMIC||zl.type!=ye.id_BodyType_DYNAMIC,Ki.arb,!1):n.continuousEvent(cl,vl,xl.type!=ye.id_BodyType_DYNAMIC||zl.type!=ye.id_BodyType_DYNAMIC,Ki.arb,!1),null==Ki.arb?null!=ml&&(ml.pair=null):Ki.arb.pair=Ki}Hi=Ki,Ki=Ki.next}else Ki.sleeping=!0,null==Hi?this.pairs=Ki.next:Hi.next=Ki.next,Ki=Ki.next}}},clear:function(){for(;null!=this.syncs;){var n=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=n}for(;null!=this.moves;){var e=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=e}for(;null!=this.pairs;){var t=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var i=this.pairs.n1.shape.pairs,l=this.pairs,r=null,a=i.head;null!=a;){if(a.elt==l){var p,s;null==r?(p=i.head,s=p.next,null==(i.head=s)&&(i.pushmod=!0)):(p=r.next,s=p.next,r.next=s,null==s&&(i.pushmod=!0));var o=p;o.elt=null,o.next=Wi.zpp_pool,Wi.zpp_pool=o,i.modified=!0,i.length--,i.pushmod=!0,!0;break}r=a,a=a.next}for(var h=this.pairs.n2.shape.pairs,_=this.pairs,u=null,d=h.head;null!=d;){if(d.elt==_){var c,x;null==u?(c=h.head,x=c.next,null==(h.head=x)&&(h.pushmod=!0)):(c=u.next,x=c.next,u.next=x,null==x&&(h.pushmod=!0));var v=c;v.elt=null,v.next=Wi.zpp_pool,Wi.zpp_pool=v,h.modified=!0,h.length--,h.pushmod=!0,!0;break}u=d,d=d.next}var z=this.pairs;z.n1=z.n2=null,z.sleeping=!1,z.next=jt.zpp_pool,jt.zpp_pool=z,this.pairs=t}this.dtree.clear(),this.stree.clear()},treeStack:null,shapesUnderPoint:function(n,e,t,i){this.sync_broadphase();var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;var r=l,a=null==i?new ne:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),s=p.aabb;if(!(s.minx>r.x||r.x>s.maxx||s.miny>r.y||r.y>s.maxy))if(null==p.child1){var o;if(null!=t){var h=p.shape.filter;o=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else o=!0;o&&(p.shape.type==ye.id_ShapeType_CIRCLE?We.circleContains(p.shape.circle,r)&&a.push(p.shape.outer):We.polyContains(p.shape.polygon,r)&&a.push(p.shape.outer))}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),u=_.aabb;if(!(u.minx>r.x||r.x>u.maxx||u.miny>r.y||r.y>u.maxy))if(null==_.child1){var d;if(null!=t){var c=_.shape.filter;d=0!=(c.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&c.collisionGroup)}else d=!0;d&&(_.shape.type==ye.id_ShapeType_CIRCLE?We.circleContains(_.shape.circle,r)&&a.push(_.shape.outer):We.polyContains(_.shape.polygon,r)&&a.push(_.shape.outer))}else null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)}var x=r;return null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Ct.zpp_pool,Ct.zpp_pool=x,a},bodiesUnderPoint:function(n,e,t,i){this.sync_broadphase();var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;var r=l,a=null==i?new Ln:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),s=p.aabb;if(!(s.minx>r.x||r.x>s.maxx||s.miny>r.y||r.y>s.maxy))if(null==p.child1){var o=p.shape.body.outer;if(!a.has(o)){var h;if(null!=t){var _=p.shape.filter;h=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else h=!0;h&&(p.shape.type==ye.id_ShapeType_CIRCLE?We.circleContains(p.shape.circle,r)&&a.push(o):We.polyContains(p.shape.polygon,r)&&a.push(o))}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),d=u.aabb;if(!(d.minx>r.x||r.x>d.maxx||d.miny>r.y||r.y>d.maxy))if(null==u.child1){var c=u.shape.body.outer;if(!a.has(c)){var x;if(null!=t){var v=u.shape.filter;x=0!=(v.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&v.collisionGroup)}else x=!0;x&&(u.shape.type==ye.id_ShapeType_CIRCLE?We.circleContains(u.shape.circle,r)&&a.push(c):We.polyContains(u.shape.polygon,r)&&a.push(c))}}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}var z=r;return null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Ct.zpp_pool,Ct.zpp_pool=z,a},treeStack2:null,shapesInAABB:function(n,e,t,i,l){this.sync_broadphase(),this.updateAABBShape(n);var r=this.aabbShape.zpp_inner.aabb,a=null==l?new ne:l;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),s=p.aabb;if(r.minx>s.minx||r.miny>s.miny||s.maxx>r.maxx||s.maxy>r.maxy){var o=p.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx))if(null==p.child1){var h;if(null!=i){var _=p.shape.filter;h=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else h=!0;if(h)if(e)if(t)We.containTest(this.aabbShape.zpp_inner,p.shape)&&a.push(p.shape.outer);else{var u=p.shape.aabb;r.minx>u.minx||r.miny>u.miny||u.maxx>r.maxx||u.maxy>r.maxy?We.testCollide_safe(p.shape,this.aabbShape.zpp_inner)&&a.push(p.shape.outer):a.push(p.shape.outer)}else{var d;if(t){var c=p.shape.aabb;d=!(r.minx>c.minx||r.miny>c.miny||c.maxx>r.maxx)&&r.maxy>=c.maxy}else d=!0;d&&a.push(p.shape.outer)}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}else if(null==p.child1){var x;if(null!=i){var v=p.shape.filter;x=0!=(v.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&v.collisionGroup)}else x=!0;x&&a.push(p.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new vi),this.treeStack2.add(p);null!=this.treeStack2.head;){var z=this.treeStack2.pop_unsafe();if(null==z.child1){var y;if(null!=i){var f=z.shape.filter;y=0!=(f.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&f.collisionGroup)}else y=!0;y&&a.push(z.shape.outer)}else null!=z.child1&&this.treeStack2.add(z.child1),null!=z.child2&&this.treeStack2.add(z.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var m=this.treeStack.pop_unsafe(),b=m.aabb;if(r.minx>b.minx||r.miny>b.miny||b.maxx>r.maxx||b.maxy>r.maxy){var g=m.aabb;if(!(r.miny>g.maxy||g.miny>r.maxy||r.minx>g.maxx||g.minx>r.maxx))if(null==m.child1){var w;if(null!=i){var C=m.shape.filter;w=0!=(C.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&C.collisionGroup)}else w=!0;if(w)if(e)if(t)We.containTest(this.aabbShape.zpp_inner,m.shape)&&a.push(m.shape.outer);else{var M=m.shape.aabb;r.minx>M.minx||r.miny>M.miny||M.maxx>r.maxx||M.maxy>r.maxy?We.testCollide_safe(m.shape,this.aabbShape.zpp_inner)&&a.push(m.shape.outer):a.push(m.shape.outer)}else{var k;if(t){var O=m.shape.aabb;k=!(r.minx>O.minx||r.miny>O.miny||O.maxx>r.maxx)&&r.maxy>=O.maxy}else k=!0;k&&a.push(m.shape.outer)}}else null!=m.child1&&this.treeStack.add(m.child1),null!=m.child2&&this.treeStack.add(m.child2)}else if(null==m.child1){var S;if(null!=i){var P=m.shape.filter;S=0!=(P.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&P.collisionGroup)}else S=!0;S&&a.push(m.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new vi),this.treeStack2.add(m);null!=this.treeStack2.head;){var T=this.treeStack2.pop_unsafe();if(null==T.child1){var A;if(null!=i){var E=T.shape.filter;A=0!=(E.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&E.collisionGroup)}else A=!0;A&&a.push(T.shape.outer)}else null!=T.child1&&this.treeStack2.add(T.child1),null!=T.child2&&this.treeStack2.add(T.child2)}}return a},failed:null,bodiesInAABB:function(n,e,t,i,l){this.sync_broadphase(),this.updateAABBShape(n);var r=this.aabbShape.zpp_inner.aabb,a=null==l?new Ln:l;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var p=this.treeStack.pop_unsafe(),s=p.aabb;if(r.minx>s.minx||r.miny>s.miny||s.maxx>r.maxx||s.maxy>r.maxy){var o=p.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx))if(null==p.child1){var h,_=p.shape.body.outer;if(null!=i){var u=p.shape.filter;h=0!=(u.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup)}else h=!0;if(h)if(e)if(t){if(!this.failed.has(_)){var d=We.containTest(this.aabbShape.zpp_inner,p.shape);!a.has(_)&&d?a.push(_):d||(a.remove(_),this.failed.push(_))}}else!a.has(_)&&We.testCollide_safe(p.shape,this.aabbShape.zpp_inner)&&a.push(_);else if(t){if(!this.failed.has(_)){var c=p.shape.aabb,x=!(r.minx>c.minx||r.miny>c.miny||c.maxx>r.maxx||c.maxy>r.maxy);!a.has(_)&&x?a.push(_):x||(a.remove(_),this.failed.push(_))}}else{var v;if(a.has(_))v=!1;else{var z=p.shape.aabb;v=!(r.minx>z.minx||r.miny>z.miny||z.maxx>r.maxx)&&r.maxy>=z.maxy}v&&a.push(_)}}else null!=p.child1&&this.treeStack.add(p.child1),null!=p.child2&&this.treeStack.add(p.child2)}else if(null==p.child1){var y;if(null!=i){var f=p.shape.filter;y=0!=(f.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&f.collisionGroup)}else y=!0;if(y){var m=p.shape.body.outer;a.has(m)||a.push(m)}}else for(null==this.treeStack2&&(this.treeStack2=new vi),this.treeStack2.add(p);null!=this.treeStack2.head;){var b=this.treeStack2.pop_unsafe();if(null==b.child1){var g;if(null!=i){var w=b.shape.filter;g=0!=(w.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&w.collisionGroup)}else g=!0;if(g){var C=b.shape.body.outer;a.has(C)||a.push(C)}}else null!=b.child1&&this.treeStack2.add(b.child1),null!=b.child2&&this.treeStack2.add(b.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var M=this.treeStack.pop_unsafe(),k=M.aabb;if(r.minx>k.minx||r.miny>k.miny||k.maxx>r.maxx||k.maxy>r.maxy){var O=M.aabb;if(!(r.miny>O.maxy||O.miny>r.maxy||r.minx>O.maxx||O.minx>r.maxx))if(null==M.child1){var S,P=M.shape.body.outer;if(null!=i){var T=M.shape.filter;S=0!=(T.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&T.collisionGroup)}else S=!0;if(S)if(e)if(t){if(!this.failed.has(P)){var A=We.containTest(this.aabbShape.zpp_inner,M.shape);!a.has(P)&&A?a.push(P):A||(a.remove(P),this.failed.push(P))}}else!a.has(P)&&We.testCollide_safe(M.shape,this.aabbShape.zpp_inner)&&a.push(P);else if(t){if(!this.failed.has(P)){var E=M.shape.aabb,I=!(r.minx>E.minx||r.miny>E.miny||E.maxx>r.maxx||E.maxy>r.maxy);!a.has(P)&&I?a.push(P):I||(a.remove(P),this.failed.push(P))}}else{var V;if(a.has(P))V=!1;else{var L=M.shape.aabb;V=!(r.minx>L.minx||r.miny>L.miny||L.maxx>r.maxx)&&r.maxy>=L.maxy}V&&a.push(P)}}else null!=M.child1&&this.treeStack.add(M.child1),null!=M.child2&&this.treeStack.add(M.child2)}else if(null==M.child1){var N;if(null!=i){var D=M.shape.filter;N=0!=(D.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&D.collisionGroup)}else N=!0;if(N){var j=M.shape.body.outer;a.has(j)||a.push(j)}}else for(null==this.treeStack2&&(this.treeStack2=new vi),this.treeStack2.add(M);null!=this.treeStack2.head;){var F=this.treeStack2.pop_unsafe();if(null==F.child1){var B;if(null!=i){var R=F.shape.filter;B=0!=(R.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&R.collisionGroup)}else B=!0;if(B){var G=F.shape.body.outer;a.has(G)||a.push(G)}}else null!=F.child1&&this.treeStack2.add(F.child1),null!=F.child2&&this.treeStack2.add(F.child2)}}return this.failed.clear(),a},shapesInCircle:function(n,e,t,i,l,r){this.sync_broadphase(),this.updateCircShape(n,e,t);var a=this.circShape.zpp_inner.aabb,p=null==r?new ne:r;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var s=this.treeStack.pop_unsafe(),o=s.aabb;if(!(a.miny>o.maxy||o.miny>a.maxy||a.minx>o.maxx||o.minx>a.maxx))if(null==s.child1){var h;if(null!=l){var _=s.shape.filter;h=0!=(_.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&_.collisionGroup)}else h=!0;h&&(i?We.containTest(this.circShape.zpp_inner,s.shape)&&p.push(s.shape.outer):We.testCollide_safe(s.shape,this.circShape.zpp_inner)&&p.push(s.shape.outer))}else null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),d=u.aabb;if(!(a.miny>d.maxy||d.miny>a.maxy||a.minx>d.maxx||d.minx>a.maxx))if(null==u.child1){var c;if(null!=l){var x=u.shape.filter;c=0!=(x.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&x.collisionGroup)}else c=!0;c&&(i?We.containTest(this.circShape.zpp_inner,u.shape)&&p.push(u.shape.outer):We.testCollide_safe(u.shape,this.circShape.zpp_inner)&&p.push(u.shape.outer))}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return p},bodiesInCircle:function(n,e,t,i,l,r){this.sync_broadphase(),this.updateCircShape(n,e,t);var a=this.circShape.zpp_inner.aabb,p=null==r?new Ln:r;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var s=this.treeStack.pop_unsafe(),o=s.aabb;if(!(a.miny>o.maxy||o.miny>a.maxy||a.minx>o.maxx||o.minx>a.maxx))if(null==s.child1){var h,_=s.shape.body.outer;if(null!=l){var u=s.shape.filter;h=0!=(u.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&u.collisionGroup)}else h=!0;if(h)if(i){if(!this.failed.has(_)){var d=We.containTest(this.circShape.zpp_inner,s.shape);!p.has(_)&&d?p.push(_):d||(p.remove(_),this.failed.push(_))}}else!p.has(_)&&We.testCollide_safe(s.shape,this.circShape.zpp_inner)&&p.push(_)}else null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var c=this.treeStack.pop_unsafe(),x=c.aabb;if(!(a.miny>x.maxy||x.miny>a.maxy||a.minx>x.maxx||x.minx>a.maxx))if(null==c.child1){var v,z=c.shape.body.outer;if(null!=l){var y=c.shape.filter;v=0!=(y.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&y.collisionGroup)}else v=!0;if(v)if(i){if(!this.failed.has(z)){var f=We.containTest(this.circShape.zpp_inner,c.shape);!p.has(z)&&f?p.push(z):f||(p.remove(z),this.failed.push(z))}}else!p.has(z)&&We.testCollide_safe(c.shape,this.circShape.zpp_inner)&&p.push(z)}else null!=c.child1&&this.treeStack.add(c.child1),null!=c.child2&&this.treeStack.add(c.child2)}return this.failed.clear(),p},shapesInShape:function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,r=null==i?new ne:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),p=a.aabb;if(!(l.miny>p.maxy||p.miny>l.maxy||l.minx>p.maxx||p.minx>l.maxx))if(null==a.child1){var s;if(null!=t){var o=a.shape.filter;s=0!=(o.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&o.collisionGroup)}else s=!0;s&&(e?We.containTest(n,a.shape)&&r.push(a.shape.outer):We.testCollide_safe(a.shape,n)&&r.push(a.shape.outer))}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h=this.treeStack.pop_unsafe(),_=h.aabb;if(!(l.miny>_.maxy||_.miny>l.maxy||l.minx>_.maxx||_.minx>l.maxx))if(null==h.child1){var u;if(null!=t){var d=h.shape.filter;u=0!=(d.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&d.collisionGroup)}else u=!0;u&&(e?We.containTest(n,h.shape)&&r.push(h.shape.outer):We.testCollide_safe(h.shape,n)&&r.push(h.shape.outer))}else null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)}return r},bodiesInShape:function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,r=null==i?new Ln:i;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),p=a.aabb;if(!(l.miny>p.maxy||p.miny>l.maxy||l.minx>p.maxx||p.minx>l.maxx))if(null==a.child1){var s,o=a.shape.body.outer;if(null!=t){var h=a.shape.filter;s=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else s=!0;if(s)if(e){if(!this.failed.has(o)){var _=We.containTest(n,a.shape);!r.has(o)&&_?r.push(o):_||(r.remove(o),this.failed.push(o))}}else!r.has(o)&&We.testCollide_safe(a.shape,n)&&r.push(o)}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new vi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),d=u.aabb;if(!(l.miny>d.maxy||d.miny>l.maxy||l.minx>d.maxx||d.minx>l.maxx))if(null==u.child1){var c,x=u.shape.body.outer;if(null!=t){var v=u.shape.filter;c=0!=(v.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&v.collisionGroup)}else c=!0;if(c)if(e){if(!this.failed.has(x)){var z=We.containTest(n,u.shape);!r.has(x)&&z?r.push(x):z||(r.remove(x),this.failed.push(x))}}else!r.has(x)&&We.testCollide_safe(u.shape,n)&&r.push(x)}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return this.failed.clear(),r},openlist:null,rayCast:function(n,e,t){null==this.openlist&&(this.openlist=new vi),this.sync_broadphase(),n.validate_dir();var i=n.maxdist;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)){var l=n.aabbsect(this.dtree.root.aabb);if(l>=0&&i>l){this.dtree.root.rayt=l;for(var r=null,a=this.openlist.head;null!=a;){if(a.elt.rayt>this.dtree.root.rayt)break;r=a,a=a.next}var p,s=this.openlist,o=this.dtree.root;null==Ji.zpp_pool?p=new Ji:(p=Ji.zpp_pool,Ji.zpp_pool=p.next,p.next=null),p.elt=o;var h=p;null==r?(h.next=s.head,s.head=h):(h.next=r.next,r.next=h),s.pushmod=s.modified=!0,s.length++}}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)){var _=n.aabbsect(this.stree.root.aabb);if(_>=0&&i>_){this.stree.root.rayt=_;for(var u=null,d=this.openlist.head;null!=d;){if(d.elt.rayt>this.stree.root.rayt)break;u=d,d=d.next}var c,x=this.openlist,v=this.stree.root;null==Ji.zpp_pool?c=new Ji:(c=Ji.zpp_pool,Ji.zpp_pool=c.next,c.next=null),c.elt=v;var z=c;null==u?(z.next=x.head,x.head=z):(z.next=u.next,u.next=z),x.pushmod=x.modified=!0,x.length++}}for(var y=null;null!=this.openlist.head;){var f=this.openlist.pop_unsafe();if(f.rayt>=i)break;if(null==f.child1){var m,b=f.shape;if(null!=t){var g=b.filter;m=0!=(g.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&g.collisionGroup)}else m=!0;if(m){var w=b.type==ye.id_ShapeType_CIRCLE?n.circlesect(b.circle,e,i):n.aabbtest(b.aabb)?n.polysect(b.polygon,e,i):null;null!=w&&(i=w.zpp_inner.toiDistance,null!=y&&y.zpp_inner.free(),y=w)}}else{if(null!=f.child1&&n.aabbtest(f.child1.aabb)){var C=n.aabbsect(f.child1.aabb);if(C>=0&&i>C){f.child1.rayt=C;for(var M=null,k=this.openlist.head;null!=k;){if(k.elt.rayt>f.child1.rayt)break;M=k,k=k.next}var O,S=this.openlist,P=f.child1;null==Ji.zpp_pool?O=new Ji:(O=Ji.zpp_pool,Ji.zpp_pool=O.next,O.next=null),O.elt=P;var T=O;null==M?(T.next=S.head,S.head=T):(T.next=M.next,M.next=T),S.pushmod=S.modified=!0,S.length++}}if(null!=f.child2&&n.aabbtest(f.child2.aabb)){var A=n.aabbsect(f.child2.aabb);if(A>=0&&i>A){f.child2.rayt=A;for(var E=null,I=this.openlist.head;null!=I;){if(I.elt.rayt>f.child2.rayt)break;E=I,I=I.next}var V,L=this.openlist,N=f.child2;null==Ji.zpp_pool?V=new Ji:(V=Ji.zpp_pool,Ji.zpp_pool=V.next,V.next=null),V.elt=N;var D=V;null==E?(D.next=L.head,L.head=D):(D.next=E.next,E.next=D),L.pushmod=L.modified=!0,L.length++}}}}return this.openlist.clear(),y},rayMultiCast:function(n,e,t,i){null==this.openlist&&(this.openlist=new vi),this.sync_broadphase(),n.validate_dir();var l=n.maxdist>=Infinity,r=null==i?new kn:i;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb))if(l)this.openlist.add(this.dtree.root);else{var a=n.aabbsect(this.dtree.root.aabb);a>=0&&n.maxdist>a&&this.openlist.add(this.dtree.root)}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb))if(l)this.openlist.add(this.stree.root);else{var p=n.aabbsect(this.stree.root.aabb);p>=0&&n.maxdist>p&&this.openlist.add(this.stree.root)}for(;null!=this.openlist.head;){var s=this.openlist.pop_unsafe();if(null==s.child1){var o,h=s.shape;if(null!=t){var _=h.filter;o=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else o=!0;o&&(h.type==ye.id_ShapeType_CIRCLE?n.circlesect2(h.circle,e,r):n.aabbtest(h.aabb)&&n.polysect2(h.polygon,e,r))}else{if(null!=s.child1&&n.aabbtest(s.child1.aabb))if(l)this.openlist.add(s.child1);else{var u=n.aabbsect(s.child1.aabb);u>=0&&n.maxdist>u&&this.openlist.add(s.child1)}if(null!=s.child2&&n.aabbtest(s.child2.aabb))if(l)this.openlist.add(s.child2);else{var d=n.aabbsect(s.child2.aabb);d>=0&&n.maxdist>d&&this.openlist.add(s.child2)}}}return this.openlist.clear(),r},__class__:Bt});var Rt=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new xi};l["zpp_nape.space.ZPP_Island"]=Rt,Rt.__name__=["zpp_nape","space","ZPP_Island"],Rt.prototype={next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},comps:null,sleep:null,waket:null,free:function(){},alloc:function(){this.waket=0},__class__:Rt};var Gt=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,this.parent=this,this.rank=0,this.woken=!1};l["zpp_nape.space.ZPP_Component"]=Gt,Gt.__name__=["zpp_nape","space","ZPP_Component"],Gt.prototype={next:null,parent:null,rank:null,isBody:null,body:null,constraint:null,island:null,sleeping:null,waket:null,woken:null,free:function(){this.body=null,this.constraint=null},alloc:function(){},reset:function(){this.sleeping=!1,this.island=null,this.parent=this,this.rank=0},__class__:Gt};var Yt=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new ii};l["zpp_nape.space.ZPP_CallbackSet"]=Yt,Yt.__name__=["zpp_nape","space","ZPP_CallbackSet"],Yt.get=function(n,e){var t;return null==Yt.zpp_pool?t=new Yt:(t=Yt.zpp_pool,Yt.zpp_pool=t.next,t.next=null),t.freed=!1,t.lazydel=!1,t.COLLISIONstate=ye.id_PreFlag_ACCEPT,t.COLLISIONstamp=0,t.SENSORstate=ye.id_PreFlag_ACCEPT,t.SENSORstamp=0,t.FLUIDstate=ye.id_PreFlag_ACCEPT,t.FLUIDstamp=0,e.id>n.id?(t.int1=n,t.int2=e):(t.int1=e,t.int2=n),t.id=t.int1.id,t.di=t.int2.id,t},Yt.prototype={id:null,di:null,int1:null,int2:null,arbiters:null,COLLISIONstate:null,COLLISIONstamp:null,SENSORstate:null,SENSORstamp:null,FLUIDstate:null,FLUIDstamp:null,next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){e._inuse=!0;var t=e;return null==n?(t.next=this.next,this.next=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,l;null==e?(i=this.next,l=i.next,null==(this.next=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var l,r;null==e?(l=this.next,r=l.next,null==(this.next=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;return null==n?(e=this.next,t=e.next,null==(this.next=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},freed:null,lazydel:null,free:function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},alloc:function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=ye.id_PreFlag_ACCEPT,this.COLLISIONstamp=0,this.SENSORstate=ye.id_PreFlag_ACCEPT,this.SENSORstamp=0,this.FLUIDstate=ye.id_PreFlag_ACCEPT,this.FLUIDstamp=0},add_arb:function(n){var e;e=!1;for(var t=this.arbiters.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}if(e)return!1;var i,l=this.arbiters;null==Ni.zpp_pool?i=new Ni:(i=Ni.zpp_pool,Ni.zpp_pool=i.next,i.next=null),i.elt=n;var r=i;return r.next=l.head,l.head=r,l.modified=!0,l.length++,!0},try_remove_arb:function(n){for(var e=this.arbiters,t=null,i=e.head,l=!1;null!=i;){if(i.elt==n){var r,a;null==t?(r=e.head,a=r.next,null==(e.head=a)&&(e.pushmod=!0)):(r=t.next,a=r.next,t.next=a,null==a&&(e.pushmod=!0));var p=r;p.elt=null,p.next=Ni.zpp_pool,Ni.zpp_pool=p,e.modified=!0,e.length--,e.pushmod=!0,l=!0;break}t=i,i=i.next}return l},remove_arb:function(n){for(var e=this.arbiters,t=null,i=e.head;null!=i;){if(i.elt==n){var l,r;null==t?(l=e.head,r=l.next,null==(e.head=r)&&(e.pushmod=!0)):(l=t.next,r=l.next,t.next=r,null==r&&(e.pushmod=!0));var a=l;a.elt=null,a.next=Ni.zpp_pool,Ni.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0,!0;break}t=i,i=i.next}},empty_arb:function(n){var e;e=!0;for(var t=this.arbiters.head;null!=t;){{if(0!=(t.elt.type&n)){e=!1;break}t=t.next}}return e},really_empty:function(){return null==this.arbiters.head},sleeping:function(){var n;n=!0;for(var e=this.arbiters.head;null!=e;){{if(!e.elt.sleeping){n=!1;break}e=e.next}}return n},__class__:Yt};var Ut=function(n){this.space=null,this.cbsets=null,null==El.zpp_pool?this.cbsets=new El:(this.cbsets=El.zpp_pool,El.zpp_pool=this.cbsets.next,this.cbsets.next=null);this.cbsets.lt=oe.setlt,this.space=n};l["zpp_nape.space.ZPP_CbSetManager"]=Ut,Ut.__name__=["zpp_nape","space","ZPP_CbSetManager"],Ut.prototype={cbsets:null,space:null,get:function(n){if(null==n.head)return null;var e;null==oe.zpp_pool?e=new oe:(e=oe.zpp_pool,oe.zpp_pool=e.next,e.next=null);var t=e.cbTypes;e.cbTypes=n;var i,l=this.cbsets.find_weak(e);if(null!=l)i=l.data;else{var r=oe.get(n);this.cbsets.insert(r),r.manager=this,i=r}e.cbTypes=t;var a=e;for(a.listeners.clear(),a.zip_listeners=!0,a.bodylisteners.clear(),a.zip_bodylisteners=!0,a.conlisteners.clear(),a.zip_conlisteners=!0;null!=a.cbTypes.head;){a.cbTypes.pop_unsafe().cbsets.remove(a)}return a.next=oe.zpp_pool,oe.zpp_pool=a,i},remove:function(n){for(this.cbsets.remove(n);null!=n.cbpairs.head;){var e=n.cbpairs.pop_unsafe();e.a!=e.b&&(n==e.a?e.b.cbpairs.remove(e):e.a.cbpairs.remove(e));var t=e;t.a=t.b=null,t.listeners.clear(),t.next=he.zpp_pool,he.zpp_pool=t}n.manager=null},clear:function(){},validate:function(){if(!this.cbsets.empty()){for(var n=this.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;){if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}},pair:function(n,e){for(var t=null,i=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,l=i.head;null!=l;){var r=l.elt;if(r.a==n&&r.b==e||r.a==e&&r.b==n){t=r;break}l=l.next}if(null==t){var a;null==he.zpp_pool?a=new he:(a=he.zpp_pool,he.zpp_pool=a.next,a.next=null),a.zip_listeners=!0,oe.setlt(n,e)?(a.a=n,a.b=e):(a.a=e,a.b=n),t=a,n.cbpairs.add(t),e!=n&&e.cbpairs.add(t)}return t.zip_listeners&&(t.zip_listeners=!1,t.__validate()),t},valid_listener:function(n){return n.space==this.space},__class__:Ut};var Zt=function(n,e){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new gi,this.global_lin_drag=.015,this.global_ang_drag=.015,se.internal=!0,this.precb=new D,this.precb.zpp_inner=new se,se.internal=!1,this.sortcontacts=!0,this.pre_dt=0;var i;null!=e?(null==ye.Broadphase_DYNAMIC_AABB_TREE&&(ye.internal=!0,ye.Broadphase_DYNAMIC_AABB_TREE=new ie,ye.internal=!1),i=e==ye.Broadphase_DYNAMIC_AABB_TREE):i=!0,i?this.bphase=new Bt(this):(null==ye.Broadphase_SWEEP_AND_PRUNE&&(ye.internal=!0,ye.Broadphase_SWEEP_AND_PRUNE=new ie,ye.internal=!1),e==ye.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Wt(this))),this.time=0;null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new ei,this.wrap_bodies=ol.get(this.bodies),this.wrap_bodies.zpp_inner.adder=t(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=t(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=t(this,this.bodies_modifiable),this.compounds=new ti,this.wrap_compounds=_l.get(this.compounds),this.wrap_compounds.zpp_inner.adder=t(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=t(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=t(this,this.compounds_modifiable),this.kinematics=new ei,this.c_arbiters_true=new mi,this.c_arbiters_false=new mi,this.f_arbiters=new yi,this.s_arbiters=new fi,this.islands=new Rt,this.live=new ei,this.wrap_live=ol.get(this.live,!0),this.staticsleep=new ei,this.constraints=new ce,this.wrap_constraints=sl.get(this.constraints),this.wrap_constraints.zpp_inner.adder=t(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=t(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=t(this,this.constraints_modifiable),this.live_constraints=new ce,this.wrap_livecon=sl.get(this.live_constraints,!0),this.__static=St.__static(),this.__static.zpp_inner.space=this,this.callbacks=new se,this.midstep=!1,this.listeners=new bi,this.wrap_listeners=ul.get(this.listeners),this.wrap_listeners.zpp_inner.adder=t(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=t(this,this.listeners_subber),this.wrap_listeners.zpp_inner._modifiable=t(this,this.listeners_modifiable),this.callbackset_list=new Yt,this.mrca1=new xe,this.mrca2=new xe,this.prelisteners=new _e,this.cbsets=new Ut(this)};l["zpp_nape.space.ZPP_Space"]=Zt,Zt.__name__=["zpp_nape","space","ZPP_Space"],Zt.prototype={outer:null,userData:null,gravityx:null,gravityy:null,wrap_gravity:null,getgravity:function(){var n,e=this.gravityx,i=this.gravityy;if(null==Cl.poolVec2?n=new On:(n=Cl.poolVec2,Cl.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Cl.nextVec2&&(Cl.nextVec2=null)),null==n.zpp_inner){var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=i,n.zpp_inner=l,n.zpp_inner.outer=n}else{var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,p=n.zpp_inner;if(null!=p._validate&&p._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),a=n.zpp_inner.y==i}else a=!1;if(!a){n.zpp_inner.x=e,n.zpp_inner.y=i;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=t(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=t(this,this.gravity_validate)},gravity_invalidate:function(n){this.gravityx=n.x,this.gravityy=n.y;for(var e=new ti,t=this.bodies.head;null!=t;){var i=t.elt,l=i;l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==ye.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1)),t=t.next}for(var r=this.compounds.head;null!=r;){e.add(r.elt),r=r.next}for(;null!=e.head;){for(var a=e.pop_unsafe(),p=a.bodies.head;null!=p;){var s=p.elt,o=s;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),o.type==ye.id_BodyType_KINEMATIC&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),p=p.next}for(var h=a.compounds.head;null!=h;){e.add(h.elt),h=h.next}}},gravity_validate:function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},bodies:null,wrap_bodies:null,compounds:null,wrap_compounds:null,constraints:null,wrap_constraints:null,kinematics:null,bphase:null,__static:null,global_lin_drag:null,global_ang_drag:null,stamp:null,midstep:null,time:null,sortcontacts:null,c_arbiters_true:null,c_arbiters_false:null,f_arbiters:null,s_arbiters:null,wrap_arbiters:null,live:null,wrap_live:null,live_constraints:null,wrap_livecon:null,staticsleep:null,islands:null,listeners:null,wrap_listeners:null,callbacks:null,callbackset_list:null,cbsets:null,clear:function(){for(;null!=this.listeners.head;){this.remListener(this.listeners.pop_unsafe())}for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear();var e=n;e.int1=e.int2=null,e.id=e.di=-1,e.freed=!0,e.next=Yt.zpp_pool,Yt.zpp_pool=e}for(;null!=this.c_arbiters_true.head;){var t=this.c_arbiters_true.pop_unsafe();if(!t.cleared){for(var i=t.b1.arbiters,l=null,r=i.head;null!=r;){if(r.elt==t){var a,p;null==l?(a=i.head,p=a.next,null==(i.head=p)&&(i.pushmod=!0)):(a=l.next,p=a.next,l.next=p,null==p&&(i.pushmod=!0));var s=a;s.elt=null,s.next=Ni.zpp_pool,Ni.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0,!0;break}l=r,r=r.next}for(var o=t.b2.arbiters,h=null,_=o.head;null!=_;){if(_.elt==t){var u,d;null==h?(u=o.head,d=u.next,null==(o.head=d)&&(o.pushmod=!0)):(u=h.next,d=u.next,h.next=d,null==d&&(o.pushmod=!0));var c=u;c.elt=null,c.next=Ni.zpp_pool,Ni.zpp_pool=c,o.modified=!0,o.length--,o.pushmod=!0,!0;break}h=_,_=_.next}null!=t.pair&&(t.pair.arb=null,t.pair=null)}for(t.b1=t.b2=null,t.active=!1,t.intchange=!1;null!=t.contacts.next;){var x=t.contacts,v=x.next;x.pop();var z=v;z.arbiter=null,z.next=Be.zpp_pool,Be.zpp_pool=z;var y=t.innards,f=y.next;y.next=f.next,f._inuse=!1,null==y.next&&(y.pushmod=!0),y.modified=!0,y.length--}var m=t;m.userdef_dyn_fric=!1,m.userdef_stat_fric=!1,m.userdef_restitution=!1,m.userdef_rfric=!1,m.__ref_edge1=m.__ref_edge2=null,m.next=Fe.zpp_pool,Fe.zpp_pool=m,t.pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var b=this.c_arbiters_false.pop_unsafe();if(!b.cleared){for(var g=b.b1.arbiters,w=null,C=g.head;null!=C;){if(C.elt==b){var M,k;null==w?(M=g.head,k=M.next,null==(g.head=k)&&(g.pushmod=!0)):(M=w.next,k=M.next,w.next=k,null==k&&(g.pushmod=!0));var O=M;O.elt=null,O.next=Ni.zpp_pool,Ni.zpp_pool=O,g.modified=!0,g.length--,g.pushmod=!0,!0;break}w=C,C=C.next}for(var S=b.b2.arbiters,P=null,T=S.head;null!=T;){if(T.elt==b){var A,E;null==P?(A=S.head,E=A.next,null==(S.head=E)&&(S.pushmod=!0)):(A=P.next,E=A.next,P.next=E,null==E&&(S.pushmod=!0));var I=A;I.elt=null,I.next=Ni.zpp_pool,Ni.zpp_pool=I,S.modified=!0,S.length--,S.pushmod=!0,!0;break}P=T,T=T.next}null!=b.pair&&(b.pair.arb=null,b.pair=null)}for(b.b1=b.b2=null,b.active=!1,b.intchange=!1;null!=b.contacts.next;){var V=b.contacts,L=V.next;V.pop();var N=L;N.arbiter=null,N.next=Be.zpp_pool,Be.zpp_pool=N;var D=b.innards,j=D.next;D.next=j.next,j._inuse=!1,null==D.next&&(D.pushmod=!0),D.modified=!0,D.length--}var F=b;F.userdef_dyn_fric=!1,F.userdef_stat_fric=!1,F.userdef_restitution=!1,F.userdef_rfric=!1,F.__ref_edge1=F.__ref_edge2=null,F.next=Fe.zpp_pool,Fe.zpp_pool=F,b.pre_dt=-1}for(;null!=this.s_arbiters.head;){var B=this.s_arbiters.pop_unsafe();if(!B.cleared){for(var R=B.b1.arbiters,G=null,Y=R.head;null!=Y;){if(Y.elt==B){var U,Z;null==G?(U=R.head,Z=U.next,null==(R.head=Z)&&(R.pushmod=!0)):(U=G.next,Z=U.next,G.next=Z,null==Z&&(R.pushmod=!0));var q=U;q.elt=null,q.next=Ni.zpp_pool,Ni.zpp_pool=q,R.modified=!0,R.length--,R.pushmod=!0,!0;break}G=Y,Y=Y.next}for(var W=B.b2.arbiters,X=null,H=W.head;null!=H;){if(H.elt==B){var K,J;null==X?(K=W.head,J=K.next,null==(W.head=J)&&(W.pushmod=!0)):(K=X.next,J=K.next,X.next=J,null==J&&(W.pushmod=!0));var Q=K;Q.elt=null,Q.next=Ni.zpp_pool,Ni.zpp_pool=Q,W.modified=!0,W.length--,W.pushmod=!0,!0;break}X=H,H=H.next}null!=B.pair&&(B.pair.arb=null,B.pair=null)}B.b1=B.b2=null,B.active=!1,B.intchange=!1;var $=B;$.next=De.zpp_pool,De.zpp_pool=$}for(;null!=this.f_arbiters.head;){var nn=this.f_arbiters.pop_unsafe();if(!nn.cleared){for(var en=nn.b1.arbiters,tn=null,ln=en.head;null!=ln;){if(ln.elt==nn){var rn,an;null==tn?(rn=en.head,an=rn.next,null==(en.head=an)&&(en.pushmod=!0)):(rn=tn.next,an=rn.next,tn.next=an,null==an&&(en.pushmod=!0));var pn=rn;pn.elt=null,pn.next=Ni.zpp_pool,Ni.zpp_pool=pn,en.modified=!0,en.length--,en.pushmod=!0,!0;break}tn=ln,ln=ln.next}for(var sn=nn.b2.arbiters,on=null,hn=sn.head;null!=hn;){if(hn.elt==nn){var _n,un;null==on?(_n=sn.head,un=_n.next,null==(sn.head=un)&&(sn.pushmod=!0)):(_n=on.next,un=_n.next,on.next=un,null==un&&(sn.pushmod=!0));var dn=_n;dn.elt=null,dn.next=Ni.zpp_pool,Ni.zpp_pool=dn,sn.modified=!0,sn.length--,sn.pushmod=!0,!0;break}on=hn,hn=hn.next}null!=nn.pair&&(nn.pair.arb=null,nn.pair=null)}nn.b1=nn.b2=null,nn.active=!1,nn.intchange=!1;var cn=nn;cn.next=je.zpp_pool,je.zpp_pool=cn,nn.pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var xn=this.bodies.pop_unsafe();if(null!=xn.component){var vn=xn.component.island;if(null!=vn){for(;null!=vn.comps.head;){var zn=vn.comps.pop_unsafe();zn.sleeping=!1,zn.island=null,zn.parent=zn,zn.rank=0}var yn=vn;yn.next=Rt.zpp_pool,Rt.zpp_pool=yn}}xn.removedFromSpace(),xn.space=null}for(;null!=this.constraints.head;){var fn=this.constraints.pop_unsafe();if(null!=fn.component){var mn=fn.component.island;if(null!=mn){for(;null!=mn.comps.head;){var bn=mn.comps.pop_unsafe();bn.sleeping=!1,bn.island=null,bn.parent=bn,bn.rank=0}var gn=mn;gn.next=Rt.zpp_pool,Rt.zpp_pool=gn}}fn.removedFromSpace(),fn.space=null}this.kinematics.clear();for(var wn=new ti;null!=this.compounds.head;){wn.add(this.compounds.pop_unsafe())}for(;null!=wn.head;){var Cn=wn.pop_unsafe();Cn.removedFromSpace(),Cn.space=null;for(var Mn=Cn.bodies.head;null!=Mn;){var kn=Mn.elt;if(null!=kn.component){var On=kn.component.island;if(null!=On){for(;null!=On.comps.head;){var Sn=On.comps.pop_unsafe();Sn.sleeping=!1,Sn.island=null,Sn.parent=Sn,Sn.rank=0}var Pn=On;Pn.next=Rt.zpp_pool,Rt.zpp_pool=Pn}}kn.removedFromSpace(),kn.space=null,Mn=Mn.next}for(var Tn=Cn.constraints.head;null!=Tn;){var An=Tn.elt;if(null!=An.component){var En=An.component.island;if(null!=En){for(;null!=En.comps.head;){var In=En.comps.pop_unsafe();In.sleeping=!1,In.island=null,In.parent=In,In.rank=0}var Vn=En;Vn.next=Rt.zpp_pool,Rt.zpp_pool=Vn}}An.removedFromSpace(),An.space=null,Tn=Tn.next}for(var Ln=Cn.compounds.head;null!=Ln;){wn.add(Ln.elt),Ln=Ln.next}}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},bodies_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(n),this.addBody(n.zpp_inner),!0)},bodies_subber:function(n){this.remBody(n.zpp_inner)},bodies_modifiable:function(){},compounds_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),this.addCompound(n.zpp_inner),!0)},compounds_subber:function(n){this.remCompound(n.zpp_inner)},compounds_modifiable:function(){},constraints_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(n),this.addConstraint(n.zpp_inner),!0)},constraints_subber:function(n){this.remConstraint(n.zpp_inner)},constraints_modifiable:function(){},listeners_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(n),this.addListener(n.zpp_inner),!0)},listeners_subber:function(n){this.remListener(n.zpp_inner)},listeners_modifiable:function(){},revoke_listener:function(n){},unrevoke_listener:function(n){},addListener:function(n){if(n.space=this,n.addedToSpace(),null!=n.interaction);},remListener:function(n){if(null!=n.interaction);n.removedFromSpace(),n.space=null},add_callbackset:function(n){var e,t=n.int1.cbsets;null==Oi.zpp_pool?e=new Oi:(e=Oi.zpp_pool,Oi.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;i.next=t.head,t.head=i,t.modified=!0,t.length++;var l,r=n.int2.cbsets;null==Oi.zpp_pool?l=new Oi:(l=Oi.zpp_pool,Oi.zpp_pool=l.next,l.next=null),l.elt=n;var a=l;a.next=r.head,r.head=a,r.modified=!0,r.length++;var p=this.callbackset_list;n._inuse=!0;var s=n;s.next=p.next,p.next=s,p.modified=!0,p.length++},remove_callbackset:function(n){n.lazydel=!0;for(var e=n.int1.cbsets,t=null,i=e.head;null!=i;){if(i.elt==n){var l,r;null==t?(l=e.head,r=l.next,null==(e.head=r)&&(e.pushmod=!0)):(l=t.next,r=l.next,t.next=r,null==r&&(e.pushmod=!0));var a=l;a.elt=null,a.next=Oi.zpp_pool,Oi.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0,!0;break}t=i,i=i.next}for(var p=n.int2.cbsets,s=null,o=p.head;null!=o;){if(o.elt==n){var h,_;null==s?(h=p.head,_=h.next,null==(p.head=_)&&(p.pushmod=!0)):(h=s.next,_=h.next,s.next=_,null==_&&(p.pushmod=!0));var u=h;u.elt=null,u.next=Oi.zpp_pool,Oi.zpp_pool=u,p.modified=!0,p.length--,p.pushmod=!0,!0;break}s=o,o=o.next}},transmitType:function(n,e){var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==ye.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1)),n.type==ye.id_BodyType_DYNAMIC?this.live.remove(n):n.type==ye.id_BodyType_KINEMATIC?(this.kinematics.remove(n),this.staticsleep.remove(n)):n.type==ye.id_BodyType_STATIC&&this.staticsleep.remove(n),n.type=e,n.type==ye.id_BodyType_KINEMATIC&&this.kinematics.add(n),n.type==ye.id_BodyType_STATIC&&this.static_validation(n),n.component.sleeping=!0;var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==ye.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0))},added_shape:function(n,e){if(null==e&&(e=!1),!e){var t=n.body;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==ye.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1))}this.bphase.insert(n),n.addedToSpace()},removed_shape:function(n,e){null==e&&(e=!1);var t=this,i=n.body;e||i.wake();for(var l=null,r=i.arbiters.head;null!=r;){var a=r.elt;if(a.ws1==n||a.ws2==n){if(0!=a.present){this.MRCA_chains(a.ws1,a.ws2);for(var p=this.mrca1.head;null!=p;){for(var s=p.elt,o=this.mrca2.head;null!=o;){var h=o.elt,_=s.cbSet,u=h.cbSet;_.validate(),u.validate();for(var d=null,c=u.cbpairs.length>_.cbpairs.length?_.cbpairs:u.cbpairs,x=c.head;null!=x;){var v=x.elt;if(v.a==_&&v.b==u||v.a==u&&v.b==_){d=v;break}x=x.next}if(null==d){var z;null==he.zpp_pool?z=new he:(z=he.zpp_pool,he.zpp_pool=z.next,z.next=null),z.zip_listeners=!0,oe.setlt(_,u)?(z.a=_,z.b=u):(z.a=u,z.b=_),d=z,_.cbpairs.add(d),u!=_&&u.cbpairs.add(d)}if(d.zip_listeners&&(d.zip_listeners=!1,d.__validate()),null!=d.listeners.head){var y=Ot.get(s,h);y.remove_arb(a),a.present--;for(var f=ye.id_CbEvent_END,m=null,b=u.cbpairs.length>_.cbpairs.length?_.cbpairs:u.cbpairs,g=b.head;null!=g;){var w=g.elt;if(w.a==_&&w.b==u||w.a==u&&w.b==_){m=w;break}g=g.next}if(null==m){var C;null==he.zpp_pool?C=new he:(C=he.zpp_pool,he.zpp_pool=C.next,C.next=null),C.zip_listeners=!0,oe.setlt(_,u)?(C.a=_,C.b=u):(C.a=u,C.b=_),m=C,_.cbpairs.add(m),u!=_&&u.cbpairs.add(m)}m.zip_listeners&&(m.zip_listeners=!1,m.__validate());for(var M=m.listeners.head;null!=M;){var k=M.elt;if(k.event==f&&0!=(k.itype&a.type)&&y.empty_arb(k.itype)){var O=t.push_callback(k);O.event=ye.id_CbEvent_END;var S,P=y.int1,T=y.int2,A=k.options1,E=P.cbTypes;if(A.nonemptyintersection(E,A.includes)&&!A.nonemptyintersection(E,A.excludes)){var I=k.options2,V=T.cbTypes;S=!!I.nonemptyintersection(V,I.includes)&&!I.nonemptyintersection(V,I.excludes)}else S=!1;S?(O.int1=P,O.int2=T):(O.int1=T,O.int2=P),O.set=y}M=M.next}null==y.arbiters.head&&this.remove_callbackset(y),o=o.next}else o=o.next}p=p.next}}if(a.b1!=i&&a.b1.type==ye.id_BodyType_DYNAMIC){var L=a.b1;L.world||(L.component.waket=this.stamp+(this.midstep?0:1),L.type==ye.id_BodyType_KINEMATIC&&(L.kinematicDelaySleep=!0),L.component.sleeping&&this.really_wake(L,!1))}if(a.b2!=i&&a.b2.type==ye.id_BodyType_DYNAMIC){var N=a.b2;N.world||(N.component.waket=this.stamp+(this.midstep?0:1),N.type==ye.id_BodyType_KINEMATIC&&(N.kinematicDelaySleep=!0),N.component.sleeping&&this.really_wake(N,!1))}if(a.cleared=!0,null==i||a.b2==i)for(var D=a.b1.arbiters,j=null,F=D.head;null!=F;){if(F.elt==a){var B,R;null==j?(B=D.head,R=B.next,null==(D.head=R)&&(D.pushmod=!0)):(B=j.next,R=B.next,j.next=R,null==R&&(D.pushmod=!0));var G=B;G.elt=null,G.next=Ni.zpp_pool,Ni.zpp_pool=G,D.modified=!0,D.length--,D.pushmod=!0,!0;break}j=F,F=F.next}if(null==i||a.b1==i)for(var Y=a.b2.arbiters,U=null,Z=Y.head;null!=Z;){if(Z.elt==a){var q,W;null==U?(q=Y.head,W=q.next,null==(Y.head=W)&&(Y.pushmod=!0)):(q=U.next,W=q.next,U.next=W,null==W&&(Y.pushmod=!0));var X=q;X.elt=null,X.next=Ni.zpp_pool,Ni.zpp_pool=X,Y.modified=!0,Y.length--,Y.pushmod=!0,!0;break}U=Z,Z=Z.next}null!=a.pair&&(a.pair.arb=null,a.pair=null),a.active=!1,this.f_arbiters.modified=!0,r=i.arbiters.erase(l)}else l=r,r=r.next}this.bphase.remove(n),n.removedFromSpace()},addConstraint:function(n){n.space=this,n.addedToSpace(),n.active&&(n.component.sleeping=!0,this.wake_constraint(n,!0))},remConstraint:function(n){n.active&&(this.wake_constraint(n,!0),this.live_constraints.remove(n)),n.removedFromSpace(),n.space=null},addCompound:function(n){n.space=this,n.addedToSpace();for(var e=n.bodies.head;null!=e;){this.addBody(e.elt),e=e.next}for(var t=n.constraints.head;null!=t;){this.addConstraint(t.elt),t=t.next}for(var i=n.compounds.head;null!=i;){this.addCompound(i.elt),i=i.next}},remCompound:function(n){for(var e=n.bodies.head;null!=e;){this.remBody(e.elt),e=e.next}for(var t=n.constraints.head;null!=t;){this.remConstraint(t.elt),t=t.next}for(var i=n.compounds.head;null!=i;){this.remCompound(i.elt),i=i.next}n.removedFromSpace(),n.space=null},addBody:function(n,e){null==e&&(e=-1),n.space=this,n.addedToSpace(),n.component.sleeping=!0;var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==ye.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0));for(var i=n.shapes.head;null!=i;){var l=i.elt;this.bphase.insert(l),l.addedToSpace(),i=i.next}n.type==ye.id_BodyType_STATIC?this.static_validation(n):n.type!=ye.id_BodyType_DYNAMIC&&e!=ye.id_BodyType_KINEMATIC&&this.kinematics.add(n)},remBody:function(n,e){if(null==e&&(e=-1),n.type==ye.id_BodyType_STATIC){var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==ye.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.staticsleep.remove(n)}else if(n.type==ye.id_BodyType_DYNAMIC){var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==ye.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0)),this.live.remove(n)}else{e!=ye.id_BodyType_KINEMATIC&&this.kinematics.remove(n);var l=n;l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==ye.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!0)),this.staticsleep.remove(n)}for(var r=n.shapes.head;null!=r;){this.removed_shape(r.elt,!0),r=r.next}n.removedFromSpace(),n.space=null},shapesUnderPoint:function(n,e,t,i){return this.bphase.shapesUnderPoint(n,e,t,i)},bodiesUnderPoint:function(n,e,t,i){return this.bphase.bodiesUnderPoint(n,e,t,i)},shapesInAABB:function(n,e,t,i,l){return this.bphase.shapesInAABB(n.zpp_inner,e,t,i,l)},bodiesInAABB:function(n,e,t,i,l){return this.bphase.bodiesInAABB(n.zpp_inner,e,t,i,l)},shapesInCircle:function(n,e,t,i,l){var r=this.bphase,a=n.zpp_inner;null!=a._validate&&a._validate();var p=n.zpp_inner.x,s=n.zpp_inner;return null!=s._validate&&s._validate(),r.shapesInCircle(p,n.zpp_inner.y,e,t,i,l)},bodiesInCircle:function(n,e,t,i,l){var r=this.bphase,a=n.zpp_inner;null!=a._validate&&a._validate();var p=n.zpp_inner.x,s=n.zpp_inner;return null!=s._validate&&s._validate(),r.bodiesInCircle(p,n.zpp_inner.y,e,t,i,l)},shapesInShape:function(n,e,t,i){return this.bphase.shapesInShape(n,e,t,i)},bodiesInShape:function(n,e,t,i){return this.bphase.bodiesInShape(n,e,t,i)},rayCast:function(n,e,t){return this.bphase.rayCast(n.zpp_inner,e,null==t?null:t.zpp_inner)},rayMultiCast:function(n,e,t,i){return this.bphase.rayMultiCast(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},convexShapeList:null,convexCast:function(n,e,t,i){var l;if(null==mt.zpp_pool?l=new mt:(l=mt.zpp_pool,mt.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,n.type==ye.id_ShapeType_CIRCLE){var r=n.circle;if(r.zip_worldCOM&&null!=r.body){if(r.zip_worldCOM=!1,r.zip_localCOM){if(r.zip_localCOM=!1,r.type==ye.id_ShapeType_POLYGON){var a=r.polygon;if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next){a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y;a.localCOMx*=.5,a.localCOMy*=.5}else{a.localCOMx=0,a.localCOMy=0;var p=0,s=a.lverts.next,o=s;s=s.next;var h=s;for(s=s.next;null!=s;){var _=s;p+=h.x*(_.y-o.y);var u=_.y*h.x-_.x*h.y;a.localCOMx+=(h.x+_.x)*u,a.localCOMy+=(h.y+_.y)*u,o=h,h=_,s=s.next}s=a.lverts.next;var d=s;p+=h.x*(d.y-o.y);var c=d.y*h.x-d.x*h.y;a.localCOMx+=(h.x+d.x)*c,a.localCOMy+=(h.y+d.y)*c,o=h,h=d,s=s.next;var x=s;p+=h.x*(x.y-o.y);var v=x.y*h.x-x.x*h.y;a.localCOMx+=(h.x+x.x)*v,a.localCOMy+=(h.y+x.y)*v,p=1/(3*p);var z=p;a.localCOMx*=z,a.localCOMy*=z}}null!=r.wrap_localCOM&&(r.wrap_localCOM.zpp_inner.x=r.localCOMx,r.wrap_localCOM.zpp_inner.y=r.localCOMy)}var y=r.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),r.worldCOMx=r.body.posx+(r.body.axisy*r.localCOMx-r.body.axisx*r.localCOMy),r.worldCOMy=r.body.posy+(r.localCOMx*r.body.axisx+r.localCOMy*r.body.axisy)}}else{var f=n.polygon;if(f.zip_gaxi&&null!=f.body){f.zip_gaxi=!1,f.validate_laxi();var m=f.body;if(m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var b=f.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot));for(var g=f.lverts.next,w=f.gverts.next;null!=w;){var C=w,M=g;g=g.next,C.x=f.body.posx+(f.body.axisy*M.x-f.body.axisx*M.y),C.y=f.body.posy+(M.x*f.body.axisx+M.y*f.body.axisy),w=w.next}}var k=f.edges.head,O=f.gverts.next,S=O;for(O=O.next;null!=O;){var P=O,T=k.elt;k=k.next,T.gp0=S,T.gp1=P,T.gnormx=f.body.axisy*T.lnormx-f.body.axisx*T.lnormy,T.gnormy=T.lnormx*f.body.axisx+T.lnormy*f.body.axisy,T.gprojection=f.body.posx*T.gnormx+f.body.posy*T.gnormy+T.lprojection,null!=T.wrap_gnorm&&(T.wrap_gnorm.zpp_inner.x=T.gnormx,T.wrap_gnorm.zpp_inner.y=T.gnormy),T.tp0=T.gp0.y*T.gnormx-T.gp0.x*T.gnormy,T.tp1=T.gp1.y*T.gnormx-T.gp1.x*T.gnormy,S=P,O=O.next}var A=f.gverts.next,E=k.elt;k=k.next,E.gp0=S,E.gp1=A,E.gnormx=f.body.axisy*E.lnormx-f.body.axisx*E.lnormy,E.gnormy=E.lnormx*f.body.axisx+E.lnormy*f.body.axisy,E.gprojection=f.body.posx*E.gnormx+f.body.posy*E.gnormy+E.lprojection,null!=E.wrap_gnorm&&(E.wrap_gnorm.zpp_inner.x=E.gnormx,E.wrap_gnorm.zpp_inner.y=E.gnormy),E.tp0=E.gp0.y*E.gnormx-E.gp0.x*E.gnormy,E.tp1=E.gp1.y*E.gnormx-E.gp1.x*E.gnormy}}var I=n.body,V=I.posx,L=I.posy;I.sweepTime=0,I.sweep_angvel=I.angvel;var N=e-I.sweepTime;if(0!=N){I.sweepTime=e;var D=N;if(I.posx+=I.velx*D,I.posy+=I.vely*D,0!=I.angvel){var j=I.sweep_angvel*N;if(I.rot+=j,j*j>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var F=j*j,B=1-.5*F,R=1-F*F/8,G=(B*I.axisx+j*I.axisy)*R;I.axisy=(B*I.axisy-j*I.axisx)*R,I.axisx=G}}}var Y=I.posx,U=I.posy;n.validate_sweepRadius();var Z,q=n.sweepRadius;null==Ze.zpp_pool?Z=new Ze:(Z=Ze.zpp_pool,Ze.zpp_pool=Z.next,Z.next=null);var W=V,X=Y;Z.minx=(X>W?W:X)-q;var H=V,K=Y;Z.maxx=(H>K?H:K)+q;var J=L,Q=U;Z.miny=(Q>J?J:Q)-q;var $=L,nn=U;Z.maxy=($>nn?$:nn)+q;var en=this.convexShapeList=this.bphase.shapesInAABB(Z,!1,!1,null==t?null:t.zpp_inner,this.convexShapeList),tn=Z;null!=tn.outer&&(tn.outer.zpp_inner=null,tn.outer=null),tn.wrap_min=tn.wrap_max=null,tn._invalidate=null,tn._validate=null,tn.next=Ze.zpp_pool,Ze.zpp_pool=tn;var ln=0,rn=0;ln=0,rn=0;var an=0,pn=0;an=0,pn=0;var sn=null,on=e+1;en.zpp_inner.valmod();for(var hn=$n.get(en);;){hn.zpp_inner.zpp_inner.valmod();var _n=hn.zpp_inner;_n.zpp_inner.valmod(),_n.zpp_inner.zip_length&&(_n.zpp_inner.zip_length=!1,_n.zpp_inner.user_length=_n.zpp_inner.inner.length);var un=_n.zpp_inner.user_length;hn.zpp_critical=!0;var dn;if(un>hn.zpp_i?dn=!0:(hn.zpp_next=$n.zpp_pool,$n.zpp_pool=hn,hn.zpp_inner=null,dn=!1),!dn)break;hn.zpp_critical=!1;var cn=hn.zpp_inner.at(hn.zpp_i++);if(cn!=n.outer&&(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null)!=I.outer){if(l.s1=n,l.s2=cn.zpp_inner,i){cn.zpp_inner.validate_sweepRadius(),(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,bt.dynamicSweep(l,e,0,0,!0);var xn=(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null).zpp_inner,vn=0-xn.sweepTime;if(0!=vn){xn.sweepTime=0;var zn=vn;if(xn.posx+=xn.velx*zn,xn.posy+=xn.vely*zn,0!=xn.angvel){var yn=xn.sweep_angvel*vn;if(xn.rot+=yn,yn*yn>1e-4)xn.axisx=Math.sin(xn.rot),xn.axisy=Math.cos(xn.rot);else{var fn=yn*yn,mn=1-.5*fn,bn=1-fn*fn/8,gn=(mn*xn.axisx+yn*xn.axisy)*bn;xn.axisy=(mn*xn.axisy-yn*xn.axisx)*bn,xn.axisx=gn}}}var wn=(null!=cn.zpp_inner.body?cn.zpp_inner.body.outer:null).zpp_inner,Cn=cn.zpp_inner;if(Cn.type==ye.id_ShapeType_CIRCLE)Cn.worldCOMx=wn.posx+(wn.axisy*Cn.localCOMx-wn.axisx*Cn.localCOMy),Cn.worldCOMy=wn.posy+(Cn.localCOMx*wn.axisx+Cn.localCOMy*wn.axisy);else{for(var Mn=Cn.polygon,kn=Mn.lverts.next,Sn=Mn.gverts.next;null!=Sn;){var Pn=Sn,Tn=kn;kn=kn.next,Pn.x=wn.posx+(wn.axisy*Tn.x-wn.axisx*Tn.y),Pn.y=wn.posy+(Tn.x*wn.axisx+Tn.y*wn.axisy),Sn=Sn.next}var An=Mn.edges.head,En=Mn.gverts.next,In=En;for(En=En.next;null!=En;){var Vn=En,Ln=An.elt;An=An.next,Ln.gnormx=wn.axisy*Ln.lnormx-wn.axisx*Ln.lnormy,Ln.gnormy=Ln.lnormx*wn.axisx+Ln.lnormy*wn.axisy,Ln.gprojection=wn.posx*Ln.gnormx+wn.posy*Ln.gnormy+Ln.lprojection,Ln.tp0=In.y*Ln.gnormx-In.x*Ln.gnormy,Ln.tp1=Vn.y*Ln.gnormx-Vn.x*Ln.gnormy,In=Vn,En=En.next}var Nn=Mn.gverts.next,Dn=An.elt;An=An.next,Dn.gnormx=wn.axisy*Dn.lnormx-wn.axisx*Dn.lnormy,Dn.gnormy=Dn.lnormx*wn.axisx+Dn.lnormy*wn.axisy,Dn.gprojection=wn.posx*Dn.gnormx+wn.posy*Dn.gnormy+Dn.lprojection,Dn.tp0=In.y*Dn.gnormx-In.x*Dn.gnormy,Dn.tp1=Nn.y*Dn.gnormx-Nn.x*Dn.gnormy}}else bt.staticSweep(l,e,0,0);l.toi*=e,l.toi>0&&on>l.toi&&(on=l.toi,ln=l.axis.x,rn=l.axis.y,an=l.c2.x,pn=l.c2.y,sn=cn)}}en.clear();var jn=l;jn.next=mt.zpp_pool,mt.zpp_pool=jn;var Fn=0-I.sweepTime;if(0!=Fn){I.sweepTime=0;var Bn=Fn;if(I.posx+=I.velx*Bn,I.posy+=I.vely*Bn,0!=I.angvel){var Rn=I.sweep_angvel*Fn;if(I.rot+=Rn,Rn*Rn>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var Gn=Rn*Rn,Yn=1-.5*Gn,Un=1-Gn*Gn/8,Zn=(Yn*I.axisx+Rn*I.axisy)*Un;I.axisy=(Yn*I.axisy-Rn*I.axisx)*Un,I.axisx=Zn}}}if(n.type==ye.id_ShapeType_CIRCLE)n.worldCOMx=I.posx+(I.axisy*n.localCOMx-I.axisx*n.localCOMy),n.worldCOMy=I.posy+(n.localCOMx*I.axisx+n.localCOMy*I.axisy);else{for(var qn=n.polygon,Wn=qn.lverts.next,Xn=qn.gverts.next;null!=Xn;){var Hn=Xn,Kn=Wn;Wn=Wn.next,Hn.x=I.posx+(I.axisy*Kn.x-I.axisx*Kn.y),Hn.y=I.posy+(Kn.x*I.axisx+Kn.y*I.axisy),Xn=Xn.next}var Jn=qn.edges.head,Qn=qn.gverts.next,ne=Qn;for(Qn=Qn.next;null!=Qn;){var ee=Qn,te=Jn.elt;Jn=Jn.next,te.gnormx=I.axisy*te.lnormx-I.axisx*te.lnormy,te.gnormy=te.lnormx*I.axisx+te.lnormy*I.axisy,te.gprojection=I.posx*te.gnormx+I.posy*te.gnormy+te.lprojection,te.tp0=ne.y*te.gnormx-ne.x*te.gnormy,te.tp1=ee.y*te.gnormx-ee.x*te.gnormy,ne=ee,Qn=Qn.next}var ie=qn.gverts.next,le=Jn.elt;Jn=Jn.next,le.gnormx=I.axisy*le.lnormx-I.axisx*le.lnormy,le.gnormy=le.lnormx*I.axisx+le.lnormy*I.axisy,le.gprojection=I.posx*le.gnormx+I.posy*le.gnormy+le.lprojection,le.tp0=ne.y*le.gnormx-ne.x*le.gnormy,le.tp1=ie.y*le.gnormx-ie.x*le.gnormy}if(on>e)return null;var re,ae=-ln,pe=-rn;if(null==Cl.poolVec2?re=new On:(re=Cl.poolVec2,Cl.poolVec2=re.zpp_pool,re.zpp_pool=null,re.zpp_disp=!1,re==Cl.nextVec2&&(Cl.nextVec2=null)),null==re.zpp_inner){var se;null==Ct.zpp_pool?se=new Ct:(se=Ct.zpp_pool,Ct.zpp_pool=se.next,se.next=null),se.weak=!1,se._immutable=!1,se.x=ae,se.y=pe,re.zpp_inner=se,re.zpp_inner.outer=re}else{var oe=re.zpp_inner;null!=oe._isimmutable&&oe._isimmutable();var he,_e=re.zpp_inner;if(null!=_e._validate&&_e._validate(),re.zpp_inner.x==ae){var ue=re.zpp_inner;null!=ue._validate&&ue._validate(),he=re.zpp_inner.y==pe}else he=!1;if(!he){re.zpp_inner.x=ae,re.zpp_inner.y=pe;var de=re.zpp_inner;null!=de._invalidate&&de._invalidate(de)}}re.zpp_inner.weak=!1;var ce;if(null==Cl.poolVec2?ce=new On:(ce=Cl.poolVec2,Cl.poolVec2=ce.zpp_pool,ce.zpp_pool=null,ce.zpp_disp=!1,ce==Cl.nextVec2&&(Cl.nextVec2=null)),null==ce.zpp_inner){var xe;null==Ct.zpp_pool?xe=new Ct:(xe=Ct.zpp_pool,Ct.zpp_pool=xe.next,xe.next=null),xe.weak=!1,xe._immutable=!1,xe.x=an,xe.y=pn,ce.zpp_inner=xe,ce.zpp_inner.outer=ce}else{var ve=ce.zpp_inner;null!=ve._isimmutable&&ve._isimmutable();var ze,fe=ce.zpp_inner;if(null!=fe._validate&&fe._validate(),ce.zpp_inner.x==an){var me=ce.zpp_inner;null!=me._validate&&me._validate(),ze=ce.zpp_inner.y==pn}else ze=!1;if(!ze){ce.zpp_inner.x=an,ce.zpp_inner.y=pn;var be=ce.zpp_inner;null!=be._invalidate&&be._invalidate(be)}}return ce.zpp_inner.weak=!1,He.getConvex(re,ce,on,sn)},prepareCast:function(n){if(n.type==ye.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==ye.id_ShapeType_POLYGON){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var i=0,l=t.lverts.next,r=l;l=l.next;var a=l;for(l=l.next;null!=l;){var p=l;i+=a.x*(p.y-r.y);var s=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*s,t.localCOMy+=(a.y+p.y)*s,r=a,a=p,l=l.next}l=t.lverts.next;var o=l;i+=a.x*(o.y-r.y);var h=o.y*a.x-o.x*a.y;t.localCOMx+=(a.x+o.x)*h,t.localCOMy+=(a.y+o.y)*h,r=a,a=o,l=l.next;var _=l;i+=a.x*(_.y-r.y);var u=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*u,t.localCOMy+=(a.y+_.y)*u,i=1/(3*i);var d=i;t.localCOMx*=d,t.localCOMy*=d}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var c=e.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}}else{var x=n.polygon;if(x.zip_gaxi&&null!=x.body){x.zip_gaxi=!1,x.validate_laxi();var v=x.body;if(v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),x.zip_gverts&&null!=x.body){x.zip_gverts=!1,x.validate_lverts();var z=x.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot));for(var y=x.lverts.next,f=x.gverts.next;null!=f;){var m=f,b=y;y=y.next,m.x=x.body.posx+(x.body.axisy*b.x-x.body.axisx*b.y),m.y=x.body.posy+(b.x*x.body.axisx+b.y*x.body.axisy),f=f.next}}var g=x.edges.head,w=x.gverts.next,C=w;for(w=w.next;null!=w;){var M=w,k=g.elt;g=g.next,k.gp0=C,k.gp1=M,k.gnormx=x.body.axisy*k.lnormx-x.body.axisx*k.lnormy,k.gnormy=k.lnormx*x.body.axisx+k.lnormy*x.body.axisy,k.gprojection=x.body.posx*k.gnormx+x.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy,C=M,w=w.next}var O=x.gverts.next,S=g.elt;g=g.next,S.gp0=C,S.gp1=O,S.gnormx=x.body.axisy*S.lnormx-x.body.axisx*S.lnormy,S.gnormy=S.lnormx*x.body.axisx+S.lnormy*x.body.axisy,S.gprojection=x.body.posx*S.gnormx+x.body.posy*S.gnormy+S.lprojection,null!=S.wrap_gnorm&&(S.wrap_gnorm.zpp_inner.x=S.gnormx,S.wrap_gnorm.zpp_inner.y=S.gnormy),S.tp0=S.gp0.y*S.gnormx-S.gp0.x*S.gnormy,S.tp1=S.gp1.y*S.gnormx-S.gp1.x*S.gnormy}}},convexMultiCast:function(n,e,t,i,l){var r;if(null==mt.zpp_pool?r=new mt:(r=mt.zpp_pool,mt.zpp_pool=r.next,r.next=null),r.failed=!1,r.s1=r.s2=null,r.arbiter=null,n.type==ye.id_ShapeType_CIRCLE){var a=n.circle;if(a.zip_worldCOM&&null!=a.body){if(a.zip_worldCOM=!1,a.zip_localCOM){if(a.zip_localCOM=!1,a.type==ye.id_ShapeType_POLYGON){var p=a.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next){p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;p.localCOMx+=1*p.lverts.next.next.x,p.localCOMy+=1*p.lverts.next.next.y;p.localCOMx*=.5,p.localCOMy*=.5}else{p.localCOMx=0,p.localCOMy=0;var s=0,o=p.lverts.next,h=o;o=o.next;var _=o;for(o=o.next;null!=o;){var u=o;s+=_.x*(u.y-h.y);var d=u.y*_.x-u.x*_.y;p.localCOMx+=(_.x+u.x)*d,p.localCOMy+=(_.y+u.y)*d,h=_,_=u,o=o.next}o=p.lverts.next;var c=o;s+=_.x*(c.y-h.y);var x=c.y*_.x-c.x*_.y;p.localCOMx+=(_.x+c.x)*x,p.localCOMy+=(_.y+c.y)*x,h=_,_=c,o=o.next;var v=o;s+=_.x*(v.y-h.y);var z=v.y*_.x-v.x*_.y;p.localCOMx+=(_.x+v.x)*z,p.localCOMy+=(_.y+v.y)*z,s=1/(3*s);var y=s;p.localCOMx*=y,p.localCOMy*=y}}null!=a.wrap_localCOM&&(a.wrap_localCOM.zpp_inner.x=a.localCOMx,a.wrap_localCOM.zpp_inner.y=a.localCOMy)}var f=a.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),a.worldCOMx=a.body.posx+(a.body.axisy*a.localCOMx-a.body.axisx*a.localCOMy),a.worldCOMy=a.body.posy+(a.localCOMx*a.body.axisx+a.localCOMy*a.body.axisy)}}else{var m=n.polygon;if(m.zip_gaxi&&null!=m.body){m.zip_gaxi=!1,m.validate_laxi();var b=m.body;if(b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)),m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var g=m.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot));for(var w=m.lverts.next,C=m.gverts.next;null!=C;){var M=C,k=w;w=w.next,M.x=m.body.posx+(m.body.axisy*k.x-m.body.axisx*k.y),M.y=m.body.posy+(k.x*m.body.axisx+k.y*m.body.axisy),C=C.next}}var O=m.edges.head,S=m.gverts.next,P=S;for(S=S.next;null!=S;){var T=S,A=O.elt;O=O.next,A.gp0=P,A.gp1=T,A.gnormx=m.body.axisy*A.lnormx-m.body.axisx*A.lnormy,A.gnormy=A.lnormx*m.body.axisx+A.lnormy*m.body.axisy,A.gprojection=m.body.posx*A.gnormx+m.body.posy*A.gnormy+A.lprojection,null!=A.wrap_gnorm&&(A.wrap_gnorm.zpp_inner.x=A.gnormx,A.wrap_gnorm.zpp_inner.y=A.gnormy),A.tp0=A.gp0.y*A.gnormx-A.gp0.x*A.gnormy,A.tp1=A.gp1.y*A.gnormx-A.gp1.x*A.gnormy,P=T,S=S.next}var E=m.gverts.next,I=O.elt;O=O.next,I.gp0=P,I.gp1=E,I.gnormx=m.body.axisy*I.lnormx-m.body.axisx*I.lnormy,I.gnormy=I.lnormx*m.body.axisx+I.lnormy*m.body.axisy,I.gprojection=m.body.posx*I.gnormx+m.body.posy*I.gnormy+I.lprojection,null!=I.wrap_gnorm&&(I.wrap_gnorm.zpp_inner.x=I.gnormx,I.wrap_gnorm.zpp_inner.y=I.gnormy),I.tp0=I.gp0.y*I.gnormx-I.gp0.x*I.gnormy,I.tp1=I.gp1.y*I.gnormx-I.gp1.x*I.gnormy}}var V=n.body,L=V.posx,N=V.posy;V.sweepTime=0,V.sweep_angvel=V.angvel;var D=e-V.sweepTime;if(0!=D){V.sweepTime=e;var j=D;if(V.posx+=V.velx*j,V.posy+=V.vely*j,0!=V.angvel){var F=V.sweep_angvel*D;if(V.rot+=F,F*F>1e-4)V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot);else{var B=F*F,R=1-.5*B,G=1-B*B/8,Y=(R*V.axisx+F*V.axisy)*G;V.axisy=(R*V.axisy-F*V.axisx)*G,V.axisx=Y}}}var U=V.posx,Z=V.posy;n.validate_sweepRadius();var q,W=n.sweepRadius;null==Ze.zpp_pool?q=new Ze:(q=Ze.zpp_pool,Ze.zpp_pool=q.next,q.next=null);var X=L,H=U;q.minx=(H>X?X:H)-W;var K=L,J=U;q.maxx=(K>J?K:J)+W;var Q=N,$=Z;q.miny=($>Q?Q:$)-W;var nn=N,en=Z;q.maxy=(nn>en?nn:en)+W;var tn=this.convexShapeList=this.bphase.shapesInAABB(q,!1,!1,null==t?null:t.zpp_inner,this.convexShapeList),ln=q;null!=ln.outer&&(ln.outer.zpp_inner=null,ln.outer=null),ln.wrap_min=ln.wrap_max=null,ln._invalidate=null,ln._validate=null,ln.next=Ze.zpp_pool,Ze.zpp_pool=ln;var rn=null==l?new cn:l;tn.zpp_inner.valmod();for(var an=$n.get(tn);;){an.zpp_inner.zpp_inner.valmod();var pn=an.zpp_inner;pn.zpp_inner.valmod(),pn.zpp_inner.zip_length&&(pn.zpp_inner.zip_length=!1,pn.zpp_inner.user_length=pn.zpp_inner.inner.length);var sn=pn.zpp_inner.user_length;an.zpp_critical=!0;var on;if(sn>an.zpp_i?on=!0:(an.zpp_next=$n.zpp_pool,$n.zpp_pool=an,an.zpp_inner=null,on=!1),!on)break;an.zpp_critical=!1;var hn=an.zpp_inner.at(an.zpp_i++);if(hn!=n.outer&&(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null)!=V.outer){if(r.s1=n,r.s2=hn.zpp_inner,i){hn.zpp_inner.validate_sweepRadius(),(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,bt.dynamicSweep(r,e,0,0,!0);var _n=(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null).zpp_inner,un=0-_n.sweepTime;if(0!=un){_n.sweepTime=0;var dn=un;if(_n.posx+=_n.velx*dn,_n.posy+=_n.vely*dn,0!=_n.angvel){var xn=_n.sweep_angvel*un;if(_n.rot+=xn,xn*xn>1e-4)_n.axisx=Math.sin(_n.rot),_n.axisy=Math.cos(_n.rot);else{var vn=xn*xn,zn=1-.5*vn,yn=1-vn*vn/8,fn=(zn*_n.axisx+xn*_n.axisy)*yn;_n.axisy=(zn*_n.axisy-xn*_n.axisx)*yn,_n.axisx=fn}}}var mn=(null!=hn.zpp_inner.body?hn.zpp_inner.body.outer:null).zpp_inner,bn=hn.zpp_inner;if(bn.type==ye.id_ShapeType_CIRCLE)bn.worldCOMx=mn.posx+(mn.axisy*bn.localCOMx-mn.axisx*bn.localCOMy),bn.worldCOMy=mn.posy+(bn.localCOMx*mn.axisx+bn.localCOMy*mn.axisy);else{for(var gn=bn.polygon,wn=gn.lverts.next,Cn=gn.gverts.next;null!=Cn;){var Mn=Cn,kn=wn;wn=wn.next,Mn.x=mn.posx+(mn.axisy*kn.x-mn.axisx*kn.y),Mn.y=mn.posy+(kn.x*mn.axisx+kn.y*mn.axisy),Cn=Cn.next}var Sn=gn.edges.head,Pn=gn.gverts.next,Tn=Pn;for(Pn=Pn.next;null!=Pn;){var An=Pn,En=Sn.elt;Sn=Sn.next,En.gnormx=mn.axisy*En.lnormx-mn.axisx*En.lnormy,En.gnormy=En.lnormx*mn.axisx+En.lnormy*mn.axisy,En.gprojection=mn.posx*En.gnormx+mn.posy*En.gnormy+En.lprojection,En.tp0=Tn.y*En.gnormx-Tn.x*En.gnormy,En.tp1=An.y*En.gnormx-An.x*En.gnormy,Tn=An,Pn=Pn.next}var In=gn.gverts.next,Vn=Sn.elt;Sn=Sn.next,Vn.gnormx=mn.axisy*Vn.lnormx-mn.axisx*Vn.lnormy,Vn.gnormy=Vn.lnormx*mn.axisx+Vn.lnormy*mn.axisy,Vn.gprojection=mn.posx*Vn.gnormx+mn.posy*Vn.gnormy+Vn.lprojection,Vn.tp0=Tn.y*Vn.gnormx-Tn.x*Vn.gnormy,Vn.tp1=In.y*Vn.gnormx-In.x*Vn.gnormy}}else bt.staticSweep(r,e,0,0);if((r.toi*=e)>0){var Ln,Nn=-r.axis.x,Dn=-r.axis.y;if(null==Cl.poolVec2?Ln=new On:(Ln=Cl.poolVec2,Cl.poolVec2=Ln.zpp_pool,Ln.zpp_pool=null,Ln.zpp_disp=!1,Ln==Cl.nextVec2&&(Cl.nextVec2=null)),null==Ln.zpp_inner){var jn;null==Ct.zpp_pool?jn=new Ct:(jn=Ct.zpp_pool,Ct.zpp_pool=jn.next,jn.next=null),jn.weak=!1,jn._immutable=!1,jn.x=Nn,jn.y=Dn,Ln.zpp_inner=jn,Ln.zpp_inner.outer=Ln}else{var Fn=Ln.zpp_inner;null!=Fn._isimmutable&&Fn._isimmutable();var Bn,Rn=Ln.zpp_inner;if(null!=Rn._validate&&Rn._validate(),Ln.zpp_inner.x==Nn){var Gn=Ln.zpp_inner;null!=Gn._validate&&Gn._validate(),Bn=Ln.zpp_inner.y==Dn}else Bn=!1;if(!Bn){Ln.zpp_inner.x=Nn,Ln.zpp_inner.y=Dn;var Yn=Ln.zpp_inner;null!=Yn._invalidate&&Yn._invalidate(Yn)}}Ln.zpp_inner.weak=!1;var Un,Zn=r.c2.x,qn=r.c2.y;if(null==Cl.poolVec2?Un=new On:(Un=Cl.poolVec2,Cl.poolVec2=Un.zpp_pool,Un.zpp_pool=null,Un.zpp_disp=!1,Un==Cl.nextVec2&&(Cl.nextVec2=null)),null==Un.zpp_inner){var Wn;null==Ct.zpp_pool?Wn=new Ct:(Wn=Ct.zpp_pool,Ct.zpp_pool=Wn.next,Wn.next=null),Wn.weak=!1,Wn._immutable=!1,Wn.x=Zn,Wn.y=qn,Un.zpp_inner=Wn,Un.zpp_inner.outer=Un}else{var Xn=Un.zpp_inner;null!=Xn._isimmutable&&Xn._isimmutable();var Hn,Kn=Un.zpp_inner;if(null!=Kn._validate&&Kn._validate(),Un.zpp_inner.x==Zn){var Jn=Un.zpp_inner;null!=Jn._validate&&Jn._validate(),Hn=Un.zpp_inner.y==qn}else Hn=!1;if(!Hn){Un.zpp_inner.x=Zn,Un.zpp_inner.y=qn;var Qn=Un.zpp_inner;null!=Qn._invalidate&&Qn._invalidate(Qn)}}Un.zpp_inner.weak=!1;for(var ne=He.getConvex(Ln,Un,r.toi,hn),ee=null,te=rn.zpp_inner.inner.head;null!=te;){var ie=te.elt;if(ie.zpp_inner.toiDistance>ne.zpp_inner.toiDistance)break;ee=te,te=te.next}var le,re=rn.zpp_inner.inner;null==ll.zpp_pool?le=new ll:(le=ll.zpp_pool,ll.zpp_pool=le.next,le.next=null),le.elt=ne;var ae=le;null==ee?(ae.next=re.head,re.head=ae):(ae.next=ee.next,ee.next=ae),re.pushmod=re.modified=!0,re.length++}}}tn.clear();var pe=r;pe.next=mt.zpp_pool,mt.zpp_pool=pe;var se=0-V.sweepTime;if(0!=se){V.sweepTime=0;var oe=se;if(V.posx+=V.velx*oe,V.posy+=V.vely*oe,0!=V.angvel){var he=V.sweep_angvel*se;if(V.rot+=he,he*he>1e-4)V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot);else{var _e=he*he,ue=1-.5*_e,de=1-_e*_e/8,ce=(ue*V.axisx+he*V.axisy)*de;V.axisy=(ue*V.axisy-he*V.axisx)*de,V.axisx=ce}}}if(n.type==ye.id_ShapeType_CIRCLE)n.worldCOMx=V.posx+(V.axisy*n.localCOMx-V.axisx*n.localCOMy),n.worldCOMy=V.posy+(n.localCOMx*V.axisx+n.localCOMy*V.axisy);else{for(var xe=n.polygon,ve=xe.lverts.next,ze=xe.gverts.next;null!=ze;){var fe=ze,me=ve;ve=ve.next,fe.x=V.posx+(V.axisy*me.x-V.axisx*me.y),fe.y=V.posy+(me.x*V.axisx+me.y*V.axisy),ze=ze.next}var be=xe.edges.head,ge=xe.gverts.next,we=ge;for(ge=ge.next;null!=ge;){var Ce=ge,Me=be.elt;be=be.next,Me.gnormx=V.axisy*Me.lnormx-V.axisx*Me.lnormy,Me.gnormy=Me.lnormx*V.axisx+Me.lnormy*V.axisy,Me.gprojection=V.posx*Me.gnormx+V.posy*Me.gnormy+Me.lprojection,Me.tp0=we.y*Me.gnormx-we.x*Me.gnormy,Me.tp1=Ce.y*Me.gnormx-Ce.x*Me.gnormy,we=Ce,ge=ge.next}var ke=xe.gverts.next,Oe=be.elt;be=be.next,Oe.gnormx=V.axisy*Oe.lnormx-V.axisx*Oe.lnormy,Oe.gnormy=Oe.lnormx*V.axisx+Oe.lnormy*V.axisy,Oe.gprojection=V.posx*Oe.gnormx+V.posy*Oe.gnormy+Oe.lprojection,Oe.tp0=we.y*Oe.gnormx-we.x*Oe.gnormy,Oe.tp1=ke.y*Oe.gnormx-ke.x*Oe.gnormy}return rn},push_callback:function(n){var e;return null==se.zpp_pool?e=new se:(e=se.zpp_pool,se.zpp_pool=e.next,e.next=null),this.callbacks.push(e),e.listener=n,e},pre_dt:null,step:function(n,e,t){var i=this;if(this.time+=n,this.pre_dt=n,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(n),this.sortcontacts){var l=this.c_arbiters_false;if(null!=l.head&&null!=l.head.next){for(var r,a,p,s=l.head,o=null,h=null,_=null,u=null,d=1;;){for(r=0,h=s,s=null,o=s;null!=h;){for(++r,_=h,a=0,p=d;null!=_&&d>a;)++a,_=_.next;for(;a>0||p>0&&null!=_;)0==a?(u=_,_=_.next,--p):0==p||null==_?(u=h,h=h.next,--a):h.elt.active&&_.elt.active&&h.elt.oc1.dist>=_.elt.oc1.dist?(u=_,_=_.next,--p):(u=h,h=h.next,--a),null!=o?o.next=u:s=u,o=u;h=_}if(o.next=null,d<<=1,r<=1)break}l.head=s,l.modified=!0,l.pushmod=!0}}this.updateVel(n),this.warmStart(),this.iterateVel(e);for(var c=this.kinematics.head;null!=c;){var x=c.elt;x.pre_posx=x.posx,x.pre_posy=x.posy,x.pre_rot=x.rot,c=c.next}for(var v=this.live.head;null!=v;){var z=v.elt;z.pre_posx=z.posx,z.pre_posy=z.posy,z.pre_rot=z.rot,v=v.next}this.updatePos(n),this.continuous=!0,this.continuousCollisions(n),this.continuous=!1,this.iteratePos(t);for(var y=this.kinematics.head;null!=y;){var f=y.elt,m=!(f.posx==f.pre_posx&&f.posy==f.pre_posy),b=f.pre_rot!=f.rot;if(m){for(var g=f.shapes.head;null!=g;){var w=g.elt;w.type==ye.id_ShapeType_POLYGON&&(w.polygon.invalidate_gverts(),w.polygon.invalidate_gaxi()),w.invalidate_worldCOM(),g=g.next}f.zip_worldCOM=!0}if(b){f.zip_axis=!0;for(var C=f.shapes.head;null!=C;){var M=C.elt;M.type==ye.id_ShapeType_POLYGON&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),C=C.next}f.zip_worldCOM=!0}y=y.next}for(var k=this.live.head;null!=k;){var O=k.elt,S=!(O.posx==O.pre_posx&&O.posy==O.pre_posy),P=O.pre_rot!=O.rot;if(S){for(var T=O.shapes.head;null!=T;){var A=T.elt;A.type==ye.id_ShapeType_POLYGON&&(A.polygon.invalidate_gverts(),A.polygon.invalidate_gaxi()),A.invalidate_worldCOM(),T=T.next}O.zip_worldCOM=!0}if(P){O.zip_axis=!0;for(var E=O.shapes.head;null!=E;){var I=E.elt;I.type==ye.id_ShapeType_POLYGON&&(I.polygon.invalidate_gverts(),I.polygon.invalidate_gaxi()),I.invalidate_worldCOM(),E=E.next}O.zip_worldCOM=!0}k=k.next}for(var V=null,L=this.staticsleep.head;null!=L;){var N=L.elt;if(N.type!=ye.id_BodyType_KINEMATIC||0==N.velx&&0==N.vely&&0==N.angvel){if(N.kinematicDelaySleep){N.kinematicDelaySleep=!1,L=L.next;continue}N.component.sleeping=!0;var D,j,F=this.staticsleep;null==V?(D=F.head,j=D.next,null==(F.head=j)&&(F.pushmod=!0)):(D=V.next,j=D.next,V.next=j,null==j&&(F.pushmod=!0));var B=D;B.elt=null,B.next=Pi.zpp_pool,Pi.zpp_pool=B,F.modified=!0,F.length--,F.pushmod=!0,L=j}else V=L,L=L.next}this.doForests(n),this.sleepArbiters(),this.midstep=!1;for(var R=null,G=this.callbackset_list.next;null!=G;){var Y=G;if(null!=Y.arbiters.head){var U;U=!0;for(var Z=Y.arbiters.head;null!=Z;){{if(!Z.elt.sleeping){U=!1;break}Z=Z.next}}for(var q=U,W=Y.int1.cbSet,X=Y.int2.cbSet,H=ye.id_CbEvent_ONGOING,K=null,J=X.cbpairs.length>W.cbpairs.length?W.cbpairs:X.cbpairs,Q=J.head;null!=Q;){var $=Q.elt;if($.a==W&&$.b==X||$.a==X&&$.b==W){K=$;break}Q=Q.next}if(null==K){var nn;null==he.zpp_pool?nn=new he:(nn=he.zpp_pool,he.zpp_pool=nn.next,nn.next=null),nn.zip_listeners=!0,oe.setlt(W,X)?(nn.a=W,nn.b=X):(nn.a=X,nn.b=W),K=nn,W.cbpairs.add(K),X!=W&&X.cbpairs.add(K)}K.zip_listeners&&(K.zip_listeners=!1,K.__validate());for(var en=K.listeners.head;null!=en;){var tn=en.elt;if(tn.event==H&&(!q||tn.allowSleepingCallbacks)&&!Y.empty_arb(tn.itype)){var ln=i.push_callback(tn);ln.event=ye.id_CbEvent_ONGOING;var rn,an=Y.int1,pn=Y.int2,sn=tn.options1,on=an.cbTypes;if(sn.nonemptyintersection(on,sn.includes)&&!sn.nonemptyintersection(on,sn.excludes)){var hn=tn.options2,_n=pn.cbTypes;rn=!!hn.nonemptyintersection(_n,hn.includes)&&!hn.nonemptyintersection(_n,hn.excludes)}else rn=!1;rn?(ln.int1=an,ln.int2=pn):(ln.int1=pn,ln.int2=an),ln.set=Y}en=en.next}R=G,G=G.next}else{var un,dn,cn=this.callbackset_list;null==R?(un=cn.next,dn=un.next,null==(cn.next=dn)&&(cn.pushmod=!0)):(un=R.next,dn=un.next,R.next=dn,null==dn&&(cn.pushmod=!0)),un._inuse=!1,cn.modified=!0,cn.length--,cn.pushmod=!0,G=dn;var xn=Y;xn.int1=xn.int2=null,xn.id=xn.di=-1,xn.freed=!0,xn.next=Yt.zpp_pool,Yt.zpp_pool=xn}}for(;!this.callbacks.empty();){var vn=this.callbacks.pop();if(vn.listener.type==ye.id_ListenerType_BODY){vn.listener.body.handler(vn.wrapper_body())}else if(vn.listener.type==ye.id_ListenerType_CONSTRAINT){var zn=vn.listener.constraint;zn.handler(vn.wrapper_con())}else if(vn.listener.type==ye.id_ListenerType_INTERACTION){var yn=vn.listener.interaction;yn.handleri(vn.wrapper_int())}var fn=vn;fn.int1=fn.int2=null,fn.body=null,fn.constraint=null,fn.listener=null,null!=fn.wrap_arbiters&&(fn.wrap_arbiters.zpp_inner.inner=null),fn.set=null,fn.next=se.zpp_pool,se.zpp_pool=fn}},toiEvents:null,continuousCollisions:function(n){var e=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var t=0;1>t&&null!=this.toiEvents.head;){for(var i=null,l=2,r=!1,a=null,p=null,s=this.toiEvents.head;null!=s;){var o=s.elt,h=o.s1.body,_=o.s2.body;if(h.sweepFrozen&&_.sweepFrozen){if(0==o.toi||!We.testCollide_safe(o.s1,o.s2)){s=this.toiEvents.erase(p);var u=o;u.next=mt.zpp_pool,mt.zpp_pool=u;continue}o.toi=0}if(o.frozen1!=h.sweepFrozen||o.frozen2!=_.sweepFrozen){if(o.kinematic){s=this.toiEvents.erase(p);var d=o;d.next=mt.zpp_pool,mt.zpp_pool=d;continue}if(o.frozen1=h.sweepFrozen,o.frozen2=_.sweepFrozen,o.frozen1){var c=o.s1;o.s1=o.s2,o.s2=c,o.frozen1=!1,o.frozen2=!0}if(bt.staticSweep(o,n,0,f.collisionSlopCCD),0>o.toi){s=this.toiEvents.erase(p);var x=o;x.next=mt.zpp_pool,mt.zpp_pool=x;continue}}o.toi>=0&&(l>o.toi||!r&&o.kinematic)&&(i=o,l=o.toi,r=o.kinematic,a=p),p=s,s=s.next}if(null==i)break;this.toiEvents.erase(a),t=i.toi;var v=i.s1.body,z=i.s2.body;if(!v.sweepFrozen){var y=t*n,m=y-v.sweepTime;if(0!=m){v.sweepTime=y;var b=m;if(v.posx+=v.velx*b,v.posy+=v.vely*b,0!=v.angvel){var g=v.sweep_angvel*m;if(v.rot+=g,g*g>1e-4)v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot);else{var w=g*g,C=1-.5*w,M=1-w*w/8,k=(C*v.axisx+g*v.axisy)*M;v.axisy=(C*v.axisy-g*v.axisx)*M,v.axisx=k}}}var O=i.s1;if(O.type==ye.id_ShapeType_CIRCLE)O.worldCOMx=v.posx+(v.axisy*O.localCOMx-v.axisx*O.localCOMy),O.worldCOMy=v.posy+(O.localCOMx*v.axisx+O.localCOMy*v.axisy);else{for(var S=O.polygon,P=S.lverts.next,T=S.gverts.next;null!=T;){var A=T,E=P;P=P.next,A.x=v.posx+(v.axisy*E.x-v.axisx*E.y),A.y=v.posy+(E.x*v.axisx+E.y*v.axisy),T=T.next}var I=S.edges.head,V=S.gverts.next,L=V;for(V=V.next;null!=V;){var N=V,D=I.elt;I=I.next,D.gnormx=v.axisy*D.lnormx-v.axisx*D.lnormy,D.gnormy=D.lnormx*v.axisx+D.lnormy*v.axisy,D.gprojection=v.posx*D.gnormx+v.posy*D.gnormy+D.lprojection,D.tp0=L.y*D.gnormx-L.x*D.gnormy,D.tp1=N.y*D.gnormx-N.x*D.gnormy,L=N,V=V.next}var j=S.gverts.next,F=I.elt;I=I.next,F.gnormx=v.axisy*F.lnormx-v.axisx*F.lnormy,F.gnormy=F.lnormx*v.axisx+F.lnormy*v.axisy,F.gprojection=v.posx*F.gnormx+v.posy*F.gnormy+F.lprojection,F.tp0=L.y*F.gnormx-L.x*F.gnormy,F.tp1=j.y*F.gnormx-j.x*F.gnormy}}if(!z.sweepFrozen){var B=t*n,R=B-z.sweepTime;if(0!=R){z.sweepTime=B;var G=R;if(z.posx+=z.velx*G,z.posy+=z.vely*G,0!=z.angvel){var Y=z.sweep_angvel*R;if(z.rot+=Y,Y*Y>1e-4)z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot);else{var U=Y*Y,Z=1-.5*U,q=1-U*U/8,W=(Z*z.axisx+Y*z.axisy)*q;z.axisy=(Z*z.axisy-Y*z.axisx)*q,z.axisx=W}}}var X=i.s2;if(X.type==ye.id_ShapeType_CIRCLE)X.worldCOMx=z.posx+(z.axisy*X.localCOMx-z.axisx*X.localCOMy),X.worldCOMy=z.posy+(X.localCOMx*z.axisx+X.localCOMy*z.axisy);else{for(var H=X.polygon,K=H.lverts.next,J=H.gverts.next;null!=J;){var Q=J,$=K;K=K.next,Q.x=z.posx+(z.axisy*$.x-z.axisx*$.y),Q.y=z.posy+($.x*z.axisx+$.y*z.axisy),J=J.next}var nn=H.edges.head,en=H.gverts.next,tn=en;for(en=en.next;null!=en;){var ln=en,rn=nn.elt;nn=nn.next,rn.gnormx=z.axisy*rn.lnormx-z.axisx*rn.lnormy,rn.gnormy=rn.lnormx*z.axisx+rn.lnormy*z.axisy,rn.gprojection=z.posx*rn.gnormx+z.posy*rn.gnormy+rn.lprojection,rn.tp0=tn.y*rn.gnormx-tn.x*rn.gnormy,rn.tp1=ln.y*rn.gnormx-ln.x*rn.gnormy,tn=ln,en=en.next}var an=H.gverts.next,pn=nn.elt;nn=nn.next,pn.gnormx=z.axisy*pn.lnormx-z.axisx*pn.lnormy,pn.gnormy=pn.lnormx*z.axisx+pn.lnormy*z.axisy,pn.gprojection=z.posx*pn.gnormx+z.posy*pn.gnormy+pn.lprojection,pn.tp0=tn.y*pn.gnormx-tn.x*pn.gnormy,pn.tp1=an.y*pn.gnormx-an.x*pn.gnormy}}var sn=this.narrowPhase(i.s1,i.s2,!0,i.arbiter,!0);if(null==sn)null!=i.arbiter&&null!=i.arbiter.pair&&(i.arbiter.pair.arb=null,i.arbiter.pair=null);else if(!this.presteparb(sn,n,!0)&&sn.type==Ne.COL&&sn.active&&0!=(sn.immState&ye.id_ImmState_ACCEPT)){var on=sn.colarb,hn=on.nx*on.c1.jnAcc-on.ny*on.c1.jtAcc,_n=on.ny*on.c1.jnAcc+on.nx*on.c1.jtAcc,un=on.b1.imass;on.b1.velx-=hn*un,on.b1.vely-=_n*un,on.b1.angvel-=on.b1.iinertia*(_n*on.c1.r1x-hn*on.c1.r1y);var dn=on.b2.imass;if(on.b2.velx+=hn*dn,on.b2.vely+=_n*dn,on.b2.angvel+=on.b2.iinertia*(_n*on.c1.r2x-hn*on.c1.r2y),on.hc2){var cn=on.nx*on.c2.jnAcc-on.ny*on.c2.jtAcc,xn=on.ny*on.c2.jnAcc+on.nx*on.c2.jtAcc,vn=on.b1.imass;on.b1.velx-=cn*vn,on.b1.vely-=xn*vn,on.b1.angvel-=on.b1.iinertia*(xn*on.c2.r1x-cn*on.c2.r1y);var zn=on.b2.imass;on.b2.velx+=cn*zn,on.b2.vely+=xn*zn,on.b2.angvel+=on.b2.iinertia*(xn*on.c2.r2x-cn*on.c2.r2y)}on.b2.angvel+=on.jrAcc*on.b2.iinertia,on.b1.angvel-=on.jrAcc*on.b1.iinertia;var yn,fn,mn,bn,gn,wn,Cn=sn.colarb,Mn=Cn.k1x+Cn.b2.velx-Cn.c1.r2y*Cn.b2.angvel-(Cn.b1.velx-Cn.c1.r1y*Cn.b1.angvel),kn=Cn.k1y+Cn.b2.vely+Cn.c1.r2x*Cn.b2.angvel-(Cn.b1.vely+Cn.c1.r1x*Cn.b1.angvel);if(mn=(kn*Cn.nx-Mn*Cn.ny+Cn.surfacex)*Cn.c1.tMass,bn=Cn.c1.friction*Cn.c1.jnAcc,gn=Cn.c1.jtAcc,wn=gn-mn,wn>bn?wn=bn:-bn>wn&&(wn=-bn),mn=wn-gn,Cn.c1.jtAcc=wn,yn=-Cn.ny*mn,fn=Cn.nx*mn,Cn.b2.velx+=yn*Cn.b2.imass,Cn.b2.vely+=fn*Cn.b2.imass,Cn.b1.velx-=yn*Cn.b1.imass,Cn.b1.vely-=fn*Cn.b1.imass,Cn.b2.angvel+=Cn.rt1b*mn*Cn.b2.iinertia,Cn.b1.angvel-=Cn.rt1a*mn*Cn.b1.iinertia,Cn.hc2){var On=Cn.k2x+Cn.b2.velx-Cn.c2.r2y*Cn.b2.angvel-(Cn.b1.velx-Cn.c2.r1y*Cn.b1.angvel),Sn=Cn.k2y+Cn.b2.vely+Cn.c2.r2x*Cn.b2.angvel-(Cn.b1.vely+Cn.c2.r1x*Cn.b1.angvel);mn=(Sn*Cn.nx-On*Cn.ny+Cn.surfacex)*Cn.c2.tMass,bn=Cn.c2.friction*Cn.c2.jnAcc,gn=Cn.c2.jtAcc,wn=gn-mn,wn>bn?wn=bn:-bn>wn&&(wn=-bn),mn=wn-gn,Cn.c2.jtAcc=wn,yn=-Cn.ny*mn,fn=Cn.nx*mn,Cn.b2.velx+=yn*Cn.b2.imass,Cn.b2.vely+=fn*Cn.b2.imass,Cn.b1.velx-=yn*Cn.b1.imass,Cn.b1.vely-=fn*Cn.b1.imass,Cn.b2.angvel+=Cn.rt2b*mn*Cn.b2.iinertia,Cn.b1.angvel-=Cn.rt2a*mn*Cn.b1.iinertia,Mn=Cn.k1x+Cn.b2.velx-Cn.c1.r2y*Cn.b2.angvel-(Cn.b1.velx-Cn.c1.r1y*Cn.b1.angvel),kn=Cn.k1y+Cn.b2.vely+Cn.c1.r2x*Cn.b2.angvel-(Cn.b1.vely+Cn.c1.r1x*Cn.b1.angvel),On=Cn.k2x+Cn.b2.velx-Cn.c2.r2y*Cn.b2.angvel-(Cn.b1.velx-Cn.c2.r1y*Cn.b1.angvel),Sn=Cn.k2y+Cn.b2.vely+Cn.c2.r2x*Cn.b2.angvel-(Cn.b1.vely+Cn.c2.r1x*Cn.b1.angvel);var Pn=Cn.c1.jnAcc,Tn=Cn.c2.jnAcc,An=Mn*Cn.nx+kn*Cn.ny+Cn.surfacey+Cn.c1.bounce-(Cn.Ka*Pn+Cn.Kb*Tn),En=On*Cn.nx+Sn*Cn.ny+Cn.surfacey+Cn.c2.bounce-(Cn.Kb*Pn+Cn.Kc*Tn),In=-(Cn.kMassa*An+Cn.kMassb*En),Vn=-(Cn.kMassb*An+Cn.kMassc*En);0>In||0>Vn?(In=-Cn.c1.nMass*An,0>In||0>Cn.Kb*In+En?(Vn=-Cn.c2.nMass*En,0>Vn||0>Cn.Kb*Vn+An?0>An||0>En?(An=0,En=0):(An=-Pn,En=-Tn,Cn.c1.jnAcc=Cn.c2.jnAcc=0):(An=-Pn,En=Vn-Tn,Cn.c1.jnAcc=0,Cn.c2.jnAcc=Vn)):(An=In-Pn,En=-Tn,Cn.c1.jnAcc=In,Cn.c2.jnAcc=0)):(An=In-Pn,En=Vn-Tn,Cn.c1.jnAcc=In,Cn.c2.jnAcc=Vn),mn=An+En,yn=Cn.nx*mn,fn=Cn.ny*mn,Cn.b2.velx+=yn*Cn.b2.imass,Cn.b2.vely+=fn*Cn.b2.imass,Cn.b1.velx-=yn*Cn.b1.imass,Cn.b1.vely-=fn*Cn.b1.imass,Cn.b2.angvel+=(Cn.rn1b*An+Cn.rn2b*En)*Cn.b2.iinertia,Cn.b1.angvel-=(Cn.rn1a*An+Cn.rn2a*En)*Cn.b1.iinertia}else{if(0!=Cn.radius){var Ln=Cn.b2.angvel-Cn.b1.angvel;mn=Ln*Cn.rMass,bn=Cn.rfric*Cn.c1.jnAcc,gn=Cn.jrAcc,Cn.jrAcc-=mn,Cn.jrAcc>bn?Cn.jrAcc=bn:-bn>Cn.jrAcc&&(Cn.jrAcc=-bn),mn=Cn.jrAcc-gn,Cn.b2.angvel+=mn*Cn.b2.iinertia,Cn.b1.angvel-=mn*Cn.b1.iinertia}Mn=Cn.k1x+Cn.b2.velx-Cn.c1.r2y*Cn.b2.angvel-(Cn.b1.velx-Cn.c1.r1y*Cn.b1.angvel),kn=Cn.k1y+Cn.b2.vely+Cn.c1.r2x*Cn.b2.angvel-(Cn.b1.vely+Cn.c1.r1x*Cn.b1.angvel),mn=(Cn.c1.bounce+(Cn.nx*Mn+Cn.ny*kn)+Cn.surfacey)*Cn.c1.nMass,gn=Cn.c1.jnAcc,wn=gn-mn,0>wn&&(wn=0),mn=wn-gn,Cn.c1.jnAcc=wn,yn=Cn.nx*mn,fn=Cn.ny*mn,Cn.b2.velx+=yn*Cn.b2.imass,Cn.b2.vely+=fn*Cn.b2.imass,Cn.b1.velx-=yn*Cn.b1.imass,Cn.b1.vely-=fn*Cn.b1.imass,Cn.b2.angvel+=Cn.rn1b*mn*Cn.b2.iinertia,Cn.b1.angvel-=Cn.rn1a*mn*Cn.b1.iinertia}var Nn,Dn,jn,Fn,Bn,Rn,Gn=sn.colarb,Yn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel);if(jn=(Un*Gn.nx-Yn*Gn.ny+Gn.surfacex)*Gn.c1.tMass,Fn=Gn.c1.friction*Gn.c1.jnAcc,Bn=Gn.c1.jtAcc,Rn=Bn-jn,Rn>Fn?Rn=Fn:-Fn>Rn&&(Rn=-Fn),jn=Rn-Bn,Gn.c1.jtAcc=Rn,Nn=-Gn.ny*jn,Dn=Gn.nx*jn,Gn.b2.velx+=Nn*Gn.b2.imass,Gn.b2.vely+=Dn*Gn.b2.imass,Gn.b1.velx-=Nn*Gn.b1.imass,Gn.b1.vely-=Dn*Gn.b1.imass,Gn.b2.angvel+=Gn.rt1b*jn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rt1a*jn*Gn.b1.iinertia,Gn.hc2){var Zn=Gn.k2x+Gn.b2.velx-Gn.c2.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c2.r1y*Gn.b1.angvel),qn=Gn.k2y+Gn.b2.vely+Gn.c2.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c2.r1x*Gn.b1.angvel);jn=(qn*Gn.nx-Zn*Gn.ny+Gn.surfacex)*Gn.c2.tMass,Fn=Gn.c2.friction*Gn.c2.jnAcc,Bn=Gn.c2.jtAcc,Rn=Bn-jn,Rn>Fn?Rn=Fn:-Fn>Rn&&(Rn=-Fn),jn=Rn-Bn,Gn.c2.jtAcc=Rn,Nn=-Gn.ny*jn,Dn=Gn.nx*jn,Gn.b2.velx+=Nn*Gn.b2.imass,Gn.b2.vely+=Dn*Gn.b2.imass,Gn.b1.velx-=Nn*Gn.b1.imass,Gn.b1.vely-=Dn*Gn.b1.imass,Gn.b2.angvel+=Gn.rt2b*jn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rt2a*jn*Gn.b1.iinertia,Yn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel),Zn=Gn.k2x+Gn.b2.velx-Gn.c2.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c2.r1y*Gn.b1.angvel),qn=Gn.k2y+Gn.b2.vely+Gn.c2.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c2.r1x*Gn.b1.angvel);var Wn=Gn.c1.jnAcc,Xn=Gn.c2.jnAcc,Hn=Yn*Gn.nx+Un*Gn.ny+Gn.surfacey+Gn.c1.bounce-(Gn.Ka*Wn+Gn.Kb*Xn),Kn=Zn*Gn.nx+qn*Gn.ny+Gn.surfacey+Gn.c2.bounce-(Gn.Kb*Wn+Gn.Kc*Xn),Jn=-(Gn.kMassa*Hn+Gn.kMassb*Kn),Qn=-(Gn.kMassb*Hn+Gn.kMassc*Kn);0>Jn||0>Qn?(Jn=-Gn.c1.nMass*Hn,0>Jn||0>Gn.Kb*Jn+Kn?(Qn=-Gn.c2.nMass*Kn,0>Qn||0>Gn.Kb*Qn+Hn?0>Hn||0>Kn?(Hn=0,Kn=0):(Hn=-Wn,Kn=-Xn,Gn.c1.jnAcc=Gn.c2.jnAcc=0):(Hn=-Wn,Kn=Qn-Xn,Gn.c1.jnAcc=0,Gn.c2.jnAcc=Qn)):(Hn=Jn-Wn,Kn=-Xn,Gn.c1.jnAcc=Jn,Gn.c2.jnAcc=0)):(Hn=Jn-Wn,Kn=Qn-Xn,Gn.c1.jnAcc=Jn,Gn.c2.jnAcc=Qn),jn=Hn+Kn,Nn=Gn.nx*jn,Dn=Gn.ny*jn,Gn.b2.velx+=Nn*Gn.b2.imass,Gn.b2.vely+=Dn*Gn.b2.imass,Gn.b1.velx-=Nn*Gn.b1.imass,Gn.b1.vely-=Dn*Gn.b1.imass,Gn.b2.angvel+=(Gn.rn1b*Hn+Gn.rn2b*Kn)*Gn.b2.iinertia,Gn.b1.angvel-=(Gn.rn1a*Hn+Gn.rn2a*Kn)*Gn.b1.iinertia}else{if(0!=Gn.radius){var $n=Gn.b2.angvel-Gn.b1.angvel;jn=$n*Gn.rMass,Fn=Gn.rfric*Gn.c1.jnAcc,Bn=Gn.jrAcc,Gn.jrAcc-=jn,Gn.jrAcc>Fn?Gn.jrAcc=Fn:-Fn>Gn.jrAcc&&(Gn.jrAcc=-Fn),jn=Gn.jrAcc-Bn,Gn.b2.angvel+=jn*Gn.b2.iinertia,Gn.b1.angvel-=jn*Gn.b1.iinertia}Yn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel),jn=(Gn.c1.bounce+(Gn.nx*Yn+Gn.ny*Un)+Gn.surfacey)*Gn.c1.nMass,Bn=Gn.c1.jnAcc,Rn=Bn-jn,0>Rn&&(Rn=0),jn=Rn-Bn,Gn.c1.jnAcc=Rn,Nn=Gn.nx*jn,Dn=Gn.ny*jn,Gn.b2.velx+=Nn*Gn.b2.imass,Gn.b2.vely+=Dn*Gn.b2.imass,Gn.b1.velx-=Nn*Gn.b1.imass,Gn.b1.vely-=Dn*Gn.b1.imass,Gn.b2.angvel+=Gn.rn1b*jn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rn1a*jn*Gn.b1.iinertia}var ne,ee,te,ie,le,re,ae=sn.colarb,pe=ae.k1x+ae.b2.velx-ae.c1.r2y*ae.b2.angvel-(ae.b1.velx-ae.c1.r1y*ae.b1.angvel),se=ae.k1y+ae.b2.vely+ae.c1.r2x*ae.b2.angvel-(ae.b1.vely+ae.c1.r1x*ae.b1.angvel);if(te=(se*ae.nx-pe*ae.ny+ae.surfacex)*ae.c1.tMass,ie=ae.c1.friction*ae.c1.jnAcc,le=ae.c1.jtAcc,re=le-te,re>ie?re=ie:-ie>re&&(re=-ie),te=re-le,ae.c1.jtAcc=re,ne=-ae.ny*te,ee=ae.nx*te,ae.b2.velx+=ne*ae.b2.imass,ae.b2.vely+=ee*ae.b2.imass,ae.b1.velx-=ne*ae.b1.imass,ae.b1.vely-=ee*ae.b1.imass,ae.b2.angvel+=ae.rt1b*te*ae.b2.iinertia,ae.b1.angvel-=ae.rt1a*te*ae.b1.iinertia,ae.hc2){var oe=ae.k2x+ae.b2.velx-ae.c2.r2y*ae.b2.angvel-(ae.b1.velx-ae.c2.r1y*ae.b1.angvel),he=ae.k2y+ae.b2.vely+ae.c2.r2x*ae.b2.angvel-(ae.b1.vely+ae.c2.r1x*ae.b1.angvel);te=(he*ae.nx-oe*ae.ny+ae.surfacex)*ae.c2.tMass,ie=ae.c2.friction*ae.c2.jnAcc,le=ae.c2.jtAcc,re=le-te,re>ie?re=ie:-ie>re&&(re=-ie),te=re-le,ae.c2.jtAcc=re,ne=-ae.ny*te,ee=ae.nx*te,ae.b2.velx+=ne*ae.b2.imass,ae.b2.vely+=ee*ae.b2.imass,ae.b1.velx-=ne*ae.b1.imass,ae.b1.vely-=ee*ae.b1.imass,ae.b2.angvel+=ae.rt2b*te*ae.b2.iinertia,ae.b1.angvel-=ae.rt2a*te*ae.b1.iinertia,pe=ae.k1x+ae.b2.velx-ae.c1.r2y*ae.b2.angvel-(ae.b1.velx-ae.c1.r1y*ae.b1.angvel),se=ae.k1y+ae.b2.vely+ae.c1.r2x*ae.b2.angvel-(ae.b1.vely+ae.c1.r1x*ae.b1.angvel),oe=ae.k2x+ae.b2.velx-ae.c2.r2y*ae.b2.angvel-(ae.b1.velx-ae.c2.r1y*ae.b1.angvel),he=ae.k2y+ae.b2.vely+ae.c2.r2x*ae.b2.angvel-(ae.b1.vely+ae.c2.r1x*ae.b1.angvel);var _e=ae.c1.jnAcc,ue=ae.c2.jnAcc,de=pe*ae.nx+se*ae.ny+ae.surfacey+ae.c1.bounce-(ae.Ka*_e+ae.Kb*ue),ce=oe*ae.nx+he*ae.ny+ae.surfacey+ae.c2.bounce-(ae.Kb*_e+ae.Kc*ue),xe=-(ae.kMassa*de+ae.kMassb*ce),ve=-(ae.kMassb*de+ae.kMassc*ce);0>xe||0>ve?(xe=-ae.c1.nMass*de,0>xe||0>ae.Kb*xe+ce?(ve=-ae.c2.nMass*ce,0>ve||0>ae.Kb*ve+de?0>de||0>ce?(de=0,ce=0):(de=-_e,ce=-ue,ae.c1.jnAcc=ae.c2.jnAcc=0):(de=-_e,ce=ve-ue,ae.c1.jnAcc=0,ae.c2.jnAcc=ve)):(de=xe-_e,ce=-ue,ae.c1.jnAcc=xe,ae.c2.jnAcc=0)):(de=xe-_e,ce=ve-ue,ae.c1.jnAcc=xe,ae.c2.jnAcc=ve),te=de+ce,ne=ae.nx*te,ee=ae.ny*te,ae.b2.velx+=ne*ae.b2.imass,ae.b2.vely+=ee*ae.b2.imass,ae.b1.velx-=ne*ae.b1.imass,ae.b1.vely-=ee*ae.b1.imass,ae.b2.angvel+=(ae.rn1b*de+ae.rn2b*ce)*ae.b2.iinertia,ae.b1.angvel-=(ae.rn1a*de+ae.rn2a*ce)*ae.b1.iinertia}else{if(0!=ae.radius){var ze=ae.b2.angvel-ae.b1.angvel;te=ze*ae.rMass,ie=ae.rfric*ae.c1.jnAcc,le=ae.jrAcc,ae.jrAcc-=te,ae.jrAcc>ie?ae.jrAcc=ie:-ie>ae.jrAcc&&(ae.jrAcc=-ie),te=ae.jrAcc-le,ae.b2.angvel+=te*ae.b2.iinertia,ae.b1.angvel-=te*ae.b1.iinertia}pe=ae.k1x+ae.b2.velx-ae.c1.r2y*ae.b2.angvel-(ae.b1.velx-ae.c1.r1y*ae.b1.angvel),se=ae.k1y+ae.b2.vely+ae.c1.r2x*ae.b2.angvel-(ae.b1.vely+ae.c1.r1x*ae.b1.angvel),te=(ae.c1.bounce+(ae.nx*pe+ae.ny*se)+ae.surfacey)*ae.c1.nMass,le=ae.c1.jnAcc,re=le-te,0>re&&(re=0),te=re-le,ae.c1.jnAcc=re,ne=ae.nx*te,ee=ae.ny*te,ae.b2.velx+=ne*ae.b2.imass,ae.b2.vely+=ee*ae.b2.imass,ae.b1.velx-=ne*ae.b1.imass,ae.b1.vely-=ee*ae.b1.imass,ae.b2.angvel+=ae.rn1b*te*ae.b2.iinertia,ae.b1.angvel-=ae.rn1a*te*ae.b1.iinertia}var fe,me,be,ge,we,Ce,Me=sn.colarb,ke=Me.k1x+Me.b2.velx-Me.c1.r2y*Me.b2.angvel-(Me.b1.velx-Me.c1.r1y*Me.b1.angvel),Oe=Me.k1y+Me.b2.vely+Me.c1.r2x*Me.b2.angvel-(Me.b1.vely+Me.c1.r1x*Me.b1.angvel);if(be=(Oe*Me.nx-ke*Me.ny+Me.surfacex)*Me.c1.tMass,ge=Me.c1.friction*Me.c1.jnAcc,we=Me.c1.jtAcc,Ce=we-be,Ce>ge?Ce=ge:-ge>Ce&&(Ce=-ge),be=Ce-we,Me.c1.jtAcc=Ce,fe=-Me.ny*be,me=Me.nx*be,Me.b2.velx+=fe*Me.b2.imass,Me.b2.vely+=me*Me.b2.imass,Me.b1.velx-=fe*Me.b1.imass,Me.b1.vely-=me*Me.b1.imass,Me.b2.angvel+=Me.rt1b*be*Me.b2.iinertia,Me.b1.angvel-=Me.rt1a*be*Me.b1.iinertia,Me.hc2){var Se=Me.k2x+Me.b2.velx-Me.c2.r2y*Me.b2.angvel-(Me.b1.velx-Me.c2.r1y*Me.b1.angvel),Pe=Me.k2y+Me.b2.vely+Me.c2.r2x*Me.b2.angvel-(Me.b1.vely+Me.c2.r1x*Me.b1.angvel);be=(Pe*Me.nx-Se*Me.ny+Me.surfacex)*Me.c2.tMass,ge=Me.c2.friction*Me.c2.jnAcc,we=Me.c2.jtAcc,Ce=we-be,Ce>ge?Ce=ge:-ge>Ce&&(Ce=-ge),be=Ce-we,Me.c2.jtAcc=Ce,fe=-Me.ny*be,me=Me.nx*be,Me.b2.velx+=fe*Me.b2.imass,Me.b2.vely+=me*Me.b2.imass,Me.b1.velx-=fe*Me.b1.imass,Me.b1.vely-=me*Me.b1.imass,Me.b2.angvel+=Me.rt2b*be*Me.b2.iinertia,Me.b1.angvel-=Me.rt2a*be*Me.b1.iinertia,ke=Me.k1x+Me.b2.velx-Me.c1.r2y*Me.b2.angvel-(Me.b1.velx-Me.c1.r1y*Me.b1.angvel),Oe=Me.k1y+Me.b2.vely+Me.c1.r2x*Me.b2.angvel-(Me.b1.vely+Me.c1.r1x*Me.b1.angvel),Se=Me.k2x+Me.b2.velx-Me.c2.r2y*Me.b2.angvel-(Me.b1.velx-Me.c2.r1y*Me.b1.angvel),Pe=Me.k2y+Me.b2.vely+Me.c2.r2x*Me.b2.angvel-(Me.b1.vely+Me.c2.r1x*Me.b1.angvel);var Te=Me.c1.jnAcc,Ae=Me.c2.jnAcc,Ee=ke*Me.nx+Oe*Me.ny+Me.surfacey+Me.c1.bounce-(Me.Ka*Te+Me.Kb*Ae),Ie=Se*Me.nx+Pe*Me.ny+Me.surfacey+Me.c2.bounce-(Me.Kb*Te+Me.Kc*Ae),Ve=-(Me.kMassa*Ee+Me.kMassb*Ie),Le=-(Me.kMassb*Ee+Me.kMassc*Ie);0>Ve||0>Le?(Ve=-Me.c1.nMass*Ee,0>Ve||0>Me.Kb*Ve+Ie?(Le=-Me.c2.nMass*Ie,0>Le||0>Me.Kb*Le+Ee?0>Ee||0>Ie?(Ee=0,Ie=0):(Ee=-Te,Ie=-Ae,Me.c1.jnAcc=Me.c2.jnAcc=0):(Ee=-Te,Ie=Le-Ae,Me.c1.jnAcc=0,Me.c2.jnAcc=Le)):(Ee=Ve-Te,Ie=-Ae,Me.c1.jnAcc=Ve,Me.c2.jnAcc=0)):(Ee=Ve-Te,Ie=Le-Ae,Me.c1.jnAcc=Ve,Me.c2.jnAcc=Le),be=Ee+Ie,fe=Me.nx*be,me=Me.ny*be,Me.b2.velx+=fe*Me.b2.imass,Me.b2.vely+=me*Me.b2.imass,Me.b1.velx-=fe*Me.b1.imass,Me.b1.vely-=me*Me.b1.imass,Me.b2.angvel+=(Me.rn1b*Ee+Me.rn2b*Ie)*Me.b2.iinertia,Me.b1.angvel-=(Me.rn1a*Ee+Me.rn2a*Ie)*Me.b1.iinertia}else{if(0!=Me.radius){var De=Me.b2.angvel-Me.b1.angvel;be=De*Me.rMass,ge=Me.rfric*Me.c1.jnAcc,we=Me.jrAcc,Me.jrAcc-=be,Me.jrAcc>ge?Me.jrAcc=ge:-ge>Me.jrAcc&&(Me.jrAcc=-ge),be=Me.jrAcc-we,Me.b2.angvel+=be*Me.b2.iinertia,Me.b1.angvel-=be*Me.b1.iinertia}ke=Me.k1x+Me.b2.velx-Me.c1.r2y*Me.b2.angvel-(Me.b1.velx-Me.c1.r1y*Me.b1.angvel),Oe=Me.k1y+Me.b2.vely+Me.c1.r2x*Me.b2.angvel-(Me.b1.vely+Me.c1.r1x*Me.b1.angvel),be=(Me.c1.bounce+(Me.nx*ke+Me.ny*Oe)+Me.surfacey)*Me.c1.nMass,we=Me.c1.jnAcc,Ce=we-be,0>Ce&&(Ce=0),be=Ce-we,Me.c1.jnAcc=Ce,fe=Me.nx*be,me=Me.ny*be,Me.b2.velx+=fe*Me.b2.imass,Me.b2.vely+=me*Me.b2.imass,Me.b1.velx-=fe*Me.b1.imass,Me.b1.vely-=me*Me.b1.imass,Me.b2.angvel+=Me.rn1b*be*Me.b2.iinertia,Me.b1.angvel-=Me.rn1a*be*Me.b1.iinertia}v.sweep_angvel=v.angvel%e,z.sweep_angvel=z.angvel%e}if(null!=sn&&sn.active&&0!=(sn.immState&ye.id_ImmState_ACCEPT)&&sn.type==Ne.COL){if(!v.sweepFrozen&&v.type!=ye.id_BodyType_KINEMATIC)if(v.sweepFrozen=!0,i.failed)v.angvel=v.sweep_angvel=0;else if(i.slipped){var je=v;je.sweep_angvel*=f.angularCCDSlipScale,v.angvel=je.sweep_angvel}else v.angvel=v.sweep_angvel;if(!z.sweepFrozen&&z.type!=ye.id_BodyType_KINEMATIC)if(z.sweepFrozen=!0,i.failed)z.angvel=z.sweep_angvel=0;else if(i.slipped){var Fe=z;Fe.sweep_angvel*=f.angularCCDSlipScale,z.angvel=Fe.sweep_angvel}else z.angvel=z.sweep_angvel}var Be=i;Be.next=mt.zpp_pool,mt.zpp_pool=Be}for(;null!=this.toiEvents.head;){var Re=this.toiEvents.pop_unsafe(),Ge=Re;Ge.next=mt.zpp_pool,mt.zpp_pool=Ge}for(var Ye=this.kinematics.head;null!=Ye;){var Ue=Ye.elt,Ze=n-Ue.sweepTime;if(0!=Ze){Ue.sweepTime=n;var qe=Ze;if(Ue.posx+=Ue.velx*qe,Ue.posy+=Ue.vely*qe,0!=Ue.angvel){var Xe=Ue.sweep_angvel*Ze;if(Ue.rot+=Xe,Xe*Xe>1e-4)Ue.axisx=Math.sin(Ue.rot),Ue.axisy=Math.cos(Ue.rot);else{var He=Xe*Xe,Ke=1-.5*He,Je=1-He*He/8,Qe=(Ke*Ue.axisx+Xe*Ue.axisy)*Je;Ue.axisy=(Ke*Ue.axisy-Xe*Ue.axisx)*Je,Ue.axisx=Qe}}}Ue.sweepTime=0,Ye=Ye.next}for(var $e=this.live.head;null!=$e;){var nt=$e.elt;if(!nt.sweepFrozen){var et=n-nt.sweepTime;if(0!=et){nt.sweepTime=n;var tt=et;if(nt.posx+=nt.velx*tt,nt.posy+=nt.vely*tt,0!=nt.angvel){var it=nt.sweep_angvel*et;if(nt.rot+=it,it*it>1e-4)nt.axisx=Math.sin(nt.rot),nt.axisy=Math.cos(nt.rot);else{var lt=it*it,rt=1-.5*lt,at=1-lt*lt/8,pt=(rt*nt.axisx+it*nt.axisy)*at;nt.axisy=(rt*nt.axisy-it*nt.axisx)*at,nt.axisx=pt}}}}nt.sweepTime=0,$e=$e.next}},continuousEvent:function(n,e,t,i,l){if(n.body.sweepFrozen&&e.body.sweepFrozen)return i;if(n.body.disableCCD||e.body.disableCCD)return i;var r;if(null==i||null!=i.colarb){var a,p=n.body,s=e.body;a=!1;for(var o=p.constraints.head;null!=o;){var h=o.elt;if(h.ignore&&h.pair_exists(p.id,s.id)){a=!0;break}o=o.next}var _,u;if(a)u=!1;else{for(var d=n;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var c,x=null==d?null:d.group;if(null==x)c=!1;else{for(var v=e;null!=v&&null==v.group;)v=null!=v.ishape?v.ishape.body:null!=v.icompound?v.icompound.compound:v.ibody.compound;var z=null==v?null:v.group;if(null==z)c=!1;else{for(var y=!1;null!=x&&null!=z;){if(x==z){y=x.ignore;break}z.depth>x.depth?z=z.group:x=x.group}c=y}}u=!c}if(u){var m;if(n.sensorEnabled||e.sensorEnabled){var b=n.filter,g=e.filter;m=0!=(b.sensorMask&g.sensorGroup)&&0!=(g.sensorMask&b.sensorGroup)}else m=!1;if(m)_=2;else{var w;if(n.fluidEnabled||e.fluidEnabled){var C=n.filter,M=e.filter;w=0!=(C.fluidMask&M.fluidGroup)&&0!=(M.fluidMask&C.fluidGroup)}else w=!1;if(!!w&&!(0==p.imass&&0==s.imass&&0==p.iinertia&&0==s.iinertia))_=0;else{var k,O=n.filter,S=e.filter;k=0!=(O.collisionMask&S.collisionGroup)&&0!=(S.collisionMask&O.collisionGroup)&&!(0==p.imass&&0==s.imass&&0==p.iinertia&&0==s.iinertia),_=k?1:-1}}}else _=-1;r=0>=_}else r=!0;if(r)return i;var P=n.body,T=e.body;if(t||P.bullet||T.bullet){var A;null==mt.zpp_pool?A=new mt:(A=mt.zpp_pool,mt.zpp_pool=A.next,A.next=null),A.failed=!1,A.s1=A.s2=null,A.arbiter=null;var E=P.type==ye.id_BodyType_KINEMATIC||T.type==ye.id_BodyType_KINEMATIC;if(t&&!E)n.body.type!=ye.id_BodyType_DYNAMIC?(A.s2=n,A.s1=e):(A.s1=n,A.s2=e),A.kinematic=!1,bt.staticSweep(A,this.pre_dt,0,f.collisionSlopCCD);else if(A.s1=n,A.s2=e,A.kinematic=E,A.s1.body.sweepFrozen||A.s2.body.sweepFrozen){if(A.s1.body.sweepFrozen){var I=A.s1;A.s1=A.s2,A.s2=I,A.frozen1=!1,A.frozen2=!0}bt.staticSweep(A,this.pre_dt,0,f.collisionSlopCCD)}else bt.dynamicSweep(A,this.pre_dt,0,f.collisionSlopCCD);if(t&&0>A.toi||A.failed){var V=A;V.next=mt.zpp_pool,mt.zpp_pool=V}else this.toiEvents.add(A),A.frozen1=A.s1.body.sweepFrozen,A.frozen2=A.s2.body.sweepFrozen,A.arbiter=null!=i?i.colarb:null}return i},bodyCbWake:function(n){if(n.type==ye.id_BodyType_DYNAMIC&&null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.bodylisteners.head;null!=e;){var t=e.elt;if(t.event==ye.id_CbEvent_WAKE){var i=this.push_callback(t);i.event=ye.id_CbEvent_WAKE,i.body=n,e=e.next}else e=e.next}else n.component.woken=!0},bodyCbSleep:function(n){if(n.type==ye.id_BodyType_DYNAMIC&&null!=n.cbSet)for(var e=n.cbSet.bodylisteners.head;null!=e;){var t=e.elt;if(t.event==ye.id_CbEvent_SLEEP){var i=this.push_callback(t);i.event=ye.id_CbEvent_SLEEP,i.body=n,e=e.next}else e=e.next}},constraintCbWake:function(n){if(null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(t.event==ye.id_CbEvent_WAKE){var i=this.push_callback(t);i.event=ye.id_CbEvent_WAKE,i.constraint=n,e=e.next}else e=e.next}else n.component.woken=!0},constraintCbSleep:function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(t.event==ye.id_CbEvent_SLEEP){var i=this.push_callback(t);i.event=ye.id_CbEvent_SLEEP,i.constraint=n,e=e.next}else e=e.next}},constraintCbBreak:function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(t.event==ye.id_CbEvent_BREAK){var i=this.push_callback(t);i.event=ye.id_CbEvent_BREAK,i.constraint=n,e=e.next}else e=e.next}},nullListenerType:function(n,e){for(var t=new xe,i=n.interactors.head;null!=i;){t.add(i.elt),i=i.next}if(n!=e)for(var l=e.interactors.head;null!=l;){var r=l.elt;t.add(r),l=l.next}for(;null!=t.head;){var a=t.pop_unsafe();if(null!=a.icompound){for(var p=a.icompound,s=p.bodies.head;null!=s;){t.add(s.elt),s=s.next}for(var o=p.compounds.head;null!=o;){t.add(o.elt),o=o.next}}else for(var h=null!=a.ibody?a.ibody:a.ishape.body,_=null!=a.ishape?a.ishape:null,u=h.arbiters.head;null!=u;){var d=u.elt;if(0!=d.present)if(null==_||d.ws1==_||d.ws2==_){this.MRCA_chains(d.ws1,d.ws2);for(var c=this.mrca1.head;null!=c;){var x=c.elt;if(x.cbSet==n||x.cbSet==e){for(var v=this.mrca2.head;null!=v;){var z=v.elt;if(x.cbSet==n&&z.cbSet!=e||x.cbSet==e&&z.cbSet!=n)v=v.next;else{var y=Ot.get(x,z);if(null!=y){for(;null!=y.arbiters.head;){var f=y.arbiters.pop_unsafe();f.present--}this.remove_callbackset(y)}v=v.next}}c=c.next}else c=c.next}u=u.next}else u=u.next;else u=u.next}}},nullInteractorType:function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var t=n.icompound,i=t.bodies.head;null!=i;){this.nullInteractorType(i.elt,e),i=i.next}for(var l=t.compounds.head;null!=l;){this.nullInteractorType(l.elt,e),l=l.next}}else for(var r=null!=n.ibody?n.ibody:n.ishape.body,a=null!=n.ishape?n.ishape:null,p=r.arbiters.head;null!=p;){var s=p.elt;if(0!=s.present)if(null==a||s.ws1==a||s.ws2==a){this.MRCA_chains(s.ws1,s.ws2);for(var o=this.mrca1.head;null!=o;){for(var h=o.elt,_=this.mrca2.head;null!=_;){var u=_.elt;if(h==e||u==e){var d=Ot.get(h,u);null!=d&&(s.present--,d.remove_arb(s),null==d.arbiters.head&&this.remove_callbackset(d)),_=_.next}else _=_.next}o=o.next}p=p.next}else p=p.next;else p=p.next}},freshListenerType:function(n,e){for(var t=new xe,i=n.interactors.head;null!=i;){t.add(i.elt),i=i.next}if(n!=e)for(var l=e.interactors.head;null!=l;){var r=l.elt;t.add(r),l=l.next}for(;null!=t.head;){var a=t.pop_unsafe();if(null!=a.icompound){for(var p=a.icompound,s=p.bodies.head;null!=s;){t.add(s.elt),s=s.next}for(var o=p.compounds.head;null!=o;){t.add(o.elt),o=o.next}}else for(var h=null!=a.ibody?a.ibody:a.ishape.body,_=null!=a.ishape?a.ishape:null,u=h.arbiters.head;null!=u;){var d=u.elt;if(d.presentable)if(null==_||d.ws1==_||d.ws2==_){this.MRCA_chains(d.ws1,d.ws2);for(var c=this.mrca1.head;null!=c;){var x=c.elt;if(x.cbSet==n||x.cbSet==e){for(var v=this.mrca2.head;null!=v;){var z=v.elt;if(x.cbSet==n&&z.cbSet!=e||x.cbSet==e&&z.cbSet!=n)v=v.next;else{var y=Ot.get(x,z);null==y&&(y=Yt.get(x,z),this.add_callbackset(y));var f,m;m=!1;for(var b=y.arbiters.head;null!=b;){var g=b.elt;if(g==d){m=!0;break}b=b.next}if(m)f=!1;else{var w,C=y.arbiters;null==Ni.zpp_pool?w=new Ni:(w=Ni.zpp_pool,Ni.zpp_pool=w.next,w.next=null),w.elt=d;var M=w;M.next=C.head,C.head=M,C.modified=!0,C.length++,f=!0}f&&d.present++,v=v.next}}c=c.next}else c=c.next}u=u.next}else u=u.next;else u=u.next}}},freshInteractorType:function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var t=n.icompound,i=t.bodies.head;null!=i;){this.freshInteractorType(i.elt,e),i=i.next}for(var l=t.compounds.head;null!=l;){this.freshInteractorType(l.elt,e),l=l.next}}else for(var r=null!=n.ibody?n.ibody:n.ishape.body,a=null!=n.ishape?n.ishape:null,p=r.arbiters.head;null!=p;){var s=p.elt;if(s.presentable)if(null==a||s.ws1==a||s.ws2==a){this.MRCA_chains(s.ws1,s.ws2);for(var o=this.mrca1.head;null!=o;){for(var h=o.elt,_=this.mrca2.head;null!=_;){var u=_.elt;if(h==e||u==e){var d=h.cbSet,c=u.cbSet;d.validate(),c.validate();for(var x=null,v=c.cbpairs.length>d.cbpairs.length?d.cbpairs:c.cbpairs,z=v.head;null!=z;){var y=z.elt;if(y.a==d&&y.b==c||y.a==c&&y.b==d){x=y;break}z=z.next}if(null==x){var f;null==he.zpp_pool?f=new he:(f=he.zpp_pool,he.zpp_pool=f.next,f.next=null),f.zip_listeners=!0,oe.setlt(d,c)?(f.a=d,f.b=c):(f.a=c,f.b=d),x=f,d.cbpairs.add(x),c!=d&&c.cbpairs.add(x)}if(x.zip_listeners&&(x.zip_listeners=!1,x.__validate()),null!=x.listeners.head){var m=Ot.get(h,u);null==m&&(m=Yt.get(h,u),this.add_callbackset(m));var b,g;g=!1;for(var w=m.arbiters.head;null!=w;){var C=w.elt;if(C==s){g=!0;break}w=w.next}if(g)b=!1;else{var M,k=m.arbiters;null==Ni.zpp_pool?M=new Ni:(M=Ni.zpp_pool,Ni.zpp_pool=M.next,M.next=null),M.elt=s;var O=M;O.next=k.head,k.head=O,k.modified=!0,k.length++,b=!0}b&&s.present++}_=_.next}else _=_.next}o=o.next}p=p.next}else p=p.next;else p=p.next}},wakeCompound:function(n){for(var e=n.bodies.head;null!=e;){var t=e.elt,i=t;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==ye.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),e=e.next}for(var l=n.constraints.head;null!=l;){this.wake_constraint(l.elt),l=l.next}for(var r=n.compounds.head;null!=r;){this.wakeCompound(r.elt),r=r.next}},wakeIsland:function(n){for(;null!=n.comps.head;){var e=n.comps.pop_unsafe();if(e.waket=this.stamp+(this.midstep?0:1),e.isBody){var t=e.body;this.live.add(t);for(var i=t.arbiters.head;null!=i;){var l=i.elt;if(l.sleeping)if(l.sleeping=!1,l.up_stamp+=this.stamp-l.sleep_stamp,l.type==Ne.COL){var r=l.colarb;if(r.stat){var a,p=this.c_arbiters_true;null==el.zpp_pool?a=new el:(a=el.zpp_pool,el.zpp_pool=a.next,a.next=null),a.elt=r;var s=a;s.next=p.head,p.head=s,p.modified=!0,p.length++}else{var o,h=this.c_arbiters_false;null==el.zpp_pool?o=new el:(o=el.zpp_pool,el.zpp_pool=o.next,o.next=null),o.elt=r;var _=o;_.next=h.head,h.head=_,h.modified=!0,h.length++}}else if(l.type==Ne.FLUID){var u,d=this.f_arbiters,c=l.fluidarb;null==$i.zpp_pool?u=new $i:(u=$i.zpp_pool,$i.zpp_pool=u.next,u.next=null),u.elt=c;var x=u;x.next=d.head,d.head=x,d.modified=!0,d.length++}else{var v,z=this.s_arbiters,y=l.sensorarb;null==nl.zpp_pool?v=new nl:(v=nl.zpp_pool,nl.zpp_pool=v.next,v.next=null),v.elt=y;var f=v;f.next=z.head,z.head=f,z.modified=!0,z.length++}i=i.next}if(this.bodyCbWake(t),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0,t.type!=ye.id_BodyType_STATIC)for(var m=t.shapes.head;null!=m;){var b=m.elt;null!=b.node&&this.bphase.sync(b),m=m.next}}else{var g,w=e.constraint,C=this.live_constraints;null==Ti.zpp_pool?g=new Ti:(g=Ti.zpp_pool,Ti.zpp_pool=g.next,g.next=null),g.elt=w;var M=g;M.next=C.head,C.head=M,C.modified=!0,C.length++,this.constraintCbWake(w),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0}}var k=n;k.next=Rt.zpp_pool,Rt.zpp_pool=k},non_inlined_wake:function(n,e){null==e&&(e=!1);var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==ye.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,e))},really_wake:function(n,e){if(null==e&&(e=!1),null==n.component.island){if(n.component.sleeping=!1,n.type==ye.id_BodyType_KINEMATIC||n.type==ye.id_BodyType_STATIC){var t,i=this.staticsleep;null==Pi.zpp_pool?t=new Pi:(t=Pi.zpp_pool,Pi.zpp_pool=t.next,t.next=null),t.elt=n;var l=t;l.next=i.head,i.head=l,i.modified=!0,i.length++}else{var r,a=this.live;null==Pi.zpp_pool?r=new Pi:(r=Pi.zpp_pool,Pi.zpp_pool=r.next,r.next=null),r.elt=n;var p=r;p.next=a.head,a.head=p,a.modified=!0,a.length++}for(var s=n.constraints.head;null!=s;){var o=s.elt;o.space==this&&this.wake_constraint(o),s=s.next}for(var h=n.arbiters.head;null!=h;){var _=h.elt;if(_.sleeping)if(_.sleeping=!1,_.up_stamp+=this.stamp+(this.midstep?0:1)-_.sleep_stamp,_.type==Ne.COL){var u=_.colarb;if(u.stat){var d,c=this.c_arbiters_true;null==el.zpp_pool?d=new el:(d=el.zpp_pool,el.zpp_pool=d.next,d.next=null),d.elt=u;var x=d;x.next=c.head,c.head=x,c.modified=!0,c.length++}else{var v,z=this.c_arbiters_false;null==el.zpp_pool?v=new el:(v=el.zpp_pool,el.zpp_pool=v.next,v.next=null),v.elt=u;var y=v;y.next=z.head,z.head=y,z.modified=!0,z.length++}}else if(_.type==Ne.FLUID){var f,m=this.f_arbiters,b=_.fluidarb;null==$i.zpp_pool?f=new $i:(f=$i.zpp_pool,$i.zpp_pool=f.next,f.next=null),f.elt=b;var g=f;g.next=m.head,m.head=g,m.modified=!0,m.length++}else{var w,C=this.s_arbiters,M=_.sensorarb;null==nl.zpp_pool?w=new nl:(w=nl.zpp_pool,nl.zpp_pool=w.next,w.next=null),w.elt=M;var k=w;k.next=C.head,C.head=k,C.modified=!0,C.length++}if(_.type!=Ne.SENSOR&&!_.cleared&&_.up_stamp>=this.stamp&&0!=(_.immState&ye.id_ImmState_ACCEPT)){if(_.b1.type==ye.id_BodyType_DYNAMIC&&_.b1.component.sleeping){var O=_.b1;O.world||(O.component.waket=this.stamp+(this.midstep?0:1),O.type==ye.id_BodyType_KINEMATIC&&(O.kinematicDelaySleep=!0),O.component.sleeping&&this.really_wake(O,!1))}if(_.b2.type==ye.id_BodyType_DYNAMIC&&_.b2.component.sleeping){var S=_.b2;S.world||(S.component.waket=this.stamp+(this.midstep?0:1),S.type==ye.id_BodyType_KINEMATIC&&(S.kinematicDelaySleep=!0),S.component.sleeping&&this.really_wake(S,!1))}}h=h.next}if(e||n.type!=ye.id_BodyType_DYNAMIC||this.bodyCbWake(n),!e&&!this.bphase.is_sweep&&n.type!=ye.id_BodyType_STATIC)for(var P=n.shapes.head;null!=P;){var T=P.elt;null!=T.node&&this.bphase.sync(T),P=P.next}}else this.wakeIsland(n.component.island)},wake_constraint:function(n,e){if(null==e&&(e=!1),n.active){if(n.component.waket=this.stamp+(this.midstep?0:1),n.component.sleeping){if(null==n.component.island){n.component.sleeping=!1;var t,i=this.live_constraints;null==Ti.zpp_pool?t=new Ti:(t=Ti.zpp_pool,Ti.zpp_pool=t.next,t.next=null),t.elt=n;var l=t;l.next=i.head,i.head=l,i.modified=!0,i.length++,n.wake_connected(),e||this.constraintCbWake(n)}else this.wakeIsland(n.component.island);return!0}return!1}return!1},doForests:function(n){for(var e=this.c_arbiters_false.head;null!=e;){var t=e.elt;if(!t.cleared&&t.up_stamp==this.stamp&&0!=(t.immState&ye.id_ImmState_ACCEPT)&&t.b1.type==ye.id_BodyType_DYNAMIC&&t.b2.type==ye.id_BodyType_DYNAMIC){var i;if(t.b1.component==t.b1.component.parent)i=t.b1.component;else{for(var l=t.b1.component,r=null;l!=l.parent;){var a=l.parent;l.parent=r,r=l,l=a}for(;null!=r;){var p=r.parent;r.parent=l,r=p}i=l}var s;if(t.b2.component==t.b2.component.parent)s=t.b2.component;else{for(var o=t.b2.component,h=null;o!=o.parent;){var _=o.parent;o.parent=h,h=o,o=_}for(;null!=h;){var u=h.parent;h.parent=o,h=u}s=o}i!=s&&(s.rank>i.rank?i.parent=s:i.rank>s.rank?s.parent=i:(s.parent=i,i.rank++))}e=e.next}for(var d=this.f_arbiters.head;null!=d;){var c=d.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&ye.id_ImmState_ACCEPT)&&c.b1.type==ye.id_BodyType_DYNAMIC&&c.b2.type==ye.id_BodyType_DYNAMIC){var x;if(c.b1.component==c.b1.component.parent)x=c.b1.component;else{for(var v=c.b1.component,z=null;v!=v.parent;){var y=v.parent;v.parent=z,z=v,v=y}for(;null!=z;){var f=z.parent;z.parent=v,z=f}x=v}var m;if(c.b2.component==c.b2.component.parent)m=c.b2.component;else{for(var b=c.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var C=g.parent;g.parent=b,g=C}m=b}x!=m&&(m.rank>x.rank?x.parent=m:x.rank>m.rank?m.parent=x:(m.parent=x,x.rank++))}d=d.next}for(var M=this.live_constraints.head;null!=M;){M.elt.forest(),M=M.next}for(;null!=this.live.head;){var k=this.live,O=k.head.elt;k.pop();var S,P=O,T=P.component;if(T==T.parent)S=T;else{for(var A=T,E=null;A!=A.parent;){var I=A.parent;A.parent=E,E=A,A=I}for(;null!=E;){var V=E.parent;E.parent=A,E=V}S=A}if(null==S.island){null==Rt.zpp_pool?S.island=new Rt:(S.island=Rt.zpp_pool,Rt.zpp_pool=S.island.next,S.island.next=null),S.island.waket=0;var L=this.islands,N=S.island;N._inuse=!0;var D=N;D.next=L.next,L.next=D,L.modified=!0,L.length++,S.island.sleep=!0}T.island=S.island;var j,F=T.island.comps;null==Ki.zpp_pool?j=new Ki:(j=Ki.zpp_pool,Ki.zpp_pool=j.next,j.next=null),j.elt=T;var B=j;B.next=F.head,F.head=B,F.modified=!0,F.length++;var R=P.atRest(n);T.island.sleep=T.island.sleep&&R,T.waket>T.island.waket&&(T.island.waket=T.waket)}for(;null!=this.live_constraints.head;){var G=this.live_constraints,Y=G.head.elt;G.pop();var U,Z=Y,q=Z.component;if(q==q.parent)U=q;else{for(var W=q,X=null;W!=W.parent;){var H=W.parent;W.parent=X,X=W,W=H}for(;null!=X;){var K=X.parent;X.parent=W,X=K}U=W}q.island=U.island;var J,Q=q.island.comps;null==Ki.zpp_pool?J=new Ki:(J=Ki.zpp_pool,Ki.zpp_pool=J.next,J.next=null),J.elt=q;var $=J;$.next=Q.head,Q.head=$,Q.modified=!0,Q.length++,q.waket>q.island.waket&&(q.island.waket=q.waket)}for(;null!=this.islands.next;){var nn=this.islands,en=nn.next;nn.pop();var tn=en;if(tn.sleep)for(var ln=tn.comps.head;null!=ln;){var rn=ln.elt;if(rn.isBody){var an=rn.body;an.velx=0,an.vely=0,an.angvel=0,rn.sleeping=!0;for(var pn=an.shapes.head;null!=pn;){var sn=pn.elt;this.bphase.sync(sn),pn=pn.next}this.bodyCbSleep(an)}else{var on=rn.constraint;this.constraintCbSleep(on),rn.sleeping=!0}ln=ln.next}else{for(;null!=tn.comps.head;){var hn=tn.comps,_n=hn.head.elt;hn.pop();var un=_n;if(un.waket=tn.waket,un.isBody){var dn,cn=this.live,xn=un.body;null==Pi.zpp_pool?dn=new Pi:(dn=Pi.zpp_pool,Pi.zpp_pool=dn.next,dn.next=null),dn.elt=xn;var vn=dn;vn.next=cn.head,cn.head=vn,cn.modified=!0,cn.length++}else{var zn,yn=this.live_constraints,fn=un.constraint;null==Ti.zpp_pool?zn=new Ti:(zn=Ti.zpp_pool,Ti.zpp_pool=zn.next,zn.next=null),zn.elt=fn;var mn=zn;mn.next=yn.head,yn.head=mn,yn.modified=!0,yn.length++}un.sleeping=!1,un.island=null,un.parent=un,un.rank=0}var bn=tn;bn.next=Rt.zpp_pool,Rt.zpp_pool=bn}}},sleepArbiters:function(){var n=null,e=this.c_arbiters_true,t=e.head,i=null!=this.c_arbiters_false;for(i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null);null!=t;){var l=t.elt;if(l.b1.component.sleeping&&l.b2.component.sleeping){l.sleep_stamp=this.stamp,l.sleeping=!0;var r,a;null==n?(r=e.head,a=r.next,null==(e.head=a)&&(e.pushmod=!0)):(r=n.next,a=r.next,n.next=a,null==a&&(e.pushmod=!0));var p=r;p.elt=null,p.next=el.zpp_pool,el.zpp_pool=p,e.modified=!0,e.length--,e.pushmod=!0,t=a,i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}else n=t,t=t.next,i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}var s=null,o=this.f_arbiters,h=o.head,_=!1;for(_&&null==h&&(_=!1,o=null,s=null);null!=h;){var u=h.elt;if(u.b1.component.sleeping&&u.b2.component.sleeping){u.sleep_stamp=this.stamp,u.sleeping=!0;var d,c;null==s?(d=o.head,c=d.next,null==(o.head=c)&&(o.pushmod=!0)):(d=s.next,c=d.next,s.next=c,null==c&&(o.pushmod=!0));var x=d;x.elt=null,x.next=$i.zpp_pool,$i.zpp_pool=x,o.modified=!0,o.length--,o.pushmod=!0,h=c,_&&null==h&&(_=!1,o=null,s=null)}else s=h,h=h.next,_&&null==h&&(_=!1,o=null,s=null)}var v=null,z=this.s_arbiters,y=z.head,f=!1;for(f&&null==y&&(f=!1,z=null,v=null);null!=y;){var m=y.elt;if(m.b1.component.sleeping&&m.b2.component.sleeping){m.sleep_stamp=this.stamp,m.sleeping=!0;var b,g;null==v?(b=z.head,g=b.next,null==(z.head=g)&&(z.pushmod=!0)):(b=v.next,g=b.next,v.next=g,null==g&&(z.pushmod=!0));var w=b;w.elt=null,w.next=nl.zpp_pool,nl.zpp_pool=w,z.modified=!0,z.length--,z.pushmod=!0,y=g,f&&null==y&&(f=!1,z=null,v=null)}else v=y,y=y.next,f&&null==y&&(f=!1,z=null,v=null)}},static_validation:function(n){if(null!=n.shapes.head&&n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=Infinity,n.aabb.miny=Infinity,n.aabb.maxx=-Infinity,n.aabb.maxy=-Infinity;for(var e=n.shapes.head;null!=e;){var t=e.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,t.type==ye.id_ShapeType_CIRCLE){var i=t.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,i.type==ye.id_ShapeType_POLYGON){var l=i.polygon;if(null==l.lverts.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;else if(null==l.lverts.next.next.next){l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;l.localCOMx+=1*l.lverts.next.next.x,l.localCOMy+=1*l.lverts.next.next.y;l.localCOMx*=.5,l.localCOMy*=.5}else{l.localCOMx=0,l.localCOMy=0;var r=0,a=l.lverts.next,p=a;a=a.next;var s=a;for(a=a.next;null!=a;){var o=a;r+=s.x*(o.y-p.y);var h=o.y*s.x-o.x*s.y;l.localCOMx+=(s.x+o.x)*h,l.localCOMy+=(s.y+o.y)*h,p=s,s=o,a=a.next}a=l.lverts.next;var _=a;r+=s.x*(_.y-p.y);var u=_.y*s.x-_.x*s.y;l.localCOMx+=(s.x+_.x)*u,l.localCOMy+=(s.y+_.y)*u,p=s,s=_,a=a.next;var d=a;r+=s.x*(d.y-p.y);var c=d.y*s.x-d.x*s.y;l.localCOMx+=(s.x+d.x)*c,l.localCOMy+=(s.y+d.y)*c,r=1/(3*r);var x=r;l.localCOMx*=x,l.localCOMy*=x}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var v=i.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var z=i.radius,y=i.radius;i.aabb.minx=i.worldCOMx-z,i.aabb.miny=i.worldCOMy-y,i.aabb.maxx=i.worldCOMx+z,i.aabb.maxy=i.worldCOMy+y}else{var f=t.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var m=f.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var b=f.lverts.next,g=f.gverts.next;null!=g;){var w=g,C=b;b=b.next,w.x=f.body.posx+(f.body.axisy*C.x-f.body.axisx*C.y),w.y=f.body.posy+(C.x*f.body.axisx+C.y*f.body.axisy),g=g.next}}var M=f.gverts.next;f.aabb.minx=M.x,f.aabb.miny=M.y,f.aabb.maxx=M.x,f.aabb.maxy=M.y;for(var k=f.gverts.next.next;null!=k;){var O=k;f.aabb.minx>O.x&&(f.aabb.minx=O.x),O.x>f.aabb.maxx&&(f.aabb.maxx=O.x),f.aabb.miny>O.y&&(f.aabb.miny=O.y),O.y>f.aabb.maxy&&(f.aabb.maxy=O.y),k=k.next}}var S=n.aabb,P=t.aabb;S.minx>P.minx&&(S.minx=P.minx),P.maxx>S.maxx&&(S.maxx=P.maxx),S.miny>P.miny&&(S.miny=P.miny),P.maxy>S.maxy&&(S.maxy=P.maxy),e=e.next}}n.validate_mass(),n.validate_inertia();for(var T=n.shapes.head;null!=T;){var A=T.elt;if(A.type==ye.id_ShapeType_POLYGON){var E=A.polygon;E.zip_sanitation&&(E.zip_sanitation=!1,E.splice_collinear_real());A.polygon.valid();null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1);var I=A.polygon;if(I.zip_gaxi&&null!=I.body){I.zip_gaxi=!1,I.validate_laxi();var V=I.body;if(V.zip_axis&&(V.zip_axis=!1,V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)),I.zip_gverts&&null!=I.body){I.zip_gverts=!1,I.validate_lverts();var L=I.body;L.zip_axis&&(L.zip_axis=!1,L.axisx=Math.sin(L.rot),L.axisy=Math.cos(L.rot));for(var N=I.lverts.next,D=I.gverts.next;null!=D;){var j=D,F=N;N=N.next,j.x=I.body.posx+(I.body.axisy*F.x-I.body.axisx*F.y),j.y=I.body.posy+(F.x*I.body.axisx+F.y*I.body.axisy),D=D.next}}var B=I.edges.head,R=I.gverts.next,G=R;for(R=R.next;null!=R;){var Y=R,U=B.elt;B=B.next,U.gp0=G,U.gp1=Y,U.gnormx=I.body.axisy*U.lnormx-I.body.axisx*U.lnormy,U.gnormy=U.lnormx*I.body.axisx+U.lnormy*I.body.axisy,U.gprojection=I.body.posx*U.gnormx+I.body.posy*U.gnormy+U.lprojection,null!=U.wrap_gnorm&&(U.wrap_gnorm.zpp_inner.x=U.gnormx,U.wrap_gnorm.zpp_inner.y=U.gnormy),U.tp0=U.gp0.y*U.gnormx-U.gp0.x*U.gnormy,U.tp1=U.gp1.y*U.gnormx-U.gp1.x*U.gnormy,G=Y,R=R.next}var Z=I.gverts.next,q=B.elt;B=B.next,q.gp0=G,q.gp1=Z,q.gnormx=I.body.axisy*q.lnormx-I.body.axisx*q.lnormy,q.gnormy=q.lnormx*I.body.axisx+q.lnormy*I.body.axisy,q.gprojection=I.body.posx*q.gnormx+I.body.posy*q.gnormy+q.lprojection,null!=q.wrap_gnorm&&(q.wrap_gnorm.zpp_inner.x=q.gnormx,q.wrap_gnorm.zpp_inner.y=q.gnormy),q.tp0=q.gp0.y*q.gnormx-q.gp0.x*q.gnormy,q.tp1=q.gp1.y*q.gnormx-q.gp1.x*q.gnormy}}T=T.next}n.sweepFrozen=!0},validation:function(){var n=this.cbsets;if(!n.cbsets.empty()){for(var e=n.cbsets.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(e.data.validate(),null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}for(var t=this.live.head;null!=t;){var i=t.elt;i.sweepRadius=0;for(var l=i.shapes.head;null!=l;){var r=l.elt;if(r.type==ye.id_ShapeType_POLYGON){var a=r.polygon;a.zip_sanitation&&(a.zip_sanitation=!1,a.splice_collinear_real());r.polygon.valid();null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1);var p=r.polygon;if(p.zip_gaxi&&null!=p.body){p.zip_gaxi=!1,p.validate_laxi();var s=p.body;if(s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),p.zip_gverts&&null!=p.body){p.zip_gverts=!1,p.validate_lverts();var o=p.body;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));for(var h=p.lverts.next,_=p.gverts.next;null!=_;){var u=_,d=h;h=h.next,u.x=p.body.posx+(p.body.axisy*d.x-p.body.axisx*d.y),u.y=p.body.posy+(d.x*p.body.axisx+d.y*p.body.axisy),_=_.next}}var c=p.edges.head,x=p.gverts.next,v=x;for(x=x.next;null!=x;){var z=x,y=c.elt;c=c.next,y.gp0=v,y.gp1=z,y.gnormx=p.body.axisy*y.lnormx-p.body.axisx*y.lnormy,y.gnormy=y.lnormx*p.body.axisx+y.lnormy*p.body.axisy,y.gprojection=p.body.posx*y.gnormx+p.body.posy*y.gnormy+y.lprojection,null!=y.wrap_gnorm&&(y.wrap_gnorm.zpp_inner.x=y.gnormx,y.wrap_gnorm.zpp_inner.y=y.gnormy),y.tp0=y.gp0.y*y.gnormx-y.gp0.x*y.gnormy,y.tp1=y.gp1.y*y.gnormx-y.gp1.x*y.gnormy,v=z,x=x.next}var f=p.gverts.next,m=c.elt;c=c.next,m.gp0=v,m.gp1=f,m.gnormx=p.body.axisy*m.lnormx-p.body.axisx*m.lnormy,m.gnormy=m.lnormx*p.body.axisx+m.lnormy*p.body.axisy,m.gprojection=p.body.posx*m.gnormx+p.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy}}r.validate_sweepRadius(),r.sweepRadius>i.sweepRadius&&(i.sweepRadius=r.sweepRadius),l=l.next}if(i.validate_mass(),i.validate_inertia(),null!=i.shapes.head){if(i.zip_aabb){i.zip_aabb=!1,i.aabb.minx=Infinity,i.aabb.miny=Infinity,i.aabb.maxx=-Infinity,i.aabb.maxy=-Infinity;for(var b=i.shapes.head;null!=b;){var g=b.elt;if(g.zip_aabb&&null!=g.body)if(g.zip_aabb=!1,g.type==ye.id_ShapeType_CIRCLE){var w=g.circle;if(w.zip_worldCOM&&null!=w.body){if(w.zip_worldCOM=!1,w.zip_localCOM){if(w.zip_localCOM=!1,w.type==ye.id_ShapeType_POLYGON){var C=w.polygon;if(null==C.lverts.next.next)C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;else if(null==C.lverts.next.next.next){C.localCOMx=C.lverts.next.x,C.localCOMy=C.lverts.next.y;C.localCOMx+=1*C.lverts.next.next.x,C.localCOMy+=1*C.lverts.next.next.y;C.localCOMx*=.5,C.localCOMy*=.5}else{C.localCOMx=0,C.localCOMy=0;var M=0,k=C.lverts.next,O=k;k=k.next;var S=k;for(k=k.next;null!=k;){var P=k;M+=S.x*(P.y-O.y);var T=P.y*S.x-P.x*S.y;C.localCOMx+=(S.x+P.x)*T,C.localCOMy+=(S.y+P.y)*T,O=S,S=P,k=k.next}k=C.lverts.next;var A=k;M+=S.x*(A.y-O.y);var E=A.y*S.x-A.x*S.y;C.localCOMx+=(S.x+A.x)*E,C.localCOMy+=(S.y+A.y)*E,O=S,S=A,k=k.next;var I=k;M+=S.x*(I.y-O.y);var V=I.y*S.x-I.x*S.y;C.localCOMx+=(S.x+I.x)*V,C.localCOMy+=(S.y+I.y)*V,M=1/(3*M);var L=M;C.localCOMx*=L,C.localCOMy*=L}}null!=w.wrap_localCOM&&(w.wrap_localCOM.zpp_inner.x=w.localCOMx,w.wrap_localCOM.zpp_inner.y=w.localCOMy)}var N=w.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),w.worldCOMx=w.body.posx+(w.body.axisy*w.localCOMx-w.body.axisx*w.localCOMy),w.worldCOMy=w.body.posy+(w.localCOMx*w.body.axisx+w.localCOMy*w.body.axisy)}var D=w.radius,j=w.radius;w.aabb.minx=w.worldCOMx-D,w.aabb.miny=w.worldCOMy-j,w.aabb.maxx=w.worldCOMx+D,w.aabb.maxy=w.worldCOMy+j}else{var F=g.polygon;if(F.zip_gverts&&null!=F.body){F.zip_gverts=!1,F.validate_lverts();var B=F.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot));for(var R=F.lverts.next,G=F.gverts.next;null!=G;){var Y=G,U=R;R=R.next,Y.x=F.body.posx+(F.body.axisy*U.x-F.body.axisx*U.y),Y.y=F.body.posy+(U.x*F.body.axisx+U.y*F.body.axisy),G=G.next}}var Z=F.gverts.next;F.aabb.minx=Z.x,F.aabb.miny=Z.y,F.aabb.maxx=Z.x,F.aabb.maxy=Z.y;for(var q=F.gverts.next.next;null!=q;){var W=q;F.aabb.minx>W.x&&(F.aabb.minx=W.x),W.x>F.aabb.maxx&&(F.aabb.maxx=W.x),F.aabb.miny>W.y&&(F.aabb.miny=W.y),W.y>F.aabb.maxy&&(F.aabb.maxy=W.y),q=q.next}}var X=i.aabb,H=g.aabb;X.minx>H.minx&&(X.minx=H.minx),H.maxx>X.maxx&&(X.maxx=H.maxx),X.miny>H.miny&&(X.miny=H.miny),H.maxy>X.maxy&&(X.maxy=H.maxy),b=b.next}}i.validate_worldCOM()}if(i.validate_gravMass(),i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),i.component.woken&&null!=i.cbSet)for(var K=i.cbSet.bodylisteners.head;null!=K;){var J=K.elt;if(J.event==ye.id_CbEvent_WAKE){var Q=this.push_callback(J);Q.event=ye.id_CbEvent_WAKE,Q.body=i,K=K.next}else K=K.next}i.component.woken=!1;for(var $=i.shapes.head;null!=$;){this.bphase.sync($.elt),$=$.next}t=t.next}for(var nn=this.kinematics.head;null!=nn;){var en=nn.elt;en.sweepRadius=0;for(var tn=en.shapes.head;null!=tn;){var ln=tn.elt;if(ln.type==ye.id_ShapeType_POLYGON){var rn=ln.polygon;rn.zip_sanitation&&(rn.zip_sanitation=!1,rn.splice_collinear_real());ln.polygon.valid();null==ye.ValidationResult_VALID&&(ye.internal=!0,ye.ValidationResult_VALID=new te,ye.internal=!1);var an=ln.polygon;if(an.zip_gaxi&&null!=an.body){an.zip_gaxi=!1,an.validate_laxi();var pn=an.body;if(pn.zip_axis&&(pn.zip_axis=!1,pn.axisx=Math.sin(pn.rot),pn.axisy=Math.cos(pn.rot)),an.zip_gverts&&null!=an.body){an.zip_gverts=!1,an.validate_lverts();var sn=an.body;sn.zip_axis&&(sn.zip_axis=!1,sn.axisx=Math.sin(sn.rot),sn.axisy=Math.cos(sn.rot));for(var on=an.lverts.next,hn=an.gverts.next;null!=hn;){var _n=hn,un=on;on=on.next,_n.x=an.body.posx+(an.body.axisy*un.x-an.body.axisx*un.y),_n.y=an.body.posy+(un.x*an.body.axisx+un.y*an.body.axisy),hn=hn.next}}var dn=an.edges.head,cn=an.gverts.next,xn=cn;for(cn=cn.next;null!=cn;){var vn=cn,zn=dn.elt;dn=dn.next,zn.gp0=xn,zn.gp1=vn,zn.gnormx=an.body.axisy*zn.lnormx-an.body.axisx*zn.lnormy,zn.gnormy=zn.lnormx*an.body.axisx+zn.lnormy*an.body.axisy,zn.gprojection=an.body.posx*zn.gnormx+an.body.posy*zn.gnormy+zn.lprojection,null!=zn.wrap_gnorm&&(zn.wrap_gnorm.zpp_inner.x=zn.gnormx,zn.wrap_gnorm.zpp_inner.y=zn.gnormy),zn.tp0=zn.gp0.y*zn.gnormx-zn.gp0.x*zn.gnormy,zn.tp1=zn.gp1.y*zn.gnormx-zn.gp1.x*zn.gnormy,xn=vn,cn=cn.next}var yn=an.gverts.next,fn=dn.elt;dn=dn.next,fn.gp0=xn,fn.gp1=yn,fn.gnormx=an.body.axisy*fn.lnormx-an.body.axisx*fn.lnormy,fn.gnormy=fn.lnormx*an.body.axisx+fn.lnormy*an.body.axisy,fn.gprojection=an.body.posx*fn.gnormx+an.body.posy*fn.gnormy+fn.lprojection,null!=fn.wrap_gnorm&&(fn.wrap_gnorm.zpp_inner.x=fn.gnormx,fn.wrap_gnorm.zpp_inner.y=fn.gnormy),fn.tp0=fn.gp0.y*fn.gnormx-fn.gp0.x*fn.gnormy,fn.tp1=fn.gp1.y*fn.gnormx-fn.gp1.x*fn.gnormy}}ln.validate_sweepRadius(),ln.sweepRadius>en.sweepRadius&&(en.sweepRadius=ln.sweepRadius),tn=tn.next}if(en.validate_mass(),en.validate_inertia(),null!=en.shapes.head){if(en.zip_aabb){en.zip_aabb=!1,en.aabb.minx=Infinity,en.aabb.miny=Infinity,en.aabb.maxx=-Infinity,en.aabb.maxy=-Infinity;for(var mn=en.shapes.head;null!=mn;){var bn=mn.elt;if(bn.zip_aabb&&null!=bn.body)if(bn.zip_aabb=!1,bn.type==ye.id_ShapeType_CIRCLE){var gn=bn.circle;if(gn.zip_worldCOM&&null!=gn.body){if(gn.zip_worldCOM=!1,gn.zip_localCOM){if(gn.zip_localCOM=!1,gn.type==ye.id_ShapeType_POLYGON){var wn=gn.polygon;if(null==wn.lverts.next.next)wn.localCOMx=wn.lverts.next.x,wn.localCOMy=wn.lverts.next.y;else if(null==wn.lverts.next.next.next){wn.localCOMx=wn.lverts.next.x,wn.localCOMy=wn.lverts.next.y;wn.localCOMx+=1*wn.lverts.next.next.x,wn.localCOMy+=1*wn.lverts.next.next.y;wn.localCOMx*=.5,wn.localCOMy*=.5}else{wn.localCOMx=0,wn.localCOMy=0;var Cn=0,Mn=wn.lverts.next,kn=Mn;Mn=Mn.next;var On=Mn;for(Mn=Mn.next;null!=Mn;){var Sn=Mn;Cn+=On.x*(Sn.y-kn.y);var Pn=Sn.y*On.x-Sn.x*On.y;wn.localCOMx+=(On.x+Sn.x)*Pn,wn.localCOMy+=(On.y+Sn.y)*Pn,kn=On,On=Sn,Mn=Mn.next}Mn=wn.lverts.next;var Tn=Mn;Cn+=On.x*(Tn.y-kn.y);var An=Tn.y*On.x-Tn.x*On.y;wn.localCOMx+=(On.x+Tn.x)*An,wn.localCOMy+=(On.y+Tn.y)*An,kn=On,On=Tn,Mn=Mn.next;var En=Mn;Cn+=On.x*(En.y-kn.y);var In=En.y*On.x-En.x*On.y;wn.localCOMx+=(On.x+En.x)*In,wn.localCOMy+=(On.y+En.y)*In,Cn=1/(3*Cn);var Vn=Cn;wn.localCOMx*=Vn,wn.localCOMy*=Vn}}null!=gn.wrap_localCOM&&(gn.wrap_localCOM.zpp_inner.x=gn.localCOMx,gn.wrap_localCOM.zpp_inner.y=gn.localCOMy)}var Ln=gn.body;Ln.zip_axis&&(Ln.zip_axis=!1,Ln.axisx=Math.sin(Ln.rot),Ln.axisy=Math.cos(Ln.rot)),gn.worldCOMx=gn.body.posx+(gn.body.axisy*gn.localCOMx-gn.body.axisx*gn.localCOMy),gn.worldCOMy=gn.body.posy+(gn.localCOMx*gn.body.axisx+gn.localCOMy*gn.body.axisy)}var Nn=gn.radius,Dn=gn.radius;gn.aabb.minx=gn.worldCOMx-Nn,gn.aabb.miny=gn.worldCOMy-Dn,gn.aabb.maxx=gn.worldCOMx+Nn,gn.aabb.maxy=gn.worldCOMy+Dn}else{var jn=bn.polygon;if(jn.zip_gverts&&null!=jn.body){jn.zip_gverts=!1,jn.validate_lverts();var Fn=jn.body;Fn.zip_axis&&(Fn.zip_axis=!1,Fn.axisx=Math.sin(Fn.rot),Fn.axisy=Math.cos(Fn.rot));for(var Bn=jn.lverts.next,Rn=jn.gverts.next;null!=Rn;){var Gn=Rn,Yn=Bn;Bn=Bn.next,Gn.x=jn.body.posx+(jn.body.axisy*Yn.x-jn.body.axisx*Yn.y),Gn.y=jn.body.posy+(Yn.x*jn.body.axisx+Yn.y*jn.body.axisy),Rn=Rn.next}}var Un=jn.gverts.next;jn.aabb.minx=Un.x,jn.aabb.miny=Un.y,jn.aabb.maxx=Un.x,jn.aabb.maxy=Un.y;for(var Zn=jn.gverts.next.next;null!=Zn;){var qn=Zn;jn.aabb.minx>qn.x&&(jn.aabb.minx=qn.x),qn.x>jn.aabb.maxx&&(jn.aabb.maxx=qn.x),jn.aabb.miny>qn.y&&(jn.aabb.miny=qn.y),qn.y>jn.aabb.maxy&&(jn.aabb.maxy=qn.y),Zn=Zn.next}}var Wn=en.aabb,Xn=bn.aabb;Wn.minx>Xn.minx&&(Wn.minx=Xn.minx),Xn.maxx>Wn.maxx&&(Wn.maxx=Xn.maxx),Wn.miny>Xn.miny&&(Wn.miny=Xn.miny),Xn.maxy>Wn.maxy&&(Wn.maxy=Xn.maxy),mn=mn.next}}en.validate_worldCOM()}en.validate_gravMass(),en.zip_axis&&(en.zip_axis=!1,en.axisx=Math.sin(en.rot),en.axisy=Math.cos(en.rot));for(var Hn=en.shapes.head;null!=Hn;){this.bphase.sync(Hn.elt),Hn=Hn.next}nn=nn.next}for(var Kn=this.live_constraints.head;null!=Kn;){var Jn=Kn.elt;if(Jn.active){if(Jn.validate(),Jn.component.woken&&null!=Jn.cbSet)for(var Qn=Jn.cbSet.conlisteners.head;null!=Qn;){var $n=Qn.elt;if($n.event==ye.id_CbEvent_WAKE){var ne=this.push_callback($n);ne.event=ye.id_CbEvent_WAKE,ne.constraint=Jn,Qn=Qn.next}else Qn=Qn.next}Jn.component.woken=!1}Kn=Kn.next}},updateVel:function(n){for(var e=1-n*this.global_lin_drag,t=1-n*this.global_ang_drag,i=this.live.head;null!=i;){var l=i.elt;if(0!=l.smass){var r=n*l.imass;l.velx=e*l.velx+(l.forcex+this.gravityx*l.gravMass)*r,l.vely=e*l.vely+(l.forcey+this.gravityy*l.gravMass)*r}if(0!=l.sinertia){var a=0,p=0;a=l.worldCOMx-l.posx,p=l.worldCOMy-l.posy;l.angvel=t*l.angvel+(l.torque+(this.gravityy*a-this.gravityx*p)*l.gravMass)*n*l.iinertia}i,i=i.next}},updatePos:function(n){for(var e=2*Math.PI/n,t=this.live.head;null!=t;){var i=t.elt;i.pre_posx=i.posx,i.pre_posy=i.posy,i.pre_rot=i.rot,i.sweepTime=0,i.sweep_angvel=i.angvel%e;var l=n-i.sweepTime;if(0!=l){i.sweepTime=n;var r=l;if(i.posx+=i.velx*r,i.posy+=i.vely*r,0!=i.angvel){var a=i.sweep_angvel*l;if(i.rot+=a,a*a>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var p=a*a,s=1-.5*p,o=1-p*p/8,h=(s*i.axisx+a*i.axisy)*o;i.axisy=(s*i.axisy-a*i.axisx)*o,i.axisx=h}}}if(i.disableCCD)i.sweepFrozen=!0,i.bullet=!1;else{var _=f.staticCCDLinearThreshold*i.sweepRadius,u=f.staticCCDAngularThreshold;if((i.velx*i.velx+i.vely*i.vely)*n*n>_*_||i.angvel*i.angvel*n*n>u*u||i.type==ye.id_BodyType_KINEMATIC){var d=i.sweep_angvel;0>d&&(d=-d);for(var c=1/d,x=i.shapes.head;null!=x;){var v=x.elt,z=v.aabb,y=z.minx,m=z.miny,b=z.maxx,g=z.maxy,w=d*n*v.sweepCoef*.008333333333333333|0;w>8&&(w=8);var C=d*n/w,M=n-i.sweepTime;if(0!=M){i.sweepTime=n;var k=M;if(i.posx+=i.velx*k,i.posy+=i.vely*k,0!=i.angvel){var O=i.sweep_angvel*M;if(i.rot+=O,O*O>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var S=O*O,P=1-.5*S,T=1-S*S/8,A=(P*i.axisx+O*i.axisy)*T;i.axisy=(P*i.axisy-O*i.axisx)*T,i.axisx=A}}}if(v.type==ye.id_ShapeType_CIRCLE){var E=v.circle;E.worldCOMx=E.body.posx+(E.body.axisy*E.localCOMx-E.body.axisx*E.localCOMy),E.worldCOMy=E.body.posy+(E.localCOMx*E.body.axisx+E.localCOMy*E.body.axisy),E.aabb.minx=E.worldCOMx-E.radius,E.aabb.miny=E.worldCOMy-E.radius,E.aabb.maxx=E.worldCOMx+E.radius,E.aabb.maxy=E.worldCOMy+E.radius}else{var I=v.polygon,V=I.lverts.next,L=I.gverts.next,N=V;V=V.next,L.x=I.body.posx+(I.body.axisy*N.x-I.body.axisx*N.y),L.y=I.body.posy+(N.x*I.body.axisx+N.y*I.body.axisy),I.aabb.minx=L.x,I.aabb.miny=L.y,I.aabb.maxx=L.x,I.aabb.maxy=L.y;for(var D=I.gverts.next.next;null!=D;){var j=D,F=V;V=V.next,j.x=I.body.posx+(I.body.axisy*F.x-I.body.axisx*F.y),j.y=I.body.posy+(F.x*I.body.axisx+F.y*I.body.axisy),I.aabb.minx>j.x&&(I.aabb.minx=j.x),j.x>I.aabb.maxx&&(I.aabb.maxx=j.x),I.aabb.miny>j.y&&(I.aabb.miny=j.y),j.y>I.aabb.maxy&&(I.aabb.maxy=j.y),D=D.next}}z.minx>y?z.minx=y:y=z.minx,z.miny>m?z.miny=m:m=z.miny,b>z.maxx?z.maxx=b:b=z.maxx,g>z.maxy?z.maxy=g:g=z.maxy;for(var B=1,R=w;R>B;){var G=B++,Y=C*G*c,U=Y-i.sweepTime;if(0!=U){i.sweepTime=Y;var Z=U;if(i.posx+=i.velx*Z,i.posy+=i.vely*Z,0!=i.angvel){var q=i.sweep_angvel*U;if(i.rot+=q,q*q>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var W=q*q,X=1-.5*W,H=1-W*W/8,K=(X*i.axisx+q*i.axisy)*H;i.axisy=(X*i.axisy-q*i.axisx)*H,i.axisx=K}}}if(v.type==ye.id_ShapeType_CIRCLE){var J=v.circle;J.worldCOMx=J.body.posx+(J.body.axisy*J.localCOMx-J.body.axisx*J.localCOMy),J.worldCOMy=J.body.posy+(J.localCOMx*J.body.axisx+J.localCOMy*J.body.axisy),J.aabb.minx=J.worldCOMx-J.radius,J.aabb.miny=J.worldCOMy-J.radius,J.aabb.maxx=J.worldCOMx+J.radius,J.aabb.maxy=J.worldCOMy+J.radius}else{var Q=v.polygon,$=Q.lverts.next,nn=Q.gverts.next,en=$;$=$.next,nn.x=Q.body.posx+(Q.body.axisy*en.x-Q.body.axisx*en.y),nn.y=Q.body.posy+(en.x*Q.body.axisx+en.y*Q.body.axisy),Q.aabb.minx=nn.x,Q.aabb.miny=nn.y,Q.aabb.maxx=nn.x,Q.aabb.maxy=nn.y;for(var tn=Q.gverts.next.next;null!=tn;){var ln=tn,rn=$;$=$.next,ln.x=Q.body.posx+(Q.body.axisy*rn.x-Q.body.axisx*rn.y),ln.y=Q.body.posy+(rn.x*Q.body.axisx+rn.y*Q.body.axisy),Q.aabb.minx>ln.x&&(Q.aabb.minx=ln.x),ln.x>Q.aabb.maxx&&(Q.aabb.maxx=ln.x),Q.aabb.miny>ln.y&&(Q.aabb.miny=ln.y),ln.y>Q.aabb.maxy&&(Q.aabb.maxy=ln.y),tn=tn.next}}z.minx>y?z.minx=y:y=z.minx,z.miny>m?z.miny=m:m=z.miny,b>z.maxx?z.maxx=b:b=z.maxx,g>z.maxy?z.maxy=g:g=z.maxy}this.bphase.sync(v),x=x.next}if(i.sweepFrozen=!1,i.type==ye.id_BodyType_DYNAMIC&&i.bulletEnabled){var an=f.bulletCCDLinearThreshold*i.sweepRadius,pn=f.bulletCCDAngularThreshold;((i.velx*i.velx+i.vely*i.vely)*n*n>an*an||i.angvel*i.angvel*n*n>pn*pn)&&(i.bullet=!0)}}else i.sweepFrozen=!0,i.bullet=!1}t=t.next}for(var sn=this.kinematics.head;null!=sn;){var on=sn.elt;on.pre_posx=on.posx,on.pre_posy=on.posy,on.pre_rot=on.rot,on.sweepTime=0,on.sweep_angvel=on.angvel%e;var hn=n-on.sweepTime;if(0!=hn){on.sweepTime=n;var _n=hn;if(on.posx+=on.velx*_n,on.posy+=on.vely*_n,0!=on.angvel){var un=on.sweep_angvel*hn;if(on.rot+=un,un*un>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var dn=un*un,cn=1-.5*dn,xn=1-dn*dn/8,vn=(cn*on.axisx+un*on.axisy)*xn;on.axisy=(cn*on.axisy-un*on.axisx)*xn,on.axisx=vn}}}if(on.disableCCD)on.sweepFrozen=!0,on.bullet=!1;else{var zn=f.staticCCDLinearThreshold*on.sweepRadius,yn=f.staticCCDAngularThreshold;if((on.velx*on.velx+on.vely*on.vely)*n*n>zn*zn||on.angvel*on.angvel*n*n>yn*yn||on.type==ye.id_BodyType_KINEMATIC){var fn=on.sweep_angvel;0>fn&&(fn=-fn);for(var mn=1/fn,bn=on.shapes.head;null!=bn;){var gn=bn.elt,wn=gn.aabb,Cn=wn.minx,Mn=wn.miny,kn=wn.maxx,On=wn.maxy,Sn=fn*n*gn.sweepCoef*.008333333333333333|0;Sn>8&&(Sn=8);var Pn=fn*n/Sn,Tn=n-on.sweepTime;if(0!=Tn){on.sweepTime=n;var An=Tn;if(on.posx+=on.velx*An,on.posy+=on.vely*An,0!=on.angvel){var En=on.sweep_angvel*Tn;if(on.rot+=En,En*En>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var In=En*En,Vn=1-.5*In,Ln=1-In*In/8,Nn=(Vn*on.axisx+En*on.axisy)*Ln;on.axisy=(Vn*on.axisy-En*on.axisx)*Ln,on.axisx=Nn}}}if(gn.type==ye.id_ShapeType_CIRCLE){var Dn=gn.circle;Dn.worldCOMx=Dn.body.posx+(Dn.body.axisy*Dn.localCOMx-Dn.body.axisx*Dn.localCOMy),Dn.worldCOMy=Dn.body.posy+(Dn.localCOMx*Dn.body.axisx+Dn.localCOMy*Dn.body.axisy),Dn.aabb.minx=Dn.worldCOMx-Dn.radius,Dn.aabb.miny=Dn.worldCOMy-Dn.radius,Dn.aabb.maxx=Dn.worldCOMx+Dn.radius,Dn.aabb.maxy=Dn.worldCOMy+Dn.radius}else{var jn=gn.polygon,Fn=jn.lverts.next,Bn=jn.gverts.next,Rn=Fn;Fn=Fn.next,Bn.x=jn.body.posx+(jn.body.axisy*Rn.x-jn.body.axisx*Rn.y),Bn.y=jn.body.posy+(Rn.x*jn.body.axisx+Rn.y*jn.body.axisy),jn.aabb.minx=Bn.x,jn.aabb.miny=Bn.y,jn.aabb.maxx=Bn.x,jn.aabb.maxy=Bn.y;for(var Gn=jn.gverts.next.next;null!=Gn;){var Yn=Gn,Un=Fn;Fn=Fn.next,Yn.x=jn.body.posx+(jn.body.axisy*Un.x-jn.body.axisx*Un.y),Yn.y=jn.body.posy+(Un.x*jn.body.axisx+Un.y*jn.body.axisy),jn.aabb.minx>Yn.x&&(jn.aabb.minx=Yn.x),Yn.x>jn.aabb.maxx&&(jn.aabb.maxx=Yn.x),jn.aabb.miny>Yn.y&&(jn.aabb.miny=Yn.y),Yn.y>jn.aabb.maxy&&(jn.aabb.maxy=Yn.y),Gn=Gn.next}}wn.minx>Cn?wn.minx=Cn:Cn=wn.minx,wn.miny>Mn?wn.miny=Mn:Mn=wn.miny,kn>wn.maxx?wn.maxx=kn:kn=wn.maxx,On>wn.maxy?wn.maxy=On:On=wn.maxy;for(var Zn=1,qn=Sn;qn>Zn;){var Wn=Zn++,Xn=Pn*Wn*mn,Hn=Xn-on.sweepTime;if(0!=Hn){on.sweepTime=Xn;var Kn=Hn;if(on.posx+=on.velx*Kn,on.posy+=on.vely*Kn,0!=on.angvel){var Jn=on.sweep_angvel*Hn;if(on.rot+=Jn,Jn*Jn>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var Qn=Jn*Jn,$n=1-.5*Qn,ne=1-Qn*Qn/8,ee=($n*on.axisx+Jn*on.axisy)*ne;on.axisy=($n*on.axisy-Jn*on.axisx)*ne,on.axisx=ee}}}if(gn.type==ye.id_ShapeType_CIRCLE){var te=gn.circle;te.worldCOMx=te.body.posx+(te.body.axisy*te.localCOMx-te.body.axisx*te.localCOMy),te.worldCOMy=te.body.posy+(te.localCOMx*te.body.axisx+te.localCOMy*te.body.axisy),te.aabb.minx=te.worldCOMx-te.radius,te.aabb.miny=te.worldCOMy-te.radius,te.aabb.maxx=te.worldCOMx+te.radius,te.aabb.maxy=te.worldCOMy+te.radius}else{var ie=gn.polygon,le=ie.lverts.next,re=ie.gverts.next,ae=le;le=le.next,re.x=ie.body.posx+(ie.body.axisy*ae.x-ie.body.axisx*ae.y),re.y=ie.body.posy+(ae.x*ie.body.axisx+ae.y*ie.body.axisy),ie.aabb.minx=re.x,ie.aabb.miny=re.y,ie.aabb.maxx=re.x,ie.aabb.maxy=re.y;for(var pe=ie.gverts.next.next;null!=pe;){var se=pe,oe=le;le=le.next,se.x=ie.body.posx+(ie.body.axisy*oe.x-ie.body.axisx*oe.y),se.y=ie.body.posy+(oe.x*ie.body.axisx+oe.y*ie.body.axisy),ie.aabb.minx>se.x&&(ie.aabb.minx=se.x),se.x>ie.aabb.maxx&&(ie.aabb.maxx=se.x),ie.aabb.miny>se.y&&(ie.aabb.miny=se.y),se.y>ie.aabb.maxy&&(ie.aabb.maxy=se.y),pe=pe.next}}wn.minx>Cn?wn.minx=Cn:Cn=wn.minx,wn.miny>Mn?wn.miny=Mn:Mn=wn.miny,kn>wn.maxx?wn.maxx=kn:kn=wn.maxx,On>wn.maxy?wn.maxy=On:On=wn.maxy}this.bphase.sync(gn),bn=bn.next}if(on.sweepFrozen=!1,on.type==ye.id_BodyType_DYNAMIC&&on.bulletEnabled){var he=f.bulletCCDLinearThreshold*on.sweepRadius,_e=f.bulletCCDAngularThreshold;((on.velx*on.velx+on.vely*on.vely)*n*n>he*he||on.angvel*on.angvel*n*n>_e*_e)&&(on.bullet=!0)}}else on.sweepFrozen=!0,on.bullet=!1}sn=sn.next}},continuous:null,presteparb:function(n,e,t){null==t&&(t=!1);var i=this;if(!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0,!0;if(!n.cleared||0!=n.present||n.intchange){var l=!t&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,r=n.fresh&&!n.cleared&&!n.intchange;if(l&&(n.endGenerated=this.stamp),r||l||n.cleared||n.intchange){for(var a=n.ws1,p=n.ws2,s=this.mrca1;null!=s.head;){var o=s.head;s.head=o.next;var h=o;h.elt=null,h.next=Vi.zpp_pool,Vi.zpp_pool=h,null==s.head&&(s.pushmod=!0),s.modified=!0,s.length--}s.pushmod=!0;for(var _=this.mrca2;null!=_.head;){var u=_.head;_.head=u.next;var d=u;d.elt=null,d.next=Vi.zpp_pool,Vi.zpp_pool=d,null==_.head&&(_.pushmod=!0),_.modified=!0,_.length--}if(_.pushmod=!0,null!=a.cbSet){var c,x=this.mrca1;null==Vi.zpp_pool?c=new Vi:(c=Vi.zpp_pool,Vi.zpp_pool=c.next,c.next=null),c.elt=a;var v=c;v.next=x.head,x.head=v,x.modified=!0,x.length++}if(null!=a.body.cbSet){var z,y=this.mrca1,m=a.body;null==Vi.zpp_pool?z=new Vi:(z=Vi.zpp_pool,Vi.zpp_pool=z.next,z.next=null),z.elt=m;var b=z;b.next=y.head,y.head=b,y.modified=!0,y.length++}if(null!=p.cbSet){var g,w=this.mrca2;null==Vi.zpp_pool?g=new Vi:(g=Vi.zpp_pool,Vi.zpp_pool=g.next,g.next=null),g.elt=p;var C=g;C.next=w.head,w.head=C,w.modified=!0,w.length++}if(null!=p.body.cbSet){var M,k=this.mrca2,O=p.body;null==Vi.zpp_pool?M=new Vi:(M=Vi.zpp_pool,Vi.zpp_pool=M.next,M.next=null),M.elt=O;var S=M;S.next=k.head,k.head=S,k.modified=!0,k.length++}for(var P=a.body.compound,T=p.body.compound;P!=T;){var A=null==P?0:P.depth;if((null==T?0:T.depth)>A){if(null!=T.cbSet){var E,I=this.mrca2;null==Vi.zpp_pool?E=new Vi:(E=Vi.zpp_pool,Vi.zpp_pool=E.next,E.next=null),E.elt=T;var V=E;V.next=I.head,I.head=V,I.modified=!0,I.length++}T=T.compound}else{if(null!=P.cbSet){var L,N=this.mrca1;null==Vi.zpp_pool?L=new Vi:(L=Vi.zpp_pool,Vi.zpp_pool=L.next,L.next=null),L.elt=P;var D=L;D.next=N.head,N.head=D,N.modified=!0,N.length++}P=P.compound}}for(var j=this.mrca1.head;null!=j;){for(var F=j.elt,B=this.mrca2.head;null!=B;){for(var R=B.elt,G=F.cbSet,Y=R.cbSet,U=null,Z=Y.cbpairs.length>G.cbpairs.length?G.cbpairs:Y.cbpairs,q=Z.head;null!=q;){var W=q.elt;if(W.a==G&&W.b==Y||W.a==Y&&W.b==G){U=W;break}q=q.next}if(null==U){var X;null==he.zpp_pool?X=new he:(X=he.zpp_pool,he.zpp_pool=X.next,X.next=null),X.zip_listeners=!0,oe.setlt(G,Y)?(X.a=G,X.b=Y):(X.a=Y,X.b=G),U=X,G.cbpairs.add(U),Y!=G&&Y.cbpairs.add(U)}if(U.zip_listeners&&(U.zip_listeners=!1,U.__validate()),null!=U.listeners.head){var H=Ot.get(F,R);if(r||n.intchange){null==H&&(H=Yt.get(F,R),this.add_callbackset(H));for(var K=ye.id_CbEvent_BEGIN,J=null,Q=Y.cbpairs.length>G.cbpairs.length?G.cbpairs:Y.cbpairs,$=Q.head;null!=$;){var nn=$.elt;if(nn.a==G&&nn.b==Y||nn.a==Y&&nn.b==G){J=nn;break}$=$.next}if(null==J){var en;null==he.zpp_pool?en=new he:(en=he.zpp_pool,he.zpp_pool=en.next,en.next=null),en.zip_listeners=!0,oe.setlt(G,Y)?(en.a=G,en.b=Y):(en.a=Y,en.b=G),J=en,G.cbpairs.add(J),Y!=G&&Y.cbpairs.add(J)}J.zip_listeners&&(J.zip_listeners=!1,J.__validate());for(var tn=J.listeners.head;null!=tn;){var ln=tn.elt;if(ln.event==K&&0!=(ln.itype&n.type)&&H.empty_arb(ln.itype)){var rn=i.push_callback(ln);rn.event=ye.id_CbEvent_BEGIN;var an,pn=H.int1,sn=H.int2,on=ln.options1,hn=pn.cbTypes;if(on.nonemptyintersection(hn,on.includes)&&!on.nonemptyintersection(hn,on.excludes)){var _n=ln.options2,un=sn.cbTypes;an=!!_n.nonemptyintersection(un,_n.includes)&&!_n.nonemptyintersection(un,_n.excludes)}else an=!1;an?(rn.int1=pn,rn.int2=sn):(rn.int1=sn,rn.int2=pn),rn.set=H}tn=tn.next}var dn,cn;cn=!1;for(var xn=H.arbiters.head;null!=xn;){if(xn.elt==n){cn=!0;break}xn=xn.next}if(cn)dn=!1;else{var vn,zn=H.arbiters;null==Ni.zpp_pool?vn=new Ni:(vn=Ni.zpp_pool,Ni.zpp_pool=vn.next,vn.next=null),vn.elt=n;var yn=vn;yn.next=zn.head,zn.head=yn,zn.modified=!0,zn.length++,dn=!0}dn&&n.present++}else{n.present--,H.remove_arb(n);for(var fn=ye.id_CbEvent_END,mn=null,bn=Y.cbpairs.length>G.cbpairs.length?G.cbpairs:Y.cbpairs,gn=bn.head;null!=gn;){var wn=gn.elt;if(wn.a==G&&wn.b==Y||wn.a==Y&&wn.b==G){mn=wn;break}gn=gn.next}if(null==mn){var Cn;null==he.zpp_pool?Cn=new he:(Cn=he.zpp_pool,he.zpp_pool=Cn.next,Cn.next=null),Cn.zip_listeners=!0,oe.setlt(G,Y)?(Cn.a=G,Cn.b=Y):(Cn.a=Y,Cn.b=G),mn=Cn,G.cbpairs.add(mn),Y!=G&&Y.cbpairs.add(mn)}mn.zip_listeners&&(mn.zip_listeners=!1,mn.__validate());for(var Mn=mn.listeners.head;null!=Mn;){var kn=Mn.elt;if(kn.event==fn&&0!=(kn.itype&n.type)&&H.empty_arb(kn.itype)){var On=i.push_callback(kn);On.event=ye.id_CbEvent_END;var Sn,Pn=H.int1,Tn=H.int2,An=kn.options1,En=Pn.cbTypes;if(An.nonemptyintersection(En,An.includes)&&!An.nonemptyintersection(En,An.excludes)){var In=kn.options2,Vn=Tn.cbTypes;Sn=!!In.nonemptyintersection(Vn,In.includes)&&!In.nonemptyintersection(Vn,In.excludes)}else Sn=!1;Sn?(On.int1=Pn,On.int2=Tn):(On.int1=Tn,On.int2=Pn),On.set=H}Mn=Mn.next}null==H.arbiters.head&&this.remove_callbackset(H)}B=B.next}else B=B.next}j=j.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||this.stamp>n.up_stamp+(n.type==Ne.COL?f.arbiterExpirationDelay:0)){if(n.type==Ne.SENSOR){var Ln=n.sensorarb;if(!Ln.cleared){for(var Nn=Ln.b1.arbiters,Dn=null,jn=Nn.head;null!=jn;){if(jn.elt==Ln){var Fn,Bn;null==Dn?(Fn=Nn.head,Bn=Fn.next,null==(Nn.head=Bn)&&(Nn.pushmod=!0)):(Fn=Dn.next,Bn=Fn.next,Dn.next=Bn,null==Bn&&(Nn.pushmod=!0));var Rn=Fn;Rn.elt=null,Rn.next=Ni.zpp_pool,Ni.zpp_pool=Rn,Nn.modified=!0,Nn.length--,Nn.pushmod=!0,!0;break}Dn=jn,jn=jn.next}for(var Gn=Ln.b2.arbiters,Yn=null,Un=Gn.head;null!=Un;){if(Un.elt==Ln){var Zn,qn;null==Yn?(Zn=Gn.head,qn=Zn.next,null==(Gn.head=qn)&&(Gn.pushmod=!0)):(Zn=Yn.next,qn=Zn.next,Yn.next=qn,null==qn&&(Gn.pushmod=!0));var Wn=Zn;Wn.elt=null,Wn.next=Ni.zpp_pool,Ni.zpp_pool=Wn,Gn.modified=!0,Gn.length--,Gn.pushmod=!0,!0;break}Yn=Un,Un=Un.next}null!=Ln.pair&&(Ln.pair.arb=null,Ln.pair=null)}Ln.b1=Ln.b2=null,Ln.active=!1,Ln.intchange=!1;var Xn=Ln;Xn.next=De.zpp_pool,De.zpp_pool=Xn}else if(n.type==Ne.FLUID){var Hn=n.fluidarb;if(!Hn.cleared){for(var Kn=Hn.b1.arbiters,Jn=null,Qn=Kn.head;null!=Qn;){if(Qn.elt==Hn){var $n,ne;null==Jn?($n=Kn.head,ne=$n.next,null==(Kn.head=ne)&&(Kn.pushmod=!0)):($n=Jn.next,ne=$n.next,Jn.next=ne,null==ne&&(Kn.pushmod=!0));var ee=$n;ee.elt=null,ee.next=Ni.zpp_pool,Ni.zpp_pool=ee,Kn.modified=!0,Kn.length--,Kn.pushmod=!0,!0;break}Jn=Qn,Qn=Qn.next}for(var te=Hn.b2.arbiters,ie=null,le=te.head;null!=le;){if(le.elt==Hn){var re,ae;null==ie?(re=te.head,ae=re.next,null==(te.head=ae)&&(te.pushmod=!0)):(re=ie.next,ae=re.next,ie.next=ae,null==ae&&(te.pushmod=!0));var pe=re;pe.elt=null,pe.next=Ni.zpp_pool,Ni.zpp_pool=pe,te.modified=!0,te.length--,te.pushmod=!0,!0;break}ie=le,le=le.next}null!=Hn.pair&&(Hn.pair.arb=null,Hn.pair=null)}Hn.b1=Hn.b2=null,Hn.active=!1,Hn.intchange=!1;var se=Hn;se.next=je.zpp_pool,je.zpp_pool=se,Hn.pre_dt=-1}else{var _e=n.colarb;if(!_e.cleared){for(var ue=_e.b1.arbiters,de=null,ce=ue.head;null!=ce;){if(ce.elt==_e){var xe,ve;null==de?(xe=ue.head,ve=xe.next,null==(ue.head=ve)&&(ue.pushmod=!0)):(xe=de.next,ve=xe.next,de.next=ve,null==ve&&(ue.pushmod=!0));var ze=xe;ze.elt=null,ze.next=Ni.zpp_pool,Ni.zpp_pool=ze,ue.modified=!0,ue.length--,ue.pushmod=!0,!0;break}de=ce,ce=ce.next}for(var fe=_e.b2.arbiters,me=null,be=fe.head;null!=be;){if(be.elt==_e){var ge,we;null==me?(ge=fe.head,we=ge.next,null==(fe.head=we)&&(fe.pushmod=!0)):(ge=me.next,we=ge.next,me.next=we,null==we&&(fe.pushmod=!0));var Ce=ge;Ce.elt=null,Ce.next=Ni.zpp_pool,Ni.zpp_pool=Ce,fe.modified=!0,fe.length--,fe.pushmod=!0,!0;break}me=be,be=be.next}null!=_e.pair&&(_e.pair.arb=null,_e.pair=null)}for(_e.b1=_e.b2=null,_e.active=!1,_e.intchange=!1;null!=_e.contacts.next;){var Me=_e.contacts,ke=Me.next;Me.pop();var Oe=ke;Oe.arbiter=null,Oe.next=Be.zpp_pool,Be.zpp_pool=Oe;var Se=_e.innards,Pe=Se.next;Se.next=Pe.next,Pe._inuse=!1,null==Se.next&&(Se.pushmod=!0),Se.modified=!0,Se.length--}var Te=_e;Te.userdef_dyn_fric=!1,Te.userdef_stat_fric=!1,Te.userdef_restitution=!1,Te.userdef_rfric=!1,Te.__ref_edge1=Te.__ref_edge2=null,Te.next=Fe.zpp_pool,Fe.zpp_pool=Te,_e.pre_dt=-1}return!0}var Ae=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(n.immState&ye.id_ImmState_ACCEPT)){if(n.active&&n.type!=Ne.SENSOR)if(null!=n.colarb){var Ee=n.colarb;Ee.invalidated&&(Ee.invalidated=!1,Ee.userdef_restitution||(Ee.restitution=Ee.s1.material.elasticity>-Infinity&&Ee.s2.material.elasticity>-Infinity?Ee.s1.material.elasticity<Infinity&&Ee.s2.material.elasticity<Infinity?(Ee.s1.material.elasticity+Ee.s2.material.elasticity)/2:1:0,0>Ee.restitution&&(Ee.restitution=0),Ee.restitution>1&&(Ee.restitution=1)),Ee.userdef_dyn_fric||(Ee.dyn_fric=Math.sqrt(Ee.s1.material.dynamicFriction*Ee.s2.material.dynamicFriction)),Ee.userdef_stat_fric||(Ee.stat_fric=Math.sqrt(Ee.s1.material.staticFriction*Ee.s2.material.staticFriction)),Ee.userdef_rfric||(Ee.rfric=Math.sqrt(Ee.s1.material.rollingFriction*Ee.s2.material.rollingFriction))),-1==Ee.pre_dt&&(Ee.pre_dt=e);var Ie=e/Ee.pre_dt;Ee.pre_dt=e;var Ve=Ee.b1.smass+Ee.b2.smass;Ee.hc2=!1;var Le=!0,Re=Ee.b1.type!=ye.id_BodyType_DYNAMIC||Ee.b2.type!=ye.id_BodyType_DYNAMIC,Ge=Re?Ee.continuous?f.contactContinuousStaticBiasCoef:f.contactStaticBiasCoef:Ee.continuous?f.contactContinuousBiasCoef:f.contactBiasCoef;Ee.biasCoef=Ge,Ee.continuous=!1;for(var Ye=null,Ue=null,Ze=Ee.innards.next,qe=Ee.contacts.next;null!=qe;){var We=qe;if(We.stamp+f.arbiterExpirationDelay<Ee.stamp){var Xe,He,Ke=Ee.contacts;null==Ye?(Xe=Ke.next,He=Xe.next,null==(Ke.next=He)&&(Ke.pushmod=!0)):(Xe=Ye.next,He=Xe.next,Ye.next=He,null==He&&(Ke.pushmod=!0)),Xe._inuse=!1,Ke.modified=!0,Ke.length--,Ke.pushmod=!0,qe=He;var Je,Qe,$e=Ee.innards;null==Ue?(Je=$e.next,Qe=Je.next,null==($e.next=Qe)&&($e.pushmod=!0)):(Je=Ue.next,Qe=Je.next,Ue.next=Qe,null==Qe&&($e.pushmod=!0)),Je._inuse=!1,$e.modified=!0,$e.length--,$e.pushmod=!0,Ze=Qe;var nt=We;nt.arbiter=null,nt.next=Be.zpp_pool,Be.zpp_pool=nt}else{var et=We.inner,tt=We.active;if(We.active=We.stamp==Ee.stamp){Le?(Le=!1,Ee.c1=et,Ee.oc1=We):(Ee.hc2=!0,Ee.c2=et,Ee.oc2=We),et.r2x=We.px-Ee.b2.posx,et.r2y=We.py-Ee.b2.posy,et.r1x=We.px-Ee.b1.posx,et.r1y=We.py-Ee.b1.posy;var it=et.r2x*Ee.nx+et.r2y*Ee.ny,lt=Ve+Ee.b2.sinertia*(it*it),rt=et.r1x*Ee.nx+et.r1y*Ee.ny;lt+=Ee.b1.sinertia*(rt*rt),et.tMass=f.epsilon*f.epsilon>lt?0:1/lt;var at=Ee.ny*et.r2x-Ee.nx*et.r2y,pt=Ve+Ee.b2.sinertia*(at*at),st=Ee.ny*et.r1x-Ee.nx*et.r1y;pt+=Ee.b1.sinertia*(st*st),et.nMass=f.epsilon*f.epsilon>pt?0:1/pt;var ot=0,ht=0,_t=Ee.b2.angvel+Ee.b2.kinangvel;ot=Ee.b2.velx+Ee.b2.kinvelx-et.r2y*_t,ht=Ee.b2.vely+Ee.b2.kinvely+et.r2x*_t,_t=Ee.b1.angvel+Ee.b1.kinangvel,ot-=Ee.b1.velx+Ee.b1.kinvelx-et.r1y*_t,ht-=Ee.b1.vely+Ee.b1.kinvely+et.r1x*_t;var ut=Ee.nx*ot+Ee.ny*ht;We.elasticity=Ee.restitution,et.bounce=ut*We.elasticity,et.bounce>-f.elasticThreshold&&(et.bounce=0),ut=ht*Ee.nx-ot*Ee.ny;var dt=f.staticFrictionThreshold;et.friction=ut*ut>dt*dt?Ee.dyn_fric:Ee.stat_fric,et.jnAcc*=Ie,et.jtAcc*=Ie}tt!=We.active&&(Ee.contacts.modified=!0),Ye=qe,Ue=Ze,Ze=Ze.next,qe=qe.next}}if(Ee.hc2){if(Ee.hpc2=!0,Ee.oc1.posOnly){var ct=Ee.c1;Ee.c1=Ee.c2,Ee.c2=ct;var xt=Ee.oc1;Ee.oc1=Ee.oc2,Ee.oc2=xt,Ee.hc2=!1}else Ee.oc2.posOnly&&(Ee.hc2=!1);Ee.oc1.posOnly&&(Le=!0)}else Ee.hpc2=!1;if(Ee.jrAcc*=Ie,Le||(Ee.rn1a=Ee.ny*Ee.c1.r1x-Ee.nx*Ee.c1.r1y,Ee.rt1a=Ee.c1.r1x*Ee.nx+Ee.c1.r1y*Ee.ny,Ee.rn1b=Ee.ny*Ee.c1.r2x-Ee.nx*Ee.c1.r2y,Ee.rt1b=Ee.c1.r2x*Ee.nx+Ee.c1.r2y*Ee.ny,Ee.k1x=Ee.b2.kinvelx-Ee.c1.r2y*Ee.b2.kinangvel-(Ee.b1.kinvelx-Ee.c1.r1y*Ee.b1.kinangvel),Ee.k1y=Ee.b2.kinvely+Ee.c1.r2x*Ee.b2.kinangvel-(Ee.b1.kinvely+Ee.c1.r1x*Ee.b1.kinangvel)),Ee.hc2){Ee.rn2a=Ee.ny*Ee.c2.r1x-Ee.nx*Ee.c2.r1y,Ee.rt2a=Ee.c2.r1x*Ee.nx+Ee.c2.r1y*Ee.ny,Ee.rn2b=Ee.ny*Ee.c2.r2x-Ee.nx*Ee.c2.r2y,Ee.rt2b=Ee.c2.r2x*Ee.nx+Ee.c2.r2y*Ee.ny,Ee.k2x=Ee.b2.kinvelx-Ee.c2.r2y*Ee.b2.kinangvel-(Ee.b1.kinvelx-Ee.c2.r1y*Ee.b1.kinangvel),Ee.k2y=Ee.b2.kinvely+Ee.c2.r2x*Ee.b2.kinangvel-(Ee.b1.kinvely+Ee.c2.r1x*Ee.b1.kinangvel),Ee.kMassa=Ve+Ee.b1.sinertia*Ee.rn1a*Ee.rn1a+Ee.b2.sinertia*Ee.rn1b*Ee.rn1b,Ee.kMassb=Ve+Ee.b1.sinertia*Ee.rn1a*Ee.rn2a+Ee.b2.sinertia*Ee.rn1b*Ee.rn2b,Ee.kMassc=Ve+Ee.b1.sinertia*Ee.rn2a*Ee.rn2a+Ee.b2.sinertia*Ee.rn2b*Ee.rn2b;var vt=Ee.kMassa*Ee.kMassa+2*Ee.kMassb*Ee.kMassb+Ee.kMassc*Ee.kMassc;if(f.illConditionedThreshold*(Ee.kMassa*Ee.kMassc-Ee.kMassb*Ee.kMassb)>vt){Ee.Ka=Ee.kMassa,Ee.Kb=Ee.kMassb,Ee.Kc=Ee.kMassc;var zt=Ee.kMassa*Ee.kMassc-Ee.kMassb*Ee.kMassb;if(zt!=zt)Ee.kMassa=Ee.kMassb=Ee.kMassc=0;else if(0==zt){var yt=0;0!=Ee.kMassa?Ee.kMassa=1/Ee.kMassa:(Ee.kMassa=0,yt|=1),0!=Ee.kMassc?Ee.kMassc=1/Ee.kMassc:(Ee.kMassc=0,yt|=2),Ee.kMassb=0}else{zt=1/zt;var ft=Ee.kMassc*zt;Ee.kMassc=Ee.kMassa*zt,Ee.kMassa=ft,Ee.kMassb*=-zt}}else{if(Ee.hc2=!1,Ee.oc1.dist>Ee.oc2.dist){var mt=Ee.c1;Ee.c1=Ee.c2,Ee.c2=mt}Ee.oc2.active=!1,Ee.contacts.modified=!0}}Ee.surfacex=Ee.b2.svelx,Ee.surfacey=Ee.b2.svely;Ee.surfacex+=1*Ee.b1.svelx,Ee.surfacey+=1*Ee.b1.svely,Ee.surfacex=-Ee.surfacex,Ee.surfacey=-Ee.surfacey,Ee.rMass=Ee.b1.sinertia+Ee.b2.sinertia,0!=Ee.rMass&&(Ee.rMass=1/Ee.rMass),Le&&(n.active=!1)}else{var bt=n.fluidarb;-1==bt.pre_dt&&(bt.pre_dt=e);var gt=e/bt.pre_dt;bt.pre_dt=e,bt.r1x=bt.centroidx-bt.b1.posx,bt.r1y=bt.centroidy-bt.b1.posy,bt.r2x=bt.centroidx-bt.b2.posx,bt.r2y=bt.centroidy-bt.b2.posy;var wt=0,Ct=0;bt.ws1.fluidEnabled&&null!=bt.ws1.fluidProperties.wrap_gravity?(wt=bt.ws1.fluidProperties.gravityx,Ct=bt.ws1.fluidProperties.gravityy):(wt=this.gravityx,Ct=this.gravityy);var Mt=0,kt=0;bt.ws2.fluidEnabled&&null!=bt.ws2.fluidProperties.wrap_gravity?(Mt=bt.ws2.fluidProperties.gravityx,kt=bt.ws2.fluidProperties.gravityy):(Mt=this.gravityx,kt=this.gravityy);var St=0,Pt=0;if(bt.ws1.fluidEnabled&&bt.ws2.fluidEnabled){var Tt=bt.overlap*bt.ws1.fluidProperties.density,At=bt.overlap*bt.ws2.fluidProperties.density;if(Tt>At){var Et=Tt+At;St-=wt*Et,Pt-=Ct*Et}else if(At>Tt){var It=Tt+At;St+=Mt*It,Pt+=kt*It}else{var Vt=0,Lt=0;Vt=wt+Mt,Lt=Ct+kt;if(Vt*=.5,Lt*=.5,bt.ws1.worldCOMx*Vt+bt.ws1.worldCOMy*Lt>bt.ws2.worldCOMx*Vt+bt.ws2.worldCOMy*Lt){var Nt=Tt+At;St-=Vt*Nt,Pt-=Lt*Nt}else{var Dt=Tt+At;St+=Vt*Dt,Pt+=Lt*Dt}}}else if(bt.ws1.fluidEnabled){var jt=bt.overlap*bt.ws1.fluidProperties.density,Ft=jt;St-=wt*Ft,Pt-=Ct*Ft}else if(bt.ws2.fluidEnabled){var Bt=bt.overlap*bt.ws2.fluidProperties.density,Rt=Bt;St+=Mt*Rt,Pt+=kt*Rt}var Gt=e;if(St*=Gt,Pt*=Gt,bt.buoyx=St,bt.buoyy=Pt,bt.b1.type==ye.id_BodyType_DYNAMIC){var Ut=bt.b1.imass;bt.b1.velx-=St*Ut,bt.b1.vely-=Pt*Ut,bt.b1.angvel-=(Pt*bt.r1x-St*bt.r1y)*bt.b1.iinertia}if(bt.b2.type==ye.id_BodyType_DYNAMIC){var Zt=bt.b2.imass;bt.b2.velx+=St*Zt,bt.b2.vely+=Pt*Zt,bt.b2.angvel+=(Pt*bt.r2x-St*bt.r2y)*bt.b2.iinertia}if(bt.ws1.fluidEnabled&&0!=bt.ws1.fluidProperties.viscosity||bt.ws2.fluidEnabled&&0!=bt.ws2.fluidProperties.viscosity){bt.nodrag=!1;var qt=0;if(bt.ws1.fluidEnabled&&(bt.ws2.validate_angDrag(),qt+=bt.ws1.fluidProperties.viscosity*bt.ws2.angDrag*bt.overlap/bt.ws2.area),bt.ws2.fluidEnabled&&(bt.ws1.validate_angDrag(),qt+=bt.ws2.fluidProperties.viscosity*bt.ws1.angDrag*bt.overlap/bt.ws1.area),0!=qt){var Wt=bt.b1.sinertia+bt.b2.sinertia;bt.wMass=0!=Wt?1/Wt:0;qt*=4e-4;var Xt=2*Math.PI*qt;bt.agamma=1/(e*Xt*(2+Xt*e));var Ht=1/(1+bt.agamma);e*Xt*Xt*bt.agamma,bt.agamma*=Ht,bt.wMass*=Ht}else bt.wMass=0,bt.agamma=0;var Kt=bt.b2.velx+bt.b2.kinvelx-bt.r2y*(bt.b2.angvel+bt.b2.kinangvel)-(bt.b1.velx+bt.b1.kinvelx-bt.r1y*(bt.b2.angvel+bt.b2.kinangvel)),Jt=bt.b2.vely+bt.b2.kinvely+bt.r2x*(bt.b2.angvel+bt.b2.kinangvel)-(bt.b1.vely+bt.b1.kinvely+bt.r1x*(bt.b1.angvel+bt.b1.kinangvel));if(f.epsilon*f.epsilon<=Kt*Kt+Jt*Jt){var Qt=Kt*Kt+Jt*Jt,$t=1/Math.sqrt(Qt),ni=$t;Kt*=ni,Jt*=ni,bt.nx=Kt,bt.ny=Jt}var ei=0;if(bt.ws1.fluidEnabled){var ti=-bt.ws1.fluidProperties.viscosity*bt.overlap/bt.ws2.area;if(bt.ws2.type==ye.id_ShapeType_CIRCLE)ei-=ti*bt.ws2.circle.radius*f.fluidLinearDrag/(2*bt.ws2.circle.radius*Math.PI);else{for(var ii=bt.ws2.polygon,li=0,ri=0,ai=ii.edges.head;null!=ai;){var pi=ai.elt;li+=pi.length;var si=ti*pi.length*(pi.gnormx*bt.nx+pi.gnormy*bt.ny);si>0&&(si*=-f.fluidVacuumDrag,si=si),ri-=.5*si*f.fluidLinearDrag,ai=ai.next}ei+=ri/li}}if(bt.ws2.fluidEnabled){var oi=-bt.ws2.fluidProperties.viscosity*bt.overlap/bt.ws1.area;if(bt.ws1.type==ye.id_ShapeType_CIRCLE)ei-=oi*bt.ws1.circle.radius*f.fluidLinearDrag/(2*bt.ws1.circle.radius*Math.PI);else{for(var hi=bt.ws1.polygon,_i=0,ui=0,di=hi.edges.head;null!=di;){var ci=di.elt;_i+=ci.length;var xi=oi*ci.length*(ci.gnormx*bt.nx+ci.gnormy*bt.ny);xi>0&&(xi*=-f.fluidVacuumDrag,xi=xi),ui-=.5*xi*f.fluidLinearDrag,di=di.next}ei+=ui/_i}}if(0!=ei){var vi=bt.b1.smass+bt.b2.smass,zi=0,yi=0,fi=0;if(zi=vi,yi=0,fi=vi,0!=bt.b1.sinertia){var mi=bt.r1x*bt.b1.sinertia,bi=bt.r1y*bt.b1.sinertia;zi+=bi*bt.r1y,yi+=-bi*bt.r1x,fi+=mi*bt.r1x}if(0!=bt.b2.sinertia){var gi=bt.r2x*bt.b2.sinertia,wi=bt.r2y*bt.b2.sinertia;zi+=wi*bt.r2y,yi+=-wi*bt.r2x,fi+=gi*bt.r2x}var Ci=zi*fi-yi*yi;if(Ci!=Ci)fi=0,yi=fi,zi=yi;else if(0==Ci){var Mi=0;0!=zi?zi=1/zi:(zi=0,Mi|=1),0!=fi?fi=1/fi:(fi=0,Mi|=2),yi=0}else{Ci=1/Ci;var ki=fi*Ci;fi=zi*Ci,zi=ki,yi*=-Ci}bt.vMassa=zi,bt.vMassb=yi,bt.vMassc=fi;var Oi=2*Math.PI*ei;bt.lgamma=1/(e*Oi*(2+Oi*e));var Si=1/(1+bt.lgamma);e*Oi*Oi*bt.lgamma,bt.lgamma*=Si;var Pi=Si;bt.vMassa*=Pi,bt.vMassb*=Pi,bt.vMassc*=Pi}else bt.vMassa=0,bt.vMassb=0,bt.vMassc=0,bt.lgamma=0}else bt.nodrag=!0,bt.dampx=0,bt.dampy=0,bt.adamp=0;var Ti=gt;bt.dampx*=Ti,bt.dampy*=Ti,bt.adamp*=gt}}else if(null!=n.colarb){var Ai=n.colarb,Ei=!0,Ii=null,Li=null,Di=Ai.innards.next;Ai.hc2=!1;for(var ji=Ai.contacts.next;null!=ji;){var Fi=ji;if(Fi.stamp+f.arbiterExpirationDelay<Ai.stamp){var Bi,Ri,Gi=Ai.contacts;null==Ii?(Bi=Gi.next,Ri=Bi.next,null==(Gi.next=Ri)&&(Gi.pushmod=!0)):(Bi=Ii.next,Ri=Bi.next,Ii.next=Ri,null==Ri&&(Gi.pushmod=!0)),Bi._inuse=!1,Gi.modified=!0,Gi.length--,Gi.pushmod=!0,ji=Ri;var Yi,Ui,Zi=Ai.innards;null==Li?(Yi=Zi.next,Ui=Yi.next,null==(Zi.next=Ui)&&(Zi.pushmod=!0)):(Yi=Li.next,Ui=Yi.next,Li.next=Ui,null==Ui&&(Zi.pushmod=!0)),Yi._inuse=!1,Zi.modified=!0,Zi.length--,Zi.pushmod=!0,Di=Ui;var qi=Fi;qi.arbiter=null,qi.next=Be.zpp_pool,Be.zpp_pool=qi}else{var Wi=Fi.inner,Xi=Fi.active;Fi.active=Fi.stamp==Ai.stamp,Fi.active&&(Ei?(Ei=!1,Ai.c1=Wi,Ai.oc1=Fi):(Ai.hc2=!0,Ai.c2=Wi,Ai.oc2=Fi)),Xi!=Fi.active&&(Ai.contacts.modified=!0),Ii=ji,Li=Di,Di=Di.next,ji=ji.next}}if(Ai.hc2){if(Ai.hpc2=!0,Ai.oc1.posOnly){var Hi=Ai.c1;Ai.c1=Ai.c2,Ai.c2=Hi;var Ki=Ai.oc1;Ai.oc1=Ai.oc2,Ai.oc2=Ki,Ai.hc2=!1}else Ai.oc2.posOnly&&(Ai.hc2=!1);Ai.oc1.posOnly&&(Ei=!0)}else Ai.hpc2=!1;Ei&&(n.active=!1)}return Ae!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},prestep:function(n){for(var e=null,t=this.live_constraints.head;null!=t;){var i=t.elt;i.preStep(n)?(t=this.live_constraints.erase(e),i.broken(),this.constraintCbBreak(i),i.removeOnBreak?(i.component.sleeping=!0,this.midstep=!1,null!=i.compound?i.compound.wrap_constraints.remove(i.outer):this.wrap_constraints.remove(i.outer),this.midstep=!0):i.active=!1,i.clearcache()):(e=t,t=t.next)}var l=null,r=this.c_arbiters_true,a=r.head,p=null!=this.c_arbiters_false;for(p&&null==a&&(p=!1,a=this.c_arbiters_false.head,r=this.c_arbiters_false,l=null);null!=a;){if(this.presteparb(a.elt,n)){var s,o;null==l?(s=r.head,o=s.next,null==(r.head=o)&&(r.pushmod=!0)):(s=l.next,o=s.next,l.next=o,null==o&&(r.pushmod=!0));var h=s;h.elt=null,h.next=el.zpp_pool,el.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0,a=o,p&&null==a&&(p=!1,a=this.c_arbiters_false.head,r=this.c_arbiters_false,l=null)}else l=a,a=a.next,p&&null==a&&(p=!1,a=this.c_arbiters_false.head,r=this.c_arbiters_false,l=null)}var _=null,u=this.f_arbiters,d=u.head,c=!1;for(c&&null==d&&(c=!1,u=null,_=null);null!=d;){if(this.presteparb(d.elt,n)){var x,v;null==_?(x=u.head,v=x.next,null==(u.head=v)&&(u.pushmod=!0)):(x=_.next,v=x.next,_.next=v,null==v&&(u.pushmod=!0));var z=x;z.elt=null,z.next=$i.zpp_pool,$i.zpp_pool=z,u.modified=!0,u.length--,u.pushmod=!0,d=v,c&&null==d&&(c=!1,u=null,_=null)}else _=d,d=d.next,c&&null==d&&(c=!1,u=null,_=null)}var y=null,f=this.s_arbiters,m=f.head,b=!1;for(b&&null==m&&(b=!1,f=null,y=null);null!=m;){if(this.presteparb(m.elt,n)){var g,w;null==y?(g=f.head,w=g.next,null==(f.head=w)&&(f.pushmod=!0)):(g=y.next,w=g.next,y.next=w,null==w&&(f.pushmod=!0));var C=g;C.elt=null,C.next=nl.zpp_pool,nl.zpp_pool=C,f.modified=!0,f.length--,f.pushmod=!0,m=w,b&&null==m&&(b=!1,f=null,y=null)}else y=m,m=m.next,b&&null==m&&(b=!1,f=null,y=null)}},warmStart:function(){for(var n=this.f_arbiters.head;null!=n;){var e=n.elt;if(e.active&&0!=(e.immState&ye.id_ImmState_ACCEPT)){var t=e.b1.imass;e.b1.velx-=e.dampx*t,e.b1.vely-=e.dampy*t;var i=e.b2.imass;e.b2.velx+=e.dampx*i,e.b2.vely+=e.dampy*i,e.b1.angvel-=e.b1.iinertia*(e.dampy*e.r1x-e.dampx*e.r1y),e.b2.angvel+=e.b2.iinertia*(e.dampy*e.r2x-e.dampx*e.r2y),e.b1.angvel-=e.adamp*e.b1.iinertia,e.b2.angvel+=e.adamp*e.b2.iinertia}n=n.next}var l=this.c_arbiters_false.head,r=!0;for(null==l&&(l=this.c_arbiters_true.head,r=!1);null!=l;){var a=l.elt;if(a.active&&0!=(a.immState&ye.id_ImmState_ACCEPT)){var p=a.nx*a.c1.jnAcc-a.ny*a.c1.jtAcc,s=a.ny*a.c1.jnAcc+a.nx*a.c1.jtAcc,o=a.b1.imass;a.b1.velx-=p*o,a.b1.vely-=s*o,a.b1.angvel-=a.b1.iinertia*(s*a.c1.r1x-p*a.c1.r1y);var h=a.b2.imass;if(a.b2.velx+=p*h,a.b2.vely+=s*h,a.b2.angvel+=a.b2.iinertia*(s*a.c1.r2x-p*a.c1.r2y),a.hc2){var _=a.nx*a.c2.jnAcc-a.ny*a.c2.jtAcc,u=a.ny*a.c2.jnAcc+a.nx*a.c2.jtAcc,d=a.b1.imass;a.b1.velx-=_*d,a.b1.vely-=u*d,a.b1.angvel-=a.b1.iinertia*(u*a.c2.r1x-_*a.c2.r1y);var c=a.b2.imass;a.b2.velx+=_*c,a.b2.vely+=u*c,a.b2.angvel+=a.b2.iinertia*(u*a.c2.r2x-_*a.c2.r2y)}a.b2.angvel+=a.jrAcc*a.b2.iinertia,a.b1.angvel-=a.jrAcc*a.b1.iinertia}l=l.next,r&&null==l&&(l=this.c_arbiters_true.head,r=!1)}for(var x=this.live_constraints.head;null!=x;){x.elt.warmStart(),x=x.next}},iterateVel:function(n){for(var e=0,t=n;t>e;){for(var i=(e++,this.f_arbiters.head);null!=i;){var l=i.elt;if(l.active&&0!=(l.immState&ye.id_ImmState_ACCEPT)&&!l.nodrag){var r=l.b1.angvel+l.b1.kinangvel,a=l.b2.angvel+l.b2.kinangvel,p=l.b1.velx+l.b1.kinvelx-l.r1y*r-(l.b2.velx+l.b2.kinvelx-l.r2y*a),s=l.b1.vely+l.b1.kinvely+l.r1x*r-(l.b2.vely+l.b2.kinvely+l.r2x*a),o=l.vMassa*p+l.vMassb*s;s=l.vMassb*p+l.vMassc*s,p=o;var h=l.lgamma;p-=l.dampx*h,s-=l.dampy*h;l.dampx+=1*p,l.dampy+=1*s;var _=l.b1.imass;l.b1.velx-=p*_,l.b1.vely-=s*_;var u=l.b2.imass;l.b2.velx+=p*u,l.b2.vely+=s*u,l.b1.angvel-=l.b1.iinertia*(s*l.r1x-p*l.r1y),l.b2.angvel+=l.b2.iinertia*(s*l.r2x-p*l.r2y);var d=(r-a)*l.wMass-l.adamp*l.agamma;l.adamp+=d,l.b1.angvel-=d*l.b1.iinertia,l.b2.angvel+=d*l.b2.iinertia}i=i.next}for(var c=null,x=this.live_constraints.head;null!=x;){var v=x.elt;v.applyImpulseVel()?(x=this.live_constraints.erase(c),v.broken(),this.constraintCbBreak(v),v.removeOnBreak?(v.component.sleeping=!0,this.midstep=!1,null!=v.compound?v.compound.wrap_constraints.remove(v.outer):this.wrap_constraints.remove(v.outer),this.midstep=!0):v.active=!1,v.clearcache()):(c=x,x=x.next)}var z=this.c_arbiters_false.head,y=!0;for(null==z&&(z=this.c_arbiters_true.head,y=!1);null!=z;){var f=z.elt;if(f.active&&0!=(f.immState&ye.id_ImmState_ACCEPT)){var m,b,g,w,C,M,k=f.k1x+f.b2.velx-f.c1.r2y*f.b2.angvel-(f.b1.velx-f.c1.r1y*f.b1.angvel),O=f.k1y+f.b2.vely+f.c1.r2x*f.b2.angvel-(f.b1.vely+f.c1.r1x*f.b1.angvel);if(g=(O*f.nx-k*f.ny+f.surfacex)*f.c1.tMass,w=f.c1.friction*f.c1.jnAcc,C=f.c1.jtAcc,M=C-g,M>w?M=w:-w>M&&(M=-w),g=M-C,f.c1.jtAcc=M,m=-f.ny*g,b=f.nx*g,f.b2.velx+=m*f.b2.imass,f.b2.vely+=b*f.b2.imass,f.b1.velx-=m*f.b1.imass,f.b1.vely-=b*f.b1.imass,f.b2.angvel+=f.rt1b*g*f.b2.iinertia,f.b1.angvel-=f.rt1a*g*f.b1.iinertia,f.hc2){var S=f.k2x+f.b2.velx-f.c2.r2y*f.b2.angvel-(f.b1.velx-f.c2.r1y*f.b1.angvel),P=f.k2y+f.b2.vely+f.c2.r2x*f.b2.angvel-(f.b1.vely+f.c2.r1x*f.b1.angvel);g=(P*f.nx-S*f.ny+f.surfacex)*f.c2.tMass,w=f.c2.friction*f.c2.jnAcc,C=f.c2.jtAcc,M=C-g,M>w?M=w:-w>M&&(M=-w),g=M-C,f.c2.jtAcc=M,m=-f.ny*g,b=f.nx*g,f.b2.velx+=m*f.b2.imass,f.b2.vely+=b*f.b2.imass,f.b1.velx-=m*f.b1.imass,f.b1.vely-=b*f.b1.imass,f.b2.angvel+=f.rt2b*g*f.b2.iinertia,f.b1.angvel-=f.rt2a*g*f.b1.iinertia,k=f.k1x+f.b2.velx-f.c1.r2y*f.b2.angvel-(f.b1.velx-f.c1.r1y*f.b1.angvel),O=f.k1y+f.b2.vely+f.c1.r2x*f.b2.angvel-(f.b1.vely+f.c1.r1x*f.b1.angvel),S=f.k2x+f.b2.velx-f.c2.r2y*f.b2.angvel-(f.b1.velx-f.c2.r1y*f.b1.angvel),P=f.k2y+f.b2.vely+f.c2.r2x*f.b2.angvel-(f.b1.vely+f.c2.r1x*f.b1.angvel);var T=f.c1.jnAcc,A=f.c2.jnAcc,E=k*f.nx+O*f.ny+f.surfacey+f.c1.bounce-(f.Ka*T+f.Kb*A),I=S*f.nx+P*f.ny+f.surfacey+f.c2.bounce-(f.Kb*T+f.Kc*A),V=-(f.kMassa*E+f.kMassb*I),L=-(f.kMassb*E+f.kMassc*I);0>V||0>L?(V=-f.c1.nMass*E,0>V||0>f.Kb*V+I?(L=-f.c2.nMass*I,0>L||0>f.Kb*L+E?0>E||0>I?(E=0,I=0):(E=-T,I=-A,f.c1.jnAcc=f.c2.jnAcc=0):(E=-T,I=L-A,f.c1.jnAcc=0,f.c2.jnAcc=L)):(E=V-T,I=-A,f.c1.jnAcc=V,f.c2.jnAcc=0)):(E=V-T,I=L-A,f.c1.jnAcc=V,f.c2.jnAcc=L),g=E+I,m=f.nx*g,b=f.ny*g,f.b2.velx+=m*f.b2.imass,f.b2.vely+=b*f.b2.imass,f.b1.velx-=m*f.b1.imass,f.b1.vely-=b*f.b1.imass,f.b2.angvel+=(f.rn1b*E+f.rn2b*I)*f.b2.iinertia,f.b1.angvel-=(f.rn1a*E+f.rn2a*I)*f.b1.iinertia}else{if(0!=f.radius){g=(f.b2.angvel-f.b1.angvel)*f.rMass,w=f.rfric*f.c1.jnAcc,C=f.jrAcc,f.jrAcc-=g,f.jrAcc>w?f.jrAcc=w:-w>f.jrAcc&&(f.jrAcc=-w),g=f.jrAcc-C,f.b2.angvel+=g*f.b2.iinertia,f.b1.angvel-=g*f.b1.iinertia}k=f.k1x+f.b2.velx-f.c1.r2y*f.b2.angvel-(f.b1.velx-f.c1.r1y*f.b1.angvel),O=f.k1y+f.b2.vely+f.c1.r2x*f.b2.angvel-(f.b1.vely+f.c1.r1x*f.b1.angvel),g=(f.c1.bounce+(f.nx*k+f.ny*O)+f.surfacey)*f.c1.nMass,C=f.c1.jnAcc,M=C-g,0>M&&(M=0),g=M-C,f.c1.jnAcc=M,m=f.nx*g,b=f.ny*g,f.b2.velx+=m*f.b2.imass,f.b2.vely+=b*f.b2.imass,f.b1.velx-=m*f.b1.imass,f.b1.vely-=b*f.b1.imass,f.b2.angvel+=f.rn1b*g*f.b2.iinertia,f.b1.angvel-=f.rn1a*g*f.b1.iinertia}}z=z.next,y&&null==z&&(z=this.c_arbiters_true.head,y=!1)}}},iteratePos:function(n){for(var e=0,t=n;t>e;){for(var i=(e++,null),l=this.live_constraints.head;null!=l;){var r=l.elt;!r.__velocity&&r.stiff&&r.applyImpulsePos()?(l=this.live_constraints.erase(i),r.broken(),this.constraintCbBreak(r),r.removeOnBreak?(r.component.sleeping=!0,this.midstep=!1,null!=r.compound?r.compound.wrap_constraints.remove(r.outer):this.wrap_constraints.remove(r.outer),this.midstep=!0):r.active=!1,r.clearcache()):(i=l,l=l.next)}var a=this.c_arbiters_false.head,p=!0;for(null==a&&(a=this.c_arbiters_true.head,p=!1);null!=a;){var s=a.elt;if(s.active&&0!=(s.immState&ye.id_ImmState_ACCEPT))if(2==s.ptype){var o=s.c1,h=0,_=0;h=s.b2.axisy*o.lr2x-s.b2.axisx*o.lr2y,_=o.lr2x*s.b2.axisx+o.lr2y*s.b2.axisy;h+=1*s.b2.posx,_+=1*s.b2.posy;var u=0,d=0;u=s.b1.axisy*o.lr1x-s.b1.axisx*o.lr1y,d=o.lr1x*s.b1.axisx+o.lr1y*s.b1.axisy;u+=1*s.b1.posx,d+=1*s.b1.posy;var c=0,x=0;c=h-u,x=_-d;var v=Math.sqrt(c*c+x*x),z=s.radius-f.collisionSlop,y=v-z;if(0>c*s.nx+x*s.ny&&(c=-c,x=-x,y-=s.radius),0>y)if(f.epsilon>v)0!=s.b1.smass?s.b1.posx+=10*f.epsilon:s.b2.posx+=10*f.epsilon;else{var m=1/v;c*=m,x*=m;var b=.5*(u+h),g=.5*(d+_),w=v-z;u=b-s.b1.posx,d=g-s.b1.posy,h=b-s.b2.posx,_=g-s.b2.posy;var C=x*u-c*d,M=x*h-c*_,k=s.b2.smass+M*M*s.b2.sinertia+s.b1.smass+C*C*s.b1.sinertia;if(0!=k){var O=-s.biasCoef*w/k,S=0,P=0,T=O;S=c*T,P=x*T;var A=s.b1.imass;s.b1.posx-=S*A,s.b1.posy-=P*A;var E=s.b1,I=-C*s.b1.iinertia*O;if(E.rot+=I,I*I>1e-4)E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot);else{var V=I*I,L=1-.5*V,N=1-V*V/8,D=(L*E.axisx+I*E.axisy)*N;E.axisy=(L*E.axisy-I*E.axisx)*N,E.axisx=D}var j=s.b2.imass;s.b2.posx+=S*j,s.b2.posy+=P*j;var F=s.b2,B=M*s.b2.iinertia*O;if(F.rot+=B,B*B>1e-4)F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot);else{var R=B*B,G=1-.5*R,Y=1-R*R/8,U=(G*F.axisx+B*F.axisy)*Y;F.axisy=(G*F.axisy-B*F.axisx)*Y,F.axisx=U}}}}else{var Z,q=0,W=0,X=0,H=0,K=0,J=0;if(0==s.ptype){q=s.b1.axisy*s.lnormx-s.b1.axisx*s.lnormy,W=s.lnormx*s.b1.axisx+s.lnormy*s.b1.axisy,Z=s.lproj+(q*s.b1.posx+W*s.b1.posy),X=s.b2.axisy*s.c1.lr1x-s.b2.axisx*s.c1.lr1y,H=s.c1.lr1x*s.b2.axisx+s.c1.lr1y*s.b2.axisy;if(X+=1*s.b2.posx,H+=1*s.b2.posy,s.hpc2){K=s.b2.axisy*s.c2.lr1x-s.b2.axisx*s.c2.lr1y,J=s.c2.lr1x*s.b2.axisx+s.c2.lr1y*s.b2.axisy;K+=1*s.b2.posx,J+=1*s.b2.posy}}else{q=s.b2.axisy*s.lnormx-s.b2.axisx*s.lnormy,W=s.lnormx*s.b2.axisx+s.lnormy*s.b2.axisy,Z=s.lproj+(q*s.b2.posx+W*s.b2.posy),X=s.b1.axisy*s.c1.lr1x-s.b1.axisx*s.c1.lr1y,H=s.c1.lr1x*s.b1.axisx+s.c1.lr1y*s.b1.axisy;if(X+=1*s.b1.posx,H+=1*s.b1.posy,s.hpc2){K=s.b1.axisy*s.c2.lr1x-s.b1.axisx*s.c2.lr1y,J=s.c2.lr1x*s.b1.axisx+s.c2.lr1y*s.b1.axisy;K+=1*s.b1.posx,J+=1*s.b1.posy}}var Q=X*q+H*W-Z-s.radius;Q+=f.collisionSlop;var $=0;if(s.hpc2&&($=K*q+J*W-Z-s.radius,$+=f.collisionSlop),0>Q||0>$){s.rev&&(q=-q,W=-W);var nn=0,en=0;nn=X-s.b1.posx,en=H-s.b1.posy;var tn=0,ln=0;tn=X-s.b2.posx,ln=H-s.b2.posy;var rn=0,an=0,pn=0,sn=0;if(s.hpc2){rn=K-s.b1.posx,an=J-s.b1.posy,pn=K-s.b2.posx,sn=J-s.b2.posy;var on=W*nn-q*en,hn=W*tn-q*ln,_n=W*rn-q*an,un=W*pn-q*sn,dn=s.b1.smass+s.b2.smass;s.kMassa=dn+s.b1.sinertia*on*on+s.b2.sinertia*hn*hn,s.kMassb=dn+s.b1.sinertia*on*_n+s.b2.sinertia*hn*un,s.kMassc=dn+s.b1.sinertia*_n*_n+s.b2.sinertia*un*un;var cn=0,xn=0,vn=0;cn=s.kMassa,xn=s.kMassb,vn=s.kMassc;for(var zn=Q*s.biasCoef,yn=$*s.biasCoef;;){var fn=0,mn=0;fn=zn,mn=yn,fn=-fn,mn=-mn;var bn=s.kMassa*s.kMassc-s.kMassb*s.kMassb;if(bn!=bn)mn=0,fn=mn;else if(0==bn)0!=s.kMassa?fn/=s.kMassa:fn=0,0!=s.kMassc?mn/=s.kMassc:mn=0;else{bn=1/bn;var gn=bn*(s.kMassc*fn-s.kMassb*mn);mn=bn*(s.kMassa*mn-s.kMassb*fn),fn=gn}if(fn>=0&&mn>=0){var wn=(fn+mn)*s.b1.imass;s.b1.posx-=q*wn,s.b1.posy-=W*wn;var Cn=s.b1,Mn=-s.b1.iinertia*(on*fn+_n*mn);if(Cn.rot+=Mn,Mn*Mn>1e-4)Cn.axisx=Math.sin(Cn.rot),Cn.axisy=Math.cos(Cn.rot);else{var kn=Mn*Mn,On=1-.5*kn,Sn=1-kn*kn/8,Pn=(On*Cn.axisx+Mn*Cn.axisy)*Sn;Cn.axisy=(On*Cn.axisy-Mn*Cn.axisx)*Sn,Cn.axisx=Pn}var Tn=(fn+mn)*s.b2.imass;s.b2.posx+=q*Tn,s.b2.posy+=W*Tn;var An=s.b2,En=s.b2.iinertia*(hn*fn+un*mn);if(An.rot+=En,En*En>1e-4)An.axisx=Math.sin(An.rot),An.axisy=Math.cos(An.rot);else{var In=En*En,Vn=1-.5*In,Ln=1-In*In/8,Nn=(Vn*An.axisx+En*An.axisy)*Ln;An.axisy=(Vn*An.axisy-En*An.axisx)*Ln,An.axisx=Nn}break}fn=-zn/cn,mn=0;var Dn=xn*fn+yn;if(fn>=0&&Dn>=0){var jn=(fn+mn)*s.b1.imass;s.b1.posx-=q*jn,s.b1.posy-=W*jn;var Fn=s.b1,Bn=-s.b1.iinertia*(on*fn+_n*mn);if(Fn.rot+=Bn,Bn*Bn>1e-4)Fn.axisx=Math.sin(Fn.rot),Fn.axisy=Math.cos(Fn.rot);else{var Rn=Bn*Bn,Gn=1-.5*Rn,Yn=1-Rn*Rn/8,Un=(Gn*Fn.axisx+Bn*Fn.axisy)*Yn;Fn.axisy=(Gn*Fn.axisy-Bn*Fn.axisx)*Yn,Fn.axisx=Un}var Zn=(fn+mn)*s.b2.imass;s.b2.posx+=q*Zn,s.b2.posy+=W*Zn;var qn=s.b2,Wn=s.b2.iinertia*(hn*fn+un*mn);if(qn.rot+=Wn,Wn*Wn>1e-4)qn.axisx=Math.sin(qn.rot),qn.axisy=Math.cos(qn.rot);else{var Xn=Wn*Wn,Hn=1-.5*Xn,Kn=1-Xn*Xn/8,Jn=(Hn*qn.axisx+Wn*qn.axisy)*Kn;qn.axisy=(Hn*qn.axisy-Wn*qn.axisx)*Kn,qn.axisx=Jn}break}fn=0,mn=-yn/vn;var Qn=xn*mn+zn;if(mn>=0&&Qn>=0){var $n=(fn+mn)*s.b1.imass;s.b1.posx-=q*$n,s.b1.posy-=W*$n;var ne=s.b1,ee=-s.b1.iinertia*(on*fn+_n*mn);if(ne.rot+=ee,ee*ee>1e-4)ne.axisx=Math.sin(ne.rot),ne.axisy=Math.cos(ne.rot);else{var te=ee*ee,ie=1-.5*te,le=1-te*te/8,re=(ie*ne.axisx+ee*ne.axisy)*le;ne.axisy=(ie*ne.axisy-ee*ne.axisx)*le,ne.axisx=re}var ae=(fn+mn)*s.b2.imass;s.b2.posx+=q*ae,s.b2.posy+=W*ae;var pe=s.b2,se=s.b2.iinertia*(hn*fn+un*mn);if(pe.rot+=se,se*se>1e-4)pe.axisx=Math.sin(pe.rot),pe.axisy=Math.cos(pe.rot);else{var oe=se*se,he=1-.5*oe,_e=1-oe*oe/8,ue=(he*pe.axisx+se*pe.axisy)*_e;pe.axisy=(he*pe.axisy-se*pe.axisx)*_e,pe.axisx=ue}break}break}}else{var de=W*nn-q*en,ce=W*tn-q*ln,xe=s.b2.smass+ce*ce*s.b2.sinertia+s.b1.smass+de*de*s.b1.sinertia;if(0!=xe){var ve=-s.biasCoef*Q/xe,ze=0,fe=0,me=ve;ze=q*me,fe=W*me;var be=s.b1.imass;s.b1.posx-=ze*be,s.b1.posy-=fe*be;var ge=s.b1,we=-de*s.b1.iinertia*ve;if(ge.rot+=we,we*we>1e-4)ge.axisx=Math.sin(ge.rot),ge.axisy=Math.cos(ge.rot);else{var Ce=we*we,Me=1-.5*Ce,ke=1-Ce*Ce/8,Oe=(Me*ge.axisx+we*ge.axisy)*ke;ge.axisy=(Me*ge.axisy-we*ge.axisx)*ke,ge.axisx=Oe}var Se=s.b2.imass;s.b2.posx+=ze*Se,s.b2.posy+=fe*Se;var Pe=s.b2,Te=ce*s.b2.iinertia*ve;if(Pe.rot+=Te,Te*Te>1e-4)Pe.axisx=Math.sin(Pe.rot),Pe.axisy=Math.cos(Pe.rot);else{var Ae=Te*Te,Ee=1-.5*Ae,Ie=1-Ae*Ae/8,Ve=(Ee*Pe.axisx+Te*Pe.axisy)*Ie;Pe.axisy=(Ee*Pe.axisy-Te*Pe.axisx)*Ie,Pe.axisx=Ve}}}}}a=a.next,p&&null==a&&(a=this.c_arbiters_true.head,p=!1)}}},group_ignore:function(n,e){for(var t=n;null!=t&&null==t.group;)t=null!=t.ishape?t.ishape.body:null!=t.icompound?t.icompound.compound:t.ibody.compound;var i=null==t?null:t.group;if(null==i)return!1;for(var l=e;null!=l&&null==l.group;)l=null!=l.ishape?l.ishape.body:null!=l.icompound?l.icompound.compound:l.ibody.compound;var r=null==l?null:l.group;if(null==r)return!1;for(var a=!1;null!=i&&null!=r;){if(i==r){a=i.ignore;break}r.depth>i.depth?r=r.group:i=i.group}return a},interactionType:function(n,e,t,i){var l;l=!1;for(var r=t.constraints.head;null!=r;){var a=r.elt;if(a.ignore&&a.pair_exists(t.id,i.id)){l=!0;break}r=r.next}var p;if(l)p=!1;else{for(var s=n;null!=s&&null==s.group;)s=null!=s.ishape?s.ishape.body:null!=s.icompound?s.icompound.compound:s.ibody.compound;var o,h=null==s?null:s.group;if(null==h)o=!1;else{for(var _=e;null!=_&&null==_.group;)_=null!=_.ishape?_.ishape.body:null!=_.icompound?_.icompound.compound:_.ibody.compound;var u=null==_?null:_.group;if(null==u)o=!1;else{for(var d=!1;null!=h&&null!=u;){if(h==u){d=h.ignore;break}u.depth>h.depth?u=u.group:h=h.group}o=d}}p=!o}if(p){var c;if(n.sensorEnabled||e.sensorEnabled){var x=n.filter,v=e.filter;c=0!=(x.sensorMask&v.sensorGroup)&&0!=(v.sensorMask&x.sensorGroup)}else c=!1;if(c)return 2;var z;if(n.fluidEnabled||e.fluidEnabled){var y=n.filter,f=e.filter;z=0!=(y.fluidMask&f.fluidGroup)&&0!=(f.fluidMask&y.fluidGroup)}else z=!1;if(!!z&&!(0==t.imass&&0==i.imass&&0==t.iinertia&&0==i.iinertia))return 0;var m,b=n.filter,g=e.filter;return m=0!=(b.collisionMask&g.collisionGroup)&&0!=(g.collisionMask&b.collisionGroup)&&!(0==t.imass&&0==i.imass&&0==t.iinertia&&0==i.iinertia),m?1:-1}return-1},precb:null,prelisteners:null,narrowPhase:function(n,e,t,i,l){var r,a=this,p=null,s=n.body,o=e.body;r=!1;for(var h=s.constraints.head;null!=h;){var _=h.elt;if(_.ignore&&_.pair_exists(s.id,o.id)){r=!0;break}h=h.next}var u,d;if(r)d=!1;else{for(var c=n;null!=c&&null==c.group;)c=null!=c.ishape?c.ishape.body:null!=c.icompound?c.icompound.compound:c.ibody.compound;var x,v=null==c?null:c.group;if(null==v)x=!1;else{for(var z=e;null!=z&&null==z.group;)z=null!=z.ishape?z.ishape.body:null!=z.icompound?z.icompound.compound:z.ibody.compound;var y=null==z?null:z.group;if(null==y)x=!1;else{for(var m=!1;null!=v&&null!=y;){if(v==y){m=v.ignore;break}y.depth>v.depth?y=y.group:v=v.group}x=m}}d=!x}if(d){var b;if(n.sensorEnabled||e.sensorEnabled){var g=n.filter,w=e.filter;b=0!=(g.sensorMask&w.sensorGroup)&&0!=(w.sensorMask&g.sensorGroup)}else b=!1;if(b)u=2;else{var C;if(n.fluidEnabled||e.fluidEnabled){var M=n.filter,k=e.filter;C=0!=(M.fluidMask&k.fluidGroup)&&0!=(k.fluidMask&M.fluidGroup)}else C=!1;if(!!C&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia))u=0;else{var O,S=n.filter,P=e.filter;O=0!=(S.collisionMask&P.collisionGroup)&&0!=(P.collisionMask&S.collisionGroup)&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia),u=O?1:-1}}}else u=-1;if(-1!=u){var T,A;n.type>e.type?(T=e,A=n):n.type==e.type?e.id>n.id?(T=n,A=e):(A=n,T=e):(T=n,A=e);var E=T==e;if(0==u){var I;if(null==i){for(var V=null,L=o.arbiters.length>s.arbiters.length?s:o,N=L.arbiters.head;null!=N;){var D=N.elt;if(D.id==T.id&&D.di==A.id){V=D;break}N=N.next}I=V}else I=i;var F,B=null==I,R=!1;if(B)null==je.zpp_pool?F=new je:(F=je.zpp_pool,je.zpp_pool=F.next,F.next=null);else if(null==I.fluidarb){I.cleared=!0;for(var G=I.b1.arbiters,Y=null,U=G.head;null!=U;){if(U.elt==I){var Z,q;null==Y?(Z=G.head,q=Z.next,null==(G.head=q)&&(G.pushmod=!0)):(Z=Y.next,q=Z.next,Y.next=q,null==q&&(G.pushmod=!0));var W=Z;W.elt=null,W.next=Ni.zpp_pool,Ni.zpp_pool=W,G.modified=!0,G.length--,G.pushmod=!0,!0;break}Y=U,U=U.next}for(var X=I.b2.arbiters,H=null,K=X.head;null!=K;){if(K.elt==I){var J,Q;null==H?(J=X.head,Q=J.next,null==(X.head=Q)&&(X.pushmod=!0)):(J=H.next,Q=J.next,H.next=Q,null==Q&&(X.pushmod=!0));var $=J;$.elt=null,$.next=Ni.zpp_pool,Ni.zpp_pool=$,X.modified=!0,X.length--,X.pushmod=!0,!0;break}H=K,K=K.next}null!=I.pair&&(I.pair.arb=null,I.pair=null),I.active=!1,this.f_arbiters.modified=!0,null==je.zpp_pool?F=new je:(F=je.zpp_pool,je.zpp_pool=F.next,F.next=null),F.intchange=!0,B=!0,R=!0}else F=I.fluidarb;var nn=ye.id_InteractionType_FLUID;if(B||F.stamp!=this.stamp||l)if(F.stamp=this.stamp,We.flowCollide(T,A,F)){if(B){var en=A.id;F.b1=n.body,F.ws1=n,F.b2=e.body,F.ws2=e,F.id=T.id,F.di=en;var tn,ln=F.b1.arbiters;null==Ni.zpp_pool?tn=new Ni:(tn=Ni.zpp_pool,Ni.zpp_pool=tn.next,tn.next=null),tn.elt=F;var rn=tn;rn.next=ln.head,ln.head=rn,ln.modified=!0,ln.length++;var an,pn=F.b2.arbiters;null==Ni.zpp_pool?an=new Ni:(an=Ni.zpp_pool,Ni.zpp_pool=an.next,an.next=null),an.elt=F;var sn=an;sn.next=pn.head,pn.head=sn,pn.modified=!0,pn.length++,F.active=!0,F.present=0,F.cleared=!1,F.sleeping=!1,F.fresh=!1,F.presentable=!1,F.nx=0,F.ny=1,F.dampx=0,F.dampy=0,F.adamp=0;var on,hn=this.f_arbiters;null==$i.zpp_pool?on=new $i:(on=$i.zpp_pool,$i.zpp_pool=on.next,on.next=null),on.elt=F;var _n=on;_n.next=hn.head,hn.head=_n,hn.modified=!0,hn.length++,F.fresh=!R}else F.fresh=this.stamp-1>F.up_stamp||F.endGenerated==this.stamp&&l;if(F.up_stamp=F.stamp,F.fresh||0==(F.immState&ye.id_ImmState_ALWAYS)){F.immState=ye.id_ImmState_ACCEPT;for(var un=!1,dn=F.ws1.id>F.ws2.id?F.ws2:F.ws1,cn=F.ws1.id>F.ws2.id?F.ws1:F.ws2,xn=this.mrca1;null!=xn.head;){var vn=xn.head;xn.head=vn.next;var zn=vn;zn.elt=null,zn.next=Vi.zpp_pool,Vi.zpp_pool=zn,null==xn.head&&(xn.pushmod=!0),xn.modified=!0,xn.length--}xn.pushmod=!0;for(var yn=this.mrca2;null!=yn.head;){var fn=yn.head;yn.head=fn.next;var mn=fn;mn.elt=null,mn.next=Vi.zpp_pool,Vi.zpp_pool=mn,null==yn.head&&(yn.pushmod=!0),yn.modified=!0,yn.length--}if(yn.pushmod=!0,null!=dn.cbSet){var bn,gn=this.mrca1;null==Vi.zpp_pool?bn=new Vi:(bn=Vi.zpp_pool,Vi.zpp_pool=bn.next,bn.next=null),bn.elt=dn;var wn=bn;wn.next=gn.head,gn.head=wn,gn.modified=!0,gn.length++}if(null!=dn.body.cbSet){var Cn,Mn=this.mrca1,kn=dn.body;null==Vi.zpp_pool?Cn=new Vi:(Cn=Vi.zpp_pool,Vi.zpp_pool=Cn.next,Cn.next=null),Cn.elt=kn;var On=Cn;On.next=Mn.head,Mn.head=On,Mn.modified=!0,Mn.length++}if(null!=cn.cbSet){var Sn,Pn=this.mrca2;null==Vi.zpp_pool?Sn=new Vi:(Sn=Vi.zpp_pool,Vi.zpp_pool=Sn.next,Sn.next=null),Sn.elt=cn;var Tn=Sn;Tn.next=Pn.head,Pn.head=Tn,Pn.modified=!0,Pn.length++}if(null!=cn.body.cbSet){var An,En=this.mrca2,In=cn.body;null==Vi.zpp_pool?An=new Vi:(An=Vi.zpp_pool,Vi.zpp_pool=An.next,An.next=null),An.elt=In;var Vn=An;Vn.next=En.head,En.head=Vn,En.modified=!0,En.length++}for(var Ln=dn.body.compound,Nn=cn.body.compound;Ln!=Nn;){var Dn=null==Ln?0:Ln.depth,jn=null==Nn?0:Nn.depth;if(jn>Dn){if(null!=Nn.cbSet){var Fn,Bn=this.mrca2;null==Vi.zpp_pool?Fn=new Vi:(Fn=Vi.zpp_pool,Vi.zpp_pool=Fn.next,Fn.next=null),Fn.elt=Nn;var Rn=Fn;Rn.next=Bn.head,Bn.head=Rn,Bn.modified=!0,Bn.length++}Nn=Nn.compound}else{if(null!=Ln.cbSet){var Gn,Yn=this.mrca1;null==Vi.zpp_pool?Gn=new Vi:(Gn=Vi.zpp_pool,Vi.zpp_pool=Gn.next,Gn.next=null),Gn.elt=Ln;var Un=Gn;Un.next=Yn.head,Yn.head=Un,Yn.modified=!0,Yn.length++}Ln=Ln.compound}}for(var Zn=this.mrca1.head;null!=Zn;){for(var qn=Zn.elt,Wn=this.mrca2.head;null!=Wn;){for(var Xn=Wn.elt,Hn=qn.cbSet,Kn=Xn.cbSet,Jn=null,Qn=Kn.cbpairs.length>Hn.cbpairs.length?Hn.cbpairs:Kn.cbpairs,$n=Qn.head;null!=$n;){var ne=$n.elt;if(ne.a==Hn&&ne.b==Kn||ne.a==Kn&&ne.b==Hn){Jn=ne;break}$n=$n.next}if(null==Jn){var ee;null==he.zpp_pool?ee=new he:(ee=he.zpp_pool,he.zpp_pool=ee.next,ee.next=null),ee.zip_listeners=!0,oe.setlt(Hn,Kn)?(ee.a=Hn,ee.b=Kn):(ee.a=Kn,ee.b=Hn),Jn=ee,Hn.cbpairs.add(Jn),Kn!=Hn&&Kn.cbpairs.add(Jn)}if(Jn.zip_listeners&&(Jn.zip_listeners=!1,Jn.__validate()),null!=Jn.listeners.head){for(var te=null,ie=null,le=this.prelisteners;null!=le.head;){var re=le.head;le.head=re.next;var ae=re;ae.elt=null,ae.next=Ei.zpp_pool,Ei.zpp_pool=ae,null==le.head&&(le.pushmod=!0),le.modified=!0,le.length--}le.pushmod=!0;for(var pe=null,se=ye.id_CbEvent_PRE,_e=null,ue=Kn.cbpairs.length>Hn.cbpairs.length?Hn.cbpairs:Kn.cbpairs,de=ue.head;null!=de;){var ce=de.elt;if(ce.a==Hn&&ce.b==Kn||ce.a==Kn&&ce.b==Hn){_e=ce;break}de=de.next}if(null==_e){var xe;null==he.zpp_pool?xe=new he:(xe=he.zpp_pool,he.zpp_pool=xe.next,xe.next=null),xe.zip_listeners=!0,oe.setlt(Hn,Kn)?(xe.a=Hn,xe.b=Kn):(xe.a=Kn,xe.b=Hn),_e=xe,Hn.cbpairs.add(_e),Kn!=Hn&&Kn.cbpairs.add(_e)}_e.zip_listeners&&(_e.zip_listeners=!1,_e.__validate());for(var ve=_e.listeners.head;null!=ve;){var ze=ve.elt;if(ze.event==se&&0!=(ze.itype&nn)){var fe,me=a.prelisteners;null==Ei.zpp_pool?fe=new Ei:(fe=Ei.zpp_pool,Ei.zpp_pool=fe.next,fe.next=null),fe.elt=ze;var be=fe;null==pe?(be.next=me.head,me.head=be):(be.next=pe.next,pe.next=be),me.pushmod=me.modified=!0,me.length++,pe=be,un=!!un||!ze.pure}ve=ve.next}if(null!=this.prelisteners.head){if(te=Ot.get(qn,Xn),null==te&&(ie=Yt.get(qn,Xn),this.add_callbackset(ie)),null==te||(te.FLUIDstamp!=this.stamp||l)&&0==(te.FLUIDstate&ye.id_ImmState_ALWAYS)){if(null!=ie&&(te=ie),null!=te)for(var ge=this.prelisteners.head;null!=ge;){var we=ge.elt;we.itype==ye.id_InteractionType_ANY?(te.COLLISIONstamp=this.stamp,te.SENSORstamp=this.stamp,te.FLUIDstamp=this.stamp):te.FLUIDstamp=this.stamp,ge=ge.next}F.mutable=!0,null!=F.wrap_position&&(F.wrap_position.zpp_inner._immutable=!1);var Ce=F.active;F.active=!0;this.precb.zpp_inner.pre_arbiter=F,this.precb.zpp_inner.set=te;for(var Me=this.prelisteners.head;null!=Me;){var ke=Me.elt;this.precb.zpp_inner.listener=ke;var Oe,Se=this.precb.zpp_inner,Pe=te.int1,Te=te.int2,Ae=ke.options1,Ee=Pe.cbTypes;if(Ae.nonemptyintersection(Ee,Ae.includes)&&!Ae.nonemptyintersection(Ee,Ae.excludes)){var Ie=ke.options2,Ve=Te.cbTypes;Oe=!!Ie.nonemptyintersection(Ve,Ie.includes)&&!Ie.nonemptyintersection(Ve,Ie.excludes)}else Oe=!1;Oe?(Se.int1=Pe,Se.int2=Te):(Se.int1=Te,Se.int2=Pe),this.precb.zpp_inner.pre_swapped=qn!=this.precb.zpp_inner.int1;var Le=ke.handlerp(this.precb);if(null!=Le){var Ne;null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),Le==ye.PreFlag_ACCEPT?Ne=ye.id_ImmState_ACCEPT|ye.id_ImmState_ALWAYS:(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),Le==ye.PreFlag_ACCEPT_ONCE?Ne=ye.id_ImmState_ACCEPT:(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),Ne=Le==ye.PreFlag_IGNORE?ye.id_ImmState_IGNORE|ye.id_ImmState_ALWAYS:ye.id_ImmState_IGNORE)),F.immState=Ne}Me=Me.next}if(F.mutable=!1,null!=F.wrap_position&&(F.wrap_position.zpp_inner._immutable=!0),F.active=Ce,null!=te)for(var Re=this.prelisteners.head;null!=Re;){var Ge=Re.elt;Ge.itype==ye.id_InteractionType_ANY?(te.COLLISIONstate=F.immState,te.SENSORstate=F.immState,te.FLUIDstate=F.immState):te.FLUIDstate=F.immState,Re=Re.next}}else null==te?0==(F.immState&ye.id_ImmState_ALWAYS)&&(F.immState=ye.id_ImmState_ACCEPT):F.immState=te.FLUIDstate;Wn=Wn.next}else Wn=Wn.next}else Wn=Wn.next}Zn=Zn.next}if(un&&0==(F.immState&ye.id_ImmState_ALWAYS)){if(F.b1.type==ye.id_BodyType_DYNAMIC){var Ye=F.b1;Ye.world||(Ye.component.waket=this.stamp+(this.midstep?0:1),Ye.type==ye.id_BodyType_KINEMATIC&&(Ye.kinematicDelaySleep=!0),Ye.component.sleeping&&this.really_wake(Ye,!1))}if(F.b1.type==ye.id_BodyType_DYNAMIC){var Ue=F.b2;Ue.world||(Ue.component.waket=this.stamp+(this.midstep?0:1),Ue.type==ye.id_BodyType_KINEMATIC&&(Ue.kinematicDelaySleep=!0),Ue.component.sleeping&&this.really_wake(Ue,!1))}}}if(0!=(F.immState&ye.id_ImmState_ACCEPT)){if(F.b1.type==ye.id_BodyType_DYNAMIC&&F.b1.component.sleeping){var Ze=F.b1;Ze.world||(Ze.component.waket=this.stamp+(this.midstep?0:1),Ze.type==ye.id_BodyType_KINEMATIC&&(Ze.kinematicDelaySleep=!0),Ze.component.sleeping&&this.really_wake(Ze,!1))}if(F.b2.type==ye.id_BodyType_DYNAMIC&&F.b2.component.sleeping){var qe=F.b2;qe.world||(qe.component.waket=this.stamp+(this.midstep?0:1),qe.type==ye.id_BodyType_KINEMATIC&&(qe.kinematicDelaySleep=!0),qe.component.sleeping&&this.really_wake(qe,!1))}}if(F.sleeping){F.sleeping=!1;var Xe,He=this.f_arbiters;null==$i.zpp_pool?Xe=new $i:(Xe=$i.zpp_pool,$i.zpp_pool=Xe.next,Xe.next=null),Xe.elt=F;var Ke=Xe;Ke.next=He.head,He.head=Ke,He.modified=!0,He.length++}p=F}else if(B){var Je=F;Je.next=je.zpp_pool,je.zpp_pool=Je,p=null}else p=F;else p=F}else if(1==u){var Qe,$e=t?this.c_arbiters_true:this.c_arbiters_false;if(null==i){for(var nt=null,et=o.arbiters.length>s.arbiters.length?s:o,tt=et.arbiters.head;null!=tt;){var it=tt.elt;if(it.id==T.id&&it.di==A.id){nt=it;break}tt=tt.next}Qe=nt}else Qe=i;var lt,rt=null==Qe,at=!1;if(rt)null==Fe.zpp_pool?lt=new Fe:(lt=Fe.zpp_pool,Fe.zpp_pool=lt.next,lt.next=null),lt.stat=t;else if(null==Qe.colarb){Qe.cleared=!0;for(var pt=Qe.b1.arbiters,st=null,ot=pt.head;null!=ot;){if(ot.elt==Qe){var ht,_t;null==st?(ht=pt.head,_t=ht.next,null==(pt.head=_t)&&(pt.pushmod=!0)):(ht=st.next,_t=ht.next,st.next=_t,null==_t&&(pt.pushmod=!0));var ut=ht;ut.elt=null,ut.next=Ni.zpp_pool,Ni.zpp_pool=ut,pt.modified=!0,pt.length--,pt.pushmod=!0,!0;break}st=ot,ot=ot.next}for(var dt=Qe.b2.arbiters,ct=null,xt=dt.head;null!=xt;){if(xt.elt==Qe){var vt,zt;null==ct?(vt=dt.head,zt=vt.next,null==(dt.head=zt)&&(dt.pushmod=!0)):(vt=ct.next,zt=vt.next,ct.next=zt,null==zt&&(dt.pushmod=!0));var yt=vt;yt.elt=null,yt.next=Ni.zpp_pool,Ni.zpp_pool=yt,dt.modified=!0,dt.length--,dt.pushmod=!0,!0;break}ct=xt,xt=xt.next}null!=Qe.pair&&(Qe.pair.arb=null,Qe.pair=null),Qe.active=!1,this.f_arbiters.modified=!0,null==Fe.zpp_pool?lt=new Fe:(lt=Fe.zpp_pool,Fe.zpp_pool=lt.next,lt.next=null),lt.intchange=!0,lt.stat=t,rt=!0,at=!0}else lt=Qe.colarb,E=T!=lt.s1,lt.stat!=t&&(lt.stat=t,lt.sleeping||((t?this.c_arbiters_false:this.c_arbiters_true).remove(lt),$e.add(lt)));var ft=ye.id_InteractionType_COLLISION;if(rt||lt.stamp!=this.stamp||l)if(lt.stamp=this.stamp,We.contactCollide(T,A,lt,E)){if(rt){var mt=A.id;lt.b1=n.body,lt.ws1=n,lt.b2=e.body,lt.ws2=e,lt.id=T.id,lt.di=mt;var bt,gt=lt.b1.arbiters;null==Ni.zpp_pool?bt=new Ni:(bt=Ni.zpp_pool,Ni.zpp_pool=bt.next,bt.next=null),bt.elt=lt;var wt=bt;wt.next=gt.head,gt.head=wt,gt.modified=!0,gt.length++;var Ct,Mt=lt.b2.arbiters;null==Ni.zpp_pool?Ct=new Ni:(Ct=Ni.zpp_pool,Ni.zpp_pool=Ct.next,Ct.next=null),Ct.elt=lt;var kt=Ct;kt.next=Mt.head,Mt.head=kt,Mt.modified=!0,Mt.length++,lt.active=!0,lt.present=0,lt.cleared=!1,lt.sleeping=!1,lt.fresh=!1,lt.presentable=!1,lt.s1=n,lt.s2=e,lt.userdef_restitution||(lt.restitution=lt.s1.material.elasticity>-Infinity&&lt.s2.material.elasticity>-Infinity?lt.s1.material.elasticity<Infinity&&lt.s2.material.elasticity<Infinity?(lt.s1.material.elasticity+lt.s2.material.elasticity)/2:1:0,0>lt.restitution&&(lt.restitution=0),lt.restitution>1&&(lt.restitution=1)),lt.userdef_dyn_fric||(lt.dyn_fric=Math.sqrt(lt.s1.material.dynamicFriction*lt.s2.material.dynamicFriction)),lt.userdef_stat_fric||(lt.stat_fric=Math.sqrt(lt.s1.material.staticFriction*lt.s2.material.staticFriction)),lt.userdef_rfric||(lt.rfric=Math.sqrt(lt.s1.material.rollingFriction*lt.s2.material.rollingFriction));var St;null==el.zpp_pool?St=new el:(St=el.zpp_pool,el.zpp_pool=St.next,St.next=null),St.elt=lt;var Pt=St;Pt.next=$e.head,$e.head=Pt,$e.modified=!0,$e.length++,lt.fresh=!at}else lt.fresh=this.stamp-1>lt.up_stamp||lt.endGenerated==this.stamp&&l;if(lt.up_stamp=lt.stamp,lt.fresh||0==(lt.immState&ye.id_ImmState_ALWAYS)){lt.immState=ye.id_ImmState_ACCEPT;for(var Tt=!1,At=lt.ws1.id>lt.ws2.id?lt.ws2:lt.ws1,Et=lt.ws1.id>lt.ws2.id?lt.ws1:lt.ws2,It=this.mrca1;null!=It.head;){var Vt=It.head;It.head=Vt.next;var Lt=Vt;Lt.elt=null,Lt.next=Vi.zpp_pool,Vi.zpp_pool=Lt,null==It.head&&(It.pushmod=!0),It.modified=!0,It.length--}It.pushmod=!0;for(var Nt=this.mrca2;null!=Nt.head;){var Dt=Nt.head;Nt.head=Dt.next;var jt=Dt;jt.elt=null,jt.next=Vi.zpp_pool,Vi.zpp_pool=jt,null==Nt.head&&(Nt.pushmod=!0),Nt.modified=!0,Nt.length--}if(Nt.pushmod=!0,null!=At.cbSet){var Ft,Bt=this.mrca1;null==Vi.zpp_pool?Ft=new Vi:(Ft=Vi.zpp_pool,Vi.zpp_pool=Ft.next,Ft.next=null),Ft.elt=At;var Rt=Ft;Rt.next=Bt.head,Bt.head=Rt,Bt.modified=!0,Bt.length++}if(null!=At.body.cbSet){var Gt,Ut=this.mrca1,Zt=At.body;null==Vi.zpp_pool?Gt=new Vi:(Gt=Vi.zpp_pool,Vi.zpp_pool=Gt.next,Gt.next=null),Gt.elt=Zt;var qt=Gt;qt.next=Ut.head,Ut.head=qt,Ut.modified=!0,Ut.length++}if(null!=Et.cbSet){var Wt,Xt=this.mrca2;null==Vi.zpp_pool?Wt=new Vi:(Wt=Vi.zpp_pool,Vi.zpp_pool=Wt.next,Wt.next=null),Wt.elt=Et;var Ht=Wt;Ht.next=Xt.head,Xt.head=Ht,Xt.modified=!0,Xt.length++}if(null!=Et.body.cbSet){var Kt,Jt=this.mrca2,Qt=Et.body;null==Vi.zpp_pool?Kt=new Vi:(Kt=Vi.zpp_pool,Vi.zpp_pool=Kt.next,Kt.next=null),Kt.elt=Qt;var $t=Kt;$t.next=Jt.head,Jt.head=$t,Jt.modified=!0,Jt.length++}for(var ni=At.body.compound,ei=Et.body.compound;ni!=ei;){var ti=null==ni?0:ni.depth,ii=null==ei?0:ei.depth;if(ii>ti){if(null!=ei.cbSet){var li,ri=this.mrca2;null==Vi.zpp_pool?li=new Vi:(li=Vi.zpp_pool,Vi.zpp_pool=li.next,li.next=null),li.elt=ei;var ai=li;ai.next=ri.head,ri.head=ai,ri.modified=!0,ri.length++}ei=ei.compound}else{if(null!=ni.cbSet){var pi,si=this.mrca1;null==Vi.zpp_pool?pi=new Vi:(pi=Vi.zpp_pool,Vi.zpp_pool=pi.next,pi.next=null),pi.elt=ni;var oi=pi;oi.next=si.head,si.head=oi,si.modified=!0,si.length++}ni=ni.compound}}for(var hi=this.mrca1.head;null!=hi;){for(var _i=hi.elt,ui=this.mrca2.head;null!=ui;){for(var di=ui.elt,ci=_i.cbSet,xi=di.cbSet,vi=null,zi=xi.cbpairs.length>ci.cbpairs.length?ci.cbpairs:xi.cbpairs,yi=zi.head;null!=yi;){var fi=yi.elt;if(fi.a==ci&&fi.b==xi||fi.a==xi&&fi.b==ci){vi=fi;break}yi=yi.next}if(null==vi){var mi;null==he.zpp_pool?mi=new he:(mi=he.zpp_pool,he.zpp_pool=mi.next,mi.next=null),mi.zip_listeners=!0,oe.setlt(ci,xi)?(mi.a=ci,mi.b=xi):(mi.a=xi,mi.b=ci),vi=mi,ci.cbpairs.add(vi),xi!=ci&&xi.cbpairs.add(vi)}if(vi.zip_listeners&&(vi.zip_listeners=!1,vi.__validate()),null!=vi.listeners.head){for(var bi=null,gi=null,wi=this.prelisteners;null!=wi.head;){var Ci=wi.head;wi.head=Ci.next;var Mi=Ci;Mi.elt=null,Mi.next=Ei.zpp_pool,Ei.zpp_pool=Mi,null==wi.head&&(wi.pushmod=!0),wi.modified=!0,wi.length--}wi.pushmod=!0;for(var ki=null,Oi=ye.id_CbEvent_PRE,Si=null,Pi=xi.cbpairs.length>ci.cbpairs.length?ci.cbpairs:xi.cbpairs,Ti=Pi.head;null!=Ti;){var Ai=Ti.elt;if(Ai.a==ci&&Ai.b==xi||Ai.a==xi&&Ai.b==ci){Si=Ai;break}Ti=Ti.next}if(null==Si){var Ii;null==he.zpp_pool?Ii=new he:(Ii=he.zpp_pool,he.zpp_pool=Ii.next,Ii.next=null),Ii.zip_listeners=!0,oe.setlt(ci,xi)?(Ii.a=ci,Ii.b=xi):(Ii.a=xi,Ii.b=ci),Si=Ii,ci.cbpairs.add(Si),xi!=ci&&xi.cbpairs.add(Si)}Si.zip_listeners&&(Si.zip_listeners=!1,Si.__validate());for(var Li=Si.listeners.head;null!=Li;){var Di=Li.elt;if(Di.event==Oi&&0!=(Di.itype&ft)){var ji,Fi=a.prelisteners;null==Ei.zpp_pool?ji=new Ei:(ji=Ei.zpp_pool,Ei.zpp_pool=ji.next,ji.next=null),ji.elt=Di;var Bi=ji;null==ki?(Bi.next=Fi.head,Fi.head=Bi):(Bi.next=ki.next,ki.next=Bi),Fi.pushmod=Fi.modified=!0,Fi.length++,ki=Bi,Tt=!!Tt||!Di.pure}Li=Li.next}if(null!=this.prelisteners.head){if(bi=Ot.get(_i,di),null==bi&&(gi=Yt.get(_i,di),this.add_callbackset(gi)),null==bi||(bi.COLLISIONstamp!=this.stamp||l)&&0==(bi.COLLISIONstate&ye.id_ImmState_ALWAYS)){if(null!=gi&&(bi=gi),null!=bi)for(var Ri=this.prelisteners.head;null!=Ri;){var Gi=Ri.elt;Gi.itype==ye.id_InteractionType_ANY?(bi.COLLISIONstamp=this.stamp,bi.SENSORstamp=this.stamp,bi.FLUIDstamp=this.stamp):bi.COLLISIONstamp=this.stamp,Ri=Ri.next}lt.mutable=!0,null!=lt.wrap_normal&&(lt.wrap_normal.zpp_inner._immutable=!1),null!=lt.wrap_contacts&&(lt.wrap_contacts.zpp_inner.immutable=!1);var Yi=lt.active;lt.active=!0;var Ui=!0,Zi=null,qi=null,Wi=lt.innards.next;lt.hc2=!1;for(var Xi=lt.contacts.next;null!=Xi;){var Hi=Xi;if(Hi.stamp+f.arbiterExpirationDelay<lt.stamp){var Ki,Ji,Qi=lt.contacts;null==Zi?(Ki=Qi.next,Ji=Ki.next,null==(Qi.next=Ji)&&(Qi.pushmod=!0)):(Ki=Zi.next,Ji=Ki.next,Zi.next=Ji,null==Ji&&(Qi.pushmod=!0)),Ki._inuse=!1,Qi.modified=!0,Qi.length--,Qi.pushmod=!0,Xi=Ji;var tl,il,ll=lt.innards;null==qi?(tl=ll.next,il=tl.next,null==(ll.next=il)&&(ll.pushmod=!0)):(tl=qi.next,il=tl.next,qi.next=il,null==il&&(ll.pushmod=!0)),tl._inuse=!1,ll.modified=!0,ll.length--,ll.pushmod=!0,Wi=il;var rl=Hi;rl.arbiter=null,rl.next=Be.zpp_pool,Be.zpp_pool=rl}else{var al=Hi.inner,pl=Hi.active;Hi.active=Hi.stamp==lt.stamp,Hi.active&&(Ui?(Ui=!1,lt.c1=al,lt.oc1=Hi):(lt.hc2=!0,lt.c2=al,lt.oc2=Hi)),pl!=Hi.active&&(lt.contacts.modified=!0),Zi=Xi,qi=Wi,Wi=Wi.next,Xi=Xi.next}}if(lt.hc2){if(lt.hpc2=!0,lt.oc1.posOnly){var sl=lt.c1;lt.c1=lt.c2,lt.c2=sl;var ol=lt.oc1;lt.oc1=lt.oc2,lt.oc2=ol,lt.hc2=!1}else lt.oc2.posOnly&&(lt.hc2=!1);lt.oc1.posOnly&&(Ui=!0)}else lt.hpc2=!1;this.precb.zpp_inner.pre_arbiter=lt,this.precb.zpp_inner.set=bi;for(var hl=this.prelisteners.head;null!=hl;){var _l=hl.elt;this.precb.zpp_inner.listener=_l;var ul,dl=this.precb.zpp_inner,cl=bi.int1,xl=bi.int2,vl=_l.options1,zl=cl.cbTypes;if(vl.nonemptyintersection(zl,vl.includes)&&!vl.nonemptyintersection(zl,vl.excludes)){var yl=_l.options2,fl=xl.cbTypes;ul=!!yl.nonemptyintersection(fl,yl.includes)&&!yl.nonemptyintersection(fl,yl.excludes)}else ul=!1;ul?(dl.int1=cl,dl.int2=xl):(dl.int1=xl,dl.int2=cl),this.precb.zpp_inner.pre_swapped=_i!=this.precb.zpp_inner.int1;var ml=_l.handlerp(this.precb);if(null!=ml){var bl;null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),ml==ye.PreFlag_ACCEPT?bl=ye.id_ImmState_ACCEPT|ye.id_ImmState_ALWAYS:(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),ml==ye.PreFlag_ACCEPT_ONCE?bl=ye.id_ImmState_ACCEPT:(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),bl=ml==ye.PreFlag_IGNORE?ye.id_ImmState_IGNORE|ye.id_ImmState_ALWAYS:ye.id_ImmState_IGNORE)),lt.immState=bl}hl=hl.next}if(lt.mutable=!1,null!=lt.wrap_normal&&(lt.wrap_normal.zpp_inner._immutable=!0),null!=lt.wrap_contacts&&(lt.wrap_contacts.zpp_inner.immutable=!0),lt.active=Yi,null!=bi)for(var gl=this.prelisteners.head;null!=gl;){var wl=gl.elt;wl.itype==ye.id_InteractionType_ANY?(bi.COLLISIONstate=lt.immState,bi.SENSORstate=lt.immState,bi.FLUIDstate=lt.immState):bi.COLLISIONstate=lt.immState,gl=gl.next}}else null==bi?0==(lt.immState&ye.id_ImmState_ALWAYS)&&(lt.immState=ye.id_ImmState_ACCEPT):lt.immState=bi.COLLISIONstate;ui=ui.next}else ui=ui.next}else ui=ui.next}hi=hi.next}if(Tt&&0==(lt.immState&ye.id_ImmState_ALWAYS)){if(lt.b1.type==ye.id_BodyType_DYNAMIC){var Cl=lt.b1;Cl.world||(Cl.component.waket=this.stamp+(this.midstep?0:1),Cl.type==ye.id_BodyType_KINEMATIC&&(Cl.kinematicDelaySleep=!0),Cl.component.sleeping&&this.really_wake(Cl,!1))}if(lt.b1.type==ye.id_BodyType_DYNAMIC){var Ml=lt.b2;Ml.world||(Ml.component.waket=this.stamp+(this.midstep?0:1),Ml.type==ye.id_BodyType_KINEMATIC&&(Ml.kinematicDelaySleep=!0),Ml.component.sleeping&&this.really_wake(Ml,!1))}}}if(0!=(lt.immState&ye.id_ImmState_ACCEPT)){if(lt.b1.type==ye.id_BodyType_DYNAMIC&&lt.b1.component.sleeping){var kl=lt.b1;kl.world||(kl.component.waket=this.stamp+(this.midstep?0:1),kl.type==ye.id_BodyType_KINEMATIC&&(kl.kinematicDelaySleep=!0),kl.component.sleeping&&this.really_wake(kl,!1))}if(lt.b2.type==ye.id_BodyType_DYNAMIC&&lt.b2.component.sleeping){var Ol=lt.b2;Ol.world||(Ol.component.waket=this.stamp+(this.midstep?0:1),Ol.type==ye.id_BodyType_KINEMATIC&&(Ol.kinematicDelaySleep=!0),Ol.component.sleeping&&this.really_wake(Ol,!1))}}if(lt.sleeping){lt.sleeping=!1;var Sl;null==el.zpp_pool?Sl=new el:(Sl=el.zpp_pool,el.zpp_pool=Sl.next,Sl.next=null),Sl.elt=lt;var Pl=Sl;Pl.next=$e.head,$e.head=Pl,$e.modified=!0,$e.length++}p=lt}else if(rt){var Tl=lt;Tl.userdef_dyn_fric=!1,Tl.userdef_stat_fric=!1,Tl.userdef_restitution=!1,Tl.userdef_rfric=!1,Tl.__ref_edge1=Tl.__ref_edge2=null,Tl.next=Fe.zpp_pool,Fe.zpp_pool=Tl,p=null}else p=lt;else p=lt}else{var Al;if(null==i){for(var El=null,Il=o.arbiters.length>s.arbiters.length?s:o,Vl=Il.arbiters.head;null!=Vl;){var Ll=Vl.elt;if(Ll.id==T.id&&Ll.di==A.id){El=Ll;break}Vl=Vl.next}Al=El}else Al=i;var Nl,Dl=null==Al,jl=!1;if(Dl)null==De.zpp_pool?Nl=new De:(Nl=De.zpp_pool,De.zpp_pool=Nl.next,Nl.next=null);else if(null==Al.sensorarb){Al.cleared=!0;for(var Fl=Al.b1.arbiters,Bl=null,Rl=Fl.head;null!=Rl;){if(Rl.elt==Al){var Gl,Yl;null==Bl?(Gl=Fl.head,Yl=Gl.next,null==(Fl.head=Yl)&&(Fl.pushmod=!0)):(Gl=Bl.next,Yl=Gl.next,Bl.next=Yl,null==Yl&&(Fl.pushmod=!0));var Ul=Gl;Ul.elt=null,Ul.next=Ni.zpp_pool,Ni.zpp_pool=Ul,Fl.modified=!0,Fl.length--,Fl.pushmod=!0,!0;break}Bl=Rl,Rl=Rl.next}for(var Zl=Al.b2.arbiters,ql=null,Wl=Zl.head;null!=Wl;){if(Wl.elt==Al){var Xl,Hl;null==ql?(Xl=Zl.head,Hl=Xl.next,null==(Zl.head=Hl)&&(Zl.pushmod=!0)):(Xl=ql.next,Hl=Xl.next,ql.next=Hl,null==Hl&&(Zl.pushmod=!0));var Kl=Xl;Kl.elt=null,Kl.next=Ni.zpp_pool,Ni.zpp_pool=Kl,Zl.modified=!0,Zl.length--,Zl.pushmod=!0,!0;break}ql=Wl,Wl=Wl.next}null!=Al.pair&&(Al.pair.arb=null,Al.pair=null),Al.active=!1,this.f_arbiters.modified=!0,null==De.zpp_pool?Nl=new De:(Nl=De.zpp_pool,De.zpp_pool=Nl.next,Nl.next=null),Nl.intchange=!0,Dl=!0,jl=!0}else Nl=Al.sensorarb;var Jl=ye.id_InteractionType_SENSOR;if(Dl||Nl.stamp!=this.stamp||l)if(Nl.stamp=this.stamp,We.testCollide(T,A)){if(Dl){var Ql=A.id;Nl.b1=n.body,Nl.ws1=n,Nl.b2=e.body,Nl.ws2=e,Nl.id=T.id,Nl.di=Ql;var $l,nr=Nl.b1.arbiters;null==Ni.zpp_pool?$l=new Ni:($l=Ni.zpp_pool,Ni.zpp_pool=$l.next,$l.next=null),$l.elt=Nl;var er=$l;er.next=nr.head,nr.head=er,nr.modified=!0,nr.length++;var tr,ir=Nl.b2.arbiters;null==Ni.zpp_pool?tr=new Ni:(tr=Ni.zpp_pool,Ni.zpp_pool=tr.next,tr.next=null),tr.elt=Nl;var lr=tr;lr.next=ir.head,ir.head=lr,ir.modified=!0,ir.length++,Nl.active=!0,Nl.present=0,Nl.cleared=!1,Nl.sleeping=!1,Nl.fresh=!1,Nl.presentable=!1;var rr,ar=this.s_arbiters;null==nl.zpp_pool?rr=new nl:(rr=nl.zpp_pool,nl.zpp_pool=rr.next,rr.next=null),rr.elt=Nl;var pr=rr;pr.next=ar.head,ar.head=pr,ar.modified=!0,ar.length++,Nl.fresh=!jl}else Nl.fresh=this.stamp-1>Nl.up_stamp||Nl.endGenerated==this.stamp&&l;if(Nl.up_stamp=Nl.stamp,Nl.fresh||0==(Nl.immState&ye.id_ImmState_ALWAYS)){Nl.immState=ye.id_ImmState_ACCEPT;for(var sr=!1,or=Nl.ws1.id>Nl.ws2.id?Nl.ws2:Nl.ws1,hr=Nl.ws1.id>Nl.ws2.id?Nl.ws1:Nl.ws2,_r=this.mrca1;null!=_r.head;){var ur=_r.head;_r.head=ur.next;var dr=ur;dr.elt=null,dr.next=Vi.zpp_pool,Vi.zpp_pool=dr,null==_r.head&&(_r.pushmod=!0),_r.modified=!0,_r.length--}_r.pushmod=!0;for(var cr=this.mrca2;null!=cr.head;){var xr=cr.head;cr.head=xr.next;var vr=xr;vr.elt=null,vr.next=Vi.zpp_pool,Vi.zpp_pool=vr,null==cr.head&&(cr.pushmod=!0),cr.modified=!0,cr.length--}if(cr.pushmod=!0,null!=or.cbSet){var zr,yr=this.mrca1;null==Vi.zpp_pool?zr=new Vi:(zr=Vi.zpp_pool,Vi.zpp_pool=zr.next,zr.next=null),zr.elt=or;var fr=zr;fr.next=yr.head,yr.head=fr,yr.modified=!0,yr.length++}if(null!=or.body.cbSet){var mr,br=this.mrca1,gr=or.body;null==Vi.zpp_pool?mr=new Vi:(mr=Vi.zpp_pool,Vi.zpp_pool=mr.next,mr.next=null),mr.elt=gr;var wr=mr;wr.next=br.head,br.head=wr,br.modified=!0,br.length++}if(null!=hr.cbSet){var Cr,Mr=this.mrca2;null==Vi.zpp_pool?Cr=new Vi:(Cr=Vi.zpp_pool,Vi.zpp_pool=Cr.next,Cr.next=null),Cr.elt=hr;var kr=Cr;kr.next=Mr.head,Mr.head=kr,Mr.modified=!0,Mr.length++}if(null!=hr.body.cbSet){var Or,Sr=this.mrca2,Pr=hr.body;null==Vi.zpp_pool?Or=new Vi:(Or=Vi.zpp_pool,Vi.zpp_pool=Or.next,Or.next=null),Or.elt=Pr;var Tr=Or;Tr.next=Sr.head,Sr.head=Tr,Sr.modified=!0,Sr.length++}for(var Ar=or.body.compound,Er=hr.body.compound;Ar!=Er;){var Ir=null==Ar?0:Ar.depth,Vr=null==Er?0:Er.depth;if(Vr>Ir){if(null!=Er.cbSet){var Lr,Nr=this.mrca2;null==Vi.zpp_pool?Lr=new Vi:(Lr=Vi.zpp_pool,Vi.zpp_pool=Lr.next,Lr.next=null),Lr.elt=Er;var Dr=Lr;Dr.next=Nr.head,Nr.head=Dr,Nr.modified=!0,Nr.length++}Er=Er.compound}else{if(null!=Ar.cbSet){var jr,Fr=this.mrca1;null==Vi.zpp_pool?jr=new Vi:(jr=Vi.zpp_pool,Vi.zpp_pool=jr.next,jr.next=null),jr.elt=Ar;var Br=jr;Br.next=Fr.head,Fr.head=Br,Fr.modified=!0,Fr.length++}Ar=Ar.compound}}for(var Rr=this.mrca1.head;null!=Rr;){for(var Gr=Rr.elt,Yr=this.mrca2.head;null!=Yr;){for(var Ur=Yr.elt,Zr=Gr.cbSet,qr=Ur.cbSet,Wr=null,Xr=qr.cbpairs.length>Zr.cbpairs.length?Zr.cbpairs:qr.cbpairs,Hr=Xr.head;null!=Hr;){var Kr=Hr.elt;if(Kr.a==Zr&&Kr.b==qr||Kr.a==qr&&Kr.b==Zr){Wr=Kr;break}Hr=Hr.next}if(null==Wr){var Jr;null==he.zpp_pool?Jr=new he:(Jr=he.zpp_pool,he.zpp_pool=Jr.next,Jr.next=null),Jr.zip_listeners=!0,oe.setlt(Zr,qr)?(Jr.a=Zr,Jr.b=qr):(Jr.a=qr,Jr.b=Zr),Wr=Jr,Zr.cbpairs.add(Wr),qr!=Zr&&qr.cbpairs.add(Wr)}if(Wr.zip_listeners&&(Wr.zip_listeners=!1,Wr.__validate()),null!=Wr.listeners.head){for(var Qr=null,$r=null,na=this.prelisteners;null!=na.head;){var ea=na.head;na.head=ea.next;var ta=ea;ta.elt=null,ta.next=Ei.zpp_pool,Ei.zpp_pool=ta,null==na.head&&(na.pushmod=!0),na.modified=!0,na.length--}na.pushmod=!0;for(var ia=null,la=ye.id_CbEvent_PRE,ra=null,aa=qr.cbpairs.length>Zr.cbpairs.length?Zr.cbpairs:qr.cbpairs,pa=aa.head;null!=pa;){var sa=pa.elt;if(sa.a==Zr&&sa.b==qr||sa.a==qr&&sa.b==Zr){ra=sa;break}pa=pa.next}if(null==ra){var oa;null==he.zpp_pool?oa=new he:(oa=he.zpp_pool,he.zpp_pool=oa.next,oa.next=null),oa.zip_listeners=!0,oe.setlt(Zr,qr)?(oa.a=Zr,oa.b=qr):(oa.a=qr,oa.b=Zr),ra=oa,Zr.cbpairs.add(ra),qr!=Zr&&qr.cbpairs.add(ra)}ra.zip_listeners&&(ra.zip_listeners=!1,ra.__validate());for(var ha=ra.listeners.head;null!=ha;){var _a=ha.elt;if(_a.event==la&&0!=(_a.itype&Jl)){var ua,da=a.prelisteners;null==Ei.zpp_pool?ua=new Ei:(ua=Ei.zpp_pool,Ei.zpp_pool=ua.next,ua.next=null),ua.elt=_a;var ca=ua;null==ia?(ca.next=da.head,da.head=ca):(ca.next=ia.next,ia.next=ca),da.pushmod=da.modified=!0,da.length++,ia=ca,sr=!!sr||!_a.pure}ha=ha.next}if(null!=this.prelisteners.head){if(Qr=Ot.get(Gr,Ur),null==Qr&&($r=Yt.get(Gr,Ur),this.add_callbackset($r)),null==Qr||(Qr.SENSORstamp!=this.stamp||l)&&0==(Qr.SENSORstate&ye.id_ImmState_ALWAYS)){if(null!=$r&&(Qr=$r),null!=Qr)for(var xa=this.prelisteners.head;null!=xa;){var va=xa.elt;va.itype==ye.id_InteractionType_ANY?(Qr.COLLISIONstamp=this.stamp,Qr.SENSORstamp=this.stamp,Qr.FLUIDstamp=this.stamp):Qr.SENSORstamp=this.stamp,xa=xa.next}var za=Nl.active;Nl.active=!0;this.precb.zpp_inner.pre_arbiter=Nl,this.precb.zpp_inner.set=Qr;for(var ya=this.prelisteners.head;null!=ya;){var fa=ya.elt;this.precb.zpp_inner.listener=fa;var ma,ba=this.precb.zpp_inner,ga=Qr.int1,wa=Qr.int2,Ca=fa.options1,Ma=ga.cbTypes;if(Ca.nonemptyintersection(Ma,Ca.includes)&&!Ca.nonemptyintersection(Ma,Ca.excludes)){var ka=fa.options2,Oa=wa.cbTypes;ma=!!ka.nonemptyintersection(Oa,ka.includes)&&!ka.nonemptyintersection(Oa,ka.excludes)}else ma=!1;ma?(ba.int1=ga,ba.int2=wa):(ba.int1=wa,ba.int2=ga),this.precb.zpp_inner.pre_swapped=Gr!=this.precb.zpp_inner.int1;var Sa=fa.handlerp(this.precb);if(null!=Sa){var Pa;null==ye.PreFlag_ACCEPT&&(ye.internal=!0,ye.PreFlag_ACCEPT=new j,ye.internal=!1),Sa==ye.PreFlag_ACCEPT?Pa=ye.id_ImmState_ACCEPT|ye.id_ImmState_ALWAYS:(null==ye.PreFlag_ACCEPT_ONCE&&(ye.internal=!0,ye.PreFlag_ACCEPT_ONCE=new j,ye.internal=!1),Sa==ye.PreFlag_ACCEPT_ONCE?Pa=ye.id_ImmState_ACCEPT:(null==ye.PreFlag_IGNORE&&(ye.internal=!0,ye.PreFlag_IGNORE=new j,ye.internal=!1),Pa=Sa==ye.PreFlag_IGNORE?ye.id_ImmState_IGNORE|ye.id_ImmState_ALWAYS:ye.id_ImmState_IGNORE)),Nl.immState=Pa}ya=ya.next}if(Nl.active=za,null!=Qr)for(var Ta=this.prelisteners.head;null!=Ta;){var Aa=Ta.elt;Aa.itype==ye.id_InteractionType_ANY?(Qr.COLLISIONstate=Nl.immState,Qr.SENSORstate=Nl.immState,Qr.FLUIDstate=Nl.immState):Qr.SENSORstate=Nl.immState,Ta=Ta.next}}else null==Qr?0==(Nl.immState&ye.id_ImmState_ALWAYS)&&(Nl.immState=ye.id_ImmState_ACCEPT):Nl.immState=Qr.SENSORstate;Yr=Yr.next}else Yr=Yr.next}else Yr=Yr.next}Rr=Rr.next}if(sr&&0==(Nl.immState&ye.id_ImmState_ALWAYS)){if(Nl.b1.type!=ye.id_BodyType_STATIC){var Ea=Nl.b1;Ea.world||(Ea.component.waket=this.stamp+(this.midstep?0:1),Ea.type==ye.id_BodyType_KINEMATIC&&(Ea.kinematicDelaySleep=!0),Ea.component.sleeping&&this.really_wake(Ea,!1))}if(Nl.b2.type!=ye.id_BodyType_STATIC){var Ia=Nl.b2;Ia.world||(Ia.component.waket=this.stamp+(this.midstep?0:1),Ia.type==ye.id_BodyType_KINEMATIC&&(Ia.kinematicDelaySleep=!0),Ia.component.sleeping&&this.really_wake(Ia,!1))}}}if(Nl.sleeping){Nl.sleeping=!1;var Va,La=this.s_arbiters;null==nl.zpp_pool?Va=new nl:(Va=nl.zpp_pool,nl.zpp_pool=Va.next,Va.next=null),Va.elt=Nl;var Na=Va;Na.next=La.head,La.head=Na,La.modified=!0,La.length++}p=Nl}else if(Dl){var Da=Nl;Da.next=De.zpp_pool,De.zpp_pool=Da,p=null}else p=Nl;else p=Nl}}return p},mrca1:null,mrca2:null,MRCA_chains:function(n,e){for(var t=this.mrca1;null!=t.head;){var i=t.head;t.head=i.next;var l=i;l.elt=null,l.next=Vi.zpp_pool,Vi.zpp_pool=l,null==t.head&&(t.pushmod=!0),t.modified=!0,t.length--}t.pushmod=!0;for(var r=this.mrca2;null!=r.head;){var a=r.head;r.head=a.next;var p=a;p.elt=null,p.next=Vi.zpp_pool,Vi.zpp_pool=p,null==r.head&&(r.pushmod=!0),r.modified=!0,r.length--}if(r.pushmod=!0,null!=n.cbSet){var s,o=this.mrca1;null==Vi.zpp_pool?s=new Vi:(s=Vi.zpp_pool,Vi.zpp_pool=s.next,s.next=null),s.elt=n;var h=s;h.next=o.head,o.head=h,o.modified=!0,o.length++}if(null!=n.body.cbSet){var _,u=this.mrca1,d=n.body;null==Vi.zpp_pool?_=new Vi:(_=Vi.zpp_pool,Vi.zpp_pool=_.next,_.next=null),_.elt=d;var c=_;c.next=u.head,u.head=c,u.modified=!0,u.length++}if(null!=e.cbSet){var x,v=this.mrca2;null==Vi.zpp_pool?x=new Vi:(x=Vi.zpp_pool,Vi.zpp_pool=x.next,x.next=null),x.elt=e;var z=x;z.next=v.head,v.head=z,v.modified=!0,v.length++}if(null!=e.body.cbSet){var y,f=this.mrca2,m=e.body;null==Vi.zpp_pool?y=new Vi:(y=Vi.zpp_pool,Vi.zpp_pool=y.next,y.next=null),y.elt=m;var b=y;b.next=f.head,f.head=b,f.modified=!0,f.length++}for(var g=n.body.compound,w=e.body.compound;g!=w;){var C=null==g?0:g.depth;if((null==w?0:w.depth)>C){if(null!=w.cbSet){var M,k=this.mrca2;null==Vi.zpp_pool?M=new Vi:(M=Vi.zpp_pool,Vi.zpp_pool=M.next,M.next=null),M.elt=w;var O=M;O.next=k.head,k.head=O,k.modified=!0,k.length++}w=w.compound}else{if(null!=g.cbSet){var S,P=this.mrca1;null==Vi.zpp_pool?S=new Vi:(S=Vi.zpp_pool,Vi.zpp_pool=S.next,S.next=null),S.elt=g;var T=S;T.next=P.head,P.head=T,P.modified=!0,P.length++}g=g.compound}}},inlined_MRCA_chains:function(n,e){for(var t=this.mrca1;null!=t.head;){var i=t.head;t.head=i.next;var l=i;l.elt=null,l.next=Vi.zpp_pool,Vi.zpp_pool=l,null==t.head&&(t.pushmod=!0),t.modified=!0,t.length--}t.pushmod=!0;for(var r=this.mrca2;null!=r.head;){var a=r.head;r.head=a.next;var p=a;p.elt=null,p.next=Vi.zpp_pool,Vi.zpp_pool=p,null==r.head&&(r.pushmod=!0),r.modified=!0,r.length--}if(r.pushmod=!0,null!=n.cbSet){var s,o=this.mrca1;null==Vi.zpp_pool?s=new Vi:(s=Vi.zpp_pool,Vi.zpp_pool=s.next,s.next=null),s.elt=n;var h=s;h.next=o.head,o.head=h,o.modified=!0,o.length++}if(null!=n.body.cbSet){var _,u=this.mrca1,d=n.body;null==Vi.zpp_pool?_=new Vi:(_=Vi.zpp_pool,Vi.zpp_pool=_.next,_.next=null),_.elt=d;var c=_;c.next=u.head,u.head=c,u.modified=!0,u.length++}if(null!=e.cbSet){var x,v=this.mrca2;null==Vi.zpp_pool?x=new Vi:(x=Vi.zpp_pool,Vi.zpp_pool=x.next,x.next=null),x.elt=e;var z=x;z.next=v.head,v.head=z,v.modified=!0,v.length++}if(null!=e.body.cbSet){var y,f=this.mrca2,m=e.body;null==Vi.zpp_pool?y=new Vi:(y=Vi.zpp_pool,Vi.zpp_pool=y.next,y.next=null),y.elt=m;var b=y;b.next=f.head,f.head=b,f.modified=!0,f.length++}for(var g=n.body.compound,w=e.body.compound;g!=w;){var C=null==g?0:g.depth;if((null==w?0:w.depth)>C){if(null!=w.cbSet){var M,k=this.mrca2;null==Vi.zpp_pool?M=new Vi:(M=Vi.zpp_pool,Vi.zpp_pool=M.next,M.next=null),M.elt=w;var O=M;O.next=k.head,k.head=O,k.modified=!0,k.length++}w=w.compound}else{if(null!=g.cbSet){var S,P=this.mrca1;null==Vi.zpp_pool?S=new Vi:(S=Vi.zpp_pool,Vi.zpp_pool=S.next,S.next=null),S.elt=g;var T=S;T.next=P.head,P.head=T,P.modified=!0,P.length++}g=g.compound}}},__class__:Zt};var qt=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};l["zpp_nape.space.ZPP_SweepData"]=qt,qt.__name__=["zpp_nape","space","ZPP_SweepData"],qt.prototype={next:null,prev:null,shape:null,aabb:null,free:function(){this.prev=null,this.shape=null,this.aabb=null},alloc:function(){},gt:function(n){return this.aabb.minx>n.aabb.minx},__class__:qt};var Wt=function(n){this.failed=null,this.list=null,Nt.call(this),this.space=n,this.is_sweep=!0,this.sweep=this};l["zpp_nape.space.ZPP_SweepPhase"]=Wt,Wt.__name__=["zpp_nape","space","ZPP_SweepPhase"],Wt.__super__=Nt,Wt.prototype=e(Nt.prototype,{list:null,__insert:function(n){var e;null==qt.zpp_pool?e=new qt:(e=qt.zpp_pool,qt.zpp_pool=e.next,e.next=null),n.sweep=e,e.shape=n,e.aabb=n.aabb,e.next=this.list,null!=this.list&&(this.list.prev=e),this.list=e},__remove:function(n){var e=n.sweep;null==e.prev?this.list=e.next:e.prev.next=e.next,null!=e.next&&(e.next.prev=e.prev),n.sweep=null;var t=e;t.prev=null,t.shape=null,t.aabb=null,t.next=qt.zpp_pool,qt.zpp_pool=t},__sync:function(n){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==ye.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==ye.id_ShapeType_POLYGON){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var i=0,l=t.lverts.next,r=l;l=l.next;var a=l;for(l=l.next;null!=l;){var p=l;i+=a.x*(p.y-r.y);var s=p.y*a.x-p.x*a.y;t.localCOMx+=(a.x+p.x)*s,t.localCOMy+=(a.y+p.y)*s,r=a,a=p,l=l.next}l=t.lverts.next;var o=l;i+=a.x*(o.y-r.y);var h=o.y*a.x-o.x*a.y;t.localCOMx+=(a.x+o.x)*h,t.localCOMy+=(a.y+o.y)*h,r=a,a=o,l=l.next;var _=l;i+=a.x*(_.y-r.y);var u=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*u,t.localCOMy+=(a.y+_.y)*u,i=1/(3*i);var d=i;t.localCOMx*=d,t.localCOMy*=d}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var c=e.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var x=e.radius,v=e.radius;e.aabb.minx=e.worldCOMx-x,e.aabb.miny=e.worldCOMy-v,e.aabb.maxx=e.worldCOMx+x,e.aabb.maxy=e.worldCOMy+v}else{var z=n.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var y=z.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=z.lverts.next,m=z.gverts.next;null!=m;){var b=m,g=f;f=f.next,b.x=z.body.posx+(z.body.axisy*g.x-z.body.axisx*g.y),b.y=z.body.posy+(g.x*z.body.axisx+g.y*z.body.axisy),m=m.next}}var w=z.gverts.next;z.aabb.minx=w.x,z.aabb.miny=w.y,z.aabb.maxx=w.x,z.aabb.maxy=w.y;for(var C=z.gverts.next.next;null!=C;){var M=C;z.aabb.minx>M.x&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),z.aabb.miny>M.y&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),C=C.next}}},sync_broadphase:function(){if(this.space.validation(),null!=this.list)for(var n=this.list.next;null!=n;){var e=n.next,t=n.prev;if(t.aabb.minx<n.aabb.minx)n=e;else{for(;null!=t.prev&&t.prev.aabb.minx>n.aabb.minx;)t=t.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==t.prev?(n.prev=null,this.list=n,n.next=t,t.prev=n):(n.prev=t.prev,t.prev=n,n.prev.next=n,n.next=t),n=e}}},sync_broadphase_fast:function(){for(var n=this.list.next;null!=n;){var e=n.next,t=n.prev;if(t.aabb.minx<n.aabb.minx)n=e;else{for(;null!=t.prev&&t.prev.aabb.minx>n.aabb.minx;)t=t.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==t.prev?(n.prev=null,this.list=n,n.next=t,t.prev=n):(n.prev=t.prev,t.prev=n,n.prev.next=n,n.next=t),n=e}}},broadphase:function(n,e){if(null!=this.list){for(var t=this.list.next;null!=t;){var i=t.next,l=t.prev;if(l.aabb.minx<t.aabb.minx)t=i;else{for(;null!=l.prev&&l.prev.aabb.minx>t.aabb.minx;)l=l.prev;var r=t.prev;r.next=t.next,null!=t.next&&(t.next.prev=r),null==l.prev?(t.prev=null,this.list=t,t.next=l,l.prev=t):(t.prev=l.prev,l.prev=t,t.prev.next=t,t.next=l),t=i}}for(var a=this.list;null!=a;){for(var p=a.next,s=a.shape,o=s.body,h=a.aabb.maxx;null!=p&&h>=p.aabb.minx;){var _=p.shape,u=_.body;if(u!=o)if(o.type!=ye.id_BodyType_STATIC||u.type!=ye.id_BodyType_STATIC)if(o.component.sleeping&&u.component.sleeping)p=p.next;else{var d=s.aabb,c=_.aabb;c.miny>d.maxy||d.miny>c.maxy||(e?n.narrowPhase(s,_,o.type!=ye.id_BodyType_DYNAMIC||u.type!=ye.id_BodyType_DYNAMIC,null,!1):n.continuousEvent(s,_,o.type!=ye.id_BodyType_DYNAMIC||u.type!=ye.id_BodyType_DYNAMIC,null,!1)),p=p.next}else p=p.next;else p=p.next}a=a.next}}},clear:function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},shapesUnderPoint:function(n,e,t,i){this.sync_broadphase();var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;for(var r=l,a=null==i?new ne:i,p=this.list;null!=p&&p.aabb.minx>n;)p=p.next;for(;null!=p&&n>=p.aabb.minx;){if(p.aabb.maxx>=n&&e>=p.aabb.miny&&p.aabb.maxy>=e){var s,o=p.shape;if(null!=t){var h=o.filter;s=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else s=!0;s&&(o.type==ye.id_ShapeType_CIRCLE?We.circleContains(o.circle,r)&&a.push(o.outer):We.polyContains(o.polygon,r)&&a.push(o.outer))}p=p.next}var _=r;return null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Ct.zpp_pool,Ct.zpp_pool=_,a},bodiesUnderPoint:function(n,e,t,i){this.sync_broadphase();var l;null==Ct.zpp_pool?l=new Ct:(l=Ct.zpp_pool,Ct.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;for(var r=l,a=null==i?new Ln:i,p=this.list;null!=p&&p.aabb.minx>n;)p=p.next;for(;null!=p&&n>=p.aabb.minx;){if(p.aabb.maxx>=n&&e>=p.aabb.miny&&p.aabb.maxy>=e){var s=p.shape,o=s.body.outer;if(!a.has(o)){var h;if(null!=t){var _=s.filter;h=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else h=!0;h&&(s.type==ye.id_ShapeType_CIRCLE?We.circleContains(s.circle,r)&&a.push(o):We.polyContains(s.polygon,r)&&a.push(o))}}p=p.next}var u=r;return null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Ct.zpp_pool,Ct.zpp_pool=u,a},shapesInAABB:function(n,e,t,i,l){this.sync_broadphase(),this.updateAABBShape(n);for(var r=this.aabbShape.zpp_inner.aabb,a=null==l?new ne:l,p=this.list;null!=p&&r.minx>p.aabb.maxx;)p=p.next;for(;null!=p&&r.maxx>=p.aabb.minx;){var s,o=p.shape;if(null!=i){var h=o.filter;s=0!=(h.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup)}else s=!0;if(s)if(e)if(t)We.containTest(this.aabbShape.zpp_inner,o)&&a.push(o.outer);else{var _=p.aabb;if(r.minx>_.minx||r.miny>_.miny||_.maxx>r.maxx||_.maxy>r.maxy){var u=p.aabb;r.miny>u.maxy||u.miny>r.maxy||r.minx>u.maxx||u.minx>r.maxx||We.testCollide_safe(o,this.aabbShape.zpp_inner)&&a.push(o.outer)}else a.push(o.outer)}else{var d;if(t){var c=p.aabb;d=!(r.minx>c.minx||r.miny>c.miny||c.maxx>r.maxx)&&r.maxy>=c.maxy}else{var x=p.aabb;d=!(r.miny>x.maxy||x.miny>r.maxy||r.minx>x.maxx)&&r.maxx>=x.minx}d&&a.push(o.outer)}p=p.next}return a},failed:null,bodiesInAABB:function(n,e,t,i,l){this.sync_broadphase(),this.updateAABBShape(n);var r=this.aabbShape.zpp_inner.aabb,a=null==l?new Ln:l;null==this.failed&&(this.failed=new Ln);for(var p=this.list;null!=p&&r.minx>p.aabb.maxx;)p=p.next;for(;null!=p&&r.maxx>=p.aabb.minx;){var s=p.shape,o=s.body.outer,h=p.aabb;if(!(r.miny>h.maxy||h.miny>r.maxy||r.minx>h.maxx||h.minx>r.maxx)){var _;if(null!=i){var u=s.filter;_=0!=(u.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup)}else _=!0;if(_)if(e)if(t){if(!this.failed.has(o)){var d=We.containTest(this.aabbShape.zpp_inner,s);!a.has(o)&&d?a.push(o):d||(a.remove(o),this.failed.push(o))}}else!a.has(o)&&We.testCollide_safe(s,this.aabbShape.zpp_inner)&&a.push(o);else if(t){if(!this.failed.has(o)){var c=s.aabb,x=!(r.minx>c.minx||r.miny>c.miny||c.maxx>r.maxx||c.maxy>r.maxy);!a.has(o)&&x?a.push(o):x||(a.remove(o),this.failed.push(o))}}else{var v;if(a.has(o))v=!1;else{var z=s.aabb;v=!(r.minx>z.minx||r.miny>z.miny||z.maxx>r.maxx)&&r.maxy>=z.maxy}v&&a.push(o)}}p=p.next}return this.failed.clear(),a},shapesInCircle:function(n,e,t,i,l,r){this.sync_broadphase(),this.updateCircShape(n,e,t);for(var a=this.circShape.zpp_inner.aabb,p=null==r?new ne:r,s=this.list;null!=s&&a.minx>s.aabb.maxx;)s=s.next;for(;null!=s&&a.maxx>=s.aabb.minx;){var o=s.aabb;if(!(a.miny>o.maxy||o.miny>a.maxy||a.minx>o.maxx||o.minx>a.maxx)){var h,_=s.shape;if(null!=l){var u=_.filter;h=0!=(u.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&u.collisionGroup)}else h=!0;h&&(i?We.containTest(this.circShape.zpp_inner,_)&&p.push(_.outer):We.testCollide_safe(_,this.circShape.zpp_inner)&&p.push(_.outer))}s=s.next}return p},bodiesInCircle:function(n,e,t,i,l,r){this.sync_broadphase(),this.updateCircShape(n,e,t);var a=this.circShape.zpp_inner.aabb,p=null==r?new Ln:r;null==this.failed&&(this.failed=new Ln);for(var s=this.list;null!=s&&a.minx>s.aabb.maxx;)s=s.next;for(;null!=s&&a.maxx>=s.aabb.minx;){var o=s.aabb;if(!(a.miny>o.maxy||o.miny>a.maxy||a.minx>o.maxx||o.minx>a.maxx)){var h,_=s.shape,u=_.body.outer;if(null!=l){var d=_.filter;h=0!=(d.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&d.collisionGroup)}else h=!0;if(h)if(i){if(!this.failed.has(u)){var c=We.containTest(this.circShape.zpp_inner,_);!p.has(u)&&c?p.push(u):c||(p.remove(u),this.failed.push(u))}}else!p.has(u)&&We.testCollide_safe(_,this.circShape.zpp_inner)&&p.push(u)}s=s.next}return this.failed.clear(),p},shapesInShape:function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);for(var l=n.aabb,r=null==i?new ne:i,a=this.list;null!=a&&l.minx>a.aabb.maxx;)a=a.next;for(;null!=a&&l.maxx>=a.aabb.minx;){var p=a.aabb;if(!(l.miny>p.maxy||p.miny>l.maxy||l.minx>p.maxx||p.minx>l.maxx)){var s,o=a.shape;if(null!=t){var h=o.filter;s=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else s=!0;s&&(e?We.containTest(n,o)&&r.push(o.outer):We.testCollide_safe(o,n)&&r.push(o.outer))}a=a.next}return r},bodiesInShape:function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,r=null==i?new Ln:i;null==this.failed&&(this.failed=new Ln);for(var a=this.list;null!=a&&l.minx>a.aabb.maxx;)a=a.next;for(;null!=a&&l.maxx>=a.aabb.minx;){var p=a.aabb;if(!(l.miny>p.maxy||p.miny>l.maxy||l.minx>p.maxx||p.minx>l.maxx)){var s,o=a.shape,h=o.body.outer;if(null!=t){var _=o.filter;s=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else s=!0;if(s)if(e){if(!this.failed.has(h)){var u=We.containTest(n,o);!r.has(h)&&u?r.push(h):u||(r.remove(h),this.failed.push(h))}}else!r.has(h)&&We.testCollide_safe(n,o)&&r.push(h)}a=a.next}return this.failed.clear(),r},rayCast:function(n,e,t){this.sync_broadphase(),n.validate_dir();var i=n.rayAABB(),l=n.maxdist,r=null;if(0==n.dirx)for(var a=this.list;null!=a&&i.minx>=a.aabb.minx;){var p,s=a.aabb;if(i.miny>s.maxy||s.miny>i.maxy||i.minx>s.maxx||s.minx>i.maxx)p=!1;else if(null!=t){var o=a.shape.filter;p=0!=(o.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&o.collisionGroup)}else p=!0;if(p){var h=n.aabbsect(a.aabb);if(h>=0&&l>h){var _=a.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect(a.shape.circle,e,l):n.polysect(a.shape.polygon,e,l);null!=_&&(l=_.zpp_inner.toiDistance,null!=r&&r.zpp_inner.free(),r=_)}}a=a.next}else if(0>n.dirx){for(var u=this.list,d=null;null!=u&&i.maxx>=u.aabb.minx;)d=u,u=u.next;for(u=d;null!=u;){var c,x=u.aabb;if(i.miny>x.maxy||x.miny>i.maxy||i.minx>x.maxx||x.minx>i.maxx)c=!1;else if(null!=t){var v=u.shape.filter;c=0!=(v.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&v.collisionGroup)}else c=!0;if(c){var z=n.aabbsect(u.aabb);if(z>=0&&l>z){var y=u.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect(u.shape.circle,e,l):n.polysect(u.shape.polygon,e,l);null!=y&&(l=y.zpp_inner.toiDistance,null!=r&&r.zpp_inner.free(),r=y)}}u=u.prev}}else for(var f=this.list;null!=f&&i.maxx>=f.aabb.minx&&n.originx+n.dirx*l>f.aabb.minx;){var m,b=f.aabb;if(i.miny>b.maxy||b.miny>i.maxy||i.minx>b.maxx||b.minx>i.maxx)m=!1;else if(null!=t){var g=f.shape.filter;m=0!=(g.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&g.collisionGroup)}else m=!0;if(m){var w=n.aabbsect(f.aabb);if(w>=0&&l>w){var C=f.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect(f.shape.circle,e,l):n.polysect(f.shape.polygon,e,l);null!=C&&(l=C.zpp_inner.toiDistance,null!=r&&r.zpp_inner.free(),r=C)}}f=f.next}var M=i;return null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M.wrap_min=M.wrap_max=null,M._invalidate=null,M._validate=null,M.next=Ze.zpp_pool,Ze.zpp_pool=M,r},rayMultiCast:function(n,e,t,i){this.sync_broadphase(),n.validate_dir();var l=n.rayAABB(),r=null==i?new kn:i;if(0==n.dirx)for(var a=this.list;null!=a&&l.minx>=a.aabb.minx;){var p,s=a.aabb;if(l.miny>s.maxy||s.miny>l.maxy||l.minx>s.maxx||s.minx>l.maxx)p=!1;else if(null!=t){var o=a.shape.filter;p=0!=(o.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&o.collisionGroup)}else p=!0;if(p){var h=n.aabbsect(a.aabb);0>h||(a.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect2(a.shape.circle,e,r):n.polysect2(a.shape.polygon,e,r))}a=a.next}else if(0>n.dirx){for(var _=this.list,u=null;null!=_&&l.maxx>=_.aabb.minx;)u=_,_=_.next;for(_=u;null!=_;){var d,c=_.aabb;if(l.miny>c.maxy||c.miny>l.maxy||l.minx>c.maxx||c.minx>l.maxx)d=!1;else if(null!=t){var x=_.shape.filter;d=0!=(x.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&x.collisionGroup)}else d=!0;if(d){var v=n.aabbsect(_.aabb);0>v||(_.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect2(_.shape.circle,e,r):n.polysect2(_.shape.polygon,e,r))}_=_.prev}}else for(var z=this.list;null!=z&&l.maxx>=z.aabb.minx;){var y,f=z.aabb;if(l.miny>f.maxy||f.miny>l.maxy||l.minx>f.maxx||f.minx>l.maxx)y=!1;else if(null!=t){var m=z.shape.filter;y=0!=(m.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&m.collisionGroup)}else y=!0;if(y){var b=n.aabbsect(z.aabb);0>b||(z.shape.type==ye.id_ShapeType_CIRCLE?n.circlesect2(z.shape.circle,e,r):n.polysect2(z.shape.polygon,e,r))}z=z.next}var g=l;return null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g.wrap_min=g.wrap_max=null,g._invalidate=null,g._validate=null,g.next=Ze.zpp_pool,Ze.zpp_pool=g,r},__class__:Wt});var Xt=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_Float"]=Xt,Xt.__name__=["zpp_nape","util","ZNPArray2_Float"],Xt.prototype={list:null,width:null,resize:function(n,e,t){this.width=n;for(var i=0,l=n*e;l>i;){this.list[i++]=t}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,t){return this.list[e*this.width+n]=t},__class__:Xt};var Ht=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_ZPP_GeomVert"]=Ht,Ht.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],Ht.prototype={list:null,width:null,resize:function(n,e,t){this.width=n;for(var i=0,l=n*e;l>i;){this.list[i++]=t}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,t){return this.list[e*this.width+n]=t},__class__:Ht};var Kt=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_ZPP_MarchPair"]=Kt,Kt.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],Kt.prototype={list:null,width:null,resize:function(n,e,t){this.width=n;for(var i=0,l=n*e;l>i;){this.list[i++]=t}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,t){return this.list[e*this.width+n]=t},__class__:Kt};var Jt=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};l["zpp_nape.util.Hashable2_Boolfalse"]=Jt,Jt.__name__=["zpp_nape","util","Hashable2_Boolfalse"],Jt.get=function(n,e,t){var i;null==Jt.zpp_pool?i=new Jt:(i=Jt.zpp_pool,Jt.zpp_pool=i.next,i.next=null),i.id=n,i.di=e;var l=i;return l.value=t,l},Jt.getpersist=function(n,e){var t;return null==Jt.zpp_pool?t=new Jt:(t=Jt.zpp_pool,Jt.zpp_pool=t.next,t.next=null),t.id=n,t.di=e,t},Jt.ordered_get=function(n,e,t){if(n>e){var i;null==Jt.zpp_pool?i=new Jt:(i=Jt.zpp_pool,Jt.zpp_pool=i.next,i.next=null),i.id=e,i.di=n;var l=i;return l.value=t,l}var r;null==Jt.zpp_pool?r=new Jt:(r=Jt.zpp_pool,Jt.zpp_pool=r.next,r.next=null),r.id=n,r.di=e;var a=r;return a.value=t,a},Jt.ordered_get_persist=function(n,e){if(n>e){var t;return null==Jt.zpp_pool?t=new Jt:(t=Jt.zpp_pool,Jt.zpp_pool=t.next,t.next=null),t.id=e,t.di=n,t}var i;return null==Jt.zpp_pool?i=new Jt:(i=Jt.zpp_pool,Jt.zpp_pool=i.next,i.next=null),i.id=n,i.di=e,i},Jt.prototype={value:null,next:null,hnext:null,id:null,di:null,free:function(){},alloc:function(){},__class__:Jt};var Qt=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var n=0;1048576>n;){n++;this.table.push(null)}};l["zpp_nape.util.FastHash2_Hashable2_Boolfalse"]=Qt,Qt.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],Qt.prototype={table:null,cnt:null,empty:function(){return 0==this.cnt},clear:function(){for(var n=0,e=this.table.length;e>n;){var t=n++,i=this.table[t];if(null!=i){for(;null!=i;){var l=i.hnext;i.hnext=null,i=l}this.table[t]=null}}},get:function(n,e){var t=this.table[106039*n+e&1048575];if(null==t)return null;if(t.id==n&&t.di==e)return t;for(;;)if(null==(t=t.hnext)||t.id==n&&t.di==e)break;return t},ordered_get:function(n,e){if(n>e){var t=n;n=e,e=t}var i=this.table[106039*n+e&1048575];if(null==i)return null;if(i.id==n&&i.di==e)return i;for(;;)if(null==(i=i.hnext)||i.id==n&&i.di==e)break;return i},has:function(n,e){var t=this.table[106039*n+e&1048575];if(null==t)return!1;if(t.id==n&&t.di==e)return!0;for(;;)if(null==(t=t.hnext)||t.id==n&&t.di==e)break;return null!=t},maybeAdd:function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];null==t?(this.table[e]=n,n.hnext=null):(n.hnext=t.hnext,t.hnext=n),this.cnt++},add:function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];null==t?(this.table[e]=n,n.hnext=null):(n.hnext=t.hnext,t.hnext=n),this.cnt++},remove:function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];if(t==n)this.table[e]=t.hnext;else if(null!=t){for(var i;;)if(i=t,null==(t=t.hnext)||t==n)break;i.hnext=t.hnext}n.hnext=null,this.cnt--},hash:function(n,e){return 106039*n+e&1048575},__class__:Qt};var $t=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CallbackSet"]=$t,$t.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],$t.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Oi.zpp_pool?e=new Oi:(e=Oi.zpp_pool,Oi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Oi.zpp_pool?e=new Oi:(e=Oi.zpp_pool,Oi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Oi.zpp_pool?t=new Oi:(t=Oi.zpp_pool,Oi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Oi.zpp_pool?t=new Oi:(t=Oi.zpp_pool,Oi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Oi.zpp_pool,Oi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Oi.zpp_pool,Oi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Oi.zpp_pool,Oi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Oi.zpp_pool,Oi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Oi.zpp_pool,Oi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Oi.zpp_pool,Oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Oi.zpp_pool,Oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Oi.zpp_pool,Oi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Oi.zpp_pool,Oi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:$t};var ni=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Shape"]=ni,ni.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],ni.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Si.zpp_pool?e=new Si:(e=Si.zpp_pool,Si.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Si.zpp_pool?e=new Si:(e=Si.zpp_pool,Si.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Si.zpp_pool?t=new Si:(t=Si.zpp_pool,Si.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Si.zpp_pool?t=new Si:(t=Si.zpp_pool,Si.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Si.zpp_pool,Si.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Si.zpp_pool,Si.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Si.zpp_pool,Si.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Si.zpp_pool,Si.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Si.zpp_pool,Si.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Si.zpp_pool,Si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Si.zpp_pool,Si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Si.zpp_pool,Si.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Si.zpp_pool,Si.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ni};var ei=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Body"]=ei,ei.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],ei.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Pi.zpp_pool?e=new Pi:(e=Pi.zpp_pool,Pi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Pi.zpp_pool?e=new Pi:(e=Pi.zpp_pool,Pi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Pi.zpp_pool?t=new Pi:(t=Pi.zpp_pool,Pi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Pi.zpp_pool?t=new Pi:(t=Pi.zpp_pool,Pi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pi.zpp_pool,Pi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pi.zpp_pool,Pi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Pi.zpp_pool,Pi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Pi.zpp_pool,Pi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Pi.zpp_pool,Pi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Pi.zpp_pool,Pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Pi.zpp_pool,Pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pi.zpp_pool,Pi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pi.zpp_pool,Pi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ei};var ti=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Compound"]=ti,ti.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],ti.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ai.zpp_pool?e=new Ai:(e=Ai.zpp_pool,Ai.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ai.zpp_pool?e=new Ai:(e=Ai.zpp_pool,Ai.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ai.zpp_pool?t=new Ai:(t=Ai.zpp_pool,Ai.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ai.zpp_pool?t=new Ai:(t=Ai.zpp_pool,Ai.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ai.zpp_pool,Ai.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ai.zpp_pool,Ai.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ai.zpp_pool,Ai.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ai.zpp_pool,Ai.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ai.zpp_pool,Ai.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ai.zpp_pool,Ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ai.zpp_pool,Ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ai.zpp_pool,Ai.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ai.zpp_pool,Ai.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ti};var ii=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Arbiter"]=ii,ii.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],ii.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ni.zpp_pool?e=new Ni:(e=Ni.zpp_pool,Ni.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ni.zpp_pool?e=new Ni:(e=Ni.zpp_pool,Ni.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ni.zpp_pool?t=new Ni:(t=Ni.zpp_pool,Ni.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ni.zpp_pool?t=new Ni:(t=Ni.zpp_pool,Ni.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ni.zpp_pool,Ni.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ni.zpp_pool,Ni.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ni.zpp_pool,Ni.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ni.zpp_pool,Ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ni.zpp_pool,Ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ni.zpp_pool,Ni.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ni.zpp_pool,Ni.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ii};var li=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbSetPair"]=li,li.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],li.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==ji.zpp_pool?e=new ji:(e=ji.zpp_pool,ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==ji.zpp_pool?e=new ji:(e=ji.zpp_pool,ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==ji.zpp_pool?t=new ji:(t=ji.zpp_pool,ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==ji.zpp_pool?t=new ji:(t=ji.zpp_pool,ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ji.zpp_pool,ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ji.zpp_pool,ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ji.zpp_pool,ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ji.zpp_pool,ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=ji.zpp_pool,ji.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ji.zpp_pool,ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ji.zpp_pool,ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ji.zpp_pool,ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ji.zpp_pool,ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:li};var ri=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CutInt"]=ri,ri.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],ri.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Fi.zpp_pool?e=new Fi:(e=Fi.zpp_pool,Fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Fi.zpp_pool?e=new Fi:(e=Fi.zpp_pool,Fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Fi.zpp_pool,Fi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Fi.zpp_pool,Fi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Fi.zpp_pool,Fi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Fi.zpp_pool,Fi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Fi.zpp_pool,Fi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Fi.zpp_pool,Fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Fi.zpp_pool,Fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Fi.zpp_pool,Fi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Fi.zpp_pool,Fi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ri};var ai=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CutVert"]=ai,ai.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],ai.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Bi.zpp_pool?e=new Bi:(e=Bi.zpp_pool,Bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Bi.zpp_pool?e=new Bi:(e=Bi.zpp_pool,Bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Bi.zpp_pool,Bi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Bi.zpp_pool,Bi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Bi.zpp_pool,Bi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Bi.zpp_pool,Bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Bi.zpp_pool,Bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bi.zpp_pool,Bi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ai};var pi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_PartitionVertex"]=pi,pi.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],pi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ri.zpp_pool?e=new Ri:(e=Ri.zpp_pool,Ri.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ri.zpp_pool?e=new Ri:(e=Ri.zpp_pool,Ri.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ri.zpp_pool,Ri.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ri.zpp_pool,Ri.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ri.zpp_pool,Ri.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ri.zpp_pool,Ri.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ri.zpp_pool,Ri.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ri.zpp_pool,Ri.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ri.zpp_pool,Ri.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ri.zpp_pool,Ri.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ri.zpp_pool,Ri.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:pi};var si=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_PartitionedPoly"]=si,si.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],si.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Gi.zpp_pool?e=new Gi:(e=Gi.zpp_pool,Gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Gi.zpp_pool?e=new Gi:(e=Gi.zpp_pool,Gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Gi.zpp_pool,Gi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Gi.zpp_pool,Gi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Gi.zpp_pool,Gi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Gi.zpp_pool,Gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Gi.zpp_pool,Gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gi.zpp_pool,Gi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:si};var oi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_GeomVert"]=oi,oi.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],oi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yi.zpp_pool,Yi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yi.zpp_pool,Yi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Yi.zpp_pool,Yi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Yi.zpp_pool,Yi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Yi.zpp_pool,Yi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yi.zpp_pool,Yi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yi.zpp_pool,Yi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:oi};var hi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimplifyP"]=hi,hi.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],hi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ui.zpp_pool,Ui.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ui.zpp_pool,Ui.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ui.zpp_pool,Ui.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ui.zpp_pool,Ui.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ui.zpp_pool,Ui.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ui.zpp_pool,Ui.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ui.zpp_pool,Ui.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:hi};var _i=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimpleVert"]=_i,_i.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],_i.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Zi.zpp_pool,Zi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Zi.zpp_pool,Zi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Zi.zpp_pool,Zi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zi.zpp_pool,Zi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:_i};var ui=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimpleEvent"]=ui,ui.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],ui.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qi.zpp_pool,qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qi.zpp_pool,qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=qi.zpp_pool,qi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=qi.zpp_pool,qi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=qi.zpp_pool,qi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qi.zpp_pool,qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qi.zpp_pool,qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ui};var di=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_AABBPair"]=di,di.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],di.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wi.zpp_pool,Wi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wi.zpp_pool,Wi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Wi.zpp_pool,Wi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Wi.zpp_pool,Wi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Wi.zpp_pool,Wi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wi.zpp_pool,Wi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wi.zpp_pool,Wi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:di};var ci=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Edge"]=ci,ci.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],ci.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Xi.zpp_pool?e=new Xi:(e=Xi.zpp_pool,Xi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Xi.zpp_pool?e=new Xi:(e=Xi.zpp_pool,Xi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Xi.zpp_pool?t=new Xi:(t=Xi.zpp_pool,Xi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Xi.zpp_pool?t=new Xi:(t=Xi.zpp_pool,Xi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xi.zpp_pool,Xi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xi.zpp_pool,Xi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Xi.zpp_pool,Xi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Xi.zpp_pool,Xi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Xi.zpp_pool,Xi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Xi.zpp_pool,Xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Xi.zpp_pool,Xi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xi.zpp_pool,Xi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xi.zpp_pool,Xi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ci};var xi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Component"]=xi,xi.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],xi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ki.zpp_pool,Ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ki.zpp_pool,Ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ki.zpp_pool,Ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ki.zpp_pool,Ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ki.zpp_pool,Ki.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ki.zpp_pool,Ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ki.zpp_pool,Ki.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:xi};var vi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_AABBNode"]=vi,vi.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],vi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Ji.zpp_pool?t=new Ji:(t=Ji.zpp_pool,Ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Ji.zpp_pool?t=new Ji:(t=Ji.zpp_pool,Ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ji.zpp_pool,Ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ji.zpp_pool,Ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ji.zpp_pool,Ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Ji.zpp_pool,Ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Ji.zpp_pool,Ji.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ji.zpp_pool,Ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ji.zpp_pool,Ji.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:vi};var zi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_InteractionGroup"]=zi,zi.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],zi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Qi.zpp_pool?e=new Qi:(e=Qi.zpp_pool,Qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Qi.zpp_pool?e=new Qi:(e=Qi.zpp_pool,Qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==Qi.zpp_pool?t=new Qi:(t=Qi.zpp_pool,Qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==Qi.zpp_pool?t=new Qi:(t=Qi.zpp_pool,Qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qi.zpp_pool,Qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qi.zpp_pool,Qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Qi.zpp_pool,Qi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=Qi.zpp_pool,Qi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=Qi.zpp_pool,Qi.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Qi.zpp_pool,Qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Qi.zpp_pool,Qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qi.zpp_pool,Qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qi.zpp_pool,Qi.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:zi};var yi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_FluidArbiter"]=yi,yi.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],yi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==$i.zpp_pool?e=new $i:(e=$i.zpp_pool,$i.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==$i.zpp_pool?e=new $i:(e=$i.zpp_pool,$i.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==$i.zpp_pool?t=new $i:(t=$i.zpp_pool,$i.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==$i.zpp_pool?t=new $i:(t=$i.zpp_pool,$i.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$i.zpp_pool,$i.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$i.zpp_pool,$i.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=$i.zpp_pool,$i.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=$i.zpp_pool,$i.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=$i.zpp_pool,$i.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=$i.zpp_pool,$i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=$i.zpp_pool,$i.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$i.zpp_pool,$i.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$i.zpp_pool,$i.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:yi};var fi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SensorArbiter"]=fi,fi.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],fi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==nl.zpp_pool?e=new nl:(e=nl.zpp_pool,nl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==nl.zpp_pool?e=new nl:(e=nl.zpp_pool,nl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==nl.zpp_pool?t=new nl:(t=nl.zpp_pool,nl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==nl.zpp_pool?t=new nl:(t=nl.zpp_pool,nl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=nl.zpp_pool,nl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=nl.zpp_pool,nl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=nl.zpp_pool,nl.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=nl.zpp_pool,nl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=nl.zpp_pool,nl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:fi};var mi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ColArbiter"]=mi,mi.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],mi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==el.zpp_pool?e=new el:(e=el.zpp_pool,el.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==el.zpp_pool?e=new el:(e=el.zpp_pool,el.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==el.zpp_pool?t=new el:(t=el.zpp_pool,el.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==el.zpp_pool?t=new el:(t=el.zpp_pool,el.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=el.zpp_pool,el.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=el.zpp_pool,el.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=el.zpp_pool,el.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=el.zpp_pool,el.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=el.zpp_pool,el.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:mi};var bi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Listener"]=bi,bi.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],bi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==tl.zpp_pool?e=new tl:(e=tl.zpp_pool,tl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==tl.zpp_pool?e=new tl:(e=tl.zpp_pool,tl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==tl.zpp_pool?t=new tl:(t=tl.zpp_pool,tl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==tl.zpp_pool?t=new tl:(t=tl.zpp_pool,tl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=tl.zpp_pool,tl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=tl.zpp_pool,tl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=tl.zpp_pool,tl.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=tl.zpp_pool,tl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=tl.zpp_pool,tl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:bi};var gi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ToiEvent"]=gi,gi.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],gi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==il.zpp_pool?e=new il:(e=il.zpp_pool,il.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==il.zpp_pool?e=new il:(e=il.zpp_pool,il.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==il.zpp_pool?t=new il:(t=il.zpp_pool,il.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==il.zpp_pool?t=new il:(t=il.zpp_pool,il.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=il.zpp_pool,il.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=il.zpp_pool,il.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=il.zpp_pool,il.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=il.zpp_pool,il.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=il.zpp_pool,il.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:gi};var wi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ConvexResult"]=wi,wi.__name__=["zpp_nape","util","ZNPList_ConvexResult"],wi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==ll.zpp_pool?e=new ll:(e=ll.zpp_pool,ll.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==ll.zpp_pool?e=new ll:(e=ll.zpp_pool,ll.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==ll.zpp_pool?t=new ll:(t=ll.zpp_pool,ll.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==ll.zpp_pool?t=new ll:(t=ll.zpp_pool,ll.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ll.zpp_pool,ll.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=ll.zpp_pool,ll.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=ll.zpp_pool,ll.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ll.zpp_pool,ll.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ll.zpp_pool,ll.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:wi};var Ci=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_GeomPoly"]=Ci,Ci.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],Ci.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==rl.zpp_pool?e=new rl:(e=rl.zpp_pool,rl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==rl.zpp_pool?e=new rl:(e=rl.zpp_pool,rl.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==rl.zpp_pool?t=new rl:(t=rl.zpp_pool,rl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==rl.zpp_pool?t=new rl:(t=rl.zpp_pool,rl.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=rl.zpp_pool,rl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=rl.zpp_pool,rl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=rl.zpp_pool,rl.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=rl.zpp_pool,rl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=rl.zpp_pool,rl.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:Ci};var Mi=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_RayResult"]=Mi,Mi.__name__=["zpp_nape","util","ZNPList_RayResult"],Mi.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==al.zpp_pool?e=new al:(e=al.zpp_pool,al.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==al.zpp_pool?e=new al:(e=al.zpp_pool,al.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var t;null==al.zpp_pool?t=new al:(t=al.zpp_pool,al.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){var t;null==al.zpp_pool?t=new al:(t=al.zpp_pool,al.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=al.zpp_pool,al.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=al.zpp_pool,al.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=al.zpp_pool,al.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},inlined_remove:function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,l;null==e?(i=this.head,l=i.next,null==(this.head=l)&&(this.pushmod=!0)):(i=e.next,l=i.next,e.next=l,null==l&&(this.pushmod=!0));var r=i;r.elt=null,r.next=al.zpp_pool,al.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=t,t=t.next}},inlined_try_remove:function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var l,r;null==e?(l=this.head,r=l.next,null==(this.head=r)&&(this.pushmod=!0)):(l=e.next,r=l.next,e.next=r,null==r&&(this.pushmod=!0));var a=l;a.elt=null,a.next=al.zpp_pool,al.zpp_pool=a,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=al.zpp_pool,al.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},inlined_erase:function(n){var e,t;null==n?(e=this.head,t=e.next,null==(this.head=t)&&(this.pushmod=!0)):(e=n.next,t=e.next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=al.zpp_pool,al.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=al.zpp_pool,al.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=al.zpp_pool,al.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},inlined_has:function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:Mi};var ki=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbType"]=ki,ki.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],ki.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:ki};var Oi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CallbackSet"]=Oi,Oi.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],Oi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Oi};var Si=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Shape"]=Si,Si.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],Si.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Si};var Pi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Body"]=Pi,Pi.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],Pi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Pi};var Ti=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Constraint"]=Ti,Ti.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],Ti.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ti};var Ai=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Compound"]=Ai,Ai.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],Ai.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ai};var Ei=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_InteractionListener"]=Ei,Ei.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],Ei.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ei};var Ii=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbSet"]=Ii,Ii.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],Ii.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ii};var Vi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Interactor"]=Vi,Vi.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],Vi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Vi};var Li=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_BodyListener"]=Li,Li.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Li.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Li};var Ni=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Arbiter"]=Ni,Ni.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],Ni.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ni};var Di=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ConstraintListener"]=Di,Di.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],Di.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Di};var ji=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbSetPair"]=ji,ji.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],ji.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:ji};var Fi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CutInt"]=Fi,Fi.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],Fi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Fi};var Bi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CutVert"]=Bi,Bi.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],Bi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Bi};var Ri=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_PartitionVertex"]=Ri,Ri.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],Ri.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ri};var Gi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_PartitionedPoly"]=Gi,Gi.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],Gi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Gi};var Yi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_GeomVert"]=Yi,Yi.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],Yi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Yi};var Ui=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimplifyP"]=Ui,Ui.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],Ui.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ui};var Zi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimpleVert"]=Zi,Zi.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],Zi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Zi};var qi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimpleEvent"]=qi,qi.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],qi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:qi};var Wi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_AABBPair"]=Wi,Wi.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],Wi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Wi};var Xi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Edge"]=Xi,Xi.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],Xi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Xi};var Hi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Vec2"]=Hi,Hi.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],Hi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Hi};var Ki=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Component"]=Ki,Ki.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],Ki.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ki};var Ji=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_AABBNode"]=Ji,Ji.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],Ji.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ji};var Qi=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_InteractionGroup"]=Qi,Qi.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],Qi.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Qi};var $i=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_FluidArbiter"]=$i,$i.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],$i.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:$i};var nl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SensorArbiter"]=nl,nl.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],nl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:nl};var el=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ColArbiter"]=el,el.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],el.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:el};var tl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Listener"]=tl,tl.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],tl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:tl};var il=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ToiEvent"]=il,il.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],il.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:il};var ll=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ConvexResult"]=ll,ll.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],ll.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:ll};var rl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_GeomPoly"]=rl,rl.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],rl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:rl};var al=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_RayResult"]=al,al.__name__=["zpp_nape","util","ZNPNode_RayResult"],al.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:al};var pl=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,Pn.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};l["zpp_nape.util.ZPP_MixVec2List"]=pl,pl.__name__=["zpp_nape","util","ZPP_MixVec2List"],pl.get=function(n,e){null==e&&(e=!1);var t=new pl;return t.inner=n,t.zpp_inner.immutable=e,t},pl.__super__=Pn,pl.prototype=e(Pn.prototype,{inner:null,_length:null,zip_length:null,at_ite:null,at_index:null,zpp_gl:function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=this.inner.next;null!=n;){this._length++,n=n.next}this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.at_index>n||null==this.at_ite)for(this.at_index=0,this.at_ite=this.inner.next;;){break}for(;this.at_index!=n;)for(this.at_index++,this.at_ite=this.at_ite.next;;){break}var e=this.at_ite;if(null==e.outer){e.outer=new On;var t=e.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ct.zpp_pool,Ct.zpp_pool=t,e.outer.zpp_inner=e}return e.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.inner.add(n.zpp_inner);else{this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner)}else this.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(n=this.inner.next,null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Ct.zpp_pool,Ct.zpp_pool=e,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.pop()}else{null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var i=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(n=null==i?this.inner.next:i.next,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,n.outer.zpp_inner=n}var r=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.inner.erase(i)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var a=n.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,n.outer.zpp_inner=n}return n.outer},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var e=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(n=null==e?this.inner.next:e.next,null==n.outer){n.outer=new On;var t=n.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Ct.zpp_pool,Ct.zpp_pool=t,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.inner.erase(e)}else{if(n=this.inner.next,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Ct.zpp_pool,Ct.zpp_pool=l,n.outer.zpp_inner=n}var r=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var a=n.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Ct.zpp_pool,Ct.zpp_pool=a,n.outer.zpp_inner=n}return n.outer},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var t=this.inner.next;null!=t;){if(n.zpp_inner==t){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},__class__:pl});var sl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ce,this._invalidated=!0};l["zpp_nape.util.ZPP_ConstraintList"]=sl,sl.__name__=["zpp_nape","util","ZPP_ConstraintList"],sl.get=function(n,e){null==e&&(e=!1);var t=new Y;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},sl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:sl};var ol=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ei,this._invalidated=!0};l["zpp_nape.util.ZPP_BodyList"]=ol,ol.__name__=["zpp_nape","util","ZPP_BodyList"],ol.get=function(n,e){null==e&&(e=!1);var t=new Ln;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ol.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ol};var hl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new xe,this._invalidated=!0};l["zpp_nape.util.ZPP_InteractorList"]=hl,hl.__name__=["zpp_nape","util","ZPP_InteractorList"],hl.get=function(n,e){null==e&&(e=!1);var t=new Un;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},hl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:hl};var _l=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ti,this._invalidated=!0};l["zpp_nape.util.ZPP_CompoundList"]=_l,_l.__name__=["zpp_nape","util","ZPP_CompoundList"],_l.get=function(n,e){null==e&&(e=!1);var t=new Fn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},_l.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:_l};var ul=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new bi,this._invalidated=!0};l["zpp_nape.util.ZPP_ListenerList"]=ul,ul.__name__=["zpp_nape","util","ZPP_ListenerList"],ul.get=function(n,e){null==e&&(e=!1);var t=new V;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ul.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ul};var dl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ge,this._invalidated=!0};l["zpp_nape.util.ZPP_CbTypeList"]=dl,dl.__name__=["zpp_nape","util","ZPP_CbTypeList"],dl.get=function(n,e){null==e&&(e=!1);var t=new O;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},dl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:dl};var cl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new qe,this._invalidated=!0};l["zpp_nape.util.ZPP_Vec2List"]=cl,cl.__name__=["zpp_nape","util","ZPP_Vec2List"],cl.get=function(n,e){null==e&&(e=!1);var t=new Pn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},cl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:cl};var xl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ci,this._invalidated=!0};l["zpp_nape.util.ZPP_GeomPolyList"]=xl,xl.__name__=["zpp_nape","util","ZPP_GeomPolyList"],xl.get=function(n,e){null==e&&(e=!1);var t=new yn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},xl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:xl};var vl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Mi,this._invalidated=!0};l["zpp_nape.util.ZPP_RayResultList"]=vl,vl.__name__=["zpp_nape","util","ZPP_RayResultList"],vl.get=function(n,e){null==e&&(e=!1);var t=new kn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},vl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:vl};var zl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new wi,this._invalidated=!0};l["zpp_nape.util.ZPP_ConvexResultList"]=zl,zl.__name__=["zpp_nape","util","ZPP_ConvexResultList"],zl.get=function(n,e){null==e&&(e=!1);var t=new cn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},zl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:zl};var yl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ci,this._invalidated=!0};l["zpp_nape.util.ZPP_EdgeList"]=yl,yl.__name__=["zpp_nape","util","ZPP_EdgeList"],yl.get=function(n,e){null==e&&(e=!1);var t=new Jn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},yl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:yl};var fl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ni,this._invalidated=!0};l["zpp_nape.util.ZPP_ShapeList"]=fl,fl.__name__=["zpp_nape","util","ZPP_ShapeList"],fl.get=function(n,e){null==e&&(e=!1);var t=new ne;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},fl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:fl};var ml=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new zi,this._invalidated=!0};l["zpp_nape.util.ZPP_InteractionGroupList"]=ml,ml.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],ml.get=function(n,e){null==e&&(e=!1);var t=new hn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ml.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ml};var bl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ii,this._invalidated=!0};l["zpp_nape.util.ZPP_ArbiterList"]=bl,bl.__name__=["zpp_nape","util","ZPP_ArbiterList"],bl.get=function(n,e){null==e&&(e=!1);var t=new $;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},bl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:bl};var gl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Be,this._invalidated=!0};l["zpp_nape.util.ZPP_ContactList"]=gl,gl.__name__=["zpp_nape","util","ZPP_ContactList"],gl.get=function(n,e){null==e&&(e=!1);var t=new rn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},gl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:gl};var wl=function(){};l["zpp_nape.util.ZPP_Math"]=wl,wl.__name__=["zpp_nape","util","ZPP_Math"],wl.sqrt=function(n){return Math.sqrt(n)},wl.invsqrt=function(n){return 1/Math.sqrt(n)},wl.sqr=function(n){return n*n},wl.clamp2=function(n,e){var t=-e;return t>n?t:n>e?e:n},wl.clamp=function(n,e,t){return e>n?e:n>t?t:n};var Cl=function(){};l["zpp_nape.util.ZPP_PubPool"]=Cl,Cl.__name__=["zpp_nape","util","ZPP_PubPool"];var Ml=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_Body"]=Ml,Ml.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],Ml.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Ml.zpp_pool,Ml.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Ml.zpp_pool,Ml.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Ml.zpp_pool,Ml.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Ml.zpp_pool,Ml.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Ml.zpp_pool?e=new Ml:(e=Ml.zpp_pool,Ml.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Ml};var kl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_CbSetPair"]=kl,kl.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],kl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=kl.zpp_pool,kl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=kl.zpp_pool,kl.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=kl.zpp_pool,kl.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=kl.zpp_pool,kl.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:kl};var Ol=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_PartitionVertex"]=Ol,Ol.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],Ol.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Ol.zpp_pool,Ol.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Ol.zpp_pool,Ol.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Ol.zpp_pool,Ol.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Ol.zpp_pool,Ol.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Ol};var Sl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_PartitionPair"]=Sl,Sl.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],Sl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Sl.zpp_pool,Sl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Sl.zpp_pool,Sl.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Sl.zpp_pool,Sl.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Sl.zpp_pool,Sl.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Sl};var Pl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleVert"]=Pl,Pl.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],Pl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Pl.zpp_pool,Pl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Pl.zpp_pool,Pl.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Pl.zpp_pool,Pl.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Pl.zpp_pool,Pl.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Pl};var Tl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleSeg"]=Tl,Tl.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],Tl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Tl.zpp_pool,Tl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Tl.zpp_pool,Tl.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Tl.zpp_pool,Tl.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Tl.zpp_pool,Tl.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Tl};var Al=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleEvent"]=Al,Al.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],Al.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Al.zpp_pool,Al.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=Al.zpp_pool,Al.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=Al.zpp_pool,Al.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=Al.zpp_pool,Al.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Al};var El=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_CbSet"]=El,El.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],El.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var l=i.data;if(t){if(e==l)t=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var r=l.prev;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}var a=l.next;if(-1==a.colour){this.__fix_neg_red(a);break}if(0==a.colour){if(null!=a.prev&&0==a.prev.colour){this.__fix_dbl_red(a.prev);break}if(null!=a.next&&0==a.next.colour){this.__fix_dbl_red(a.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var p=n.parent;null==p?this.parent=i:p.prev==n?p.prev=i:p.next=i,null!=i&&(i.parent=p),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=El.zpp_pool,El.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=El.zpp_pool,El.zpp_pool=t,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=El.zpp_pool,El.zpp_pool=i,e=t}this.parent=null}},clear_node:function(n,e){e(n.data);var t=n.parent;null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null);var i=n;return i.data=null,i.lt=null,i.swapped=null,i.next=El.zpp_pool,El.zpp_pool=i,t},__fix_neg_red:function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,l=n.next,r=l.prev,a=l.next;i.colour=0,n.colour=t.colour=1,n.next=r,null!=r&&(r.parent=n);var p=t.data;t.data=l.data,l.data=p,null!=this.swapped&&this.swapped(t.data,l.data),l.prev=a,null!=a&&(a.parent=l),l.next=t.next,null!=t.next&&(t.next.parent=l),t.next=l,null!=l&&(l.parent=t),e=i}else{var s=n.next,o=n.prev,h=o.next,_=o.prev;s.colour=0,n.colour=t.colour=1,n.prev=h,null!=h&&(h.parent=n);var u=t.data;t.data=o.data,o.data=u,null!=this.swapped&&this.swapped(t.data,o.data),o.next=_,null!=_&&(_.parent=o),o.prev=t.prev,null!=t.prev&&(t.prev.parent=o),t.prev=o,null!=o&&(o.parent=t),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,t=e.parent;if(null==t){e.colour=1;break}var i,l,r,a,p,s,o;e==t.prev?(r=t,o=t.next,n==e.prev?(i=n,l=e,a=n.prev,p=n.next,s=e.next):(i=e,l=n,a=e.prev,p=n.prev,s=n.next)):(i=t,a=t.prev,n==e.prev?(l=n,r=e,p=n.prev,s=n.next,o=e.next):(l=e,r=n,p=e.prev,s=n.prev,o=n.next));var h=t.parent;if(null==h?this.parent=l:h.prev==t?h.prev=l:h.next=l,null!=l&&(l.parent=h),i.prev=a,null!=a&&(a.parent=i),i.next=p,null!=p&&(p.parent=i),l.prev=i,null!=i&&(i.parent=l),l.next=r,null!=r&&(r.parent=l),r.prev=s,null!=s&&(s.parent=r),r.next=o,null!=o&&(o.parent=r),l.colour=t.colour-1,i.colour=1,r.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,t=null;if(null==this.parent)null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,t=null;if(null==this.parent)null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==El.zpp_pool?e=new El:(e=El.zpp_pool,El.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:El};var Il,Vl=0;l.Math=Math,String.prototype.__class__=l.String=String,String.__name__=["String"],l.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=l.Date=Date,Date.__name__=["Date"];var Ll=l.Int={__name__:["Int"]},Nl=l.Dynamic={__name__:["Dynamic"]},Dl=l.Float=Number;Dl.__name__=["Float"];var jl=l.Bool=Boolean;jl.__ename__=["Bool"];var Fl=l.Class={__name__:["Class"]},Bl={};l.Void={__ename__:["Void"]};s.cellWcnt=3,s.cellHcnt=3,s.cellWidth=266.6666666666667,s.cellHeight=200,s.size=22,y.__toStr={}.toString,f.epsilon=1e-8,f.fluidAngularDragFriction=2.5,f.fluidAngularDrag=100,f.fluidVacuumDrag=.5,f.fluidLinearDrag=.5,f.collisionSlop=.2,f.collisionSlopCCD=.5,f.distanceThresholdCCD=.05,f.staticCCDLinearThreshold=.05,f.staticCCDAngularThreshold=.005,f.bulletCCDLinearThreshold=.125,f.bulletCCDAngularThreshold=.0125,f.dynamicSweepLinearThreshold=17,f.dynamicSweepAngularThreshold=.6,f.angularCCDSlipScale=.75,f.arbiterExpirationDelay=6,f.staticFrictionThreshold=2,f.elasticThreshold=20,f.sleepDelay=60,f.linearSleepThreshold=.2,f.angularSleepThreshold=.4,f.contactBiasCoef=.3,f.contactStaticBiasCoef=.6,f.contactContinuousBiasCoef=.4,f.contactContinuousStaticBiasCoef=.5,f.constraintLinearSlop=.1,f.constraintAngularSlop=.001,f.illConditionedThreshold=2e8,k.zpp_pool=null,I.zpp_pool=null,B.zpp_internalAlloc=!1,G.zpp_pool=null,Q.zpp_pool=null,ln.zpp_pool=null,on.zpp_pool=null,dn.zpp_pool=null,zn.zpp_pool=null,Mn.zpp_pool=null,Sn.zpp_pool=null,En.zpp_internalAlloc=!1,Vn.zpp_pool=null,jn.zpp_pool=null,Yn.zpp_pool=null,Wn.zpp_internalAlloc=!1,Kn.zpp_pool=null,$n.zpp_pool=null,ae.FMAX=1e100,pe._Constraint=0,pe._Interactor=0,pe._CbType=0,pe._CbSet=0,pe._Listener=0,pe._ZPP_SimpleVert=0,pe._ZPP_SimpleSeg=0,pe._Space=0,pe._InteractionGroup=0,se.internal=!1,se.zpp_pool=null,oe.zpp_pool=null,he.zpp_pool=null,ze.ANY_SHAPE=new M,ze.ANY_BODY=new M,ze.ANY_COMPOUND=new M,ze.ANY_CONSTRAINT=new M,ye.internal=!1,ye.id_ImmState_ACCEPT=1,ye.id_ImmState_IGNORE=2,ye.id_ImmState_ALWAYS=4,ye.id_GravMassMode_DEFAULT=0,ye.id_GravMassMode_FIXED=1,ye.id_GravMassMode_SCALED=2,ye.id_InertiaMode_DEFAULT=0,ye.id_InertiaMode_FIXED=1,ye.id_MassMode_DEFAULT=0,ye.id_MassMode_FIXED=1,ye.id_BodyType_STATIC=1,ye.id_BodyType_DYNAMIC=2,ye.id_BodyType_KINEMATIC=3,ye.id_ListenerType_BODY=0,ye.id_ListenerType_CONSTRAINT=1,ye.id_PreFlag_ACCEPT=1,ye.id_ListenerType_INTERACTION=2,ye.id_PreFlag_IGNORE=2,ye.id_ListenerType_PRE=3,ye.id_PreFlag_ACCEPT_ONCE=3,ye.id_PreFlag_IGNORE_ONCE=4,ye.id_CbEvent_BEGIN=0,ye.id_CbEvent_ONGOING=6,ye.id_InteractionType_COLLISION=1,ye.id_CbEvent_END=1,ye.id_InteractionType_SENSOR=2,ye.id_CbEvent_WAKE=2,ye.id_InteractionType_FLUID=4,ye.id_CbEvent_SLEEP=3,ye.id_InteractionType_ANY=7,ye.id_CbEvent_BREAK=4,ye.id_CbEvent_PRE=5,ye.id_Winding_UNDEFINED=0,ye.id_Winding_CLOCKWISE=1,ye.id_Winding_ANTICLOCKWISE=2,ye.id_ValidationResult_VALID=0,ye.id_ValidationResult_DEGENERATE=1,ye.id_ValidationResult_CONCAVE=2,ye.id_ValidationResult_SELF_INTERSECTING=3,ye.id_ShapeType_CIRCLE=0,ye.id_ShapeType_POLYGON=1,ye.id_Broadphase_DYNAMIC_AABB_TREE=0,ye.id_Broadphase_SWEEP_AND_PRUNE=1,ye.id_ArbiterType_COLLISION=1,ye.id_ArbiterType_SENSOR=2,ye.id_ArbiterType_FLUID=4,fe.internal=!1,fe.types=function(n){null==ye.ListenerType_BODY&&(ye.internal=!0,ye.ListenerType_BODY=new L,ye.internal=!1);var e=ye.ListenerType_BODY;null==ye.ListenerType_CONSTRAINT&&(ye.internal=!0,ye.ListenerType_CONSTRAINT=new L,ye.internal=!1);var t=ye.ListenerType_CONSTRAINT;null==ye.ListenerType_INTERACTION&&(ye.internal=!0,ye.ListenerType_INTERACTION=new L,ye.internal=!1);var i=ye.ListenerType_INTERACTION;return null==ye.ListenerType_PRE&&(ye.internal=!0,ye.ListenerType_PRE=new L,ye.internal=!1),[e,t,i,ye.ListenerType_PRE]}(),fe.events=function(n){null==ye.CbEvent_BEGIN&&(ye.internal=!0,ye.CbEvent_BEGIN=new C,ye.internal=!1);var e=ye.CbEvent_BEGIN;null==ye.CbEvent_END&&(ye.internal=!0,ye.CbEvent_END=new C,ye.internal=!1);var t=ye.CbEvent_END;null==ye.CbEvent_WAKE&&(ye.internal=!0,ye.CbEvent_WAKE=new C,ye.internal=!1);var i=ye.CbEvent_WAKE;null==ye.CbEvent_SLEEP&&(ye.internal=!0,ye.CbEvent_SLEEP=new C,ye.internal=!1);var l=ye.CbEvent_SLEEP;null==ye.CbEvent_BREAK&&(ye.internal=!0,ye.CbEvent_BREAK=new C,ye.internal=!1);var r=ye.CbEvent_BREAK;null==ye.CbEvent_PRE&&(ye.internal=!0,ye.CbEvent_PRE=new C,ye.internal=!1);var a=ye.CbEvent_PRE;return null==ye.CbEvent_ONGOING&&(ye.internal=!0,ye.CbEvent_ONGOING=new C,ye.internal=!1),[e,t,i,l,r,a,ye.CbEvent_ONGOING]}(),we.UCbSet=new ve,we.VCbSet=new ve,we.WCbSet=new ve,we.UCbType=new ge,we.VCbType=new ge,we.WCbType=new ge,Ne.internal=!1,Ne.COL=1,Ne.FLUID=4,Ne.SENSOR=2,Ne.types=function(n){null==ye.ArbiterType_COLLISION&&(ye.internal=!0,ye.ArbiterType_COLLISION=new nn,ye.internal=!1);var e=ye.ArbiterType_COLLISION;null==ye.ArbiterType_SENSOR&&(ye.internal=!0,ye.ArbiterType_SENSOR=new nn,ye.internal=!1);var t=ye.ArbiterType_SENSOR;return null==ye.ArbiterType_FLUID&&(ye.internal=!0,ye.ArbiterType_FLUID=new nn,ye.internal=!1),[null,e,t,null,ye.ArbiterType_FLUID]}(),De.zpp_pool=null,je.zpp_pool=null,Fe.FACE1=0,Fe.FACE2=1,Fe.CIRCLE=2,Fe.zpp_pool=null,Be.internal=!1,Be.zpp_pool=null,Ge.zpp_pool=null,Ye.SHAPE=1,Ye.BODY=2,Ze.zpp_pool=null,We.flowpoly=new qe,We.flowsegs=new qe,He.convexPool=null,He.rayPool=null,He.internal=!1,Ke.zpp_pool=null,Je.zpp_pool=null,Qe.ints=null,Qe.paths=null,nt.zpp_pool=null,tt.zpp_pool=null,tt.internal=!1,it.zpp_pool=null,lt.zpp_pool=null,rt.me=new rt,rt.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],at.zpp_pool=null,st.queue=null,st.edges=null,ot.nextId=0,ot.zpp_pool=null,ht.zpp_pool=null,_t.internal=!1,ut.zpp_pool=null,dt.zpp_pool=null,ct.zpp_pool=null,vt.sweep=null,vt.inthash=null,vt.vertices=null,vt.queue=null,vt.ints=null,vt.list_vertices=null,vt.list_queue=null,zt.zpp_pool=null,yt.zpp_pool=null,ft.stack=null,mt.zpp_pool=null,gt.zpp_pool=null,wt.queue=null,wt.stack=null,wt.edgeSet=null,Ct.zpp_pool=null,St.types=function(n){null==ye.BodyType_STATIC&&(ye.internal=!0,ye.BodyType_STATIC=new Nn,ye.internal=!1);var e=ye.BodyType_STATIC;null==ye.BodyType_DYNAMIC&&(ye.internal=!0,ye.BodyType_DYNAMIC=new Nn,ye.internal=!1);var t=ye.BodyType_DYNAMIC;return null==ye.BodyType_KINEMATIC&&(ye.internal=!0,ye.BodyType_KINEMATIC=new Nn,ye.internal=!1),[null,e,t,ye.BodyType_KINEMATIC]}(),St.bodystack=null,St.bodyset=null,St.cur_graph_depth=0,Tt.zpp_pool=null,At.zpp_pool=null,At.WAKE=1,At.PROPS=2,At.ANGDRAG=4,At.ARBITERS=8,Et.types=function(n){null==ye.ShapeType_CIRCLE&&(ye.internal=!0,ye.ShapeType_CIRCLE=new ee,ye.internal=!1);var e=ye.ShapeType_CIRCLE;return null==ye.ShapeType_POLYGON&&(ye.internal=!0,ye.ShapeType_POLYGON=new ee,ye.internal=!1),[e,ye.ShapeType_POLYGON]}(),Vt.zpp_pool=null,Vt.internal=!1,Dt.zpp_pool=null,jt.zpp_pool=null;Ft.tmpaabb=new Ze,Bt.FATTEN=3,Bt.VEL_STEPS=2,Rt.zpp_pool=null,Gt.zpp_pool=null,Yt.zpp_pool=null,qt.zpp_pool=null,Jt.zpp_pool=null,ki.zpp_pool=null,Oi.zpp_pool=null,Si.zpp_pool=null,Pi.zpp_pool=null,Ti.zpp_pool=null,Ai.zpp_pool=null,Ei.zpp_pool=null,Ii.zpp_pool=null,Vi.zpp_pool=null,Li.zpp_pool=null,Ni.zpp_pool=null,Di.zpp_pool=null,ji.zpp_pool=null,Fi.zpp_pool=null,Bi.zpp_pool=null,Ri.zpp_pool=null,Gi.zpp_pool=null,Yi.zpp_pool=null,Ui.zpp_pool=null,Zi.zpp_pool=null,qi.zpp_pool=null,Wi.zpp_pool=null,Xi.zpp_pool=null,Hi.zpp_pool=null,Ki.zpp_pool=null,Ji.zpp_pool=null,Qi.zpp_pool=null,$i.zpp_pool=null,nl.zpp_pool=null,el.zpp_pool=null,tl.zpp_pool=null,il.zpp_pool=null,ll.zpp_pool=null,rl.zpp_pool=null,al.zpp_pool=null,sl.internal=!1,ol.internal=!1,hl.internal=!1,_l.internal=!1,ul.internal=!1,dl.internal=!1,cl.internal=!1,xl.internal=!1,vl.internal=!1,zl.internal=!1,yl.internal=!1,fl.internal=!1,ml.internal=!1,bl.internal=!1,gl.internal=!1,Cl.poolGeomPoly=null,Cl.nextGeomPoly=null,Cl.poolVec2=null,Cl.nextVec2=null,Cl.poolVec3=null,Cl.nextVec3=null,Ml.zpp_pool=null,kl.zpp_pool=null,Ol.zpp_pool=null,Sl.zpp_pool=null,Pl.zpp_pool=null,Tl.zpp_pool=null,Al.zpp_pool=null,El.zpp_pool=null;for(var Rl=Object.keys(l),Gl={},Yl=0;Rl.length>Yl;Yl++){var Ul=Rl[Yl];if("nape."==Ul.slice(0,5)){var Zl=Ul.split(".");2==Zl.length?Gl[Zl[1]]=l[Ul]:3==Zl.length&&(Gl[Zl[1]]||(Gl[Zl[1]]={}),Gl[Zl[1]][Zl[2]]=l[Ul])}}return Gl}()},691:function(n,e,t){"use strict";function i(n,e,t){var i=function(n){for(var e=Math.PI/180,t=0,i=[],l=0;360>l;l++){var a=Math.cos(t)*n,p=Math.sin(t)*n;i.push(r.get(a,p)),t+=e}return i}(n);l.shape.Polygon.call(this,i,e,t),this.radius=n}var l=t(465).nape,r=l.geom.Vec2;i.constructor=i,i.prototype=Object.create(l.shape.Polygon.prototype),n.exports=i},692:function(n,e,t){"use strict";function i(n,e){l.space.Space.call(this,n,e),Object.defineProperty(this,"bodies",{get:function(){return this.get_bodies()}}),Object.defineProperty(this,"world",{get:function(){return this.get_world()}}),Object.defineProperty(this,"constraints",{get:function(){return this.get_constraints()}}),Object.defineProperty(this,"listeners",{get:function(){return this.get_listeners()}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.space.Space.prototype),i.prototype.add=function(n){this.bodies.add(n)},i.prototype.remove=function(n){this.bodies.remove(n)},n.exports=i},693:function(n,e,t){"use strict";function i(n,e,t,i,r){l.constraint.AngleJoint.call(this,n,e,t,i,r),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.constraint.AngleJoint.prototype),n.exports=i},694:function(n,e,t){"use strict";function i(n,e,t,i,r,a){l.constraint.DistanceJoint.call(this,n,e,t,i,r,a),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"jointMax",{get:function(){return this.get_jointMax()},set:function(n){this.set_jointMax(n)}}),Object.defineProperty(this,"jointMin",{get:function(){return this.get_jointMin()},set:function(n){this.set_jointMin(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.constraint.DistanceJoint.prototype),n.exports=i},695:function(n,e,t){"use strict";function i(n,e,t,i,r,a,p){l.constraint.LineJoint.call(this,n,e,t,i,r,a,p),this.body1=n,this.body2=e,this.userData={},Object.defineProperty(this,"body1",{get:function(){this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.constraint.LineJoint.prototype),n.exports=i},696:function(n,e,t){"use strict";function i(n,e,t,i){r.call(this,n,e,t,i),this.userData={},this.coerceAB=!1,this.aTob=!0,Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=t(465).nape,r=l.constraint.PivotJoint;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.updateStep=function(){if(this.coerceAB)if(this.aTob){var n=this.anchor2;this.get_body2()!=this.get_space().get_world()&&(n=this.body2.localPointToWorld(n));var e=this.anchor1;this.body1.set_position(n.sub(e))}else{var n=this.anchor1;this.get_body1()!=this.get_space().get_world()&&(n=this.body1.localPointToWorld(n));var t=this.anchor2;this.body2.set_position(n.sub(t))}},n.exports=i},697:function(n,e,t){"use strict";function i(n,e,t,i,r,a,p,s,o,h,_){l.constraint.PulleyJoint.call(this,n,e,t,i,r,a,p,s,o,h,_),this.userData={},Object.defineProperty(this,"body1",{get:function(){this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"body3",{get:function(){this.get_body3()},set:function(n){this.set_body3(n)}}),Object.defineProperty(this,"body4",{get:function(){this.get_body4()},set:function(n){this.set_body4(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.get_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"anchor3",{get:function(){this.get_anchor3()},set:function(n){this.set_anchor3(n)}}),Object.defineProperty(this,"anchor4",{get:function(){return this.get_anchor4()},set:function(n){this.set_anchor4(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.constraint.PulleyJoint.prototype),n.exports=i},698:function(n,e,t){"use strict";function i(n,e,t,i,l){r.call(this,n,e,t,i,0,1e4),this.anchor1=this.zpp_inner.wrap_a1,this.anchor2=this.zpp_inner.wrap_a2,this.body1=n,this.body2=e,this.frequency=this.zpp_inner.frequency,this.userData={},this.DAMPING_K=.14,this.springLength=l,this.SPRING_FORCE_SCALE=108.156,this.DEFAULT_LEN=100,this.DEFAULT_DAMPING=.2,this.damping=this.DEFAULT_DAMPING,this.zpp_inner.validate=this.validate,this.currentDis=0}var l=t(465).nape,r=l.constraint.DistanceJoint;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.validate=function(){var n=this.outer,e=n.get_body1(),t=n.get_body2();if(null==e||null==t)throw"Error : joint cannot be simulated with null bodies ! ";if(0>this.damping||this.damping>2)throw"Error : The value of damping must be between 0 and 2";var i=e.localPointToWorld(n.get_anchor1()),l=t.localPointToWorld(n.get_anchor2()),r=n.frequency,a=n.springLength,p=i.sub(l),s=p.get_length(),o=s-a,h=n.damping;if(o>0){var _=r*o*n.SPRING_FORCE_SCALE*(1-h);if(e!=e.get_space().get_world()){var u=l.sub(i).unit();u.set_length(_),e.applyImpulse(u,i)}if(t!=t.get_space().get_world()){var d=p.unit();d.set_length(_),t.applyImpulse(d,l)}}},n.exports=i},699:function(n,e,t){"use strict";function i(n,e,t,i,r){l.constraint.DistanceJoint.call(this,n,e,t,i,0,1e4),this.frequency=this.zpp_inner.frequency,Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),this.userData={},this.DAMPING_K=.14,this.springLength=r,this.SPRING_FORCE_SCALE=108.156,this.DEFAULT_LEN=100,this.DEFAULT_DAMPING=.2,this.damping=this.DEFAULT_DAMPING,Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=t(465).nape,r=t(626),a=l.geom.Vec2;i.constructor=i,i.prototype=Object.create(l.constraint.DistanceJoint.prototype),i.prototype.update=function(){var n=this;if(null==n.body1||null==n.body2)throw"Error : joint cannot be simulated with null bodies ! ";if(0>this.damping||this.damping>2)throw"Error : The value of damping must be between 0 and 2";var e=n.body1.localPointToWorld(n.anchor1),t=n.body2.localPointToWorld(n.anchor2),i=n.frequency,l=n.springLength,p=e.sub(t),s=p.get_length(),o=l-s;if(0!=p.get_length()){var h,_=p.mul(1/p.get_length()),u=[n.body1,n.body2];for(h=0;u.length>h;h++){var d=u[h];if(d!=d.space.world){var c=new a;if(d==n.body1)var x=n.body1.velocity.sub(n.body2.velocity);else x=n.body2.velocity.sub(n.body1.velocity);var v=e.sub(t).get_length();if(x.get_length()>v&&(x=x.mul(v/x.get_length())),0!=x.get_length()&&0!=_.get_length())var z=(x.dot(_),r.project(x,_));else z=new a;var y=z.get_x()*n.damping*n.DAMPING_K,f=z.get_y()*n.damping*n.DAMPING_K;d==n.body1?(c.set_x(_.get_x()*o*i),c.set_y(_.get_y()*o*i),e):d==n.body2&&(c.set_x(_.get_x()*o*-1*i),c.set_y(_.get_y()*o*-1*i),t),c.set_x(c.get_x()-y),c.set_y(c.get_y()-f),n.body1!=d.space.world&&n.body2!=d.space.world?(n.body1.applyImpulse(c.mul(n.SPRING_FORCE_SCALE),e),n.body2.applyImpulse(c.mul(-1*n.SPRING_FORCE_SCALE),t)):n.body1==d.space.world?n.body2.applyImpulse(c.mul(n.SPRING_FORCE_SCALE),t):n.body2==d.space.world&&n.body1.applyImpulse(c.mul(n.SPRING_FORCE_SCALE),e);break}}}},n.exports=i},700:function(n,e,t){"use strict";function i(n,e,t,i,r){l.constraint.WeldJoint.call(this,n,e,t,i,r),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"phase",{get:function(){return this.get_phase()},set:function(n){this.set_phase(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.constraint.WeldJoint.prototype),n.exports=i},701:function(n,e,t){"use strict";function i(n,e,t){o.call(this,n,e),this.CbTypeStr=t,this._data=null,Object.defineProperty(this,"data",{set:function(n){this._data=n}}),Object.defineProperty(this,"listeners",{get:function(){var n=this.get_space();if(n){return n.get_listeners()}return null}})}var l=t(465).nape,r=l.callbacks.CbType,a=l.callbacks.CbEvent,p=l.callbacks.InteractionListener,s=l.callbacks.InteractionType,o=t(624);i.constructor=i,i.prototype=Object.create(o.prototype),i.prototype.addHit=function(){this.set_isBullet(!0);var n=this.get_shapes().at(0),e=new r;n.get_cbTypes().add(e);var t=[this.CbTypeStr.LIQUID_SHAPE,this.CbTypeStr.CONTAINER_BOTTOM],i=this;this.hitlisten=new p(a.get_BEGIN(),s.get_SENSOR(),e,t,function(n){var e=n.get_int2().get_body(),t=e.userData.view;t.canPour&&(t.waterFlooding(i._data.ml),i.removeFromSpace())}),this.hitlisten2=new p(a.get_BEGIN(),s.get_SENSOR(),e,this.CbTypeStr.GLOBAL_WALL,function(n){i.removeFromSpace()}),this.listeners.add(this.hitlisten),this.listeners.add(this.hitlisten2)},i.prototype.removeFromSpace=function(){var n=this.userData.view;n&&n.parent&&n.parent.removeChild(n),this.listeners&&(this.listeners.remove(this.hitlisten),this.listeners.remove(this.hitlisten2)),this.set_space(null),this.CbTypeStr=null},n.exports=i},702:function(n,e,t){"use strict";function i(n,e,t,i){r.call(this,n,e,t,i),this.isDraging=!1,this.useing=!1,this.leaveing=!1,this.bind=null}var l=t(465).nape,r=t(518),a=l.callbacks.CbEvent,p=l.callbacks.InteractionType,s=l.callbacks.InteractionListener;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.draging=function(n){this.isDraging=n},i.prototype.setFirstDrag=function(n){this.get_userData().firstDrag=n},i.prototype.createListener=function(n,e,t){if(this.get_body()&&this.space){var i=this;this.interactListener=new s(a.get_ONGOING(),p.get_ANY(),n,e,function(n){var e=n.get_int1(),l=n.get_int2();i.leaveing||e.isDraging||l.isDraging||!t||t(n)}),this.interactListener2=new s(a.get_END(),p.get_ANY(),n,e,function(n){i.removeInterListeners(i.interactListener2),i.leaveing=!1,i.setFirstDrag(!1),i.bind&&(i.bind.useing=!1,i.bind=null),i.useing=!1}),this.addInterListeners([this.interactListener])}},i.prototype.addEndListener=function(){this.addInterListeners([this.interactListener2])},i.prototype.dispose=function(){this.removeInterListeners(this.interactListener),this.removeInterListeners(this.interactListener2)},i.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},n.exports=i},703:function(n,e,t){"use strict";function i(n,e,t,i){r.call(this,n,e,t,i),this.main=null,this.hitEndFlag=!1,this.connectCallback=null,this.breakClickCallback=null,this.intShape1=null,this.intShape2=null,this.connectFail=!1,this.connectPoint=null,this.CbTypeStr=null,this.JointUtil=null,this.BodyUtil=null,this.firsthit=!1,this.circleShape=null,this.dragingConnect=!1,this.createdistanceJoint=!1,Object.defineProperty(this,"connectVec",{get:function(){return this.connectPoint},set:function(n){this.connectPoint=n}})}var l=t(465).nape,r=t(518),a=l.callbacks.CbEvent,p=l.callbacks.InteractionType,s=l.callbacks.InteractionListener;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.registerClass=function(n){n&&(this.CbTypeStr=n.CbTypeStr,this.JointUtil=n.JointUtil,this.BodyUtil=n.BodyUtil,this.InteractionFilterManager=n.InteractionFilterManager,n.InteractionFilterManager&&this.set_filter(this.InteractionFilterManager.LIQUID_IGNORE_GROUP))},i.prototype.dispose=function(){this.removeInterListeners(this.interactListener),this.removeInterListeners(this.interactListener2),this.interactListener&&this.interactListener.set_handler(function(){}),this.interactListener2&&this.interactListener2.set_handler(function(){}),this.intShape1=null,this.intShape2=null,this.connectCallback=null,this.breakClickCallback=null,this.CbTypeStr=null,this.JointUtil=null,this.BodyUtil=null,this.InteractionFilterManager=null,this.zpp_inner.userData=null,this.main=null,this.circleShape=null,this.showHitCircle=null,this.hideHitCircle=null,this.get_cbTypes().clear()},i.prototype.createListener=function(n,e,t){if(this.get_body()&&this.space){var i=this;this.interactListener=new s(a.get_ONGOING(),p.get_ANY(),n,e,function(n){try{var e=n.get_int1().get_body(),t=n.get_int2().get_body();if(!i.dragingConnect&&e.userData.dragManager)return void(i.firsthit||(i.firsthit=!0,i.circleShape=n.get_int2(),n.get_int2().showHitCircle&&n.get_int2().showHitCircle()));if(!i.dragingConnect&&t.userData.dragManager)return void(i.firsthit||(i.firsthit=!0,i.circleShape=n.get_int1(),n.get_int1().showHitCircle&&n.get_int1().showHitCircle()))}catch(l){}i.beginHiting(n)},t),this.interactListener2=new s(a.get_END(),p.get_ANY(),n,e,function(n){i.firsthit=!1,i.circleShape&&i.circleShape.hideHitCircle&&i.circleShape.hideHitCircle(),i.circleShape=null,i.hitEnd(n)},t),this.addInterListeners([this.interactListener,this.interactListener2])}},i.prototype.addCbtype=function(n,e){this.get_cbTypes().add(n),e&&this.createListener(n,this.CbTypeStr.ALL_HOOK_ARY)},i.prototype.beginHiting=function(n){if(!this.var_isbreaking){var e=n.get_int1(),t=n.get_int2();if(!(e!=this&&t!=this||e.get_userData().useing||t.get_userData().useing)){e.get_userData().useing=!0,t.get_userData().useing=!0,e.get_userData().bind=t,t.get_userData().bind=e;var i=this.getIntBodys(e,t);i.push(e,t),this.bindJoint.apply(this,i)}}},i.prototype.getIntBodys=function(n,e){var t,r,a,p;return n instanceof i?(t=n.get_body(),a=n.get_worldCOM()):n instanceof l.phys.Body&&(t=n,a=n.get_position()),e instanceof i?(r=e.get_body(),p=e.get_worldCOM()):e instanceof l.phys.Body&&(r=e,p=e.get_position()),[t,r,a,p]},i.prototype.hitEnd=function(n){this.var_isbreaking=!1},i.prototype.bindJoint=function(n,e,t,i,l,r){this.intShape1=l,this.intShape2=r;if(l.connectCallback){if(l.connectCallback(e,i))return;this.connectFail=!0}if(r.connectCallback){if(r.connectCallback(n,t))return;this.connectFail=!0}var a=l.connectVec?t.add(l.connectVec):t,p=r.connectVec?i.add(r.connectVec):i;if(this.createdistanceJoint?(this.pivjoint=this.JointUtil.createDistanceJoint(n,e,a,p,0,15),this.pivjoint.set_stiff(!0),this.pivjoint.set_frequency(10)):this.pivjoint=this.JointUtil.createPivotJoint(n,e,a,p),this.space){this.space.get_userData().napeEngine.hockCtrol.addJointShape(this.pivjoint,this)}try{var s=n.userData.view.main;s&&s.dispatchEvent(s.constructor.HOCK_CHANGE,{bind:!0})}catch(o){}},i.prototype.dragToolClick=function(n){if(null==this.intShape1&&null==this.intShape2)return void(this.get_userData().bind&&this.get_userData().bind.dragToolClick());this.intShape1.breakClickCallback&&this.intShape1.breakClickCallback(this.connectFail),this.intShape2.breakClickCallback&&this.intShape2.breakClickCallback(this.connectFail),this.connectFail=!1,n||(this.get_userData().bind.var_isbreaking=!0,this.var_isbreaking=!0);var e;try{e=this.intShape1.get_body().userData.view.main}catch(t){}this.intShape1.get_userData().useing=!1,this.intShape2.get_userData().useing=!1,this.intShape1.get_userData().bind=null,this.intShape2.get_userData().bind=null,this.intShape1=null,this.intShape2=null,this.pivjoint&&(this.BodyUtil.destoryJoint(this.pivjoint),this.pivjoint=null),e&&e.dispatchEvent(e.constructor.HOCK_CHANGE,{bind:!1})},n.exports=i},704:function(n,e,t){"use strict";function i(n,e,t){l.shape.Polygon.call(this,n,e,t),Object.defineProperty(this,"density",{get:function(){return this.get_fluidProperties().get_density()},set:function(n){this.get_fluidProperties().set_density(n)}}),Object.defineProperty(this,"viscosity",{get:function(){return this.get_fluidProperties().get_viscosity()},set:function(n){this.get_fluidProperties().set_viscosity(n)}}),Object.defineProperty(this,"gravity",{get:function(){return this.get_fluidProperties().get_gravity()},set:function(n){this.get_fluidProperties().set_gravity(n)}}),this.initParams()}var l=t(465).nape;i.constructor=i,i.prototype=Object.create(l.shape.Polygon.prototype),i.prototype.initParams=function(){this.set_fluidEnabled(!0)},i.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},n.exports=i},705:function(n,e,t){"use strict";function i(n,e,t,i){r.call(this,n,e,t,i),this.cbtype=new s,this.pourJoint=null,this.stime=0,this.pourToBody=null}var l=t(465).nape,r=t(518),a=t(625),p=t(706),s=l.callbacks.CbType,o=l.phys.BodyType,h=l.constraint.PivotJoint;i.constructor=i,i.prototype=Object.create(r.prototype),i.prototype.initInfo=function(n){},i.prototype.getPourToView=function(){return this.pourToBody?this.pourToBody.userData.view:null},i.prototype.adhesive=function(n){if(this.pourJoint)return!1;for(var e=this.get_worldCOM(),t=this.space.shapesInCircle(e,this.get_radius(),!1),i=null,l=0;l<t.get_length();l++){var r=t.at(l);if(r instanceof a){i=r;break}}if(i){var s=this.get_body();if(s.get_type()!=o.get_DYNAMIC())return!1;this.pourToBody=i.get_body();var _=i.get_worldCOM(),u=this.get_worldCOM(),d=_.sub(u),c=s.get_position(),x=c.add(d);return p.BodyTweenTo(s,.5,{x:x.get_x(),y:x.get_y(),onComplete:function(){var n=new h(s,this.space.get_world(),s.worldPointToLocal(_),_);n.set_ignore(!0),n.set_stiff(!0),n.set_damping(0),n.set_frequency(1e5),n.set_space(this.space),this.pourJoint=n}.bind(this)}),!0}return!1},i.prototype.disadhesive=function(){this.pourJoint&&(this.pourJoint.set_space(null),this.pourJoint=null),clearTimeout(this.stime),this.pourToBody=null},n.exports=i},706:function(n,e,t){"use strict";function i(){}var l=t(465).nape,r=l.geom.Vec2;i.BodyTweenTo=function(n,e,t){if(TweenMax){var i=n.get_position(),l={x:i.get_x(),y:i.get_y()};t.onUpdate=function(){n.set_position(r.get(l.x,l.y))},TweenMax.to(l,e,t)}},n.exports=i},707:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(496),p=t(447),s=(t(490),t(708)),o=t(709),h=t(765),_=t(740),u=t(736),d=t(732),c=t(730),x=t(737),v=t(473),z=t(766),y=t(763),f=t(761),m=t(734),b=t(739);t(455),t(476);n.exports=function(n){function e(t,r,a,s){i(this,e);var v=l(this,n.call(this));p.main=v,p.languageConfig=r,p.parentElement=t,p.parentElement&&(p.global_w=p.parentElement.clientWidth,p.global_h=p.parentElement.clientHeight),v.initStage(),window.F=p,p.svg=new Snap;var f=new o;return v.napeWorld=f,p.space=f.space,p.napeWorld=f,p.ropeNailJoints=new h,v.distanceShow=new d,v.angleShow=new c,v.trajectory=new _(f.actionBodyArr),v.photos=new u,v.svgTransTool=new z,v.eleEditor=new y,v.forceViewer=new m,p.forceViewer=v.forceViewer,p.pline=new x,v.drawNape=new b(p.space),p.canvasStage.moveLayer.addChild(v.drawNape),v.initMeasureData(),v.appData=p,$(window).resize(v.resize),setTimeout(v.resize,100),v.resize(),v.initEvents(),v}return r(e,n),e.prototype.resize=function(){if(p.main.initViewStack)p.canvas_w=+p.canvas.style.width.replace("px",""),p.canvas_h=+p.canvas.style.height.replace("px",""),p.global_w=p.canvas.width/PIXI.settings.RESOLUTION,p.global_h=p.canvas.height/PIXI.settings.RESOLUTION;else{var n=p.W,e=p.H,t=void 0,i=void 0;t=Math.max(window.innerWidth,0),i=Math.max(window.innerHeight,0),p.parentElement&&(t=p.parentElement.clientWidth||1024,i=p.parentElement.clientHeight||768),p.canvas_w=t,p.canvas_h=i;var l=t/i,r=n/e;l>r?(p.global_w=n*(l/r),p.global_h=e):(p.global_w=n,p.global_h=e/(l/r)),p.app&&(p.canvas.width=p.global_w,p.canvas.height=p.global_h,p.canvas.style.width=t+"px",p.canvas.style.height=i+"px",p.app.renderer.resize(p.global_w,p.global_h))}p.canvasStage.updateCoor(),p.canvasStage.xy.updatePosition()},e.prototype.resetParentElement=function(n){n?p.parentElement=n:p.canvas.parentElement&&(p.parentElement=p.canvas.parentElement),this.resize()},e.prototype.appUpdate=function(){p.AppStatus==p.APP_START&&this.napeWorld.step(),p.AppStatus==p.APP_START&&(p.CurrentStageDelay=p.space.get_elapsedTime()-p.CurrentStageStart,this.trajectory.update(),this.forceViewer.update(),this.photos.updata(),this.distanceShow.update(),this.angleShow.update()),this.renderer&&this.renderer.render(p.stage)},e.prototype.addEquip=function(n,e,t){if(p.AppStatus==p.APP_STOP){var i;if(e){i=p.bodyCon.toLocal({x:p.global_w/p.canvas_w*e.x,y:p.global_h/p.canvas_h*e.y})}this.napeWorld.addEuipment(n,i,null,null,t)}},e.prototype.deleteElement=function(){this.eleEditor.del(),this.svgTransTool.edit(null)},e.prototype.showElementSetting=function(){this.eleEditor.showPro()},e.prototype.copyEditorElement=function(){this.eleEditor.copyElement()},e.prototype.copyMoveElement=function(){this.eleEditor.copyMoveElement()},e.prototype.copyElement=function(){var n={};return this.eleEditor.current&&(n.typeName=this.eleEditor.current.typeName,n.data=this.eleEditor.current.baseData),n},e.prototype.pasteElement=function(n){if(p.AppStatus==p.APP_STOP&&n.typeName&&n.data){this.napeWorld.addEuipment(n.typeName,p.backCon.toLocal({x:p.stageMouseX,y:p.stageMouseY}),p.getDataFormItemData(n.data))}},e.prototype.elementUDLR=function(n){var e=this.eleEditor.current;if(e&&e.translate){var t=0,i=0;switch(n){case 37:t=-2;break;case 38:i=-2*p.COOR_DIRECTION_Y_N;break;case 39:t=2;break;case 40:i=2*p.COOR_DIRECTION_Y_N}e.translate(t,i),e.emit("move"),this.emit(p.ELEMENT_MOVE,{ele:e}),this.emit(p.EVENT_HIDE_DROP_OUTER),this.eleEditor.edit(e),this.emit("emitChanges")}},e.prototype.appControl=function(n){switch(n){case 1:this.appStart();break;case 2:this.appPause();break;case 3:this.appStop()}},e.prototype.getAppStatus=function(){return p.AppStatus==p.APP_START?1:p.AppStatus==p.APP_PAUSE?2:3},e.prototype.appStart=function(){p.AppStatus==p.APP_PAUSE&&this.appStop(),p.AppStatus=p.APP_START,this.photos.start([this.napeWorld.actionBodyArr,this.napeWorld.woodArr]),this.eleEditor.hide(),p.CurrentStageStart=p.space.get_elapsedTime(),this.distanceShow.active=!1,this.angleShow.active=!1,this.napeWorld.startWork(),this.svgTransTool.edit(null)},e.prototype.appStop=function(){p.AppStatus=p.APP_STOP,p.CurrentStageDelay=0,p.ropeNailJoints.clearJoint(),this.trajectory.clear(),this.forceViewer.clear(),this.photos.stop(),this.napeWorld.endWork(),this.distanceShow.update(),this.angleShow.update()},e.prototype.appPause=function(){p.AppStatus=p.AppStatus==p.APP_START?p.APP_PAUSE:p.APP_START,this.eleEditor.hide(),this.napeWorld.worldUpdate(),this.napeWorld.constraintUpdate(),this.distanceShow.update(),this.angleShow.update()},e.prototype.appOnPause=function(){this.appPause(),this.emit(p.APP_PAUSE)},e.prototype.appOnStop=function(){this.appStop(),this.emit(p.APP_PAUSE)},e.prototype.initEvents=function(){function n(n){this.eleEditor.hide(),this.emit(p.EVENT_SHOW_DROP_OUTER,n)}function e(n){this.distanceShow.addBody(n.ele),this.angleShow.addBody(n.ele),this.distanceShow.active||this.angleShow.active||this.eleEditor.edit(n.ele),this.distanceShow.update(),this.angleShow.update(),d.svgTransTool.edit(n.ele)}function t(n){n&&n.ele&&f.adsorp(n.ele),this.napeWorld.constraintUpdate(),this.napeWorld.constraintUpdateView(),this.napeWorld.pulleyUpdateView(),this.distanceShow.update(),this.angleShow.update(),this.emit("emitChanges")}function i(n){this.eleEditor.edit(null),this.napeWorld.constraintUpdate(),this.napeWorld.constraintUpdateView(),this.napeWorld.pulleyUpdateView(),this.napeWorld.updateNails(n.ele),this.distanceShow.update(),this.angleShow.update(),f.adjusting(n.ele),d.svgTransTool.edit(null)}function l(n){this.eleEditor.hide(),this.emit(p.EVENT_HIDE_DROP_OUTER),d.svgTransTool.edit(null)}function r(n){this.distanceShow.deleteLine(n.ele),this.angleShow.deleteAngle(n.ele),this.napeWorld.deleteBody(n.ele),this.napeWorld.deleteJoints(n.ele),this.svgTransTool.edit(null),this.emit("emitChanges")}function a(n){this.napeWorld.addEuipment(n.typeName,n.pos,p.getDataFormItemData(n.data),!0),this.emit("emitChanges")}function s(){for(var n=0;this.napeWorld.equipArr.length>n;n++){this.napeWorld.equipArr[n].changeGridScale()}this.napeWorld.baseData.changeGScale()}function o(){p.canvasStage.revertY(),p.napeWorld.updateGravity();for(var n=0;this.napeWorld.equipArr.length>n;n++){var e=this.napeWorld.equipArr[n];e.baseData.changeCoorDirectionNew&&e.baseData.changeCoorDirectionNew()}}function h(){p.pline.update()}function _(){0!=this.napeWorld.equipArr.length&&(this.napeWorld.constraintUpdate(),this.napeWorld.constraintUpdateView(),this.distanceShow.update(),this.angleShow.update()),this.emit("emitChanges")}function u(n){this.svgTransTool.changeType(n.ele)}var d=this;this.on(p.EVENT_SHOW_DROP_INNER,n),this.on(p.ELEMENT_TOUCH,e),this.on(p.ELEMENT_MOVE,i),this.on(p.ELEMENT_MOVE_END,t),this.on(p.STAGE_MOVE_START,l),this.on(p.ELEMENT_DELETE,r),this.on(p.ELEMENT_COPY,a),this.on(p.GRIG_SCALE_CHANGE,s),this.on(p.COOR_DIRECTION_CHANGE_N,o),this.on(p.CHARGES_CHANGE,h),this.on(p.DETECT_CHANGE,_),this.on(p.CHANGE_SVG_EDITOR_TYPE,u)},e.prototype.setTopType=function(n){this.napeWorld.baseData.headerPos._checked=n},e.prototype.getWorldData=function(){return[p.canvasStage.coor.baseData.listArr,this.napeWorld.baseData.listArr,this.napeWorld.baseData.foldCommon,this.napeWorld.baseData.foldCommonArr]},e.prototype.getForceData=function(){return this.napeWorld.baseData.showList},e.prototype.getCoorData=function(){return[]},e.prototype.getPlaySpeed=function(){return this.napeWorld.baseData.playSpeed},e.prototype.initMeasureData=function(){var n=this;this.chiziButton=new v("测量距离"),this.chiziButton.hasArrow=!1,this.chiziButton.icon="rightbar_btn_juli_pressed.png",this.sanjiaobanButton=new v("测量角度"),this.sanjiaobanButton.hasArrow=!1,this.sanjiaobanButton.icon="rightbar_btn_jiaodu_pressed.png",this.chiziButton.on("click",function(){n.addDisShow()}),this.sanjiaobanButton.on("click",function(){n.addAngleShow()})},e.prototype.getMeasureData=function(){return[this.chiziButton,this.sanjiaobanButton]},e.prototype.clear=function(){for(this.svgTransTool.edit(null);this.napeWorld.equipArr.length>0;){var n=this.napeWorld.equipArr[0];this.napeWorld.deleteBody(n),this.distanceShow.deleteLine(n),this.angleShow.deleteAngle(n)}this.distanceShow.active=!1,this.angleShow.active=!1,this.appOnStop(),this.emit("emitChanges"),this.emit(p.STAGE_CLEAR_ALL)},e.prototype.clearNape=function(){p.nape.util.Debug.clearObjectPools()},e.prototype.destroy=function(){cancelAnimationFrame(this.appFrame),this.appStop(),this.clear(),this.angleShow.destroy(),this.angleShow=null,this.distanceShow.destroy(),this.distanceShow=null,this.photos.destroy(),this.photos=null,this.eleEditor.destroy(),this.eleEditor=null,this.svgTransTool.destroy(),this.svgTransTool=null,this.forceViewer.destroy(),this.forceViewer=null,this.trajectory.destroy(),this.trajectory=null,this.napeWorld.destory(),this.napeWorld=null,p.canvasStage.destroy(),$(window).unbind("resize",this.resize),this.app=null,this.sanjiaobanButton=null,this.chiziButton=null,this.removeAllListeners();for(var n in p)p[n]=null},e.prototype.thisGetData=function(){p.saveData=this.getData()},e.prototype.thisSetData=function(){this.setData(p.saveData)},e.prototype.getData=function(){var n={worldData:null,coorData:null,equipArr:[],disData:null,angleData:null};n.worldData=p.getDataFormItemData(this.napeWorld.baseData),n.coorData=p.getDataFormItemData(p.canvasStage.coor.baseData);for(var e=0;this.napeWorld.equipArr.length>e;e++){var t=this.napeWorld.equipArr[e],i=t.getData(),l=p.getDataFormItemData(i);l.typeName=t.typeName,l.id=t.id,n.equipArr.push(l)}return n.disData=this.distanceShow.getData(),n.angleData=this.angleShow.getData(),n.stageData=p.canvasStage.getData(),JSON.stringify(n)},e.prototype.setData=function(n){var e=this,t=JSON.parse(n);p.setItemDataFromData(this.napeWorld.baseData,t.worldData),p.setItemDataFromData(p.canvasStage.coor.baseData,t.coorData);for(var i=0;t.equipArr.length>i;i++){var l=t.equipArr[i];this.napeWorld.addEuipment(l.typeName,null,l,!0)}p.setItemDataFromData(this.napeWorld.baseData,t.worldData),p.canvasStage.setData(t.stageData),setTimeout(function(){this.napeWorld.setConstrains(),this.napeWorld.setNails()}.bind(this),10),this.distanceShow.setData(t.disData),this.angleShow.setData(t.angleData),this.distanceShow.update(),this.angleShow.update(),setTimeout(function(){e.emit(p.CHARGES_CHANGE)},10)},e.prototype.showInStage=function(){this.resetParentElement(),p.canvasStage.updateCoor()},e.prototype.initStage=function(n,e){if(this.initViewStack=!!n,n)p.stage=n,p.canvas=e,this.renderer=p.stage.renderer;else if(PIXI.settings.RESOLUTION=1,PIXI.settings.FILTER_RESOLUTION=1,PIXI.Application){var t=new PIXI.Application(p.global_w,p.global_h,{antialias:!0,transparent:!0});document.body.appendChild(t.view),p.app=t,p.canvas=t.view,p.stage=t.stage,t.ticker.add(this.appUpdate.bind(this))}else p.canvas=document.createElement("canvas"),this.renderer=new PIXI.autoDetectRenderer(p.global_w,p.global_h,{view:p.canvas,transparent:!0,antialias:!1}),p.stage=new PIXI.Container;p.canvasStage=new s,p.stage.addChild(p.canvasStage),p.stage.interactiveChildren=!0,p.stage.interactive=!0,this.snap={node:p.canvas},p.canvas.height=768,p.canvas.width=1024,p.parentElement&&p.parentElement.appendChild(p.canvas)},e.prototype.addDisShow=function(){this.angleShow.active=!1,this.distanceShow.active=!this.distanceShow.active},e.prototype.addAngleShow=function(){this.distanceShow.active=!1,this.angleShow.active=!this.angleShow.active},e.prototype.takeScreenShot=function(){if(p.app){var n=p.app.renderer.extract.base64(p.canvasStage);return n}if(this.renderer){var n=this.renderer.extract.base64(p.canvasStage);return n}return p.canvas.toDataURL()},e.prototype.saveScreenShot=function(){var n=this.takeScreenShot(),e=document.createElement("a");e.href=n,e.download="a.jpg",e.click()},e.prototype.setStageScale=function(n){p.canvasStage.setScale(n)},e.prototype.getStageScale=function(){return p.STAGE_SCALE},e.prototype.fitStage=function(){p.canvasStage.fitStage()},e.prototype.setSourcePath=function(n){p.sourceUrl=n||"assets/forceAndMotion/",p.skinUrl=p.sourceUrl+"skin/",p.settingUrl=p.sourceUrl+"setting/",p.woodSkin=p.skinUrl+"wood.jpg"},e}(a)},708:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(731),p=t(741),s=(t(490),t(447));t(116),t(580);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.coor=new a,t.moveLayer=new PIXI.Container,t.scaleLayer=new PIXI.Container,t.addChild(t.scaleLayer),t.scaleLayer.addChild(t.moveLayer),t.moveLayer.interactive=!0,t.moveLayer.interactiveChildren=!0,t.moveLayer.addChild(t.coor),t.xy=new p,t.addChild(t.xy),t.xy.updatePosition(),t.canvasLock=!1,t.backCon=new PIXI.Container,t.bodyCon=new PIXI.Container,t.frontCon=new PIXI.Container,t.moveLayer.addChild(t.backCon),t.moveLayer.addChild(t.bodyCon),t.moveLayer.addChild(t.frontCon),s.bodyCon=t.bodyCon,s.backCon=t.backCon,s.frontCon=t.frontCon,t.scaleLayer.x=s.global_w/2,t.scaleLayer.y=s.global_h/2,t.max=10,t.min=.1,t.targetScale=1,t.nowScale=1,t.pivotX=0,t.pivotY=0,t.interval=null,t.isTouch=!1,t.initPointer(),t.revertY(),t}return r(e,n),e.prototype.getData=function(){return{}},e.prototype.setData=function(n){this.moveLayer.x=0,this.moveLayer.y=0,this.scaleLayer.x=s.global_w/2,this.scaleLayer.y=s.global_h/2,this.targetScale=1,this.nowScale=1,this.scaleLayer.scale.set(1,1),s.STAGE_SCALE=1,this.coor.updateSpace(),this.updateCoor()},e.prototype.initPointer=function(){var n=this,e={x:0,y:0},t=0,i=!1,l=null,r=null;s.stage.addEventListener("pointerdown",this.poinerdown=function(e){var t=e.data.global;n.isTouch="touch"===e.data.pointerType,null===l?l={x:t.x,y:t.y,pointerId:e.data.pointerId}:null===r&&(r={x:t.x,y:t.y,pointerId:e.data.pointerId}),n.canvasLock&&(l=null,r=null),s.main.emit(s.STAGE_MOVE_START),s.main.trajectory.showPointInfo(),s.main.emit(s.STAGE_DOWN)}),this.clearParams=function(a){i=!1,l=r=null,e.x=0,e.y=0,t=0,n.isTouch&&n.coor.updateSpace(),n.updateCoor(),n.moveEnd()},s.stage.addEventListener("pointerup",this.clearParams),s.stage.addEventListener("pointerout",this.clearParams),document.body.addEventListener("touchend",this.clearParams),s.stage.addEventListener("pointermove",this.pointermove=function(i){var a=i.data.global;if(l&&null==r){var p=n.scaleLayer.toLocal({x:a.x,y:a.y}),o=n.scaleLayer.toLocal(l),h=p.x-o.x,_=p.y-o.y;n.moveLayer.x+=h,n.moveLayer.y+=_,n.updateCoor(),l.x=a.x,l.y=a.y,s.main.emit("canvas.moveToUpdateBrush")}else if(l&&r){var u=l.pointerId===i.data.pointerId?l:r;u.x=a.x,u.y=a.y;var d=l.x-r.x,c=l.y-r.y,x=d*d+c*c,v=Math.sqrt(x),z=(l.x+r.x)/2,y=(l.y+r.y)/2;if(0!=e.x||0!=e.y){var f=n.scaleLayer.toLocal({x:z,y:y}),m=n.scaleLayer.toLocal(e),b=f.x-m.x,g=f.y-m.y;n.moveLayer.x+=b,n.moveLayer.y+=g;var w=v-t;if(Math.abs(w)>2){var C=v/t,M=n.nowScale*C;n.targetScale=M,n.pivotX=z,n.pivotY=y,n.updateScale()}}e.x=z,e.y=y,t=v,s.main.emit("canvas.moveToUpdateBrush")}s.stageMouseX=a.x,s.stageMouseY=a.y,s.main.distanceShow.update(),s.main.angleShow.update()}),s.canvas.addEventListener("contextmenu",this.contextmenu=function(n){n.preventDefault()}),s.canvas.addEventListener("mousedown",this.contextmenu=function(n){2==n.button&&(n.preventDefault(),s.main.distanceShow.active=!1,s.main.angleShow.active=!1,i=!0,l={x:s.stageMouseX,y:s.stageMouseY,pointerId:0},s.main.emit(s.STAGE_MOVE_START))}),s.canvas.onmousewheel=function(e){var t=s.global_w/s.canvas_w*e.clientX,i=s.global_h/s.canvas_h*e.clientY,l=n.toLocal({x:t,y:i});n.subScale(-e.deltaY,l.x,l.y),s.main.emit(s.STAGE_MOVE_START)}},e.prototype.moveEnd=function(){s.main.emit(s.CHARGES_CHANGE)},e.prototype.updateCoor=function(){this.coor.update(!0),s.detectChange()},e.prototype.setScale=function(n,e,t){this.pivotX=e||s.global_w/2,this.pivotY=t||s.global_h/2,this.targetScale=n,this.updateScale()},e.prototype.subScale=function(n,e,t){var i=n>0?.1:-.1;this.targetScale+i>1&&(i*=5),this.targetScale=this.targetScale+i,this.pivotX=e,this.pivotY=t,this.updateScale()},e.prototype.updateScale=function(){var n=this;if(!this.canvasLock&&(this.targetScale=Math.min(this.max,Math.max(this.targetScale,this.min)))!=this.scaleLayer.scale.x)if(TweenMax&&!this.isTouch&&s.isPC())TweenMax.to(this,.3,{nowScale:this.targetScale,onUpdate:function(){var e=n.nowScale-n.scaleLayer.scale.x,t=n.scaleLayer.toLocal({x:n.pivotX,y:n.pivotY});n.scaleLayer.x-=e*t.x,n.scaleLayer.y-=e*t.y,n.scaleLayer.scale.set(n.nowScale,n.nowScale),s.STAGE_SCALE=n.nowScale,n.coor.update(),s.main.emit("canvas.moveToUpdateBrush")},onComplete:function(){n.coor.updateSpace(),n.coor.update(!0),s.main.emit("canvas.moveToUpdateBrush")}});else{this.nowScale=this.targetScale;var e=this.nowScale-this.scaleLayer.scale.x,t=this.scaleLayer.toLocal({x:this.pivotX,y:this.pivotY});this.scaleLayer.x-=e*t.x,this.scaleLayer.y-=e*t.y,this.scaleLayer.scale.set(this.nowScale,this.nowScale),s.STAGE_SCALE=this.nowScale,s.main.emit("canvas.moveToUpdateBrush")}},e.prototype.updateStageStrockWidth=function(){this.coor.update()},e.prototype.revertY=function(){this.moveLayer.scale.set(1,s.COOR_DIRECTION_Y_N),this.xy.revertY(),this.coor.update()},e.prototype.destroy=function(){this.coor.destroy(),this.coor=null,this.xy.destroy(),this.xy=null,s.canvas.onmousewheel=null,s.canvas.removeEventListener("contextmenu",this.contextmenu),s.stage.removeEventListener("pointermove",this.pointermove),s.stage.removeEventListener("pointerdown",this.pointerdown),s.stage.removeEventListener("pointerup",this.pointerup),s.stage.removeEventListener("pointerout",this.pointerout),n.prototype.destroy.call(this)},e.prototype.fitStage=function(){var n=s.bodyCon.getBounds(),e=this.scaleLayer.toLocal({x:s.global_w/2,y:s.global_h/2}),t=this.scaleLayer.toLocal({x:n.x+n.width/2,y:n.y+n.height/2});this.moveLayer.x+=e.x-t.x,this.moveLayer.y+=e.y-t.y;var i=s.bodyCon.getLocalBounds(),l=(s.global_w-200)/i.width,r=(s.global_h-200)/i.height,a=Math.min(l,r);a=Math.min(this.max,Math.max(a,this.min)),this.setScale(a),this.moveEnd()},e}(PIXI.Container)},709:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(742),r=t(747),a=t(633),p=t(757),s=t(758),o=t(634),h=t(745),_=t(754),u=t(755),d=t(750),c=t(749),x=t(751),v=t(756),z=t(743),y=t(753),f=t(759),m=t(760),b=t(748),g=t(746),w=t(744),C=t(752),M=t(447),k=t(460),O=t(711),S=t(476),P={G:6.67e-11,K:9e9};n.exports=function(){function n(){i(this,n);var e=M.Vec2,t=M.Space;this.g_gravity=10,this.r_gravity=90,this.gravity=e.get(0,0),this.gravity_real=e.get(0,0),this.space=new t(this.gravity),this.iterative=M.isPC()?40:5,this.timeNum=60,this.stepRate=M.isPC()?100:1,this.stepTime=this.timeNum*this.stepRate,this.timeStep=1/this.stepTime,this.start=!0,this.id="world",this.hasPaused=!1,this.space.set_worldAngularDrag(0),this.space.set_worldLinearDrag(0),this.ifGravitation=!1,this.ifJing=!1,this.elecFieldArr=[],this.actionBodyArr=[],this.magnFieldArr=[],this.pointChargeArr=[],this.dampAreaArr=[],this.gravitySourceArr=[],this.constraintArr=[],this.straightTrackArr=[],this.arcTrackArr=[],this.nailArr=[],this.woodArr=[],this.pulleyArr=[],this.cBeltArr=[],this.equipArr=[],this.gravForce=e.get(0,0),this.magnForce=e.get(0,0),this.chargeForce=e.get(0,0),this.dampForce=e.get(0,0),this.elecForce=e.get(0,0),this.gravForce0=e.get(0,0),this.chargeForce0=e.get(0,0),this.baseData=new O(this),this.nameAdded=[{name:"运动物体",index:1,className:"ActionBody"},{name:"匀强电场",index:1,className:"UniformElecField"},{name:"匀强磁场",index:1,className:"UniformMagnField"},{name:"阻尼介质",index:1,className:"DampArea"},{name:"点电荷",index:1,className:"PointCharge"},{name:"万有引力源",index:1,className:"GravitySource"},{name:"参照点",index:1,className:"ReferencePoint"},{name:"轻绳",index:1,className:"LightRope"},{name:"轻杆",index:1,className:"LightBar"},{name:"弹簧",index:1,className:"LightSpring"},{name:"直轨道",index:1,className:"StraightTrack"},{name:"弧轨道",index:1,className:"ArcTrack"},{name:"钉子",index:1,className:"Nail"},{name:"木板",index:1,className:"WoodBoard"},{name:"木块",index:1,className:"WoodBlock"},{name:"三角斜面",index:1,className:"WoodTriangle"},{name:"地面",index:1,className:"Ground"},{name:"滑轮",index:1,className:"FixedPulley"},{name:"传送带",index:1,className:"ConveyorBelt"},{name:"三角形电场",index:1,className:"TElecFiled"},{name:"三角形磁场",index:1,className:"TMagnField"},{name:"固定片",index:1,className:""}],this.initBodyCollision()}return n.prototype.destory=function(){this.baseData.body=null,this.baseData=null,this.space.clear(),this.space=null},n.prototype.initBodyCollision=function(){function n(n){if(M.AppStatus!==M.APP_STOP&&M.caseCollisionSound&&M.IF_COLLISION){var e=n.zpp_inner.int1.userData["class"];e.asMassPoint||e.playSound()}}function e(n){if(M.AppStatus!==M.APP_STOP){var e=n.get_int1(),i=n.get_int2(),l=e.zpp_inner.userData["class"],r=i.zpp_inner.userData["class"];if(t.baseData.showForceT.checked){var a=e.normalImpulse(i),p=a.zpp_inner.x/t.timeStep*M.GRIG_M2P/1e3,s=a.zpp_inner.y/t.timeStep*M.GRIG_M2P/1e3;l.showForce(l,r,{x:p,y:s},9),r.showForce(r,l,{x:-p,y:-s},9)}if(t.baseData.showForceM.checked){var o=e.tangentImpulse(i),p=o.zpp_inner.x/t.timeStep*M.GRIG_M2P/1e3,s=o.zpp_inner.y/t.timeStep*M.GRIG_M2P/1e3;l.showForce(l,r,{x:p,y:s},10),r.showForce(r,l,{x:-p,y:-s},10)}}}var t=this;this.bodyVsBodyLisner=new M.InteractionListener(M.CbEvent.get_BEGIN(),M.InteractionType.get_COLLISION(),M.BODY_CB_TYPE,M.BODY_CB_TYPE,n),M.caseCollisionSound&&this.space.get_listeners().add(this.bodyVsBodyLisner),this.injectingLisner=new M.InteractionListener(M.CbEvent.get_ONGOING(),M.InteractionType.get_COLLISION(),M.BODY_CB_TYPE,M.BODY_CB_TYPE,e),this.space.get_listeners().add(this.injectingLisner)},n.prototype.caseCollisionSound=function(n){M.caseCollisionSound=n,M.caseCollisionSound?this.space.get_listeners().add(this.bodyVsBodyLisner):this.space.get_listeners().remove(this.bodyVsBodyLisner)},n.prototype.step=function(){var n=this.baseData.maxPlayTime.showValue,e=this.baseData.playSpeed.showValue;isNaN(e)&&(e=1);for(var t=this.stepRate*e,i=0;t>i;i++){if(M.space.get_elapsedTime()-M.CurrentStageStart>=n&&!this.hasPaused)return M.main.appOnPause(),void(this.hasPaused=!0);this.space.step(this.timeStep,this.iterative,this.iterative);for(var l=0;this.actionBodyArr.length>l;l++){var r=this.actionBodyArr[l];r.resetForce()}for(var a=0;this.woodArr.length>a;a++){this.woodArr[a].resetForce()}this.update()}for(var a=0;this.actionBodyArr.length>a;a++){var r=this.actionBodyArr[a];r.updateShow()}for(var a=0;this.woodArr.length>a;a++){var r=this.woodArr[a];r.updateShow()}for(var a=0;this.cBeltArr.length>a;a++){var r=this.cBeltArr[a];r.updateShow()}this.constraintUpdateView(),this.worldUpdate(),this.pulleyUpdateView()},n.prototype.update=function(){for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n];if(this.baseData.caseGrave.checked){var t=this.g_gravity*e.kg_M*M.COOR_DIRECTION_Y_N;e.addForce(0,t),this.baseData.showForceZ.checked&&e.showForce(e,{id:"grave"},{x:0,y:t},8)}e.update()}for(var i=0;this.woodArr.length>i;i++){var l=this.woodArr[i];if(this.baseData.caseGrave.checked){var t=this.g_gravity*l.kg_M*M.COOR_DIRECTION_Y_N;l.addForce(0,t),this.baseData.showForceZ.checked&&l.showForce(l,{id:"grave"},{x:0,y:t},8)}l.update()}this.gravityUpdate(),this.elecFieldUpdate(),this.magnFieldUpdate(),this.pointChargeUpdate(),this.dampAreaUpdate(),this.gravitySourceUpdate(),this.constraintUpdate(),this.arcTrackUpdate(),this.straightTrackUpdate(),this.updateRopeWithNail();for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n];e.updateForce()}for(var i=0;this.woodArr.length>i;i++){var l=this.woodArr[i];l.updateForce()}},n.prototype.initFloor=function(){var n=M.global_w,e=M.global_h,t=new M.Body(M.BodyType.get_STATIC());t.get_shapes().add(new M.Polygon(M.Polygon.rect(0,e-10,n,10))),t.get_shapes().add(new M.Polygon(M.Polygon.rect(0,0,10,e))),t.get_shapes().add(new M.Polygon(M.Polygon.rect(n-10,0,10,e))),t.get_shapes().add(new M.Polygon(M.Polygon.rect(0,0,n,10))),t.set_space(this.space),t.setShapeMaterials(new M.Material(1,0,0,1,0));var i=M.svg;i.paper.rect(0,e-10,n,10).attr({fill:"#0ff"}),i.paper.rect(0,0,10,e).attr({fill:"#0ff"}),i.paper.rect(n-10,0,10,e).attr({fill:"#0ff"}),i.paper.rect(0,0,n,10).attr({fill:"#0ff"})},n.prototype.initHand=function(){var n,e=this.space;n=new PivotJoint(e.get_world(),null,Vec2.weak(),Vec2.weak()),n.set_space(e),n.set_active(!1),n.set_stiff(!1),svg.mousedown(function(t){t.stopPropagation(),t.preventDefault();for(var i=Snap.toLocal(bodyCon,{x:t.offsetX,y:t.offsetY}),l=Vec2.get(i.x,i.y),r=e.bodiesUnderPoint(l),a=0;a<r.get_length();a++){var p=r.at(a);if(p.isDynamic()){n.set_body2(p),n.get_anchor2().set(p.worldPointToLocal(l,!0)),n.set_active(!0),n.get_anchor1().setxy(i.x,i.y);break}}}),svg.mouseup(function(){n.set_active(!1);var e=n.get_body2();e&&e.dragEndStatic&&(e.get_velocity().set_x(0),e.get_velocity().set_y(0),e.set_angularVel(0)),n.set_body2(null)}),svg.mousemove(function(e){var t=Snap.toLocal(bodyCon,{x:e.offsetX,y:e.offsetY});n.get_active()&&n.get_anchor1().setxy(t.x,t.y)})},n.prototype.setJingdian=function(n){P.K=n},n.prototype.setWanyou=function(n){P.G=n},n.prototype.caseCollision=function(n){M.IF_COLLISION=n;for(var e=0;this.actionBodyArr.length>e;e++){this.actionBodyArr[e].changeSensorEnabled()}},n.prototype.setGravityG=function(n){this.g_gravity=n},n.prototype.setGravityR=function(n){this.r_gravity=n,this.updateGravity()},n.prototype.updateGravity=function(){var n=this.g_gravity,e=this.r_gravity/180*Math.PI;this.gravity.setxy(Math.cos(e)*n,Math.sin(e)*n),this.gravity_real.setxy(this.gravity.zpp_inner.x,M.Pixel2Value(this.gravity.zpp_inner.y)*M.COOR_DIRECTION_Y_N)},n.prototype.worldUpdate=function(){for(var n=this.space,e=n.get_bodies(),t=0;t<e.get_length();t++){var i=e.at(t),l=i.zpp_inner.userData;if(l){var r=l.view;if(r){var a=i.zpp_inner.posx,p=i.zpp_inner.posy,s=i.zpp_inner.rot,o=s,h=Math.sin(o),_=Math.cos(o);h=Math.floor(1e4*h)/1e4,_=Math.floor(1e4*_)/1e4,a=Math.max(-1e7+M.SCREEN_CENTER.x,Math.min(1e7+M.SCREEN_CENTER.x,a)),p=Math.max(-1e7+M.SCREEN_CENTER.y,Math.min(1e7+M.SCREEN_CENTER.y,p)),r.rotation=o,r.x=a,r.y=p}}}},n.prototype.gravityUpdate=function(){if(this.ifGravitation||this.ifJing)for(var n=this.actionBodyArr.length,e=0;n-1>e;e++)for(var t=this.actionBodyArr[e],i=e+1;n>i;i++){var l=this.actionBodyArr[i],r=t.weiyi_x,a=t.weiyi_y,p=l.weiyi_x,s=l.weiyi_y,o=p-r,h=s-a,_=o*o+h*h,u=Math.sqrt(_);if(this.ifGravitation){var d=P.G*t.kg_M*l.kg_M/_,c=d/u,x=o*c,v=h*c;this.gravForce0.zpp_inner.x=x,this.gravForce0.zpp_inner.y=v,t.applyImpulse(this.gravForce0,null,!1),this.gravForce0.zpp_inner.x=-x,this.gravForce0.zpp_inner.y=-v,l.applyImpulse(this.gravForce0,null,!1),this.baseData.showForceG.checked&&(t.showForce(t,l,{x:x,y:v},4),l.showForce(l,t,{x:-x,y:-v},4))}if(this.ifJing){var d=P.K*t.Q*l.Q/_,c=d/u,x=o*c,v=h*c;this.chargeForce0.zpp_inner.x=-x,this.chargeForce0.zpp_inner.y=-v,t.applyImpulse(this.chargeForce0,null,!1),this.chargeForce0.zpp_inner.x=x,this.chargeForce0.zpp_inner.y=v,l.applyImpulse(this.chargeForce0,null,!1),this.baseData.showForceK.checked&&(t.showForce(t,l,{x:-x,y:-v},2),l.showForce(l,t,{x:x,y:v},2))}}},n.prototype.gravitySourceUpdate=function(){for(var n=0;this.actionBodyArr.length>n;n++)for(var e=this.actionBodyArr[n],t=0;this.gravitySourceArr.length>t;t++){var i=this.gravitySourceArr[t],l=e.weiyi_x,r=e.weiyi_y,a=M.Pixel2Value(i.body.zpp_inner.posx),p=M.Pixel2Value(i.body.zpp_inner.posy),s=a-l,o=p-r;if(0!=s||0!=o){var h=s*s+o*o,_=P.G*e.kg_M*i.M/h,u=_/Math.sqrt(h),d=s*u,c=o*u;this.gravForce.zpp_inner.x=d,this.gravForce.zpp_inner.y=c,e.applyImpulse(this.gravForce,null,!1),this.baseData.showForceG.checked&&e.showForce(e,i,{x:d,y:c},4)}}},n.prototype.elecFieldUpdate=function(){for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n];if(0!=e.Q){this.elecForce.zpp_inner.x=0,this.elecForce.zpp_inner.y=0;for(var t=0;this.elecFieldArr.length>t;t++){var i=this.elecFieldArr[t],l=i.getStrength();if(0!=l){if(i.contains(e.body.zpp_inner.posx,e.body.zpp_inner.posy)){var r=e.Q*l,a=r*i.velocity.zpp_inner.x,p=r*i.velocity.zpp_inner.y;this.elecForce.zpp_inner.x+=a,this.elecForce.zpp_inner.y+=p,this.baseData.showForceD.checked&&e.showForce(e,i,{x:a,y:p},0)}}}0==this.elecForce.zpp_inner.x&&0==this.elecForce.zpp_inner.y||e.applyImpulse(this.elecForce,null,!1)}}},n.prototype.magnFieldUpdate=function(){for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n];if(0!=e.Q){var t=0,i=0,l=e.pre_velx,r=e.pre_vely;if(0!=e.pre_velo){for(var a=0;this.magnFieldArr.length>a;a++){var p=this.magnFieldArr[a],s=p.getStrength();if(0!=s){if(p.contains(e.body.zpp_inner.posx,e.body.zpp_inner.posy)){var o=-s*p.type,h=e.Q*s,_=l*h,u=r*h,d=o>0?-u:u,c=o>0?_:-_;t+=d,i+=c,this.baseData.showForceL.checked&&e.showForce(e,p,{x:d,y:c},1)}}}0==t&&0==i||(this.magnForce.zpp_inner.x=t,this.magnForce.zpp_inner.y=i,e.applyImpulse(this.magnForce,null,!1))}}}},n.prototype.pointChargeUpdate=function(){if(0!=this.pointChargeArr.length)for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n];if(0!=e.Q){for(var t=e.weiyi_x,i=e.weiyi_y,l=0,r=0,a=0;this.pointChargeArr.length>a;a++){var p=this.pointChargeArr[a];if(0!=p.Q){var s=M.Pixel2Value(p.body.zpp_inner.posx),o=M.Pixel2Value(p.body.zpp_inner.posy),h=t-s,_=i-o,u=h*h+_*_;if(0!=u){var d=P.K*p.Q*e.Q/u,c=d/Math.sqrt(u),x=h*c,v=_*c;l+=h*c,r+=_*c,this.baseData.showForceK.checked&&e.showForce(e,p,{x:x,y:v},2)}}}this.chargeForce.zpp_inner.x=l,this.chargeForce.zpp_inner.y=r,e.applyImpulse(this.chargeForce,null,!1)}}},n.prototype.dampAreaUpdate=function(){if(0!=this.dampAreaArr.length)for(var n=0;this.actionBodyArr.length>n;n++){var e=this.actionBodyArr[n],t=e.pre_velx,i=e.pre_vely,l=e.pre_velo;if(l>=1e-35){for(var r=0,a=0,p=0;this.dampAreaArr.length>p;p++){var s=this.dampAreaArr[p];if(s.caseV?M.Geom.intersectsBody(s.body,e.body):s.body.contains(e.body.get_position())){if(0==t&&0==i)continue;var o=1;if(s.caseV){var h,_=e.body.get_arbiters();_.foreach(function(n){n.get_body2()==s.body&&(h=n)}),o=h?h.get_overlap()*M.GRIG_M2P*M.GRIG_M2P:1}var u=s.D+o*s.A*(s.B*l+s.C*l*l),d=u/l,c=-t*d,x=-i*d;r+=c,a+=x,this.baseData.showForceN.checked&&e.showForce(e,s,{x:c,y:x},3)}}0==r&&0==a||(this.dampForce.zpp_inner.x=r,this.dampForce.zpp_inner.y=a,e.applyImpulse(this.dampForce,null,!1))}}},n.prototype.constraintUpdate=function(){for(var n=0;this.constraintArr.length>n;n++){this.constraintArr[n].updateDate()}},n.prototype.constraintUpdateView=function(){for(var n=0;this.constraintArr.length>n;n++){this.constraintArr[n].updateView()}},n.prototype.pulleyUpdateView=function(){for(var n=0;this.pulleyArr.length>n;n++){this.pulleyArr[n].updateView()}},n.prototype.arcTrackUpdate=function(){for(var n=0;this.actionBodyArr.length>n;n++)for(var e=this.actionBodyArr[n],t=0;this.arcTrackArr.length>t;t++)for(var i=this.arcTrackArr[t],l=e.body.zpp_inner.posx,r=e.body.zpp_inner.posy,a=0;5>a;a++){var p=new M.Vec2(l-i.body.zpp_inner.posx,r-i.body.zpp_inner.posy),s=p.get_length(),o=i.R-e.R,h=i.R+e.R;if(s>=o&&h>=s){var _=p.get_angle()/Math.PI*180;0>_&&(_+=360),s>i.R&&p.muleq(-1);var u=Math.min(i.endAngle,i.startAngle),d=Math.max(i.endAngle,i.startAngle);if(u>_||_>d)continue;var c=e.body.get_velocity(),x=c.dot(p);if(0==x)continue;var v=p.reflect(c);c.set(v);var z=v.get_x()-c.get_x(),y=v.get_y()-c.get_y(),f=z*e.kg_M/this.timeStep*M.GRIG_M2P,m=y*e.kg_M/this.timeStep*M.GRIG_M2P;e.body.applyImpulse(new M.Vec2(f,m));var b=Math.sqrt(e.friction*i.friction),f=e.pre_velx*e.kg_M,m=e.pre_vely*e.kg_M,g=f+e.applyForce.zpp_inner.x,w=m+e.applyForce.zpp_inner.y,C=(g*p.get_x()+w*p.get_y())/p.get_length(),k=b*C,O=new M.Vec2(p.get_x(),p.get_y());O.set_length(-C),this.baseData.showForceT.checked&&e.showForce(e,i,{x:O.get_x(),y:O.get_y()},9);var S=new M.Vec2(-p.get_y(),p.get_x()),P=c.dot(S);if(P>0)S.muleq(-1);else if(0===P)continue;S.set_length(k),e.applyImpulse(S),this.baseData.showForceM.checked&&e.showForce(e,i,{x:S.zpp_inner.x,y:S.zpp_inner.y},10)}}},n.prototype.straightTrackUpdate=function(){for(var n=0;this.actionBodyArr.length>n;n++)for(var e=this.actionBodyArr[n],t=e.body.zpp_inner.posx,i=e.body.zpp_inner.posy,l=0;this.straightTrackArr.length>l;l++){var r=this.straightTrackArr[l],a=new M.Vec2(r.start.x-t,r.start.y-i),p=new M.Vec2(r.start.x-r.end.x,r.start.y-r.end.y),s=a.dot(p),o=new M.Vec2(r.end.x-t,r.end.y-i),h=new M.Vec2(r.end.x-r.start.x,r.end.y-r.start.y),_=o.dot(h);if(s>=0&&_>=0){var u=Math.abs(a.cross(p)),d=u/r.pixel_length;if(e.R>=d){var c=new M.Vec2(-h.zpp_inner.y,h.zpp_inner.x),x=a.cross(p);0>x&&c.setxy(-p.zpp_inner.y,p.zpp_inner.x);var v=e.body.get_velocity(),z=c.reflect(v);v.set(z);var y=z.get_x()-v.get_x(),f=z.get_y()-v.get_y(),m=y*e.kg_M/this.timeStep*M.GRIG_M2P,b=f*e.kg_M/this.timeStep*M.GRIG_M2P;e.body.applyImpulse(new M.Vec2(m,b));var g=Math.sqrt(e.friction*r.friction),m=e.pre_velx*e.kg_M,b=e.pre_vely*e.kg_M,w=m+e.applyForce.zpp_inner.x,C=b+e.applyForce.zpp_inner.y,k=Math.abs((w*c.get_x()+C*c.get_y())/c.get_length()),O=new M.Vec2(c.get_x(),c.get_y());O.set_length(k),this.baseData.showForceT.checked&&e.showForce(e,r,{x:-O.get_x(),y:-O.get_y()},9);var S=new M.Vec2(-c.get_y(),c.get_x()),P=v.dot(S);if(P>0)S.muleq(-1);else if(0===P)continue;var T=g*k;S.set_length(T),e.applyImpulse(S),this.baseData.showForceM.checked&&e.showForce(e,r,{x:S.zpp_inner.x,y:S.zpp_inner.y},10)}}}},n.prototype.updateRopeWithNail=function(){for(var n=0;this.constraintArr.length>n;n++){var e=this.constraintArr[n];if("LightRope"==e.typeName)for(var t=0;this.nailArr.length>t;t++){var i=this.nailArr[t];if(!i.onBody&&(!e.centerNail||e.centerNail==i)){var l=k.getPoint2Line({x:i.body.zpp_inner.posx,y:i.body.zpp_inner.posy},{x:e.headsDate.b1x,y:e.headsDate.b1y},{x:e.headsDate.b2x,y:e.headsDate.b2y},e.headsDate.l);if(l.ifIn&&.1>l.dis){var r=i.body,a=e.joint.get_body1(),p=e.joint.get_body2(),s=r.get_id()+"_"+a.get_id(),o=r.get_id()+"_"+p.get_id(),h=M.ropeNailJoints.derects.get(s);if(h){var _=h*l.s;if(_>0)M.ropeNailJoints.derects.set(s,l.s),a.get_type()==M.BodyType.get_DYNAMIC()&&(M.ropeNailJoints.removeJoint(s),e.centerNail=null);else if(a.get_type()==M.BodyType.get_DYNAMIC()&&!M.ropeNailJoints.getJoint(s)){var u=k.getPointDistance({x:i.body.zpp_inner.posx,y:i.body.zpp_inner.posy},{x:e.headsDate.b1x,y:e.headsDate.b1y});M.ropeNailJoints.addJoint(r,a,s,u,l.s),e.centerNail=i}}else M.ropeNailJoints.derects.set(s,l.s);var d=M.ropeNailJoints.derects.get(o);if(d){var c=d*l.s;if(c>0)M.ropeNailJoints.derects.set(o,l.s),p.get_type()==M.BodyType.get_DYNAMIC()&&(M.ropeNailJoints.removeJoint(o),e.centerNail=null);else if(p.get_type()==M.BodyType.get_DYNAMIC()&&!M.ropeNailJoints.getJoint(o)){var x=k.getPointDistance({x:i.body.zpp_inner.posx,y:i.body.zpp_inner.posy},{x:e.headsDate.b2x,y:e.headsDate.b2y});M.ropeNailJoints.addJoint(r,p,o,x,l.s),e.centerNail=i}}else M.ropeNailJoints.derects.set(o,l.s)}}}}},n.prototype.addEuipment=function(n,e,t,i,l){var r=null,a=0;if(isNaN(n)){for(var p=0;this.nameAdded.length>p;p++)if(n==this.nameAdded[p].className){a=p;break}}else a=n,n=this.nameAdded[n].className;switch(n){case"ActionBody":r=this.addActionBody();break;case"UniformElecField":r=this.addElecField();break;case"UniformMagnField":r=this.addMagnField();break;case"DampArea":r=this.addDampArea();break;case"PointCharge":r=this.addPointCharge();break;case"GravitySource":r=this.addGravitySource();break;case"ReferencePoint":r=this.addReferencePoint();break;case"LightRope":r=this.addLightRope();break;case"LightBar":r=this.addLightBar();break;case"LightSpring":r=this.addLightSpring();break;case"StraightTrack":r=this.addStraightTrack();break;case"ArcTrack":r=this.addArcTrack();break;case"Nail":r=this.addNail();break;case"WoodBoard":r=this.addWoodBoard();break;case"WoodBlock":r=this.addWoodBoard(!0);break;case"WoodTriangle":r=this.addWoodTriangle();break;case"Ground":r=this.addGround();break;case"FixedPulley":r=this.addFixedPulley();break;case"ConveyorBelt":a=18,r=this.addConveyorBelt();break;case"TElecFiled":r=this.addTElecFiled();break;case"TMagnField":r=this.addTMagnField()}if(r&&i)return this.equipArr.push(r),M.setItemDataFromData(r.baseData,t),t.id&&(r.id=t.id),void(e&&(r.setXY(e.x,e.y),r.emit("move")));if(r){if(this.equipArr.push(r),t)for(var s in t){var o=t[s];if("body"!==s&&(o.typeName!=n&&o.typeName!=undefined)){var h=r.baseData[s];for(var _ in o)if(-1!=_.indexOf("_")){var u=_.substring(1);"events"!=u&&(h[u]=o[u])}}}var d=this.nameAdded[a].name;l&&l.lan_key&&(d=S.getLByKey(l.lan_key)),r.baseData.firstDropTitle.bodyName=d+this.nameAdded[a].index,this.nameAdded[a].index++,e&&r.setXY(e.x,e.y),r.emit("move")}},n.prototype.setConstrains=function(){for(var n=0;this.constraintArr.length>n;n++){var e=this.constraintArr[n],t=this.getBodyById(e.baseData.jointBody1.bodyName),i=this.getBodyById(e.baseData.jointBody2.bodyName);e.setBodys(t,i)}for(var n=0;this.pulleyArr.length>n;n++){var e=this.pulleyArr[n],t=this.getBodyById(e.baseData.jointBody1.bodyName),i=this.getBodyById(e.baseData.jointBody2.bodyName);e.setBodys(t,i)}},n.prototype.setNails=function(){for(var n=0;this.nailArr.length>n;n++){var e=this.nailArr[n];e.setBody(this.getBodyById(e.baseData.jointBody.bodyName))}},n.prototype.updateNails=function(n){for(var e=0;this.nailArr.length>e;e++){this.nailArr[e].updatePosition(n)}},n.prototype.deleteJoints=function(n){for(var e=0;this.nailArr.length>e;e++){this.nailArr[e].clearBody(n)}for(var e=0;this.constraintArr.length>e;e++){this.constraintArr[e].clearBody(n)}},n.prototype.getBodyById=function(n){for(var e=null,t=0;this.equipArr.length>t;t++){var i=this.equipArr[t];if(i.id==n){e=i;break}}return e},n.prototype.addElecField=function(){var n=new a;return this.elecFieldArr.push(n),n},n.prototype.addTElecFiled=function(){var n=new p;return this.elecFieldArr.push(n),n},n.prototype.addActionBody=function(){var n=new l;return this.actionBodyArr.push(n),n},n.prototype.addMagnField=function(){var n=new o;return this.magnFieldArr.push(n),n},n.prototype.addTMagnField=function(){var n=new s;return this.magnFieldArr.push(n),n},n.prototype.addPointCharge=function(){var n=new _;return this.pointChargeArr.push(n),n},n.prototype.addDampArea=function(){var n=new h;return this.dampAreaArr.push(n),n},n.prototype.addGravitySource=function(){var n=new r;return this.gravitySourceArr.push(n),n},n.prototype.addReferencePoint=function(){return new u},n.prototype.addLightRope=function(){var n=new d;return this.constraintArr.push(n),n},n.prototype.addLightBar=function(){var n=new c;return this.constraintArr.push(n),n},n.prototype.addLightSpring=function(){var n=new x;return this.constraintArr.push(n),n},n.prototype.addStraightTrack=function(){var n=new v;return this.straightTrackArr.push(n),n},n.prototype.addArcTrack=function(){var n=new z;return this.arcTrackArr.push(n),n},n.prototype.addNail=function(){var n=new y;return this.nailArr.push(n),n},n.prototype.addWoodBoard=function(n){var e=new f(n);return this.woodArr.push(e),e},n.prototype.addWoodTriangle=function(){var n=new m;return this.woodArr.push(n),n},n.prototype.addGround=function(){return new b},n.prototype.addConveyorBelt=function(){var n=new w;return this.cBeltArr.push(n),n},n.prototype.addLightStator=function(){var n=new C;return this.constraintArr.push(n),n},n.prototype.addFixedPulley=function(){var n=new g;return this.pulleyArr.push(n),n},n.prototype.deleteBody=function(n){switch(n.typeName){case"ActionBody":this.actionBodyArr.splice(this.actionBodyArr.indexOf(n),1);break;case"UniformElecField":case"TElecFiled":this.elecFieldArr.splice(this.elecFieldArr.indexOf(n),1);break;case"UniformMagnField":case"TMagnField":this.magnFieldArr.splice(this.magnFieldArr.indexOf(n),1);break;case"DampArea":this.dampAreaArr.splice(this.dampAreaArr.indexOf(n),1);break;case"PointCharge":this.pointChargeArr.splice(this.pointChargeArr.indexOf(n),1);break;case"GravitySource":this.gravitySourceArr.splice(this.gravitySourceArr.indexOf(n),1);break;case"ReferencePoint":break;case"LightRope":case"LightBar":case"LightSpring":case"LightStator":this.constraintArr.splice(this.constraintArr.indexOf(n),1);break;case"StraightTrack":this.straightTrackArr.splice(this.straightTrackArr.indexOf(n),1);break;case"ArcTrack":this.arcTrackArr.splice(this.arcTrackArr.indexOf(n),1);break;case"Nail":this.nailArr.splice(this.nailArr.indexOf(n),1);break;case"WoodBoard":case"WoodBlock":case"WoodTriangle":this.woodArr.splice(this.woodArr.indexOf(n),1);break;case"Ground":break;case"FixedPulley":this.pulleyArr.splice(this.pulleyArr.indexOf(n),1);break;case"ConveyorBelt":this.cBeltArr.splice(this.cBeltArr.indexOf(n),1)}this.equipArr.splice(this.equipArr.indexOf(n),1);this.space.get_bodies();n.destroy()},n.prototype.startWork=function(){for(var n=0;this.equipArr.length>n;n++){var e=this.equipArr[n];e.baseData&&e.baseData.motionHide&&e.baseData.motionHide.checked&&e.show(!1),e.setSpeed&&e.setSpeed(),e.updateShow&&e.updateShow()}for(var n=0;this.pulleyArr.length>n;n++){this.pulleyArr[n].start()}this.hasPaused=!1},n.prototype.endWork=function(){for(var n=0;this.equipArr.length>n;n++){this.equipArr[n].show(!0)}for(var n=0;this.actionBodyArr.length>n;n++){this.actionBodyArr[n].reset()}for(var n=0;this.woodArr.length>n;n++){this.woodArr[n].reset()}for(var n=0;this.constraintArr.length>n;n++){var e=this.constraintArr[n];e.centerNail&&(e.centerNail=null),e.update()}for(var n=0;this.pulleyArr.length>n;n++){this.pulleyArr[n].reset()}for(var n=0;this.elecFieldArr.length>n;n++){var t=this.elecFieldArr[n];t.getStrength()}for(var n=0;this.magnFieldArr.length>n;n++){var t=this.magnFieldArr[n];t.getStrength()}},n}()},710:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(464),r=t(459),a=t(552),p=t(466),s=t(501),o=t(729),h=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.showCoor=new l("显示坐标系",!0),this.showGrid=new l("显示网格线",!0),this.showThin=new l("显示细网格线",!1),this.showSolid=new l("加粗线条",!1),this.gridScale=new r("每格代表长度",1,1e3,1,10,!0,"m"),this.coor_y=new s(1,"Y轴方向",["向下","向上"]),this.adsorpGrid=new l("吸附到网格线",!1),this.fontSize=new o("坐标文字大小",10,20,1,10),this.coorColor=new p,this.coorColor.typeName="ColorSelector",this.coorColor.color=this.body.backGroudColor,this.coorColor.bodyName="舞台背景色",this.coorColor.colorGroup=[{type:"circle",fill:"#343941"},{type:"circle",fill:"#575d67"},{type:"circle",fill:"#FFFFFF"},{type:"circle",fill:"#f6ce55"},{type:"circle",fill:"#2763ad"},{type:"circle",fill:"#38a548"},{type:"circle",fill:"rgb(255, 255, 255, 0)"}],this.backColors=[{y:"#00FF30",x:"#FF0054",a:"#434954",b:"#566171"},{y:"#00FF30",x:"#FF0054",a:"#646a75",b:"#7d8593"},{y:"#00FF30",x:"#FF0054",a:"#e0e0e0",b:"#c0c0c0"},{y:"#00A820",x:"#FF0054",a:"#e4bf4f",b:"#bb9b3b"},{y:"#00FF30",x:"#FF0054",a:"#2f73c6",b:"#4086dd"},{y:"#00FF30",x:"#FF0054",a:"#3db84f",b:"#45d25a"}],this.foldBtn=new a("场景显示设置",!1,"icon1"),this.foldBtnArr=[this.showCoor,this.fontSize,this.showGrid,this.gridScale,this.showThin,this.showSolid,this.coor_y,this.adsorpGrid],this.listArr=[this.foldBtn,this.foldBtnArr],this.checkChange(),this.gridScale.showValue=10}return n.prototype.checkChange=function(){var n=this;this.showCoor.on("change",function(){n.body.changeData(),n.updateFoldArr()}),this.showGrid.on("change",function(){n.body.changeData(),n.updateFoldArr()}),this.showThin.on("change",function(){n.body.changeData()}),this.showSolid.on("change",function(){n.body.changeData()}),this.gridScale.on("change",function(){n.body.setGridScaleG(n.gridScale.showValue)}),this.fontSize.on("change",function(){n.body.setFontSize(n.fontSize.showValue)}),n.coor_y.on("change",function(){n.coor_y._checked=n.coor_y._checked?1:0,n.body.setCoorY(n.coor_y.checked)}),this.adsorpGrid.on("change",function(){n.body.setIfAdsorp(n.adsorpGrid.checked)}),this.coorColor.on("change",function(){for(var e,t=0;6>t;t++){if(n.coorColor.color==n.coorColor.colorGroup[t].fill){e=n.backColors[t];break}}n.body.changeBackColor(n.coorColor.color,e)}),this.foldBtn.on("change",function(){n.updateFoldArr(),h.switchFold(n.foldBtn)}),this.foldBtn.emit("change"),this.updateFoldArr()},n.prototype.updateFoldArr=function(){this.fontSize.styleHeight=this.showCoor.checked?40:0,this.gridScale.styleHeight=this.showGrid.checked?68:0,this.foldBtnArr.styleHeight=this.foldBtn.folded?0:250+this.fontSize.styleHeight+this.gridScale.styleHeight,this.foldBtnArr.styleTransparent=!0},n}()},711:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(464),p=(t(466),t(475)),s=t(728),o=t(552),h=t(501),_=t(447);n.exports=function(){function n(e){var t=this;i(this,n);var u=this;this.body=e,this.default_g=10,this.caseGrave=new a("考虑重力"),this.g=new r("重力加速度",0,10*this.default_g,.1,this.default_g,!0,"m/s²"),this.g.canBeAny=!0,this.a0=[],this.default_k="9e9",this.caseJing=new a("考虑物体间库仑力"),this.k=new r("静电力恒量",0,18e9,1,this.default_k,!0,"N·m²/C²"),this.k.canBeAny=!0,this.default_G=6.67e-11,this.caseWan=new a("考虑物体间万有引力"),this.G=new r("万有引力恒量",0,2,.1,this.default_G,!0,"N·m²/kg²"),this.G.canBeAny=!0,this.caseCollision=new a("考虑运动物体间碰撞",!0),this.caseCollisionSound=new a("运动物体间碰撞音效",_.caseCollisionSound),this.clearButton=new l("还原默认值",""),this.clearButton.typeName="ChangeShowButton",this.maxPlayTime=new r("运行时间",1,1e3,1,3600,!0,"s",0,!0),this.playSpeed=new r("速率",.1,10,.1,1),this.playSpeed.style=2,this.foldBool=new o("场景作用力设置",!0,"icon2"),this.foldBoolArr=[this.caseGrave,this.caseJing,this.caseWan,this.caseCollision,this.maxPlayTime],this.headerPos=new h(0,"功能栏位置",["顶端","底端"]),this.foldCommon=new o("通用显示设置",!0,"icon4"),this.foldCommonArr=[this.headerPos,this.caseCollisionSound,_.canvasStage.coor.baseData.coorColor],this.foldCommon.addListener("change",function(){t.foldCommonArr.styleHeight=t.foldCommon.folded?0:178,_.switchFold(t.foldCommon)}),this.foldCommonArr.styleTransparent=!0,this.foldCommon.emit("change"),this.foldBool.on("change",function(){u.foldBoolArr.styleHeight=u.foldBool.folded?0:228,_.switchFold(u.foldBool)}),this.foldBool.emit("change"),this.foldBoolArr.styleTransparent=!0,this.foldValues=new o("场景常量设置",!0,"icon3"),this.foldValuesArr=[u.g,u.k,u.G,u.clearButton],this.foldValues.on("change",function(){u.foldValuesArr.styleHeight=u.foldValues.folded?0:255,_.switchFold(u.foldValues)}),this.foldValues.emit("change"),this.foldValuesArr.styleTransparent=!0,this.listArr=[new p,this.foldBool,this.foldBoolArr,new p,this.foldValues,this.foldValuesArr,new p],this.showName=new a("显示名称"),this.showValue=new a("显示数值"),this.showDiscom=new a("显示分解"),this.showAngle=new a("显示角度"),this.showDataArr=[this.showName,this.showValue,this.showDiscom,this.showAngle],this.showDataArr.stylePadding="0px 8px",this.showDataArr.styleHeight="80px",this.showDataArr.styleTransparent=!0,this.showDataArr.forEach(function(n){n.typeName="CheckButton",n.canSwap=!0}),this.adjustArrow=new l("调整箭头适应屏幕"),this.tagsItemData=new s(["力","速度","加速度"],0),this.tagsList=[],this.ifShowForce=new a("力"),this.forceScale=new r("力箭头尺寸缩放",1,1e3,.01,1,!0,"m/N",2,!0),this.forceScale.canBeAny=!0,this.showForceT=new a("弹力(F)"),this.showForceH=new a("合力(ΣF)"),this.showForceZ=new a("重力(G)"),this.showForceD=new a("电场力(F)"),this.showForceL=new a("洛伦兹力(F)"),this.showForceM=new a("摩擦力(F)"),this.showForceN=new a("阻尼力(F)"),this.showForceG=new a("万有引力(F)"),this.showForceK=new a("电荷力(F)"),this.showForceO=new a("外力"),this.forceArr=[this.showForceH,this.showForceD,this.showForceN,this.showForceK,this.showForceZ,this.showForceM,this.showForceT,this.showForceL,this.showForceG,this.showForceO],this.forceArr.stylePadding="0px 8px",this.ifShowForceArr=[this.forceScale,this.forceArr],setTimeout(function(){t.forceArr.forEach(function(n){n.typeName="CheckButton"})},1e3),this.ifShowForceArr.ngStyle=this.forceScale.ngStyle=this.forceArr.ngStyle={color:"#a5a5a5","font-size":"14px"},this.ifShowVol=new a("速度"),this.volScale=new r("速度箭头尺寸缩放",1,1e3,.01,10,!0,"s",2,!0),this.volScale.canBeAny=!0,this.ifShowAVol=new a("加速度"),this.avolScale=new r("加速度箭头尺寸缩放",1,1e3,.01,5,!0,"s²",2,!0),this.avolScale.canBeAny=!0,this.lineShow=new o("实验显示设置",!1,"icon5",!1),this.biaozhuShow=new o("标注显示设置",!1,"icon6",!1),this.showPLine=new a("显示等势线",_.IF_SHOW_PLINE),this.showELine=new a("显示电场线",_.IF_SHOW_ELINE),this.lineArr=[this.showPLine,this.showELine],this.showList=[this.lineShow,this.lineArr,new p,this.biaozhuShow,this.showDataArr,new p("",!1,!0),this.ifShowForce,this.ifShowForceArr,this.ifShowVol,this.volScale,this.ifShowAVol,this.avolScale],this.checkChange()}return n.prototype.changeGScale=function(){},n.prototype.checkChange=function(){var n=this,e=this;this.caseGrave.on("change",function(){e.a0.splice(0),e.body.setGravityG(0),e.caseGrave.checked&&(e.a0.push(e.g),e.body.setGravityG(e.g.showValue))}),this.g.on("change",function(){e.body.setGravityG(e.caseGrave.checked?e.g.showValue:0)}),this.caseJing.on("change",function(){e.body.ifJing=e.caseJing.checked}),this.k.on("change",function(){e.body.setJingdian(e.k.showValue)}),this.caseWan.on("change",function(){e.body.ifGravitation=e.caseWan.checked}),this.G.on("change",function(){e.body.setWanyou(e.G.showValue)}),this.caseCollision.on("change",function(){e.body.caseCollision(e.caseCollision.checked)}),this.caseCollisionSound.on("change",function(){e.body.caseCollisionSound(e.caseCollisionSound.checked)}),this.clearButton.on("click",function(){e.g.showValue=e.default_g,e.k.showValue=e.default_k,e.G.showValue=e.default_G}),this.ifShowForce.on("change",function(){n.ifShowForceArr.styleHeight=n.ifShowForce.checked?220:0}),this.ifShowForce.emit("change"),this.ifShowVol.on("change",function(){n.volScale.styleHeight=n.ifShowVol.checked?68:0}),this.ifShowVol.emit("change"),this.ifShowAVol.on("change",function(){n.avolScale.styleHeight=n.ifShowAVol.checked?68:0}),this.ifShowAVol.emit("change"),this.forceScale.on("change",function(){_.FORCE_SHOW_SCALE=e.forceScale.showValue}),this.volScale.on("change",function(){_.VOL_SHOW_SCALE=e.volScale.showValue}),this.avolScale.on("change",function(){_.AVOL_SHOW_SCALE=e.avolScale.showValue}),this.playSpeed.on("change",function(){isNaN(n.playSpeed.showValue)&&(n.playSpeed._showValue=1)}),this.showPLine.on("change",function(){_.IF_SHOW_PLINE=e.showPLine.checked,_.main.emit(_.CHARGES_CHANGE)}),this.showELine.on("change",function(){_.IF_SHOW_ELINE=e.showELine.checked,_.main.emit(_.CHARGES_CHANGE)}),this.headerPos.on("change",function(){_.main.emit(_.CHANG_EHEADER_TOP,n.headerPos.checked)})},n}()},712:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(464),p=t(466),s=t(475),o=t(552),h=t(629),_=t(630),u=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.xPosition=new r("X坐标",-1e3,1e3,1,0,!0,"m"),this.yPosition=new r("Y坐标",-1e3,1e3,1,0,!0,"m"),this.xPosition.canBeAny=!0,this.yPosition.canBeAny=!0,this.xVelocity=new r("速度V(X)",-1e3,1e3,1,0,!0,"m/s"),this.yVelocity=new r("速度V(Y)",-1e3,1e3,1,0,!0,"m/s"),this.xVelocity.canBeAny=!0,this.yVelocity.canBeAny=!0,this.dVelocity=new r("速率",-1e3,1e3,1,0,!0,"m/s"),this.oVelocity=new r("角度",-360,360),this.ifShowForce=new a("力"),this.ifShowForce.typeName="CheckButton",this.ifShowForce.canSwap=!0,this.forceScale=new r("箭头缩放比例",1,1e3,1,10,!0,"N/m"),this.forceArr0=[],this.ifShowVol=new a("速度"),this.ifShowVol.typeName="CheckButton",this.ifShowVol.canSwap=!0,this.ifShowAVol=new a("加速度"),this.ifShowAVol.typeName="CheckButton",this.ifShowAVol.canSwap=!0;var t=[{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#00f"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#f00"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#0f0"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#aaa:10-#1966BC"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#FF9BFC"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#00FF31"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#2A08A0"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#B0EA00"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#1769FB"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#28272C"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#00BFCC"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#000000"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#FB291C"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#C8C8CA"},{type:"gradient",fill:"r(0.5, 0.5, 0.6)#ddd-#97160D"}];this.bodyColor=new p,this.bodyColor.typeName="ColorSelector",this.firstDropTitle=new p,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="运动物体",this.bodyM=new r("质量",1e-40,1e3,1,1,!0,"kg"),this.bodyM.canBeAny=!0,this.bodyR=new r("半径",1,1e3,1,10,!0,"m"),this.bodyQ=new r("电荷量",-1e3,1e3,.01,this.body.Q,!0,"C"),this.bodyQ.canBeAny=!0,this.bodyT=new r("碰撞系数",0,1,.01,1),this.bodyC=new r("粗糙程度",0,1,.01,0),this.bodyData=[this.bodyR,this.bodyM,this.bodyQ,this.bodyT,this.bodyC],this.ifShowTrac=new a("显示轨迹"),this.showTracTime=new r("轨迹停留时间",1,300,1,this.body.trajectoryDelay,!0,"s"),this.ifShowTrac0=[],this.ifShowPhoto=new a("启用闪照"),this.showPhotoycle=new r("闪照周期",.1,5,.1,1,!0,"s"),this.ifShowPhotoTime=new a("显示闪照时间点"),this.ifShowPhone0=[this.showPhotoycle,this.ifShowPhotoTime],this.ifAsMassPoint=new a("启用质点"),this.outForce0=new o("外力1",!0),this.outForce0_x=new r("X方向",-1e3,1e3,.1,0,!0,"N"),this.outForce0_y=new r("Y方向",-1e3,1e3,.1,0,!0,"N"),this.outForce0_x.canBeAny=!0,this.outForce0_y.canBeAny=!0,this.outForce0_delay=new h(0,10,"起止时间","S"),this.outForce0_arr=[this.outForce0_x,this.outForce0_y,this.outForce0_delay],this.outForce1=new o("外力2",!0),this.outForce1_x=new r("X方向",-1e3,1e3,.1,0,!0,"N"),this.outForce1_y=new r("Y方向",-1e3,1e3,.1,0,!0,"N"),this.outForce1_x.canBeAny=!0,this.outForce1_y.canBeAny=!0,this.outForce1_delay=new h(0,10,"起止时间","s"),this.outForce1_arr=[this.outForce1_x,this.outForce1_y,this.outForce1_delay],this.shapeList=new _([1,2,3,4]),this.showValueSetingButton=new l("","",0,"rightbar_btn_shezhi_pressed.png",!1,!0,15),this.showValueSetingButton.preventEvent=!0,this.motionHide=new a("运行时隐藏",!1);var d=new l("显示图像","",0,"icon_xianshituxiang_pressed.png",!1),c=new l("显示","",1,"icon_xianshi_pressed.png"),x=new l("材质/外观","",2,"icon_caizhi_pressed.png"),v=new l("速度","",3,"icon_sudu_pressed.png"),z=new l("添加外力","",4,"icon_power_pressed.png"),y=new l("贴图","",5,"icon_skin_pressed.png");this.firstDrop=[d,c,x,v,z,y],this.secondDrop=[null,[this.motionHide,this.xPosition,this.yPosition,new s,this.ifShowTrac,this.showTracTime,new s,this.ifShowPhoto,this.ifShowPhone0],[this.ifAsMassPoint,new s(null,!1,!0),this.bodyColor,new s(null,!1,!0),this.bodyR,this.bodyM,this.bodyQ,this.bodyT,this.bodyC],[this.xVelocity,this.yVelocity,this.dVelocity,this.oVelocity,new s(null,!1,!0),new s("可视化",!0),this.ifShowForce,this.ifShowVol,this.ifShowAVol,this.showValueSetingButton],[this.outForce0,this.outForce0_arr,new s,this.outForce1,this.outForce1_arr],[this.shapeList]],this.secondData=[],this.secondData.index=0,this.compList=[this.firstDropTitle,d,c,x,v,z,y];for(var f=this,m=0;this.firstDrop.length>m;m++){this.firstDrop[m].on("click",function(){f.secondData.splice(0);var n=this;0==n.index?u.main.emit(u.EVENT_SHOW_PLOT,{element:f.body}):(f.secondData.index=n.index,Array.prototype.push.apply(f.secondData,f.secondDrop[n.index]))})}this.checkDataChange(),this.bodyColor.color=t[Math.floor(15*Math.random())].fill}return n.prototype.changeVScale=function(){this.body.setZSpeed(u.Value2Pixel(this.xVelocity.showValue),u.Value2Pixel(this.yVelocity.showValue))},n.prototype.checkDataChange=function(){function n(){var n=u.Value2Pixel(t.xVelocity.showValue),e=u.Value2Pixel(t.yVelocity.showValue);t.body.setZSpeed(n,e);var i=u.Pixel2Value(t.body.o_speed.v);t.dVelocity._showValue=i,t.oVelocity._showValue=t.body.o_speed.angle/Math.PI*180}function e(){var n=u.Value2Pixel(t.dVelocity.showValue);t.body.setOSpeed(n,t.oVelocity.showValue/180*Math.PI);var e=u.Pixel2Value(t.body.z_speed.x),i=u.Pixel2Value(t.body.z_speed.y);t.xVelocity._showValue=e,t.yVelocity._showValue=i}var t=this;this.xVelocity.on("change",n),this.yVelocity.on("change",n),this.dVelocity.on("change",e),this.oVelocity.on("change",e),this.ifShowForce.on("change",function(){t.forceArr0.splice(0),t.ifShowForce.checked&&t.forceArr0.push(t.forceScale,t.forceArr)}),this.ifShowTrac.on("change",function(){t.showTracTime.styleHeight=t.ifShowTrac.checked?63:0,t.body.drawTrajectory=t.ifShowTrac.checked}),this.ifShowTrac.emit("change"),this.showTracTime.on("change",function(){t.body.trajectoryLength=60*t.showTracTime.showValue,t.body.trajectoryDelay=t.showTracTime.showValue}),this.ifShowPhoto.on("change",function(){t.ifShowPhone0.styleHeight=t.ifShowPhoto.checked?103:0}),this.ifShowPhoto.emit("change"),this.ifAsMassPoint.on("change",function(n){t.body.setAsMassPoint(t.ifAsMassPoint.checked)}),this.bodyColor.on("change",function(n){t.body.changeColor(t.bodyColor.color)}),this.bodyR.on("change",function(){var n=u.Value2Pixel(t.bodyR.showValue);t.body.setR(n)}),this.bodyM.on("change",function(){t.bodyM.showValue>0||(t.bodyM.showValue=t.bodyM.minValue),t.body.setMass(t.bodyM.showValue)}),this.bodyQ.on("change",function(){t.body.setQ(t.bodyQ.showValue)}),this.bodyT.on("change",function(){t.body.setElasticity(t.bodyT.showValue)}),this.bodyC.on("change",function(){t.body.setFriction(t.bodyC.showValue)}),this.xPosition.on("change",function(){var n=u.Value2Pixel(t.xPosition.showValue),e=u.Value2Pixel(t.yPosition.showValue);t.body.setXY(n,e)}),this.yPosition.on("change",function(){var n=u.Value2Pixel(t.xPosition.showValue),e=u.Value2Pixel(t.yPosition.showValue);t.body.setXY(n,e)}),this.body.on("move",function(){var n=u.Pixel2Value(t.body.body.zpp_inner.posx),e=u.Pixel2Value(t.body.body.zpp_inner.posy);t.xPosition._showValue=+n.toFixed(2),t.yPosition._showValue=+e.toFixed(2);var i=u.Pixel2Value(t.body.R);t.bodyR._showValue=+i.toFixed(2)}),this.firstDropTitle.on("change",function(n){t.body.plotData.bodyName.title=t.firstDropTitle.bodyName}),this.outForce0.on("change",function(){t.outForce0_arr.styleHeight=t.outForce0.folded?0:194}),this.outForce0.emit("change"),this.outForce0_x.on("change",function(){t.body.outForce0.setxy(t.outForce0_x.showValue,t.outForce0_y.showValue)}),this.outForce0_y.on("change",function(){t.body.outForce0.setxy(t.outForce0_x.showValue,t.outForce0_y.showValue)}),this.outForce0_delay.on("change",function(){t.body.outForce0_delay[0]=t.outForce0_delay.start,t.body.outForce0_delay[1]=t.outForce0_delay.end}),this.outForce1.on("change",function(){t.outForce1_arr.styleHeight=t.outForce1.folded?0:194}),this.outForce1.emit("change"),this.outForce1_x.on("change",function(){t.body.outForce1.setxy(t.outForce1_x.showValue,t.outForce1_y.showValue)}),this.outForce1_y.on("change",function(){t.body.outForce1.setxy(t.outForce1_x.showValue,t.outForce1_y.showValue)}),this.outForce1_delay.on("change",function(){t.body.outForce1_delay[0]=t.outForce1_delay.start,t.body.outForce1_delay[1]=t.outForce1_delay.end}),this.showValueSetingButton.on("click",function(){u.main.emit(u.SHOW_FORCE_SETTING)}),this.shapeList.on("change",function(){var n=t.shapeList.baseUrl+t.shapeList.selected+".svg";-1==t.shapeList.selected&&(n=""),""!==n&&t.body.fillImage(n)}),this.changeCoorDirectionNew()},n.prototype.changeCoorDirectionNew=function(){this.body.upSide()},n}()},713:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(459),r=t(466),l=t(459),a=t(485),p=t(464),s=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="弧轨道",this.firstDrop=[],this.staticFriction=new l("静摩擦系数",0,1,.01,0,!0,"",1),this.dynamicFriction=new l("摩擦系数",0,1,.01,0,!0,"",1),this.elasticity=new l("弹性系数",0,1,.1,1,!0,"",1),this.X=new l("坐标X",-1e3,1e3,.1,0,!0,"m"),this.Y=new l("坐标Y",-1e3,1e3,.1,0,!0,"m"),this.pixel_r=100;var t=s.Pixel2Value(this.pixel_r);this.R=new l("半径",1,100,1,t,!0,"m"),this.startAngle=new a(0,"起始角度"),this.endAngle=new a(180,"结束角度"),this.secondDrop=[],this.motionHide=new p("运行时隐藏",!1),this.compList=[this.firstDropTitle,this.motionHide,this.dynamicFriction,this.X,this.Y,this.R,this.startAngle,this.endAngle],this.checkChange()}return n.prototype.checkChange=function(){var n=this;this.X.on("change",function(){var e=s.Value2Pixel(n.X.showValue),t=s.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.Y.on("change",function(){var e=s.Value2Pixel(n.X.showValue),t=s.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.body.on("move",function(){var e=s.Pixel2Value(n.body.body.zpp_inner.posx),t=s.Pixel2Value(n.body.body.zpp_inner.posy);n.X._showValue=e.toFixed(2),n.Y._showValue=t.toFixed(2);var i=s.Pixel2Value(n.pixel_r);n.R._showValue=i}),this.R.on("change",function(){var e=s.Value2Pixel(n.R.showValue);n.pixel_r=e,n.body.changeR(e)}),this.startAngle.on("change",function(){n.body.changeStartAngle(n.startAngle.value)}),this.endAngle.on("change",function(){n.body.changeEndAngle(n.endAngle.value)}),this.staticFriction.on("change",function(){}),this.dynamicFriction.on("change",function(){n.body.setDynamicFriction(n.dynamicFriction.showValue),n.body.setStaticFriction(n.dynamicFriction.showValue+.1)}),this.elasticity.on("change",function(){n.body.setElasticity(n.elasticity.showValue)})},n}()},714:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(466),r=t(464),a=t(459),p=t(447),s=(t(468),t(485));n.exports=function(){function n(e){var t=this;i(this,n),this.body=e,this.firstDropTitle=new l,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="传送带",this.motionHide=new r("运行时隐藏",!1),this.xPosition=new a("坐标X",-100,100,.1,0,!0,"m"),this.yPosition=new a("坐标Y",-100,100,.1,0,!0,"m"),this.speed=new a("速度",0,100,.1,p.Pixel2Value(this.body.speed),!0,"m/s"),this.angle=new s(0,"角度"),this.length=new a("长度",10,100,1,p.Pixel2Value(this.body.beltWidth),!0,"m"),this.bodyT=new a("碰撞系数",0,1,.01,this.body.material.get_elasticity()),this.bodyC=new a("粗糙程度",0,1,.01,this.body.material.get_staticFriction()),this.reverse=new r("反向",!1),this.compList=[this.firstDropTitle,this.motionHide,this.speed,this.angle,this.length,this.bodyT,this.bodyC,this.reverse],this.xPosition.on("change",function(){var n=p.Value2Pixel(t.xPosition.showValue),e=p.Value2Pixel(t.yPosition.showValue);t.body.setXY(n,e)}),this.yPosition.on("change",function(){var n=p.Value2Pixel(t.xPosition.showValue),e=p.Value2Pixel(t.yPosition.showValue);t.body.setXY(n,e)}),this.body.on("move",function(){var n=p.Pixel2Value(t.body.body.zpp_inner.posx),e=p.Pixel2Value(t.body.body.zpp_inner.posy);t.xPosition._showValue=n.toFixed(2),t.yPosition._showValue=e.toFixed(2)}),this.angle.on("change",function(){t.body.setRotate(t.angle.value/180*Math.PI)}),this.length.on("change",function(){t.body.setLength(p.Value2Pixel(t.length.showValue))}),this.bodyT.on("change",function(){t.body.setElasticity(t.bodyT.showValue)}),this.bodyC.on("change",function(){t.body.setFriction(t.bodyC.showValue)}),this.speed.on("change",function(){var n=p.Value2Pixel(t.speed.showValue);t.body.setSurSpeed(n)}),this.reverse.on("change",function(){t.body.reverse(t.reverse.checked)})}return n.prototype.changeVScale=function(){this.body.setSurSpeed(p.Value2Pixel(this.speed.showValue),0)},n}()},715:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(466),p=t(475),s=t(464),o=t(447);n.exports=function(){function n(e){i(this,n),this.body=e;var t=["坐标边界","阻尼参数"];this.firstDrop=[];for(var o=0;2>o;o++)this.firstDrop.push(new l(t[o],t[o],o));this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="阻尼介质",this.uEdge=new r("上",-100,100,.1,0),this.dEdge=new r("下",-100,100,.1,200),this.lEdge=new r("左",-100,100,.1,0),this.rEdge=new r("右",-100,100,.1,200),this.caseV=new s("考虑体积的影响",!1),this.sc=new p("阻尼=k0+k1*(k2*v+k3*v²)"),this.A=new r("阻尼系数k1",0,10,.01,.1,!0,"",2),this.B=new r("一次方系数k2",0,10,.01,.1,!0,"",2),this.C=new r("二次方系数k3",0,10,.01,.1,!0,"",2),this.D=new r("常数k0",0,10,.01,.1,!0,"",2),this.D.canBeAny=!0,this.secondDrop=[[this.uEdge,this.dEdge,this.lEdge,this.rEdge],[this.caseV,this.sc,this.D,this.A,this.B,this.C]],this.motionHide=new s("运行时隐藏",!1),this.compList=[this.firstDropTitle,this.motionHide,this.caseV,this.sc,this.D,this.A,this.B,this.C,new p,[this.uEdge,this.dEdge,this.lEdge,this.rEdge]],this.checkChange(),this.changeCoorDirectionNew()}return n.prototype.checkChange=function(){function n(){var n=o.Value2Pixel(e.lEdge.showValue),t=o.Value2Pixel(e.uEdge.showValue),i=o.Value2Pixel(e.rEdge.showValue-e.lEdge.showValue),l=Math.abs(o.Value2Pixel(e.dEdge.showValue-e.uEdge.showValue));e.body.setXY(n,t),e.body.setWH(i,l)}var e=this;this.caseV.on("change",function(){e.sc.title=e.caseV.checked?"阻尼=k0+V*k1*(k2*v+k3*v²)":"阻尼=k0+k1*(k2*v+k3*v²)",e.body.caseV=e.caseV.checked}),this.A.on("change",function(){e.body.A=+e.A.showValue}),this.B.on("change",function(){e.body.B=+e.B.showValue}),this.C.on("change",function(){e.body.C=+e.C.showValue}),this.D.on("change",function(){e.body.D=+e.D.showValue}),this.lEdge.on("change",function(){var t=o.Pixel2Value(20);e.rEdge.showValue>e.lEdge.showValue||(e.rEdge.showValue=e.lEdge.showValue+t),n()}),this.rEdge.on("change",function(){var t=o.Pixel2Value(20);e.rEdge.showValue>e.lEdge.showValue||(e.lEdge.showValue=e.rEdge.showValue-t),n()}),this.uEdge.on("change",function(){var t=o.Pixel2Value(20);e.dEdge.showValue>e.uEdge.showValue||(e.dEdge.showValue=e.uEdge.showValue+t),n()}),this.dEdge.on("change",function(){var t=o.Pixel2Value(20);e.dEdge.showValue>e.uEdge.showValue||(e.uEdge.showValue=e.dEdge.showValue-t),n()}),this.body.on("move",function(){var n=e.body,t=o.Pixel2Value(n.x),i=o.Pixel2Value(n.y),l=o.Pixel2Value(n.x+n.w),r=o.Pixel2Value(n.y+n.h);e.lEdge._showValue=t.toFixed(2),e.uEdge._showValue=i.toFixed(2),e.rEdge._showValue=l.toFixed(2),e.dEdge._showValue=r.toFixed(2)})},n.prototype.changeCoorDirectionNew=function(){this.uEdge.name=-1==o.COOR_DIRECTION_Y_N?"下":"上",this.dEdge.name=-1==o.COOR_DIRECTION_Y_N?"上":"下"},n}()},716:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(485),a=t(466),p=t(475),s=t(464),o=t(447),h=t(501);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="匀强电场",this.eleMode=new h(0,"电场模式",["恒定","正弦","矩形"]),this.eStrength=new l("电场强度",0,100,.1,1,!0,"N/C"),this.eStrength.canBeAny=!0,this.angle=new r(0,"电场方向"),this.motionHide=new s("运行时隐藏",!1),this.shape=new h(0,"形状",["矩形","圆形"]),this.uEdge=new l("上",-1e3,100,.1,0,!0,"m"),this.dEdge=new l("下",-1e3,100,.1,200,!0,"m"),this.lEdge=new l("左",-1e3,1e3,.1,0,!0,"m"),this.rEdge=new l("右",-1e3,1e3,.1,200,!0,"m"),this.circleX=new l("坐标X",-100,100,.1,100,!0,"m"),this.circleY=new l("坐标Y",-100,100,.1,100,!0,"m"),this.circleR=new l("半径",1,100,.1,10,!0,"m"),this.constTitle=new p("电场强度=A*sin(B*t+C)"),this.constA=new l("常数A",-100,100,.01,1),this.constB=new l("常数B",-100,100,.01,1),this.constC=new l("常数C",-100,100,.01,0),this.cycle1=new l("周期1",0,100,.01,1,!0,"S"),this.eStrength1=new l("强度",-100,100,.01,1,!0,"N/C"),this.cycle2=new l("周期2",0,100,.01,1,!0,"S"),this.eStrength2=new l("强度",-100,100,.01,-1,!0,"N/C"),this.eStrengthArr=[this.eStrength],this.shapeArr=[this.uEdge,this.dEdge,this.lEdge,this.rEdge],this.compList=[this.firstDropTitle,this.motionHide,this.eleMode,this.eStrengthArr,this.angle,this.shape,new p,this.shapeArr],this.checkChange(),this.changeCoorDirectionNew()}return n.prototype.getEStrength=function(){var n=0,e=o.CurrentStageDelay;switch(this.eleMode.checked){case 0:n=this.eStrength.showValue;break;case 1:n=this.constA.showValue*Math.sin(this.constB.showValue*e+this.constC.showValue);break;case 2:n=e%(this.cycle1.showValue+this.cycle2.showValue)>this.cycle1.showValue?this.eStrength2.showValue:this.eStrength1.showValue}return n},n.prototype.checkChange=function(){function n(){r.shapeArr.splice(0),0==r.shape.checked?(t(),r.shapeArr.push(r.uEdge,r.dEdge,r.lEdge,r.rEdge)):(i(),r.shapeArr.push(r.circleX,r.circleY,r.circleR)),r.body.setShape(r.shape.checked)}function e(){if(1!=r.shape.checked){var n=o.Value2Pixel(r.lEdge.showValue),e=o.Value2Pixel(r.uEdge.showValue),t=o.Value2Pixel(r.rEdge.showValue-r.lEdge.showValue),l=Math.abs(o.Value2Pixel(r.dEdge.showValue-r.uEdge.showValue));r.body.setXY(n,e),r.body.setWH(t,l),i()}}function t(){var n=r.body,e=o.Pixel2Value(n.x),t=o.Pixel2Value(n.y),i=o.Pixel2Value(n.x+n.area.rect.w),l=o.Pixel2Value(n.y+n.area.rect.h);r.lEdge._showValue=e.toFixed(2),r.uEdge._showValue=t.toFixed(2),r.rEdge._showValue=i.toFixed(2),r.dEdge._showValue=l.toFixed(2)}function i(){var n=r.body,e=o.Pixel2Value(n.area.circle.r),t=o.Pixel2Value(n.x+n.area.circle.r),i=o.Pixel2Value(n.y+n.area.circle.r);r.circleR._showValue=e.toFixed(2),r.circleX._showValue=t.toFixed(2),r.circleY._showValue=i.toFixed(2)}var l=this,r=this;this.angle.on("change",function(){r.body.setAngle(r.angle.value)}),this.eStrength.on("change",function(){r.body.setStrength(r.eStrength.showValue)}),this.eleMode.on("change",function(){switch(l.eStrengthArr.splice(0),l.eleMode.checked){case 0:l.eStrengthArr.push(l.eStrength);break;case 1:l.eStrengthArr.push(l.constTitle,l.constA,l.constB,l.constC);break;case 2:l.eStrengthArr.push(l.cycle1,l.eStrength1,l.cycle2,l.eStrength2)}}),this.shape.on("change",n),this.lEdge.on("change",function(){r.rEdge.showValue>r.lEdge.showValue||(r.rEdge.showValue=r.lEdge.showValue+1),e()}),this.lEdge.on("change",function(){var n=o.Pixel2Value(20);r.rEdge.showValue>r.lEdge.showValue||(r.rEdge.showValue=r.lEdge.showValue+n),e()}),this.rEdge.on("change",function(){var n=o.Pixel2Value(20);r.rEdge.showValue>r.lEdge.showValue||(r.lEdge.showValue=r.rEdge.showValue-n),e()}),this.uEdge.on("change",function(){var n=o.Pixel2Value(20);r.dEdge.showValue>r.uEdge.showValue||(r.dEdge.showValue=r.uEdge.showValue+n),e()}),this.dEdge.on("change",function(){var n=o.Pixel2Value(20);r.dEdge.showValue>r.uEdge.showValue||(r.uEdge.showValue=r.dEdge.showValue-n),e()}),this.circleR.on("change",function(){if(0!=r.shape.checked){r.circleR.showValue>0||(r.circleR.showValue=1);var n=o.Value2Pixel(2*r.circleR.showValue),e=Math.abs(o.Value2Pixel(r.dEdge.showValue-r.uEdge.showValue));r.body.setWH(n,e);var t=r.circleX.showValue-r.circleR.showValue,i=r.circleY.showValue-r.circleR.showValue,l=o.Value2Pixel(t),a=o.Value2Pixel(i);r.body.setXY(l,a)}}),this.circleX.on("change",function(){if(0!=r.shape.checked){var n=r.circleX.showValue-r.circleR.showValue,e=r.circleY.showValue-r.circleR.showValue,t=o.Value2Pixel(n),i=o.Value2Pixel(e);r.body.setXY(t,i)}}),this.circleY.on("change",function(){if(0!=r.shape.checked){var n=r.circleX.showValue-r.circleR.showValue,e=r.circleY.showValue-r.circleR.showValue,t=o.Value2Pixel(n),i=o.Value2Pixel(e);r.body.setXY(t,i)}}),this.body.on("move",function(){t(),i()})},n.prototype.changeCoorDirectionNew=function(){this.uEdge.name=-1==o.COOR_DIRECTION_Y_N?"下":"上",this.dEdge.name=-1==o.COOR_DIRECTION_Y_N?"上":"下"},n}()},717:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(466),r=t(464),a=t(459),p=t(447),s=t(468);n.exports=function o(n){var e=this;i(this,o),this.body=n,this.firstDropTitle=new l,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="滑轮",this.motionHide=new r("运行时隐藏",!1),this.X=new a("坐标X",-100,100,.1,0,!0,"m"),this.Y=new a("坐标Y",-100,100,.1,0,!0,"m"),this.anchor1=new s,this.anchor2=new s,this.compList=[this.firstDropTitle,this.motionHide,this.X,this.Y],this.head1Data=new l,this.head2Data=new l,this.jointBody1=new l,this.jointBody2=new l,this.X.on("change",function(){var n=p.Value2Pixel(e.X.showValue),t=p.Value2Pixel(e.Y.showValue);e.body.setXY(n,t)}),this.Y.on("change",function(){var n=p.Value2Pixel(e.X.showValue),t=p.Value2Pixel(e.Y.showValue);e.body.setXY(n,t)}),this.body.on("move",function(){var n=p.Pixel2Value(e.body.body.zpp_inner.posx),t=p.Pixel2Value(e.body.body.zpp_inner.posy);e.X._showValue=n.toFixed(2),e.Y._showValue=t.toFixed(2)})}},718:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(464),a=t(466),p=t(475),s=t(630),o=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="万有引力场";this.shapeList=new s([3,4]),this.X=new l("坐标X",-100,100,.1,0,!0,"m"),this.Y=new l("坐标Y",-100,100,.1,0,!0,"m"),this.M=new l("质量",0,1e35,1,1e14,!0,"kg"),this.bodyR=new l("半径",1,100,1,1,!0,"m"),this.motionHide=new r("运行时隐藏",!1),this.secondDrop=[[this.X,this.Y],[this.M]],this.compList=[this.firstDropTitle,this.motionHide,this.M,new p,this.X,this.Y,this.bodyR,this.shapeList],this.checkChange()}return n.prototype.checkChange=function(){var n=this;this.M.on("change",function(){n.body.M=n.M.showValue}),this.X.on("change",function(){var e=o.Value2Pixel(n.X.showValue),t=o.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.Y.on("change",function(){var e=o.Value2Pixel(n.X.showValue),t=o.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.body.on("move",function(){var e=o.Pixel2Value(n.body.body.zpp_inner.posx),t=o.Pixel2Value(n.body.body.zpp_inner.posy);n.X._showValue=e.toFixed(2),n.Y._showValue=t.toFixed(2)}),this.shapeList.on("change",function(){var e=n.shapeList.baseUrl+n.shapeList.selected+".svg";-1==n.shapeList.selected&&(e=""),""!==e&&n.body.fillImage(e)}),this.bodyR.on("change",function(){var e=o.Value2Pixel(n.bodyR.showValue);n.body.setR(e)})},n.prototype.changeCoorDirectionNew=function(){this.body.upSide()},n}()},719:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(466),a=t(464),p=t(485),s=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="地面",this.xPosition=new l("坐标X",-100,100,.1,0,!0,"m"),this.yPosition=new l("坐标Y",-100,100,.1,0,!0,"m"),this.motionHide=new a("运行时隐藏",!1),this.width=new l("宽",1,100,1,s.Pixel2Value(this.body.width),!0,"m"),this.width.canBeAny=!0,this.height=new l("高",1,100,1,s.Pixel2Value(this.body.width),!0,"m"),this.height.canBeAny=!0,this.angle=new p(0,"角度"),this.bodyT=new l("碰撞系数",0,1,.01,this.body.material.get_elasticity()),this.bodyC=new l("粗糙程度",0,2,.01,this.body.material.get_staticFriction()),this.compList=[this.firstDropTitle,this.motionHide,this.xPosition,this.yPosition,this.width,this.height,this.angle,this.bodyT,this.bodyC],this.checkChange()}return n.prototype.checkChange=function(){var n=this,e=this;this.xPosition.on("change",function(){var e=s.Value2Pixel(n.xPosition.showValue),t=s.Value2Pixel(n.yPosition.showValue);n.body.setXY(e,t)}),this.yPosition.on("change",function(){var e=s.Value2Pixel(n.xPosition.showValue),t=s.Value2Pixel(n.yPosition.showValue);n.body.setXY(e,t)}),this.body.on("move",function(){var e=s.Pixel2Value(n.body.body.zpp_inner.posx),t=s.Pixel2Value(n.body.body.zpp_inner.posy);n.xPosition._showValue=e.toFixed(2),n.yPosition._showValue=t.toFixed(2);var i=s.Pixel2Value(n.body.width),l=s.Pixel2Value(n.body.height);n.width._showValue=i.toFixed(2),n.height._showValue=l.toFixed(2)}),this.width.on("change",function(){e.width.showValue>0||(e.width._showValue=1),e.body.setWidth(s.Value2Pixel(e.width.showValue))}),this.height.on("change",function(){e.height.showValue>0||(e.height._showValue=1),e.body.setHeight(s.Value2Pixel(e.height.showValue))}),this.angle.on("change",function(){e.body.setRotate(e.angle.value/180*Math.PI)}),this.bodyT.on("change",function(){n.body.setElasticity(n.bodyT.showValue)}),this.bodyC.on("change",function(){n.body.setFriction(n.bodyC.showValue)})},n}()},720:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(466),a=t(464),p=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="参照点",this.xPosition=new l("X坐标",-1e3,1e3,1,0,!0,"m"),this.yPosition=new l("Y坐标",-1e3,1e3,1,0,!0,"m"),this.motionHide=new a("运行时隐藏",!0),this.secondDrop=[[this.xPosition,this.yPosition]],this.compList=[],this.checkChange()}return n.prototype.checkChange=function(){var n=this;this.xPosition.on("change",function(){var e=p.Value2Pixel(n.xPosition.showValue),t=p.Value2Pixel(n.yPosition.showValue);n.body.setXY(e,t)}),this.yPosition.on("change",function(){var e=p.Value2Pixel(n.xPosition.showValue),t=p.Value2Pixel(n.yPosition.showValue);n.body.setXY(e,t)}),this.body.on("move",function(){var e=p.Pixel2Value(n.body.body.zpp_inner.posx),t=p.Pixel2Value(n.body.body.zpp_inner.posy);n.xPosition._showValue=e.toFixed(2),n.yPosition._showValue=t.toFixed(2)})},n}()},721:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(466),a=t(501),p=t(464),s=t(475),o=t(447),h=t(485);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="匀强磁场",this.shape=new a(0,"形状",["矩形","圆形"]),this.uEdge=new l("上",-1e3,1e3,.1,0,!0,"m"),this.dEdge=new l("下",-1e3,1e3,.1,200,!0,"m"),this.lEdge=new l("左",-1e3,1e3,.1,0,!0,"m"),this.rEdge=new l("右",-1e3,1e3,.1,200,!0,"m"),this.circleX=new l("坐标X",-1e3,1e3,.1,100,!0,"m"),this.circleY=new l("坐标Y",-1e3,1e3,.1,100,!0,"m"),this.circleR=new l("半径",1,100,.1,10,!0,"m"),this.circleStart=new h(0,"开始角度"),this.circleEnd=new h(360,"结束角度"),this.shapeArr=[this.uEdge,this.dEdge,this.lEdge,this.rEdge],this.eStrength=new l("磁感应强度",.01,100,.01,1,!0,"T",2),this.eStrength.canBeAny=!0,this.direction=new a(0,"磁场方向",["向里","向外"]),this.motionHide=new p("运行时隐藏",!1),this.eleMode=new a(0,"磁场模式",["恒定","正弦","矩形"]),this.constTitle=new s("磁感应强度=A*sin(B*t+C)"),this.constA=new l("常数A",-100,100,.01,1),this.constB=new l("常数B",-100,100,.01,1),this.constC=new l("常数C",-100,100,.01,0),this.cycle1=new l("周期1",0,100,.01,1,!0,"S"),this.eStrength1=new l("强度",-100,100,.01,1,!0,"T"),this.cycle2=new l("周期2",0,100,.01,1,!0,"S"),this.eStrength2=new l("强度",-100,100,.01,-1,!0,"T"),this.eStrengthArr=[this.eStrength],this.compList=[this.firstDropTitle,this.motionHide,this.eleMode,this.eStrengthArr,new s,this.direction,new s,this.shape,new s,this.shapeArr],this.checkChange(),this.changeCoorDirectionNew(),this.laste=0}return n.prototype.getEStrength=function(){var n=0,e=o.CurrentStageDelay;switch(this.eleMode.checked){case 0:n=this.eStrength.showValue;break;case 1:n=this.constA.showValue*Math.sin(this.constB.showValue*e+this.constC.showValue);break;case 2:n=e%(this.cycle1.showValue+this.cycle2.showValue)>this.cycle1.showValue?this.eStrength2.showValue:this.eStrength1.showValue}return this.laste!=n&&(this.laste=n),n},n.prototype.checkChange=function(){function n(){r.shapeArr.splice(0),0==r.shape.checked?(t(),r.shapeArr.push(r.uEdge,r.dEdge,r.lEdge,r.rEdge)):(i(),r.shapeArr.push(r.circleX,r.circleY,r.circleR,r.circleStart,r.circleEnd)),r.body.setShape(r.shape.checked)}function e(){if(1!=r.shape.checked){var n=o.Value2Pixel(r.lEdge.showValue),e=o.Value2Pixel(r.uEdge.showValue),t=o.Value2Pixel(r.rEdge.showValue-r.lEdge.showValue),l=Math.abs(o.Value2Pixel(r.dEdge.showValue-r.uEdge.showValue));r.body.setXY(n,e),r.body.setWH(t,l),i()}}function t(){var n=r.body,e=o.Pixel2Value(n.x),t=o.Pixel2Value(n.y),i=o.Pixel2Value(n.x+n.area.rect.w),l=o.Pixel2Value(n.y+n.area.rect.w);r.lEdge._showValue=e.toFixed(2),r.uEdge._showValue=t.toFixed(2),r.rEdge._showValue=i.toFixed(2),r.dEdge._showValue=l.toFixed(2)}function i(){var n=r.body,e=o.Pixel2Value(n.width/2),t=o.Pixel2Value(n.x+n.area.fan.r),i=o.Pixel2Value(n.y+n.area.fan.r);r.circleR._showValue=e.toFixed(2),r.circleX._showValue=t.toFixed(2),r.circleY._showValue=i.toFixed(2)}var l=this,r=this;this.eleMode.on("change",function(){switch(l.eStrengthArr.splice(0),l.eleMode.checked){case 0:l.eStrengthArr.push(l.eStrength);break;case 1:l.eStrengthArr.push(l.constTitle,l.constA,l.constB,l.constC);break;case 2:l.eStrengthArr.push(l.cycle1,l.eStrength1,l.cycle2,l.eStrength2)}}),this.shape.on("change",n),this.eStrength.on("change",function(){0>+r.eStrength.showValue&&(r.eStrength._showValue=0),r.body.changeStrength(+r.eStrength.showValue)}),this.direction.on("change",function(){r.body.setType(r.direction.checked)}),this.lEdge.on("change",function(){r.rEdge.showValue>r.lEdge.showValue||(r.rEdge.showValue=r.lEdge.showValue+1),e()}),this.lEdge.on("change",function(){var n=o.Pixel2Value(20);r.rEdge.showValue>r.lEdge.showValue||(r.rEdge.showValue=r.lEdge.showValue+n),e()}),this.rEdge.on("change",function(){var n=o.Pixel2Value(20);r.rEdge.showValue>r.lEdge.showValue||(r.lEdge.showValue=r.rEdge.showValue-n),e()}),this.uEdge.on("change",function(){var n=o.Pixel2Value(20);r.dEdge.showValue>r.uEdge.showValue||(r.dEdge.showValue=r.uEdge.showValue+n),e()}),this.dEdge.on("change",function(){var n=o.Pixel2Value(20);r.dEdge.showValue>r.uEdge.showValue||(r.uEdge.showValue=r.dEdge.showValue-n),e()}),this.circleR.on("change",function(){if(0!=r.shape.checked){r.circleR.showValue>0||(r.circleR.showValue=1);var n=o.Value2Pixel(2*r.circleR.showValue),e=Math.abs(o.Value2Pixel(r.dEdge.showValue-r.uEdge.showValue));r.body.setWH(n,e);var t=r.circleX.showValue-r.circleR.showValue,i=r.circleY.showValue-r.circleR.showValue,l=o.Value2Pixel(t),a=o.Value2Pixel(i);r.body.setXY(l,a)}}),this.circleX.on("change",function(){if(0!=r.shape.checked){var n=r.circleX.showValue-r.circleR.showValue,e=r.circleY.showValue-r.circleR.showValue,t=o.Value2Pixel(n),i=o.Value2Pixel(e);r.body.setXY(t,i)}}),this.circleY.on("change",function(){if(0!=r.shape.checked){var n=r.circleX.showValue-r.circleR.showValue,e=r.circleY.showValue-r.circleR.showValue,t=o.Value2Pixel(n),i=o.Value2Pixel(e);r.body.setXY(t,i)}}),this.body.on("move",function(){t(),i()}),this.circleStart.on("change",function(){l.body.setAngle(l.circleStart.value,l.circleEnd.value)}),this.circleEnd.on("change",function(){l.body.setAngle(l.circleStart.value,l.circleEnd.value)})},n.prototype.changeCoorDirectionNew=function(){this.uEdge.name=-1==o.COOR_DIRECTION_Y_N?"下":"上",this.dEdge.name=-1==o.COOR_DIRECTION_Y_N?"上":"下"},n}()},722:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(466),r=t(464),a=t(459),p=t(447),s=t(468);n.exports=function(){function n(e){var t=this;i(this,n),this.body=e,this.firstDropTitle=new l,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="参照点",this.motionHide=new r("运行时隐藏",!1),this.X=new a("坐标X",-100,100,.1,0,!0,"m"),this.Y=new a("坐标Y",-100,100,.1,0,!0,"m"),this.anchor1=new s,this.anchor2=new s,this.jointBody=new l,this.textHide=new r("隐藏坐标",!0),this.compList=[this.firstDropTitle,this.motionHide,this.X,this.Y,this.textHide],this.textHide.on("change",function(){t.body.ifShowText(t.textHide.checked)}),this.X.on("change",function(){var n=p.Value2Pixel(t.X.showValue),e=p.Value2Pixel(t.Y.showValue);t.body.setXY(n,e),t.body.changeTxtShow((+t.X.showValue).toFixed(1),(+t.Y.showValue).toFixed(1))}),this.Y.on("change",function(){var n=p.Value2Pixel(t.X.showValue),e=p.Value2Pixel(t.Y.showValue);t.body.setXY(n,e),t.body.changeTxtShow((+t.X.showValue).toFixed(1),(+t.Y.showValue).toFixed(1))}),this.body.on("move",function(){var n=p.Pixel2Value(t.body.body.zpp_inner.posx),e=p.Pixel2Value(t.body.body.zpp_inner.posy);t.X._showValue=n.toFixed(2),t.Y._showValue=e.toFixed(2),t.body.changeTxtShow(n.toFixed(1),e.toFixed(1))}),this.changeCoorDirectionNew()}return n.prototype.changeCoorDirectionNew=function(){this.body.upSide()},n}()},723:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(466),p=t(464),s=t(475),o=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="点电荷";var t=["坐标","带电量"];this.firstDrop=[];for(var o=0;2>o;o++)this.firstDrop.push(new l(t[o],t[o],o));this.X=new r("坐标X",-100,100,.1,0,!0,"m"),this.Y=new r("坐标Y",-100,100,.1,0,!0,"m"),this.M=new r("带电量",-100,100,.1,1e-8,!0,"C"),this.M.canBeAny=!0,this.secondDrop=[[this.X,this.Y],[this.M]],this.motionHide=new p("运行时隐藏",!1),this.compList=[this.firstDropTitle,this.motionHide,this.M,new s,this.X,this.Y],this.checkChange()}return n.prototype.checkChange=function(){var n=this;this.M.on("change",function(){n.body.setQ(n.M.showValue)}),this.X.on("change",function(){var e=o.Value2Pixel(n.X.showValue),t=o.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.Y.on("change",function(){var e=o.Value2Pixel(n.X.showValue),t=o.Value2Pixel(n.Y.showValue);n.body.setXY(e,t)}),this.body.on("move",function(){var e=o.Pixel2Value(n.body.body.zpp_inner.posx),t=o.Pixel2Value(n.body.body.zpp_inner.posy);n.X._showValue=e.toFixed(2),n.Y._showValue=t.toFixed(2)})},n}()},724:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(473),r=t(459),a=t(466),p=t(464),s=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="参照点";var t=["坐标"];this.firstDrop=[];for(var s=0;1>s;s++)this.firstDrop.push(new l(t[s],t[s],s));this.X=new r("坐标X",-100,100,.1,0,!0,"m"),this.Y=new r("坐标Y",-100,100,.1,0,!0,"m"),this.motionHide=new p("运行时隐藏",!1),this.textHide=new p("隐藏坐标",!0),this.compList=[this.firstDropTitle,this.motionHide,this.textHide,this.X,this.Y],this.checkChange(),this.changeCoorDirectionNew()}return n.prototype.checkChange=function(){var n=this,e=this;this.textHide.on("change",function(){n.body.ifShowText(n.textHide.checked)}),this.X.on("change",function(){var n=s.Value2Pixel(e.X.showValue),t=s.Value2Pixel(e.Y.showValue);e.body.setXY(n,t),e.body.changeTxtShow((+e.X.showValue).toFixed(1),(+e.Y.showValue).toFixed(1))}),this.Y.on("change",function(){var n=s.Value2Pixel(e.X.showValue),t=s.Value2Pixel(e.Y.showValue);e.body.setXY(n,t),e.body.changeTxtShow((+e.X.showValue).toFixed(1),(+e.Y.showValue).toFixed(1))}),this.body.on("move",function(){var n=s.Pixel2Value(e.body.body.zpp_inner.posx),t=s.Pixel2Value(e.body.body.zpp_inner.posy);e.X._showValue=n.toFixed(2),e.Y._showValue=t.toFixed(2),e.body.changeTxtShow(n.toFixed(1),t.toFixed(1))})},n.prototype.changeCoorDirectionNew=function(){this.body.upSide()},n}()},725:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(466),a=t(475),p=t(464),s=t(485),o=t(447);n.exports=function(){function n(e){i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="直轨道",this.firstDrop=[],this.staticFriction=new l("静摩擦系数",0,1,.01,0,!0,"",2),this.dynamicFriction=new l("摩擦系数",0,1,.01,0,!0,"",2),this.elasticity=new l("弹性系数",0,1,.1,0,!0,"",1),this.zCoor=new p("直角坐标方式",!0),this.zCoor.typeName="CheckBoxItem",this.aCoor=new p("极坐标方式",!1),this.aCoor.typeName="CheckBoxItem";var t=o.Pixel2Value(this.body.pixel_length);this.X1=new l("坐标X",-1e3,1e3,.1,0,!0,"m"),this.Y1=new l("坐标Y",-1e3,1e3,.1,0,!0,"m"),this.X2=new l("坐标X",-1e3,1e3,.1,t,!0,"m"),this.Y2=new l("坐标Y",-1e3,1e3,.1,0,!0,"m"),this.angle=new s(0,"角度"),this.length=new l("长度",1,1e3,1,t,!0,"m"),this.position1=[new a("端点1坐标",!0),this.X1,this.Y1],this.position2=[new a("端点2坐标",!0),this.X2,this.Y2],this.aData=[],this.secondDrop=[],this.motionHide=new p("运行时隐藏",!1),this.compList=[this.firstDropTitle,this.motionHide,this.dynamicFriction,new a(""),this.zCoor,this.aCoor,this.position1,this.position2,this.aData],this.checkChange()}return n.prototype.checkChange=function(){function n(){a.position2.splice(1),a.aData.splice(0),a.zCoor.checked&&a.position2.push(a.X2,a.Y2),a.aCoor.checked&&a.aData.push(a.angle,a.length)}function e(){t(),a.zCoor.checked?(l(),i()):r()}function t(){var n=o.Value2Pixel(a.X1.showValue),e=o.Value2Pixel(a.Y1.showValue);a.body.changeXY(n,e)}function i(){a.body.changeAngle(a.angle.value*Math.PI/180),a.body.changeLength(a.length.showValue)}function l(){var n=a.X2.showValue-a.X1.showValue,e=a.Y2.showValue-a.Y1.showValue,t=Math.sqrt(n*n+e*e),i=Math.atan2(e,n);a.angle._value=180*i/Math.PI,a.length._showValue=t.toFixed(2)}function r(){var n=a.angle.value*Math.PI/180,e=Math.cos(n)*a.length.showValue,t=Math.sin(n)*a.length.showValue;a.X2._showValue=+(a.X1.showValue+e).toFixed(2),a.Y2._showValue=+(a.Y1.showValue+t).toFixed(2)}var a=this;this.zCoor.on("change",function(){a.aCoor._checked=!a.zCoor.checked,n()}),this.aCoor.on("change",function(){a.zCoor._checked=!a.aCoor.checked,n()}),this.X1.on("change",e),this.Y1.on("change",e),this.X2.on("change",function(){l(),i()}),this.Y2.on("change",function(){l(),i()}),this.angle.on("change",function(){r(),i()}),this.length.on("change",function(){r(),i()}),this.body.on("move",function(){var n=o.Pixel2Value(a.body.body.zpp_inner.posx),e=o.Pixel2Value(a.body.body.zpp_inner.posy);a.X1._showValue=n.toFixed(2),a.Y1._showValue=e.toFixed(2),a.length._showValue=o.Pixel2Value(a.body.pixel_length),r(),i()}),this.staticFriction.on("change",function(){}),this.dynamicFriction.on("change",function(){a.body.setDynamicFriction(a.dynamicFriction.showValue),a.body.setStaticFriction(a.dynamicFriction.showValue+.1)}),this.elasticity.on("change",function(){a.body.setElasticity(a.elasticity.showValue)})},n}()},726:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=(t(473),t(459)),r=t(485),a=t(466),p=t(475),s=t(464),o=t(447),h=t(501),_=t(468);n.exports=function(){function n(e){var t=this;i(this,n),this.body=e,this.firstDropTitle=new a,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="三角形电场",this.eleMode=new h(0,"电场模式",["恒定","正弦","矩形"]),this.elecShape=new h(0,"形状",["等边","等腰","直角"]),this.eStrength=new l("电场强度",0,100,.1,1,!0,"N/C"),this.eStrength.canBeAny=!0,this.angle=new r(0,"电场方向"),this.motionHide=new s("运行时隐藏",!1),this.constTitle=new p("电场强度=A*sin(B*t+C)"),this.constA=new l("常数A",-100,100,.01,1),this.constB=new l("常数B",-100,100,.01,1),this.constC=new l("常数C",-100,100,.01,0),this.cycle1=new l("周期1",0,100,.01,1,!0,"S"),this.eStrength1=new l("强度",-100,100,.01,1,!0,"N/C"),this.cycle2=new l("周期2",0,100,.01,1,!0,"S"),this.eStrength2=new l("强度",-100,100,.01,-1,!0,"N/C"),this.eStrengthArr=[this.eStrength],this.posx=new l("X坐标",-100,100,1,0,!0,"m"),this.posy=new l("Y坐标",-100,100,1,0,!0,"m"),this.posx.canBeAny=!0,this.posy.canBeAny=!0,this.rotation=new r(0,"旋转角度"),this.bianchang=new l("边长",0,100,1,20,!0,"m"),this.dibianchang=new l("底边长",0,100,1,20,!0,"°"),this.yaochang=new l("腰长",0,100,1,30,!0,"m"),this.zhijiaobian1=new l("直角边长1",0,100,1,20,!0,"m"),this.zhijiaobian2=new l("直角边长2",0,100,1,20,!0,"m"),this.shapeArr=[this.bianchang],this.compList=[this.firstDropTitle,this.motionHide,this.eleMode,this.eStrengthArr,this.angle,this.rotation,this.posx,this.posy,this.elecShape,this.shapeArr],this.checkChange(),this.changeCoorDirectionNew(),setTimeout(function(){t.updataAnchor()},10)}return n.prototype.updataAnchor=function(){var n=new _,e=new _,t=new _;n.x=this.posx.showValue,n.y=this.posy.showValue;var i=this.rotation.value/180*Math.PI,l=Math.sin(i),r=Math.cos(i);if(0==this.elecShape.checked)e.x=r*this.bianchang.showValue+n.x,e.y=l*this.bianchang.showValue+n.y,r=Math.cos(Math.PI/3),l=Math.sin(Math.PI/3),t.x=(e.x-n.x)*r-(e.y-n.y)*l+n.x,t.y=(e.x-n.x)*l+(e.y-n.y)*r+n.y;else if(1==this.elecShape.checked){e.x=r*this.dibianchang.showValue+n.x,e.y=l*this.dibianchang.showValue+n.y;var a=r*this.yaochang.showValue+n.x,p=l*this.yaochang.showValue+n.y;r=this.dibianchang.showValue/2/this.yaochang.showValue,l=Math.sqrt(1-r*r),t.x=(a-n.x)*r-(p-n.y)*l+n.x,t.y=(a-n.x)*l+(p-n.y)*r+n.y}else if(2==this.elecShape.checked){e.x=r*this.zhijiaobian1.showValue+n.x,e.y=l*this.zhijiaobian1.showValue+n.y;var a=r*this.zhijiaobian2.showValue+n.x,p=l*this.zhijiaobian2.showValue+n.y;r=0,l=1,t.x=(a-n.x)*r-(p-n.y)*l+n.x,t.y=(a-n.x)*l+(p-n.y)*r+n.y}n.x=o.Value2Pixel(n.x),n.y=o.Value2Pixel(n.y),e.x=o.Value2Pixel(e.x),e.y=o.Value2Pixel(e.y),t.x=o.Value2Pixel(t.x),t.y=o.Value2Pixel(t.y),this.body.updateAnchor(n,e,t)},n.prototype.getEStrength=function(){var n=0,e=o.CurrentStageDelay;switch(this.eleMode.checked){case 0:n=this.eStrength.showValue;break;case 1:n=this.constA.showValue*Math.sin(this.constB.showValue*e+this.constC.showValue);break;case 2:n=e%(this.cycle1.showValue+this.cycle2.showValue)>this.cycle1.showValue?this.eStrength2.showValue:this.eStrength1.showValue}return n},n.prototype.checkChange=function(){var n=this,e=this;this.angle.on("change",function(){e.body.setAngle(e.angle.value)}),this.eStrength.on("change",function(){e.body.setStrength(e.eStrength.showValue)}),this.eleMode.on("change",function(){switch(n.eStrengthArr.splice(0),n.eleMode.checked){case 0:n.eStrengthArr.push(n.eStrength);break;case 1:n.eStrengthArr.push(n.constTitle,n.constA,n.constB,n.constC);break;case 2:n.eStrengthArr.push(n.cycle1,n.eStrength1,n.cycle2,n.eStrength2)}}),this.elecShape.on("change",function(){switch(n.shapeArr.splice(0),n.elecShape.checked){case 0:n.shapeArr.push(n.bianchang);break;case 1:n.shapeArr.push(n.yaochang,n.dibianchang);break;case 2:n.shapeArr.push(n.zhijiaobian1,n.zhijiaobian2)}n.updataAnchor()}),this.bianchang.on("change",function(){n.updataAnchor()}),this.yaochang.on("change",function(){n.updataAnchor()}),this.dibianchang.on("change",function(){n.updataAnchor()}),this.zhijiaobian1.on("change",function(){n.updataAnchor()}),this.zhijiaobian2.on("change",function(){n.updataAnchor()}),this.posx.on("change",function(){n.updataAnchor()}),this.posy.on("change",function(){n.updataAnchor()}),this.rotation.on("change",function(){n.updataAnchor()})},n.prototype.changeCoorDirectionNew=function(){},n}()},727:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(459),r=t(466),a=t(475),p=t(464),s=t(501),o=t(485),h=t(447),_=t(468);n.exports=function(){function n(e){var t=this;i(this,n),this.body=e,this.firstDropTitle=new r,this.firstDropTitle.typeName="NameTitle",this.firstDropTitle.bodyName="三角形磁场",this.eStrength=new l("磁感应强度",.01,100,.01,1,!0,"T",2),this.eStrength.canBeAny=!0,this.direction=new s(0,"磁场方向",["向里","向外"]),this.motionHide=new p("运行时隐藏",!1),this.eleMode=new s(0,"磁场模式",["恒定","正弦","矩形"]),this.constTitle=new a("磁感应强度=A*sin(B*t+C)"),this.constA=new l("常数A",-100,100,.01,1),this.constB=new l("常数B",-100,100,.01,1),this.constC=new l("常数C",-100,100,.01,0),this.cycle1=new l("周期1",0,100,.01,1,!0,"S"),this.eStrength1=new l("强度",-100,100,.01,1,!0,"T"),this.cycle2=new l("周期2",0,100,.01,1,!0,"S"),this.eStrength2=new l("强度",-100,100,.01,-1,!0,"T"),this.eStrengthArr=[this.eStrength],this.posx=new l("X坐标",-100,100,1,0,!0,"m"),this.posy=new l("Y坐标",-100,100,1,0,!0,"m"),this.posx.canBeAny=!0,this.posy.canBeAny=!0,this.rotation=new o(0,"旋转角度"),this.bianchang=new l("边长",0,100,1,20,!0,"m"),this.dibianchang=new l("底边长",0,100,1,20,!0,"°"),this.yaochang=new l("腰长",0,100,1,30,!0,"m"),this.zhijiaobian1=new l("直角边长1",0,100,1,20,!0,"m"),this.zhijiaobian2=new l("直角边长2",0,100,1,20,!0,"m"),this.elecShape=new s(0,"形状",["等边","等腰","直角"]),this.shapeArr=[this.bianchang],this.compList=[this.firstDropTitle,this.motionHide,this.eleMode,this.eStrengthArr,this.direction,this.rotation,this.posx,this.posy,this.elecShape,this.shapeArr],this.checkChange(),this.changeCoorDirectionNew(),setTimeout(function(){t.updataAnchor()},10)}return n.prototype.updataAnchor=function(){var n=new _,e=new _,t=new _;n.x=this.posx.showValue,n.y=this.posy.showValue;var i=this.rotation.value/180*Math.PI,l=Math.sin(i),r=Math.cos(i);if(0==this.elecShape.checked)e.x=r*this.bianchang.showValue+n.x,e.y=l*this.bianchang.showValue+n.y,r=Math.cos(Math.PI/3),l=Math.sin(Math.PI/3),t.x=(e.x-n.x)*r-(e.y-n.y)*l+n.x,t.y=(e.x-n.x)*l+(e.y-n.y)*r+n.y;else if(1==this.elecShape.checked){e.x=r*this.dibianchang.showValue+n.x,e.y=l*this.dibianchang.showValue+n.y;var a=r*this.yaochang.showValue+n.x,p=l*this.yaochang.showValue+n.y;r=this.dibianchang.showValue/2/this.yaochang.showValue,l=Math.sqrt(1-r*r),t.x=(a-n.x)*r-(p-n.y)*l+n.x,t.y=(a-n.x)*l+(p-n.y)*r+n.y}else if(2==this.elecShape.checked){e.x=r*this.zhijiaobian1.showValue+n.x,e.y=l*this.zhijiaobian1.showValue+n.y;var a=r*this.zhijiaobian2.showValue+n.x,p=l*this.zhijiaobian2.showValue+n.y;r=0,l=1,t.x=(a-n.x)*r-(p-n.y)*l+n.x,t.y=(a-n.x)*l+(p-n.y)*r+n.y}n.x=h.Value2Pixel(n.x),n.y=h.Value2Pixel(n.y),e.x=h.Value2Pixel(e.x),e.y=h.Value2Pixel(e.y),t.x=h.Value2Pixel(t.x),t.y=h.Value2Pixel(t.y),this.body.updateAnchor(n,e,t)},n.prototype.getEStrength=function(){var n=0,e=h.CurrentStageDelay;switch(this.eleMode.checked){case 0:n=this.eStrength.showValue;break;case 1:n=this.constA.showValue*Math.sin(this.constB.showValue*e+this.constC.showValue);break;case 2:n=e%(this.cycle1.showValue+this.cycle2.showValue)>this.cycle1.showValue?this.eStrength2.showValue:this.eStrength1.showValue}return this.laste!=n&&(this.laste=n),n},n.prototype.checkChange=function(){var n=this,e=this;this.eleMode.on("change",function(){switch(n.eStrengthArr.splice(0),n.eleMode.checked){case 0:n.eStrengthArr.push(n.eStrength);break;case 1:n.eStrengthArr.push(n.constTitle,n.constA,n.constB,n.constC);break;case 2:n.eStrengthArr.push(n.cycle1,n.eStrength1,n.cycle2,n.eStrength2)}}),this.eStrength.on("change",function(){0>+e.eStrength.showValue&&(e.eStrength._showValue=0),e.body.changeStrength(+e.eStrength.showValue)}),this.direction.on("change",function(){e.body.setType(e.direction.checked)}),this.elecShape.on("change",function(){switch(n.shapeArr.splice(0),n.elecShape.checked){case 0:n.shapeArr.push(n.bianchang);break;case 1:n.shapeArr.push(n.yaochang,n.dibianchang);break;case 2:n.shapeArr.push(n.zhijiaobian1,n.zhijiaobian2)}n.updataAnchor()}),this.bianchang.on("change",function(){n.updataAnchor()}),this.yaochang.on("change",function(){n.updataAnchor()}),this.dibianchang.on("change",function(){n.updataAnchor()}),this.zhijiaobian1.on("change",function(){n.updataAnchor()}),this.zhijiaobian2.on("change",function(){n.updataAnchor()}),this.posx.on("change",function(){n.updataAnchor()}),this.posy.on("change",function(){n.updataAnchor()}),this.rotation.on("change",function(){n.updataAnchor()})},n.prototype.changeCoorDirectionNew=function(){},n}()},728:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r){i(this,e);var a=l(this,n.call(this));return a.tags=t||[],a.selected=r,a.typeName="TagsItemData",a}return r(e,n),a(e,[{key:"tags",get:function(){for(var n=[],e=0;this._tags.length>e;e++)n[e]=s.getL(this._tags[e]);return n},set:function(n){this._tags=n}},{key:"selected",get:function(){return this._selected},set:function(n){this._selected=n,this.emit("change")}}]),e}(p)},729:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),p=t(478),s=t(476);n.exports=function(n){function e(t,r,a,p,s){i(this,e);var o=l(this,n.call(this));return o.name=t||"",o.minValue=r===undefined?-1e3:r,o.maxValue=a||1e3,o.step=p||1,o.showValue=s||0,o.typeName="ValuesItemData",o.noSave.push("minValue","maxValue","step"),o}return r(e,n),a(e,[{key:"maxValue",get:function(){return this._maxValue},set:function(n){this._maxValue=n}},{key:"minValue",get:function(){return this._minValue},set:function(n){this._minValue=n}},{key:"showValue",get:function(){return+this._showValue},set:function(n){this._showValue=n,this.emit("change")}},{key:"name",get:function(){return s.getL(this._name)},set:function(n){this._name=n}},{key:"step",get:function(){return this._step},set:function(n){this._step=n}}]),e}(p)},730:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(447),a=(t(460),t(738)),p=t(455);n.exports=function(){function n(){i(this,n);this.first=null,this.second=null,this.third=null,this.angleArr=[],this.group=new PIXI.Container,r.frontCon.addChild(this.group),this.currentLine=new p,this.group.addChild(this.currentLine),this.active=!1}return n.prototype.destroy=function(){this.first=null,this.second=null,this.third=null,this.group=null,this.currentLine=null},n.prototype.update=function(){if(this.angleArr.length>0)for(var n=0;this.angleArr.length>n;n++){var e=this.angleArr[n];e.update()}this.updateEditing()},n.prototype.updateEditing=function(){if(this.active)if(this.second){var n=this.group.toLocal({x:r.stageMouseX,y:r.stageMouseY}),e={x:this.first.body.zpp_inner.posx,y:this.first.body.zpp_inner.posy},t={x:this.second.body.zpp_inner.posx,y:this.second.body.zpp_inner.posy};this.currentLine.clear(),this.currentLine.lineStyle(1,11184810),this.currentLine.moveTo(e.x,e.y),this.currentLine.lineTo(t.x,t.y),this.currentLine.lineTo(n.x,n.y)}else if(this.first){var n=this.group.toLocal({x:r.stageMouseX,y:r.stageMouseY}),i={x:this.first.body.zpp_inner.posx,y:this.first.body.zpp_inner.posy};this.currentLine.clear(),this.currentLine.lineStyle(1,11184810),this.currentLine.moveTo(i.x,i.y),this.currentLine.lineTo(n.x,n.y)}},n.prototype.deleteAngle=function(n){for(var e=this.checkBodyOnAngle(n);e.length>0;){var t=e.pop(0);this.angleArr.splice(this.angleArr.indexOf(t),1),t.destroy()}},n.prototype.setActiveFalse=function(){this.first=null,this.second=null,this.third=null,this.currentLine.clear()},n.prototype.addBody=function(n){if(this.active&&-1!=r.canLinkArr.indexOf(n.typeName)){if(null==this.first)return void(this.first=n);if(this.first!=n&&(null==this.second&&(this.second=n),this.second!=n&&!this.checkHasLink(n,this.first))){this.third=n;var e=new a(this.first,this.second,this.third);this.angleArr.push(e),this.group.addChild(e),this.active=!1}}},n.prototype.checkHasLink=function(n,e,t){for(var i=!1,l=0;this.angleArr.length>l;l++){var r=this.angleArr[l];if(r.second==e&&(r.first==n&&r.third==t||r.first==t&&r.third==n)){i=!0;break}}return i},n.prototype.checkBodyOnAngle=function(n){for(var e=[],t=0;this.angleArr.length>t;t++){var i=this.angleArr[t];i.first!=n&&i.second!=n&&i.third!=n||e.push(i)}return e},n.prototype.getData=function(){for(var n=[],e=0;this.angleArr.length>e;e++){var t=this.angleArr[e];n.push([t.first.id,t.second.id,t.third.id])}return n},n.prototype.setData=function(n){for(var e=0;n.length>e;e++){var t=n[e],i=r.napeWorld.getBodyById(t[0]),l=r.napeWorld.getBodyById(t[1]),p=r.napeWorld.getBodyById(t[2]);if(i&&l&&p){var s=new a(i,l,p);this.angleArr.push(s),this.group.addChild(s)}}},l(n,[{key:"active",get:function(){return this._active},set:function(n){this._active=n,n||this.setActiveFalse(),r.canvas.style.cursor=this._active?"crosshair":"default"}}]),n}()},731:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(710),s=t(460),o=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.showCoor=!0,t.showGrid=!0,t.showThin=!1,t.showSolid=!1,t.lineWeight=1,t.lineSpace=20,t.lineSpaceNum=5,t.gridSpace=100,t.x_AxisColor=12334152,t.y_AxisColor=1676095,t.spaceColor=3684408,t.space5Color=5592405,t.backGroudColor=2565931,t.fontsize=10,t.fontcolor="#fff",t.updateText=!1,t.spacePath=new o,t.spacePath.lineStyle(t.lineWeight,t.spaceColor,1),t.space5Path=new o,t.space5Path.lineStyle(t.lineWeight,t.space5Color,1),t.x_Axis=new o,t.x_Axis.lineStyle(t.lineWeight,t.x_AxisColor,1),t.y_Axis=new o,t.y_Axis.lineStyle(t.lineWeight,t.y_Axis,1),t.back=new o,t.back.beginFill(t.backGroudColor),t.textGroup=new PIXI.Container,t.addChild(t.back),t.addChild(t.spacePath),t.addChild(t.space5Path),t.addChild(t.x_Axis),t.addChild(t.y_Axis),t.addChild(t.textGroup),t.baseData=new p(t),t.changeData(),t}return r(e,n),e.prototype.destroy=function(){n.prototype.destroy.call(this)},e.prototype.setIfAdsorp=function(n){a.ADSORP_TO_GRID=n},e.prototype.setCoorY=function(n){a.COOR_DIRECTION_Y_N=n?-1:1,a.main.emit(a.COOR_DIRECTION_CHANGE_N),this.update(!0)},e.prototype.changeBackColor=function(n,e){n=s.hexTo64(n),this.backGroudColor=n,e&&(this.x_AxisColor=s.hexTo64(e.x),this.y_AxisColor=s.hexTo64(e.y),this.spaceColor=s.hexTo64(e.a),this.space5Color=s.hexTo64(e.b)),this.update()},e.prototype.setFontSize=function(n){this.fontsize=n,this.update(!0)},e.prototype.getCoorSpace=function(){var n=0;return n=10*Math.round(this.lineSpace*this.lineSpaceNum/a.STAGE_SCALE/10),this.showThin&&(n/=this.lineSpaceNum),n},e.prototype.setIfAdsorp=function(n){a.ADSORP_TO_GRID=n},e.prototype.setGridScaleG=function(n){a.GRID_SCALE=n,a.GRIG_M2P=a.GRID_SCALE/a.GRID_PIXEL,a.main.emit(a.GRIG_SCALE_CHANGE)},e.prototype.changeData=function(){this.showCoor=this.baseData.showCoor.checked,this.showGrid=this.baseData.showGrid.checked,this.showThin=this.baseData.showThin.checked,this.showSolid=this.baseData.showSolid.checked,this.lineWeight=this.showSolid?3:1,this.spacePath.lineWeight=this.lineWeight,this.space5Path.lineWeight=this.lineWeight,this.x_Axis.lineWeight=this.lineWeight,this.y_Axis.lineWeight=this.lineWeight,this.updateSpace(),this.update(!0)},e.prototype.updateSpace=function(){var n=10*Math.round(this.lineSpace*this.lineSpaceNum/a.STAGE_SCALE/10);n>100&&(n=200*Math.round(n/200)),30==n?n=40:70==n&&(n=80),this.gridSpace=n,a.GRID_SPACE=n,this.showThin&&(a.GRID_SPACE=n/5)},e.prototype.update=function(n){this.updateText=n,this.spacePath.clear(),this.space5Path.clear(),this.x_Axis.clear(),this.y_Axis.clear(),this.back.clear();var e=this.lineWeight/a.STAGE_SCALE,t=this.showCoor?this.x_AxisColor:this.showGrid?this.space5Color:!!this.showThin&&this.spaceColor;t?(this.x_Axis.lineStyle(e,t,1),this.x_Axis.visible=!0):this.x_Axis.visible=!1;var i=this.showCoor?this.y_AxisColor:this.showGrid?this.space5Color:!!this.showThin&&this.spaceColor;i?(this.y_Axis.lineStyle(e,i,1),this.y_Axis.visible=!0):this.y_Axis.visible=!1;var l=!!this.showThin&&this.spaceColor;l?(this.spacePath.lineStyle(e,l,1),this.spacePath.visible=!0):this.spacePath.visible=!1;var r=this.showGrid?this.space5Color:!!this.showThin&&this.spaceColor;r?(this.space5Path.lineStyle(e,r,1),this.space5Path.visible=!0):this.space5Path.visible=!1,"rgb(255, 255, 255, 0)"==this.backGroudColor?this.back.beginFill(0,0):this.back.beginFill(this.backGroudColor);var p=a.global_w,s=a.global_h,o=this.toLocal({x:0,y:0}),h=this.toLocal({x:p,y:s});if(-1==a.COOR_DIRECTION_Y_N&&(o=this.toLocal({x:0,y:s}),h=this.toLocal({x:p,y:0})),h.x-o.x>=0&&h.y-o.y>=0){this.back.drawRect(o.x,o.y,Math.max(h.x-o.x,0),Math.max(h.y-o.y,0)),this.updateText&&this.textGroup.removeChildren();for(var _=this.gridSpace,u=Math.floor(o.x);u<=Math.floor(h.x);u++)if(0!=u){var d=u%_;if(0!=d){var c=u%(_/5);0==c&&(this.spacePath.moveTo(u,o.y),this.spacePath.lineTo(u,h.y))}else{var x=u/(this.lineSpace*this.lineSpaceNum);this.space5Path.moveTo(u,o.y),this.space5Path.lineTo(u,h.y),this.addText(u,0,x)}}else this.y_Axis.moveTo(0,o.y),this.y_Axis.lineTo(0,h.y),this.addText(0,0,"0");for(var u=Math.floor(o.y);u<=Math.floor(h.y);u++)if(0!=u){var d=u%_;if(0!=d){var c=u%(_/5);0==c&&(this.spacePath.moveTo(o.x,u),this.spacePath.lineTo(h.x,u))}else{var v=u/(this.lineSpace*this.lineSpaceNum);this.space5Path.moveTo(o.x,u),this.space5Path.lineTo(h.x,u),this.addText(0,u,v)}}else this.x_Axis.moveTo(o.x,0),this.x_Axis.lineTo(h.x,0);this.spacePath.endFill(),this.space5Path.endFill(),this.x_Axis.endFill(),this.y_Axis.endFill(),this.back.endFill()}},e.prototype.addText=function(n,e,t){if(this.showCoor&&this.updateText){var i=new PIXI.Text(t,{fontSize:2*this.fontsize,fill:16777215,align:"center"});i.x=n,i.y=e;var l=1/a.STAGE_SCALE/2;i.scale.set(l,l*a.COOR_DIRECTION_Y_N),this.textGroup.addChild(i),i.cacheAsBitmap=!0}},e}(PIXI.Container)},732:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(447),a=(t(460),t(631)),p=t(455);n.exports=function(){function n(){i(this,n),this.first=null,this.second=null,this.disArr=[],this.group=new PIXI.Container,r.frontCon.addChild(this.group),this.currentLine=new p,this.group.addChild(this.currentLine),this.active=!1}return n.prototype.destroy=function(){this.first=null,this.second=null,this.group=null,this.currentLine=null},n.prototype.update=function(){if(this.disArr.length>0)for(var n=0;this.disArr.length>n;n++){var e=this.disArr[n];e.update()}this.updateEditing()},n.prototype.updateEditing=function(){if(this.first){var n=this.group.toLocal({x:r.stageMouseX,y:r.stageMouseY}),e={x:this.first.body.zpp_inner.posx,y:this.first.body.zpp_inner.posy};this.currentLine.clear(),this.currentLine.lineStyle(1,11184810),this.currentLine.moveTo(e.x,e.y),this.currentLine.lineTo(n.x,n.y)}},n.prototype.setActiveFalse=function(){this.first=null,this.second=null,this.currentLine.clear()},n.prototype.addBody=function(n){if(this.active&&-1!=r.canLinkArr.indexOf(n.typeName)){if(null==this.first)return void(this.first=n);if(this.first!=n&&!this.checkHasLink(n,this.first)){null==this.second&&(this.second=n);var e=new a(this.first,this.second,!0);this.disArr.push(e),this.group.addChild(e),this.active=!1}}},n.prototype.deleteLine=function(n){for(var e=this.checkBodyOnline(n);e.length>0;){var t=e.pop(0);this.disArr.splice(this.disArr.indexOf(t),1),t.destroy()}},n.prototype.checkBodyOnline=function(n){for(var e=[],t=0;this.disArr.length>t;t++){var i=this.disArr[t];i.first!=n&&i.second!=n||e.push(i)}return e},n.prototype.checkHasLink=function(n,e){for(var t=!1,i=0;this.disArr.length>i;i++){var l=this.disArr[i];if(l.first==n&&l.second==e||l.first==e&&l.second==n){t=!0;break}}return t},n.prototype.getData=function(){for(var n=[],e=0;this.disArr.length>e;e++){var t=this.disArr[e];n.push([t.first.id,t.second.id])}return n},n.prototype.setData=function(n){for(var e=0;n.length>e;e++){var t=n[e],i=r.napeWorld.getBodyById(t[0]),l=r.napeWorld.getBodyById(t[1]);if(i&&l){var p=new a(i,l,!0);this.disArr.push(p),this.group.addChild(p)}}},l(n,[{key:"active",get:function(){return this._active},set:function(n){this._active=n,n||this.setActiveFalse(),r.canvas.style.cursor=this._active?"crosshair":"default"}}]),n}()},733:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(447),r=t(460),a=t(455),p=function s(n,e,t,l,r,p,o,h){i(this,s),this.length=n||0,this.angle=e||0,this.color=l||"#000",this.pos=t||{x:0,y:0},this.name=r||"",this.v=p||{x:0,y:0},this.reallength=o||0,this.unit=h||"",this.group=new PIXI.Container,this.shaft=new a,this.arrow=new a,this.radShow=new a,this.ranTxt=new PIXI.Text("",{fontSize:40,fill:16777215,align:"center"}),this.ranTxt.scale.set(.25,.25),this.showText=new PIXI.Text("",{fontSize:40,fill:16777215,align:"center"}),this.showText.scale.set(.25,.25),this.discomPath=new a,this.radCon=new PIXI.Container,this.radCon.addChild(this.radShow),this.radCon.addChild(this.ranTxt),this.sAnda=new PIXI.Container,this.sAnda.addChild(this.shaft),this.sAnda.addChild(this.arrow),this.group.addChild(this.sAnda),this.group.addChild(this.discomPath),this.group.addChild(this.showText),this.group.addChild(this.radCon),this.init()};p.prototype.init=function(){this.setColor(this.color),this.changeData(this.length,this.angle,this.pos),this.arrow.beginFill(this.color),this.arrow.moveTo(0,-3),this.arrow.lineTo(5,0),this.arrow.lineTo(0,3),this.arrow.closePath()},p.prototype.setColor=function(n){this.ranTxt.style.fill=n,this.showText.style.fill=n,this.color=r.hexTo64(n||"#000000")},p.prototype.changeData=function(n,e,t,i,l){this.length=n||0,this.angle=e||0,this.pos=t||{x:0,y:0},this.v=i||{x:0,y:0},this.reallength=l||0},p.prototype.updateView=function(){var n=this.length;n=Math.max(n,1e-30),this.shaft.clear(),this.shaft.beginFill(this.color),this.shaft.drawRect(0,-1,n,2),this.shaft.endFill(),this.arrow.x=n;var e=Math.cos(this.angle),t=Math.sin(this.angle);this.sAnda.rotation=this.angle,this.sAnda.x=this.pos.x,this.sAnda.y=this.pos.y;var i=l.napeWorld.baseData,r="";if(i.showName.checked&&(r+=this.name),i.showName.checked&&i.showValue.checked&&(r+="="),i.showValue.checked&&(r+=this.reallength.toFixed(2)+this.unit),this.discomPath.clear(),this.discomPath.lineStyle(1,this.color),i.showDiscom.checked){this.v.x>0?"l0,2,l4,-2l-4,-2l0,2":0>this.v.x&&"l0,2,l-4,-2l4,-2l0,2";this.v.y>0?"l-2,0l2,4l2,-4l-2,0":0>this.v.y&&"l-2,0l2,-4l2,4l-2,0",this.discomPath.moveTo(0,0),this.discomPath.lineTo(this.v.x,0);var a=this.v.x>0?1:-1;this.discomPath.lineTo(this.v.x,2),this.discomPath.lineTo(this.v.x+4*a,0),this.discomPath.lineTo(this.v.x,-2),this.discomPath.lineTo(this.v.x,0),this.discomPath.moveTo(0,0),this.discomPath.lineTo(0,this.v.y);var p=this.v.y>0?1:-1;this.discomPath.lineTo(2,this.v.y),this.discomPath.lineTo(0,this.v.y+4*p),this.discomPath.lineTo(-2,this.v.y),this.discomPath.lineTo(0,this.v.y),this.discomPath.x=this.pos.x,this.discomPath.y=this.pos.y}if(this.showText.text=r,this.showText.scale.y=.25*l.COOR_DIRECTION_Y_N,this.showText.x=e*n+this.pos.x,this.showText.y=t*n+this.pos.y,i.showAngle.checked){this.radCon.visible=!0;this.radShow.clear(),this.radShow.lineStyle(1,this.color),this.radShow.arc(0,0,10,0,this.angle),this.radShow.endFill(),this.radCon.x=this.pos.x,this.radCon.y=this.pos.y,0>this.angle&&(this.angle=6.28+this.angle);var s=Math.round(180*this.angle/Math.PI),o=this.angle/2,h=Math.cos(o),_=Math.sin(o);this.ranTxt.text=s+"°",this.ranTxt.scale.y=.25*l.COOR_DIRECTION_Y_N,this.ranTxt.x=12*h,this.ranTxt.y=12*_}else this.radCon.visible=!1},p.prototype.destroy=function(){this.group.destroy()},p.prototype.scale=10,n.exports=p},734:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(733),r=t(447);n.exports=function(){function n(){i(this,n),this.elecColor="#0000ff",this.magnColor="#00ff00",this.chargeColor="#ff0000",this.dampColor="#ffff00",this.gravColor="#ababab",this.sumColor="#ffffff",this.volColor="#008faa",this.avolColor="#ff1493",this.outColor="#f2acba",this.colorArr=[this.elecColor,this.magnColor,this.chargeColor,this.dampColor,this.gravColor,this.sumColor,this.volColor,this.avolColor,this.gravColor,this.volColor,this.avolColor,this.outColor,this.outColor],this.nameArr=["电场力","洛伦兹力","电荷力","阻尼力","万有引力","合力","速度","加速度","重力","弹力","摩擦力","外力1","外力2"],this.group=new PIXI.Container,r.canvasStage.moveLayer.addChild(this.group),this.nowForceMap={},this.lastForceMap={}}return n.prototype.arrowScale=function(n){l.prototype.scale=n},n.prototype.clear=function(){for(var n in this.nowForceMap)delete this.nowForceMap[n];for(var n in this.lastForceMap)delete this.lastForceMap[n];this.group.removeChildren()},n.prototype.setForce=function(n,e,t,i,r,a,p,s){if(undefined,p>=1e-5){var o=this.lastForceMap[n];o===undefined?(o=new l(e,t,i,this.colorArr[r],this.nameArr[r],a,p,s),this.group.addChild(o.group)):o.changeData(e,t,i,a,p),this.lastForceMap[n]=o,this.nowForceMap[n]=o}},n.prototype.update=function(){for(var n in this.lastForceMap)if(this.nowForceMap[n])this.lastForceMap[n].updateView();else{var e=this.lastForceMap[n];e.destroy(),delete this.lastForceMap[n]}for(var n in this.nowForceMap)delete this.nowForceMap[n]},n.prototype.destroy=function(){this.nameArr=null,this.group=null,this.nowForceMap=null,this.lastForceMap=null},n}()},735:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(460),r=t(447),a=t(468),p=function(){function n(e){i(this,n),this.width=230,this.height=300,this.coor_x=this.width/2,this.coor_y=this.height/2,this.padding=15,this.plotDate=e,this.border=r.svg.paper.rect(0,0,this.width,this.height),this.border.attr({fill:"#fff","fill-opacity":0,stroke:"#e451ff","stroke-opacity":0}),this.coor=this.getCoor(),this.lineCon=r.svg.paper.group(),this.lines={},this.group=r.svg.paper.g(),this.group.add(this.border),this.group.add(this.coor),this.group.add(this.lineCon),this.zero_matirx="matrix(1,0,0,1,0,0)",this.lineNames=r.svg.paper.group(),this.lineNames.transform("t225,0"),this.group.add(this.lineNames),this.coorTextCon=this.getCoorT(),this.group.add(this.coorTextCon),this.timeSpan=10,this.smooth=1,this.updateView(),this.x_unit="s",this.y_unit="m/s"}return n.prototype.destroy=function(){this.plotDate=null,this.group.remove()},n}();p.prototype.updateView=function(){this.border.attr({width:this.width,height:this.height})},p.prototype.getCoorT=function(){function n(n){var e=Math.abs(n);return e>.01&&1e3>e?n.toFixed(2):n.toExponential(2)}var e=this,t=r.svg.paper.group(),i=!0,l=r.svg.paper.text(0,0,"").attr({fill:"#aaa","font-size":"10px"}),a=l.clone(),p=l.clone(),s=l.clone();return s.transform("t5,10"),t.add(l,a,p,s),t.update=function(){i&&(l.node.innerHTML=n(e.minx)+e.x_unit,a.node.innerHTML=n(e.maxx)+e.x_unit,p.node.innerHTML=n(e.miny)+e.y_unit,s.node.innerHTML=n(e.maxy)+e.y_unit,t.updateTextPos())},t.updateTextPosOnce=function(){},t.updateTextPosOnce(),t.updateTextPos=function(){var n="matrix(1,0,0,1,5,"+(e.height-l.node.clientHeight-5)+")",t="matrix(1,0,0,1,"+(e.width-5.859375*a.node.innerHTML.length-5)+","+(e.height-l.node.clientHeight-5)+")",i="matrix(1,0,0,1,5,"+(e.height-s.node.clientHeight-15)+")";l.node.setAttribute("transform",n),a.node.setAttribute("transform",t),p.node.setAttribute("transform",i)},t.clear=function(){l.node.innerHTML="",a.node.innerHTML="",l.node.innerHTML="",l.node.innerHTML=""},t.setVisible=function(n){i=n,t.attr({display:i?"block":"none"})},t},p.prototype.getCoor=function(){var n=this,e=r.svg.paper.group(),t=r.svg.paper.path(),i=!0;t.attr({fill:"none",stroke:"#fff"});var l=r.svg.paper.path();l.attr({fill:"none",stroke:"#85002f"}),e.add(l),e.add(t);return e.update=function(){e.attr({transform:"t"+n.coor_x+","+n.coor_y});for(var i=Snap.toLocal(e,new a,n.group),r="",p="",s=i.x;i.x+n.width>s;s++)0!=s?s%20==0&&(p+="M"+s+","+i.y+"L"+s+","+(i.y+n.height)):r+="M0,"+i.y+"L0,"+(i.y+n.height);for(var o=i.y;i.y+n.height>o;o++)0!=o?o%20==0&&(p+="M"+i.x+","+o+"L"+(i.x+n.width)+","+o):r+="M"+i.x+",0L"+(i.x+n.width)+",0";r+=Snap.path.map("M0,0L-3,3M0,0L3,3",new Snap.Matrix(1,0,0,1,0,i.y)),r+=Snap.path.map("M0,0L-3,3M0,0L3,3",new Snap.Matrix(0,1,-1,0,i.x+n.width,0)),t.node.setAttribute("d",r),l.node.setAttribute("d",p)},e.update2=function(){if(i){var t="";e.node.setAttribute("transform",n.zero_matirx);for(var r=n.getSpace(n.minx,n.maxx),a=Math.floor(n.minx/r)*r;n.maxx>a;a+=r){var p=a*n.xscale;t+="M"+p+","+n.coor_top+"L"+p+","+n.coor_bottom}for(var s=n.getSpace(n.miny,n.maxy),o=Math.floor(n.miny/s)*s;n.maxy>o;o+=s){var h=o*n.yscale;t+="M"+n.coor_left+","+h+"L"+n.coor_right+","+h}l.node.setAttribute("d",t)}},e.setVisible=function(n){i=n,e.attr({display:i?"block":"none"})},e},p.prototype.getSpace=function(n,e){var t=e-n;if(0==t)return 10;var i=1;if(t<1){for(var l=.1,r=0;1>Math.floor(t/l);)t/=l,r++;i=Math.pow(10,-r)}else{for(var l=10,r=0;Math.floor(t/l)>1;)t/=l,r++;i=Math.pow(10,r)}return i},p.prototype.setCoorVisible=function(n){this.coor.setVisible(n),this.coorTextCon.setVisible(n)},p.prototype.setLineNamesVisible=function(n){this.lineNames.attr({display:n?"block":"none"})},p.prototype.setWH=function(n,e){this.width=n||this.width,this.height=e||this.height,this.coor_x=this.width/2,this.coor_y=this.height/2,this.lineNames.transform("t"+(this.width-5)+",0"),this.updateView()},p.prototype.setXY=function(n,e){this.group.attr({transform:"t"+n+","+e})},p.prototype.setTarget=function(n){this.target=n},p.prototype.ifFillImage=function(n){this.fillImage=n,this.fill.attr({fill:n?"#ff0":"none"})},p.prototype.clear=function(){for(var n in this.lines){this.lines[n].clear(),delete this.lines[n]}},p.prototype.update=function(){if(this.minx=null,this.miny=null,this.maxx=null,this.maxy=null,0!=this.plotDate.showLineList){for(var n=0;this.plotDate.showLineList.length>n;n++){var e=this.plotDate.showLineList[n],t=this.lines[e.name];if(t){t.setVisible(e.checked),t.update();for(var i=0;t.dateArr.length>i;i++){var l=t.dateArr[i];this.minx=null!=this.minx?Math.min(this.minx,l.x):l.x,this.maxx=null!=this.maxx?Math.max(this.maxx,l.x):l.x,this.miny=null!=this.miny?Math.min(this.miny,l.y):l.y,this.maxy=null!=this.maxy?Math.max(this.maxy,l.y):l.y}}}if(this.minx==this.maxx)this.minx-=1,this.maxx+=1;else{var r=this.maxx-this.minx;this.maxx/1e3>r&&(this.maxx+=1e3*r,this.minx-=1e3*r)}if(this.xscale=(this.width-2*this.padding)/(this.maxx-this.minx),this.miny==this.maxy)this.miny-=1,this.maxy+=1;else{var a=this.maxy-this.miny;this.maxy/1e3>a&&(this.maxy+=1e3*a,this.miny-=1e3*a)}this.yscale=(this.height-2*this.padding)/(this.maxy-this.miny),1==this.xscale?(this.coor_left=-this.width/2,this.coor_right=this.width/2):(this.coor_left=this.minx,this.coor_right=this.maxx),1==this.yscale?(this.coor_top=-this.height/2,this.coor_bottom=this.height/2):(this.coor_top=this.miny,this.coor_bottom=this.maxy),this.coor_left*=this.xscale,this.coor_right*=this.xscale,this.coor_bottom*=this.yscale,this.coor_top*=this.yscale,this.coor_x=-this.minx*this.xscale,this.coor_y=-this.miny*this.yscale;for(var p in this.lines){var t=this.lines[p];t.draw()}this.zero_matirx="matrix(1,0,0,1,"+(-this.minx*this.xscale+this.padding)+","+(-this.miny*this.yscale+this.padding)+")";this.lineCon.node.setAttribute("transform","matrix(1,0,0,-1,"+(-this.minx*this.xscale+this.padding)+","+(this.height-(-this.miny*this.yscale+this.padding))+")"),this.coor.update2(),this.coorTextCon.update()}},p.prototype.changeShowLines=function(){this.lineNames.clear(),0==this.plotDate.showLineList&&this.coorTextCon.clear();for(var n=1,e=0;this.plotDate.showLineList.length>e;e++){var t=this.plotDate.showLineList[e],i=this.lines[t.name];i||(i=this.lines[t.name]=this.getLine(t),this.lineCon.add(i.g))}t&&(this.x_unit=this.getUnit(t.x_Axis),this.y_unit=this.getUnit(t.y_Axis));for(var l in this.lines){for(var a=!1,e=0;this.plotDate.showLineList.length>e;e++){var t=this.plotDate.showLineList[e];l==t.name&&(a=!0)}var i=this.lines[l];if(a){var p=r.svg.paper.text(0,15*n,l).attr({fill:i.color,"font-size":"10px"});p.attr({x:-p.node.clientWidth}),this.lineNames.add(p),n++}else i.clear(),delete this.lines[l]}this.lineNames.transform("t"+(this.width-5)+",0"),this.coorTextCon.updateTextPosOnce()},p.prototype.getLine=function(n){function e(){this.color=Snap.hsl(Math.random(),Math.random(),.5),this.line=r.svg.paper.path("").attr({fill:"none",stroke:this.color,strokeWidth:1}),this.fill=r.svg.paper.path("").attr({fill:"none","fill-opacity":.5}),this.dot=r.svg.paper.circle(0,0,2).attr({fill:this.color}),this.fillImage=!1,this.from=n,this.dateArr=[],this.maxLength=200,this.g=r.svg.paper.g(this.line,this.fill,this.dot),this.space=1,this.visible=!0,this.minx=0,this.maxx=0,this.miny=0,this.maxy=0,this.update=function(){var n=new a(t.getData(this.from.x_Axis),t.getData(this.from.y_Axis));for(this.dateArr.push(n);this.dateArr.length>60*t.timeSpan;)this.dateArr.shift()},this.draw=function(){if(1!=this.dateArr.length&&this.visible){for(var n,e="",i=0,l=0,r=0;this.dateArr.length>r;r++){n=this.dateArr[r];var a=0==r?"M":"L";r%t.smooth!=0&&r!=this.dateArr.length-1||(i=n.x*t.xscale,l=n.y*t.yscale,e+=a+i+","+l)}this.dot.node.setAttribute("transform","matrix(1,0,0,1,"+i+","+l+")");this.line.node.setAttribute("d",e+"")}},this.clear=function(){this.dateArr.splice(0),this.g.remove()},this.setVisible=function(n){this.visible=n,this.g.attr({display:n?"block":"none"})}}var t=this;return new e},p.prototype.getData=function(n){return this.plotDate.getItemData(n)},p.prototype.getUnit=function(n){return this.plotDate.getUnit(n)},p.prototype.startDraw=function(){function n(){var n=Snap.sin(r.angle0%360);a.push(n),a.length>2200&&a.shift(),p=p>n?p:n,s=200>a.length?1:200/a.length;for(var o,h=-200/p,_="M0,0",u=0;a.length>u;u++)o=a[u],_+="L"+s*u+","+o*h;var d="",c="";e.fillImage&&(d="L"+s*u+",0",c=l.getXuPath({x:s*u,y:0},{x:s*u,y:o*h})),t.node.setAttribute("d",_+c),i.node.setAttribute("d",_+d)}var e=this,t=this.line,i=this.fill,r=this.target,a=[];setInterval(n,10);var p=0,s=1},n.exports=p},736:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(447);n.exports=function(){function n(){i(this,n),this.showArray=[],this.group=new PIXI.Container,l.backCon.addChild(this.group),this.expTime=0,this.start()}return n.prototype.addBody=function(n){for(var e=0;n.length>e;e++){var t=n[e];t.photoIndex=0,t.baseData.ifShowPhoto.checked&&this.setPhoto(t,0,0),this.showArray.push(t)}},n.prototype.start=function(n){if(n&&n.length)for(var e=0;n.length>e;e++)this.addBody(n[e]);this.expTime=l.space.get_elapsedTime()},n.prototype.stop=function(){this.group.removeChildren(),this.showArray.splice(0)},n.prototype.destroy=function(){this.stop(),this.group=null,this.showArray=null},n.prototype.updata=function(){for(var n=l.CurrentStageDelay,e=0;this.showArray.length>e;e++){var t=this.showArray[e];if(t.baseData.ifShowPhoto.checked)if(t.photoIndex!=undefined){var i=t.baseData.showPhotoycle.showValue,r=Math.floor((n/i).toExponential(6));r>t.photoIndex&&this.setPhoto(t,n,r)}else t.photoIndex=0}},n.prototype.setPhoto=function(n,e,t){if(this.group.addChild(n.getPhoto()),n.photoIndex=t,n.baseData.ifShowPhotoTime.checked){var i=Math.floor(1e3*e.toFixed(1))/1e3,l=n.body.zpp_inner.posx,r=n.body.zpp_inner.posy;this.group.addChild(this.getText(l+(n.R||10),r,"t = "+i+"s"))}},n.prototype.getText=function(n,e,t){var i=new PIXI.Text(t,{fontSize:32,fill:16777215,align:"center"});return i.x=n,i.y=e,i.scale.y=.25*l.COOR_DIRECTION_Y_N,i.scale.x=.25,i.cacheAsBitmap=!0,i},n}()},737:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(447),r=t(468),a=t(762),p=(t(460),t(455));n.exports=function(){function n(){i(this,n),this.group=new PIXI.Container,l.backCon.addChild(this.group),this.lineColor=10605567,this.plineColor=9719551,this.pLine=new p,this.group.addChild(this.pLine),this.pLinePath="",this.pLineArr=[],this.eLine=new p,this.group.addChild(this.eLine),this.eLinePath="",this.eLineArr=[],this.arrow=new p,this.group.addChild(this.arrow),this.arrowPath="",this.charges=[],this.staCompArr=[],this.k=1,this.chargeR=10,this.factorU=2,this.type=1,this.dengbiU=!1,this.symmetric=!1,this.gridU={sx:0,ex:100,stepx:1,sy:0,ey:100,stepy:1,mm:100,nn:100,data:[]},this.gridE={sx:0,ex:100,stepx:1,sy:0,ey:100,stepy:1,mm:100,nn:100,data:[]}}return n.prototype.update=function(){this.updateCharges();var n=this.charges.length;this.viewRect=l.canvasStage.coor.getLocalBounds(),this.elecBoundsRect=this.viewRect,this.r=r.distance(this.viewRect.width,this.viewRect.height);var e=l.STAGE_SCALE;this.step=15/Math.sqrt(e),1>e?(this.step=20/e,this.threshold=20/e,this.maxStep=500/e):2>e?(this.step=20,this.threshold=20,this.maxStep=300/e):(this.step=10,this.threshold=10,this.maxStep=500/e),this.elecArrowSpace=Math.round(180/(this.step*e*.2)),this.gridStepU=20/e,this.num=this.getTotalLineNum(),this.ele=this.charges.length,this.elecFieldModeN=0==this.ele?3:this.ele>5&&this.num/this.ele>=8?1:3,this._getTotalForce=this.getTotalForce,this.eLineArr.splice(0),this.pLineArr.splice(0),this.pLinePath="",this.pLine.clear(),this.pLine.lineStyle(1/l.STAGE_SCALE,this.plineColor),l.IF_SHOW_PLINE&&0!=n&&this.drawPotentialLine(),this.eLinePath="",this.arrowPath="",this.eLine.clear(),this.eLine.lineStyle(1/l.STAGE_SCALE,this.lineColor),this.arrow.clear(),this.arrow.lineStyle(1/l.STAGE_SCALE,this.lineColor),l.IF_SHOW_ELINE&&0!=n&&this.drawElectricLine()},n.prototype.updateCharges=function(){this.charges.splice(0),this.staCompArr.splice(0);for(var n=0;l.napeWorld.pointChargeArr.length>n;n++){var e=l.napeWorld.pointChargeArr[n];if(0!=+e.Q){var t=new a(e.body.zpp_inner.posx,e.body.zpp_inner.posy,e.Q);this.charges.push(t),this.staCompArr.push(t)}}for(var i=0;l.napeWorld.actionBodyArr.length>i;i++){var r=l.napeWorld.actionBodyArr[i];if(0!=+r.Q){var p=new a(r.body.zpp_inner.posx,r.body.zpp_inner.posy,r.Q);this.charges.push(p),this.staCompArr.push(p)}}},n.prototype.drawElectricLine=function(){var n=this.charges.length;if(1===n){this.elecFieldLineOne(this.charges[0])}else if(2===n){this.updateGridE(this.elecBoundsRect,this.step);var e=this.charges[0],t=this.charges[1];5>Math.abs(e.elecNum)||5>Math.abs(t.elecNum)?this.elecFieldLineN():this.elecFieldLineTwo(e,t)}else{switch(this.updateGridE(this.elecBoundsRect,this.step),this.elecFieldModeN){case 1:case 2:this._getTotalForce=this.getTotalForceByGrid;break;case 3:default:this._getTotalForce=this.getTotalForce}this.elecFieldLineN()}},n.prototype.elecFieldLineOne=function(n){for(var e=this.getDir(n),t=2*Math.PI/5,i=0;5>i;i++){this._drawRayLine(n.elecPoint.clone(),e*t*i,this.r,e)}},n.prototype.elecFieldLineTwo=function(n,e){var t=n.elecPoint,i=e.elecPoint,l=new r(i.x-t.x,i.y-t.y),a=this.getAngle(l),p=this.getTotalElecLineNum(n.elecNum),s=this.getTotalElecLineNum(e.elecNum),o=2*Math.PI/p,h=2*Math.PI/s,_=this.getDir(n),u=this.getDir(e);_*u>0?(this._drawRepelLine(n,a+o/2,p,_),this._drawRepelLine(e,a+Math.PI+h/2,s,u)):p>s||p==s&&_>0?this._drawAttractLine(n,e,a,p,s,_,u):this._drawAttractLine(e,n,a+Math.PI,s,p,u,_)},n.prototype.drawPotentialLine=function(){for(var n=-Infinity,e=Infinity,t=new r,i=new r,l=this.charges.length,a=0;l>a;a++){var p=this.charges[a],s=p.elecNum,o=p.elecPoint;s>n&&(n=s,t=o.clone()),e>s&&(e=s,i=o.clone())}t.x+=this.chargeR;var h=this.getTotalU(t),_=void 0;i.x+=this.chargeR,_=this.getTotalU(i);var u=[],d=void 0;if(h*_>0)if(d=t>0?h:_,this.dengbiU)for(var a=0;16>a;a++)u.push(d),d/=this.factorU;else for(var c=18,x=d/c,v=d;c>0;)u.push(d*(d/v)*(d/v)),c--,d-=x;else if(this.dengbiU){d=h,u.push(0);for(var a=0;8>a;a++)u.push(d),d/=this.factorU;d=_;for(var a=0;8>a;a++)u.push(d),d/=this.factorU}else for(var c=16,z=this.getIntCountableSet(c,-1),x=(h-_)/c,a=0;c>a;a++)d=x*z[a],u.push(d);this._gridAndContour(u)},n.prototype.elecFieldLineN=function(){this.staCompArr.sort(function(n,e){return n.elecNum-e.elecNum});var n=[],e=[],t=0;this.staCompArr.forEach(function(i){t+=i.elecNum,i.elecNum>0?n.push(i):e.push(i)},this),0>t?(this._drawElecFieldLine(e),this._drawElecFieldLine(n)):(this._drawElecFieldLine(n),this._drawElecFieldLine(e))},n.prototype._gridAndContour=function(n){this.updateGridU(this.viewRect,this.gridStepU);for(var e=this.gridU.sx,t=this.gridU.stepx,i=this.gridU.sy,l=this.gridU.stepy,a=this.gridU.mm,p=this.gridU.nn,s=this.gridU.data,o=0;a-1>o;o++)for(var h=0;p-1>h;h++)for(var _=s[o][h],u=s[o+1][h],d=s[o][h+1],c=s[o+1][h+1],x=new r(e+o*t,i+h*l),v=new r(x.x+t,x.y),z=new r(x.x,x.y+l),y=new r(x.x+t,x.y+l),f=n.length,m=0;f>m;m++){var b=n[m],g=0==b?1e-6:b/800,w=[],C=void 0;C=this.getpInEdge(_,u,x,v,b,g),C&&w.push(C),C=this.getpInEdge(u,c,v,y,b,g),C&&w.push(C),C=this.getpInEdge(_,d,x,z,b,g),C&&w.push(C),C=this.getpInEdge(d,c,z,y,b,g),C&&w.push(C);for(var M=0;w.length>M;M++){var k=w[M];if(0==M){var O=+k.x.toFixed(3),S=+k.y.toFixed(3),P=this.pLineArr[this.pLineArr.length-1];if(P&&"L"==P[0]&&O===P[1]&&S===P[2])continue;this.pLineArr.push(["M",O,S]),this.pLinePath+="M"+O+","+S,this.pLine.moveTo(O,S)}else{var O=+k.x.toFixed(3),S=+k.y.toFixed(3);this.pLinePath+="L"+O+","+S,this.pLineArr.push(["L",O,S]),this.pLine.lineTo(O,S)}}}},n.prototype._drawRayLine=function(n,e,t,i){var l=n.clone(),a=new r(Math.cos(e),Math.sin(e)),p=a.clone();p.normalize(this.step),l.x+=a.x,l.y+=a.y,this.eLinePath+="M"+l.x+","+l.y,this.eLineArr.push(["M",l.x,l.y]),this.eLine.moveTo(l.x,l.y);for(var s=0,o=!1;;){if(l.x+=p.x,l.y+=p.y,o=this._lineTo(l,p,o,i,s),!this.contains(l.x,l.y,this.elecBoundsRect))return!1;s++}},n.prototype._drawAttractLine=function(n,e,t,i,l,r,a){var p=n.elecPoint,s=e.elecPoint;this._drawSegmentLine(p,s,r);for(var o=2*Math.PI/i,h=2*Math.PI/l,_=0,u=1;i>u;u++){var d=void 0,c=void 0;u%2==0?(d=t+o*_,c=t+Math.PI-h*_):(_++,d=t-o*_,c=t+Math.PI+h*_);var x=this.drawLineTwoElec(p,s,d,r);if(l>u&&!x){var v=Math.abs(c-t)%(2*Math.PI);v=Math.min(v,2*Math.PI-v),.1>v?this._drawRayLine(s,c,this.r,a):this.drawLineTwoElec(s,p,c,a)}}},n.prototype._drawSegmentLine=function(n,e,t){var i=n.clone(),l=r.distance(n,e)/this.step,a=new r(e.x-n.x,e.y-n.y),p=a.clone();p.normalize(this.step),this.eLinePath+="M"+i.x+","+i.y,this.eLineArr.push(["M",i.x,i.y]),this.eLine.moveTo(i.x,i.y);for(var s=0,o=!1;;){if(i.x+=p.x,i.y+=p.y,o=this._lineTo(i,p,o,t,s),s>=l)return!1;s++}},n.prototype.drawLineTwoElec=function(n,e,t,i){var l=n.clone(),a=new r(Math.cos(t),Math.sin(t));l.x+=a.x,l.y+=a.y,this.eLinePath+="M"+l.x+","+l.y,this.eLineArr.push(["M",l.x,l.y]),this.eLine.moveTo(l.x,l.y);for(var p=0,s=!1;;){var o=this.getTotalForce(l);if(o.normalize(i*this.step),l.x+=o.x,l.y+=o.y,s=this._lineTo(l,o,s,i,p),this.checkBiheTo(e,l,this.threshold))return!0;if(!this.contains(l.x,l.y,this.elecBoundsRect))return!1;if(++p>this.maxStep)break}},n.prototype._drawRepelLine=function(n,e,t,i){for(var l=2*Math.PI/t,a=0;t>a;a++){var p=n.elecPoint.clone(),s=e+i*l*a,o=new r(Math.cos(s),Math.sin(s));p.x+=o.x,p.y+=o.y,this.eLinePath+="M"+p.x+","+p.y,this.eLineArr.push(["M",p.x,p.y]),this.eLine.moveTo(p.x,p.y);for(var h=0,_=!1;;){var u=this.getTotalForce(p);if(u.normalize(i*this.step),p.x+=u.x,p.y+=u.y,_=this._lineTo(p,u,_,i,h),!this.contains(p.x,p.y,this.elecBoundsRect))break;h++}}},n.prototype._lineTo=function(n,e,t,i,l){return this.contains(n.x,n.y,this.elecBoundsRect)?(t=!1,this.eLinePath+="L"+n.x+","+n.y,this.eLineArr.push(["L",n.x,n.y]),this.eLine.lineTo(n.x,n.y),l%this.elecArrowSpace==this.elecArrowSpace-1&&this.drawArrow(n,e,i)):(t?(this.eLinePath+="M"+n.x+","+n.y,this.eLineArr.push(["M",n.x,n.y]),this.eLine.moveTo(n.x,n.y)):(this.eLinePath+="L"+n.x+","+n.y,this.eLineArr.push(["L",n.x,n.y]),this.eLine.lineTo(n.x,n.y)),t=!0),t},n.prototype._drawElecFieldLine=function(n){for(var e=n.length,t=0;e>t;t++)for(var i=n[t],l=i.dir,r=i.getPoints(),a=0;r.length>a;a++){var p=r[a],s=p.index;this.eLinePath+="M"+p.x+","+p.y,this.eLineArr.push(["M",p.x,p.y]),this.eLine.moveTo(p.x,p.y);var o=this.getTotalForce(p);o.normalize(l*this.step),p.x+=o.x,p.y+=o.y,this.eLinePath+="L"+p.x+","+p.y,this.eLineArr.push(["L",p.x,p.y]),this.eLine.lineTo(p.x,p.y);for(var h=0,_=!1;;){if(o=this._getTotalForce.call(this,p),0==o.x&&0==o.y)break;o.normalize(l*this.step),p.x+=o.x,p.y+=o.y,_=this._lineTo(p,o,_,l,h);var u=!1;if(this.symmetric||(u=this.checkClose(i,p,o,this.threshold,s)),u)break;if(!this.contains(p.x,p.y,this.elecBoundsRect))break;if(++h>this.maxStep)break}}},n.prototype.drawArrow=function(n,e,t){t=t>0?1:-1;var i=e.clone();i.normalize(1);for(var r=i.x,a=-i.y,p=2/l.STAGE_SCALE*t*.5,s=p,o=p*r,h=s*a,_=-p*a,u=s*r,d=n.x,c=n.y,x=[[-13.5,0,1],[-27,-11.5,1],[0,0,1],[-27,11.5,1]],v=[],z=0;4>z;z++){var y=x[z];v[z]=[o*y[0]+h*y[1]+d,_*y[0]+u*y[1]+c,1]}this.arrowPath+="M"+v[0][0]+","+v[0][1],this.arrowPath+="L"+v[1][0]+","+v[1][1],this.arrowPath+="L"+v[2][0]+","+v[2][1],this.arrowPath+="L"+v[3][0]+","+v[3][1],this.arrowPath+="L"+v[0][0]+","+v[0][1],this.arrowPath+="M"+n.x+","+n.y,this.arrow.moveTo(v[0][0],v[0][1]),this.arrow.lineTo(v[1][0],v[1][1]),this.arrow.lineTo(v[2][0],v[2][1]),this.arrow.lineTo(v[3][0],v[3][1]),this.arrow.lineTo(v[0][0],v[0][1]),this.arrow.moveTo(n.x,n.y)},n.prototype.checkClose=function(n,e,t,i,l){return 0!=this.checCloseArr(this.staCompArr,e,t,i)},n.prototype.getTotalLineNum=function(){for(var n=0,e=this.staCompArr.length,t=0;e>t;t++)n+=this.staCompArr[t].n;return n},n.prototype.checCloseArr=function(n,e,t,i){for(var l=n.length,r=0;l>r;r++){if(n[r].checkClose(e,t,i))return!0}return!1},n.prototype.contains=function(n,e,t){var i=n>=t.left,l=t.right>=n,r=e>=t.top,a=t.bottom>=e;return i&&l&&r&&a},n.prototype.getAngle=function(n){return Math.atan2(n.y,n.x)},n.prototype.getDir=function(n){var e=n.elecNum;return e>0?1:0>e?-1:0},n.prototype.checkBiheTo=function(n,e,t){return t>=r.distance(n,e)},n.prototype.getTotalElecLineNum=function(n,e){var t=e||this.type,i=5;return i=1==t?Math.round(5*Math.sqrt(Math.abs(n/10))):Math.abs(Math.round(this.k*n*.6)),i>30&&(i=30),i},n.prototype.getTotalForceByGrid=function(n){var e=this.gridE.sx,t=this.gridE.stepx,i=this.gridE.sy,l=this.gridE.stepy,a=this.gridE.mm,p=this.gridE.nn,s=this.gridE.data,o=(n.x-e)/t,h=(n.y-i)/l,_=parseInt(o),u=parseInt(h);if(0>_||0>u||_>=a||u>=p)return{x:0,y:0};var d=_==a-1?_:_+1,c=u==p-1?u:u+1,x=s[_][u],v=s[d][u],z=s[_][c],y=s[d][c],f=o-_,m=h-u,b=r.interpolate(x,v,f),g=r.interpolate(z,y,f);return r.interpolate(b,g,m)},n.prototype.updateGridU=function(n,e){this.gridU.sx=n.left,this.gridU.ex=n.right,this.gridU.stepx=e,this.gridU.sy=n.top,this.gridU.ey=n.bottom,this.gridU.stepy=e,this.gridU.mm=parseInt((this.gridU.ex-this.gridU.sx)/this.gridU.stepx),this.gridU.nn=parseInt((this.gridU.ey-this.gridU.sy)/this.gridU.stepy),this.gridU.data=this.getMeshGridU(this.gridU.sx,this.gridU.ex,this.gridU.stepx,this.gridU.sy,this.gridU.ey,this.gridU.stepy)},n.prototype.updateGridE=function(n,e){this.gridE.sx=n.left,this.gridE.ex=n.right,this.gridE.stepx=e,this.gridE.sy=n.top,this.gridE.ey=n.bottom,this.gridE.stepy=e,this.gridE.mm=parseInt((this.gridE.ex-this.gridE.sx)/this.gridE.stepx),this.gridE.nn=parseInt((this.gridE.ey-this.gridE.sy)/this.gridE.stepy),this.gridE.data=this.getMeshGridE(this.gridE.sx,this.gridE.ex,this.gridE.stepx,this.gridE.sy,this.gridE.ey,this.gridE.stepy)},n.prototype.getMeshGridE=function(n,e,t,i,l,a){for(var p=[];e>=n;){for(var s=i,o=[];l>=s;){o.push(this.getTotalForce(new r(n,s))),s+=a}p.push(o),n+=t}return p},n.prototype.getTotalForce=function(n){for(var e=this.charges.length,t=new r(0,0),i=0;e>i;i++){var l=this.charges[i],a=l.elecPoint,p=r.distance(a,n);if(0==p){t.x=t.y=0;break}var s=this.k*l.elecNum/(p*p*p),o=(n.x-a.x)*s,h=(n.y-a.y)*s;t.x+=o,t.y+=h}return t},n.prototype.getMeshGridU=function(n,e,t,i,l,a){for(var p=[];e>=n;){for(var s=i,o=[];l>=s;){o.push(this.getTotalU(new r(n,s))),s+=a}p.push(o),n+=t}return p},n.prototype.getpInEdge=function(n,e,t,i,l,r){if(0>=(n-l)*(e-l)){return this.getPointInLineByU(t,i,l,r,n,e)}return null},n.prototype.getPointInLineByU=function(n,e,t,i,l,a){if(this.isEqualU(l,t,i))return n.clone();if(this.isEqualU(a,t,i))return e.clone();var p=(t-l)/(a-l);if(0>p||p>1)return null;var s=r.interpolate(n,e,p);if(1>r.distance(n,e))return s.clone();var o=this.getTotalU(s);return(o-t)*(a-t)>0?this.getPointInLineByU.call(this,n,s,t,i,l,o):this.getPointInLineByU.call(this,e,s,t,i,a,o)},n.prototype.isEqualU=function(n,e,t){return Math.abs(n-e)<Math.abs(t)},n.prototype.getTotalU=function(n){for(var e=this.charges.length,t=0,i=0;e>i;i++){var l=this.charges[i],a=l.elecPoint,p=r.distance(a,n);if(0==p)return Infinity;t+=this.k*l.elecNum/p}return t},n.prototype.getIntCountableSet=function(n,e){if(n=n||0,0==(n=parseInt(n)))return[];if(1==n)return[0];e=e||-1;for(var t=[0],i=1,l=1,r=0;n>i;)t[i]=e*l,i++,r++,2==r&&(r=0,l++),e=-e;return t},n}()},738:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(468),s=(t(460),t(631)),o=t(455);n.exports=function(n){function e(t,r,a){i(this,e);var h=l(this,n.call(this));return h.first=t,h.second=r,h.third=a,h.path=new o,h.text=new PIXI.Text("",{fontSize:48,fill:11184810,align:"center"}),h.line0=new s(h.first,h.second,!1),h.line1=new s(h.second,h.third,!1),h.addChild(h.line0,h.line1,h.path,h.text),h.v0=new p,h.v1=new p,h}return r(e,n),e.prototype.update=function(){this.line0.update(),this.line1.update(),this.v0.set(this.first.x-this.second.x,this.first.y-this.second.y),this.v1.set(this.third.x-this.second.x,this.third.y-this.second.y),this.v0.normalize(),this.v1.normalize();var n=this.second.x,e=this.second.y,t=Math.atan2(this.v0.y,this.v0.x),i=Math.atan2(this.v1.y,this.v1.x);0>t&&(t=2*Math.PI+t),0>i&&(i=2*Math.PI+i);var l=Math.min(t,i),r=Math.max(t,i);this.path.clear(),this.path.lineStyle(1,11184810),this.path.beginFill(11184810,.5),this.path.moveTo(n,e),this.path.arc(n,e,20,l,r),this.path.lineTo(n,e),this.path.endFill(),this.text.text=((r-l)/Math.PI*180).toFixed(1)+"°",this.text.scale.y=.25*a.COOR_DIRECTION_Y_N,this.text.scale.x=.25;var p=(l+r)/2;this.text.x=n+30*Math.cos(p),this.text.y=e+30*Math.sin(p)},e.prototype.destroy=function(){this.first=null,this.second=null,this.first=null,this.path=null,this.text=null,this.line0.destroy(),this.line1.destroy(),this.line0=null,this.line1=null,n.prototype.destroy.call(this)},e}(PIXI.Container)},739:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=(t(460),t(455));n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this)),s=a.Vec2,o=new p;r.addChild(o),r.update=function(){o.clear(),o.lineStyle(1,16711680);var n=t.get_bodies(),e=t.get_compounds(),i=0;for(i=0;i<n.get_length();i++){var l=n.at(i);this.func_createShape(l.get_shapes())}for(i=0;i<e.get_length();i++){var r,a=e.at(i),p=a.get_bodies(),s=a.get_constraints();for(r=0;r<p.get_length();r++){var l=p.at(r);this.func_createShape(l.get_shapes())}for(r=0;r<s.get_length();r++){this.createJoint(s.at(r))}}var h=t.get_constraints();for(i=0;i<h.get_length();i++){this.createJoint(h.at(i))}},r.func_createShape=function(n){var e=0,t=0;for(e=0;e<n.get_length();e++){var i=n.at(e),l=i.get_body();if(!isNaN(l.get_position().get_x()))if(i.get_radius){var r=i.get_worldCOM();this.drawSimpleCircle(r.get_x(),r.get_y(),i.get_radius(),l.get_rotation())}else{var a;if(a=i.get_worldVerts()){var p={};new s(l.posx,l.posy);for(t=0;t<a.get_length();t++){var h=a.at(t);0==t?(p.x=h.get_x(),p.y=h.get_y(),o.moveTo(h.get_x(),h.get_y())):o.lineTo(h.get_x(),h.get_y())}o.lineTo(p.x,p.y)}}}},r.createJoint=function(n){if(n.get_anchor1){var e=n.get_body1(),t=n.get_body2();if(e&&t){var i=e.localPointToWorld(n.get_anchor1()),l=t.localPointToWorld(n.get_anchor2());o.moveTo(i.get_x(),i.get_y()),o.lineTo(l.get_x(),l.get_y())}var r=n.get_body3?n.get_body3():null,a=n.get_body4?n.get_body4():null;if(r&&a){var p=r.localPointToWorld(n.get_anchor3()),s=a.localPointToWorld(n.get_anchor4());o.moveTo(p.get_x(),p.get_y()),o.lineTo(s.get_x(),s.get_y())}}};var h=Math.PI/6;return r.drawSimpleCircle=function(n,e,t,i){o.moveTo(n,e);for(var l=0;12>=l;l++){var r=Math.cos(h*l+i)*t+n,a=Math.sin(h*l+i)*t+e;o.lineTo(r,a)}},r}return r(e,n),e}(PIXI.Container)},740:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(460),s=t(460),o=t(455);n.exports=function(n){function e(t){function r(){this.nowPath=p(),this.paths=[]}function p(){var n=new o;return n.lineStyle(1,16777215),u.addChild(n),n.points=null,n.canNotScale=!0,n}function s(n,e){var t="";if(2>n.length)return t;var i=n[n.length-1];t+="M"+i.x+","+i.y,e.moveTo(i.x,i.y);for(var l=n.length-2;l>=0;l--)i=n[l],t+="L"+i.x+","+i.y,e.lineTo(i.x,i.y);return t}i(this,e);var h=l(this,n.call(this));a.backCon.addChild(h);var _={},u=h;return h.pathGroup=_,h.speedline=new o,h.forceline=new o,h.speedline.lineStyle(1,11065855),h.forceline.lineStyle(1,15792383),h.addChild(h.speedline),h.addChild(h.forceline),h.clear=function(){this.removeChildren();for(var n in _)delete _[n];this.speedline.clear(),this.forceline.clear(),this.speedline.lineStyle(1,11065855),this.forceline.lineStyle(1,15792383),this.addChild(this.speedline),this.addChild(this.forceline),this.timer=0},h.timer=0,h.update=function(){if(++this.timer%3==0)for(var n=0;t.length>n;n++){var e=t[n];if(e.drawTrajectory){if(_[e.id]===undefined){var i=new r;_[e.id]=i,i.nowPath.lineColor=e.getColor()}var l=_[e.id];if(null==l.nowPath.points&&(l.nowPath.points=e.trajectoryPath),l.nowPath.clear(),l.nowPath.lineStyle(1,l.nowPath.lineColor),""!=s(e.trajectoryPath,l.nowPath)&&l.paths.length>0){var o=l.paths[l.paths.length-1],h=o.points[o.points.length-1];l.nowPath.lineTo(h.x,h.y)}for(;;){var d=l.paths[0]||l.nowPath,c=d.points[0];if(!c)break;if(e.trajectoryDelay>a.CurrentStageDelay-c.time)break;if(d.points.shift(),0==d.points.length)d.destroy(),l.paths.shift();else{d.clear(),d.lineStyle(1,e.getColor());s(d.points,d)}}200>e.trajectoryPath.length||(l.paths.push(l.nowPath),l.nowPath=p(),l.nowPath.lineColor=e.getColor(),e.trajectoryPath=[])}else{var l=_[e.id];l&&(l.paths.forEach(function(n){u.removeChild(n)}),l.nowPath.remove(),delete _[e.id]),e.trajectoryPath=[]}}},h}return r(e,n),e.prototype.destroy=function(){this.speedline.destroy(),this.speedline=null,this.forceline.destroy(),this.forceline=null,n.prototype.destroy.call(this)},e.prototype.showPointInfo=function(){var n=this.getNearPoint(this.toLocal({x:a.stageMouseX,y:a.stageMouseY}));n&&this.showLine(n)},e.prototype.getNearPoint=function(n){var e,t=Infinity;for(var i in this.pathGroup)for(var l=Array.prototype.concat([this.pathGroup[i].nowPath],this.pathGroup[i].paths),r=0;l.length>r;r++){var a=l[r].points;if(a)for(var p=0;a.length>p;p++){var s=a[p];if(0!=s.force.o||0!=s.speed.o){var o=n.x-s.x,h=n.y-s.y,_=o*o+h*h;t>_&&100>_&&(t=_,e=s)}}}return e},e.prototype.showLine=function(n){var e="";if(0!=n.speed.o){e+="M"+n.x+","+n.y;var t=s.setPointLength(n.speed,n.speed.o*a.VOL_SHOW_SCALE);e+="L"+(t.x+n.x)+","+(t.y+n.y),e+=this.getArrow(t,{x:t.x+n.x,y:t.y+n.y}),p.pathToGraphics(e,this.speedline)}var e="";if(0!=n.force.o){var i=s.setPointLength(n.force,a.Value2Pixel(n.force.o*a.FORCE_SHOW_SCALE));e+="M"+n.x+","+n.y,e+="L"+(i.x+n.x)+","+(i.y+n.y),e+=this.getArrow(i,{x:i.x+n.x,y:i.y+n.y}),p.pathToGraphics(e,this.forceline)}},e.prototype.getArrow=function(n,e){var t=Math.atan2(n.y,n.x),i=Math.sin(t),l=Math.cos(t);return""+Snap.path.map("M0,0L-4,-3M0,0L-4,3",new Snap.Matrix(l,i,-i,l,e.x,e.y))},e}(o)},741:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.line=new p,t.t1=new PIXI.Text("x",{fontSize:12,fill:16777215,align:"center"}),t.t1.x=53,t.t1.y=-10,t.t2=new PIXI.Text("y",{fontSize:12,fill:16777215,align:"center"}),t.t2.x=-3,t.t2.y=-55,t.x=50,t.addChild(t.line),t.addChild(t.t1),t.addChild(t.t2),t.revertY(),t}return r(e,n),e.prototype.destroy=function(){n.prototype.destroy.call(this)},e.prototype.revertY=function(){this.line.clear(),this.line.lineStyle(1,12334152),this.line.moveTo(0,0),this.line.lineTo(50,0),this.line.lineStyle(1,1676095),this.line.moveTo(0,0),this.line.lineTo(0,50*a.COOR_DIRECTION_Y_N),this.t2.y=1==a.COOR_DIRECTION_Y_N?48:-65,this.updatePosition()},e.prototype.updatePosition=function(){this.y=a.global_h-20-(1==a.COOR_DIRECTION_Y_N?80:30)},e}(PIXI.Container)},742:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(520),p=t(468),s=t(447),o=t(460),h=t(712),_=t(627),u=t(495);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="ActionBody";var r=s.Circle,a=s.space;t.R=10,t.Q=0,t.asMassPoint=!1,t.shape=new PIXI.Sprite,t.addChild(t.shape),t.color="#ffffff",t.color64=16777215,t.imageUrl="";var p=new r(t.R);return p.set_material(t.material),t.body.get_shapes().add(p),t.body.get_userData().view=t.group,t.body.set_space(a),t.body.set_allowRotation(!1),t.body.get_cbTypes().add(s.BODY_CB_TYPE),t.drawTrajectory=!1,t.trajectoryPath=[],t.trajectoryLength=300,t.trajectoryDelay=100,t.baseData=new h(t),t.plotData=new _(t),t.soundName="collision",t.registSound(),t.checkMove(),t.changeSensorEnabled(),t}return r(e,n),e.prototype.setAsMassPoint=function(n){this.asMassPoint=n,this.changeShapeR()},e.prototype.changeSensorEnabled=function(){u.setLayer(this.body,u.LAYER_1),u.setMask(this.body,s.IF_COLLISION?u.DEFAULT:u.LAYER_1)},e.prototype.reset=function(){n.prototype.reset.call(this),this.trajectoryPath.splice(0)},e.prototype.updateShow=function(){if(n.prototype.updateShow.call(this),this.drawTrajectory){var e=new p(this.body.zpp_inner.posx,this.body.zpp_inner.posy);e.time=s.CurrentStageDelay,e.force={x:this.force_x,y:this.force_y,o:this.force_o},e.speed={x:this.pre_velx,y:this.pre_vely,o:this.pre_velo},this.trajectoryPath.push(e)}this.plotData.updataImage()},e.prototype.upSide=function(){this.updateView()},e.prototype.setR=function(n){this.R=Math.max(2,Math.min(n,1e3)),this.changeShapeR(),this.changeSensorEnabled(),this.updateView()},e.prototype.changeShapeR=function(){var n=this.body.get_shapes().at(0);this.body.get_shapes().remove(n);var e=new s.Circle(this.asMassPoint?.001:this.R);e.set_material(this.material),this.body.get_shapes().add(e)},e.prototype.setQ=function(n){this.Q=n,this.chargeChange()},e.prototype.fillImage=function(n){this.imageUrl=n,this.updateView()},e.prototype.changeColor=function(n){this.imageUrl="",this.color=n;var e=Snap.color(n.substring(n.lastIndexOf("#")));this.color64=o.hexTo64(e.hex),this.updateView()},e.prototype.getColor=function(){return this.color64},e.prototype.updateView=function(){if(""!=this.imageUrl){var n=this;Snap.load(this.imageUrl,function(e){var t=new Snap(e.node),i=Math.min(10*n.R,1e3),l=n.R/i;n.shape.scale.set(l,l*s.COOR_DIRECTION_Y_N),n.shape.pivot.set(i,i),t.attr({width:2*i,height:2*i});var r=t.toDataURL();n.shape.texture=PIXI.Texture.fromImage(r)})}else{var e=this.getTexture();this.shape.texture=PIXI.Texture.fromImage(e)}},e.prototype.getTexture=function(){var n=Math.min(10*this.R,1e3),e=this.R/n;this.shape.scale.set(e,e*s.COOR_DIRECTION_Y_N),this.shape.pivot.set(n,n),this.svg||(this.svg=new Snap(10,10),this.circle=this.svg.paper.circle()),this.svg.attr({width:2*n,height:2*n}),this.circle.attr({r:n,cx:n,cy:n}),"#"==this.color.charAt(0)?this.circle.attr({fill:this.color}):(this.gradient&&this.gradient.remove(),this.gradient=this.svg.paper.gradient(this.color),this.circle.attr({fill:this.gradient}));var t=this.svg.outerSVG();return this.svg.remove(),this.svg.clear(),this.svg=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t)))},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.plotData.destroy(),this.plotData=null},e}(a)},743:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(713),o=(t(468),t(455));n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="ArcTrack",t.startAngle=0,t.endAngle=180,t.R=100,t.elasticity=1,t.friction=0,t.tHeight=1,t.jingdu=4,t.shape=new o,t.addChild(t.shape),t.material=new p.Material(1,0,0,1,0),t.body=new p.Body(p.BodyType.get_KINEMATIC()),t.body.get_userData().view=t.group,t.body.set_space(p.space),t.updateView(),t.baseData=new s(t),t.initAnchor0(),t}return r(e,n),e.prototype.initAnchor0=function(){function n(n){var e=90*Math.round(n/90);return Math.abs(e-n)>5||(n=e),n}var e=this;this.anchor1=this.initAnchor(),this.anchor1.dragUtil.initDragCircleArea(),this.anchor1.dragUtil.dragCircleArea.set(0,0,100,!0),this.anchor2=this.initAnchor(),this.anchor2.dragUtil.initDragCircleArea(),this.anchor2.dragUtil.dragCircleArea.set(0,0,100,!0),this.anchor1.dragUtil.on("moveInCircle",function(n){e.baseData.startAngle.value=n.angle}),this.anchor1.dragUtil.on("end",function(){var t=n(e.baseData.startAngle.value);t!=e.baseData.startAngle.value&&(e.baseData.startAngle.value=t),e.anchorAlign(),e.updateView()}),this.anchor2.dragUtil.on("moveInCircle",function(n){e.baseData.endAngle.value=n.angle}),this.anchor2.dragUtil.on("end",function(){var t=n(e.baseData.endAngle.value);t!=e.baseData.endAngle.value&&(e.baseData.endAngle.value=t),e.anchorAlign(),e.updateView()}),this.anchorAlign(),this.showAnchor(!1)},e.prototype.showAnchor=function(n){this.anchor1&&this.anchor1.show(n),this.anchor2&&this.anchor2.show(n),this.anchorAlign()},e.prototype.anchorAlign=function(){var n=this.startAngle/180*Math.PI,e=this.endAngle/180*Math.PI,t=Math.cos(n)*this.R,i=Math.sin(n)*this.R,l=Math.cos(e)*this.R,r=Math.sin(e)*this.R;this.anchor1.x=t,this.anchor1.y=i,this.anchor2.x=l,this.anchor2.y=r},e.prototype.setStaticFriction=function(n){this.material.set_staticFriction(n)},e.prototype.setDynamicFriction=function(n){this.material.set_dynamicFriction(n),this.friction=n},e.prototype.setElasticity=function(n){this.material.set_elasticity(n),this.elasticity=n},e.prototype.changeR=function(n){this.R=n,this.anchor1.dragUtil.dragCircleArea.r=this.R,this.anchor2.dragUtil.dragCircleArea.r=this.R,this.updateView()},e.prototype.changeStartAngle=function(n){this.startAngle=n,this.updateView()},e.prototype.changeEndAngle=function(n){this.endAngle=n,this.updateView()},e.prototype.updateView=function(){var n=Math.min(this.endAngle,this.startAngle),e=Math.max(this.endAngle,this.startAngle),t=n*Math.PI/180,i=e*Math.PI/180;this.shape.clear(),this.shape.lineStyle(1,2925292),this.shape.beginFill(0,0),this.shape.arc(0,0,this.R,t,i),this.shape.endFill()},e}(a)},744:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(520),p=t(447),s=t(714),o=t(580),h=t(455),_=t(495);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="ConveyorBelt",t.beltWidth=200,t.beltHeight=2,t.wheel_radius=10,t.speed=10,t.wheel_d=p.PI_2*t.wheel_radius,t.r_speed=1,t.belt1=new h,t.belt2=new h,t.addChild(t.belt1),t.addChild(t.belt2),t.belt2.y=2*t.wheel_radius-t.beltHeight,t.beltT=new h,t.addChild(t.beltT),t.wheel1=new o(10),t.addChild(t.wheel1),t.wheel1.x=0,t.wheel1.y=t.wheel_radius,t.wheel2=new o(10),t.addChild(t.wheel2),t.wheel2.x=t.beltWidth,t.wheel2.y=t.wheel_radius,t.wheel1.setMatelColor("#2ea2ec"),t.wheel2.setMatelColor("#2ea2ec"),t.wheel1.addHole(),t.wheel2.addHole(),t.material=p.Material.rubber(),t.body=new p.Body(p.BodyType.get_KINEMATIC());var r=new p.Polygon(p.Polygon.rect(0,0,t.beltWidth,t.beltHeight),t.material);return t.body.get_shapes().add(r),t.body.set_space(p.space),t.body.get_userData().view=t.group,t.body.get_userData()["class"]=t,t.body2=t.body.copy(),t.body2.set_space(p.space),t.body.get_cbTypes().add(p.BODY_CB_TYPE),t.body2.get_cbTypes().add(p.BODY_CB_TYPE),t.setXY(0,0),_.setAllLayer(t.body),_.setAllLayer(t.body2),t.baseData=new s(t),t.setElasticity(t.material.get_elasticity()),t.setFriction(t.material.get_staticFriction()),t.setSurSpeed(t.speed),t.updateView(),t}return r(e,n),e.prototype.updateShow=function(){var n=p.CurrentStageDelay*this.speed,e=-n/this.wheel_d*p.PI_2;this.wheel1.rollTo(e),this.wheel2.rollTo(e);var t=-n%20;this.beltT.clear(),this.beltT.lineStyle(this.beltHeight,7754026);for(var i=this.beltWidth/20,l=2*this.wheel_radius-1,r=-1;i+1>r;r++){var a=20*r+t,s=a+10;this.beltT.moveTo(Math.max(Math.min(a,this.beltWidth),0),1),this.beltT.lineTo(Math.min(Math.max(s,0),this.beltWidth),1);var o=20*r-t,h=o+10;this.beltT.moveTo(Math.max(Math.min(o,this.beltWidth),0),l),this.beltT.lineTo(Math.min(Math.max(h,0),this.beltWidth),l)}},e.prototype.reverse=function(n){this.r_speed=n?-1:1,this.setSurSpeed(Math.abs(this.speed))},e.prototype.setSurSpeed=function(n){this.speed=(n||0)*this.r_speed,this.body.get_surfaceVel().set_x(this.speed),this.body2.get_surfaceVel().set_x(-this.speed)},e.prototype.setRotate=function(e){n.prototype.setRotate.call(this,e),this.body2.set_rotation(e)},e.prototype.setLength=function(n){this.beltWidth=n,this.body.get_shapes().clear();var e=new p.Polygon(p.Polygon.rect(0,0,this.beltWidth,this.beltHeight),this.material);this.body.get_shapes().add(e),this.body2.get_shapes().clear();var t=new p.Polygon(p.Polygon.rect(0,0,this.beltWidth,this.beltHeight),this.material);this.body2.get_shapes().add(t),_.setAllLayer(this.body),_.setAllLayer(this.body2),this.updateView()},e.prototype.updateView=function(){this.wheel2.x=this.beltWidth,this.wheel2.y=this.wheel_radius,this.belt1.clear(),this.belt1.beginFill(11632437),this.belt1.drawRect(0,0,this.beltWidth,this.beltHeight),this.belt1.endFill(),this.belt2.clear(),this.belt2.beginFill(11632437),this.belt2.drawRect(0,0,this.beltWidth,this.beltHeight),this.belt2.endFill(),this.updateShow()},e.prototype.setXY=function(e,t){n.prototype.setXY.call(this,e,t);var i=Math.sin(this.rotate),l=Math.cos(this.rotate),r=-(2*this.wheel_radius-this.beltHeight)*i,a=(2*this.wheel_radius-this.beltHeight)*l;this.body2.get_position().setxy(e+r,t+a)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.body2.get_userData().view=null,this.body2.get_userData()["class"]=null,this.body2.set_space(null)},e}(a)},745:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(715),o=t(455);n.exports=function(n){function e(t,r,a,o){i(this,e);var h=l(this,n.call(this));h.typeName="DampArea",h.x=t||0,h.y=r||0,h.w=a||200,h.h=o||200,h.N=2,h.K=1,h.A=.1,h.B=.1,h.C=.1,h.D=.1,h.caseV=!1,h.editResize=!0,h.showSvgEditor=1,h.fluidPro=new p.FluidProperties(0,0),h.body=new p.Body(p.BodyType.get_KINEMATIC());var _=new p.Polygon(p.Polygon.rect(0,0,h.w,h.h));return _.set_fluidEnabled(!0),_.set_fluidProperties(h.fluidPro),h.body.get_shapes().add(_),h.body.set_space(p.space),h.body.set_allowRotation(!1),h.body.get_position().set_x(h.x),h.body.get_position().set_y(h.y),h.body.get_userData().view=h.group,h.body.dragEndStatic=!0,h.spaceNumber=.005,h.updateView(),h.baseData=new s(h),h}return r(e,n),e.prototype.changeViewByEditor=function(n,e,t){this.setXY(n.x,n.y),this.setWH(e,t),this.emit("move")},e.prototype.getBoundsBox=function(){return{x:0,y:0,width:this.w,height:this.h}},e.prototype.setWH=function(n,e){this.w=n,this.h=e;var t=p.Polygon;this.body.get_shapes().clear();var i=new t(t.rect(0,0,this.w,this.h));i.set_fluidEnabled(!0),i.set_fluidProperties(this.fluidPro),this.body.get_shapes().add(i),this.updateView()},e.prototype.updateView=function(){n.prototype.updateView.call(this);var e=new o;this.addChild(e),e.lineStyle(1,16711935,1),e.beginFill(16711935,.05),e.drawRect(0,0,this.w,this.h);for(var t=0;this.w*this.h*this.spaceNumber>t;t++){var i=Math.random()*this.w,l=Math.random()*this.h;e.moveTo(i,l);var r=Math.random()*Math.PI*2;e.lineTo(i+1.5*Math.cos(r),l+1.5*Math.sin(r))}e.endFill()},e}(a)},746:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(717),o=t(636),h=t(580),_=t(495),u=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="FixedPulley",t.wheel=new h,t.addChild(t.wheel),t.body=new p.Body(p.BodyType.get_KINEMATIC());var r=new p.Circle(20);t.body.get_shapes().add(r),t.body.get_userData().view=t.group,t.body.set_space(p.space),_.setAllLayer(t.body),t.line=new u;var a=p.bodyCon.getChildIndex(t);p.bodyCon.addChildAt(t.line,a),t.line.typeName="FixedPulley",t.jointMax=200,t.circle_d=2*Math.PI*20,t.head1=new o,t.head2=new o,t.head1.translate(-20,100),t.head2.translate(20,100),t.head1.emit("move"),t.head2.emit("move"),t.joint=new p.PulleyJoint(t.head1.body,t.body,t.body,t.head2.body,new p.Vec2,new p.Vec2(-20,0),new p.Vec2(20,0),new p.Vec2,0,100),t.joint.set_space(p.space),t.baseData=new s(t);var d=t;return t.on("move",t.changeHeadPos),t.head1.dragUtil.on("start",function(n){d.joint.set_body1(d.head1.body),d.baseData.jointBody1.bodyName=""}),t.head2.dragUtil.on("start",function(n){d.joint.set_body4(d.head2.body),d.baseData.jointBody2.bodyName=""}),t.head1.dragUtil.on("move",function(n){d.changeHeadPos()}),t.head2.dragUtil.on("move",function(n){d.changeHeadPos()}),t.head1.on("change",function(n){var e=n.value;e?(d.joint.set_body1(e.body),d.baseData.jointBody1.bodyName=e.id):(d.joint.set_body1(d.head1.body),d.baseData.jointBody1.bodyName="")}),t.head2.on("change",function(n){var e=n.value;e?(d.joint.set_body4(e.body),d.baseData.jointBody2.bodyName=e.id):(d.joint.set_body4(d.head2.body),d.baseData.jointBody2.bodyName="")}),t.upDateLine(),t.upDateJoineLength(),t}return r(e,n),e.prototype.setXY=function(e,t){n.prototype.setXY.call(this,e,t),this.head1.setXY((e||0)-20,(t||0)+100),this.head2.setXY((e||0)+20,(t||0)+100),this.changeHeadPos()},e.prototype.changeHeadPos=function(){this.upDateLine(),this.upDateJoineLength()},e.prototype.updateView=function(){this.updateHeadPos(),this.upDateLine(),p.AppStatus!=p.APP_START&&this.upDateJoineLength();var n=this.joint.get_body1();this.wheel.rollTo((this.jointMax/2-Math.sqrt(Math.pow(n.zpp_inner.posx-(this.body.zpp_inner.posx-20),2)+Math.pow(n.zpp_inner.posy-this.body.zpp_inner.posy,2)))/this.circle_d*Math.PI*2*p.COOR_DIRECTION_Y_N)},e.prototype.upDateLine=function(){var n=this.body,e=this.joint.get_body1(),t=this.joint.get_body4();this.line.clear(),this.line.lineStyle(2,11632437),this.line.moveTo(e.zpp_inner.posx,e.zpp_inner.posy),this.line.lineTo(n.zpp_inner.posx-19,n.zpp_inner.posy),this.line.moveTo(t.zpp_inner.posx,t.zpp_inner.posy),this.line.lineTo(n.zpp_inner.posx+19,n.zpp_inner.posy)},e.prototype.updateHeadPos=function(){if(this.head1.body!=this.joint.get_body1()){var n=this.joint.get_body1().get_position();this.head1.setXY(n.get_x(),n.get_y())}if(this.head2.body!=this.joint.get_body4()){var n=this.joint.get_body4().get_position();this.head2.setXY(n.get_x(),n.get_y())}},e.prototype.upDateJoineLength=function(){var n=this.joint.get_body1().get_userData()["class"],e=this.joint.get_body4().get_userData()["class"],t=p.bodyCon.toLocal({x:0,y:0},n.group),i=p.bodyCon.toLocal({x:0,y:0},e.group),l=p.bodyCon.toLocal({x:-20,y:0},this.group),r=p.bodyCon.toLocal({x:20,y:0},this.group);this.jointMax=Math.sqrt(Math.pow(t.x-l.x,2)+Math.pow(t.y-l.y,2))+Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),this.joint.set_jointMax(this.jointMax)},e.prototype.start=function(){this.head1.show(!1),this.head2.show(!1)},e.prototype.reset=function(){this.updateView(),this.head1.reset(),this.head2.reset(),this.updateView(),this.head1.show(!0),this.head2.show(!0)},e.prototype.getData=function(){var n=this.baseData;return n.head1Data._bodyName=JSON.stringify(p.getDataFormItemData(this.head1.getData())),n.head2Data._bodyName=JSON.stringify(p.getDataFormItemData(this.head2.getData())),n},e.prototype.setData=function(e){n.prototype.setData.call(this,e);var t=JSON.parse(this.baseData.head1Data.bodyName),i=JSON.parse(this.baseData.head2Data.bodyName);this.head1.setData(t),this.head2.setData(i),this.updateView(),this.upDateJoineLength()},e.prototype.setBodys=function(n,e){n&&this.joint.set_body1(n.body),e&&this.joint.set_body4(e.body),this.updateView(),this.upDateJoineLength()},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.head1.destroy(),this.head2.destroy(),this.joint.set_space(null),this.line.destroy()},e}(a)},747:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(718);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="GravitySource";var r=p.Circle,a=p.Body,o=p.BodyType,h=p.space;t.M=1e14,t.r=10,t.imageUrl="",t.shape=new PIXI.Sprite,t.addChild(t.shape);var _=new r(t.r);return _.set_sensorEnabled(!0),t.body=new a(o.get_KINEMATIC()),t.body.get_shapes().add(_),t.body.get_userData().view=t.group,t.body.set_space(h),t.body.set_allowRotation(!1),t.body.dragEndStatic=!0,t.baseData=new s(t),t.updateView(),t}return r(e,n),e.prototype.fillImage=function(n){this.imageUrl=n,this.updateView()},e.prototype.updateView=function(){if(""!=this.imageUrl){var n=this;Snap.load(this.imageUrl,function(e){var t=new Snap(e.node),i=Math.min(10*n.r,1e3),l=n.r/i;n.shape.scale.set(l,l*p.COOR_DIRECTION_Y_N),n.shape.pivot.set(i,i),t.attr({width:2*i,height:2*i});var r=t.toDataURL();n.shape.texture=PIXI.Texture.fromImage(r)})}else{var e=this.getTexture();this.shape.texture=PIXI.Texture.fromImage(e)}},e.prototype.getTexture=function(){var n=Math.max(100,Math.min(10*this.r,1e3)),e=this.r/n;if(this.shape.scale.set(e,e),this.shape.pivot.set(n,n),!this.svg){this.svg=new Snap(10,10),this.circle1=this.svg.paper.circle(),this.circle2=this.svg.paper.circle(),this.circle3=this.svg.paper.circle();this.circle3.attr({fill:this.svg.paper.gradient("r(0.5,0.5,0.5)#f8e967-#b85b1a")});var t=this.svg.paper.gradient("r(0.5,0.5,0.5)rgba(255, 255, 255, 0)-#e86843");this.circle1.attr({fill:t,"fill-opacity":.06}),this.circle2.attr({fill:t,"fill-opacity":.06})}this.svg.attr({width:2*n,height:2*n}),this.circle1.attr({r:n,cx:n,cy:n}),this.circle2.attr({r:n-30,cx:n,cy:n}),this.circle3.attr({r:n-60,cx:n,cy:n});var i=this.svg.outerSVG();return this.svg.remove(),this.svg.clear(),this.svg=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))},e.prototype.upSide=function(){this.updateView()},e.prototype.setR=function(n){this.r=Math.max(2,Math.min(n,1e3)),this.updateView()},e}(a)},748:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=(t(479),t(520)),p=t(447),s=t(719),o=t(495),h=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="Ground",t.w=500,t.h=20,t.shape=new h,t.addChild(t.shape),t.pattern=new PIXI.extras.TilingSprite(PIXI.Texture.fromImage(t.getTxture())),t.addChild(t.pattern),t.material=p.Material.rubber(),t.setElasticity(t.material.get_elasticity()),t.setFriction(t.material.get_staticFriction()),t.showSvgEditor=1,t.body=new p.Body(p.BodyType.get_KINEMATIC());var r=new p.Polygon(p.Polygon.box(t.w,t.h),t.material);return t.body.get_shapes().add(r),t.body.set_space(p.space),t.body.get_userData().view=t.group,t.body.get_cbTypes().add(p.BODY_CB_TYPE),t.baseData=new s(t),t.body.get_userData()["class"]=t,t.setShape(),t}return r(e,n),e.prototype.setWidth=function(n){this.w=n,this.setShape()},e.prototype.setHeight=function(n){this.h=n,this.setShape()},e.prototype.setRotate=function(e){n.prototype.setRotate.call(this,e),this.setAdsorpPos()},e.prototype.setShape=function(){this.body.get_shapes().clear();var n=new p.Polygon(p.Polygon.box(this.w,this.h),this.material);this.body.get_shapes().add(n),this.updateView(),this.setAdsorpPos(),o.setLayer(this.body,o.LAYER_2)},e.prototype.updateView=function(){this.shape.clear(),this.shape.lineStyle(1,15765810),this.shape.beginFill(2263842),this.shape.drawRect(-this.w/2,-this.h/2,this.w,this.h),this.shape.endFill(),this.pattern.x=-this.w/2,this.pattern.y=-this.h/2,this.pattern.width=this.w,this.pattern.height=this.h},e.prototype.updateShow=function(){},e.prototype.setAdsorpPos=function(){Math.sin(this.rotation);this.adsorpPos.y=this.h/2*Math.cos(this.rotation)},e.prototype.changeViewByEditor=function(n,e,t){this.w=e,this.h=t,this.setShape();var i=Math.cos(this.rotation),l=Math.sin(this.rotation);this.setXY(n.x+(i*e/2-l*t/2),n.y+(i*t/2+l*e/2)),this.emit("move")},e.prototype.getBoundsBox=function(){return{x:-this.w/2,y:-this.h/2,width:this.w,height:this.h}},e.prototype.getTxture=function(){var n=new Snap(40,40),e=n.path("M0,0L40,0L40,40L0,40L0,0L40,40").attr({stroke:"forestgreen",fill:"#f09132"}).pattern(10,10,20,20),t=(n.paper.rect().attr({fill:e,width:40,height:40}),n.outerSVG());return n.remove(),n.clear(),n=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t)))},e}(a)},749:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(553),p=t(519);t(447);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="LightBar",t.jointMin=200,t.jointMax=200,t.joint.set_jointMin(t.jointMin),t.joint.set_jointMax(t.jointMax),t.head0.headShape.clear(),t.head0.headShape.beginFill(3519100),t.head0.headShape.drawCircle(0,0,6),t.head0.headShape.endFill(),t.head0.headShape.beginFill(1798476),t.head0.headShape.drawCircle(0,0,2),t.head0.headShape.endFill(),t.head1.headShape.clear(),t.head1.headShape.beginFill(3519100),t.head1.headShape.drawCircle(0,0,6),t.head1.headShape.endFill(),t.head1.headShape.beginFill(1798476),t.head1.headShape.drawCircle(0,0,2),t.head1.headShape.endFill(),t.bodyShape.clear(),t.bodyShape.beginFill(2280060),t.bodyShape.drawRect(0,-2,200,4),t.bodyShape.endFill(),t.bodyShape.beginFill(2280060,0),t.bodyShape.drawRect(0,-6,200,12),t.bodyShape.endFill(),t.head0.setXY(-100,0),t.head1.setXY(100,0),t.baseData=new p(t),t.update(),t}return r(e,n),e.prototype.changeLength=function(e){n.prototype.changeLength.call(this,e),this.jointMin=e,this.joint.set_jointMin(this.jointMin)},e.prototype.updateView=function(){n.prototype.updateView.call(this),this.bodyShape.scale.x=this.headsDate.l/200,this.bodyShape.x=this.headsDate.b1x,this.bodyShape.y=this.headsDate.b1y,this.bodyShape.rotation=this.headsDate.rotation},e}(a)},750:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(553),p=t(519),s=t(447),o=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="LightRope",t.head0.headShape.clear(),t.head0.headShape.beginFill(14529103),t.head0.headShape.drawCircle(0,0,6),t.head0.headShape.endFill(),t.head0.headShape.beginFill(8349249),t.head0.headShape.drawCircle(0,0,2),t.head0.headShape.endFill(),t.head1.headShape.clear(),t.head1.headShape.beginFill(14529103),t.head1.headShape.drawCircle(0,0,6),t.head1.headShape.endFill(),t.head1.headShape.beginFill(8349249),t.head1.headShape.drawCircle(0,0,2),t.head1.headShape.endFill(),t.back=new o,t.bodyShape.addChildAt(t.back,0);s.svg.paper.path("M-5,-5L5,-5,5,5,-5,5zM-5,-5L5,5").attr({fill:"#b17f35",stroke:"#84623b",strokeWidth:2}).pattern(-3,-2,6,4);return t.line=s.svg.paper.path("M0,0L200,0"),t.line.attr({fill:"none",stroke:"#b17f35",strokeWidth:2}),t.line.canNotScale=!1,t.head0.setXY(-100,0),t.head1.setXY(100,0),t.baseData=new p(t),t.centerNail=null,t.update(),t}return r(e,n),e.prototype.updateView=function(){n.prototype.updateView.call(this),this.bodyShape.clear(),this.bodyShape.lineStyle(2,11632437);this.centerNail?(this.bodyShape.moveTo(this.headsDate.b1x,this.headsDate.b1y),this.bodyShape.lineTo(this.centerNail.body.zpp_inner.posx,this.centerNail.body.zpp_inner.posy),this.bodyShape.lineTo(this.headsDate.b2x,this.headsDate.b2y)):(this.bodyShape.moveTo(this.headsDate.b1x,this.headsDate.b1y),this.bodyShape.lineTo(this.headsDate.b2x,this.headsDate.b2y),this.back.clear(),s.AppStatus==s.APP_STOP&&(this.back.beginFill(0,0),this.back.drawRect(0,-4,this.headsDate.l,8),this.back.x=this.headsDate.b1x,this.back.y=this.headsDate.b1y,this.back.rotation=this.headsDate.rotation))},e}(a)},751:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(553),p=t(519),s=t(447);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="LightSpring",t.jointMin=t.L_Pixel,t.jointMax=t.L_Pixel,t.joint.set_jointMin(t.jointMin),t.joint.set_jointMax(t.jointMax),t.joint.set_stiff(!1),t.joint.set_active(!1),t.W=t.L_Pixel,t.switchNum=1,t.frequency=1,t.damping=0,t.setDamping(0),t.setFrequency(1),t.head0.headShape.clear();var r=t.getHeadTexture();return t.head0.addChild(new PIXI.Sprite(PIXI.Texture.fromImage(r))),t.head0.scale.set(.1,.1),t.head0.pivot.set(55,55),t.head1.headShape.clear(),t.head1.addChild(new PIXI.Sprite(PIXI.Texture.fromImage(r))),t.head1.scale.set(.1,.1),t.head1.pivot.set(55,55),t.bShape=new PIXI.Sprite,t.bodyCon.addChildAt(t.bShape,0),t.head0.setXY(-100,0),t.head1.setXY(100,0),t.baseData=new p(t),t.changeLength(200),t.update(),t}return r(e,n),e.prototype.changeLength=function(n){this.L=s.Pixel2Value(n),this.L_Pixel=n;var e=Math.round(this.L_Pixel/10);0==e&&(e=1),this.W=10*e;var t=this.getBodyTexture();this.bShape.texture=PIXI.Texture.fromImage(t),this.joint.set_jointMin(this.L_Pixel),this.joint.set_jointMax(this.L_Pixel),this.update()},e.prototype.setDamping=function(n){this.damping=n||0,this.joint.set_damping(this.damping),this.joint.set_active(this.damping>this.switchNum?!0:!1)},e.prototype.changeGridScale=function(){this.emit("move"),this.baseData.changeLScale()},e.prototype.updateView=function(){n.prototype.updateView.call(this);var e=5*this.headsDate.normal_x,t=5*this.headsDate.normal_y;this.bShape.x=this.headsDate.b1x+e,this.bShape.y=this.headsDate.b1y+t,this.bShape.scale.x=this.headsDate.scalex/10,this.bShape.scale.y=.1,this.bShape.rotation=this.headsDate.rotation,this.bShape.pivot.y=80},e.prototype.getBodyTexture=function(){var n=new Snap;n.attr({width:10*this.L_Pixel,height:160,viewBox:"0 -80 "+10*this.L_Pixel+" 160"});var e=n.paper.gradient("l(0, 0, 0, 1)#5d5d5d:10-#ddd-#5d5d5d:90"),t=n.paper.path("M0,0L2.5,-8L7.5,8L10,0L12.5,-8,L17.5,8").attr({fill:"none",stroke:e,strokeWidth:1,"stroke-linejoin":"round","stroke-linecap":"round"}).pattern(2.5,-8,10,16),i=n.paper.rect(0,-8,200,16);i.attr({fill:t,transform:"matrix(10,0,0,10,0,0)"}),i.attr({width:this.L_Pixel});var l=n.outerSVG();return n.remove(),n.clear(),n=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)))},e.prototype.getHeadTexture=function(){var n=new Snap(110,110),e=n.paper.gradient("l(0, 0, 0, 1)#5d5d5d:10-#ddd-#5d5d5d:90"),t=(n.paper.circle(55,55,50).attr({stroke:e,strokeWidth:10,fill:"none"}),n.outerSVG());return n.remove(),n.clear(),n=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t)))},e}(a)},752:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(553),p=t(519),s=t(447);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="LightStator",t.joint=new s.WeldJoint(t.head0.body,t.head1.body,new s.Vec2,new s.Vec2),t.baseData=new p(t),t.head0.setXY(-20,0),t.head1.setXY(20,0),t.update(),t}return r(e,n),e.prototype.updateView=function(){n.prototype.updateView.call(this),this.bodyShape.clear(),this.bodyShape.beginFill(2280060),this.bodyShape.drawRect(0,-2,this.headsDate.l,4),this.bodyShape.endFill(),this.bodyShape.x=this.headsDate.b1x,this.bodyShape.y=this.headsDate.b1y,this.bodyShape.rotation=this.headsDate.rotation},e.prototype.dragUpdate=function(){n.prototype.dragUpdate.call(this);var e=(this.headsDate.b1x+this.headsDate.b2x)/2,t=(this.headsDate.b1y+this.headsDate.b2y)/2,i=s.Vec2.get(e,t),l=this.joint.get_body1().worldPointToLocal(i,!0),r=this.joint.get_body2().worldPointToLocal(i,!0);this.joint.set_anchor1(l),this.joint.set_anchor2(r),i.dispose(),this.joint.set_phase(this.joint.get_body2().get_rotation()-this.joint.get_body1().get_rotation())},e}(a)},753:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(722),o=t(495),h=t(455);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="Nail",t.text=new PIXI.Text("0,0",{fontSize:40,fill:16777215,align:"center"}),t.text.scale.set(.25,.25),t.text.y=6,t.textCon=new PIXI.Container,t.textCon.addChild(t.text),t.shape=new h,t.addChild(t.shape),t.addChild(t.textCon),t.ifShowText(!0),t.updateView();var r=new p.Circle(.01);return t.body=new p.Body(p.BodyType.get_KINEMATIC()),t.body.get_shapes().add(r),t.body.get_userData().view=t.group,t.body.set_space(p.space),t.body.set_allowRotation(!1),t.body.dragEndStatic=!0,t.anchor1=new p.Vec2,t.anchor2=new p.Vec2,t.weld=new p.WeldJoint(p.space.get_world(),null,t.anchor1,t.anchor2),t.onBody=!1,t.baseData=new s(t),t.initEvent(),o.setAllLayer(t.body),t}return r(e,n),e.prototype.initEvent=function(){var n=this,e=this.body.get_shapes().at(0);this.dragUtil.on("start",function(t){n.weld.set_space(null),n.baseData.jointBody.bodyName="",e.set_sensorEnabled(!1),n.onBody=!1}),this.dragUtil.on("end",function(t){var i={x:n.x,y:n.y},l=p.getBodyUnderMouse(i,["WoodBoard","WoodTriangle","WoodBlock"]);if(l){var r=l.get_userData().view,a=l.get_userData()["class"],s=r.toLocal({x:0,y:0},n);n.weld.set_body2(l),n.anchor2.setxy(s.x,s.y),n.anchor1.setxy(n.body.zpp_inner.posx,n.body.zpp_inner.posy),n.weld.set_anchor2(n.anchor2),n.weld.set_anchor1(n.anchor1),n.weld.set_phase(a.rotate),n.weld.set_space(p.space),n.baseData.jointBody.bodyName=r.id,n.baseData.anchor1.set(n.body.zpp_inner.posx,n.body.zpp_inner.posy),n.baseData.anchor2.copy(s),e.set_sensorEnabled(!0),n.onBody=!0}})},e.prototype.setBody=function(n){var e=this.body.get_shapes().at(0);n&&(this.anchor1.setxy(this.baseData.anchor1.x,this.baseData.anchor1.y),this.anchor2.setxy(this.baseData.anchor2.x,this.baseData.anchor2.y),this.weld.set_body2(n.body),this.weld.set_anchor2(this.anchor2),this.weld.set_anchor1(this.anchor1),this.weld.set_space(p.space),this.weld.set_phase(n.rotate),e.set_sensorEnabled(!0),this.onBody=!0)},e.prototype.updatePosition=function(n){if(n.id===this.baseData.jointBody.bodyName){var e=p.bodyCon.toLocal(this.baseData.anchor2,n);this.setXY(e.x,e.y),this.anchor1.setxy(this.body.zpp_inner.posx,this.body.zpp_inner.posy),this.weld.set_anchor1(this.anchor1),this.baseData.anchor1.set(this.body.zpp_inner.posx,this.body.zpp_inner.posy)}},e.prototype.clearBody=function(n){n.id===this.baseData.jointBody.bodyName&&(this.weld.set_space(null),this.baseData.jointBody.bodyName="",this.body.get_shapes().at(0).set_sensorEnabled(!1),this.onBody=!1)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.weld.set_space(null)},e.prototype.updateView=function(){this.shape.clear(),this.shape.beginFill(9342606),this.shape.drawCircle(0,0,5),this.shape.endFill(),this.shape.lineStyle(1,1118481),this.pathToGraphics("M-2,0L2,0M0,-2L0,2",this.shape)},e.prototype.changeTxtShow=function(n,e){this.text.text="("+n+","+e+") m"},e.prototype.ifShowText=function(n){this.textCon.visible=!n},e.prototype.upSide=function(){this.textCon.scale.y=p.COOR_DIRECTION_Y_N},e}(a)},754:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(723);t(455);n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this));r.typeName="PointCharge";var a=p.Circle,o=p.Body,h=p.BodyType,_=p.space;r.Q=t||1e-8,r.shape=new PIXI.Sprite,r.addChild(r.shape);var u=new a(8);return u.set_sensorEnabled(!0),r.body=new o(h.get_KINEMATIC()),r.body.get_shapes().add(u),r.body.get_userData().view=r.group,r.body.set_space(_),r.body.set_allowRotation(!1),r.body.dragEndStatic=!0,r.baseData=new s(r),r.updateView(),r}return r(e,n),e.prototype.updateView=function(){var n=this.getTexture();this.shape.texture=PIXI.Texture.fromImage(n)},e.prototype.getTexture=function(){this.r=8;var n=Math.min(10*this.r,1e3),e=this.r/n;this.shape.scale.set(e,e),this.shape.pivot.set(n,n);var t=new Snap(2*n,2*n),i=t.paper.gradient("r(0.5,0.5,1)#004C1E-#00781E:0.5229-#63FF3F"),l=(t.paper.circle(n,n,n).attr({fill:i}),"M"+n/2+","+n+"L"+(n+n/2)+","+n);0>this.Q||(l+="M"+n+","+n/2+"L"+n+","+(n+n/2));var r=(t.paper.path(l).attr({stroke:"#0ff",strokeWidth:2/e,fill:"none","stroke-linejoin":"round","stroke-linecap":"round"}),t.outerSVG());return t.remove(),t.clear(),t=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(r)))},e.prototype.setQ=function(n){this.Q=n,this.updateView()},e}(a)},755:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(724);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));t.typeName="ReferencePoint";var r=p.Body,a=p.BodyType;return t.text=new PIXI.Text("0,0",{fontSize:50,fill:16777215,align:"center"}),t.text.scale.set(.2,.2),t.text.y=8,t.textCon=new PIXI.Container,t.textCon.addChild(t.text),t.shape=new PIXI.Sprite,t.addChild(t.shape),t.addChild(t.textCon),t.body=new r(a.get_KINEMATIC()),t.body.dragEndStatic=!0,t.baseData=new s(t),t.ifShowText(!0),t.updateView(),t}return r(e,n),e.prototype.updateView=function(){var n=this.getTexture();this.shape.texture=PIXI.Texture.fromImage(n)},e.prototype.getTexture=function(){this.r=8;var n=Math.min(10*this.r,1e3),e=this.r/n;this.shape.scale.set(e,e),this.shape.pivot.set(n,n);var t=new Snap(2*n,2*n),i=(t.paper.circle(0,0,n-1.5/e/2).attr({stroke:"#464646",strokeWidth:1.5/e,fill:"none",cx:n,cy:n}),t.paper.path("M0 "+n+"L"+2*n+" "+n+"M"+n+" 0L"+n+" "+2*n).attr({stroke:"#464646",strokeWidth:1.5/e,fill:"none"}),t.paper.gradient("r(0.5,1,0.5)#eee-#51c3dd")),l=(t.paper.circle(n,n,n/2).attr({fill:i}),t.outerSVG());return t.remove(),t.clear(),t=null,"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)))},e.prototype.changeTxtShow=function(n,e){this.text.text="("+n+","+e+") m"},e.prototype.ifShowText=function(n){this.textCon.visible=!n},e.prototype.upSide=function(){this.textCon.scale.y=p.COOR_DIRECTION_Y_N},e}(a)},756:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(479),p=t(447),s=t(725),o=t(468),h=(t(490),t(455));n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="StraightTrack",t.angle=0,t.pixel_length=200,t.length=p.Pixel2Value(t.pixel_length),t.elasticity=1,t.friction=0,t.tHeight=1,t.pos=new o,t.start=new o,t.end=new o,t.shape=new h,t.addChild(t.shape),t.material=new p.Material(0,0,0,1,0),t.body=new p.Body(p.BodyType.get_KINEMATIC()),t.body.get_userData().view=t.group,t.baseData=new s(t),t.updateView(),t.initAnchor0(),t.showAnchor(!1),t}return r(e,n),e.prototype.initAnchor0=function(){var n=this;this.anchor1=this.initAnchor(),this.anchor1.defaultMove=!0,p.frontCon.addChild(this.anchor1),this.anchor1.dragUtil.on("move",function(e){n.baseData.X1.showValue=p.Pixel2Value(n.anchor1.x).toFixed(2),n.baseData.Y1.showValue=p.Pixel2Value(n.anchor1.y).toFixed(2)}),this.dragUtil.on("move",function(e){n.anchorAlign()}),this.anchor2=this.initAnchor(),this.anchor2.defaultMove=!0,p.frontCon.addChild(this.anchor2),this.anchor2.dragUtil.on("move",function(e){n.baseData.X2.showValue=p.Pixel2Value(n.anchor2.x).toFixed(2),n.baseData.Y2.showValue=p.Pixel2Value(n.anchor2.y).toFixed(2)})},e.prototype.showAnchor=function(n){this.anchor1&&this.anchor1.show(n),this.anchor2&&this.anchor2.show(n),n&&this.anchorAlign()},e.prototype.anchorAlign=function(){this.anchor1.x=this.x,this.anchor1.y=this.y;var n=p.Value2Pixel(this.length),e=Math.sin(this.angle),t=Math.cos(this.angle),i=n*t,l=n*e;this.anchor2.x=i+this.x,this.anchor2.y=l+this.y,this.start.set(this.x,this.y),this.end.set(this.x+i,this.y+l)},e.prototype.destroy=function(){n.prototype.destroy.call(this),this.anchor1.destroy(),this.anchor2.destroy()},e.prototype.setStaticFriction=function(n){this.material.set_staticFriction(n)},e.prototype.setDynamicFriction=function(n){this.material.set_dynamicFriction(n),this.friction=n},e.prototype.setElasticity=function(n){this.material.set_elasticity(n),this.elasticity=n},e.prototype.changeXY=function(n,e){this.setXY(n,e),this.updateView()},e.prototype.changeAngle=function(n){this.angle=n,this.updateView()},e.prototype.changeLength=function(n){this.length=n,this.updateView()},e.prototype.updateView=function(){var n=p.Value2Pixel(this.length);this.pixel_length=n,this.shape.clear(),this.shape.beginFill(0,0),this.shape.drawRect(0,-5,n,10),this.shape.endFill(),this.shape.lineStyle(1,2925292),this.shape.moveTo(0,0),this.shape.lineTo(n,0),this.shape.rotation=this.angle;var e=Math.cos(this.angle),t=Math.sin(this.angle);this.pos.x=this.body.zpp_inner.posx,this.pos.y=this.body.zpp_inner.posy,this.start.x=this.pos.x,this.start.y=this.pos.y,this.end.x=this.start.x+e*n,this.end.y=this.start.y+t*n},e}(a)},757:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(633),p=(t(579),t(447)),s=t(460),o=t(468),h=t(455),_=t(726);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="TElecFiled",t.showSvgEditor=0,t.anchor1=new o,t.anchor2=new o,t.anchor3=new o,t.baseData=new _(t),t.showAnchor(!1),t}return r(e,n),e.prototype.setXY=function(n,e){this.anchor1&&this.anchor2&&(this.anchor1.x+=n,this.anchor1.y+=e,this.baseData.posx.showValue=p.Pixel2Value(this.anchor1.x),this.baseData.posy.showValue=p.Pixel2Value(this.anchor1.y))},e.prototype.updateAnchor=function(n,e,t){var i=this;this.updateTime&&clearTimeout(this.updateTime),this.updateTime=setTimeout(function(){i.anchor1.copy(n),i.anchor2.copy(e),i.anchor3.copy(t),i.updateView()})},e.prototype.anchorAlign=function(){var n=this.angle/180*Math.PI;this.anchor.x=50*Math.cos(n)+(this.centerp?this.centerp.x:0),this.anchor.y=50*Math.sin(n)+(this.centerp?this.centerp.y:0)},e.prototype.updateView=function(){function n(n,i){var l=s.segmentsIntr,o=s.getPointDistance,h=[],_={x:n-a*c,y:i-p*c},u={x:n+a*c,y:i+p*c},d=l(_,u,t.anchor1,t.anchor2),x=l(_,u,t.anchor1,t.anchor3),v=l(_,u,t.anchor2,t.anchor3);if(d&&h.push(d),x&&h.push(x),v&&h.push(v),2>h.length)return!1;if(10>o(h[0],h[1]))return!1;var z=Math.round(h[1].x-h[0].x),y=Math.round(h[1].y-h[0].y),f={x:0,y:0},m={x:0,y:0};return 0>z*a||0>y*p?(f=h[0],m=h[1]):(f=h[1],m=h[0]),m.x=Math.floor(m.x),m.y=Math.floor(m.y),f.x=Math.floor(f.x),f.y=Math.floor(f.y),r.moveTo(f.x,f.y),e(a,p,f.x,f.y),r.moveTo(m.x,m.y),r.lineTo(f.x,f.y),!0}function e(n,e,t,i){var l=10*n,a=10*e,p=4*Math.PI/5,s=Math.cos(p),o=Math.sin(p),h=l*s-a*o+t,_=l*o+a*s+i,u=Math.cos(-p),d=Math.sin(-p),c=l*u-a*d+t,x=l*d+a*u+i;r.moveTo(t,i),r.lineTo(h,_),r.moveTo(t,i),r.lineTo(c,x)}if(this.anchor1){var t=this;this.container.removeChildren();var i=new h;this.container.addChild(i),i.lineStyle(1,36607,1),i.beginFill(36607,.2),i.moveTo(this.anchor1.x,this.anchor1.y),i.lineTo(this.anchor2.x,this.anchor2.y),i.lineTo(this.anchor3.x,this.anchor3.y),i.closePath(),i.endFill();var l=s.getTriangleCenter(this.anchor1,this.anchor2,this.anchor3);this.centerp=l;var r=(Math.max(5,Math.min(21-15*(this.E-.1)/100,21)),new h);r.lineStyle(1,36607,1),this.container.addChild(r);var a,p,o,_,u=this.E>0?this.angle:this.angle+180,d=this.getBoundsBox(),c=Math.max(d.width,d.height),x=l.x,v=l.y,z=this.lineSpace;this.anchor.dragUtil.dragCircleArea.set(x,v,50,!0),function(){u%=360;var e=u/180*Math.PI;a=Math.cos(e),p=Math.sin(e),o=Math.cos(e+Math.PI/2),_=Math.sin(e+Math.PI/2);for(var t=0;n(x+o*t*z,v+_*t*z)&&++t<=100;);for(var t=0;n(x-o*t*z,v-_*t*z)&&++t<=100;);}()}},e.prototype.getBoundsBox=function(){var n=[this.anchor1,this.anchor2,this.anchor3].sort(function(n,e){return n.x-e.x}),e=n[0].x,t=n[2].x,n=[this.anchor1,this.anchor2,this.anchor3].sort(function(n,e){return n.y-e.y}),i=n[0].y;return{x:e,y:i,width:t-e,height:n[2].y-i}},e.prototype.contains=function(n,e){return s.checkPointInTr(this.anchor1,this.anchor2,this.anchor3,{x:n,y:e})},e}(a)},758:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(634),p=(t(579),t(447)),s=t(460),o=t(468),h=t(455),_=t(727);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="TMagnField",t.showSvgEditor=0,t.container=new PIXI.Container,t.addChild(t.container),t.anchor1=new o,t.anchor2=new o,t.anchor3=new o,t.baseData=new _(t),t}return r(e,n),e.prototype.setShape=function(){},e.prototype.setXY=function(n,e){this.anchor1&&this.anchor2&&(this.anchor1.x+=n,this.anchor1.y+=e,this.baseData.posx.showValue=p.Pixel2Value(this.anchor1.x),this.baseData.posy.showValue=p.Pixel2Value(this.anchor1.y))},e.prototype.updateAnchor=function(n,e,t){var i=this;this.updateTime&&clearTimeout(this.updateTime),this.updateTime=setTimeout(function(){i.anchor1.copy(n),i.anchor2.copy(e),i.anchor3.copy(t),i.updateView()})},e.prototype.updateView=function(){if(this.anchor1){this.container.removeChildren();var n=new h;this.container.addChild(n),n.lineStyle(1,3705024,1),n.beginFill(3705024,.2),n.moveTo(this.anchor1.x,this.anchor1.y),n.lineTo(this.anchor2.x,this.anchor2.y),n.lineTo(this.anchor3.x,this.anchor3.y),n.closePath(),n.endFill();this.centerp=s.getTriangleCenter(this.anchor1,this.anchor2,this.anchor3);var e=this.getBoundsBox(),t=new h;t.lineStyle(1,3705024,1),t.beginFill(3705024),this.container.addChild(t);var i=0;1>this.B&&(i=(this.B-1)/.99*5),this.B>1&&(i=(Math.min(this.B,100)-1)/99*5);for(var l=20-2*i,r=0;e.width/l>r;r++)for(var a=0;e.height/l>a;a++){var p=r*l+10+e.x,o=a*l+10+e.y;this.contains(p,o)&&(-1==this.type?(t.moveTo(p-5,o-5),t.lineTo(p+5,o+5),t.moveTo(p+5,o-5),t.lineTo(p-5,o+5)):t.drawCircle(p,o,2))}var _=n.clone();this.container.addChild(_),t.mask=_}},e.prototype.getBoundsBox=function(){var n=[this.anchor1,this.anchor2,this.anchor3].sort(function(n,e){return n.x-e.x}),e=n[0].x,t=n[2].x,n=[this.anchor1,this.anchor2,this.anchor3].sort(function(n,e){return n.y-e.y}),i=n[0].y;return{x:e,y:i,width:t-e,height:n[2].y-i}},e.prototype.contains=function(n,e){return s.checkPointInTr(this.anchor1,this.anchor2,this.anchor3,{x:n,y:e})},e}(a)},759:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(635),p=t(628);n.exports=function(n){function e(t){i(this,e);var r=l(this,n.call(this));return r.typeName=t?"WoodBlock":"WoodBoard",r.w=t?100:200,r.h=t?100:20,r.baseData=new p(r),r.showSvgEditor=1,r.resetBody(),r}return r(e,n),e.prototype.setWidth=function(n){this.w=n,this.resetBody()},e.prototype.setHeight=function(n){this.h=n,this.resetBody()},e.prototype.changeViewByEditor=function(n,e,t){this.w=e,this.h=t,this.resetBody();var i=Math.cos(this.rotation),l=Math.sin(this.rotation);this.setXY(n.x+(i*e/2-l*t/2),n.y+(i*t/2+l*e/2)),this.emit("move")},e.prototype.getBoundsBox=function(){return{x:-this.w/2,y:-this.h/2,width:this.w,height:this.h}},e}(a)},760:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(635),p=t(628),s=t(460);t(495);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.typeName="WoodTriangle",t.angle=45,t.bottom=100,t.revertX=!1,t.revertY=!1,t.center=null,t.w=100,t.h=100,t.resetBody(),t.baseData=new p(t),t.showSvgEditor=2,t.wood.mask=t.shape,t}return r(e,n),e.prototype.resetBody=function(){var n=this.revertX?-1:1,e=this.revertY?-1:1,t=this.angle/180*Math.PI;this.points.splice(0);var i=this.bottom*n,l=Math.tan(t)*this.bottom*e;this.points.push({x:-i/2,y:-l/2},{x:i/2,y:-l/2},{x:i/2,y:l/2}),this.center=s.getPolygonCenter(this.points),this.wood.x=-this.center.x-this.w/2,this.wood.y=-this.center.y-this.h/2,this.wood.width=this.w,this.wood.height=this.h,this.w=i,this.h=l,this.setShape()},e.prototype.setShape=function(){n.prototype.setShape.call(this),this.shape.x=-this.center.x,this.shape.y=-this.center.y;var e=this.body.get_shapes().at(0),t=e.get_localCOM();t.setxy(t.get_x()-this.center.x,t.get_y()-this.center.y)},e.prototype.setAdsorpPos=function(){var n=this.body.get_shapes().at(0),e=n.get_localVerts(),t=e.at(1),i=t.get_x(),l=t.get_y(),r=Math.sin(this.rotate),a=Math.cos(this.rotate);this.adsorpPos.x=i*a-l*r,this.adsorpPos.y=i*r+l*a},e.prototype.setAngle=function(n){n%90!=0&&(this.angle=n,this.resetBody())},e.prototype.setBottom=function(n){this.bottom=n,this.resetBody()},e.prototype.setRevertX=function(n){this.revertX=n,this.resetBody()},e.prototype.setRevertY=function(n){this.revertY=n,this.resetBody()},e.prototype.changeViewByEditor=function(n,e,t){this.bottom=e,this.angle=180*Math.atan2(t,e)/Math.PI,this.resetBody();var i=Math.cos(this.rotation),l=Math.sin(this.rotation);this.setXY(n.x+(i*(this.center.x+e/2)-l*(this.center.y+t/2)),n.y+(i*(this.center.y+t/2)+l*(this.center.x+e/2))),this.emit("move")},e.prototype.getBoundsBox=function(){var n=this.getLocalBounds();return{x:n.x,y:n.y,width:Math.abs(this.w),height:Math.abs(this.h)}},e.prototype.getPhoto=function(){var n=new PIXI.Container,e=this.shape.clone(),t=new PIXI.extras.TilingSprite(this.wood.texture.clone());return n.addChild(e),n.addChild(t),t.mask=e,this.cloneData(this.shape,e),this.cloneData(this.wood,t),this.cloneData(this,n),n},e}(a)},761:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(447),a=t(468),p=t(455);n.exports=function(){function n(){i(this,n)}return n.showPoint=function(){if(this.can_adsorp){var n=r.backCon.toGlobal(this.adsorpPoint);this.point.visible=!0,this.point.x=n.x,this.point.y=n.y}else this.point.visible=!1},n.adjusting=function(n){switch(this.currentBody=n,this.can_adsorp=!1,n.typeName){case"ActionBody":this.adsorpToGrid(n),this.adsorpToArcTrack(n),this.adsorpToStraightTrack(n);break;case"GravitySource":case"PointCharge":case"ReferencePoint":case"ArcTrack":case"UniformElecField":case"UniformMagnField":case"DampArea":case"Nail":case"WoodBoard":case"WoodBlock":case"WoodTriangle":case"Ground":this.adsorpToGrid(n)}this.showPoint()},n.adsorp=function(n){if(this.currentBody==n&&this.can_adsorp){n.setXY(this.bodyPosition.x-n.adsorpPos.x,this.bodyPosition.y-n.adsorpPos.y),n.emit("move")}this.currentBody=null,this.can_adsorp=!1,this.showPoint()},n.adsorpToArcTrack=function(n){for(var e=0;r.napeWorld.arcTrackArr.length>e;e++){var t=r.napeWorld.arcTrackArr[e],i=n.body.zpp_inner.posx,l=n.body.zpp_inner.posy,a=new r.Vec2(i-t.body.zpp_inner.posx,l-t.body.zpp_inner.posy),p=a.get_length(),s=t.R-n.R,o=t.R+n.R;if(p>s-10&&o+10>p){var h=a.get_angle(),_=h/Math.PI*180;0>_&&(_+=360);var u=Math.min(t.endAngle,t.startAngle),d=Math.max(t.endAngle,t.startAngle);if(u>_||_>d)continue;var c=_%90;if(2>Math.abs(c)||2>Math.abs(90-c)){var x=Math.round(_/90)/2*Math.PI;a.setxy(Math.cos(x),Math.sin(x))}var v=t.R>p?s:o;Math.abs(t.R-p)<n.R&&(v=t.R),a.set_length(v),this.bodyPosition.set(t.body.zpp_inner.posx+a.zpp_inner.x,t.body.zpp_inner.posy+a.zpp_inner.y),a.set_length(t.R),this.adsorpPoint.set(t.body.zpp_inner.posx+a.zpp_inner.x,t.body.zpp_inner.posy+a.zpp_inner.y),this.can_adsorp=!0}}},n.adsorpToStraightTrack=function(n){for(var e=n.body.zpp_inner.posx,t=n.body.zpp_inner.posy,i=0;r.napeWorld.straightTrackArr.length>i;i++){var l=r.napeWorld.straightTrackArr[i],a=new r.Vec2(l.start.x-e,l.start.y-t),p=new r.Vec2(l.start.x-l.end.x,l.start.y-l.end.y),s=a.dot(p),o=new r.Vec2(l.end.x-e,l.end.y-t),h=new r.Vec2(l.end.x-l.start.x,l.end.y-l.start.y),_=o.dot(h);if(s>0&&_>0){var u=a.cross(p),d=Math.abs(u),c=d/l.pixel_length,x=new r.Vec2(-h.zpp_inner.y,h.zpp_inner.x);0>u&&(x=new r.Vec2(-p.zpp_inner.y,p.zpp_inner.x));var v=c-n.R;(0>v||v>0&&10>v)&&(x.set_length(c),this.adsorpPoint.set(e+x.zpp_inner.x,t+x.zpp_inner.y),v>0&&x.set_length(v),this.bodyPosition.set(e+x.zpp_inner.x,t+x.zpp_inner.y),this.can_adsorp=!0)}}},n.adsorpToGrid=function(n){if(r.ADSORP_TO_GRID&&0!==r.GRID_SPACE){var e=n.body.zpp_inner.posx+n.adsorpPos.x,t=n.body.zpp_inner.posy+n.adsorpPos.y,i=Math.round(e/r.GRID_SPACE)*r.GRID_SPACE,l=Math.round(t/r.GRID_SPACE)*r.GRID_SPACE;this.bodyPosition.set(i,l),this.adsorpPoint.set(i,l),this.can_adsorp=!0}},l(n,null,[{key:"bodyPosition",get:function(){return null==this._bodyPosition&&(this._bodyPosition=new a),this._bodyPosition}},{key:"adsorpPoint",get:function(){return null==this._adsorpPoint&&(this._adsorpPoint=new a),this._adsorpPoint}},{key:"can_adsorp",get:function(){return this._can_adsorp},set:function(n){this._can_adsorp=n}},{key:"currentBody",get:function(){return this._currentBody},set:function(n){this._currentBody=n}},{key:"point",get:function(){return null==this._point&&(this._point=new p,this._point.lineStyle(1,16777215),this._point.beginFill(16711680),this._point.drawCircle(0,0,4),this._point.endFill(),r.canvasStage.addChild(this._point)),this._point}}]),n}()},762:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),r=t(468);n.exports=function(){function n(e,t,l){i(this,n),this.elecPoint=new r(e,t),this.elecNum=l,this.r=8,this.angles=[],this.n=16,this.step=2*Math.PI/this.n,this.startAngle=0-Math.PI/2+this.step/2;for(var a=0;this.n>a;a++)this.angles.push({angle:this.startAngle+a*this.step,flag:!1})}return n.prototype.getPoints=function(){for(var n=[],e=0;this.n>e;e++){var t=this.angles[e];if(!t.flag){var i=new r;i.x=this.elecPoint.x+this.r*Math.cos(t.angle),i.y=this.elecPoint.y+this.r*Math.sin(t.angle),i.index=e,n.push(i)}}return n},n.prototype.checkClose=function(n,e,t){if(r.distance(this.elecPoint,n)<this.r){var i=this.n,l=this.getAngle(e)+Math.PI,a=Math.round((l-this.startAngle)/this.step);for(a%=i;0>a;)a+=i;for(var p=this.getIntCountableSet(i,-1),s=0;i>s;s++){var o=a+p[s];o=(o+i)%i;var h=this.angles[o];if(!h.flag)return h.flag=!0,1}return 2}return 0},n.prototype.getAngle=function(n){return Math.atan2(n.y,n.x)},n.prototype.getIntCountableSet=function(n,e){if(n=n||0,0==(n=parseInt(n)))return[];if(1==n)return[0];e=e||-1;for(var t=[0],i=1,l=1,r=0;n>i;)t[i]=e*l,i++,r++,2==r&&(r=0,l++),e=-e;return t},l(n,[{key:"dir",get:function(){return this.elecNum>0?1:0>this.elecNum?-1:0}}]),n}()},763:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(447),p=t(496),s=t(468);n.exports=function(n){function e(){i(this,e);var t=l(this,n.call(this));return t.tip=new PIXI.Container,t.tipTxt=new PIXI.Text("",{fill:16777215,fontSize:12,align:"center"}),t.tip.addChild(t.tipTxt),t.tip.visible=!1,a.canvasStage.addChild(t.tip),t.current=null,t.photo=null,t.point=new s,t.hasMove=!1,t.hide(),t}return r(e,n),e.prototype.destroy=function(){this.edit(null)},e.prototype.edit=function(n){if(null==n)return void this.hide();this.current&&this.current.showAnchor(!1),this.current=n,this.show(),this.current.showAnchor(!0);var e=a.stageMouseX/(a.global_w/a.canvas_w)+20,t=Math.min(a.stageMouseY,window.innerHeight-144)/(a.global_h/a.canvas_h);n.dropPos.set(e,t),a.main.emit(a.SHOW_EDITOR,{posx:e,posy:t})},e.prototype.updateBorder=function(n){},e.prototype.del=function(){this.current&&a.main.emit(a.ELEMENT_DELETE,{ele:this.current}),this.hide()},e.prototype.copyBody=function(n){this.current&&(a.main.emit(a.ELEMENT_COPY,{typeName:this.current.typeName,pos:n,data:this.current.baseData}),this.hide(),this.photo&&(this.photo.destroy(),this.photo=null))},e.prototype.copyElement=function(){if(this.current){if(!this.hasMove){var n=this.current.getBoundsBox();n?this.point.set(n.x+n.width+30,n.y):this.point.set(this.current.x+this.current.width+30,this.current.y),"TElecFiled"!=this.current.typeName&&"TMagnField"!=this.current.typeName||this.point.set(n.width+30,0)}this.copyBody(this.point),this.hasMove=!1}},e.prototype.copyMoveElement=function(){if(this.current){this.current&&null==this.photo&&(this.photo=this.current.getPhoto(),a.canvasStage.moveLayer.addChild(this.photo),this.photo.alpha=.7);var n=this.current.getBoundsBox();n||(n=this.current.getLocalBounds());var e=a.bodyCon.toLocal({x:a.stageMouseX,y:a.stageMouseY});this.point.set(e.x-n.width/2,e.y-n.height/2),this.photo.x=this.point.x,this.photo.y=this.point.y,this.hasMove=!0}},e.prototype.showPro=function(){this.current&&a.main.emit(a.EVENT_SHOW_DROP_INNER,{element:this.current})},e.prototype.hide=function(){this.current&&(this.current.showAnchor(!1),this.current=null),a.main.emit(a.HIDE_EDITOR)},e.prototype.show=function(){},e.prototype.showTip=function(n,e){this.tipTxt.text=n,e=e||{x:a.stageMouseX,y:a.stageMouseY},window.TweenMax?TweenMax.to(this.tip,.2,{x:e.x,y:e.y}):(this.tip.x=e.x,this.tip.y=e.y),this.tip.visible=!0},e.prototype.hideTip=function(){this.tip.visible=!1},e}(p)},764:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();n.exports=function(){function n(){i(this,n)}return n.creat=function(){return"S"+(+new Date).toString(36)+(n.idgen++).toString(36)},l(n,null,[{key:"idgen",get:function(){return n._idgen||0},set:function(e){n._idgen||(n._idgen=0),n._idgen=e}}]),n}()},765:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var l=t(447);n.exports=function(){function n(){i(this,n),this.joints=new Map,this.derects=new Map}return n.prototype.creatItem=function(n,e,t,i){var r=new l.DistanceJoint(n,e,new l.Vec2,new l.Vec2,0,t);return r.set_space(l.space),{j:r,d:i}},n.prototype.addJoint=function(n,e,t,i,l){if(!this.joints.has(t)){this.joints.set(t,this.creatItem(n,e,i,l))}},n.prototype.addDisjoint=function(n,e,t,i,r,a,p){if(!this.joints.has(n)){var s=new l.PulleyJoint(e,t,i,r,l.Vec2.weak(),l.Vec2.weak(),l.Vec2.weak(),l.Vec2.weak(),a,p);s.set_space(l.space),this.joints.set(n,s)}},n.prototype.getJoint=function(n){return this.joints.get(n)},n.prototype.removeJoint=function(n){var e=this.joints.get(n);e&&(e.j.set_space(null),this.joints["delete"](n))},n.prototype.clearJoint=function(){this.joints.forEach(function(n,e){n.j.set_space(null)}),this.joints.clear(),this.derects.clear()},n}()},766:function(n,e,t){"use strict";function i(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function l(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var a=t(496),p=t(447),s=t(490),o=t(460),h=t(455);n.exports=function(n){function e(){function t(n){u.translate(n)}i(this,e);var r=l(this,n.call(this));r.container=new PIXI.Container,r.border=new h,r.container.addChild(r.border),p.canvasStage.addChild(r.container),r.circles={"left-top":{dr:{x:-1,y:-1},c:null},"left-center":{dr:{x:-1,y:0},c:null},"left-bottom":{dr:{x:-1,y:1},c:null},"top-center":{dr:{x:0,y:-1},c:null},"bottom-center":{dr:{x:0,y:1},c:null},"right-top":{dr:{x:1,y:-1},c:null},"right-center":{dr:{x:1,y:0},c:null},"right-bottom":{dr:{x:1,y:1},c:null}};for(var a in r.circles){var o=r.circles[a];o.c=new h,o.c.lineStyle(1,1485555),o.c.beginFill(16777215),o.c.drawCircle(0,0,5),o.c.endFill(),o.c.name=a,o.c.interactive=!0,r.container.addChild(o.c);var _=new s(o.c);_.on("start",function(){}),_.on("move",t),o.drag=_}r.current=null;var u=r;return r.width=0,r.height=0,r.offx=0,r.offy=0,r.off={x:0,y:0,w:0,h:0},r.showSvgEditor=!1,r.edit(null),r}return r(e,n),e.prototype.translate=function(n){var e=n.element.name,t=this.circles[e],i=t.dr,l=o.vecShadow({x:n.offx,y:n.offy},i),r=this.width,a=this.height,p=this.offx,s=this.offy;switch(e){case"left-top":case"left-center":case"top-center":this.offx+=l.x,this.offy+=l.y,this.width-=l.x,this.height-=l.y;break;case"left-bottom":case"bottom-center":this.offx+=l.x,this.width-=l.x,this.height+=l.y;break;case"right-bottom":this.width+=l.x,this.height+=l.y;break;case"right-center":this.width+=l.x;break;case"right-top":this.offy+=l.y,this.width+=l.x,this.height-=l.y}if(this.off.x=this.offx-p,this.off.y=this.offy-s,this.off.w=this.width-r,this.off.h=this.height-a,10>=this.width||10>=this.height)return this.offx=p,this.offy=s,this.width=r,void(this.height=a);this.changeView(),this.changeCurrent()},e.prototype.changeCurrent=function(){if(this.current){this.current.changeViewByEditor(p.bodyCon.toLocal({x:0,y:0},this.border),this.width,this.height),p.main.emit("emitChanges")}},e.prototype.edit=function(n){if(this.current=n,this.container.visible=!!n,n){this.showSvgEditor=n.showSvgEditor;var e=this.current.getBoundsBox();e||(e=this.current.getLocalBounds());var t=this.current.worldTransform.clone();t.my_translate(e.x,e.y),this.container.transform.setFromMatrix(t),this.width=e.width,this.height=e.height,this.offx=0,this.offy=0,this.off.x=0,this.off.y=0,this.off.w=0,this.off.h=0,window.box=e,window.container=this.container,this.changeView(),this.changeCircleShow()}},e.prototype.changeView=function(){this.border.clear(),this.border.lineStyle(1/p.STAGE_SCALE,16777215),this.border.drawRect(0,0,this.width,this.height),this.border.endFill(),this.border.x=this.offx,this.border.y=this.offy;var n=this.width/2,e=this.height/2;for(var t in this.circles){var i=this.circles[t],l=i.c,r=i.dr;l.x=r.x*n+n+this.offx,l.y=r.y*e+e+this.offy,l.scale.set(1/p.STAGE_SCALE,1/p.STAGE_SCALE)}},e.prototype.changeCircleShow=function(){for(var n in this.circles){var e=this.circles[n],t=e.c,i=e.dr;0==this.showSvgEditor?t.visible=!1:1==this.showSvgEditor?t.visible=!0:2==this.showSvgEditor?t.visible=0==i.x||0==i.y:3==this.showSvgEditor&&(t.visible=0!=i.x&&0!=i.y)}},e.prototype.changeType=function(n){this.current==n&&(this.showSvgEditor=n.showSvgEditor,this.changeCircleShow(),this.edit(n))},e.prototype.destroy=function(){this.current=null;for(var n in this.circles){var e=this.circles[n];e.drag.destroy(),e.drag=null}},e}(a)},979:function(n,e,t){"use strict";function i(n){return n&&n.__esModule?n:{"default":n}}function l(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function a(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}e.__esModule=!0;var p=function(){function n(n,e){for(var t=0;e.length>t;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),s=function v(n,e,t){null===n&&(n=Function.prototype);var i=Object.getOwnPropertyDescriptor(n,e);if(i===undefined){var l=Object.getPrototypeOf(n);return null===l?undefined:v(l,e,t)}if("value"in i)return i.value;var r=i.get;return r===undefined?undefined:r.call(t)},o=t(688),h=i(o),_=t(76),u=t(458),d=i(u),c=t(77),x=i(c);e["default"]=function(n){function e(n){l(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return t.moduleType=8,t}return a(e,n),p(e,[{key:"init",value:function(){var n=this;return this.hasInit?Promise.resolve():(s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),new Promise(function(e){n.forceAndMotion=new h["default"](n.main.canvas.parentElement,x["default"],n.main,n.main.canvas),$(n.forceAndMotion.snap.node).css({top:0,display:"none"}),$(n.main.canvas).parent().append(n.forceAndMotion.snap.node),n.forceAndMotion.on("emitChanges",function(){}),n.forceAndMotion.on("RegistSound",function(e){n.SoundTool.register(e.name,e.callBack,null)}),n.forceAndMotion.on("PlaySound",function(e){n.SoundTool.play(e.name)}),n.forceAndMotion.appData.main.on("canvas.moveToUpdateBrush",function(){n.main.dispatchEvent("canvas.moveToUpdateBrush")}),e()}))}},{key:"setActive",value:function(n){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,n),this.switchToForce(n)}},{key:"canvasLock",value:function(n){this.forceAndMotion.appData.canvasStage.canvasLock=n}},{key:"onShowAllEquip",value:function(){this.forceAndMotion.fitStage()}},{key:"setScale",value:function(n){this.forceAndMotion.setStageScale(n)}},{key:"addOneComp",value:function(n,e,t){this.forceAndMotion.addEquip(n,e,t)}},{key:"switchToForce",value:function(n){n?(this.main.canRender=!1,$(this.main.canvas).css("display","none"),$(this.forceAndMotion.snap.node).css("display","block"),this.forceAndMotion.resize(),this.forceAndMotion.showInStage()):(this.forceAndMotion.clearNape(),this.main.canRender=!0,$(this.main.canvas).css("display","block"),$(this.forceAndMotion.snap.node).css("display","none"))}},{key:"getData",value:function(){var n=this.forceAndMotion.getData();return this.isString(n)&&(n=JSON.parse(n)),n}},{key:"setData",value:function(n){var e=this;return new Promise(function(t){e.isString(n)||(n=JSON.stringify(n)),e.forceAndMotion.setData(n),setTimeout(function(){t()},500)})}},{key:"getStageScale",value:function(){return this.forceAndMotion.getStageScale()}},{key:"isString",value:function(n){return"string"==typeof n&&n.constructor===String}},{key:"clear",value:function(){this.forceAndMotion.clear()}},{key:"removeSelected",value:function(){this.checkHasEquip()&&this.forceAndMotion.deleteElement()}},{key:"stop",value:function(){this.forceAndMotion.appStop()}},{key:"takeScreenShot",value:function(){PIXI.settings.RESOLUTION=1;var n=this.forceAndMotion.takeScreenShot();return PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION,n}},{key:"checkHasEquip",value:function(){return this.forceAndMotion.napeWorld.equipArr.length>0}},{key:"resize",value:function(){this.forceAndMotion.resize()}},{key:"resetParentElement",value:function(n){this.forceAndMotion.resetParentElement(n)}},{key:"destroy",value:function(){this.forceAndMotion.destroy(),this.forceAndMotion=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}],[{key:"MODULE_TYPE",get:function(){return _.Modules.FORCEANDMOTION}}]),e}(d["default"])}});