/*!
 * Copyright (c) 2017 Nobook inc.
 * 
 * (TBD)
 * 
 * Version: 0.6.57
 * Date: Mon Apr 27 2020 08:22:33 GMT+0800 (CST)
 */
webpackJsonpPhysicsCanvas([7],{443:function(n,e,i){"use strict";function t(n){return n&&n.__esModule?n:{"default":n}}function l(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function p(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e}function r(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}e.__esModule=!0;var a=function(){function n(n,e){for(var i=0;e.length>i;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(e,i,t){return i&&n(e.prototype,i),t&&n(e,t),e}}(),s=i(767),o=t(s),_=i(76),h=i(458),u=t(h);e["default"]=function(n){function e(n){l(this,e);var i=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i.main.phy.initNapeDist(o["default"]),i}return r(e,n),a(e,null,[{key:"MODULE_TYPE",get:function(){return _.Modules.NAPELIB}}]),e}(u["default"])},458:function(n,e,i){"use strict";function t(n){return n&&n.__esModule?n:{"default":n}}function l(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var p=function(){function n(n,e){for(var i=0;e.length>i;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(e,i,t){return i&&n(e.prototype,i),t&&n(e,t),e}}(),r=i(50),a=t(r),s=i(472),o=t(s),_=void 0,h=function(){function n(e){l(this,n),this.config=Object.assign({},e),this.config.moduleMain=this,_=this,this.moduleType=-1,this.active=!1,this.hasInit=!1,this.cachePool=new o["default"],this.looplist=[]}return p(n,[{key:"getModuleType",value:function(){return this.constructor.MODULE_TYPE}},{key:"init",value:function(){this.hasInit=!0}},{key:"addPhysicsCanvasListeners",value:function(){var n=this.config.main;this.onRemoveEquipmentProx||(this.onRemoveEquipmentProx=this.onRemoveEquipment.bind(this),this.onCanvasDomClickProx=this.onCanvasDomClick.bind(this),this.onSetDataCompleteProx=this.onSetDataComplete.bind(this)),n.addEventListener(a["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),n.addEventListener(a["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),n.addEventListener(a["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"removePhysicsCanvasListeners",value:function(){var n=this.config.main;n.removeEventListener(a["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),n.removeEventListener(a["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),n.removeEventListener(a["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"canvasLock",value:function(n){}},{key:"onRemoveEquipment",value:function(){}},{key:"onCanvasDomClick",value:function(n){}},{key:"onSetDataComplete",value:function(){}},{key:"onShowAllEquip",value:function(){}},{key:"setActive",value:function(n){this.active=n,8===this.moduleType?n?(PIXI.settings.RESOLUTION=1,this.forceAndMotion.resize()):PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION:PIXI.settings.RESOLUTION!==this.globalConfig.RESOLUTION&&(PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION),n?this.addPhysicsCanvasListeners():this.removePhysicsCanvasListeners()}},{key:"enterModule",value:function(n){return Promise.resolve()}},{key:"destroy",value:function(){this.removePhysicsCanvasListeners(),this.config.moduleMain=null,this.config=null,this.onRemoveEquipmentProx=null,this.onCanvasDomClickProx=null,this.onSetDataCompleteProx=null,this.hasInit=null,this.active=null}},{key:"updateEqu",value:function(){for(var n=this.main.getEquipmentArr(!0),e=0;n.length>e;e++){var i=n[e];if(i.update)try{i.update()}catch(t){}}}},{key:"getData",value:function(){return{}}},{key:"setData",value:function(n){}},{key:"startRecoverEqu",value:function(){}},{key:"completeRecoverEqu",value:function(){}},{key:"setDataBefore",value:function(){return Promise.resolve()}},{key:"requestAnimationLoop",value:function(){this.updateEqu(),this.main&&this.main.disComp&&this.main.disComp.update(),this.foreachLooplist()}},{key:"foreachLooplist",value:function(){for(var n=0;this.looplist.length>n;n++){var e=this.looplist[n];e.update&&e.update()}}},{key:"main",get:function(){return this.config?this.config.main:null}},{key:"equipmentUtil",get:function(){return this.main.equipmentUtil}},{key:"globalConfig",get:function(){return this.main.globalConfig}},{key:"language",get:function(){return this.main.language}},{key:"SoundTool",get:function(){return this.main.globalConfig.SoundTool}},{key:"phy",get:function(){return this.main.phy}},{key:"ParticleUtil",get:function(){return this.config.ParticleUtil}},{key:"SoundStr",get:function(){return this.config.SoundStr}},{key:"Button",get:function(){return this.config.Button}},{key:"HoverButton",get:function(){return this.config.HoverButton}},{key:"ComponentProperty",get:function(){return this.config.ComponentProperty}},{key:"NBCommand",get:function(){return this.config.NBCommand}},{key:"MouseManager",get:function(){return this.config.MouseManager}},{key:"NBDrag",get:function(){return this.config.NBDrag}},{key:"UploadSkinTool",get:function(){return this.config.UploadSkinTool}},{key:"NBEvent",get:function(){return this.config.NBEvent}}],[{key:"getInstance",value:function(){return _}}]),n}();window.each=function(n,e,i){var t=void 0;for(t=0;n&&n.length>t;t++){if(!1===(i?e.call(i,t,n[t]):e.call(n[t],t,n[t])))break}},e["default"]=h},467:function(n,e,i){"use strict";function t(){}t.nape=i(768),n.exports=t},472:function(n,e,i){"use strict";function t(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var l=function(){function n(n,e){for(var i=0;e.length>i;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(e,i,t){return i&&n(e.prototype,i),t&&n(e,t),e}}();e["default"]=function(){function n(){t(this,n),this.graphicsList=[],this.textList=[],this.elecWiredots=[],this.threeList={}}return l(n,[{key:"disposeAll",value:function(){this.graphicsList.length=0,this.textList.length=0,this.elecWiredots.length=0;for(var n=Object.keys(this.threeList),e=0;n.length>e;e++)for(var i=this.threeList[n[e]],t=0;i.length>t;t++)try{var l=i[t];l.removed&&l.removed()}catch(p){}this.threeList={}}},{key:"resetAll",value:function(n){n.x=0,n.y=0,n.pivot.x=0,n.pivot.y=0,n.scale.x=1,n.scale.y=1,n.rotation=0}},{key:"pushGraphic",value:function(n){n.clear(),this.resetAll(n),this.graphicsList.push(n)}},{key:"popGraphic",value:function(){var n=this.graphicsList.pop();return n&&n.transform||(n=new PIXI.Graphics),n}},{key:"pushText",value:function(n){n.text="",this.resetAll(n),this.textList.push(n)}},{key:"popText",value:function(n,e){var i=this.textList.pop();return i||(n=n||"",e=e||"",i=new PIXI.Text(n,e)),i}},{key:"pushElecDot",value:function(n){this.elecWiredots.push(n)}},{key:"popElecDot",value:function(){return this.elecWiredots.pop()}},{key:"pushThreeClass",value:function(n,e){var i=this.threeList[n];i||(i=[],this.threeList[n]=i),this.resetAll(e),i.push(e)}},{key:"popThreeClass",value:function(n,e,i){var t=this.threeList[n],l=null;return t&&(l=t.pop()),l||(l=new e(i)),l}}]),n}()},521:function(n,e,i){"use strict";function t(n,e,i,t){p.call(this,n,e,i,t),Object.defineProperty(this,"space",{get:function(){var n=this.get_body();return n?n.get_space():null}}),this.set_sensorEnabled(!0)}var l=i(467).nape,p=l.shape.Circle;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.addInterListeners=function(n){var e=this.space.get_listeners();n.map(function(n){e.has(n)||e.add(n)})},t.prototype.removeInterListeners=function(n){n&&this.space&&this.space.get_listeners().remove(n)},t.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},t.prototype.removeCbtype=function(n){this.get_cbTypes().remove(n)},n.exports=t},638:function(n,e,i){"use strict";function t(n,e,i){this.handJointStiff=!1,this.handJointFrequency=10,this.view=null,this.weldDrag=!1,this.classType=undefined,this.coordinateField=null,this.dragLevel=null==n?0:n,this.noDrag=e,this.bindupdate=null,this.allowMove=null==i||i,this.stopFindConnectBodies=!1,this.dragManager=null,this.freeMec=!1,this.nolight=!1,this.iswall=!1,this.originKinematicType=!1,this.pivotDrag=!1,this.moveCompo=!1,this.nomoveTool=!1,this.cannotToolRot=!1,this.dragTomoveTool=!1,this.dragtranslate=!1,this.canfixtool=!1,this.noSelectlayer=!1,this.isnbequ=!1}n.exports=t},639:function(n,e,i){"use strict";function t(n,e){l.phys.Body.call(this,n,e),this.userData=new p(0,!1,!0),Object.defineProperty(this,"shapes",{get:function(){return this.get_shapes()}}),Object.defineProperty(this,"constraints",{get:function(){return this.get_constraints()}}),Object.defineProperty(this,"cbTypes",{get:function(){return this.get_cbTypes()}}),Object.defineProperty(this,"arbiters",{get:function(){return this.get_arbiters()}}),Object.defineProperty(this,"bullet",{get:function(){return this.get_isBullet()},set:function(n){this.set_isBullet(n)}}),Object.defineProperty(this,"posx",{get:function(){return this.zpp_inner.posx},set:function(n){this.zpp_inner.posx=n,this.zpp_inner.setupPosition()}}),Object.defineProperty(this,"posy",{get:function(){return this.zpp_inner.posy},set:function(n){this.zpp_inner.posy=n,this.zpp_inner.setupPosition()}}),Object.defineProperty(this,"isSleep",{get:function(){return this.get_isSleeping()}}),Object.defineProperty(this,"rotation",{get:function(){return this.get_rotation()},set:function(n){this.set_rotation(n)}}),Object.defineProperty(this,"type",{get:function(){return this.get_type()},set:function(n){this.set_type(n)}}),Object.defineProperty(this,"noallowRotation",{get:function(){return this.zpp_inner.norotate},set:function(n){this.zpp_inner.norotate=n,this.zpp_inner.invalidate_inertia()}}),Object.defineProperty(this,"allowMovement",{get:function(){return this.get_allowMovement()},set:function(n){this.set_allowMovement(n)}}),Object.defineProperty(this,"angularVel",{get:function(){return this.get_angularVel()},set:function(n){this.set_angularVel(n)}}),Object.defineProperty(this,"velocity",{get:function(){return this.get_velocity()},set:function(n){this.set_velocity(n)}}),Object.defineProperty(this,"position",{get:function(){return this.get_position()},set:function(n){this.set_position(n)}}),Object.defineProperty(this,"bounds",{get:function(){return this.get_bounds()}}),Object.defineProperty(this,"space",{get:function(){return this.get_space()},set:function(n){this.set_space(n)}}),Object.defineProperty(this,"mass",{get:function(){return this.get_mass()},set:function(n){this.set_mass(n)}})}var l=i(467).nape,p=i(638);t.constructor=t,t.prototype=Object.create(l.phys.Body.prototype),t.prototype.dispose=function(){this.zpp_inner.outer=null,this.zpp_inner.outer_i=null},t.prototype.sensorEnabled=function(n){var e;for(e=0;e<this.shapes.get_length();e++){this.shapes.at(e).set_sensorEnabled(n)}},t.prototype.addCbType=function(n){this.cbTypes.add(n)},t.prototype.hasCbType=function(n){return this.cbTypes.has(n)},t.prototype.forbidDrag=function(n){this.userData.noDrag=n},t.prototype.add=function(n){this.shapes.add(n)},t.prototype.remove=function(n){return this.shapes.remove(n)},t.prototype.shapesAt=function(n){return this.shapes.at(n)},t.prototype.set_sensorEnabled_at=function(n,e){this.shapesAt(n).set_sensorEnabled(e)},t.prototype.set_shape_sensorEnabled=function(n,e){n.set_sensorEnabled(e)},t.prototype.setFilter_cm=function(n,e,i){n.zpp_inner.filter.collisionGroup=e,n.zpp_inner.filter.collisionMask=i},t.prototype.setGroup=function(n){this.set_group(null==n?null:n)},t.prototype.setShapeFluidEnabled=function(n,e){n.set_fluidEnabled(e)},t.prototype.getShapeFluidEnabled=function(n){return n.get_fluidEnabled()},t.prototype.setFluidDensity=function(n,e){n.get_fluidProperties().set_density(e),n.get_material().set_density(e)},t.prototype.getFluidDensity=function(n){return n.get_fluidProperties().get_density()},t.prototype.setFluidViscosity=function(n,e){n.get_fluidProperties().set_viscosity(e)},t.prototype.getFluidViscosity=function(n){return n.get_fluidProperties().get_viscosity()},t.prototype.getShapeArea=function(n){return null==n?null:n.zpp_inner.area},t.prototype.getArea=function(){var n,e=this.shapes.get_length(),i=0;for(n=0;e>n;n++)i+=this.shapes.at(n).get_area();return i},t.prototype.getDensity=function(){return 1e3*this.shapesAt(0).zpp_inner.material.density},t.prototype.setDensity=function(n){var e=this.shapes.get_length(),i=0;for(i=0;e>i;i++){var t=this.shapesAt(i);t.zpp_inner.material.density=.001*n,t.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.PROPS)}},t.prototype.getFriction=function(){return this.shapesAt(0).zpp_inner.material.dynamicFriction},t.prototype.setFriction=function(n){var e=0,i=this.shapes.get_length();for(e=0;i>e;e++){var t=this.shapesAt(e);t.zpp_inner.material.dynamicFriction=n,t.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.ANGDRAG|zpp_nape.phys.ZPP_Material.ARBITERS)}},t.prototype.getElasticity=function(){return this.shapesAt(0).zpp_inner.material.elasticity},t.prototype.setElasticity=function(n){var e=0,i=this.shapes.get_length();for(e=0;i>e;e++){var t=this.shapesAt(e);t.zpp_inner.material.elasticity=n,t.zpp_inner.material.invalidate(zpp_nape.phys.ZPP_Material.WAKE|zpp_nape.phys.ZPP_Material.ARBITERS)}},t.prototype.wake=function(){this.zpp_inner.wake()},n.exports=t},640:function(n,e,i){"use strict";function t(n,e,i,t){l.call(this,n,e,i,t)}var l=i(521);t.constructor=t,t.prototype=Object.create(l.prototype),n.exports=t},641:function(n,e,i){"use strict";function t(){}var l=i(467).nape,p=l.geom.Vec2;t.vec2Length=function(n){return Math.sqrt(n.get_x()*n.get_x()+n.get_y()*n.get_y())},t.LeftNormal=function(n){var e=new p;return e.set_x(n.get_y()),e.set_y(-n.get_x()),e.zpp_inner.validate(),e},t.rightNormal=function(n){var e=new p;return e.set_x(-n.get_y()),e.set_y(n.get_x()),e},t.normal=function(n){var e=new p,i=t.vec2Length(n);return i>0&&(e.set_x(n.get_x()/i),e.set_y(n.get_y()/i)),e},t.angle=function(n){return Math.atan2(n.get_x(),n.get_y())},t.dotProduct=function(n,e){var i=t.normal(e);return n.get_x()*i.get_x()+n.get_y()*i.get_y()},t.perpProduct=function(n,e){var i=t.LeftNormal(n),l=t.dotProduct(i,e);return 0!=l?l:1},t.project=function(n,e){var i=t.dotProduct(n,e),l=t.normal(e),r=i*l.get_x(),a=i*l.get_y();return new p(r,a)},t.bounce=function(n,e){var i=t.project(n,e),l=t.LeftNormal(e),r=t.project(n,l),a=i.get_x()+-1*r.get_x(),s=i.get_y()+-1*r.get_y();return new p(a,s)},t.symmetric=function(n,e){return t.bounce(n,t.LeftNormal(e))},n.exports=t},767:function(n,e,i){"use strict";var t=i(467);t.nape.NbBody=i(639),t.nape.NbSpace=i(770),t.nape.NbCircle=i(769),t.nape.BodyVo=i(638),t.nape.NbAngleJoint=i(771),t.nape.NbDistanceJoint=i(772),t.nape.NbLineJoint=i(773),t.nape.NbPivotJoint=i(774),t.nape.NbPulleyJoint=i(775),t.nape.NbRubberJoint=i(776),t.nape.NbSpringJoint=i(777),t.nape.NbWeldJoint=i(778),t.nape.geom.LDMath=i(641),t.nape.shape.LiquidShape=i(782),t.nape.shape.CircleBase=i(521),t.nape.shape.PourShape=i(783),t.nape.shape.PourPosShape=i(640),t.nape.shape.HockShapeBase=i(781),t.nape.shape.HitShape=i(780),t.nape.phys.LiquidDrop=i(779),n.exports={nape:t.nape}},768:function(n,e,i){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};n.exports=function(n){function e(n,e){function i(){}i.prototype=n;var t=new i;for(var l in e)t[l]=e[l];return e.toString!==Object.prototype.toString&&(t.toString=e.toString),t}function i(n,e){if(null==e)return null;null==e.__id__&&(e.__id__=Nl++);var i;return null==n.hx__closures__?n.hx__closures__={}:i=n.hx__closures__[e.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=n,i.method=e,n.hx__closures__[e.__id__]=i),i}var l={},p=function(){return m.__string_rec(this,"")},r=function(){};l.HxOverrides=r,r.__name__=["HxOverrides"],r.dateStr=function(n){var e=n.getMonth()+1,i=n.getDate(),t=n.getHours(),l=n.getMinutes(),p=n.getSeconds();return n.getFullYear()+"-"+(10>e?"0"+e:""+e)+"-"+(10>i?"0"+i:""+i)+" "+(10>t?"0"+t:""+t)+":"+(10>l?"0"+l:""+l)+":"+(10>p?"0"+p:""+p)},r.strDate=function(n){switch(n.length){case 8:var e=n.split(":"),i=new Date;return i.setTime(0),i.setUTCHours(e[0]),i.setUTCMinutes(e[1]),i.setUTCSeconds(e[2]),i;case 10:var t=n.split("-");return new Date(t[0],t[1]-1,t[2],0,0,0);case 19:var l=n.split(" "),p=l[0].split("-"),r=l[1].split(":");return new Date(p[0],p[1]-1,p[2],r[0],r[1],r[2])}},r.cca=function(n,e){var i=n.charCodeAt(e);return i!=i?undefined:i},r.substr=function(n,e,i){return null!=e&&0!=e&&null!=i&&0>i?"":(null==i&&(i=n.length),0>e?0>(e=n.length+e)&&(e=0):0>i&&(i=n.length+i-e),n.substr(e,i))},r.indexOf=function(n,e,i){var t=n.length;for(0>i&&0>(i+=t)&&(i=0);t>i;){if(n[i]===e)return i;++i}return-1},r.lastIndexOf=function(n,e,i){var t=n.length;for(t>i?0>i&&(i+=t):i=t-1;i>=0;){if(n[i]===e)return i;--i}return-1},r.remove=function(n,e){var i=n.indexOf(e);return-1!=i&&(n.splice(i,1),!0)},r.iter=function(n){return{cur:0,arr:n,hasNext:function(){return this.arr.length>this.cur},next:function(){return this.arr[this.cur++]}}};var a=function(n,e){this.min=n,this.max=e};l.IntIterator=a,a.__name__=["IntIterator"],a.prototype={min:null,max:null,hasNext:function(){return this.max>this.min},next:function(){return this.min++},__class__:a};var s=function(){this.space=new le(new On(0,400)),this.init()};l.Main=s,s.__name__=["Main"],s.main=function(){new s},s.prototype={space:null,init:function(){var n=this,e=this.space;null==e.zpp_inner.wrap_gravity&&e.zpp_inner.getgravity();var i=e.zpp_inner.wrap_gravity,t=i.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=i.zpp_inner;if(null!=l._validate&&l._validate(),10!=i.zpp_inner.y){i.zpp_inner.y=10;var p=i.zpp_inner;null!=p._invalidate&&p._invalidate(p)}var r=i.zpp_inner;null!=r._validate&&r._validate();var a=this.space;a.zpp_inner.global_ang_drag=0;var s=this.space;s.zpp_inner.global_lin_drag=0,new z(200).run=function(){n.space.step(.016666666666666666,10,10)}},__class__:s},Math.__name__=["Math"];var o=function(){};l.Reflect=o,o.__name__=["Reflect"],o.hasField=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},o.field=function(n,e){try{return n[e]}catch(i){return null}},o.setField=function(n,e,i){n[e]=i},o.getProperty=function(n,e){var i;if(null==n)return null;var t;return n.__properties__?(i=n.__properties__["get_"+e],t=i):t=!1,t?n[i]():n[e]},o.setProperty=function(n,e,i){var t,l;n.__properties__?(t=n.__properties__["set_"+e],l=t):l=!1,l?n[t](i):n[e]=i},o.callMethod=function(n,e,i){return e.apply(n,i)},o.fields=function(n){var e=[];if(null!=n){var i=Object.prototype.hasOwnProperty;for(var t in n)"__id__"!=t&&"hx__closures__"!=t&&i.call(n,t)&&e.push(t)}return e},o.isFunction=function(n){return"function"==typeof n&&!(n.__name__||n.__ename__)},o.compare=function(n,e){return n==e?0:n>e?1:-1},o.compareMethods=function(n,e){return n==e||!(!o.isFunction(n)||!o.isFunction(e))&&(n.scope==e.scope&&n.method==e.method&&null!=n.method)},o.isObject=function(n){if(null==n)return!1;var e=void 0===n?"undefined":t(n);return"string"==e||"object"==e&&null==n.__enum__||"function"==e&&null!=(n.__name__||n.__ename__)},o.isEnumValue=function(n){return null!=n&&null!=n.__enum__},o.deleteField=function(n,e){return!!Object.prototype.hasOwnProperty.call(n,e)&&(delete n[e],!0)},o.copy=function(n){for(var e={},i=0,t=o.fields(n);t.length>i;){var l=t[i];++i,e[l]=o.field(n,l)}return e},o.makeVarArgs=function(n){return function(){var e=Array.prototype.slice.call(arguments);return n(e)}};var _=function(){};l.Std=_,_.__name__=["Std"],_.is=function(n,e){return m.__instanceof(n,e)},_.instance=function(n,e){return n instanceof e?n:null},_.string=function(n){return m.__string_rec(n,"")},_["int"]=function(n){return 0|n},_.parseInt=function(n){var e=parseInt(n,10);return 0!=e||120!=r.cca(n,1)&&88!=r.cca(n,1)||(e=parseInt(n)),isNaN(e)?null:e},_.parseFloat=function(n){return parseFloat(n)},_.random=function(n){return n>0?Math.floor(Math.random()*n):0};var h=function(){};l.StringTools=h,h.__name__=["StringTools"],h.urlEncode=function(n){return encodeURIComponent(n)},h.urlDecode=function(n){return decodeURIComponent(n.split("+").join(" "))},h.htmlEscape=function(n,e){return n=n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;"),e?n.split('"').join("&quot;").split("'").join("&#039;"):n},h.htmlUnescape=function(n){return n.split("&gt;").join(">").split("&lt;").join("<").split("&quot;").join('"').split("&#039;").join("'").split("&amp;").join("&")},h.startsWith=function(n,e){return n.length>=e.length&&r.substr(n,0,e.length)==e},h.endsWith=function(n,e){var i=e.length,t=n.length;return t>=i&&r.substr(n,t-i,i)==e},h.isSpace=function(n,e){var i=r.cca(n,e);return i>8&&14>i||32==i},h.ltrim=function(n){for(var e=n.length,i=0;e>i&&h.isSpace(n,i);)++i;return i>0?r.substr(n,i,e-i):n},h.rtrim=function(n){for(var e=n.length,i=0;e>i&&h.isSpace(n,e-i-1);)++i;return i>0?r.substr(n,0,e-i):n},h.trim=function(n){return h.ltrim(h.rtrim(n))},h.lpad=function(n,e,i){if(0>=e.length)return n;for(;i>n.length;)n=e+n;return n},h.rpad=function(n,e,i){if(0>=e.length)return n;for(;i>n.length;)n+=e;return n},h.replace=function(n,e,i){return n.split(e).join(i)},h.hex=function(n,e){for(var i="",t="0123456789ABCDEF";;)if(i=t.charAt(15&n)+i,(n>>>=4)<=0)break;if(null!=e)for(;e>i.length;)i="0"+i;return i},h.fastCodeAt=function(n,e){return n.charCodeAt(e)},h.isEof=function(n){return n!=n};var u=l.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};u.TNull=["TNull",0],u.TNull.toString=p,u.TNull.__enum__=u,u.TInt=["TInt",1],u.TInt.toString=p,u.TInt.__enum__=u,u.TFloat=["TFloat",2],u.TFloat.toString=p,u.TFloat.__enum__=u,u.TBool=["TBool",3],u.TBool.toString=p,u.TBool.__enum__=u,u.TObject=["TObject",4],u.TObject.toString=p,u.TObject.__enum__=u,u.TFunction=["TFunction",5],u.TFunction.toString=p,u.TFunction.__enum__=u,u.TClass=function(n){var e=["TClass",6,n];return e.__enum__=u,e.toString=p,e},u.TEnum=function(n){var e=["TEnum",7,n];return e.__enum__=u,e.toString=p,e},u.TUnknown=["TUnknown",8],u.TUnknown.toString=p,u.TUnknown.__enum__=u,u.__empty_constructs__=[u.TNull,u.TInt,u.TFloat,u.TBool,u.TObject,u.TFunction,u.TUnknown];var x=function(){};l.Type=x,x.__name__=["Type"],x.getClass=function(n){return null==n?null:m.getClass(n)},x.getEnum=function(n){return null==n?null:n.__enum__},x.getSuperClass=function(n){return n.__super__},x.getClassName=function(n){var e=n.__name__;return null==e?null:e.join(".")},x.getEnumName=function(n){return n.__ename__.join(".")},x.resolveClass=function(n){var e=l[n];return null!=e&&e.__name__?e:null},x.resolveEnum=function(n){var e=l[n];return null!=e&&e.__ename__?e:null},x.createInstance=function(n,e){switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);case 6:return new n(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case 8:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7])}},x.createEmptyInstance=function(n){function e(){}return e.prototype=n.prototype,new e},x.createEnum=function(n,e,i){var t=o.field(n,e);return o.isFunction(t)?t.apply(n,i):t},x.createEnumIndex=function(n,e,i){var t=n.__constructs__[e];return x.createEnum(n,t,i)},x.getInstanceFields=function(n){var e=[];for(var i in n.prototype)e.push(i);return r.remove(e,"__class__"),r.remove(e,"__properties__"),e},x.getClassFields=function(n){var e=o.fields(n);return r.remove(e,"__name__"),r.remove(e,"__interfaces__"),r.remove(e,"__properties__"),r.remove(e,"__super__"),r.remove(e,"__meta__"),r.remove(e,"prototype"),e},x.getEnumConstructs=function(n){return n.__constructs__.slice()},x["typeof"]=function(n){switch(void 0===n?"undefined":t(n)){case"boolean":return u.TBool;case"function":return n.__name__||n.__ename__?u.TObject:u.TFunction;case"number":return Math.ceil(n)==n%2147483648?u.TInt:u.TFloat;case"object":if(null==n)return u.TNull;var e=n.__enum__;if(null!=e)return u.TEnum(e);var i=m.getClass(n);return null!=i?u.TClass(i):u.TObject;case"string":return u.TClass(String);case"undefined":return u.TNull;default:return u.TUnknown}},x.enumEq=function(n,e){if(n==e)return!0;try{if(n[0]!=e[0])return!1;for(var i=2,t=n.length;t>i;){var l=i++;if(!x.enumEq(n[l],e[l]))return!1}var p=n.__enum__;if(p!=e.__enum__||null==p)return!1}catch(r){return!1}return!0},x.enumConstructor=function(n){return n[0]},x.enumParameters=function(n){return n.slice(2)},x.enumIndex=function(n){return n[1]},x.allEnums=function(n){return n.__empty_constructs__};var d=function(){};l["haxe.IMap"]=d,d.__name__=["haxe","IMap"],d.prototype={get:null,set:null,exists:null,remove:null,keys:null,iterator:null,toString:null,__class__:d};var v=function(){};l["haxe.Log"]=v,v.__name__=["haxe","Log"],v.trace=function(n,e){m.__trace(n,e)},v.clear=function(){m.__clear_trace()};var z=function(n){var e=this;this.id=setInterval(function(){e.run()},n)};l["haxe.Timer"]=z,z.__name__=["haxe","Timer"],z.delay=function(n,e){var i=new z(e);return i.run=function(){i.stop(),n()},i},z.measure=function(n,e){var i=z.stamp(),t=n();return v.trace(z.stamp()-i+"s",e),t},z.stamp=function(){return(new Date).getTime()/1e3},z.prototype={id:null,stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:z};var c=function Yl(n){Error.call(this),this.val=n,this.message=n+"",Error.captureStackTrace&&Error.captureStackTrace(this,Yl)};l["js._Boot.HaxeError"]=c,c.__name__=["js","_Boot","HaxeError"],c.__super__=Error,c.prototype=e(Error.prototype,{val:null,__class__:c});var m=function(){};l["js.Boot"]=m,m.__name__=["js","Boot"],m.__unhtml=function(n){return n.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},m.__trace=function(n,e){var i=null!=e?e.fileName+":"+e.lineNumber+": ":"";if(i+=m.__string_rec(n,""),null!=e&&null!=e.customParams)for(var t=0,l=e.customParams;l.length>t;){var p=l[t];++t,i+=","+m.__string_rec(p,"")}var r,a;"undefined"!=typeof document?(r=document.getElementById("haxe:trace"),a=null!=r):a=!1,a?r.innerHTML+=m.__unhtml(i)+"<br/>":"undefined"!=typeof console&&console},m.__clear_trace=function(){var n=document.getElementById("haxe:trace");null!=n&&(n.innerHTML="")},m.isClass=function(n){return n.__name__},m.isEnum=function(n){return n.__ename__},m.getClass=function(n){if(n instanceof Array&&null==n.__enum__)return Array;var e=n.__class__;if(null!=e)return e;var i=m.__nativeClassName(n);return null!=i?m.__resolveNativeClass(i):null},m.__string_rec=function(n,e){if(null==n)return"null";if(e.length>=5)return"<...>";var i=void 0===n?"undefined":t(n);switch("function"==i&&(n.__name__||n.__ename__)&&(i="object"),i){case"function":return"<function>";case"object":if(n instanceof Array){if(n.__enum__){if(2==n.length)return n[0];var l=n[0]+"(";e+="\t";for(var p=2,r=n.length;r>p;){var a=p++;l+=2!=a?","+m.__string_rec(n[a],e):m.__string_rec(n[a],e)}return l+")"}var s=n.length,o="[";e+="\t";for(var _=0,h=s;h>_;){var u=_++;o+=(u>0?",":"")+m.__string_rec(n[u],e)}return o+="]"}var x;try{x=n.toString}catch(y){return"???"}if(null!=x&&x!=Object.toString&&"function"==typeof x){var d=""+n;if("[object Object]"!=d)return d}var v=null,z="{\n";e+="\t";var c=null!=n.hasOwnProperty;for(var v in n)c&&!n.hasOwnProperty(v)||"prototype"!=v&&"__class__"!=v&&"__super__"!=v&&"__interfaces__"!=v&&"__properties__"!=v&&(2!=z.length&&(z+=", \n"),z+=e+v+" : "+m.__string_rec(n[v],e));return e=e.substring(1),z+="\n"+e+"}";case"string":return n;default:return n+""}},m.__interfLoop=function(n,e){if(null==n)return!1;if(n==e)return!0;var i=n.__interfaces__;if(null!=i)for(var t=0,l=i.length;l>t;){var p=t++,r=i[p];if(r==e||m.__interfLoop(r,e))return!0}return m.__interfLoop(n.__super__,e)},m.__instanceof=function(n,e){if(null==e)return!1;switch(e){case Array:return n instanceof Array&&null==n.__enum__;case Dl:return"boolean"==typeof n;case Vl:return!0;case jl:return"number"==typeof n;case Ll:return(0|n)===n;case String:return"string"==typeof n;default:if(null==n)return!1;if("function"==typeof e){if(n instanceof e)return!0;if(m.__interfLoop(m.getClass(n),e))return!0}else if("object"==(void 0===e?"undefined":t(e))&&m.__isNativeObj(e)&&n instanceof e)return!0;return e==Fl&&null!=n.__name__||(e==Rl&&null!=n.__ename__||n.__enum__==e)}},m.__cast=function(n,e){if(m.__instanceof(n,e))return n},m.__nativeClassName=function(n){var e=m.__toStr.call(n).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},m.__isNativeObj=function(n){return null!=m.__nativeClassName(n)},m.__resolveNativeClass=function(n){return Function("return typeof "+n+' != "undefined" ? '+n+" : null")()};var y=function(){};l["nape.Config"]=y,y.__name__=["nape","Config"],y.prototype={__class__:y};var f=function(){this.zpp_inner=null};l["nape.callbacks.Callback"]=f,f.__name__=["nape","callbacks","Callback"],f.prototype={zpp_inner:null,get_event:function(){return ye.events[this.zpp_inner.event]},get_listener:function(){return this.zpp_inner.listener.outer},toString:function(){return""},__class__:f,__properties__:{get_listener:"get_listener",get_event:"get_event"}};var b=function(){f.call(this)};l["nape.callbacks.BodyCallback"]=b,b.__name__=["nape","callbacks","BodyCallback"],b.__super__=f,b.prototype=e(f.prototype,{get_body:function(){return this.zpp_inner.body.outer},toString:function(){var n="Cb:";return n+=["WAKE","SLEEP"][this.zpp_inner.event-me.id_CbEvent_WAKE],n+=":"+this.zpp_inner.body.outer,n+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:b,__properties__:e(f.prototype.__properties__,{get_body:"get_body"})});var g=function(){this.zpp_inner=null};l["nape.callbacks.Listener"]=g,g.__name__=["nape","callbacks","Listener"],g.prototype={zpp_inner:null,get_type:function(){return ye.types[this.zpp_inner.type]},get_event:function(){return ye.events[this.zpp_inner.event]},set_event:function(n){if(ye.events[this.zpp_inner.event]!=n){var e;null==me.CbEvent_BEGIN&&(me.internal=!0,me.CbEvent_BEGIN=new M,me.internal=!1),n==me.CbEvent_BEGIN?e=me.id_CbEvent_BEGIN:(null==me.CbEvent_ONGOING&&(me.internal=!0,me.CbEvent_ONGOING=new M,me.internal=!1),n==me.CbEvent_ONGOING?e=me.id_CbEvent_ONGOING:(null==me.CbEvent_END&&(me.internal=!0,me.CbEvent_END=new M,me.internal=!1),n==me.CbEvent_END?e=me.id_CbEvent_END:(null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1),n==me.CbEvent_SLEEP?e=me.id_CbEvent_SLEEP:(null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1),n==me.CbEvent_WAKE?e=me.id_CbEvent_WAKE:(null==me.CbEvent_PRE&&(me.internal=!0,me.CbEvent_PRE=new M,me.internal=!1),e=n==me.CbEvent_PRE?me.id_CbEvent_PRE:me.id_CbEvent_BREAK))))),this.zpp_inner.swapEvent(e)}return ye.events[this.zpp_inner.event]},get_precedence:function(){return this.zpp_inner.precedence},set_precedence:function(n){return this.zpp_inner.precedence!=n&&(this.zpp_inner.precedence=n,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=n){var e=n.zpp_inner.wrap_listeners;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){var n=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(this.zpp_inner.type==me.id_ListenerType_BODY){return"BodyListener{"+n+"::"+_.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}"}if(this.zpp_inner.type==me.id_ListenerType_CONSTRAINT){return"ConstraintListener{"+n+"::"+_.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}"}var e,i=this.zpp_inner.interaction,t=i.itype;t==me.id_InteractionType_COLLISION?e="COLLISION":e=t==me.id_InteractionType_SENSOR?"SENSOR":t==me.id_InteractionType_FLUID?"FLUID":"ALL";return(this.zpp_inner.type==me.id_ListenerType_INTERACTION?"InteractionListener{"+n+"#"+e+"::"+_.string(i.outer_zni.zpp_inner_zn.options1.outer)+":"+_.string(i.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+e+"::"+_.string(i.outer_znp.zpp_inner_zn.options1.outer)+":"+_.string(i.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},__class__:g,__properties__:{set_space:"set_space",get_space:"get_space",set_precedence:"set_precedence",get_precedence:"get_precedence",set_event:"set_event",get_event:"get_event",get_type:"get_type"}};var w=function(n,e,i,t){null==t&&(t=0),this.zpp_inner_zn=null,ye.internal=!0,g.call(this),ye.internal=!1;var l=-1;null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1),n==me.CbEvent_WAKE?l=me.id_CbEvent_WAKE:(null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1),n==me.CbEvent_SLEEP&&(l=me.id_CbEvent_SLEEP)),this.zpp_inner_zn=new fe(Me.argument(e),l,i),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=t};l["nape.callbacks.BodyListener"]=w,w.__name__=["nape","callbacks","BodyListener"],w.__super__=g,w.prototype=e(g.prototype,{zpp_inner_zn:null,get_options:function(){return this.zpp_inner_zn.options.outer},set_options:function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},get_handler:function(){return this.zpp_inner_zn.handler},set_handler:function(n){return this.zpp_inner_zn.handler=n},__class__:w,__properties__:e(g.prototype.__properties__,{set_handler:"set_handler",get_handler:"get_handler",set_options:"set_options",get_options:"get_options"})});var M=function(){};l["nape.callbacks.CbEvent"]=M,M.__name__=["nape","callbacks","CbEvent"],M.__properties__={get_PRE:"get_PRE",get_BREAK:"get_BREAK",get_SLEEP:"get_SLEEP",get_WAKE:"get_WAKE",get_END:"get_END",get_ONGOING:"get_ONGOING",get_BEGIN:"get_BEGIN"},M.get_BEGIN=function(){return null==me.CbEvent_BEGIN&&(me.internal=!0,me.CbEvent_BEGIN=new M,me.internal=!1),me.CbEvent_BEGIN},M.get_ONGOING=function(){return null==me.CbEvent_ONGOING&&(me.internal=!0,me.CbEvent_ONGOING=new M,me.internal=!1),me.CbEvent_ONGOING},M.get_END=function(){return null==me.CbEvent_END&&(me.internal=!0,me.CbEvent_END=new M,me.internal=!1),me.CbEvent_END},M.get_WAKE=function(){return null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1),me.CbEvent_WAKE},M.get_SLEEP=function(){return null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1),me.CbEvent_SLEEP},M.get_BREAK=function(){return null==me.CbEvent_BREAK&&(me.internal=!0,me.CbEvent_BREAK=new M,me.internal=!1),me.CbEvent_BREAK},M.get_PRE=function(){return null==me.CbEvent_PRE&&(me.internal=!0,me.CbEvent_PRE=new M,me.internal=!1),me.CbEvent_PRE},M.prototype={toString:function(){return null==me.CbEvent_PRE&&(me.internal=!0,me.CbEvent_PRE=new M,me.internal=!1),this==me.CbEvent_PRE?"PRE":(null==me.CbEvent_BEGIN&&(me.internal=!0,me.CbEvent_BEGIN=new M,me.internal=!1),this==me.CbEvent_BEGIN?"BEGIN":(null==me.CbEvent_ONGOING&&(me.internal=!0,me.CbEvent_ONGOING=new M,me.internal=!1),this==me.CbEvent_ONGOING?"ONGOING":(null==me.CbEvent_END&&(me.internal=!0,me.CbEvent_END=new M,me.internal=!1),this==me.CbEvent_END?"END":(null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1),this==me.CbEvent_WAKE?"WAKE":(null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1),this==me.CbEvent_SLEEP?"SLEEP":(null==me.CbEvent_BREAK&&(me.internal=!0,me.CbEvent_BREAK=new M,me.internal=!1),this==me.CbEvent_BREAK?"BREAK":""))))))},__class__:M};var C=function(){this.zpp_inner=null,this.zpp_inner=new ce,this.zpp_inner.outer=this};l["nape.callbacks.CbType"]=C,C.__name__=["nape","callbacks","CbType"],C.__properties__={get_ANY_COMPOUND:"get_ANY_COMPOUND",get_ANY_SHAPE:"get_ANY_SHAPE",get_ANY_CONSTRAINT:"get_ANY_CONSTRAINT",get_ANY_BODY:"get_ANY_BODY"},C.get_ANY_BODY=function(){return ce.ANY_BODY},C.get_ANY_CONSTRAINT=function(){return ce.ANY_CONSTRAINT},C.get_ANY_SHAPE=function(){return ce.ANY_SHAPE},C.get_ANY_COMPOUND=function(){return ce.ANY_COMPOUND},C.prototype={zpp_inner:null,get_id:function(){return this.zpp_inner.id},including:function(n){return new V(this).including(n)},excluding:function(n){return new V(this).excluding(n)},get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_interactors:function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=_l.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},get_constraints:function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},toString:function(){return this==ce.ANY_BODY?"ANY_BODY":this==ce.ANY_SHAPE?"ANY_SHAPE":this==ce.ANY_COMPOUND?"ANY_COMPOUND":this==ce.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:C,__properties__:{get_constraints:"get_constraints",get_interactors:"get_interactors",get_userData:"get_userData",get_id:"get_id"}};var k=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.callbacks.CbTypeIterator"]=k,k.__name__=["nape","callbacks","CbTypeIterator"],k.get=function(n){var e;if(null==k.zpp_pool){xl.internal=!0;var i=new k;xl.internal=!1,e=i}else{var t=k.zpp_pool;k.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},k.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=k.zpp_pool,k.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:k};var O=function(){this.zpp_inner=null,this.zpp_inner=new xl,this.zpp_inner.outer=this};l["nape.callbacks.CbTypeList"]=O,O.__name__=["nape","callbacks","CbTypeList"],O.fromArray=function(n){for(var e=new O,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},O.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),k.get(this)},copy:function(n){null==n&&(n=!1);var e=new O;this.zpp_inner.valmod();for(var i=k.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=k.zpp_pool,k.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=k.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=k.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=k.zpp_pool,k.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=k.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=k.zpp_pool,k.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:O,__properties__:{get_length:"get_length"}};var I=function(){f.call(this)};l["nape.callbacks.ConstraintCallback"]=I,I.__name__=["nape","callbacks","ConstraintCallback"],I.__super__=f,I.prototype=e(f.prototype,{get_constraint:function(){return this.zpp_inner.constraint.outer},toString:function(){var n="Cb:";return n+=["WAKE","SLEEP","BREAK"][this.zpp_inner.event-me.id_CbEvent_WAKE],n+=":"+this.zpp_inner.constraint.outer,n+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:I,__properties__:e(f.prototype.__properties__,{get_constraint:"get_constraint"})});var S=function(n,e,i,t){null==t&&(t=0),this.zpp_inner_zn=null,ye.internal=!0,g.call(this),ye.internal=!1;var l=-1;null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1),n==me.CbEvent_WAKE?l=me.id_CbEvent_WAKE:(null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1),n==me.CbEvent_SLEEP?l=me.id_CbEvent_SLEEP:(null==me.CbEvent_BREAK&&(me.internal=!0,me.CbEvent_BREAK=new M,me.internal=!1),n==me.CbEvent_BREAK&&(l=me.id_CbEvent_BREAK))),this.zpp_inner_zn=new be(Me.argument(e),l,i),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=t};l["nape.callbacks.ConstraintListener"]=S,S.__name__=["nape","callbacks","ConstraintListener"],S.__super__=g,S.prototype=e(g.prototype,{zpp_inner_zn:null,get_options:function(){return this.zpp_inner_zn.options.outer},set_options:function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},get_handler:function(){return this.zpp_inner_zn.handler},set_handler:function(n){return this.zpp_inner_zn.handler=n},__class__:S,__properties__:e(g.prototype.__properties__,{set_handler:"set_handler",get_handler:"get_handler",set_options:"set_options",get_options:"get_options"})});var P=function(){f.call(this)};l["nape.callbacks.InteractionCallback"]=P,P.__name__=["nape","callbacks","InteractionCallback"],P.__super__=f,P.prototype=e(f.prototype,{get_int1:function(){return this.zpp_inner.int1.outer_i},get_int2:function(){return this.zpp_inner.int2.outer_i},get_arbiters:function(){return this.zpp_inner.wrap_arbiters},toString:function(){var n="Cb:";return n+=["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event],n+=":"+this.zpp_inner.int1.outer_i+"/"+this.zpp_inner.int2.outer_i,n+=" : "+this.zpp_inner.wrap_arbiters,n+=" : listener: "+_.string(this.zpp_inner.listener.outer)},__class__:P,__properties__:e(f.prototype.__properties__,{get_arbiters:"get_arbiters",get_int2:"get_int2",get_int1:"get_int1"})});var T=function(n,e,i,t,l,p){null==p&&(p=0),this.zpp_inner_zn=null,ye.internal=!0,g.call(this),ye.internal=!1;var r=-1;null==me.CbEvent_BEGIN&&(me.internal=!0,me.CbEvent_BEGIN=new M,me.internal=!1),n==me.CbEvent_BEGIN?r=me.id_CbEvent_BEGIN:(null==me.CbEvent_END&&(me.internal=!0,me.CbEvent_END=new M,me.internal=!1),n==me.CbEvent_END?r=me.id_CbEvent_END:(null==me.CbEvent_ONGOING&&(me.internal=!0,me.CbEvent_ONGOING=new M,me.internal=!1),n==me.CbEvent_ONGOING&&(r=me.id_CbEvent_ONGOING))),this.zpp_inner_zn=new we(Me.argument(i),Me.argument(t),r,me.id_ListenerType_INTERACTION),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zni=this,this.zpp_inner.precedence=p,this.zpp_inner_zn.handleri=l;var a,s=this.zpp_inner_zn.itype;if(s==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),a=me.InteractionType_COLLISION):s==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),a=me.InteractionType_SENSOR):s==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),a=me.InteractionType_FLUID):s==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),a=me.InteractionType_ANY):a=null,a!=e){var o;null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),e==me.InteractionType_COLLISION?o=me.id_InteractionType_COLLISION:(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),e==me.InteractionType_SENSOR?o=me.id_InteractionType_SENSOR:(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),o=e==me.InteractionType_FLUID?me.id_InteractionType_FLUID:me.id_InteractionType_ANY)),this.zpp_inner_zn.itype=o}var _=this.zpp_inner_zn.itype;_==me.id_InteractionType_COLLISION?null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1):_==me.id_InteractionType_SENSOR?null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1):_==me.id_InteractionType_FLUID?null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1):_==me.id_InteractionType_ANY&&null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1)};l["nape.callbacks.InteractionListener"]=T,T.__name__=["nape","callbacks","InteractionListener"],T.__super__=g,T.prototype=e(g.prototype,{zpp_inner_zn:null,get_options1:function(){return this.zpp_inner_zn.options1.outer},set_options1:function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},get_options2:function(){return this.zpp_inner_zn.options2.outer},set_options2:function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},get_interactionType:function(){var n=this.zpp_inner_zn.itype;return n==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION):n==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR):n==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID):n==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),me.InteractionType_ANY):null},set_interactionType:function(n){var e,i=this.zpp_inner_zn.itype;if(i==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),e=me.InteractionType_COLLISION):i==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),e=me.InteractionType_SENSOR):i==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),e=me.InteractionType_FLUID):i==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),e=me.InteractionType_ANY):e=null,e!=n){var t;null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),n==me.InteractionType_COLLISION?t=me.id_InteractionType_COLLISION:(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),n==me.InteractionType_SENSOR?t=me.id_InteractionType_SENSOR:(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),t=n==me.InteractionType_FLUID?me.id_InteractionType_FLUID:me.id_InteractionType_ANY)),this.zpp_inner_zn.itype=t}var l=this.zpp_inner_zn.itype;return l==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION):l==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR):l==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID):l==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),me.InteractionType_ANY):null},get_handler:function(){return this.zpp_inner_zn.handleri},set_handler:function(n){return this.zpp_inner_zn.handleri=n},get_allowSleepingCallbacks:function(){return this.zpp_inner_zn.allowSleepingCallbacks},set_allowSleepingCallbacks:function(n){return this.zpp_inner_zn.allowSleepingCallbacks=n},__class__:T,__properties__:e(g.prototype.__properties__,{set_allowSleepingCallbacks:"set_allowSleepingCallbacks",get_allowSleepingCallbacks:"get_allowSleepingCallbacks",set_handler:"set_handler",get_handler:"get_handler",set_interactionType:"set_interactionType",get_interactionType:"get_interactionType",set_options2:"set_options2",get_options2:"get_options2",set_options1:"set_options1",get_options1:"get_options1"})});var A=function(){};l["nape.callbacks.InteractionType"]=A,A.__name__=["nape","callbacks","InteractionType"],A.__properties__={get_ANY:"get_ANY",get_FLUID:"get_FLUID",get_SENSOR:"get_SENSOR",get_COLLISION:"get_COLLISION"},A.get_COLLISION=function(){return null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION},A.get_SENSOR=function(){return null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR},A.get_FLUID=function(){return null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID},A.get_ANY=function(){return null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),me.InteractionType_ANY},A.prototype={toString:function(){return null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),this==me.InteractionType_COLLISION?"COLLISION":(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),this==me.InteractionType_SENSOR?"SENSOR":(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),this==me.InteractionType_FLUID?"FLUID":(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),this==me.InteractionType_ANY?"ANY":"")))},__class__:A};var E=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.callbacks.ListenerIterator"]=E,E.__name__=["nape","callbacks","ListenerIterator"],E.get=function(n){var e;if(null==E.zpp_pool){ul.internal=!0;var i=new E;ul.internal=!1,e=i}else{var t=E.zpp_pool;E.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},E.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=E.zpp_pool,E.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:E};var N=function(){this.zpp_inner=null,this.zpp_inner=new ul,this.zpp_inner.outer=this};l["nape.callbacks.ListenerList"]=N,N.__name__=["nape","callbacks","ListenerList"],N.fromArray=function(n){for(var e=new N,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},N.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),E.get(this)},copy:function(n){null==n&&(n=!1);var e=new N;this.zpp_inner.valmod();for(var i=E.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=E.zpp_pool,E.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=E.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=E.zpp_pool,E.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=E.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=E.zpp_pool,E.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=E.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=E.zpp_pool,E.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=E.zpp_pool,E.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:N,__properties__:{get_length:"get_length"}};var L=function(){};l["nape.callbacks.ListenerType"]=L,L.__name__=["nape","callbacks","ListenerType"],L.__properties__={get_PRE:"get_PRE",get_INTERACTION:"get_INTERACTION",get_CONSTRAINT:"get_CONSTRAINT",get_BODY:"get_BODY"},L.get_BODY=function(){return null==me.ListenerType_BODY&&(me.internal=!0,me.ListenerType_BODY=new L,me.internal=!1),me.ListenerType_BODY},L.get_CONSTRAINT=function(){return null==me.ListenerType_CONSTRAINT&&(me.internal=!0,me.ListenerType_CONSTRAINT=new L,me.internal=!1),me.ListenerType_CONSTRAINT},L.get_INTERACTION=function(){return null==me.ListenerType_INTERACTION&&(me.internal=!0,me.ListenerType_INTERACTION=new L,me.internal=!1),me.ListenerType_INTERACTION},L.get_PRE=function(){return null==me.ListenerType_PRE&&(me.internal=!0,me.ListenerType_PRE=new L,me.internal=!1),me.ListenerType_PRE},L.prototype={toString:function(){return null==me.ListenerType_BODY&&(me.internal=!0,me.ListenerType_BODY=new L,me.internal=!1),this==me.ListenerType_BODY?"BODY":(null==me.ListenerType_CONSTRAINT&&(me.internal=!0,me.ListenerType_CONSTRAINT=new L,me.internal=!1),this==me.ListenerType_CONSTRAINT?"CONSTRAINT":(null==me.ListenerType_INTERACTION&&(me.internal=!0,me.ListenerType_INTERACTION=new L,me.internal=!1),this==me.ListenerType_INTERACTION?"INTERACTION":(null==me.ListenerType_PRE&&(me.internal=!0,me.ListenerType_PRE=new L,me.internal=!1),this==me.ListenerType_PRE?"PRE":"")))},__class__:L};var V=function(n,e){this.zpp_inner=null,this.zpp_inner=new Me,this.zpp_inner.outer=this,null!=n&&this.including(n),null!=e&&this.excluding(e)};l["nape.callbacks.OptionType"]=V,V.__name__=["nape","callbacks","OptionType"],V.prototype={zpp_inner:null,get_includes:function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},get_excludes:function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},including:function(n){return this.zpp_inner.append(this.zpp_inner.includes,n),this},excluding:function(n){return this.zpp_inner.append(this.zpp_inner.excludes,n),this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var n=""+this.zpp_inner.wrap_includes;return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+n+" excluding "+this.zpp_inner.wrap_excludes+"}"},__class__:V,__properties__:{get_excludes:"get_excludes",get_includes:"get_includes"}};var j=function(){f.call(this)};l["nape.callbacks.PreCallback"]=j,j.__name__=["nape","callbacks","PreCallback"],j.__super__=f,j.prototype=e(f.prototype,{get_arbiter:function(){return this.zpp_inner.pre_arbiter.wrapper()},get_int1:function(){return this.zpp_inner.int1.outer_i},get_int2:function(){return this.zpp_inner.int2.outer_i},get_swapped:function(){return this.zpp_inner.pre_swapped},toString:function(){var n="Cb:PRE:";return n+=":"+this.zpp_inner.int1.outer_i+"/"+this.zpp_inner.int2.outer_i,n+=" : "+this.zpp_inner.pre_arbiter.wrapper(),n+=" : listnener: "+_.string(this.zpp_inner.listener.outer)},__class__:j,__properties__:e(f.prototype.__properties__,{get_swapped:"get_swapped",get_int2:"get_int2",get_int1:"get_int1",get_arbiter:"get_arbiter"})});var D=function(){};l["nape.callbacks.PreFlag"]=D,D.__name__=["nape","callbacks","PreFlag"],D.__properties__={get_IGNORE_ONCE:"get_IGNORE_ONCE",get_ACCEPT_ONCE:"get_ACCEPT_ONCE",get_IGNORE:"get_IGNORE",get_ACCEPT:"get_ACCEPT"},D.get_ACCEPT=function(){return null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),me.PreFlag_ACCEPT},D.get_IGNORE=function(){return null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),me.PreFlag_IGNORE},D.get_ACCEPT_ONCE=function(){return null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),me.PreFlag_ACCEPT_ONCE},D.get_IGNORE_ONCE=function(){return null==me.PreFlag_IGNORE_ONCE&&(me.internal=!0,me.PreFlag_IGNORE_ONCE=new D,me.internal=!1),me.PreFlag_IGNORE_ONCE},D.prototype={toString:function(){return null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),this==me.PreFlag_ACCEPT?"ACCEPT":(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),this==me.PreFlag_IGNORE?"IGNORE":(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),this==me.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==me.PreFlag_IGNORE_ONCE&&(me.internal=!0,me.PreFlag_IGNORE_ONCE=new D,me.internal=!1),this==me.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},__class__:D};var F=function(n,e,i,t,l,p){null==p&&(p=!1),null==l&&(l=0),this.zpp_inner_zn=null,ye.internal=!0,g.call(this),ye.internal=!1,this.zpp_inner_zn=new we(Me.argument(e),Me.argument(i),me.id_CbEvent_PRE,me.id_ListenerType_PRE),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_znp=this,this.zpp_inner.precedence=l,this.zpp_inner_zn.pure=p,this.zpp_inner_zn.handlerp=t;var r,a=this.zpp_inner_zn.itype;if(a==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),r=me.InteractionType_COLLISION):a==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),r=me.InteractionType_SENSOR):a==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),r=me.InteractionType_FLUID):a==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),r=me.InteractionType_ANY):r=null,r!=n){var s;null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),n==me.InteractionType_COLLISION?s=me.id_InteractionType_COLLISION:(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),n==me.InteractionType_SENSOR?s=me.id_InteractionType_SENSOR:(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),s=n==me.InteractionType_FLUID?me.id_InteractionType_FLUID:me.id_InteractionType_ANY)),this.zpp_inner_zn.itype=s}var o=this.zpp_inner_zn.itype;o==me.id_InteractionType_COLLISION?null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1):o==me.id_InteractionType_SENSOR?null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1):o==me.id_InteractionType_FLUID?null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1):o==me.id_InteractionType_ANY&&null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1)};l["nape.callbacks.PreListener"]=F,F.__name__=["nape","callbacks","PreListener"],F.__super__=g,F.prototype=e(g.prototype,{zpp_inner_zn:null,get_options1:function(){return this.zpp_inner_zn.options1.outer},set_options1:function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},get_options2:function(){return this.zpp_inner_zn.options2.outer},set_options2:function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},get_handler:function(){return this.zpp_inner_zn.handlerp},set_handler:function(n){return this.zpp_inner_zn.handlerp=n,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},get_pure:function(){return this.zpp_inner_zn.pure},set_pure:function(n){return n||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=n},get_interactionType:function(){var n=this.zpp_inner_zn.itype;return n==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION):n==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR):n==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID):n==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),me.InteractionType_ANY):null},set_interactionType:function(n){var e,i=this.zpp_inner_zn.itype;if(i==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),e=me.InteractionType_COLLISION):i==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),e=me.InteractionType_SENSOR):i==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),e=me.InteractionType_FLUID):i==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),e=me.InteractionType_ANY):e=null,e!=n){var t;null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),n==me.InteractionType_COLLISION?t=me.id_InteractionType_COLLISION:(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),n==me.InteractionType_SENSOR?t=me.id_InteractionType_SENSOR:(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),t=n==me.InteractionType_FLUID?me.id_InteractionType_FLUID:me.id_InteractionType_ANY)),this.zpp_inner_zn.itype=t}var l=this.zpp_inner_zn.itype;return l==me.id_InteractionType_COLLISION?(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION):l==me.id_InteractionType_SENSOR?(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR):l==me.id_InteractionType_FLUID?(null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID):l==me.id_InteractionType_ANY?(null==me.InteractionType_ANY&&(me.internal=!0,me.InteractionType_ANY=new A,me.internal=!1),me.InteractionType_ANY):null},__class__:F,__properties__:e(g.prototype.__properties__,{set_interactionType:"set_interactionType",get_interactionType:"get_interactionType",set_pure:"set_pure",get_pure:"get_pure",set_handler:"set_handler",get_handler:"get_handler",set_options2:"set_options2",get_options2:"get_options2",set_options1:"set_options1",get_options1:"get_options1"})});var R=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(ce.ANY_CONSTRAINT.zpp_inner)};l["nape.constraint.Constraint"]=R,R.__name__=["nape","constraint","Constraint"],R.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},debugDraw:null,get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=n)){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=n){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_isSleeping:function(){return this.zpp_inner.component.sleeping},get_active:function(){return this.zpp_inner.active},set_active:function(n){return this.zpp_inner.active!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),n?(this.zpp_inner.active=n,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=n,this.zpp_inner.deactivate())),this.zpp_inner.active},get_ignore:function(){return this.zpp_inner.ignore},set_ignore:function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.ignore=n,this.zpp_inner.wake()),this.zpp_inner.ignore},get_stiff:function(){return this.zpp_inner.stiff},set_stiff:function(n){return this.zpp_inner.stiff!=n&&(this.zpp_inner.stiff=n,this.zpp_inner.wake()),this.zpp_inner.stiff},get_frequency:function(){return this.zpp_inner.frequency},set_frequency:function(n){return this.zpp_inner.frequency!=n&&(this.zpp_inner.frequency=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},get_damping:function(){return this.zpp_inner.damping},set_damping:function(n){return this.zpp_inner.damping!=n&&(this.zpp_inner.damping=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},get_maxForce:function(){return this.zpp_inner.maxForce},set_maxForce:function(n){return this.zpp_inner.maxForce!=n&&(this.zpp_inner.maxForce=n,this.zpp_inner.wake()),this.zpp_inner.maxForce},get_maxError:function(){return this.zpp_inner.maxError},set_maxError:function(n){return this.zpp_inner.maxError!=n&&(this.zpp_inner.maxError=n,this.zpp_inner.wake()),this.zpp_inner.maxError},get_breakUnderForce:function(){return this.zpp_inner.breakUnderForce},set_breakUnderForce:function(n){return this.zpp_inner.breakUnderForce!=n&&(this.zpp_inner.breakUnderForce=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},get_breakUnderError:function(){return this.zpp_inner.breakUnderError},set_breakUnderError:function(n){return this.zpp_inner.breakUnderError!=n&&(this.zpp_inner.breakUnderError=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},get_removeOnBreak:function(){return this.zpp_inner.removeOnBreak},set_removeOnBreak:function(n){return this.zpp_inner.removeOnBreak=n},impulse:function(){return null},bodyImpulse:function(n){return null},visitBodies:function(n){},get_cbTypes:function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},toString:function(){return"{Constraint}"},copy:function(){return this.zpp_inner.copy()},__class__:R,__properties__:{get_cbTypes:"get_cbTypes",set_removeOnBreak:"set_removeOnBreak",get_removeOnBreak:"get_removeOnBreak",set_breakUnderError:"set_breakUnderError",get_breakUnderError:"get_breakUnderError",set_breakUnderForce:"set_breakUnderForce",get_breakUnderForce:"get_breakUnderForce",set_maxError:"set_maxError",get_maxError:"get_maxError",set_maxForce:"set_maxForce",get_maxForce:"get_maxForce",set_damping:"set_damping",get_damping:"get_damping",set_frequency:"set_frequency",get_frequency:"get_frequency",set_stiff:"set_stiff",get_stiff:"get_stiff",set_ignore:"set_ignore",get_ignore:"get_ignore",set_active:"set_active",get_active:"get_active",get_isSleeping:"get_isSleeping",set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_userData:"get_userData"}};var B=function(n,e,i,t,l){null==l&&(l=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new ke,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=i&&(this.zpp_inner_zn.jointMin=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=t&&(this.zpp_inner_zn.jointMax=t,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=l&&(this.zpp_inner_zn.ratio=l,this.zpp_inner.wake())};l["nape.constraint.AngleJoint"]=B,B.__name__=["nape","constraint","AngleJoint"],B.__super__=R,B.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},isSlack:function(){var n,e=this.zpp_inner_zn,i=e.ratio*e.b2.rot-e.b1.rot;return e.equal?(i-=e.jointMax,n=!1,e.scale=1):e.jointMin>i?(i=e.jointMin-i,e.scale=-1,n=!1):i>e.jointMax?(i-=e.jointMax,e.scale=1,n=!1):(e.scale=0,i=0,n=!0),n},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get(0,0,0)},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:B,__properties__:e(R.prototype.__properties__,{set_ratio:"set_ratio",get_ratio:"get_ratio",set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var G=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.constraint.ConstraintIterator"]=G,G.__name__=["nape","constraint","ConstraintIterator"],G.get=function(n){var e;if(null==G.zpp_pool){sl.internal=!0;var i=new G;sl.internal=!1,e=i}else{var t=G.zpp_pool;G.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},G.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=G.zpp_pool,G.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:G};var Z=function(){this.zpp_inner=null,this.zpp_inner=new sl,this.zpp_inner.outer=this};l["nape.constraint.ConstraintList"]=Z,Z.__name__=["nape","constraint","ConstraintList"],Z.fromArray=function(n){for(var e=new Z,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Z.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),G.get(this)},copy:function(n){null==n&&(n=!1);var e=new Z;this.zpp_inner.valmod();for(var i=G.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=G.zpp_pool,G.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=G.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=G.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=G.zpp_pool,G.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=G.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=G.zpp_pool,G.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Z,__properties__:{get_length:"get_length"}};var U=function(n,e,i,t,l,p){this.zpp_inner_zn=null,this.zpp_inner_zn=new Ie,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==e?null:e.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var s=this.zpp_inner_zn.wrap_a1,o=s.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=i.zpp_inner;null!=_._validate&&_._validate();var h=i.zpp_inner.x,u=i.zpp_inner;null!=u._validate&&u._validate();var x=i.zpp_inner.y,d=s.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v,z=s.zpp_inner;if(null!=z._validate&&z._validate(),s.zpp_inner.x==h){var c=s.zpp_inner;null!=c._validate&&c._validate(),v=s.zpp_inner.y==x}else v=!1;if(!v){s.zpp_inner.x=h,s.zpp_inner.y=x;var m=s.zpp_inner;null!=m._invalidate&&m._invalidate(m)}if(i.zpp_inner.weak){var y=i.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var b=i;b.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=b:Ml.poolVec2=b,Ml.nextVec2=b,b.zpp_disp=!0;var g=f;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Mi.zpp_pool,Mi.zpp_pool=g}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var w=this.zpp_inner_zn.wrap_a2,M=w.zpp_inner;null!=M._isimmutable&&M._isimmutable();var C=t.zpp_inner;null!=C._validate&&C._validate();var k=t.zpp_inner.x,O=t.zpp_inner;null!=O._validate&&O._validate();var I=t.zpp_inner.y,S=w.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P,T=w.zpp_inner;if(null!=T._validate&&T._validate(),w.zpp_inner.x==k){var A=w.zpp_inner;null!=A._validate&&A._validate(),P=w.zpp_inner.y==I}else P=!1;if(!P){w.zpp_inner.x=k,w.zpp_inner.y=I;var E=w.zpp_inner;null!=E._invalidate&&E._invalidate(E)}if(t.zpp_inner.weak){var N=t.zpp_inner;null!=N._isimmutable&&N._isimmutable();var L=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var V=t;V.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=V:Ml.poolVec2=V,Ml.nextVec2=V,V.zpp_disp=!0;var j=L;null!=j.outer&&(j.outer.zpp_inner=null,j.outer=null),j._isimmutable=null,j._validate=null,j._invalidate=null,j.next=Mi.zpp_pool,Mi.zpp_pool=j}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=p&&(this.zpp_inner_zn.jointMax=p,this.zpp_inner.wake())};l["nape.constraint.DistanceJoint"]=U,U.__name__=["nape","constraint","DistanceJoint"],U.__super__=R,U.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},isSlack:function(){return this.zpp_inner_zn.slack},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:U,__properties__:e(R.prototype.__properties__,{set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var q=function(n,e,i,t,l,p,r){this.zpp_inner_zn=null,this.zpp_inner_zn=new Se,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var a=null==n?null:n.zpp_inner;a!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b2!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var s=null==e?null:e.zpp_inner;s!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=s,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=s&&this.zpp_inner_zn.b1!=s&&null!=s&&s.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=s&&s.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var o=this.zpp_inner_zn.wrap_a1,_=o.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h=i.zpp_inner;null!=h._validate&&h._validate();var u=i.zpp_inner.x,x=i.zpp_inner;null!=x._validate&&x._validate();var d=i.zpp_inner.y,v=o.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=o.zpp_inner;if(null!=c._validate&&c._validate(),o.zpp_inner.x==u){var m=o.zpp_inner;null!=m._validate&&m._validate(),z=o.zpp_inner.y==d}else z=!1;if(!z){o.zpp_inner.x=u,o.zpp_inner.y=d;var y=o.zpp_inner;null!=y._invalidate&&y._invalidate(y)}if(i.zpp_inner.weak){var f=i.zpp_inner;null!=f._isimmutable&&f._isimmutable();var b=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var g=i;g.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=g:Ml.poolVec2=g,Ml.nextVec2=g,g.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=Mi.zpp_pool,Mi.zpp_pool=w}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var M=this.zpp_inner_zn.wrap_a2,C=M.zpp_inner;null!=C._isimmutable&&C._isimmutable();var k=t.zpp_inner;null!=k._validate&&k._validate();var O=t.zpp_inner.x,I=t.zpp_inner;null!=I._validate&&I._validate();var S=t.zpp_inner.y,P=M.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T,A=M.zpp_inner;if(null!=A._validate&&A._validate(),M.zpp_inner.x==O){var E=M.zpp_inner;null!=E._validate&&E._validate(),T=M.zpp_inner.y==S}else T=!1;if(!T){M.zpp_inner.x=O,M.zpp_inner.y=S;var N=M.zpp_inner;null!=N._invalidate&&N._invalidate(N)}if(t.zpp_inner.weak){var L=t.zpp_inner;null!=L._isimmutable&&L._isimmutable();var V=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var j=t;j.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=j:Ml.poolVec2=j,Ml.nextVec2=j,j.zpp_disp=!0;var D=V;null!=D.outer&&(D.outer.zpp_inner=null,D.outer=null),D._isimmutable=null,D._validate=null,D._invalidate=null,D.next=Mi.zpp_pool,Mi.zpp_pool=D}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var F=this.zpp_inner_zn.wrap_n,B=F.zpp_inner;null!=B._isimmutable&&B._isimmutable();var G=l.zpp_inner;null!=G._validate&&G._validate();var Z=l.zpp_inner.x,U=l.zpp_inner;null!=U._validate&&U._validate();var q=l.zpp_inner.y,Y=F.zpp_inner;null!=Y._isimmutable&&Y._isimmutable();var K,W=F.zpp_inner;if(null!=W._validate&&W._validate(),F.zpp_inner.x==Z){var J=F.zpp_inner;null!=J._validate&&J._validate(),K=F.zpp_inner.y==q}else K=!1;if(!K){F.zpp_inner.x=Z,F.zpp_inner.y=q;var X=F.zpp_inner;null!=X._invalidate&&X._invalidate(X)}if(l.zpp_inner.weak){var H=l.zpp_inner;null!=H._isimmutable&&H._isimmutable();var Q=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var $=l;$.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=$:Ml.poolVec2=$,Ml.nextVec2=$,$.zpp_disp=!0;var nn=Q;null!=nn.outer&&(nn.outer.zpp_inner=null,nn.outer=null),nn._isimmutable=null,nn._validate=null,nn._invalidate=null,nn.next=Mi.zpp_pool,Mi.zpp_pool=nn}null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=p&&(this.zpp_inner_zn.jointMin=p,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=r&&(this.zpp_inner_zn.jointMax=r,this.zpp_inner.wake())};l["nape.constraint.LineJoint"]=q,q.__name__=["nape","constraint","LineJoint"],q.__super__=R,q.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_direction:function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},set_direction:function(n){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var e=this.zpp_inner_zn.wrap_n,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},impulse:function(){var n=new gn(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:q,__properties__:e(R.prototype.__properties__,{set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_direction:"set_direction",get_direction:"get_direction",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var Y=function(n,e,i,t){null==t&&(t=1),null==i&&(i=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Pe,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var p=null==e?null:e.zpp_inner;p!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b1!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=i&&(this.zpp_inner_zn.rate=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=t&&(this.zpp_inner_zn.ratio=t,this.zpp_inner.wake())};l["nape.constraint.MotorJoint"]=Y,Y.__name__=["nape","constraint","MotorJoint"],Y.__super__=R,Y.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},get_rate:function(){return this.zpp_inner_zn.rate},set_rate:function(n){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=n&&(this.zpp_inner_zn.rate=n,this.zpp_inner.wake()),this.zpp_inner_zn.rate},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:Y,__properties__:e(R.prototype.__properties__,{set_rate:"set_rate",get_rate:"get_rate",set_ratio:"set_ratio",get_ratio:"get_ratio",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var K=function(n,e,i,t){this.zpp_inner_zn=null,this.zpp_inner_zn=new Te,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var p=null==e?null:e.zpp_inner;p!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b1!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var r=this.zpp_inner_zn.wrap_a1,a=r.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s=i.zpp_inner;null!=s._validate&&s._validate();var o=i.zpp_inner.x,_=i.zpp_inner;null!=_._validate&&_._validate();var h=i.zpp_inner.y,u=r.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x,d=r.zpp_inner;if(null!=d._validate&&d._validate(),r.zpp_inner.x==o){var v=r.zpp_inner;null!=v._validate&&v._validate(),x=r.zpp_inner.y==h}else x=!1;if(!x){r.zpp_inner.x=o,r.zpp_inner.y=h;var z=r.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(i.zpp_inner.weak){var c=i.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var y=i;y.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=y:Ml.poolVec2=y,Ml.nextVec2=y,y.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Mi.zpp_pool,Mi.zpp_pool=f}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var b=this.zpp_inner_zn.wrap_a2,g=b.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=t.zpp_inner;null!=w._validate&&w._validate();var M=t.zpp_inner.x,C=t.zpp_inner;null!=C._validate&&C._validate();var k=t.zpp_inner.y,O=b.zpp_inner;null!=O._isimmutable&&O._isimmutable();var I,S=b.zpp_inner;if(null!=S._validate&&S._validate(),b.zpp_inner.x==M){var P=b.zpp_inner;null!=P._validate&&P._validate(),I=b.zpp_inner.y==k}else I=!1;if(!I){b.zpp_inner.x=M,b.zpp_inner.y=k;var T=b.zpp_inner;null!=T._invalidate&&T._invalidate(T)}if(t.zpp_inner.weak){var A=t.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var N=t;N.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=N:Ml.poolVec2=N,Ml.nextVec2=N,N.zpp_disp=!0;var L=E;null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=Mi.zpp_pool,Mi.zpp_pool=L}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};l["nape.constraint.PivotJoint"]=K,K.__name__=["nape","constraint","PivotJoint"],K.__super__=R,K.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},impulse:function(){var n=new gn(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:K,__properties__:e(R.prototype.__properties__,{set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var W=function(n,e,i,t,l,p,r,a,s,o,_){null==_&&(_=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ae,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var h=null==n?null:n.zpp_inner;h!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=h,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=h&&this.zpp_inner_zn.b2!=h&&this.zpp_inner_zn.b3!=h&&this.zpp_inner_zn.b4!=h&&null!=h&&h.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=h&&h.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var u=null==e?null:e.zpp_inner;u!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b1!=u&&this.zpp_inner_zn.b3!=u&&this.zpp_inner_zn.b4!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake()));this.zpp_inner.immutable_midstep("Constraint::body3");var x=null==i?null:i.zpp_inner;x!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=x,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=x&&this.zpp_inner_zn.b1!=x&&this.zpp_inner_zn.b2!=x&&this.zpp_inner_zn.b4!=x&&null!=x&&x.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=x&&x.wake()));this.zpp_inner.immutable_midstep("Constraint::body4");var d=null==t?null:t.zpp_inner;d!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=d,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=d&&this.zpp_inner_zn.b1!=d&&this.zpp_inner_zn.b2!=d&&this.zpp_inner_zn.b3!=d&&null!=d&&d.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=d&&d.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var v=this.zpp_inner_zn.wrap_a1,z=v.zpp_inner;null!=z._isimmutable&&z._isimmutable();var c=l.zpp_inner;null!=c._validate&&c._validate();var m=l.zpp_inner.x,y=l.zpp_inner;null!=y._validate&&y._validate();var f=l.zpp_inner.y,b=v.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g,w=v.zpp_inner;if(null!=w._validate&&w._validate(),v.zpp_inner.x==m){var M=v.zpp_inner;null!=M._validate&&M._validate(),g=v.zpp_inner.y==f}else g=!1;if(!g){v.zpp_inner.x=m,v.zpp_inner.y=f;var C=v.zpp_inner;null!=C._invalidate&&C._invalidate(C)}if(l.zpp_inner.weak){var k=l.zpp_inner;null!=k._isimmutable&&k._isimmutable();var O=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var I=l;I.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=I:Ml.poolVec2=I,Ml.nextVec2=I,I.zpp_disp=!0;var S=O;null!=S.outer&&(S.outer.zpp_inner=null,S.outer=null),S._isimmutable=null,S._validate=null,S._invalidate=null,S.next=Mi.zpp_pool,Mi.zpp_pool=S}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var P=this.zpp_inner_zn.wrap_a2,T=P.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A=p.zpp_inner;null!=A._validate&&A._validate();var E=p.zpp_inner.x,N=p.zpp_inner;null!=N._validate&&N._validate();var L=p.zpp_inner.y,V=P.zpp_inner;null!=V._isimmutable&&V._isimmutable();var j,D=P.zpp_inner;if(null!=D._validate&&D._validate(),P.zpp_inner.x==E){var F=P.zpp_inner;null!=F._validate&&F._validate(),j=P.zpp_inner.y==L}else j=!1;if(!j){P.zpp_inner.x=E,P.zpp_inner.y=L;var B=P.zpp_inner;null!=B._invalidate&&B._invalidate(B)}if(p.zpp_inner.weak){var G=p.zpp_inner;null!=G._isimmutable&&G._isimmutable();var Z=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var U=p;U.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=U:Ml.poolVec2=U,Ml.nextVec2=U,U.zpp_disp=!0;var q=Z;null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=Mi.zpp_pool,Mi.zpp_pool=q}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var Y=this.zpp_inner_zn.wrap_a3,K=Y.zpp_inner;null!=K._isimmutable&&K._isimmutable();var W=r.zpp_inner;null!=W._validate&&W._validate();var J=r.zpp_inner.x,X=r.zpp_inner;null!=X._validate&&X._validate();var H=r.zpp_inner.y,Q=Y.zpp_inner;null!=Q._isimmutable&&Q._isimmutable();var $,nn=Y.zpp_inner;if(null!=nn._validate&&nn._validate(),Y.zpp_inner.x==J){var en=Y.zpp_inner;null!=en._validate&&en._validate(),$=Y.zpp_inner.y==H}else $=!1;if(!$){Y.zpp_inner.x=J,Y.zpp_inner.y=H;var tn=Y.zpp_inner;null!=tn._invalidate&&tn._invalidate(tn)}if(r.zpp_inner.weak){var ln=r.zpp_inner;null!=ln._isimmutable&&ln._isimmutable();var pn=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null;var rn=r;rn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=rn:Ml.poolVec2=rn,Ml.nextVec2=rn,rn.zpp_disp=!0;var an=pn;null!=an.outer&&(an.outer.zpp_inner=null,an.outer=null),an._isimmutable=null,an._validate=null,an._invalidate=null,an.next=Mi.zpp_pool,Mi.zpp_pool=an}null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var sn=this.zpp_inner_zn.wrap_a4,on=sn.zpp_inner;null!=on._isimmutable&&on._isimmutable();var _n=a.zpp_inner;null!=_n._validate&&_n._validate();var hn=a.zpp_inner.x,un=a.zpp_inner;null!=un._validate&&un._validate();var xn=a.zpp_inner.y,dn=sn.zpp_inner;null!=dn._isimmutable&&dn._isimmutable();var vn,zn=sn.zpp_inner;if(null!=zn._validate&&zn._validate(),sn.zpp_inner.x==hn){var cn=sn.zpp_inner;null!=cn._validate&&cn._validate(),vn=sn.zpp_inner.y==xn}else vn=!1;if(!vn){sn.zpp_inner.x=hn,sn.zpp_inner.y=xn;var mn=sn.zpp_inner;null!=mn._invalidate&&mn._invalidate(mn)}if(a.zpp_inner.weak){var yn=a.zpp_inner;null!=yn._isimmutable&&yn._isimmutable();var fn=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var bn=a;bn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=bn:Ml.poolVec2=bn,Ml.nextVec2=bn,bn.zpp_disp=!0;var gn=fn;null!=gn.outer&&(gn.outer.zpp_inner=null,gn.outer=null),gn._isimmutable=null,gn._validate=null,gn._invalidate=null,gn.next=Mi.zpp_pool,Mi.zpp_pool=gn}null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=_&&(this.zpp_inner_zn.ratio=_,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=s&&(this.zpp_inner_zn.jointMin=s,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=o&&(this.zpp_inner_zn.jointMax=o,this.zpp_inner.wake())};l["nape.constraint.PulleyJoint"]=W,W.__name__=["nape","constraint","PulleyJoint"],W.__super__=R,W.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_body3:function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},set_body3:function(n){this.zpp_inner.immutable_midstep("Constraint::body3");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},get_body4:function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},set_body4:function(n){this.zpp_inner.immutable_midstep("Constraint::body4");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_anchor3:function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},set_anchor3:function(n){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var e=this.zpp_inner_zn.wrap_a3,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},get_anchor4:function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},set_anchor4:function(n){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var e=this.zpp_inner_zn.wrap_a4,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},get_jointMin:function(){return this.zpp_inner_zn.jointMin},set_jointMin:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},get_jointMax:function(){return this.zpp_inner_zn.jointMax},set_jointMax:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},get_ratio:function(){return this.zpp_inner_zn.ratio},set_ratio:function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},isSlack:function(){return this.zpp_inner_zn.slack},impulse:function(){var n=new gn(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&n(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&n(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},__class__:W,__properties__:e(R.prototype.__properties__,{set_ratio:"set_ratio",get_ratio:"get_ratio",set_jointMax:"set_jointMax",get_jointMax:"get_jointMax",set_jointMin:"set_jointMin",get_jointMin:"get_jointMin",set_anchor4:"set_anchor4",get_anchor4:"get_anchor4",set_anchor3:"set_anchor3",get_anchor3:"get_anchor3",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body4:"set_body4",get_body4:"get_body4",set_body3:"set_body3",get_body3:"get_body3",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var J=function(n,e){null==e&&(e=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new Ee(n,e),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1};l["nape.constraint.UserConstraint"]=J,J.__name__=["nape","constraint","UserConstraint"],J.__super__=R,J.prototype=e(R.prototype,{zpp_inner_zn:null,__bindVec2:function(){var n=new On;return n.zpp_inner._inuse=!0,n.zpp_inner._invalidate=(El=this.zpp_inner_zn,i(El,El.bindVec2_invalidate)),n},__copy:function(){},__broken:function(){},__validate:function(){},__draw:function(n){},__prepare:function(){},__position:function(n){},__velocity:function(n){},__eff_mass:function(n){},__clamp:function(n){},__impulse:function(n,e,i){},impulse:function(){for(var n=new gn(this.zpp_inner_zn.dim,1),e=0,i=this.zpp_inner_zn.dim;i>e;){var t=e++;n.zpp_inner.x[t*n.zpp_inner.n]=this.zpp_inner_zn.jAcc[t]}return n},bodyImpulse:function(n){for(var e=0,i=this.zpp_inner_zn.bodies;i.length>e;){var t=i[e];if(++e,t.body==n.zpp_inner){!0;break}}return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){for(var e=0,i=this.zpp_inner_zn.bodies.length;i>e;){var t=this.zpp_inner_zn.bodies[e];if(null!=t.body){for(var l=!1,p=e+1,r=i;r>p;){if(this.zpp_inner_zn.bodies[p++].body==t.body){l=!0;break}}l||n(t.body.outer)}++e}},__invalidate:function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},__registerBody:function(n,e){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),n!=e&&(null!=n&&(this.zpp_inner_zn.remBody(n.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&n.zpp_inner.wake()),null!=e&&this.zpp_inner_zn.addBody(e.zpp_inner),this.zpp_inner.wake(),null!=e&&e.zpp_inner.wake()),e},__class__:J});var X=function(n,e,i,t,l){null==l&&(l=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Le,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,R.zpp_internalAlloc=!0,R.call(this),R.zpp_internalAlloc=!1,this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake()));this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake()));null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var a=this.zpp_inner_zn.wrap_a1,s=a.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=i.zpp_inner;null!=o._validate&&o._validate();var _=i.zpp_inner.x,h=i.zpp_inner;null!=h._validate&&h._validate();var u=i.zpp_inner.y,x=a.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d,v=a.zpp_inner;if(null!=v._validate&&v._validate(),a.zpp_inner.x==_){var z=a.zpp_inner;null!=z._validate&&z._validate(),d=a.zpp_inner.y==u}else d=!1;if(!d){a.zpp_inner.x=_,a.zpp_inner.y=u;var c=a.zpp_inner;null!=c._invalidate&&c._invalidate(c)}if(i.zpp_inner.weak){var m=i.zpp_inner;null!=m._isimmutable&&m._isimmutable();var y=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var f=i;f.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=f:Ml.poolVec2=f,Ml.nextVec2=f,f.zpp_disp=!0;var b=y;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Mi.zpp_pool,Mi.zpp_pool=b}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var g=this.zpp_inner_zn.wrap_a2,w=g.zpp_inner;null!=w._isimmutable&&w._isimmutable();var M=t.zpp_inner;null!=M._validate&&M._validate();var C=t.zpp_inner.x,k=t.zpp_inner;null!=k._validate&&k._validate();var O=t.zpp_inner.y,I=g.zpp_inner;null!=I._isimmutable&&I._isimmutable();var S,P=g.zpp_inner;if(null!=P._validate&&P._validate(),g.zpp_inner.x==C){var T=g.zpp_inner;null!=T._validate&&T._validate(),S=g.zpp_inner.y==O}else S=!1;if(!S){g.zpp_inner.x=C,g.zpp_inner.y=O;var A=g.zpp_inner;null!=A._invalidate&&A._invalidate(A)}if(t.zpp_inner.weak){var E=t.zpp_inner;null!=E._isimmutable&&E._isimmutable();var N=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var L=t;L.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=L:Ml.poolVec2=L,Ml.nextVec2=L,L.zpp_disp=!0;var V=N;null!=V.outer&&(V.outer.zpp_inner=null,V.outer=null),V._isimmutable=null,V._validate=null,V._invalidate=null,V.next=Mi.zpp_pool,Mi.zpp_pool=V}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=l&&(this.zpp_inner_zn.phase=l,this.zpp_inner.wake())};l["nape.constraint.WeldJoint"]=X,X.__name__=["nape","constraint","WeldJoint"],X.__super__=R,X.prototype=e(R.prototype,{zpp_inner_zn:null,get_body1:function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},set_body1:function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},get_body2:function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},set_body2:function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},get_anchor1:function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},set_anchor1:function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},get_anchor2:function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},set_anchor2:function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},get_phase:function(){return this.zpp_inner_zn.phase},set_phase:function(n){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=n&&(this.zpp_inner_zn.phase=n,this.zpp_inner.wake()),this.zpp_inner_zn.phase},impulse:function(){var n=new gn(3,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccz,n},bodyImpulse:function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):Pn.get()},visitBodies:function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},__class__:X,__properties__:e(R.prototype.__properties__,{set_phase:"set_phase",get_phase:"get_phase",set_anchor2:"set_anchor2",get_anchor2:"get_anchor2",set_anchor1:"set_anchor1",get_anchor1:"get_anchor1",set_body2:"set_body2",get_body2:"get_body2",set_body1:"set_body1",get_body1:"get_body1"})});var H=function(){this.zpp_inner=null};l["nape.dynamics.Arbiter"]=H,H.__name__=["nape","dynamics","Arbiter"],H.prototype={zpp_inner:null,get_isSleeping:function(){return this.zpp_inner.sleeping},get_type:function(){return Ve.types[this.zpp_inner.type]},isCollisionArbiter:function(){return this.zpp_inner.type==Ve.COL},isFluidArbiter:function(){return this.zpp_inner.type==Ve.FLUID},isSensorArbiter:function(){return this.zpp_inner.type==Ve.SENSOR},get_collisionArbiter:function(){return this.zpp_inner.type==Ve.COL?this.zpp_inner.colarb.outer_zn:null},get_fluidArbiter:function(){return this.zpp_inner.type==Ve.FLUID?this.zpp_inner.fluidarb.outer_zn:null},get_shape1:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer},get_shape2:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer},get_body1:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer},get_body2:function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer},get_state:function(){var n=this.zpp_inner.immState;return n==(me.id_ImmState_ACCEPT|me.id_ImmState_ALWAYS)?(null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),me.PreFlag_ACCEPT):n==me.id_ImmState_ACCEPT?(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),me.PreFlag_ACCEPT_ONCE):n==(me.id_ImmState_IGNORE|me.id_ImmState_ALWAYS)?(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),me.PreFlag_IGNORE):(null==me.PreFlag_IGNORE_ONCE&&(me.internal=!0,me.PreFlag_IGNORE_ONCE=new D,me.internal=!1),me.PreFlag_IGNORE_ONCE)},totalImpulse:function(n,e){null==e&&(e=!1);var i;return i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer),!!i&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer),Pn.get(0,0,0)},toString:function(){var n=this.zpp_inner.type==Ve.COL?"CollisionArbiter":this.zpp_inner.type==Ve.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return n+"(object-pooled)";var e,i=n+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer)+"|",t=i+""+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer)+")",l=this.zpp_inner.type==Ve.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"",p=this.zpp_inner.immState;p==(me.id_ImmState_ACCEPT|me.id_ImmState_ALWAYS)?(null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),e=me.PreFlag_ACCEPT):p==me.id_ImmState_ACCEPT?(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),e=me.PreFlag_ACCEPT_ONCE):p==(me.id_ImmState_IGNORE|me.id_ImmState_ALWAYS)?(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),e=me.PreFlag_IGNORE):(null==me.PreFlag_IGNORE_ONCE&&(me.internal=!0,me.PreFlag_IGNORE_ONCE=new D,me.internal=!1),e=me.PreFlag_IGNORE_ONCE);return t+l+"<-"+e},__class__:H,__properties__:{get_state:"get_state",get_body2:"get_body2",get_body1:"get_body1",get_shape2:"get_shape2",get_shape1:"get_shape1",get_fluidArbiter:"get_fluidArbiter",get_collisionArbiter:"get_collisionArbiter",get_type:"get_type",get_isSleeping:"get_isSleeping"}};var Q=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.ArbiterIterator"]=Q,Q.__name__=["nape","dynamics","ArbiterIterator"],Q.get=function(n){var e;if(null==Q.zpp_pool){bl.internal=!0;var i=new Q;bl.internal=!1,e=i}else{var t=Q.zpp_pool;Q.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Q.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,n>this.zpp_i||(this.zpp_next=Q.zpp_pool,Q.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Q};var $=function(){this.zpp_inner=null,this.zpp_inner=new bl,this.zpp_inner.outer=this};l["nape.dynamics.ArbiterList"]=$,$.__name__=["nape","dynamics","ArbiterList"],$.fromArray=function(n){for(var e=new $,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},$.prototype={zpp_inner:null,get_length:function(){return this.zpp_gl()},zpp_gl:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.head;null!=n;){n.elt.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},has:function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;;){var e=this.zpp_inner.at_ite.elt;if(e.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var i=this.zpp_inner.at_ite.elt;if(i.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.elt.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var t=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.wrapper()},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var i=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var t=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},empty:function(){return 0==this.zpp_gl()},iterator:function(){return this.zpp_vm(),Q.get(this)},copy:function(n){null==n&&(n=!1);for(var e=new $,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(t>i.zpp_i?l=!0:(i.zpp_next=Q.zpp_pool,Q.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var p,r=i.zpp_inner.at(i.zpp_i++);n||(p=r),e.push(p)}return e},merge:function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var t;if(i>e.zpp_i?t=!0:(e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||this.add(l)}},toString:function(){for(var n="[",e=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(t>i.zpp_i?l=!0:(i.zpp_next=Q.zpp_pool,Q.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==p?"NULL":""+p,e=!1}return n+"]"},foreach:function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var t;if(i>e.zpp_i?t=!0:(e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(l){e.zpp_next=Q.zpp_pool,Q.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;e<this.zpp_gl();){var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:$,__properties__:{get_length:"get_length"}};var nn=function(){};l["nape.dynamics.ArbiterType"]=nn,nn.__name__=["nape","dynamics","ArbiterType"],nn.__properties__={get_FLUID:"get_FLUID",get_SENSOR:"get_SENSOR",get_COLLISION:"get_COLLISION"},nn.get_COLLISION=function(){return null==me.ArbiterType_COLLISION&&(me.internal=!0,me.ArbiterType_COLLISION=new nn,me.internal=!1),me.ArbiterType_COLLISION},nn.get_SENSOR=function(){return null==me.ArbiterType_SENSOR&&(me.internal=!0,me.ArbiterType_SENSOR=new nn,me.internal=!1),me.ArbiterType_SENSOR},nn.get_FLUID=function(){return null==me.ArbiterType_FLUID&&(me.internal=!0,me.ArbiterType_FLUID=new nn,me.internal=!1),me.ArbiterType_FLUID},nn.prototype={toString:function(){return null==me.ArbiterType_COLLISION&&(me.internal=!0,me.ArbiterType_COLLISION=new nn,me.internal=!1),this==me.ArbiterType_COLLISION?"COLLISION":(null==me.ArbiterType_SENSOR&&(me.internal=!0,me.ArbiterType_SENSOR=new nn,me.internal=!1),this==me.ArbiterType_SENSOR?"SENSOR":(null==me.ArbiterType_FLUID&&(me.internal=!0,me.ArbiterType_FLUID=new nn,me.internal=!1),this==me.ArbiterType_FLUID?"FLUID":""))},__class__:nn};var en=function(){H.call(this)};l["nape.dynamics.CollisionArbiter"]=en,en.__name__=["nape","dynamics","CollisionArbiter"],en.__super__=H,en.prototype=e(H.prototype,{get_contacts:function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},get_normal:function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},get_radius:function(){return this.zpp_inner.colarb.radius},get_referenceEdge1:function(){var n,e=this.zpp_inner.colarb.__ref_edge1;return n=null!=e&&((this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner.type!=me.id_ShapeType_POLYGON||(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner!=e.polygon),n&&(e=this.zpp_inner.colarb.__ref_edge2),null==e?null:e.wrapper()},get_referenceEdge2:function(){var n,e=this.zpp_inner.colarb.__ref_edge1;return n=null!=e&&((this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner.type!=me.id_ShapeType_POLYGON||(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner!=e.polygon),n&&(e=this.zpp_inner.colarb.__ref_edge2),null==e?null:e.wrapper()},firstVertex:function(){return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&-1==this.zpp_inner.colarb.__ref_vertex},secondVertex:function(){return!(null!=this.zpp_inner.colarb.__ref_edge1==(null!=this.zpp_inner.colarb.__ref_edge2))&&1==this.zpp_inner.colarb.__ref_vertex},normalImpulse:function(n,e){null==e&&(e=!1);var i;i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=0,l=0,p=0,r=this.zpp_inner.colarb;if(!e||r.oc1.fresh){var a=r.oc1.wrapper().normalImpulse(n),s=a.zpp_inner;null!=s._validate&&s._validate(),t+=1*a.zpp_inner.x;var o=a.zpp_inner;null!=o._validate&&o._validate(),l+=1*a.zpp_inner.y;var _=a.zpp_inner;null!=_._validate&&_._validate(),p+=1*a.zpp_inner.z,a.dispose()}if(r.hc2&&(!e||r.oc2.fresh)){var h=r.oc2.wrapper().normalImpulse(n),u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),l+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),p+=1*h.zpp_inner.z,h.dispose()}return Pn.get(t,l,p)},tangentImpulse:function(n,e){null==e&&(e=!1);var i;i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=0,l=0,p=0,r=this.zpp_inner.colarb;if(!e||r.oc1.fresh){var a=r.oc1.wrapper().tangentImpulse(n),s=a.zpp_inner;null!=s._validate&&s._validate(),t+=1*a.zpp_inner.x;var o=a.zpp_inner;null!=o._validate&&o._validate(),l+=1*a.zpp_inner.y;var _=a.zpp_inner;null!=_._validate&&_._validate(),p+=1*a.zpp_inner.z,a.dispose()}if(r.hc2&&(!e||r.oc2.fresh)){var h=r.oc2.wrapper().tangentImpulse(n),u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),l+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),p+=1*h.zpp_inner.z,h.dispose()}return Pn.get(t,l,p)},totalImpulse:function(n,e){null==e&&(e=!1);var i;i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=0,l=0,p=0,r=this.zpp_inner.colarb;if(!e||r.oc1.fresh){var a=r.oc1.wrapper().totalImpulse(n),s=a.zpp_inner;null!=s._validate&&s._validate(),t+=1*a.zpp_inner.x;var o=a.zpp_inner;null!=o._validate&&o._validate(),l+=1*a.zpp_inner.y;var _=a.zpp_inner;null!=_._validate&&_._validate(),p+=1*a.zpp_inner.z,a.dispose()}if(r.hc2&&(!e||r.oc2.fresh)){var h=r.oc2.wrapper().totalImpulse(n),u=h.zpp_inner;null!=u._validate&&u._validate(),t+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),l+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),p+=1*h.zpp_inner.z,h.dispose()}return Pn.get(t,l,p)},rollingImpulse:function(n,e){null==e&&(e=!1);var i;i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=this.zpp_inner.colarb;return!e||t.oc1.fresh?t.oc1.wrapper().rollingImpulse(n):0},get_elasticity:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.restitution},set_elasticity:function(n){var e=this.zpp_inner.colarb;e.restitution=n,e.userdef_restitution=!0;var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.restitution=i.s1.material.elasticity>-Infinity&&i.s2.material.elasticity>-Infinity?i.s1.material.elasticity<Infinity&&i.s2.material.elasticity<Infinity?(i.s1.material.elasticity+i.s2.material.elasticity)/2:1:0,0>i.restitution&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.restitution},get_dynamicFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.dyn_fric},set_dynamicFriction:function(n){var e=this.zpp_inner.colarb;e.dyn_fric=n,e.userdef_dyn_fric=!0;var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.restitution=i.s1.material.elasticity>-Infinity&&i.s2.material.elasticity>-Infinity?i.s1.material.elasticity<Infinity&&i.s2.material.elasticity<Infinity?(i.s1.material.elasticity+i.s2.material.elasticity)/2:1:0,0>i.restitution&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.dyn_fric},get_staticFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.stat_fric},set_staticFriction:function(n){var e=this.zpp_inner.colarb;e.stat_fric=n,e.userdef_stat_fric=!0;var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.restitution=i.s1.material.elasticity>-Infinity&&i.s2.material.elasticity>-Infinity?i.s1.material.elasticity<Infinity&&i.s2.material.elasticity<Infinity?(i.s1.material.elasticity+i.s2.material.elasticity)/2:1:0,0>i.restitution&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.stat_fric},get_rollingFriction:function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.restitution=n.s1.material.elasticity>-Infinity&&n.s2.material.elasticity>-Infinity?n.s1.material.elasticity<Infinity&&n.s2.material.elasticity<Infinity?(n.s1.material.elasticity+n.s2.material.elasticity)/2:1:0,0>n.restitution&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.rfric},set_rollingFriction:function(n){var e=this.zpp_inner.colarb;e.rfric=n,e.userdef_rfric=!0;var i=this.zpp_inner.colarb;return i.invalidated&&(i.invalidated=!1,i.userdef_restitution||(i.restitution=i.s1.material.elasticity>-Infinity&&i.s2.material.elasticity>-Infinity?i.s1.material.elasticity<Infinity&&i.s2.material.elasticity<Infinity?(i.s1.material.elasticity+i.s2.material.elasticity)/2:1:0,0>i.restitution&&(i.restitution=0),i.restitution>1&&(i.restitution=1)),i.userdef_dyn_fric||(i.dyn_fric=Math.sqrt(i.s1.material.dynamicFriction*i.s2.material.dynamicFriction)),i.userdef_stat_fric||(i.stat_fric=Math.sqrt(i.s1.material.staticFriction*i.s2.material.staticFriction)),i.userdef_rfric||(i.rfric=Math.sqrt(i.s1.material.rollingFriction*i.s2.material.rollingFriction))),i.rfric},__class__:en,__properties__:e(H.prototype.__properties__,{set_rollingFriction:"set_rollingFriction",get_rollingFriction:"get_rollingFriction",set_staticFriction:"set_staticFriction",get_staticFriction:"get_staticFriction",set_dynamicFriction:"set_dynamicFriction",get_dynamicFriction:"get_dynamicFriction",set_elasticity:"set_elasticity",get_elasticity:"get_elasticity",get_referenceEdge2:"get_referenceEdge2",get_referenceEdge1:"get_referenceEdge1",get_radius:"get_radius",get_normal:"get_normal",get_contacts:"get_contacts"})});var tn=function(){this.zpp_inner=null};l["nape.dynamics.Contact"]=tn,tn.__name__=["nape","dynamics","Contact"],tn.prototype={zpp_inner:null,get_arbiter:function(){if(null==this.zpp_inner.arbiter)return null;var n=this.zpp_inner.arbiter.outer;return n.zpp_inner.type==Ve.COL?n.zpp_inner.colarb.outer_zn:null},get_penetration:function(){return this.zpp_inner.inactiveme(),-this.zpp_inner.dist},get_position:function(){return this.zpp_inner.inactiveme(),null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},get_fresh:function(){return this.zpp_inner.inactiveme(),this.zpp_inner.fresh},normalImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,t=i.jnAcc;return null==n?Pn.get(e.nx*t,e.ny*t):n==e.b1.outer?Pn.get(e.nx*-t,e.ny*-t,-(e.ny*i.r1x-e.nx*i.r1y)*t):Pn.get(e.nx*t,e.ny*t,(e.ny*i.r2x-e.nx*i.r2y)*t)},tangentImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,t=i.jtAcc;return null==n?Pn.get(-e.ny*t,e.nx*t):n==e.b1.outer?Pn.get(e.ny*t,-e.nx*t,-(i.r1x*e.nx+i.r1y*e.ny)*t):Pn.get(-e.ny*t,e.nx*t,(i.r2x*e.nx+i.r2y*e.ny)*t)},rollingImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.arbiter.colarb.jrAcc;return null==n?i:n==e.b1.outer?-i:i},totalImpulse:function(n){this.zpp_inner.inactiveme();var e=this.zpp_inner.arbiter.colarb,i=this.zpp_inner.inner,t=i.jnAcc,l=i.jtAcc,p=e.jrAcc;if(null==n)return Pn.get(e.nx*t-e.ny*l,e.ny*t+e.nx*l,p);var r=e.nx*t-e.ny*l,a=e.ny*t+e.nx*l;return n==e.b1.outer?Pn.get(-r,-a,-(a*i.r1x-r*i.r1y)-p):Pn.get(r,a,a*i.r2x-r*i.r2y+p)},get_friction:function(){return this.zpp_inner.inactiveme(),this.zpp_inner.inner.friction},toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:tn,__properties__:{get_friction:"get_friction",get_fresh:"get_fresh",get_position:"get_position",get_penetration:"get_penetration",get_arbiter:"get_arbiter"}};var ln=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.ContactIterator"]=ln,ln.__name__=["nape","dynamics","ContactIterator"],ln.get=function(n){var e;if(null==ln.zpp_pool){gl.internal=!0;var i=new ln;gl.internal=!1,e=i}else{var t=ln.zpp_pool;ln.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},ln.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var e=n.zpp_inner.inner.next;null!=e;){var i=e;i.active&&i.arbiter.active&&n.zpp_inner.user_length++,e=e.next}}var t=n.zpp_inner.user_length;return this.zpp_critical=!0,t>this.zpp_i||(this.zpp_next=ln.zpp_pool,ln.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:ln};var pn=function(){this.zpp_inner=null,this.zpp_inner=new gl,this.zpp_inner.outer=this};l["nape.dynamics.ContactList"]=pn,pn.__name__=["nape","dynamics","ContactList"],pn.fromArray=function(n){for(var e=new pn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},pn.prototype={zpp_inner:null,get_length:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(n<0)!0;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var i=e;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}n>=this.zpp_inner.user_length}if(this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var l=t;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}n=this.zpp_inner.user_length-1-n}if(this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var p=this.zpp_inner.at_ite;if(p.active&&p.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var r=this.zpp_inner.at_ite;if(r.active&&r.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var l=t;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(0==this.zpp_inner.user_length)i=null;else{var p=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;){var a=r;a.active&&a.arbiter.active&&this.zpp_inner.user_length++,r=r.next}}i=p.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var l=t;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(0==this.zpp_inner.user_length)i=null;else{var p=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var r=this.zpp_inner.inner.next;null!=r;){var a=r;a.active&&a.arbiter.active&&this.zpp_inner.user_length++,r=r.next}}i=p.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}this.zpp_inner.valmod();var i=null;if(this.zpp_inner.reverse_flag){i=this.zpp_inner.inner.next;var t=i.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var l;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){var r=p;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}if(1==this.zpp_inner.user_length)l=null;else{var a=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var s=this.zpp_inner.inner.next;null!=s;){var o=s;o.active&&o.arbiter.active&&this.zpp_inner.user_length++,s=s.next}}l=a.iterator_at(this.zpp_inner.user_length-2)}i=null==l?this.zpp_inner.inner.next:l.next;var _=i.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(_),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(l)}return this.zpp_inner.invalidate(),i.wrapper()},shift:function(){if(this.zpp_inner.modify_test(),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}this.zpp_inner.valmod();var i=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var p=l;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}if(1==this.zpp_inner.user_length)t=null;else{var r=this.zpp_inner.inner;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var s=a;s.active&&s.arbiter.active&&this.zpp_inner.user_length++,a=a.next}}t=r.iterator_at(this.zpp_inner.user_length-2)}i=null==t?this.zpp_inner.inner.next:t.next;var o=i.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}else{i=this.zpp_inner.inner.next;var _=i.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(_),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),i.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.next;null!=i;){if(i==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var t=i;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)break;this.shift()}},empty:function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return 0==this.zpp_inner.user_length},iterator:function(){return this.zpp_inner.valmod(),ln.get(this)},copy:function(n){null==n&&(n=!1);var e=new pn;this.zpp_inner.valmod();for(var i=ln.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var l=t.zpp_inner.inner.next;null!=l;){var p=l;p.active&&p.arbiter.active&&t.zpp_inner.user_length++,l=l.next}}var r=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(r>i.zpp_i?a=!0:(i.zpp_next=ln.zpp_pool,ln.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var s,o=i.zpp_inner.at(i.zpp_i++);n||(s=o),e.push(s)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=ln.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var t=i.zpp_inner.inner.next;null!=t;){var l=t;l.active&&l.arbiter.active&&i.zpp_inner.user_length++,t=t.next}}var p=i.zpp_inner.user_length;e.zpp_critical=!0;var r;if(p>e.zpp_i?r=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,r=!1),!r)break;e.zpp_critical=!1;var a=e.zpp_inner.at(e.zpp_i++);this.has(a)||(this.zpp_inner.reverse_flag?this.push(a):this.unshift(a))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=ln.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var l=t.zpp_inner.inner.next;null!=l;){var p=l;p.active&&p.arbiter.active&&t.zpp_inner.user_length++,l=l.next}}var r=t.zpp_inner.user_length;i.zpp_critical=!0;var a;if(r>i.zpp_i?a=!0:(i.zpp_next=ln.zpp_pool,ln.zpp_pool=i,i.zpp_inner=null,a=!1),!a)break;i.zpp_critical=!1;var s=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==s?"NULL":""+s,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=ln.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var t=i.zpp_inner.inner.next;null!=t;){var l=t;l.active&&l.arbiter.active&&i.zpp_inner.user_length++,t=t.next}}var p=i.zpp_inner.user_length;e.zpp_critical=!0;var r;if(p>e.zpp_i?r=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,r=!1),!r)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(a){e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var t=i;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(this.zpp_inner.user_length<=e)break;var l=this.at(e);try{n(l)?++e:this.remove(l)}catch(p){break}}return this},__class__:pn,__properties__:{get_length:"get_length"}};var rn=function(){H.call(this)};l["nape.dynamics.FluidArbiter"]=rn,rn.__name__=["nape","dynamics","FluidArbiter"],rn.__super__=H,rn.prototype=e(H.prototype,{get_position:function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},set_position:function(n){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var e=this.zpp_inner.fluidarb.wrap_position,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},get_overlap:function(){return this.zpp_inner.fluidarb.overlap},set_overlap:function(n){return 0>=n||Infinity,this.zpp_inner.fluidarb.overlap=n},buoyancyImpulse:function(n){var e;e=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=this.zpp_inner.fluidarb;return null==n?Pn.get(i.buoyx,i.buoyy,0):n.zpp_inner==this.zpp_inner.b2?Pn.get(i.buoyx,i.buoyy,i.buoyy*i.r2x-i.buoyx*i.r2y):Pn.get(-i.buoyx,-i.buoyy,-(i.buoyy*i.r1x-i.buoyx*i.r1y))},dragImpulse:function(n){var e;e=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var i=this.zpp_inner.fluidarb,t=null==n||n.zpp_inner==this.zpp_inner.b2?1:-1;return Pn.get(i.dampx*t,i.dampy*t,i.adamp*t)},totalImpulse:function(n,e){null==e&&(e=!1);var i;i=null!=n&&n!=(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer);var t=this.buoyancyImpulse(n),l=this.dragImpulse(n),p=l,r=p.zpp_inner;null!=r._validate&&r._validate();var a=p.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate(),p.zpp_inner.x=a+t.zpp_inner.x;var o=p.zpp_inner;null!=o._validate&&o._validate();var _=l,h=_.zpp_inner;null!=h._validate&&h._validate();var u=_.zpp_inner.y,x=t.zpp_inner;null!=x._validate&&x._validate(),_.zpp_inner.y=u+t.zpp_inner.y;var d=_.zpp_inner;null!=d._validate&&d._validate();var v=l,z=v.zpp_inner;null!=z._validate&&z._validate();var c=v.zpp_inner.z,m=t.zpp_inner;null!=m._validate&&m._validate(),v.zpp_inner.z=c+t.zpp_inner.z;var y=v.zpp_inner;return null!=y._validate&&y._validate(),t.dispose(),l},__class__:rn,__properties__:e(H.prototype.__properties__,{set_overlap:"set_overlap",get_overlap:"get_overlap",set_position:"set_position",get_position:"get_position"})});var an=function(n,e,i,t,l,p){null==p&&(p=-1),null==l&&(l=1),null==t&&(t=-1),null==i&&(i=1),null==e&&(e=-1),null==n&&(n=1),this.zpp_inner=null,null==Ge.zpp_pool?this.zpp_inner=new Ge:(this.zpp_inner=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=e&&(this.zpp_inner.collisionMask=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=i&&(this.zpp_inner.sensorGroup=i,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=t&&(this.zpp_inner.sensorMask=t,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=l&&(this.zpp_inner.fluidGroup=l,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=p&&(this.zpp_inner.fluidMask=p,this.zpp_inner.invalidate())};l["nape.dynamics.InteractionFilter"]=an,an.__name__=["nape","dynamics","InteractionFilter"],an.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=yl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},get_collisionGroup:function(){return this.zpp_inner.collisionGroup},set_collisionGroup:function(n){return this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},get_collisionMask:function(){return this.zpp_inner.collisionMask},set_collisionMask:function(n){return this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},get_sensorGroup:function(){return this.zpp_inner.sensorGroup},set_sensorGroup:function(n){return this.zpp_inner.sensorGroup!=n&&(this.zpp_inner.sensorGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},get_sensorMask:function(){return this.zpp_inner.sensorMask},set_sensorMask:function(n){return this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},get_fluidGroup:function(){return this.zpp_inner.fluidGroup},set_fluidGroup:function(n){return this.zpp_inner.fluidGroup!=n&&(this.zpp_inner.fluidGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},get_fluidMask:function(){return this.zpp_inner.fluidMask},set_fluidMask:function(n){return this.zpp_inner.fluidMask!=n&&(this.zpp_inner.fluidMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},shouldCollide:function(n){var e=this.zpp_inner,i=n.zpp_inner;return 0!=(e.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&e.collisionGroup)},shouldSense:function(n){var e=this.zpp_inner,i=n.zpp_inner;return 0!=(e.sensorMask&i.sensorGroup)&&0!=(i.sensorMask&e.sensorGroup)},shouldFlow:function(n){var e=this.zpp_inner,i=n.zpp_inner;return 0!=(e.fluidMask&i.fluidGroup)&&0!=(i.fluidMask&e.fluidGroup)},copy:function(){return new an(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},toString:function(){return"{ collision: "+h.hex(this.zpp_inner.collisionGroup,8)+"~"+h.hex(this.zpp_inner.collisionMask,8)+" sensor: "+h.hex(this.zpp_inner.sensorGroup,8)+"~"+h.hex(this.zpp_inner.sensorMask,8)+" fluid: "+h.hex(this.zpp_inner.fluidGroup,8)+"~"+h.hex(this.zpp_inner.fluidMask,8)+" }"},__class__:an,__properties__:{set_fluidMask:"set_fluidMask",get_fluidMask:"get_fluidMask",set_fluidGroup:"set_fluidGroup",get_fluidGroup:"get_fluidGroup",set_sensorMask:"set_sensorMask",get_sensorMask:"get_sensorMask",set_sensorGroup:"set_sensorGroup",get_sensorGroup:"get_sensorGroup",set_collisionMask:"set_collisionMask",get_collisionMask:"get_collisionMask",set_collisionGroup:"set_collisionGroup",get_collisionGroup:"get_collisionGroup",get_shapes:"get_shapes",get_userData:"get_userData"}};var sn=function(n){null==n&&(n=!1),this.zpp_inner=null,this.zpp_inner=new Ze,this.zpp_inner.outer=this,this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n)};l["nape.dynamics.InteractionGroup"]=sn,sn.__name__=["nape","dynamics","InteractionGroup"],sn.prototype={zpp_inner:null,get_group:function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},set_group:function(n){return this.zpp_inner.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},get_ignore:function(){return this.zpp_inner.ignore},set_ignore:function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n),this.zpp_inner.ignore},get_interactors:function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=_l.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},get_groups:function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=fl.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},toString:function(){var n="InteractionGroup";return this.zpp_inner.ignore&&(n+=":ignore"),n},__class__:sn,__properties__:{get_groups:"get_groups",get_interactors:"get_interactors",set_ignore:"set_ignore",get_ignore:"get_ignore",set_group:"set_group",get_group:"get_group"}};var on=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.dynamics.InteractionGroupIterator"]=on,on.__name__=["nape","dynamics","InteractionGroupIterator"],on.get=function(n){var e;if(null==on.zpp_pool){fl.internal=!0;var i=new on;fl.internal=!1,e=i}else{var t=on.zpp_pool;on.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},on.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=on.zpp_pool,on.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:on};var _n=function(){this.zpp_inner=null,this.zpp_inner=new fl,this.zpp_inner.outer=this};l["nape.dynamics.InteractionGroupList"]=_n,_n.__name__=["nape","dynamics","InteractionGroupList"],_n.fromArray=function(n){for(var e=new _n,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},_n.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),on.get(this)},copy:function(n){null==n&&(n=!1);var e=new _n;this.zpp_inner.valmod();for(var i=on.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=on.zpp_pool,on.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=on.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=on.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=on.zpp_pool,on.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=on.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=on.zpp_pool,on.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:_n,__properties__:{get_length:"get_length"}};var hn=function(n,e,i,t){null==t&&(t=0),null==i&&(i=0),null==e&&(e=0),null==n&&(n=0),this.zpp_inner=null;var l;null==qe.zpp_pool?l=new qe:(l=qe.zpp_pool,qe.zpp_pool=l.next,l.next=null),l.minx=n,l.miny=e,l.maxx=n+i,l.maxy=e+t,this.zpp_inner=l,this.zpp_inner.outer=this};l["nape.geom.AABB"]=hn,hn.__name__=["nape","geom","AABB"],hn.prototype={zpp_inner:null,copy:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e,i=this.zpp_inner,t=i.minx,l=i.miny,p=i.maxx,r=i.maxy;return null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.minx=t,e.miny=l,e.maxx=p,e.maxy=r,e.wrapper()},get_min:function(){return this.zpp_inner.getmin()},set_min:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.minx,t=this.zpp_inner;if(null!=t._validate&&t._validate(),i==this.zpp_inner.minx){var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.miny,r=this.zpp_inner;null!=r._validate&&r._validate(),p!=this.zpp_inner.miny}else!0;var a=n.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.getmax(),o=s.zpp_inner;null!=o._validate&&o._validate();var _=n.zpp_inner;null!=_._validate&&_._validate();var h=this.zpp_inner.getmax(),u=h.zpp_inner;null!=u._validate&&u._validate();var x=this.zpp_inner.getmin(),d=x.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v=n.zpp_inner;null!=v._validate&&v._validate();var z=n.zpp_inner.x,c=n.zpp_inner;null!=c._validate&&c._validate();var m=n.zpp_inner.y,y=x.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f,b=x.zpp_inner;if(null!=b._validate&&b._validate(),x.zpp_inner.x==z){var g=x.zpp_inner;null!=g._validate&&g._validate(),f=x.zpp_inner.y==m}else f=!1;if(!f){x.zpp_inner.x=z,x.zpp_inner.y=m;var w=x.zpp_inner;null!=w._invalidate&&w._invalidate(w)}if(n.zpp_inner.weak){var M=n.zpp_inner;null!=M._isimmutable&&M._isimmutable();var C=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var k=n;k.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=k:Ml.poolVec2=k,Ml.nextVec2=k,k.zpp_disp=!0;var O=C;null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=Mi.zpp_pool,Mi.zpp_pool=O}return this.zpp_inner.getmin()},get_max:function(){return this.zpp_inner.getmax()},set_max:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.minx,t=this.zpp_inner;if(null!=t._validate&&t._validate(),i==this.zpp_inner.minx){var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.miny,r=this.zpp_inner;null!=r._validate&&r._validate(),p!=this.zpp_inner.miny}else!0;var a=n.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.getmin(),o=s.zpp_inner;null!=o._validate&&o._validate();var _=n.zpp_inner;null!=_._validate&&_._validate();var h=this.zpp_inner.getmin(),u=h.zpp_inner;null!=u._validate&&u._validate();var x=this.zpp_inner.getmax(),d=x.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v=n.zpp_inner;null!=v._validate&&v._validate();var z=n.zpp_inner.x,c=n.zpp_inner;null!=c._validate&&c._validate();var m=n.zpp_inner.y,y=x.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f,b=x.zpp_inner;if(null!=b._validate&&b._validate(),x.zpp_inner.x==z){var g=x.zpp_inner;null!=g._validate&&g._validate(),f=x.zpp_inner.y==m}else f=!1;if(!f){x.zpp_inner.x=z,x.zpp_inner.y=m;var w=x.zpp_inner;null!=w._invalidate&&w._invalidate(w)}if(n.zpp_inner.weak){var M=n.zpp_inner;null!=M._isimmutable&&M._isimmutable();var C=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var k=n;k.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=k:Ml.poolVec2=k,Ml.nextVec2=k,k.zpp_disp=!0;var O=C;null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=Mi.zpp_pool,Mi.zpp_pool=O}return this.zpp_inner.getmax()},get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.minx},set_x:function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.minx!=n){this.zpp_inner.maxx+=n-this.zpp_inner.minx,this.zpp_inner.minx=n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.minx},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.miny},set_y:function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.miny!=n){this.zpp_inner.maxy+=n-this.zpp_inner.miny,this.zpp_inner.miny=n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate(i)}var t=this.zpp_inner;return null!=t._validate&&t._validate(),this.zpp_inner.miny},get_width:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxx-e.minx},set_width:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner;if(i.maxx-i.minx!=n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+n;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l)}var p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner;return r.maxx-r.minx},get_height:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxy-e.miny},set_height:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner;if(i.maxy-i.miny!=n){var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+n;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l)}var p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner;return r.maxy-r.miny},toString:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),""+this.zpp_inner},__class__:hn,__properties__:{set_height:"set_height",get_height:"get_height",set_width:"set_width",get_width:"get_width",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x",set_max:"set_max",get_max:"get_max",set_min:"set_min",get_min:"get_min"}};var un=function(){this.zpp_inner=null};l["nape.geom.ConvexResult"]=un,un.__name__=["nape","geom","ConvexResult"],un.prototype={zpp_inner:null,get_normal:function(){return this.zpp_inner.normal},get_position:function(){return this.zpp_inner.position},get_toi:function(){return this.zpp_inner.toiDistance},get_shape:function(){return this.zpp_inner.shape},dispose:function(){this.zpp_inner.free()},toString:function(){return"{ shape: "+_.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},__class__:un,__properties__:{get_shape:"get_shape",get_toi:"get_toi",get_position:"get_position",get_normal:"get_normal"}};var xn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.ConvexResultIterator"]=xn,xn.__name__=["nape","geom","ConvexResultIterator"],xn.get=function(n){var e;if(null==xn.zpp_pool){cl.internal=!0;var i=new xn;cl.internal=!1,e=i}else{var t=xn.zpp_pool;xn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},xn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=xn.zpp_pool,xn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:xn};var dn=function(){this.zpp_inner=null,this.zpp_inner=new cl,this.zpp_inner.outer=this};l["nape.geom.ConvexResultList"]=dn,dn.__name__=["nape","geom","ConvexResultList"],dn.fromArray=function(n){for(var e=new dn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},dn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),xn.get(this)},copy:function(n){null==n&&(n=!1);var e=new dn;this.zpp_inner.valmod();for(var i=xn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=xn.zpp_pool,xn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=xn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=xn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=xn.zpp_pool,xn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:dn,__properties__:{get_length:"get_length"}};var vn=function(){};l["nape.geom.Geom"]=vn,vn.__name__=["nape","geom","Geom"],vn.distanceBody=function(n,e,i,t){var l=i.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p=t.zpp_inner;null!=p._isimmutable&&p._isimmutable();for(var r=n.zpp_inner.shapes.head;null!=r;){$e.validateShape(r.elt),r=r.next}for(var a=e.zpp_inner.shapes.head;null!=a;){$e.validateShape(a.elt),a=a.next}return bi.distanceBody(n.zpp_inner,e.zpp_inner,i.zpp_inner,t.zpp_inner)},vn.distance=function(n,e,i,t){var l=i.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p=t.zpp_inner;null!=p._isimmutable&&p._isimmutable(),$e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner);var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1;var a,s=n.zpp_inner,o=e.zpp_inner,_=i.zpp_inner,h=t.zpp_inner;if(s.type==me.id_ShapeType_CIRCLE&&o.type==me.id_ShapeType_CIRCLE){var u,x=s.circle,d=o.circle,v=0,z=0;v=d.worldCOMx-x.worldCOMx,z=d.worldCOMy-x.worldCOMy;var c=Math.sqrt(v*v+z*z);if(1e100>(u=c-(x.radius+d.radius))){if(0==c)v=1,z=0;else{var m=1/c;v*=m,z*=m}var f=x.radius;_.x=x.worldCOMx+v*f,_.y=x.worldCOMy+z*f;var b=-d.radius;h.x=d.worldCOMx+v*b,h.y=d.worldCOMy+z*b,r.x=v,r.y=z}a=u}else{var g=!1;if(s.type==me.id_ShapeType_CIRCLE&&o.type==me.id_ShapeType_POLYGON){var w=s;s=o,o=w;var M=_;_=h,h=M,g=!0}if(s.type==me.id_ShapeType_POLYGON&&o.type==me.id_ShapeType_CIRCLE){for(var C=s.polygon,k=o.circle,O=-1e100,I=null,S=C.edges.head;null!=S;){var P=S.elt,T=P.gnormx*k.worldCOMx+P.gnormy*k.worldCOMy-P.gprojection-k.radius;if(T>1e100){O=T;break}T>0?T>O&&(O=T,I=P):0>O&&T>O&&(O=T,I=P),S=S.next}if(1e100>O){var A=I.gp0,E=I.gp1,N=k.worldCOMy*I.gnormx-k.worldCOMx*I.gnormy;if(A.y*I.gnormx-A.x*I.gnormy<N)if(N<E.y*I.gnormx-E.x*I.gnormy){var L=-k.radius;h.x=k.worldCOMx+I.gnormx*L,h.y=k.worldCOMy+I.gnormy*L;var V=-O;_.x=h.x+I.gnormx*V,_.y=h.y+I.gnormy*V,r.x=I.gnormx,r.y=I.gnormy}else{var j=0,D=0;j=k.worldCOMx-E.x,D=k.worldCOMy-E.y;var F=Math.sqrt(j*j+D*D);if(1e100>(O=F-k.radius)){if(0==F)j=1,D=0;else{var R=1/F;j*=R,D*=R}_.x=E.x+0*j,_.y=E.y+0*D;var B=-k.radius;h.x=k.worldCOMx+j*B,h.y=k.worldCOMy+D*B,r.x=j,r.y=D}}else{var G=0,Z=0;G=k.worldCOMx-A.x,Z=k.worldCOMy-A.y;var U=Math.sqrt(G*G+Z*Z);if(1e100>(O=U-k.radius)){if(0==U)G=1,Z=0;else{var q=1/U;G*=q,Z*=q}_.x=A.x+0*G,_.y=A.y+0*Z;var Y=-k.radius;h.x=k.worldCOMx+G*Y,h.y=k.worldCOMy+Z*Y,r.x=G,r.y=Z}}}g&&(r.x=-r.x,r.y=-r.y),a=O}else{for(var K=s.polygon,W=o.polygon,J=-1e100,X=null,H=null,Q=0,$=K.edges.head;null!=$;){for(var nn=$.elt,en=1e100,tn=W.gverts.next;null!=tn;){var ln=tn,pn=nn.gnormx*ln.x+nn.gnormy*ln.y;en>pn&&(en=pn),tn=tn.next}if((en-=nn.gprojection)>1e100){J=en;break}en>0?en>J&&(J=en,X=nn,Q=1):0>J&&en>J&&(J=en,X=nn,Q=1),$=$.next}if(1e100>J){for(var rn=W.edges.head;null!=rn;){for(var an=rn.elt,sn=1e100,on=K.gverts.next;null!=on;){var _n=on,hn=an.gnormx*_n.x+an.gnormy*_n.y;sn>hn&&(sn=hn),on=on.next}if((sn-=an.gprojection)>1e100){J=sn;break}sn>0?sn>J&&(J=sn,H=an,Q=2):0>J&&sn>J&&(J=sn,H=an,Q=2),rn=rn.next}if(1e100>J){var un,xn;if(1==Q)K,un=W,xn=X;else{W,un=K,xn=H;var dn=_;_=h,h=dn,g=!g}for(var vn=null,zn=1e100,cn=un.edges.head;null!=cn;){var mn=cn.elt,yn=xn.gnormx*mn.gnormx+xn.gnormy*mn.gnormy;zn>yn&&(zn=yn,vn=mn),cn=cn.next}if(g?(r.x=-xn.gnormx,r.y=-xn.gnormy):(r.x=xn.gnormx,r.y=xn.gnormy),0>J){var fn=0,bn=0;fn=vn.gp0.x,bn=vn.gp0.y;var gn=0,wn=0;gn=vn.gp1.x,wn=vn.gp1.y;var Mn=0,Cn=0;Mn=gn-fn,Cn=wn-bn;var kn=xn.gnormy*fn-xn.gnormx*bn,On=xn.gnormy*gn-xn.gnormx*wn,In=1/(On-kn),Sn=(-xn.tp1-kn)*In;if(Sn>y.epsilon){var Pn=Sn;fn+=Mn*Pn,bn+=Cn*Pn}var Tn=(-xn.tp0-On)*In;if(-y.epsilon>Tn){var An=Tn;gn+=Mn*An,wn+=Cn*An}var En=fn*xn.gnormx+bn*xn.gnormy-xn.gprojection,Nn=gn*xn.gnormx+wn*xn.gnormy-xn.gprojection;if(Nn>En){h.x=fn,h.y=bn;var Ln=-En;_.x=h.x+xn.gnormx*Ln,_.y=h.y+xn.gnormy*Ln,a=En}else{h.x=gn,h.y=wn;var Vn=-Nn;_.x=h.x+xn.gnormx*Vn,_.y=h.y+xn.gnormy*Vn,a=Nn}}else{var jn=xn.gp0,Dn=xn.gp1,Fn=vn.gp0,Rn=vn.gp1,Bn=0,Gn=0,Zn=0,Un=0;Bn=Dn.x-jn.x,Gn=Dn.y-jn.y,Zn=Rn.x-Fn.x,Un=Rn.y-Fn.y;var qn=1/(Bn*Bn+Gn*Gn),Yn=1/(Zn*Zn+Un*Un),Kn=-(Bn*(jn.x-Fn.x)+Gn*(jn.y-Fn.y))*qn,Wn=-(Bn*(jn.x-Rn.x)+Gn*(jn.y-Rn.y))*qn,Jn=-(Zn*(Fn.x-jn.x)+Un*(Fn.y-jn.y))*Yn,Xn=-(Zn*(Fn.x-Dn.x)+Un*(Fn.y-Dn.y))*Yn;0>Kn?Kn=0:Kn>1&&(Kn=1),0>Wn?Wn=0:Wn>1&&(Wn=1),0>Jn?Jn=0:Jn>1&&(Jn=1),0>Xn?Xn=0:Xn>1&&(Xn=1);var Hn=0,Qn=0,$n=Kn;Hn=jn.x+Bn*$n,Qn=jn.y+Gn*$n;var ne=0,ee=0,ie=Wn;ne=jn.x+Bn*ie,ee=jn.y+Gn*ie;var te=0,le=0,pe=Jn;te=Fn.x+Zn*pe,le=Fn.y+Un*pe;var re=0,ae=0,se=Xn;re=Fn.x+Zn*se,ae=Fn.y+Un*se;var oe=0,_e=0;oe=Hn-Fn.x,_e=Qn-Fn.y;var he=oe*oe+_e*_e,ue=0,xe=0;ue=ne-Rn.x,xe=ee-Rn.y;var de=ue*ue+xe*xe,ve=0,ze=0;ve=te-jn.x,ze=le-jn.y;var ce=ve*ve+ze*ze,ye=0,fe=0;ye=re-Dn.x,fe=ae-Dn.y;var be=ye*ye+fe*fe,ge=0,we=0,Me=null;de>he?(ge=Hn,we=Qn,Me=Fn):(ge=ne,we=ee,Me=Rn,he=de);var Ce=0,ke=0,Oe=null;if(be>ce?(Ce=te,ke=le,Oe=jn):(Ce=re,ke=ae,Oe=Dn,ce=be),ce>he?(_.x=ge,_.y=we,h.x=Me.x,h.y=Me.y,J=Math.sqrt(he)):(h.x=Ce,h.y=ke,_.x=Oe.x,_.y=Oe.y,J=Math.sqrt(ce)),0!=J){r.x=h.x-_.x,r.y=h.y-_.y;var Ie=1/J;r.x*=Ie,r.y*=Ie,g&&(r.x=-r.x,r.y=-r.y)}a=J}}else a=1e100}else a=1e100}}var Se=r;return null!=Se.outer&&(Se.outer.zpp_inner=null,Se.outer=null),Se._isimmutable=null,Se._validate=null,Se._invalidate=null,Se.next=Mi.zpp_pool,Mi.zpp_pool=Se,a},vn.intersectsBody=function(n,e){for(var i=n.zpp_inner.shapes.head;null!=i;){$e.validateShape(i.elt),i=i.next}for(var t=e.zpp_inner.shapes.head;null!=t;){$e.validateShape(t.elt),t=t.next}var l=n.zpp_inner.aabb,p=e.zpp_inner.aabb;if(p.miny>l.maxy||l.miny>p.maxy||p.minx>l.maxx||l.minx>p.maxx)return!1;for(var r=n.zpp_inner.shapes.head;null!=r;){for(var a=r.elt,s=e.zpp_inner.shapes.head;null!=s;){if(Ke.testCollide_safe(a,s.elt))return!0;s=s.next}r=r.next}return!1},vn.intersects=function(n,e){$e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner);var i=n.zpp_inner.aabb,t=e.zpp_inner.aabb;return!(t.miny>i.maxy||i.miny>t.maxy||t.minx>i.maxx||i.minx>t.maxx)&&Ke.testCollide_safe(n.zpp_inner,e.zpp_inner)},vn.contains=function(n,e){return $e.validateShape(n.zpp_inner),$e.validateShape(e.zpp_inner),Ke.containTest(n.zpp_inner,e.zpp_inner)};var zn=function Kl(n){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new ei(this),null!=n){if(n instanceof Array&&null==n.__enum__)for(var e=n,i=0;e.length>i;){var t=e[i];++i,m.__instanceof(t,On);var l=t,p=l.zpp_inner;null!=p._validate&&p._validate();var r=l.zpp_inner.x,a=l.zpp_inner;null!=a._validate&&a._validate();var s,o=l.zpp_inner.y;null==ni.zpp_pool?s=new ni:(s=ni.zpp_pool,ni.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=r,s.y=o;var _=s;null==this.zpp_inner.vertices?this.zpp_inner.vertices=_.prev=_.next=_:(_.prev=this.zpp_inner.vertices,_.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=_,this.zpp_inner.vertices.next=_),this.zpp_inner.vertices=_}else if(m.__instanceof(n,Sn))for(var h=n,u=h.iterator();;){u.zpp_inner.zpp_inner.valmod();var x=u.zpp_inner.zpp_gl();u.zpp_critical=!0;var d;if(x>u.zpp_i?d=!0:(u.zpp_next=In.zpp_pool,In.zpp_pool=u,u.zpp_inner=null,d=!1),!d)break;u.zpp_critical=!1;var v=u.zpp_inner.at(u.zpp_i++),z=v.zpp_inner;null!=z._validate&&z._validate();var c=v.zpp_inner.x,y=v.zpp_inner;null!=y._validate&&y._validate();var f,b=v.zpp_inner.y;null==ni.zpp_pool?f=new ni:(f=ni.zpp_pool,ni.zpp_pool=f.next,f.next=null),f.forced=!1,f.x=c,f.y=b;var g=f;null==this.zpp_inner.vertices?this.zpp_inner.vertices=g.prev=g.next=g:(g.prev=this.zpp_inner.vertices,g.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=g,this.zpp_inner.vertices.next=g),this.zpp_inner.vertices=g}else if(m.__instanceof(n,Kl)){var w=n,M=w.zpp_inner.vertices;if(null!=M)for(var C=M;;){var k,O=C.x,I=C.y;if(null==Ml.poolVec2?k=new On:(k=Ml.poolVec2,Ml.poolVec2=k.zpp_pool,k.zpp_pool=null,k.zpp_disp=!1,k==Ml.nextVec2&&(Ml.nextVec2=null)),null==k.zpp_inner){var S;null==Mi.zpp_pool?S=new Mi:(S=Mi.zpp_pool,Mi.zpp_pool=S.next,S.next=null),S.weak=!1,S._immutable=!1,S.x=O,S.y=I,k.zpp_inner=S,k.zpp_inner.outer=k}else{var P=k.zpp_inner;null!=P._isimmutable&&P._isimmutable();var T,A=k.zpp_inner;if(null!=A._validate&&A._validate(),k.zpp_inner.x==O){var E=k.zpp_inner;null!=E._validate&&E._validate(),T=k.zpp_inner.y==I}else T=!1;if(!T){k.zpp_inner.x=O,k.zpp_inner.y=I;var N=k.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}k.zpp_inner.weak=!1;var L=k;C=C.next;var V=L.zpp_inner;null!=V._validate&&V._validate();var j=L.zpp_inner.x,D=L.zpp_inner;null!=D._validate&&D._validate();var F,R=L.zpp_inner.y;null==ni.zpp_pool?F=new ni:(F=ni.zpp_pool,ni.zpp_pool=F.next,F.next=null),F.forced=!1,F.x=j,F.y=R;var B=F;null==this.zpp_inner.vertices?this.zpp_inner.vertices=B.prev=B.next=B:(B.prev=this.zpp_inner.vertices,B.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=B,this.zpp_inner.vertices.next=B),this.zpp_inner.vertices=B;var G=L.zpp_inner;null!=G._isimmutable&&G._isimmutable();var Z=L.zpp_inner;L.zpp_inner.outer=null,L.zpp_inner=null;var U=L;U.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=U:Ml.poolVec2=U,Ml.nextVec2=U,U.zpp_disp=!0;var q=Z;if(null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=Mi.zpp_pool,Mi.zpp_pool=q,C==M)break}}if(this.skipForward(1),n instanceof Array&&null==n.__enum__)for(var Y=n,K=0;Y.length>K;){var W,J=Y[K];if(J.zpp_inner.weak){var X=J.zpp_inner;null!=X._isimmutable&&X._isimmutable();var H=J.zpp_inner;J.zpp_inner.outer=null,J.zpp_inner=null;var Q=J;Q.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Q:Ml.poolVec2=Q,Ml.nextVec2=Q,Q.zpp_disp=!0;var $=H;null!=$.outer&&($.outer.zpp_inner=null,$.outer=null),$._isimmutable=null,$._validate=null,$._invalidate=null,$.next=Mi.zpp_pool,Mi.zpp_pool=$,W=!0}else W=!1;W?Y.splice(K,1):++K}else if(m.__instanceof(n,Sn)){var nn=n;null!=nn.zpp_inner._validate&&nn.zpp_inner._validate();for(var en=nn.zpp_inner.inner,tn=null,ln=en.head;null!=ln;){var pn=ln.elt;if(pn.outer.zpp_inner.weak){if(ln=en.erase(tn),pn.outer.zpp_inner.weak){var rn=pn.outer,an=rn.zpp_inner;null!=an._isimmutable&&an._isimmutable();var sn=rn.zpp_inner;rn.zpp_inner.outer=null,rn.zpp_inner=null;var on=rn;on.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=on:Ml.poolVec2=on,Ml.nextVec2=on,on.zpp_disp=!0;var _n=sn;null!=_n.outer&&(_n.outer.zpp_inner=null,_n.outer=null),_n._isimmutable=null,_n._validate=null,_n._invalidate=null,_n.next=Mi.zpp_pool,Mi.zpp_pool=_n}}else tn=ln,ln=ln.next}}}};l["nape.geom.GeomPoly"]=zn,zn.__name__=["nape","geom","GeomPoly"],zn.get=function(n){var e;if(null==Ml.poolGeomPoly?e=new zn:(e=Ml.poolGeomPoly,Ml.poolGeomPoly=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Ml.nextGeomPoly&&(Ml.nextGeomPoly=null)),null!=n){if(n instanceof Array&&null==n.__enum__)for(var i=n,t=0;i.length>t;){var l=i[t];++t,m.__instanceof(l,On);var p=l,r=p.zpp_inner;null!=r._validate&&r._validate();var a=p.zpp_inner.x,s=p.zpp_inner;null!=s._validate&&s._validate();var o,_=p.zpp_inner.y;null==ni.zpp_pool?o=new ni:(o=ni.zpp_pool,ni.zpp_pool=o.next,o.next=null),o.forced=!1,o.x=a,o.y=_;var h=o;null==e.zpp_inner.vertices?e.zpp_inner.vertices=h.prev=h.next=h:(h.prev=e.zpp_inner.vertices,h.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=h,e.zpp_inner.vertices.next=h),e.zpp_inner.vertices=h}else if(m.__instanceof(n,Sn))for(var u=n,x=u.iterator();;){x.zpp_inner.zpp_inner.valmod();var d=x.zpp_inner.zpp_gl();x.zpp_critical=!0;var v;if(d>x.zpp_i?v=!0:(x.zpp_next=In.zpp_pool,In.zpp_pool=x,x.zpp_inner=null,v=!1),!v)break;x.zpp_critical=!1;var z=x.zpp_inner.at(x.zpp_i++),c=z.zpp_inner;null!=c._validate&&c._validate();var y=z.zpp_inner.x,f=z.zpp_inner;null!=f._validate&&f._validate();var b,g=z.zpp_inner.y;null==ni.zpp_pool?b=new ni:(b=ni.zpp_pool,ni.zpp_pool=b.next,b.next=null),b.forced=!1,b.x=y,b.y=g;var w=b;null==e.zpp_inner.vertices?e.zpp_inner.vertices=w.prev=w.next=w:(w.prev=e.zpp_inner.vertices,w.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=w,e.zpp_inner.vertices.next=w),e.zpp_inner.vertices=w}else if(m.__instanceof(n,zn)){var M=n,C=M.zpp_inner.vertices;if(null!=C)for(var k=C;;){var O,I=k.x,S=k.y;if(null==Ml.poolVec2?O=new On:(O=Ml.poolVec2,Ml.poolVec2=O.zpp_pool,O.zpp_pool=null,O.zpp_disp=!1,O==Ml.nextVec2&&(Ml.nextVec2=null)),null==O.zpp_inner){var P;null==Mi.zpp_pool?P=new Mi:(P=Mi.zpp_pool,Mi.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=I,P.y=S,O.zpp_inner=P,O.zpp_inner.outer=O}else{var T=O.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A,E=O.zpp_inner;if(null!=E._validate&&E._validate(),O.zpp_inner.x==I){var N=O.zpp_inner;null!=N._validate&&N._validate(),A=O.zpp_inner.y==S}else A=!1;if(!A){O.zpp_inner.x=I,O.zpp_inner.y=S;var L=O.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}O.zpp_inner.weak=!1;var V=O;k=k.next;var j=V.zpp_inner;null!=j._validate&&j._validate();var D=V.zpp_inner.x,F=V.zpp_inner;null!=F._validate&&F._validate();var R,B=V.zpp_inner.y;null==ni.zpp_pool?R=new ni:(R=ni.zpp_pool,ni.zpp_pool=R.next,R.next=null),R.forced=!1,R.x=D,R.y=B;var G=R;null==e.zpp_inner.vertices?e.zpp_inner.vertices=G.prev=G.next=G:(G.prev=e.zpp_inner.vertices,G.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=G,e.zpp_inner.vertices.next=G),e.zpp_inner.vertices=G;var Z=V.zpp_inner;null!=Z._isimmutable&&Z._isimmutable();var U=V.zpp_inner;V.zpp_inner.outer=null,V.zpp_inner=null;var q=V;q.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=q:Ml.poolVec2=q,Ml.nextVec2=q,q.zpp_disp=!0;var Y=U;if(null!=Y.outer&&(Y.outer.zpp_inner=null,Y.outer=null),Y._isimmutable=null,Y._validate=null,Y._invalidate=null,Y.next=Mi.zpp_pool,Mi.zpp_pool=Y,k==C)break}}if(e.skipForward(1),n instanceof Array&&null==n.__enum__)for(var K=n,W=0;K.length>W;){var J,X=K[W];if(X.zpp_inner.weak){var H=X.zpp_inner;null!=H._isimmutable&&H._isimmutable();var Q=X.zpp_inner;X.zpp_inner.outer=null,X.zpp_inner=null;var $=X;$.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=$:Ml.poolVec2=$,Ml.nextVec2=$,$.zpp_disp=!0;var nn=Q;null!=nn.outer&&(nn.outer.zpp_inner=null,nn.outer=null),nn._isimmutable=null,nn._validate=null,nn._invalidate=null,nn.next=Mi.zpp_pool,Mi.zpp_pool=nn,J=!0}else J=!1;J?K.splice(W,1):++W}else if(m.__instanceof(n,Sn)){var en=n;null!=en.zpp_inner._validate&&en.zpp_inner._validate();for(var tn=en.zpp_inner.inner,ln=null,pn=tn.head;null!=pn;){var rn=pn.elt;if(rn.outer.zpp_inner.weak){if(pn=tn.erase(ln),rn.outer.zpp_inner.weak){var an=rn.outer,sn=an.zpp_inner;null!=sn._isimmutable&&sn._isimmutable();var on=an.zpp_inner;an.zpp_inner.outer=null,an.zpp_inner=null;var _n=an;_n.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=_n:Ml.poolVec2=_n,Ml.nextVec2=_n,_n.zpp_disp=!0;var hn=on;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn._isimmutable=null,hn._validate=null,hn._invalidate=null,hn.next=Mi.zpp_pool,Mi.zpp_pool=hn}}else ln=pn,pn=pn.next}}}return e},zn.prototype={zpp_pool:null,zpp_disp:null,zpp_inner:null,empty:function(){return null==this.zpp_inner.vertices},size:function(){var n=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){if(++n,(t=t.next)==i)break}return n},iterator:function(){return ii.get(this.zpp_inner.vertices,!0)},forwardIterator:function(){return ii.get(this.zpp_inner.vertices,!0)},backwardsIterator:function(){return ii.get(this.zpp_inner.vertices,!1)},current:function(){var n=this.zpp_inner.vertices;if(null==n.wrap){var e,t=n.x,l=n.y;if(null==Ml.poolVec2?e=new On:(e=Ml.poolVec2,Ml.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Ml.nextVec2&&(Ml.nextVec2=null)),null==e.zpp_inner){var p;null==Mi.zpp_pool?p=new Mi:(p=Mi.zpp_pool,Mi.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=l,e.zpp_inner=p,e.zpp_inner.outer=e}else{var r=e.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==t){var o=e.zpp_inner;null!=o._validate&&o._validate(),a=e.zpp_inner.y==l}else a=!1;if(!a){e.zpp_inner.x=t,e.zpp_inner.y=l;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}return n.wrap},push:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();var l,p=n.zpp_inner.y;null==ni.zpp_pool?l=new ni:(l=ni.zpp_pool,ni.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=i,l.y=p;var r=l;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=r.prev=r.next=r:(r.prev=this.zpp_inner.vertices,r.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=r,this.zpp_inner.vertices.next=r),this.zpp_inner.vertices=r,n.zpp_inner.weak){var a=n.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var o=n;o.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=o:Ml.poolVec2=o,Ml.nextVec2=o,o.zpp_disp=!0;var _=s;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Mi.zpp_pool,Mi.zpp_pool=_}return this},pop:function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=null;else{var i=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=i}this.zpp_inner.vertices=n;var t=e;if(null!=t.wrap){t.wrap.zpp_inner._inuse=!1;var l=t.wrap,p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var a=l;a.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=a:Ml.poolVec2=a,Ml.nextVec2=a,a.zpp_disp=!0;var s=r;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Mi.zpp_pool,Mi.zpp_pool=s,t.wrap=null}return t.prev=t.next=null,t.next=ni.zpp_pool,ni.zpp_pool=t,this},unshift:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();var l,p=n.zpp_inner.y;null==ni.zpp_pool?l=new ni:(l=ni.zpp_pool,ni.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=i,l.y=p;var r=l;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=r.prev=r.next=r:(r.next=this.zpp_inner.vertices,r.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=r,this.zpp_inner.vertices.prev=r),this.zpp_inner.vertices=r,n.zpp_inner.weak){var a=n.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var o=n;o.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=o:Ml.poolVec2=o,Ml.nextVec2=o,o.zpp_disp=!0;var _=s;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Mi.zpp_pool,Mi.zpp_pool=_}return this},shift:function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var i=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=i}this.zpp_inner.vertices=n;var t=e;if(null!=t.wrap){t.wrap.zpp_inner._inuse=!1;var l=t.wrap,p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var a=l;a.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=a:Ml.poolVec2=a,Ml.nextVec2=a,a.zpp_disp=!0;var s=r;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Mi.zpp_pool,Mi.zpp_pool=s,t.wrap=null}return t.prev=t.next=null,t.next=ni.zpp_pool,ni.zpp_pool=t,this},skipForward:function(n){if(null!=this.zpp_inner.vertices)if(n>0)for(;n-- >0;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(0>n)for(;0>n++;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},skipBackwards:function(n){return this.skipForward(-n)},erase:function(n){for(;0!=n&&null!=this.zpp_inner.vertices;){var e=this.zpp_inner.vertices;if(n>0){var i;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,i=this.zpp_inner.vertices=null;else{var t=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,i=t}this.zpp_inner.vertices=i,--n}else if(0>n){var l;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,l=null;else{var p=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,l=p}this.zpp_inner.vertices=l,++n}var r=e;if(null!=r.wrap){r.wrap.zpp_inner._inuse=!1;var a=r.wrap,s=a.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null;var _=a;_.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=_:Ml.poolVec2=_,Ml.nextVec2=_,_.zpp_disp=!0;var h=o;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Mi.zpp_pool,Mi.zpp_pool=h,r.wrap=null}r.prev=r.next=null,r.next=ni.zpp_pool,ni.zpp_pool=r}return this},clear:function(){for(;null!=this.zpp_inner.vertices;){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var i=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=i}this.zpp_inner.vertices=n;var t=e;if(null!=t.wrap){t.wrap.zpp_inner._inuse=!1;var l=t.wrap,p=l.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var a=l;a.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=a:Ml.poolVec2=a,Ml.nextVec2=a,a.zpp_disp=!0;var s=r;null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=Mi.zpp_pool,Mi.zpp_pool=s,t.wrap=null}t.prev=t.next=null,t.next=ni.zpp_pool,ni.zpp_pool=t}return this},copy:function(){var n=zn.get(),e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){var l,p=t,r=p.x,a=p.y;null==ni.zpp_pool?l=new ni:(l=ni.zpp_pool,ni.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=r,l.y=a;var s=l;if(null==n.zpp_inner.vertices?n.zpp_inner.vertices=s.prev=s.next=s:(s.prev=n.zpp_inner.vertices,s.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=s,n.zpp_inner.vertices.next=s),n.zpp_inner.vertices=s,(t=t.next)==i)break}return n.skipForward(1)},dispose:function(){this.clear();var n=this;n.zpp_pool=null,null!=Ml.nextGeomPoly?Ml.nextGeomPoly.zpp_pool=n:Ml.poolGeomPoly=n,Ml.nextGeomPoly=n,n.zpp_disp=!0},toString:function(){var n="GeomPoly[",e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){var l=t;if(l!=this.zpp_inner.vertices&&(n+=","),n+="{"+l.x+","+l.y+"}",(t=t.next)==i)break}return n+"]"},area:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var n=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){var l=t;if(n+=l.x*(l.next.y-l.prev.y),(t=t.next)==i)break}var p=.5*n;return 0>p?-p:p},winding:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==me.Winding_UNDEFINED&&(me.internal=!0,me.Winding_UNDEFINED=new Tn,me.internal=!1),me.Winding_UNDEFINED;var n=0,e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){var l=t;if(n+=l.x*(l.next.y-l.prev.y),(t=t.next)==i)break}var p=.5*n;return p>0?(null==me.Winding_CLOCKWISE&&(me.internal=!0,me.Winding_CLOCKWISE=new Tn,me.internal=!1),me.Winding_CLOCKWISE):0==p?(null==me.Winding_UNDEFINED&&(me.internal=!0,me.Winding_UNDEFINED=new Tn,me.internal=!1),me.Winding_UNDEFINED):(null==me.Winding_ANTICLOCKWISE&&(me.internal=!0,me.Winding_ANTICLOCKWISE=new Tn,me.internal=!1),me.Winding_ANTICLOCKWISE)},contains:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.y,p=!1,r=this.zpp_inner.vertices,a=this.zpp_inner.vertices;if(null!=r)for(var s=r;;){var o=s,_=o.prev;if(!(l>o.y&&_.y>=l||l>_.y&&o.y>=l)||o.x>i&&_.x>i||i>o.x+(l-o.y)/(_.y-o.y)*(_.x-o.x)&&(p=!p),(s=s.next)==a)break}var h=p;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return h},isClockwise:function(){var n=this.winding();return null==me.Winding_CLOCKWISE&&(me.internal=!0,me.Winding_CLOCKWISE=new Tn,me.internal=!1),n==me.Winding_CLOCKWISE},isConvex:function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var n=!1,e=!1,i=!0,t=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var r=p,a=r.prev,s=r.next,o=0,_=0;o=s.x-r.x,_=s.y-r.y;var h=0,u=0;h=r.x-a.x,u=r.y-a.y;var x=u*o-h*_;if(x>0?e=!0:0>x&&(n=!0),e&&n){i=!1;break}if((p=p.next)==l)break}return i},isSimple:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||zi.isSimple(this.zpp_inner.vertices)},isMonotone:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||si.isMonotone(this.zpp_inner.vertices)},isDegenerate:function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<y.epsilon},simplify:function(n){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var e=yi.simplify(this.zpp_inner.vertices,n),i=zn.get();return i.zpp_inner.vertices=e,i},simpleDecomposition:function(n){var e=this.zpp_inner.vertices;null==_i.sharedGVList&&(_i.sharedGVList=new ot);for(var i=zi.decompose(e,_i.sharedGVList),t=null==n?new mn:n;null!=i.head;){var l=i.pop_unsafe(),p=zn.get();p.zpp_inner.vertices=l,t.zpp_inner.reverse_flag?t.push(p):t.unshift(p)}return t},monotoneDecomposition:function(n){var e=this.zpp_inner.vertices;null==si.sharedPPoly&&(si.sharedPPoly=new _i);var i=si.decompose(e,si.sharedPPoly);null==_i.sharedGVList&&(_i.sharedGVList=new ot);for(var t=i.extract(_i.sharedGVList),l=null==n?new mn:n;null!=t.head;){var p=t.pop_unsafe(),r=zn.get();r.zpp_inner.vertices=p,l.zpp_inner.reverse_flag?l.push(r):l.unshift(r)}return l},convexDecomposition:function(n,e){null==n&&(n=!1);var i=this.zpp_inner.vertices;null==si.sharedPPoly&&(si.sharedPPoly=new _i);var t=si.decompose(i,si.sharedPPoly);null==_i.sharedPPList&&(_i.sharedPPList=new st);for(var l=t.extract_partitions(_i.sharedPPList),p=null==e?new mn:e;null!=l.head;){var r=l.pop_unsafe();wi.triangulate(r),n&&wi.optimise(r),We.optimise(r),null==_i.sharedGVList&&(_i.sharedGVList=new ot);var a=r.extract(_i.sharedGVList),s=r;for(s.next=_i.zpp_pool,_i.zpp_pool=s;null!=a.head;){var o=a.pop_unsafe(),_=zn.get();_.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(_):p.unshift(_)}}return p},triangularDecomposition:function(n,e){null==n&&(n=!1);var i=this.zpp_inner.vertices;null==si.sharedPPoly&&(si.sharedPPoly=new _i);var t=si.decompose(i,si.sharedPPoly);null==_i.sharedPPList&&(_i.sharedPPList=new st);for(var l=t.extract_partitions(_i.sharedPPList),p=null==e?new mn:e;null!=l.head;){var r=l.pop_unsafe();wi.triangulate(r),n&&wi.optimise(r),null==_i.sharedGVList&&(_i.sharedGVList=new ot);var a=r.extract(_i.sharedGVList),s=r;for(s.next=_i.zpp_pool,_i.zpp_pool=s;null!=a.head;){var o=a.pop_unsafe(),_=zn.get();_.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(_):p.unshift(_)}}return p},inflate:function(n){var e=zn.get(),i=this.winding();null==me.Winding_CLOCKWISE&&(me.internal=!0,me.Winding_CLOCKWISE=new Tn,me.internal=!1),i==me.Winding_CLOCKWISE&&(n=-n);var t=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var r=p,a=r.prev,s=r.next,o=0,_=0,h=0,u=0;o=r.x-a.x,_=r.y-a.y,h=s.x-r.x,u=s.y-r.y;var x=0,d=0,v=0,z=0;x=o,d=_;var c=x*x+d*d,m=1/Math.sqrt(c),y=m;x*=y,d*=y;var f=x;x=-d,d=f;var b=n;x*=b,d*=b,v=h,z=u;var g=v*v+z*z,w=1/Math.sqrt(g),M=w;v*=M,z*=M;var C=v;v=-z,z=C;var k=n;v*=k,z*=k;var O=0,I=0;O=v-x,I=z-d;var S=u*O-h*I,P=0==S?0:S/(u*o-h*_),T=0,A=0;T=r.x+x,A=r.y+d;var E=P;T+=o*E,A+=_*E;var N;if(null==Ml.poolVec2?N=new On:(N=Ml.poolVec2,Ml.poolVec2=N.zpp_pool,N.zpp_pool=null,N.zpp_disp=!1,N==Ml.nextVec2&&(Ml.nextVec2=null)),null==N.zpp_inner){var L;null==Mi.zpp_pool?L=new Mi:(L=Mi.zpp_pool,Mi.zpp_pool=L.next,L.next=null),L.weak=!1,L._immutable=!1,L.x=T,L.y=A,N.zpp_inner=L,N.zpp_inner.outer=N}else{var V=N.zpp_inner;null!=V._isimmutable&&V._isimmutable();var j,D=N.zpp_inner;if(null!=D._validate&&D._validate(),N.zpp_inner.x==T){var F=N.zpp_inner;null!=F._validate&&F._validate(),j=N.zpp_inner.y==A}else j=!1;if(!j){N.zpp_inner.x=T,N.zpp_inner.y=A;var R=N.zpp_inner;null!=R._invalidate&&R._invalidate(R)}}if(N.zpp_inner.weak=!1,e.push(N),(p=p.next)==l)break}return e.skipForward(1)},cut:function(n,e,i,t,l){null==t&&(t=!1),null==i&&(i=!1),null!=this.zpp_inner.vertices&&null!=this.zpp_inner.vertices.next&&this.zpp_inner.vertices.prev!=this.zpp_inner.vertices.next&&zi.isSimple(this.zpp_inner.vertices);var p=Qe.run(this.zpp_inner.vertices,n,e,i,t,l);if(n.zpp_inner.weak){var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}if(e.zpp_inner.weak){var _=e.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var u=e;u.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=u:Ml.poolVec2=u,Ml.nextVec2=u,u.zpp_disp=!0;var x=h;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=Mi.zpp_pool,Mi.zpp_pool=x}return p},transform:function(n){var e=this.zpp_inner.vertices,i=this.zpp_inner.vertices;if(null!=e)for(var t=e;;){var l=t,p=n.zpp_inner.a*l.x+n.zpp_inner.b*l.y+n.zpp_inner.tx;if(l.y=n.zpp_inner.c*l.x+n.zpp_inner.d*l.y+n.zpp_inner.ty,l.x=p,(t=t.next)==i)break}return this},bounds:function(){var n=1e100,e=1e100,i=-1e100,t=-1e100,l=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=l)for(var r=l;;){var a=r;if(n>a.x&&(n=a.x),e>a.y&&(e=a.y),a.x>i&&(i=a.x),a.y>t&&(t=a.y),(r=r.next)==p)break}return new hn(n,e,i-n,t-e)},top:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,t=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var p=l;if(n.y>p.y&&(n=p),(l=l.next)==t)break}if(null==n.wrap){var r,a=n.x,s=n.y;if(null==Ml.poolVec2?r=new On:(r=Ml.poolVec2,Ml.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Ml.nextVec2&&(Ml.nextVec2=null)),null==r.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=a,o.y=s,r.zpp_inner=o,r.zpp_inner.outer=r}else{var _=r.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=r.zpp_inner;if(null!=u._validate&&u._validate(),r.zpp_inner.x==a){var x=r.zpp_inner;null!=x._validate&&x._validate(),h=r.zpp_inner.y==s}else h=!1;if(!h){r.zpp_inner.x=a,r.zpp_inner.y=s;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}return n.wrap},bottom:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,t=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var p=l;if(p.y>n.y&&(n=p),(l=l.next)==t)break}if(null==n.wrap){var r,a=n.x,s=n.y;if(null==Ml.poolVec2?r=new On:(r=Ml.poolVec2,Ml.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Ml.nextVec2&&(Ml.nextVec2=null)),null==r.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=a,o.y=s,r.zpp_inner=o,r.zpp_inner.outer=r}else{var _=r.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=r.zpp_inner;if(null!=u._validate&&u._validate(),r.zpp_inner.x==a){var x=r.zpp_inner;null!=x._validate&&x._validate(),h=r.zpp_inner.y==s}else h=!1;if(!h){r.zpp_inner.x=a,r.zpp_inner.y=s;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}return n.wrap},left:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,t=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var p=l;if(n.x>p.x&&(n=p),(l=l.next)==t)break}if(null==n.wrap){var r,a=n.x,s=n.y;if(null==Ml.poolVec2?r=new On:(r=Ml.poolVec2,Ml.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Ml.nextVec2&&(Ml.nextVec2=null)),null==r.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=a,o.y=s,r.zpp_inner=o,r.zpp_inner.outer=r}else{var _=r.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=r.zpp_inner;if(null!=u._validate&&u._validate(),r.zpp_inner.x==a){var x=r.zpp_inner;null!=x._validate&&x._validate(),h=r.zpp_inner.y==s}else h=!1;if(!h){r.zpp_inner.x=a,r.zpp_inner.y=s;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}return n.wrap},right:function(){var n=this.zpp_inner.vertices,e=this.zpp_inner.vertices.next,t=this.zpp_inner.vertices;if(null!=e)for(var l=e;;){var p=l;if(p.x>n.x&&(n=p),(l=l.next)==t)break}if(null==n.wrap){var r,a=n.x,s=n.y;if(null==Ml.poolVec2?r=new On:(r=Ml.poolVec2,Ml.poolVec2=r.zpp_pool,r.zpp_pool=null,r.zpp_disp=!1,r==Ml.nextVec2&&(Ml.nextVec2=null)),null==r.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=a,o.y=s,r.zpp_inner=o,r.zpp_inner.outer=r}else{var _=r.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=r.zpp_inner;if(null!=u._validate&&u._validate(),r.zpp_inner.x==a){var x=r.zpp_inner;null!=x._validate&&x._validate(),h=r.zpp_inner.y==s}else h=!1;if(!h){r.zpp_inner.x=a,r.zpp_inner.y=s;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}return n.wrap},__class__:zn};var cn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.GeomPolyIterator"]=cn,cn.__name__=["nape","geom","GeomPolyIterator"],cn.get=function(n){var e;if(null==cn.zpp_pool){vl.internal=!0;var i=new cn;vl.internal=!1,e=i}else{var t=cn.zpp_pool;cn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},cn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=cn.zpp_pool,cn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:cn};var mn=function(){this.zpp_inner=null,this.zpp_inner=new vl,this.zpp_inner.outer=this};l["nape.geom.GeomPolyList"]=mn,mn.__name__=["nape","geom","GeomPolyList"],mn.fromArray=function(n){for(var e=new mn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},mn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),cn.get(this)},copy:function(n){null==n&&(n=!1);var e=new mn;this.zpp_inner.valmod();for(var i=cn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=cn.zpp_pool,cn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=cn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=cn.zpp_pool,cn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=cn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=cn.zpp_pool,cn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=cn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=cn.zpp_pool,cn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=cn.zpp_pool,cn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:mn,__properties__:{get_length:"get_length"}};var yn=function(){};l["nape.geom.GeomVertexIterator"]=yn,yn.__name__=["nape","geom","GeomVertexIterator"],yn.prototype={zpp_inner:null,hasNext:function(){var n=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;if(this.zpp_inner.first=!1,!n){var e=this.zpp_inner;e.outer.zpp_inner=null,e.ptr=e.start=null,e.next=ii.zpp_pool,ii.zpp_pool=e}return n},next:function(){var n=this.zpp_inner.ptr;if(null==n.wrap){var e,t=n.x,l=n.y;if(null==Ml.poolVec2?e=new On:(e=Ml.poolVec2,Ml.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Ml.nextVec2&&(Ml.nextVec2=null)),null==e.zpp_inner){var p;null==Mi.zpp_pool?p=new Mi:(p=Mi.zpp_pool,Mi.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=l,e.zpp_inner=p,e.zpp_inner.outer=e}else{var r=e.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==t){var o=e.zpp_inner;null!=o._validate&&o._validate(),a=e.zpp_inner.y==l}else a=!1;if(!a){e.zpp_inner.x=t,e.zpp_inner.y=l;var _=e.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}e.zpp_inner.weak=!1,n.wrap=e,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=i(n,n.modwrap),n.wrap.zpp_inner._validate=i(n,n.getwrap)}var h=n.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,h},__class__:yn};var fn=function(){};l["nape.geom.MarchingSquares"]=fn,fn.__name__=["nape","geom","MarchingSquares"],fn.run=function(n,e,i,t,l,p,r){null==p&&(p=!0),null==t&&(t=2);var a=i.zpp_inner;if(null!=a._validate&&a._validate(),0<i.zpp_inner.x){var s=i.zpp_inner;null!=s._validate&&s._validate(),0>=i.zpp_inner.y}else!0;if(null!=l){var o=l.zpp_inner;if(null!=o._validate&&o._validate(),0<l.zpp_inner.x){var _=l.zpp_inner;null!=_._validate&&_._validate(),0>=l.zpp_inner.y}else!0}else!1;var h=null!=r?r:new mn;if(null==l){var u=e.zpp_inner;null!=u._validate&&u._validate();var x=e.zpp_inner.minx,d=e.zpp_inner;null!=d._validate&&d._validate();var v=e.zpp_inner.miny,z=e.zpp_inner.getmax(),c=z.zpp_inner;null!=c._validate&&c._validate();var m=z.zpp_inner.x,y=e.zpp_inner.getmax(),f=y.zpp_inner;null!=f._validate&&f._validate(),pi.run(n,x,v,m,y.zpp_inner.y,i,t,p,h)}else{var b=e.zpp_inner;null!=b._validate&&b._validate();var g=e.zpp_inner,w=g.maxx-g.minx,M=l.zpp_inner;null!=M._validate&&M._validate();var C=w/l.zpp_inner.x,k=e.zpp_inner;null!=k._validate&&k._validate();var O=e.zpp_inner,I=O.maxy-O.miny,S=l.zpp_inner;null!=S._validate&&S._validate();var P=I/l.zpp_inner.y,T=0|C,A=0|P;T!=C&&++T,A!=P&&++A;for(var E=0,N=T;N>E;){var L=E++,V=e.zpp_inner;null!=V._validate&&V._validate();var j=e.zpp_inner.minx,D=l.zpp_inner;null!=D._validate&&D._validate();var F,R=j+l.zpp_inner.x*L;if(L==T-1){var B=e.zpp_inner.getmax(),G=B.zpp_inner;null!=G._validate&&G._validate(),F=B.zpp_inner.x}else{var Z=l.zpp_inner;null!=Z._validate&&Z._validate(),F=R+l.zpp_inner.x}for(var U=0,q=A;q>U;){var Y=U++,K=e.zpp_inner;null!=K._validate&&K._validate();var W=e.zpp_inner.miny,J=l.zpp_inner;null!=J._validate&&J._validate();var X,H=W+l.zpp_inner.y*Y;if(Y==A-1){var Q=e.zpp_inner.getmax(),$=Q.zpp_inner;null!=$._validate&&$._validate(),X=Q.zpp_inner.y}else{var nn=l.zpp_inner;null!=nn._validate&&nn._validate(),X=H+l.zpp_inner.y}pi.run(n,R,H,F,X,i,t,p,h)}}}if(i.zpp_inner.weak){var en=i.zpp_inner;null!=en._isimmutable&&en._isimmutable();var tn=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var ln=i;ln.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=ln:Ml.poolVec2=ln,Ml.nextVec2=ln,ln.zpp_disp=!0;var pn=tn;null!=pn.outer&&(pn.outer.zpp_inner=null,pn.outer=null),pn._isimmutable=null,pn._validate=null,pn._invalidate=null,pn.next=Mi.zpp_pool,Mi.zpp_pool=pn}if(null!=l&&l.zpp_inner.weak){var rn=l.zpp_inner;null!=rn._isimmutable&&rn._isimmutable();var an=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var sn=l;sn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=sn:Ml.poolVec2=sn,Ml.nextVec2=sn,sn.zpp_disp=!0;var on=an;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on._isimmutable=null,on._validate=null,on._invalidate=null,on.next=Mi.zpp_pool,Mi.zpp_pool=on}return h};var bn=function(n,e,i,t,l,p){null==p&&(p=0),null==l&&(l=0),null==t&&(t=1),null==i&&(i=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner=null,this.zpp_inner=ri.get(),this.zpp_inner.outer=this,this.zpp_inner.a=n;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(),this.zpp_inner.b=e;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(),this.zpp_inner.tx=l;var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(),this.zpp_inner.c=i;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(),this.zpp_inner.d=t;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate(),this.zpp_inner.ty=p;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate()};l["nape.geom.Mat23"]=bn,bn.__name__=["nape","geom","Mat23"],bn.rotation=function(n){var e=Math.cos(n),i=Math.sin(n);return new bn(e,-i,i,e,0,0)},bn.translation=function(n,e){return new bn(1,0,0,1,n,e)},bn.scale=function(n,e){return new bn(n,0,0,e,0,0)},bn.prototype={zpp_inner:null,get_a:function(){return this.zpp_inner.a},set_a:function(n){this.zpp_inner.a=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.a},get_b:function(){return this.zpp_inner.b},set_b:function(n){this.zpp_inner.b=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.b},get_c:function(){return this.zpp_inner.c},set_c:function(n){this.zpp_inner.c=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.c},get_d:function(){return this.zpp_inner.d},set_d:function(n){this.zpp_inner.d=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.d},get_tx:function(){return this.zpp_inner.tx},set_tx:function(n){this.zpp_inner.tx=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.tx},get_ty:function(){return this.zpp_inner.ty},set_ty:function(n){this.zpp_inner.ty=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.ty},copy:function(){return new bn(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},set:function(n){var e=n.zpp_inner;this.zpp_inner.setas(e.a,e.b,e.c,e.d,e.tx,e.ty);var i=this.zpp_inner;return null!=i._invalidate&&i._invalidate(),this},setAs:function(n,e,i,t,l,p){null==p&&(p=0),null==l&&(l=0),null==t&&(t=1),null==i&&(i=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner.setas(n,e,i,t,l,p);var r=this.zpp_inner;return null!=r._invalidate&&r._invalidate(),this},reset:function(){return this.setAs()},get_determinant:function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},singular:function(){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,e=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return 0>e&&(e=-e),n>y.illConditionedThreshold*e},inverse:function(){this.singular();var n=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new bn(this.zpp_inner.d*n,-this.zpp_inner.b*n,-this.zpp_inner.c*n,this.zpp_inner.a*n,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*n,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*n)},transpose:function(){return new bn(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},concat:function(n){var e=n;return new bn(e.zpp_inner.a*this.zpp_inner.a+e.zpp_inner.b*this.zpp_inner.c,e.zpp_inner.a*this.zpp_inner.b+e.zpp_inner.b*this.zpp_inner.d,e.zpp_inner.c*this.zpp_inner.a+e.zpp_inner.d*this.zpp_inner.c,e.zpp_inner.c*this.zpp_inner.b+e.zpp_inner.d*this.zpp_inner.d,e.zpp_inner.a*this.zpp_inner.tx+e.zpp_inner.b*this.zpp_inner.ty+e.zpp_inner.tx,e.zpp_inner.c*this.zpp_inner.tx+e.zpp_inner.d*this.zpp_inner.ty+e.zpp_inner.ty)},transform:function(n,e,i){null==i&&(i=!1),null==e&&(e=!1);var t;if(e){var l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.x*this.zpp_inner.a,r=n.zpp_inner;null!=r._validate&&r._validate();var a=p+n.zpp_inner.y*this.zpp_inner.b,s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.x*this.zpp_inner.c,_=n.zpp_inner;null!=_._validate&&_._validate();var h,u=o+n.zpp_inner.y*this.zpp_inner.d;if(null==Ml.poolVec2?h=new On:(h=Ml.poolVec2,Ml.poolVec2=h.zpp_pool,h.zpp_pool=null,h.zpp_disp=!1,h==Ml.nextVec2&&(Ml.nextVec2=null)),null==h.zpp_inner){var x;null==Mi.zpp_pool?x=new Mi:(x=Mi.zpp_pool,Mi.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=a,x.y=u,h.zpp_inner=x,h.zpp_inner.outer=h}else{var d=h.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v,z=h.zpp_inner;if(null!=z._validate&&z._validate(),h.zpp_inner.x==a){var c=h.zpp_inner;null!=c._validate&&c._validate(),v=h.zpp_inner.y==u}else v=!1;if(!v){h.zpp_inner.x=a,h.zpp_inner.y=u;var m=h.zpp_inner;null!=m._invalidate&&m._invalidate(m)}}h.zpp_inner.weak=i,t=h}else{var y=n.zpp_inner;null!=y._validate&&y._validate();var f=n.zpp_inner.x*this.zpp_inner.a,b=n.zpp_inner;null!=b._validate&&b._validate();var g=f+n.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,w=n.zpp_inner;null!=w._validate&&w._validate();var M=n.zpp_inner.x*this.zpp_inner.c,C=n.zpp_inner;null!=C._validate&&C._validate();var k,O=M+n.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty;if(null==Ml.poolVec2?k=new On:(k=Ml.poolVec2,Ml.poolVec2=k.zpp_pool,k.zpp_pool=null,k.zpp_disp=!1,k==Ml.nextVec2&&(Ml.nextVec2=null)),null==k.zpp_inner){var I;null==Mi.zpp_pool?I=new Mi:(I=Mi.zpp_pool,Mi.zpp_pool=I.next,I.next=null),I.weak=!1,I._immutable=!1,I.x=g,I.y=O,k.zpp_inner=I,k.zpp_inner.outer=k}else{var S=k.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P,T=k.zpp_inner;if(null!=T._validate&&T._validate(),k.zpp_inner.x==g){var A=k.zpp_inner;null!=A._validate&&A._validate(),P=k.zpp_inner.y==O}else P=!1;if(!P){k.zpp_inner.x=g,k.zpp_inner.y=O;var E=k.zpp_inner;null!=E._invalidate&&E._invalidate(E)}}k.zpp_inner.weak=i,t=k}if(n.zpp_inner.weak){var N=n.zpp_inner;null!=N._isimmutable&&N._isimmutable();var L=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var V=n;V.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=V:Ml.poolVec2=V,Ml.nextVec2=V,V.zpp_disp=!0;var j=L;null!=j.outer&&(j.outer.zpp_inner=null,j.outer=null),j._isimmutable=null,j._validate=null,j._invalidate=null,j.next=Mi.zpp_pool,Mi.zpp_pool=j}return t},inverseTransform:function(n,e,i){null==i&&(i=!1),null==e&&(e=!1),this.singular();var t,l=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);if(e){var p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.x*this.zpp_inner.d,a=n.zpp_inner;null!=a._validate&&a._validate();var s=(r-n.zpp_inner.y*this.zpp_inner.b)*l,o=n.zpp_inner;null!=o._validate&&o._validate();var _=n.zpp_inner.y*this.zpp_inner.a,h=n.zpp_inner;null!=h._validate&&h._validate();var u,x=(_-n.zpp_inner.x*this.zpp_inner.c)*l;if(null==Ml.poolVec2?u=new On:(u=Ml.poolVec2,Ml.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Ml.nextVec2&&(Ml.nextVec2=null)),null==u.zpp_inner){var d;null==Mi.zpp_pool?d=new Mi:(d=Mi.zpp_pool,Mi.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=s,d.y=x,u.zpp_inner=d,u.zpp_inner.outer=u}else{var v=u.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=u.zpp_inner;if(null!=c._validate&&c._validate(),u.zpp_inner.x==s){var m=u.zpp_inner;null!=m._validate&&m._validate(),z=u.zpp_inner.y==x}else z=!1;if(!z){u.zpp_inner.x=s,u.zpp_inner.y=x;var y=u.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}u.zpp_inner.weak=i,t=u}else{var f=n.zpp_inner;null!=f._validate&&f._validate();var b=n.zpp_inner.x-this.zpp_inner.tx,g=n.zpp_inner;null!=g._validate&&g._validate();var w,M=n.zpp_inner.y-this.zpp_inner.ty,C=(b*this.zpp_inner.d-M*this.zpp_inner.b)*l,k=(M*this.zpp_inner.a-b*this.zpp_inner.c)*l;if(null==Ml.poolVec2?w=new On:(w=Ml.poolVec2,Ml.poolVec2=w.zpp_pool,w.zpp_pool=null,w.zpp_disp=!1,w==Ml.nextVec2&&(Ml.nextVec2=null)),null==w.zpp_inner){var O;null==Mi.zpp_pool?O=new Mi:(O=Mi.zpp_pool,Mi.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=C,O.y=k,w.zpp_inner=O,w.zpp_inner.outer=w}else{var I=w.zpp_inner;null!=I._isimmutable&&I._isimmutable();var S,P=w.zpp_inner;if(null!=P._validate&&P._validate(),w.zpp_inner.x==C){var T=w.zpp_inner;null!=T._validate&&T._validate(),S=w.zpp_inner.y==k}else S=!1;if(!S){w.zpp_inner.x=C,w.zpp_inner.y=k;var A=w.zpp_inner;null!=A._invalidate&&A._invalidate(A)}}w.zpp_inner.weak=i,t=w}if(n.zpp_inner.weak){var E=n.zpp_inner;null!=E._isimmutable&&E._isimmutable();var N=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var L=n;L.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=L:Ml.poolVec2=L,Ml.nextVec2=L,L.zpp_disp=!0;var V=N;null!=V.outer&&(V.outer.zpp_inner=null,V.outer=null),V._isimmutable=null,V._validate=null,V._invalidate=null,V.next=Mi.zpp_pool,Mi.zpp_pool=V}return t},toString:function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},equiorthogonal:function(){if(this.singular())return!1;var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(y.epsilon>n*n){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return y.epsilon>e*e}return!1},orthogonal:function(){var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(y.epsilon>n*n){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,i=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return y.epsilon>e*e&&y.epsilon>i*i}return!1},equiorthogonalise:function(){if(!this.equiorthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d),i=(n+e)/2;n=i/n,e=i/e;var t=this,l=t.zpp_inner.a*n;t.zpp_inner.a=l;var p=t.zpp_inner;null!=p._invalidate&&p._invalidate();var r=this,a=r.zpp_inner.c*n;r.zpp_inner.c=a;var s=r.zpp_inner;null!=s._invalidate&&s._invalidate();var o=this,_=o.zpp_inner.b*e;o.zpp_inner.b=_;var h=o.zpp_inner;null!=h._invalidate&&h._invalidate();var u=this,x=u.zpp_inner.d*e;u.zpp_inner.d=x;var d=u.zpp_inner;null!=d._invalidate&&d._invalidate();var v=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,z=.25*Math.PI-.5*Math.acos(v/(i*i));this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(z=-z);var c=Math.sin(z),m=Math.cos(z),y=this.zpp_inner.a*m-this.zpp_inner.c*c,f=this.zpp_inner.b*m+this.zpp_inner.d*c,b=this.zpp_inner.c*m+this.zpp_inner.a*c;this.zpp_inner.c=b;var g=this.zpp_inner;null!=g._invalidate&&g._invalidate(),this.zpp_inner.a=y;var w=this.zpp_inner;null!=w._invalidate&&w._invalidate();var M=this.zpp_inner.d*m-this.zpp_inner.b*c;this.zpp_inner.d=M;var C=this.zpp_inner;null!=C._invalidate&&C._invalidate(),this.zpp_inner.b=f;var k=this.zpp_inner;null!=k._invalidate&&k._invalidate();var O=this.zpp_inner;null!=O._invalidate&&O._invalidate()}return this},orthogonalise:function(){if(!this.orthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d);n=1/n,e=1/e;var i=this,t=i.zpp_inner.a*n;i.zpp_inner.a=t;var l=i.zpp_inner;null!=l._invalidate&&l._invalidate();var p=this,r=p.zpp_inner.c*n;p.zpp_inner.c=r;var a=p.zpp_inner;null!=a._invalidate&&a._invalidate();var s=this,o=s.zpp_inner.b*e;s.zpp_inner.b=o;var _=s.zpp_inner;null!=_._invalidate&&_._invalidate();var h=this,u=h.zpp_inner.d*e;h.zpp_inner.d=u;var x=h.zpp_inner;null!=x._invalidate&&x._invalidate();var d=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d,v=.25*Math.PI-.5*Math.acos(d/1);this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(v=-v);var z=Math.sin(v),c=Math.cos(v),m=this.zpp_inner.a*c-this.zpp_inner.c*z,y=this.zpp_inner.b*c+this.zpp_inner.d*z,f=this.zpp_inner.c*c+this.zpp_inner.a*z;this.zpp_inner.c=f;var b=this.zpp_inner;null!=b._invalidate&&b._invalidate(),this.zpp_inner.a=m;var g=this.zpp_inner;null!=g._invalidate&&g._invalidate();var w=this.zpp_inner.d*c-this.zpp_inner.b*z;this.zpp_inner.d=w;var M=this.zpp_inner;null!=M._invalidate&&M._invalidate(),this.zpp_inner.b=y;var C=this.zpp_inner;null!=C._invalidate&&C._invalidate();var k=this.zpp_inner;null!=k._invalidate&&k._invalidate()}return this},__class__:bn,__properties__:{get_determinant:"get_determinant",set_ty:"set_ty",get_ty:"get_ty",set_tx:"set_tx",get_tx:"get_tx",set_d:"set_d",get_d:"get_d",set_c:"set_c",get_c:"get_c",set_b:"set_b",get_b:"get_b",set_a:"set_a",get_a:"get_a"}};var gn=function(n,e){this.zpp_inner=null,this.zpp_inner=new ai(n,e),this.zpp_inner.outer=this};l["nape.geom.MatMN"]=gn,gn.__name__=["nape","geom","MatMN"],gn.prototype={zpp_inner:null,get_rows:function(){return this.zpp_inner.m},get_cols:function(){return this.zpp_inner.n},x:function(n,e){return this.zpp_inner.x[n*this.zpp_inner.n+e]},setx:function(n,e,i){return this.zpp_inner.x[n*this.zpp_inner.n+e]=i},toString:function(){for(var n="{ ",e=!0,i=0,t=this.zpp_inner.m;t>i;){var l=i++;e||(n+="; "),e=!1;for(var p=0,r=this.zpp_inner.n;r>p;){var a=p++;n+=this.zpp_inner.x[l*this.zpp_inner.n+a]+" "}}return n+="}"},transpose:function(){for(var n=new gn(this.zpp_inner.n,this.zpp_inner.m),e=0,i=this.zpp_inner.m;i>e;)for(var t=e++,l=0,p=this.zpp_inner.n;p>l;){var r=l++;n.zpp_inner.x[r*n.zpp_inner.n+t]=this.zpp_inner.x[t*this.zpp_inner.n+r]}return n},mul:function(n){for(var e=n,i=new gn(this.zpp_inner.m,e.zpp_inner.n),t=0,l=this.zpp_inner.m;l>t;)for(var p=t++,r=0,a=e.zpp_inner.n;a>r;){for(var s=r++,o=0,_=0,h=this.zpp_inner.n;h>_;){var u=_++;o+=this.zpp_inner.x[p*this.zpp_inner.n+u]*e.zpp_inner.x[u*e.zpp_inner.n+s]}i.zpp_inner.x[p*i.zpp_inner.n+s]=o}return i},__class__:gn,__properties__:{get_cols:"get_cols",get_rows:"get_rows"}};var wn=function(n,e){this.zpp_inner=null,this.zpp_inner=new hi;var i=this.zpp_inner.origin,t=i.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,s=i.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o,_=i.zpp_inner;if(null!=_._validate&&_._validate(),i.zpp_inner.x==p){var h=i.zpp_inner;null!=h._validate&&h._validate(),o=i.zpp_inner.y==a}else o=!1;if(!o){i.zpp_inner.x=p,i.zpp_inner.y=a;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}if(n.zpp_inner.weak){var x=n.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var v=n;v.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=v:Ml.poolVec2=v,Ml.nextVec2=v,v.zpp_disp=!0;var z=d;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Mi.zpp_pool,Mi.zpp_pool=z}var c=this.zpp_inner.direction,m=c.zpp_inner;null!=m._isimmutable&&m._isimmutable();var y=e.zpp_inner;null!=y._validate&&y._validate();var f=e.zpp_inner.x,b=e.zpp_inner;null!=b._validate&&b._validate();var g=e.zpp_inner.y,w=c.zpp_inner;null!=w._isimmutable&&w._isimmutable();var M,C=c.zpp_inner;if(null!=C._validate&&C._validate(),c.zpp_inner.x==f){var k=c.zpp_inner;null!=k._validate&&k._validate(),M=c.zpp_inner.y==g}else M=!1;if(!M){c.zpp_inner.x=f,c.zpp_inner.y=g;var O=c.zpp_inner;null!=O._invalidate&&O._invalidate(O)}if(e.zpp_inner.weak){var I=e.zpp_inner;null!=I._isimmutable&&I._isimmutable();var S=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var P=e;P.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=P:Ml.poolVec2=P,Ml.nextVec2=P,P.zpp_disp=!0;var T=S;null!=T.outer&&(T.outer.zpp_inner=null,T.outer=null),T._isimmutable=null,T._validate=null,T._invalidate=null,T.next=Mi.zpp_pool,Mi.zpp_pool=T}this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=Infinity};l["nape.geom.Ray"]=wn,wn.__name__=["nape","geom","Ray"],wn.fromSegment=function(n,e){var i=e.sub(n,!0),t=new wn(n,i),l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.y,s=e.zpp_inner;null!=s._validate&&s._validate();var o=e.zpp_inner.x,_=e.zpp_inner;null!=_._validate&&_._validate();var h=0,u=0;h=p-o,u=a-e.zpp_inner.y;var x=Math.sqrt(h*h+u*u);if(t.zpp_inner.maxdist=x,n.zpp_inner.weak){var d=n.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var z=n;z.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=z:Ml.poolVec2=z,Ml.nextVec2=z,z.zpp_disp=!0;var c=v;null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Mi.zpp_pool,Mi.zpp_pool=c}if(e.zpp_inner.weak){var m=e.zpp_inner;null!=m._isimmutable&&m._isimmutable();var y=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var f=e;f.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=f:Ml.poolVec2=f,Ml.nextVec2=f,f.zpp_disp=!0;var b=y;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Mi.zpp_pool,Mi.zpp_pool=b}return t},wn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_origin:function(){return this.zpp_inner.origin},set_origin:function(n){var e=this.zpp_inner.origin,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return this.zpp_inner.origin},get_direction:function(){return this.zpp_inner.direction},set_direction:function(n){var e=this.zpp_inner.direction,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},get_maxDistance:function(){return this.zpp_inner.maxdist},set_maxDistance:function(n){return this.zpp_inner.maxdist=n},aabb:function(){return this.zpp_inner.rayAABB().wrapper()},at:function(n,e){null==e&&(e=!1),this.zpp_inner.validate_dir();var i=this.zpp_inner.origin,t=i.zpp_inner;null!=t._validate&&t._validate();var l=i.zpp_inner.x+n*this.zpp_inner.dirx,p=this.zpp_inner.origin,r=p.zpp_inner;null!=r._validate&&r._validate();var a,s=p.zpp_inner.y+n*this.zpp_inner.diry;if(null==Ml.poolVec2?a=new On:(a=Ml.poolVec2,Ml.poolVec2=a.zpp_pool,a.zpp_pool=null,a.zpp_disp=!1,a==Ml.nextVec2&&(Ml.nextVec2=null)),null==a.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=l,o.y=s,a.zpp_inner=o,a.zpp_inner.outer=a}else{var _=a.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=a.zpp_inner;if(null!=u._validate&&u._validate(),a.zpp_inner.x==l){var x=a.zpp_inner;null!=x._validate&&x._validate(),h=a.zpp_inner.y==s}else h=!1;if(!h){a.zpp_inner.x=l,a.zpp_inner.y=s;var d=a.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}return a.zpp_inner.weak=e,a},copy:function(){var n=new wn(this.zpp_inner.origin,this.zpp_inner.direction),e=this.zpp_inner.maxdist;return n.zpp_inner.maxdist=e,n},__class__:wn,__properties__:{set_maxDistance:"set_maxDistance",get_maxDistance:"get_maxDistance",set_direction:"set_direction",get_direction:"get_direction",set_origin:"set_origin",get_origin:"get_origin",get_userData:"get_userData"}};var Mn=function(){this.zpp_inner=null};l["nape.geom.RayResult"]=Mn,Mn.__name__=["nape","geom","RayResult"],Mn.prototype={zpp_inner:null,get_normal:function(){return this.zpp_inner.normal},get_distance:function(){return this.zpp_inner.toiDistance},get_inner:function(){return this.zpp_inner.inner},get_shape:function(){return this.zpp_inner.shape},dispose:function(){this.zpp_inner.free()},toString:function(){return"{ shape: "+_.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+_.string(this.zpp_inner.inner)+" }"},__class__:Mn,__properties__:{get_shape:"get_shape",get_inner:"get_inner",get_distance:"get_distance",get_normal:"get_normal"}};var Cn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.RayResultIterator"]=Cn,Cn.__name__=["nape","geom","RayResultIterator"],Cn.get=function(n){var e;if(null==Cn.zpp_pool){zl.internal=!0;var i=new Cn;zl.internal=!1,e=i}else{var t=Cn.zpp_pool;Cn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Cn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Cn.zpp_pool,Cn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Cn};var kn=function(){this.zpp_inner=null,this.zpp_inner=new zl,this.zpp_inner.outer=this};l["nape.geom.RayResultList"]=kn,kn.__name__=["nape","geom","RayResultList"],kn.fromArray=function(n){for(var e=new kn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},kn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Cn.get(this)},copy:function(n){null==n&&(n=!1);var e=new kn;this.zpp_inner.valmod();for(var i=Cn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Cn.zpp_pool,Cn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Cn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Cn.zpp_pool,Cn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=Cn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Cn.zpp_pool,Cn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Cn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Cn.zpp_pool,Cn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=Cn.zpp_pool,Cn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:kn,__properties__:{get_length:"get_length"}};var On=function(n,e){null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null;var i;null==Mi.zpp_pool?i=new Mi:(i=Mi.zpp_pool,Mi.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=e,this.zpp_inner=i,this.zpp_inner.outer=this};l["nape.geom.Vec2"]=On,On.__name__=["nape","geom","Vec2"],On.weak=function(n,e){null==e&&(e=0),null==n&&(n=0);var i;if(null==Ml.poolVec2?i=new On:(i=Ml.poolVec2,Ml.poolVec2=i.zpp_pool,i.zpp_pool=null,i.zpp_disp=!1,i==Ml.nextVec2&&(Ml.nextVec2=null)),null==i.zpp_inner){var t;null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=n,t.y=e,i.zpp_inner=t,i.zpp_inner.outer=i}else{var l=i.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p,r=i.zpp_inner;if(null!=r._validate&&r._validate(),i.zpp_inner.x==n){var a=i.zpp_inner;null!=a._validate&&a._validate(),p=i.zpp_inner.y==e}else p=!1;if(!p){i.zpp_inner.x=n,i.zpp_inner.y=e;var s=i.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}return i.zpp_inner.weak=!0,i},On.get=function(n,e,i){null==i&&(i=!1),null==e&&(e=0),null==n&&(n=0);var t;if(null==Ml.poolVec2?t=new On:(t=Ml.poolVec2,Ml.poolVec2=t.zpp_pool,t.zpp_pool=null,t.zpp_disp=!1,t==Ml.nextVec2&&(Ml.nextVec2=null)),null==t.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e,t.zpp_inner=l,t.zpp_inner.outer=t}else{var p=t.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=t.zpp_inner;if(null!=a._validate&&a._validate(),t.zpp_inner.x==n){var s=t.zpp_inner;null!=s._validate&&s._validate(),r=t.zpp_inner.y==e}else r=!1;if(!r){t.zpp_inner.x=n,t.zpp_inner.y=e;var o=t.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}return t.zpp_inner.weak=i,t},On.fromPolar=function(n,e,i){null==i&&(i=!1);var t,l=n*Math.cos(e),p=n*Math.sin(e);if(null==Ml.poolVec2?t=new On:(t=Ml.poolVec2,Ml.poolVec2=t.zpp_pool,t.zpp_pool=null,t.zpp_disp=!1,t==Ml.nextVec2&&(Ml.nextVec2=null)),null==t.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=l,r.y=p,t.zpp_inner=r,t.zpp_inner.outer=t}else{var a=t.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==l){var _=t.zpp_inner;null!=_._validate&&_._validate(),s=t.zpp_inner.y==p}else s=!1;if(!s){t.zpp_inner.x=l,t.zpp_inner.y=p;var h=t.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}return t.zpp_inner.weak=i,t},On.dsq=function(n,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var t=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.y,r=e.zpp_inner;null!=r._validate&&r._validate();var a=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var o=0,_=0;o=t-a,_=p-e.zpp_inner.y;var h=o*o+_*_;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}if(e.zpp_inner.weak){var z=e.zpp_inner;null!=z._isimmutable&&z._isimmutable();var c=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var m=e;m.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=m:Ml.poolVec2=m,Ml.nextVec2=m,m.zpp_disp=!0;var y=c;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Mi.zpp_pool,Mi.zpp_pool=y}return h},On.distance=function(n,e){var i=n.zpp_inner;null!=i._validate&&i._validate();var t=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.y,r=e.zpp_inner;null!=r._validate&&r._validate();var a=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var o=0,_=0;o=t-a,_=p-e.zpp_inner.y;var h=Math.sqrt(o*o+_*_);if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}if(e.zpp_inner.weak){var z=e.zpp_inner;null!=z._isimmutable&&z._isimmutable();var c=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var m=e;m.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=m:Ml.poolVec2=m,Ml.nextVec2=m,m.zpp_disp=!0;var y=c;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Mi.zpp_pool,Mi.zpp_pool=y}return h},On.prototype={zpp_inner:null,zpp_pool:null,zpp_disp:null,dispose:function(){var n=this.zpp_inner;null!=n._isimmutable&&n._isimmutable();var e=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;var i=this;i.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=i:Ml.poolVec2=i,Ml.nextVec2=i,i.zpp_disp=!0;var t=e;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=Mi.zpp_pool,Mi.zpp_pool=t},copy:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var l,p=this.zpp_inner.y;if(null==Ml.poolVec2?l=new On:(l=Ml.poolVec2,Ml.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Ml.nextVec2&&(Ml.nextVec2=null)),null==l.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=p,l.zpp_inner=r,l.zpp_inner.outer=l}else{var a=l.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==i){var _=l.zpp_inner;null!=_._validate&&_._validate(),s=l.zpp_inner.y==p}else s=!1;if(!s){l.zpp_inner.x=i,l.zpp_inner.y=p;var h=l.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}return l.zpp_inner.weak=n,l},get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},set_x:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;if(null!=i._validate&&i._validate(),this.zpp_inner.x!=n){this.zpp_inner.x=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var l=this.zpp_inner;return null!=l._validate&&l._validate(),this.zpp_inner.x},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},set_y:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;if(null!=i._validate&&i._validate(),this.zpp_inner.y!=n){this.zpp_inner.y=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var l=this.zpp_inner;return null!=l._validate&&l._validate(),this.zpp_inner.y},get_length:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var t=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),Math.sqrt(t+p*this.zpp_inner.y)},set_length:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner;null!=t._validate&&t._validate();var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.x,s=this.zpp_inner;null!=s._validate&&s._validate();var o=a*this.zpp_inner.x,_=this.zpp_inner;null!=_._validate&&_._validate();var h=this.zpp_inner.y,u=this.zpp_inner;null!=u._validate&&u._validate();var x=n/Math.sqrt(o+h*this.zpp_inner.y),d=this,v=d.zpp_inner;null!=v._validate&&v._validate();var z=d.zpp_inner.x*x,c=d.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m=d.zpp_inner;if(null!=m._validate&&m._validate(),d.zpp_inner.x!=z){d.zpp_inner.x=z;var y=d.zpp_inner;null!=y._invalidate&&y._invalidate(y)}var f=d.zpp_inner;null!=f._validate&&f._validate();var b=this,g=b.zpp_inner;null!=g._validate&&g._validate();var w=b.zpp_inner.y*x,M=b.zpp_inner;null!=M._isimmutable&&M._isimmutable();var C=b.zpp_inner;if(null!=C._validate&&C._validate(),b.zpp_inner.y!=w){b.zpp_inner.y=w;var k=b.zpp_inner;null!=k._invalidate&&k._invalidate(k)}var O=b.zpp_inner;null!=O._validate&&O._validate();var I=this.zpp_inner;null!=I._invalidate&&I._invalidate(I);var S=this.zpp_inner;null!=S._validate&&S._validate();var P=this.zpp_inner.x,T=this.zpp_inner;null!=T._validate&&T._validate();var A=P*this.zpp_inner.x,E=this.zpp_inner;null!=E._validate&&E._validate();var N=this.zpp_inner.y,L=this.zpp_inner;return null!=L._validate&&L._validate(),Math.sqrt(A+N*this.zpp_inner.y)},lsq:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var t=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),t+p*this.zpp_inner.y},set:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=n.zpp_inner;null!=i._validate&&i._validate();var t=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.y,r=this.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,s=this.zpp_inner;if(null!=s._validate&&s._validate(),this.zpp_inner.x==t){var o=this.zpp_inner;null!=o._validate&&o._validate(),a=this.zpp_inner.y==p}else a=!1;if(!a){this.zpp_inner.x=t,this.zpp_inner.y=p;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate(_)}var h=this;if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return h},setxy:function(n,e){var i=this.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t,l=this.zpp_inner;if(null!=l._validate&&l._validate(),this.zpp_inner.x==n){var p=this.zpp_inner;null!=p._validate&&p._validate(),t=this.zpp_inner.y==e}else t=!1;if(!t){this.zpp_inner.x=n,this.zpp_inner.y=e;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(r)}return this},get_angle:function(){var n,e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=this.zpp_inner;if(null!=t._validate&&t._validate(),i==this.zpp_inner.y){var l=this.zpp_inner;null!=l._validate&&l._validate(),n=0==this.zpp_inner.x}else n=!1;if(n)return 0;var p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner.y,a=this.zpp_inner;return null!=a._validate&&a._validate(),Math.atan2(r,this.zpp_inner.x)},set_angle:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=t*this.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=Math.sqrt(p+a*this.zpp_inner.y),_=o*Math.cos(n),h=o*Math.sin(n),u=this.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x,d=this.zpp_inner;if(null!=d._validate&&d._validate(),this.zpp_inner.x==_){var v=this.zpp_inner;null!=v._validate&&v._validate(),x=this.zpp_inner.y==h}else x=!1;if(!x){this.zpp_inner.x=_,this.zpp_inner.y=h;var z=this.zpp_inner;null!=z._invalidate&&z._invalidate(z)}var c,m=this.zpp_inner;null!=m._validate&&m._validate();var y=this.zpp_inner.x,f=this.zpp_inner;if(null!=f._validate&&f._validate(),y==this.zpp_inner.y){var b=this.zpp_inner;null!=b._validate&&b._validate(),c=0==this.zpp_inner.x}else c=!1;if(c)return 0;var g=this.zpp_inner;null!=g._validate&&g._validate();var w=this.zpp_inner.y,M=this.zpp_inner;return null!=M._validate&&M._validate(),Math.atan2(w,this.zpp_inner.x)},rotate:function(n){var e=this.zpp_inner;if(null!=e._isimmutable&&e._isimmutable(),n%(2*Math.PI)!=0){var i=Math.sin(n),t=Math.cos(n),l=t*this.zpp_inner.x-i*this.zpp_inner.y;this.zpp_inner.y=this.zpp_inner.x*i+this.zpp_inner.y*t,this.zpp_inner.x=l;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate(p)}return this},reflect:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=t*this.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate(),Math.sqrt(p+a*this.zpp_inner.y);var o=this.zpp_inner;null!=o._validate&&o._validate();var _=this.zpp_inner.x,h=this.zpp_inner;null!=h._validate&&h._validate();var u,x=this.zpp_inner.y;if(null==Ml.poolVec2?u=new On:(u=Ml.poolVec2,Ml.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Ml.nextVec2&&(Ml.nextVec2=null)),null==u.zpp_inner){var d;null==Mi.zpp_pool?d=new Mi:(d=Mi.zpp_pool,Mi.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=_,d.y=x,u.zpp_inner=d,u.zpp_inner.outer=u}else{var v=u.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=u.zpp_inner;if(null!=c._validate&&c._validate(),u.zpp_inner.x==_){var m=u.zpp_inner;null!=m._validate&&m._validate(),z=u.zpp_inner.y==x}else z=!1;if(!z){u.zpp_inner.x=_,u.zpp_inner.y=x;var y=u.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}u.zpp_inner.weak=!0;var f=u.normalise(),b=n.sub(f.muleq(2*f.dot(n)),e);if(n.zpp_inner.weak){var g=n.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var M=n;M.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=M:Ml.poolVec2=M,Ml.nextVec2=M,M.zpp_disp=!0;var C=w;null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Mi.zpp_pool,Mi.zpp_pool=C}return b},normalise:function(){var n=this.zpp_inner;null!=n._isimmutable&&n._isimmutable();var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var l=i*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate(),Math.sqrt(l+r*this.zpp_inner.y);var s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.x,_=this.zpp_inner;null!=_._validate&&_._validate();var h=o*this.zpp_inner.x,u=this.zpp_inner;null!=u._validate&&u._validate();var x=this.zpp_inner.y,d=this.zpp_inner;null!=d._validate&&d._validate();var v=h+x*this.zpp_inner.y,z=1/Math.sqrt(v),c=z,m=this,y=m.zpp_inner;null!=y._validate&&y._validate();var f=m.zpp_inner.x*c,b=m.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=m.zpp_inner;if(null!=g._validate&&g._validate(),m.zpp_inner.x!=f){m.zpp_inner.x=f;var w=m.zpp_inner;null!=w._invalidate&&w._invalidate(w)}var M=m.zpp_inner;null!=M._validate&&M._validate();var C=this,k=C.zpp_inner;null!=k._validate&&k._validate();var O=C.zpp_inner.y*c,I=C.zpp_inner;null!=I._isimmutable&&I._isimmutable();var S=C.zpp_inner;if(null!=S._validate&&S._validate(),C.zpp_inner.y!=O){C.zpp_inner.y=O;var P=C.zpp_inner;null!=P._invalidate&&P._invalidate(P)}var T=C.zpp_inner;null!=T._validate&&T._validate();var A=this.zpp_inner;return null!=A._invalidate&&A._invalidate(A),this},unit:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var l=i*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate(),Math.sqrt(l+r*this.zpp_inner.y);var s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.x,_=this.zpp_inner;null!=_._validate&&_._validate();var h=o*this.zpp_inner.x,u=this.zpp_inner;null!=u._validate&&u._validate();var x=this.zpp_inner.y,d=this.zpp_inner;null!=d._validate&&d._validate();var v=1/Math.sqrt(h+x*this.zpp_inner.y),z=this.zpp_inner;null!=z._validate&&z._validate();var c=this.zpp_inner.x*v,m=this.zpp_inner;null!=m._validate&&m._validate();var y,f=this.zpp_inner.y*v;if(null==Ml.poolVec2?y=new On:(y=Ml.poolVec2,Ml.poolVec2=y.zpp_pool,y.zpp_pool=null,y.zpp_disp=!1,y==Ml.nextVec2&&(Ml.nextVec2=null)),null==y.zpp_inner){var b;null==Mi.zpp_pool?b=new Mi:(b=Mi.zpp_pool,Mi.zpp_pool=b.next,b.next=null),b.weak=!1,b._immutable=!1,b.x=c,b.y=f,y.zpp_inner=b,y.zpp_inner.outer=y}else{var g=y.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w,M=y.zpp_inner;if(null!=M._validate&&M._validate(),y.zpp_inner.x==c){var C=y.zpp_inner;null!=C._validate&&C._validate(),w=y.zpp_inner.y==f}else w=!1;if(!w){y.zpp_inner.x=c,y.zpp_inner.y=f;var k=y.zpp_inner;null!=k._invalidate&&k._invalidate(k)}}return y.zpp_inner.weak=n,y},add:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=t+n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o,_=a+n.zpp_inner.y;if(null==Ml.poolVec2?o=new On:(o=Ml.poolVec2,Ml.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Ml.nextVec2&&(Ml.nextVec2=null)),null==o.zpp_inner){var h;null==Mi.zpp_pool?h=new Mi:(h=Mi.zpp_pool,Mi.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=p,h.y=_,o.zpp_inner=h,o.zpp_inner.outer=o}else{var u=o.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x,d=o.zpp_inner;if(null!=d._validate&&d._validate(),o.zpp_inner.x==p){var v=o.zpp_inner;null!=v._validate&&v._validate(),x=o.zpp_inner.y==_}else x=!1;if(!x){o.zpp_inner.x=p,o.zpp_inner.y=_;var z=o.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}o.zpp_inner.weak=e;var c=o;if(n.zpp_inner.weak){var m=n.zpp_inner;null!=m._isimmutable&&m._isimmutable();var y=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var f=n;f.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=f:Ml.poolVec2=f,Ml.nextVec2=f,f.zpp_disp=!0;var b=y;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Mi.zpp_pool,Mi.zpp_pool=b}return c},addMul:function(n,e,i){null==i&&(i=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var l=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=l+n.zpp_inner.x*e,a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var _,h=s+n.zpp_inner.y*e;if(null==Ml.poolVec2?_=new On:(_=Ml.poolVec2,Ml.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==Ml.nextVec2&&(Ml.nextVec2=null)),null==_.zpp_inner){var u;null==Mi.zpp_pool?u=new Mi:(u=Mi.zpp_pool,Mi.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=r,u.y=h,_.zpp_inner=u,_.zpp_inner.outer=_}else{var x=_.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d,v=_.zpp_inner;if(null!=v._validate&&v._validate(),_.zpp_inner.x==r){var z=_.zpp_inner;null!=z._validate&&z._validate(),d=_.zpp_inner.y==h}else d=!1;if(!d){_.zpp_inner.x=r,_.zpp_inner.y=h;var c=_.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}_.zpp_inner.weak=i;var m=_;if(n.zpp_inner.weak){var y=n.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var b=n;b.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=b:Ml.poolVec2=b,Ml.nextVec2=b,b.zpp_disp=!0;var g=f;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Mi.zpp_pool,Mi.zpp_pool=g}return m},sub:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=t-n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o,_=a-n.zpp_inner.y;if(null==Ml.poolVec2?o=new On:(o=Ml.poolVec2,Ml.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Ml.nextVec2&&(Ml.nextVec2=null)),null==o.zpp_inner){var h;null==Mi.zpp_pool?h=new Mi:(h=Mi.zpp_pool,Mi.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=p,h.y=_,o.zpp_inner=h,o.zpp_inner.outer=o}else{var u=o.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x,d=o.zpp_inner;if(null!=d._validate&&d._validate(),o.zpp_inner.x==p){var v=o.zpp_inner;null!=v._validate&&v._validate(),x=o.zpp_inner.y==_}else x=!1;if(!x){o.zpp_inner.x=p,o.zpp_inner.y=_;var z=o.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}o.zpp_inner.weak=e;var c=o;if(n.zpp_inner.weak){var m=n.zpp_inner;null!=m._isimmutable&&m._isimmutable();var y=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var f=n;f.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=f:Ml.poolVec2=f,Ml.nextVec2=f,f.zpp_disp=!0;var b=y;null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=Mi.zpp_pool,Mi.zpp_pool=b}return c},mul:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x*n,l=this.zpp_inner;null!=l._validate&&l._validate();var p,r=this.zpp_inner.y*n;if(null==Ml.poolVec2?p=new On:(p=Ml.poolVec2,Ml.poolVec2=p.zpp_pool,p.zpp_pool=null,p.zpp_disp=!1,p==Ml.nextVec2&&(Ml.nextVec2=null)),null==p.zpp_inner){var a;null==Mi.zpp_pool?a=new Mi:(a=Mi.zpp_pool,Mi.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=t,a.y=r,p.zpp_inner=a,p.zpp_inner.outer=p}else{var s=p.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o,_=p.zpp_inner;if(null!=_._validate&&_._validate(),p.zpp_inner.x==t){var h=p.zpp_inner;null!=h._validate&&h._validate(),o=p.zpp_inner.y==r}else o=!1;if(!o){p.zpp_inner.x=t,p.zpp_inner.y=r;var u=p.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}return p.zpp_inner.weak=e,p},addeq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=t+n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o=a+n.zpp_inner.y,_=this.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=this.zpp_inner;if(null!=u._validate&&u._validate(),this.zpp_inner.x==p){var x=this.zpp_inner;null!=x._validate&&x._validate(),h=this.zpp_inner.y==o}else h=!1;if(!h){this.zpp_inner.x=p,this.zpp_inner.y=o;var d=this.zpp_inner;null!=d._invalidate&&d._invalidate(d)}if(n.zpp_inner.weak){var v=n.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=c:Ml.poolVec2=c,Ml.nextVec2=c,c.zpp_disp=!0;var m=z;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Mi.zpp_pool,Mi.zpp_pool=m}return this},subeq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var p=t-n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var o=a-n.zpp_inner.y,_=this.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=this.zpp_inner;if(null!=u._validate&&u._validate(),this.zpp_inner.x==p){var x=this.zpp_inner;null!=x._validate&&x._validate(),h=this.zpp_inner.y==o}else h=!1;if(!h){this.zpp_inner.x=p,this.zpp_inner.y=o;var d=this.zpp_inner;null!=d._invalidate&&d._invalidate(d)}if(n.zpp_inner.weak){var v=n.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var c=n;c.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=c:Ml.poolVec2=c,Ml.nextVec2=c,c.zpp_disp=!0;var m=z;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Mi.zpp_pool,Mi.zpp_pool=m}return this},muleq:function(n){var e=this.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner.x*n,l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y*n,r=this.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,s=this.zpp_inner;if(null!=s._validate&&s._validate(),this.zpp_inner.x==t){var o=this.zpp_inner;null!=o._validate&&o._validate(),a=this.zpp_inner.y==p}else a=!1;if(!a){this.zpp_inner.x=t,this.zpp_inner.y=p;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate(_)}return this},dot:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();var l=i*n.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate();var s=l+r*n.zpp_inner.y;if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=h:Ml.poolVec2=h,Ml.nextVec2=h,h.zpp_disp=!0;var u=_;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u}return s},cross:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();var l=i*this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.x,a=this.zpp_inner;null!=a._validate&&a._validate();var s=l-r*this.zpp_inner.y;if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=h:Ml.poolVec2=h,Ml.nextVec2=h,h.zpp_disp=!0;var u=_;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u}return s},perp:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=-this.zpp_inner.y,t=this.zpp_inner;null!=t._validate&&t._validate();var l,p=this.zpp_inner.x;if(null==Ml.poolVec2?l=new On:(l=Ml.poolVec2,Ml.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Ml.nextVec2&&(Ml.nextVec2=null)),null==l.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=p,l.zpp_inner=r,l.zpp_inner.outer=l}else{var a=l.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==i){var _=l.zpp_inner;null!=_._validate&&_._validate(),s=l.zpp_inner.y==p}else s=!1;if(!s){l.zpp_inner.x=i,l.zpp_inner.y=p;var h=l.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}return l.zpp_inner.weak=n,l},toString:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),""+this.zpp_inner},__class__:On,__properties__:{set_angle:"set_angle",get_angle:"get_angle",set_length:"set_length",get_length:"get_length",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x"}};var In=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.geom.Vec2Iterator"]=In,In.__name__=["nape","geom","Vec2Iterator"],In.get=function(n){var e;if(null==In.zpp_pool){dl.internal=!0;var i=new In;dl.internal=!1,e=i}else{var t=In.zpp_pool;In.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},In.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,n>this.zpp_i||(this.zpp_next=In.zpp_pool,In.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:In};var Sn=function(){this.zpp_inner=null,this.zpp_inner=new dl,this.zpp_inner.outer=this};l["nape.geom.Vec2List"]=Sn,Sn.__name__=["nape","geom","Vec2List"],Sn.fromArray=function(n){for(var e=new Sn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Sn.prototype={zpp_inner:null,get_length:function(){return this.zpp_gl()},zpp_gl:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},has:function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var e=this.zpp_inner.at_ite.elt;if(null==e.outer){e.outer=new On;var i=e.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,e.outer.zpp_inner=e}return e.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(n=this.zpp_inner.inner.head.elt,null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Mi.zpp_pool,Mi.zpp_pool=e,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,n.outer.zpp_inner=n}var p=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt,null==n.outer){n.outer=new On;var i=n.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{if(n=this.zpp_inner.inner.head.elt,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,n.outer.zpp_inner=n}var p=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},empty:function(){return 0==this.zpp_gl()},iterator:function(){return this.zpp_vm(),In.get(this)},copy:function(n){null==n&&(n=!1);for(var e=new Sn,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(t>i.zpp_i?l=!0:(i.zpp_next=In.zpp_pool,In.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var p,r=i.zpp_inner.at(i.zpp_i++);if(n){var a=r.zpp_inner;null!=a._validate&&a._validate();var s=r.zpp_inner.x,o=r.zpp_inner;null!=o._validate&&o._validate();var _,h=r.zpp_inner.y;if(null==Ml.poolVec2?_=new On:(_=Ml.poolVec2,Ml.poolVec2=_.zpp_pool,_.zpp_pool=null,_.zpp_disp=!1,_==Ml.nextVec2&&(Ml.nextVec2=null)),null==_.zpp_inner){var u;null==Mi.zpp_pool?u=new Mi:(u=Mi.zpp_pool,Mi.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=s,u.y=h,_.zpp_inner=u,_.zpp_inner.outer=_}else{var x=_.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d,v=_.zpp_inner;if(null!=v._validate&&v._validate(),_.zpp_inner.x==s){var z=_.zpp_inner;null!=z._validate&&z._validate(),d=_.zpp_inner.y==h}else d=!1;if(!d){_.zpp_inner.x=s,_.zpp_inner.y=h;var c=_.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}_.zpp_inner.weak=!1,p=_}else p=r;e.push(p)}return e},merge:function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var t;if(i>e.zpp_i?t=!0:(e.zpp_next=In.zpp_pool,In.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||this.add(l)}},toString:function(){for(var n="[",e=!0,i=this.iterator();;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner.zpp_gl();i.zpp_critical=!0;var l;if(t>i.zpp_i?l=!0:(i.zpp_next=In.zpp_pool,In.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var p=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==p?"NULL":""+p,e=!1}return n+"]"},foreach:function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner.zpp_gl();e.zpp_critical=!0;var t;if(i>e.zpp_i?t=!0:(e.zpp_next=In.zpp_pool,In.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(l){e.zpp_next=In.zpp_pool,In.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;e<this.zpp_gl();){var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Sn,__properties__:{get_length:"get_length"}};var Pn=function(n,e,i){null==i&&(i=0),null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new Ci,this.zpp_inner.outer=this,this.zpp_inner.x=n;var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.y=e;var l=this.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.z=i;var p=this.zpp_inner;null!=p._validate&&p._validate()};l["nape.geom.Vec3"]=Pn,Pn.__name__=["nape","geom","Vec3"],Pn.get=function(n,e,i){null==i&&(i=0),null==e&&(e=0),null==n&&(n=0);var t;return null==Ml.poolVec3?t=new Pn:(t=Ml.poolVec3,Ml.poolVec3=t.zpp_pool,t.zpp_pool=null,t.zpp_disp=!1,t==Ml.nextVec3&&(Ml.nextVec3=null)),t.setxyz(n,e,i),t.zpp_inner.immutable=!1,t.zpp_inner._validate=null,t},Pn.prototype={zpp_inner:null,zpp_pool:null,zpp_disp:null,get_x:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},set_x:function(n){this.zpp_inner.x=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},get_y:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},set_y:function(n){this.zpp_inner.y=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},get_z:function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},set_z:function(n){this.zpp_inner.z=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.z},dispose:function(){var n=this;n.zpp_pool=null,null!=Ml.nextVec3?Ml.nextVec3.zpp_pool=n:Ml.poolVec3=n,Ml.nextVec3=n,n.zpp_disp=!0},get_length:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var t=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var a=t+p*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),Math.sqrt(a+o*this.zpp_inner.z)},set_length:function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner;null!=i._validate&&i._validate();var t=this.zpp_inner;null!=t._validate&&t._validate();var l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner;null!=p._validate&&p._validate();var r=this.zpp_inner;null!=r._validate&&r._validate();var a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.x,o=this.zpp_inner;null!=o._validate&&o._validate();var _=s*this.zpp_inner.x,h=this.zpp_inner;null!=h._validate&&h._validate();var u=this.zpp_inner.y,x=this.zpp_inner;null!=x._validate&&x._validate();var d=_+u*this.zpp_inner.y,v=this.zpp_inner;null!=v._validate&&v._validate();var z=this.zpp_inner.z,c=this.zpp_inner;null!=c._validate&&c._validate();var m=n/Math.sqrt(d+z*this.zpp_inner.z),y=m,f=this,b=f.zpp_inner;null!=b._validate&&b._validate(),f.zpp_inner.x=f.zpp_inner.x*y;var g=f.zpp_inner;null!=g._validate&&g._validate();var w=this,M=w.zpp_inner;null!=M._validate&&M._validate(),w.zpp_inner.y=w.zpp_inner.y*y;var C=w.zpp_inner;null!=C._validate&&C._validate();var k=this,O=k.zpp_inner;null!=O._validate&&O._validate(),k.zpp_inner.z=k.zpp_inner.z*m;var I=k.zpp_inner;null!=I._validate&&I._validate();var S=this.zpp_inner;null!=S._validate&&S._validate();var P=this.zpp_inner.x,T=this.zpp_inner;null!=T._validate&&T._validate();var A=P*this.zpp_inner.x,E=this.zpp_inner;null!=E._validate&&E._validate();var N=this.zpp_inner.y,L=this.zpp_inner;null!=L._validate&&L._validate();var V=A+N*this.zpp_inner.y,j=this.zpp_inner;null!=j._validate&&j._validate();var D=this.zpp_inner.z,F=this.zpp_inner;return null!=F._validate&&F._validate(),Math.sqrt(V+D*this.zpp_inner.z)},lsq:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var t=e*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var p=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var a=t+p*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var o=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),a+o*this.zpp_inner.z},set:function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var i=n.zpp_inner.x,t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.y,p=n.zpp_inner;return null!=p._validate&&p._validate(),this.setxyz(i,l,n.zpp_inner.z)},setxyz:function(n,e,i){this.zpp_inner.x=n;var t=this.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.y=e;var l=this.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.z=i;var p=this.zpp_inner;return null!=p._validate&&p._validate(),this},xy:function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var i=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var l,p=this.zpp_inner.y;if(null==Ml.poolVec2?l=new On:(l=Ml.poolVec2,Ml.poolVec2=l.zpp_pool,l.zpp_pool=null,l.zpp_disp=!1,l==Ml.nextVec2&&(Ml.nextVec2=null)),null==l.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=i,r.y=p,l.zpp_inner=r,l.zpp_inner.outer=l}else{var a=l.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=l.zpp_inner;if(null!=o._validate&&o._validate(),l.zpp_inner.x==i){var _=l.zpp_inner;null!=_._validate&&_._validate(),s=l.zpp_inner.y==p}else s=!1;if(!s){l.zpp_inner.x=i,l.zpp_inner.y=p;var h=l.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}return l.zpp_inner.weak=n,l},toString:function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e="{ x: "+this.zpp_inner.x+" y: ",i=this.zpp_inner;null!=i._validate&&i._validate();var t=e+this.zpp_inner.y+" z: ",l=this.zpp_inner;return null!=l._validate&&l._validate(),t+this.zpp_inner.z+" }"},__class__:Pn,__properties__:{set_length:"set_length",get_length:"get_length",set_z:"set_z",get_z:"get_z",set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x"}};var Tn=function(){};l["nape.geom.Winding"]=Tn,Tn.__name__=["nape","geom","Winding"],Tn.__properties__={get_ANTICLOCKWISE:"get_ANTICLOCKWISE",get_CLOCKWISE:"get_CLOCKWISE",get_UNDEFINED:"get_UNDEFINED"},Tn.get_UNDEFINED=function(){return null==me.Winding_UNDEFINED&&(me.internal=!0,me.Winding_UNDEFINED=new Tn,me.internal=!1),me.Winding_UNDEFINED},Tn.get_CLOCKWISE=function(){return null==me.Winding_CLOCKWISE&&(me.internal=!0,me.Winding_CLOCKWISE=new Tn,me.internal=!1),me.Winding_CLOCKWISE},Tn.get_ANTICLOCKWISE=function(){return null==me.Winding_ANTICLOCKWISE&&(me.internal=!0,me.Winding_ANTICLOCKWISE=new Tn,me.internal=!1),me.Winding_ANTICLOCKWISE},Tn.prototype={toString:function(){return null==me.Winding_UNDEFINED&&(me.internal=!0,me.Winding_UNDEFINED=new Tn,me.internal=!1),this==me.Winding_UNDEFINED?"UNDEFINED":(null==me.Winding_CLOCKWISE&&(me.internal=!0,me.Winding_CLOCKWISE=new Tn,me.internal=!1),this==me.Winding_CLOCKWISE?"CLOCKWISE":(null==me.Winding_ANTICLOCKWISE&&(me.internal=!0,me.Winding_ANTICLOCKWISE=new Tn,me.internal=!1),this==me.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},__class__:Tn};var An=function(){this.zpp_inner_i=null};l["nape.phys.Interactor"]=An,An.__name__=["nape","phys","Interactor"],An.prototype={zpp_inner_i:null,get_id:function(){return this.zpp_inner_i.id},get_userData:function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},isShape:function(){return null!=this.zpp_inner_i.ishape},isBody:function(){return null!=this.zpp_inner_i.ibody},isCompound:function(){return null!=this.zpp_inner_i.icompound},get_castShape:function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},get_castBody:function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},get_castCompound:function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},get_group:function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},set_group:function(n){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},get_cbTypes:function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},toString:function(){return""},__class__:An,__properties__:{get_cbTypes:"get_cbTypes",set_group:"set_group",get_group:"get_group",get_castCompound:"get_castCompound",get_castBody:"get_castBody",get_castShape:"get_castShape",get_userData:"get_userData",get_id:"get_id"}};var En=function(n,e){if(this.debugDraw=!0,this.zpp_inner=null,An.zpp_internalAlloc=!0,An.call(this),An.zpp_internalAlloc=!1,this.zpp_inner=new Ii,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,null!=e){var i=e.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.posx=e.zpp_inner.x;var t=e.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.posy=e.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=0;var l;if(null==n?(null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1),l=me.BodyType_DYNAMIC):l=n,this.zpp_inner.immutable_midstep("Body::type"),Ii.types[this.zpp_inner.type]!=l){var p;null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1),l==me.BodyType_DYNAMIC?p=me.id_BodyType_DYNAMIC:(null==me.BodyType_KINEMATIC&&(me.internal=!0,me.BodyType_KINEMATIC=new Vn,me.internal=!1),p=l==me.BodyType_KINEMATIC?me.id_BodyType_KINEMATIC:me.id_BodyType_STATIC),p==me.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,p):this.zpp_inner.type=p}if(null!=e&&e.zpp_inner.weak){var r=e.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}this.zpp_inner_i.insert_cbtype(ce.ANY_BODY.zpp_inner)};l["nape.phys.Body"]=En,En.__name__=["nape","phys","Body"],En.__super__=An,En.prototype=e(An.prototype,{zpp_inner:null,debugDraw:null,get_type:function(){return Ii.types[this.zpp_inner.type]},set_type:function(n){if(this.zpp_inner.immutable_midstep("Body::type"),Ii.types[this.zpp_inner.type]!=n){var e;null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1),n==me.BodyType_DYNAMIC?e=me.id_BodyType_DYNAMIC:(null==me.BodyType_KINEMATIC&&(me.internal=!0,me.BodyType_KINEMATIC=new Vn,me.internal=!1),e=n==me.BodyType_KINEMATIC?me.id_BodyType_KINEMATIC:me.id_BodyType_STATIC),e==me.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,e):this.zpp_inner.type=e}return Ii.types[this.zpp_inner.type]},get_isBullet:function(){return this.zpp_inner.bulletEnabled},set_isBullet:function(n){return this.zpp_inner.bulletEnabled=n},get_disableCCD:function(){return this.zpp_inner.disableCCD},set_disableCCD:function(n){return this.zpp_inner.disableCCD=n},integrate:function(n){if(this.zpp_inner.immutable_midstep("Body::space"),0==n)return this;var e=this.zpp_inner;e.sweepTime=0,e.sweep_angvel=e.angvel;var i=n-e.sweepTime;if(0!=i){e.sweepTime=n;var t=i;if(e.posx+=e.velx*t,e.posy+=e.vely*t,0!=e.angvel){var l=e.sweep_angvel*i;if(e.rot+=l,l*l>1e-4)e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot);else{var p=l*l,r=1-.5*p,a=1-p*p/8,s=(r*e.axisx+l*e.axisy)*a;e.axisy=(r*e.axisy-l*e.axisx)*a,e.axisx=s}}}for(var o=e.shapes.head;null!=o;){var _=o.elt;_.type==me.id_ShapeType_POLYGON&&(_.polygon.invalidate_gverts(),_.polygon.invalidate_gaxi()),_.invalidate_worldCOM(),o=o.next}e.zip_worldCOM=!0,e.zip_axis=!0;for(var h=e.shapes.head;null!=h;){var u=h.elt;u.type==me.id_ShapeType_POLYGON&&(u.polygon.invalidate_gverts(),u.polygon.invalidate_gaxi()),u.invalidate_worldCOM(),h=h.next}return e.zip_worldCOM=!0,e.sweepTime=0,this},isStatic:function(){return this.zpp_inner.type==me.id_BodyType_STATIC},isDynamic:function(){return this.zpp_inner.type==me.id_BodyType_DYNAMIC},isKinematic:function(){return this.zpp_inner.type==me.id_BodyType_KINEMATIC},get_shapes:function(){return this.zpp_inner.wrap_shapes},get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if(this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_arbiters:function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},get_isSleeping:function(){return this.zpp_inner.component.sleeping},get_constraints:function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},copy:function(){return this.zpp_inner.copy()},get_position:function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},set_position:function(n){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var e=this.zpp_inner.wrap_pos,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},get_velocity:function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},set_velocity:function(n){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var e=this.zpp_inner.wrap_vel,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},setVelocityFromTarget:function(n,e,i){var t=1/i;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var l=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var p=n.sub(this.zpp_inner.wrap_pos,!0).muleq(t),r=l.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=p.zpp_inner;null!=a._validate&&a._validate();var s=p.zpp_inner.x,o=p.zpp_inner;null!=o._validate&&o._validate();var _=p.zpp_inner.y,h=l.zpp_inner;null!=h._isimmutable&&h._isimmutable();var u,x=l.zpp_inner;if(null!=x._validate&&x._validate(),l.zpp_inner.x==s){var d=l.zpp_inner;null!=d._validate&&d._validate(),u=l.zpp_inner.y==_}else u=!1;if(!u){l.zpp_inner.x=s,l.zpp_inner.y=_;var v=l.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(p.zpp_inner.weak){var z=p.zpp_inner;null!=z._isimmutable&&z._isimmutable();var c=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var m=p;m.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=m:Ml.poolVec2=m,Ml.nextVec2=m,m.zpp_disp=!0;var y=c;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Mi.zpp_pool,Mi.zpp_pool=y}var f=(e-this.zpp_inner.rot)*t;if(this.zpp_inner.angvel!=f&&(this.zpp_inner.angvel=f,this.zpp_inner.wake()),n.zpp_inner.weak){var b=n.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var w=n;w.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=w:Ml.poolVec2=w,Ml.nextVec2=w,w.zpp_disp=!0;var M=g;null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=Mi.zpp_pool,Mi.zpp_pool=M}return this},get_kinematicVel:function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},set_kinematicVel:function(n){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var e=this.zpp_inner.wrap_kinvel,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},get_surfaceVel:function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},set_surfaceVel:function(n){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var e=this.zpp_inner.wrap_svel,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},get_force:function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},set_force:function(n){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var e=this.zpp_inner.wrap_force,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},get_constraintVelocity:function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},get_rotation:function(){return this.zpp_inner.rot},set_rotation:function(n){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=n){this.zpp_inner.rot=n;var e=this.zpp_inner;e.zip_axis=!0;for(var i=e.shapes.head;null!=i;){var t=i.elt;t.type==me.id_ShapeType_POLYGON&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),i=i.next}e.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},get_angularVel:function(){return this.zpp_inner.angvel},set_angularVel:function(n){return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),this.zpp_inner.angvel},get_kinAngVel:function(){return this.zpp_inner.kinangvel},set_kinAngVel:function(n){return this.zpp_inner.kinangvel!=n&&(this.zpp_inner.kinangvel=n,this.zpp_inner.wake()),this.zpp_inner.kinangvel},get_torque:function(){return this.zpp_inner.torque},set_torque:function(n){return this.zpp_inner.torque!=n&&(this.zpp_inner.torque=n,this.zpp_inner.wake()),this.zpp_inner.torque},get_bounds:function(){return this.zpp_inner.aabb.wrapper()},get_allowMovement:function(){return!this.zpp_inner.nomove},set_allowMovement:function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.nomove!=n&&(this.zpp_inner.nomove=!n,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},get_allowRotation:function(){return!this.zpp_inner.norotate},set_allowRotation:function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.norotate!=n&&(this.zpp_inner.norotate=!n,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},get_massMode:function(){null==me.MassMode_DEFAULT&&(me.internal=!0,me.MassMode_DEFAULT=new qn,me.internal=!1);var n=me.MassMode_DEFAULT;return null==me.MassMode_FIXED&&(me.internal=!0,me.MassMode_FIXED=new qn,me.internal=!1),[n,me.MassMode_FIXED][this.zpp_inner.massMode]},set_massMode:function(n){this.zpp_inner.immutable_midstep("Body::massMode");var e;null==me.MassMode_DEFAULT&&(me.internal=!0,me.MassMode_DEFAULT=new qn,me.internal=!1),e=n==me.MassMode_DEFAULT?me.id_MassMode_DEFAULT:me.id_MassMode_FIXED,this.zpp_inner.massMode=e,this.zpp_inner.invalidate_mass(),null==me.MassMode_DEFAULT&&(me.internal=!0,me.MassMode_DEFAULT=new qn,me.internal=!1);var i=me.MassMode_DEFAULT;return null==me.MassMode_FIXED&&(me.internal=!0,me.MassMode_FIXED=new qn,me.internal=!1),[i,me.MassMode_FIXED][this.zpp_inner.massMode]},get_constraintMass:function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},get_mass:function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},set_mass:function(n){return this.zpp_inner.immutable_midstep("Body::mass"),Infinity,this.zpp_inner.massMode=me.id_MassMode_FIXED,this.zpp_inner.cmass=n,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},get_gravMassMode:function(){null==me.GravMassMode_DEFAULT&&(me.internal=!0,me.GravMassMode_DEFAULT=new Bn,me.internal=!1);var n=me.GravMassMode_DEFAULT;null==me.GravMassMode_FIXED&&(me.internal=!0,me.GravMassMode_FIXED=new Bn,me.internal=!1);var e=me.GravMassMode_FIXED;return null==me.GravMassMode_SCALED&&(me.internal=!0,me.GravMassMode_SCALED=new Bn,me.internal=!1),[n,e,me.GravMassMode_SCALED][this.zpp_inner.massMode]},set_gravMassMode:function(n){this.zpp_inner.immutable_midstep("Body::gravMassMode");var e;null==me.GravMassMode_SCALED&&(me.internal=!0,me.GravMassMode_SCALED=new Bn,me.internal=!1),n==me.GravMassMode_SCALED?e=me.id_GravMassMode_SCALED:(null==me.GravMassMode_DEFAULT&&(me.internal=!0,me.GravMassMode_DEFAULT=new Bn,me.internal=!1),e=n==me.GravMassMode_DEFAULT?me.id_GravMassMode_DEFAULT:me.id_GravMassMode_FIXED),this.zpp_inner.gravMassMode=e,this.zpp_inner.invalidate_gravMass(),null==me.GravMassMode_DEFAULT&&(me.internal=!0,me.GravMassMode_DEFAULT=new Bn,me.internal=!1);var i=me.GravMassMode_DEFAULT;null==me.GravMassMode_FIXED&&(me.internal=!0,me.GravMassMode_FIXED=new Bn,me.internal=!1);var t=me.GravMassMode_FIXED;return null==me.GravMassMode_SCALED&&(me.internal=!0,me.GravMassMode_SCALED=new Bn,me.internal=!1),[i,t,me.GravMassMode_SCALED][this.zpp_inner.massMode]},get_gravMass:function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},set_gravMass:function(n){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=me.id_GravMassMode_FIXED,this.zpp_inner.gravMass=n,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},get_gravMassScale:function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},set_gravMassScale:function(n){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=me.id_GravMassMode_SCALED,this.zpp_inner.gravMassScale=n,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},get_inertiaMode:function(){null==me.InertiaMode_DEFAULT&&(me.internal=!0,me.InertiaMode_DEFAULT=new Gn,me.internal=!1);var n=me.InertiaMode_DEFAULT;return null==me.InertiaMode_FIXED&&(me.internal=!0,me.InertiaMode_FIXED=new Gn,me.internal=!1),[n,me.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},set_inertiaMode:function(n){this.zpp_inner.immutable_midstep("Body::inertiaMode");var e;null==me.InertiaMode_FIXED&&(me.internal=!0,me.InertiaMode_FIXED=new Gn,me.internal=!1),e=n==me.InertiaMode_FIXED?me.id_InertiaMode_FIXED:me.id_InertiaMode_DEFAULT,this.zpp_inner.inertiaMode=e,this.zpp_inner.invalidate_inertia(),null==me.InertiaMode_DEFAULT&&(me.internal=!0,me.InertiaMode_DEFAULT=new Gn,me.internal=!1);var i=me.InertiaMode_DEFAULT;return null==me.InertiaMode_FIXED&&(me.internal=!0,me.InertiaMode_FIXED=new Gn,me.internal=!1),[i,me.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},get_constraintInertia:function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},get_inertia:function(){this.zpp_inner.validate_inertia();if(this.zpp_inner.inertiaMode==me.id_InertiaMode_DEFAULT){null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head}else!1;return this.zpp_inner.cinertia},set_inertia:function(n){this.zpp_inner.immutable_midstep("Body::inertia"),Infinity,this.zpp_inner.inertiaMode=me.id_InertiaMode_FIXED,this.zpp_inner.cinertia=n,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia();if(this.zpp_inner.inertiaMode==me.id_InertiaMode_DEFAULT){null==this.zpp_inner.wrap_shapes.zpp_inner.inner.head}else!1;return this.zpp_inner.cinertia},connectedBodies:function(n,e){return null==n&&(n=-1),this.zpp_inner.connectedBodies(n,e)},interactingBodies:function(n,e,i){null==e&&(e=-1);var t;return null==n?t=Ve.COL|Ve.SENSOR|Ve.FLUID:(null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),n==me.InteractionType_COLLISION?t=Ve.COL:(null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),t=n==me.InteractionType_SENSOR?Ve.SENSOR:Ve.FLUID)),this.zpp_inner.interactingBodies(t,e,i)},crushFactor:function(){var n,e=0;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var i;null==Mi.zpp_pool?i=new Mi:(i=Mi.zpp_pool,Mi.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=0,i.y=0,n.zpp_inner=i,n.zpp_inner.outer=n}else{var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1;var s=n;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var o=this.zpp_inner.wrap_arbiters.iterator();;){o.zpp_inner.zpp_inner.valmod();var _=o.zpp_inner.zpp_gl();o.zpp_critical=!0;var h;if(_>o.zpp_i?h=!0:(o.zpp_next=Q.zpp_pool,Q.zpp_pool=o,o.zpp_inner=null,h=!1),!h)break;o.zpp_critical=!1;var u=o.zpp_inner.at(o.zpp_i++),x=u.totalImpulse(this),d=x.xy();s.addeq(d);var v=d.zpp_inner;null!=v._validate&&v._validate();var z=d.zpp_inner.x,c=d.zpp_inner;null!=c._validate&&c._validate();var m=z*d.zpp_inner.x,y=d.zpp_inner;null!=y._validate&&y._validate();var f=d.zpp_inner.y,b=d.zpp_inner;null!=b._validate&&b._validate(),e+=Math.sqrt(m+f*d.zpp_inner.y);var g=d.zpp_inner;null!=g._isimmutable&&g._isimmutable();var w=d.zpp_inner;d.zpp_inner.outer=null,d.zpp_inner=null;var M=d;M.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=M:Ml.poolVec2=M,Ml.nextVec2=M,M.zpp_disp=!0;var C=w;null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=Mi.zpp_pool,Mi.zpp_pool=C,x.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=sl.get(this.zpp_inner.constraints,!0));var k=this.zpp_inner.wrap_constraints;k.zpp_inner.valmod();for(var O=G.get(k);;){O.zpp_inner.zpp_inner.valmod();var I=O.zpp_inner;I.zpp_inner.valmod(),I.zpp_inner.zip_length&&(I.zpp_inner.zip_length=!1,I.zpp_inner.user_length=I.zpp_inner.inner.length);var S=I.zpp_inner.user_length;O.zpp_critical=!0;var P;if(S>O.zpp_i?P=!0:(O.zpp_next=G.zpp_pool,G.zpp_pool=O,O.zpp_inner=null,P=!1),!P)break;O.zpp_critical=!1;var T=O.zpp_inner.at(O.zpp_i++),A=T.bodyImpulse(this),E=A.xy();s.addeq(E);var N=E.zpp_inner;null!=N._validate&&N._validate();var L=E.zpp_inner.x,V=E.zpp_inner;null!=V._validate&&V._validate();var j=L*E.zpp_inner.x,D=E.zpp_inner;null!=D._validate&&D._validate();var F=E.zpp_inner.y,R=E.zpp_inner;null!=R._validate&&R._validate(),e+=Math.sqrt(j+F*E.zpp_inner.y);var B=E.zpp_inner;null!=B._isimmutable&&B._isimmutable();var Z=E.zpp_inner;E.zpp_inner.outer=null,E.zpp_inner=null;var U=E;U.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=U:Ml.poolVec2=U,Ml.nextVec2=U,U.zpp_disp=!0;var q=Z;null!=q.outer&&(q.outer.zpp_inner=null,q.outer=null),q._isimmutable=null,q._validate=null,q._invalidate=null,q.next=Mi.zpp_pool,Mi.zpp_pool=q,A.dispose()}var Y=s.zpp_inner;null!=Y._validate&&Y._validate();var K=s.zpp_inner.x,W=s.zpp_inner;null!=W._validate&&W._validate();var J=K*s.zpp_inner.x,X=s.zpp_inner;null!=X._validate&&X._validate();var H=s.zpp_inner.y,$=s.zpp_inner;null!=$._validate&&$._validate();var nn=e-Math.sqrt(J+H*s.zpp_inner.y);this.zpp_inner.validate_mass();var en=nn/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),tn=s.zpp_inner;null!=tn._isimmutable&&tn._isimmutable();var ln=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var pn=s;pn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=pn:Ml.poolVec2=pn,Ml.nextVec2=pn,pn.zpp_disp=!0;var rn=ln;return null!=rn.outer&&(rn.outer.zpp_inner=null,rn.outer=null),rn._isimmutable=null,rn._validate=null,rn._invalidate=null,rn.next=Mi.zpp_pool,Mi.zpp_pool=rn,en},localPointToWorld:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var t=0,l=0,p=this.zpp_inner.axisy,r=n.zpp_inner;null!=r._validate&&r._validate();var a=p*n.zpp_inner.x,s=this.zpp_inner.axisx,o=n.zpp_inner;null!=o._validate&&o._validate(),t=a-s*n.zpp_inner.y;var _=n.zpp_inner;null!=_._validate&&_._validate();var h=n.zpp_inner.x*this.zpp_inner.axisx,u=n.zpp_inner;if(null!=u._validate&&u._validate(),l=h+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var x=n.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var v=n;v.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=v:Ml.poolVec2=v,Ml.nextVec2=v,v.zpp_disp=!0;var z=d;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Mi.zpp_pool,Mi.zpp_pool=z}var c,m=t+this.zpp_inner.posx,y=l+this.zpp_inner.posy;if(null==Ml.poolVec2?c=new On:(c=Ml.poolVec2,Ml.poolVec2=c.zpp_pool,c.zpp_pool=null,c.zpp_disp=!1,c==Ml.nextVec2&&(Ml.nextVec2=null)),null==c.zpp_inner){var f;null==Mi.zpp_pool?f=new Mi:(f=Mi.zpp_pool,Mi.zpp_pool=f.next,f.next=null),f.weak=!1,f._immutable=!1,f.x=m,f.y=y,c.zpp_inner=f,c.zpp_inner.outer=c}else{var b=c.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g,w=c.zpp_inner;if(null!=w._validate&&w._validate(),c.zpp_inner.x==m){var M=c.zpp_inner;null!=M._validate&&M._validate(),g=c.zpp_inner.y==y}else g=!1;if(!g){c.zpp_inner.x=m,c.zpp_inner.y=y;var C=c.zpp_inner;null!=C._invalidate&&C._invalidate(C)}}return c.zpp_inner.weak=e,c},worldPointToLocal:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var t=0,l=0,p=0,r=0,a=n.zpp_inner;null!=a._validate&&a._validate(),p=n.zpp_inner.x-this.zpp_inner.posx;var s=n.zpp_inner;if(null!=s._validate&&s._validate(),r=n.zpp_inner.y-this.zpp_inner.posy,t=p*this.zpp_inner.axisy+r*this.zpp_inner.axisx,l=r*this.zpp_inner.axisy-p*this.zpp_inner.axisx,n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=h:Ml.poolVec2=h,Ml.nextVec2=h,h.zpp_disp=!0;var u=_;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u}var x;if(null==Ml.poolVec2?x=new On:(x=Ml.poolVec2,Ml.poolVec2=x.zpp_pool,x.zpp_pool=null,x.zpp_disp=!1,x==Ml.nextVec2&&(Ml.nextVec2=null)),null==x.zpp_inner){var d;null==Mi.zpp_pool?d=new Mi:(d=Mi.zpp_pool,Mi.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=t,d.y=l,x.zpp_inner=d,x.zpp_inner.outer=x}else{var v=x.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=x.zpp_inner;if(null!=c._validate&&c._validate(),x.zpp_inner.x==t){var m=x.zpp_inner;null!=m._validate&&m._validate(),z=x.zpp_inner.y==l}else z=!1;if(!z){x.zpp_inner.x=t,x.zpp_inner.y=l;var y=x.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}return x.zpp_inner.weak=e,x},localVectorToWorld:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var t=0,l=0,p=this.zpp_inner.axisy,r=n.zpp_inner;null!=r._validate&&r._validate();var a=p*n.zpp_inner.x,s=this.zpp_inner.axisx,o=n.zpp_inner;null!=o._validate&&o._validate(),t=a-s*n.zpp_inner.y;var _=n.zpp_inner;null!=_._validate&&_._validate();var h=n.zpp_inner.x*this.zpp_inner.axisx,u=n.zpp_inner;if(null!=u._validate&&u._validate(),l=h+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var x=n.zpp_inner;null!=x._isimmutable&&x._isimmutable();var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var v=n;v.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=v:Ml.poolVec2=v,Ml.nextVec2=v,v.zpp_disp=!0;var z=d;null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=Mi.zpp_pool,Mi.zpp_pool=z}var c;if(null==Ml.poolVec2?c=new On:(c=Ml.poolVec2,Ml.poolVec2=c.zpp_pool,c.zpp_pool=null,c.zpp_disp=!1,c==Ml.nextVec2&&(Ml.nextVec2=null)),null==c.zpp_inner){var m;null==Mi.zpp_pool?m=new Mi:(m=Mi.zpp_pool,Mi.zpp_pool=m.next,m.next=null),m.weak=!1,m._immutable=!1,m.x=t,m.y=l,c.zpp_inner=m,c.zpp_inner.outer=c}else{var y=c.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f,b=c.zpp_inner;if(null!=b._validate&&b._validate(),c.zpp_inner.x==t){var g=c.zpp_inner;null!=g._validate&&g._validate(),f=c.zpp_inner.y==l}else f=!1;if(!f){c.zpp_inner.x=t,c.zpp_inner.y=l;var w=c.zpp_inner;null!=w._invalidate&&w._invalidate(w)}}return c.zpp_inner.weak=e,c},worldVectorToLocal:function(n,e){null==e&&(e=!1);var i=this.zpp_inner;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));var t=0,l=0,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.x*this.zpp_inner.axisy,a=n.zpp_inner;null!=a._validate&&a._validate(),t=r+n.zpp_inner.y*this.zpp_inner.axisx;var s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.y*this.zpp_inner.axisy,_=n.zpp_inner;if(null!=_._validate&&_._validate(),l=o-n.zpp_inner.x*this.zpp_inner.axisx,n.zpp_inner.weak){var h=n.zpp_inner;null!=h._isimmutable&&h._isimmutable();var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var x=n;x.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=x:Ml.poolVec2=x,Ml.nextVec2=x,x.zpp_disp=!0;var d=u;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=Mi.zpp_pool,Mi.zpp_pool=d}var v;if(null==Ml.poolVec2?v=new On:(v=Ml.poolVec2,Ml.poolVec2=v.zpp_pool,v.zpp_pool=null,v.zpp_disp=!1,v==Ml.nextVec2&&(Ml.nextVec2=null)),null==v.zpp_inner){var z;null==Mi.zpp_pool?z=new Mi:(z=Mi.zpp_pool,Mi.zpp_pool=z.next,z.next=null),z.weak=!1,z._immutable=!1,z.x=t,z.y=l,v.zpp_inner=z,v.zpp_inner.outer=v}else{var c=v.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m,y=v.zpp_inner;if(null!=y._validate&&y._validate(),v.zpp_inner.x==t){var f=v.zpp_inner;null!=f._validate&&f._validate(),m=v.zpp_inner.y==l}else m=!1;if(!m){v.zpp_inner.x=t,v.zpp_inner.y=l;var b=v.zpp_inner;null!=b._invalidate&&b._invalidate(b)}}return v.zpp_inner.weak=e,v},applyImpulse:function(n,e,i){null==i&&(i=!1);if(!!i&&this.zpp_inner.component.sleeping){if(n.zpp_inner.weak){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=p:Ml.poolVec2=p,Ml.nextVec2=p,p.zpp_disp=!0;var r=l;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r}if(null!=e&&e.zpp_inner.weak){var a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var o=e;o.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=o:Ml.poolVec2=o,Ml.nextVec2=o,o.zpp_disp=!0;var _=s;null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=Mi.zpp_pool,Mi.zpp_pool=_}return this}this.zpp_inner.validate_mass();var h=this.zpp_inner.imass,u=this.zpp_inner,x=u.velx,d=n.zpp_inner;null!=d._validate&&d._validate(),u.velx=x+n.zpp_inner.x*h;var v=this.zpp_inner,z=v.vely,c=n.zpp_inner;if(null!=c._validate&&c._validate(),v.vely=z+n.zpp_inner.y*h,null!=e){var m=0,y=0,f=e.zpp_inner;null!=f._validate&&f._validate(),m=e.zpp_inner.x-this.zpp_inner.posx;var b=e.zpp_inner;null!=b._validate&&b._validate(),y=e.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia();var g=this.zpp_inner,w=g.angvel,M=n.zpp_inner;null!=M._validate&&M._validate();var C=n.zpp_inner.y*m,k=n.zpp_inner;if(null!=k._validate&&k._validate(),g.angvel=w+(C-n.zpp_inner.x*y)*this.zpp_inner.iinertia,e.zpp_inner.weak){var O=e.zpp_inner;null!=O._isimmutable&&O._isimmutable();var I=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var S=e;S.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=S:Ml.poolVec2=S,Ml.nextVec2=S,S.zpp_disp=!0;var P=I;null!=P.outer&&(P.outer.zpp_inner=null,P.outer=null),P._isimmutable=null,P._validate=null,P._invalidate=null,P.next=Mi.zpp_pool,Mi.zpp_pool=P}}if(i||this.zpp_inner.type==me.id_BodyType_DYNAMIC&&this.zpp_inner.wake(),n.zpp_inner.weak){var T=n.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var E=n;E.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=E:Ml.poolVec2=E,Ml.nextVec2=E,E.zpp_disp=!0;var N=A;null!=N.outer&&(N.outer.zpp_inner=null,N.outer=null),N._isimmutable=null,N._validate=null,N._invalidate=null,N.next=Mi.zpp_pool,Mi.zpp_pool=N}return this},applyAngularImpulse:function(n,e){null==e&&(e=!1);return!!e&&this.zpp_inner.component.sleeping?this:(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=n*this.zpp_inner.iinertia,e||this.zpp_inner.type==me.id_BodyType_DYNAMIC&&this.zpp_inner.wake(),this)},translateShapes:function(n){this.zpp_inner.immutable_midstep("Body::translateShapes()");var e=n.zpp_inner.weak;n.zpp_inner.weak=!1;for(var i=this.zpp_inner.shapes.head;null!=i;){i.elt.outer.translate(n),i=i.next}if(n.zpp_inner.weak=e){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=p:Ml.poolVec2=p,Ml.nextVec2=p,p.zpp_disp=!0;var r=l;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r}return this},rotateShapes:function(n){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;){e.elt.outer.rotate(n),e=e.next}return this},scaleShapes:function(n,e){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var i=this.zpp_inner.shapes.head;null!=i;){i.elt.outer.scale(n,e),i=i.next}return this},transformShapes:function(n){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;){e.elt.outer.transform(n),e=e.next}return this},align:function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var n,e=-this.zpp_inner.localCOMx,i=-this.zpp_inner.localCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var t;null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=e,t.y=i,n.zpp_inner=t,n.zpp_inner.outer=n}else{var l=n.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==e){var a=n.zpp_inner;null!=a._validate&&a._validate(),p=n.zpp_inner.y==i}else p=!1;if(!p){n.zpp_inner.x=e,n.zpp_inner.y=i;var s=n.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}n.zpp_inner.weak=!1;var o=n;this.translateShapes(o);var _=this.localVectorToWorld(o);if(null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(_),this.zpp_inner.pre_posx<Infinity){var h=this.zpp_inner,u=h.pre_posx,x=_.zpp_inner;null!=x._validate&&x._validate(),h.pre_posx=u-1*_.zpp_inner.x;var d=this.zpp_inner,v=d.pre_posy,z=_.zpp_inner;null!=z._validate&&z._validate(),d.pre_posy=v-1*_.zpp_inner.y}var c=o.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null;var y=o;y.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=y:Ml.poolVec2=y,Ml.nextVec2=y,y.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Mi.zpp_pool,Mi.zpp_pool=f;var b=_.zpp_inner;null!=b._isimmutable&&b._isimmutable();var g=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null;var w=_;w.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=w:Ml.poolVec2=w,Ml.nextVec2=w,w.zpp_disp=!0;var M=g;return null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=Mi.zpp_pool,Mi.zpp_pool=M,this},rotate:function(n,e){var i=n.zpp_inner.weak;n.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var t=this.zpp_inner.wrap_pos.sub(n);t.rotate(e);var l=n.add(t,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var p=this.zpp_inner.wrap_pos,r=p.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=l.zpp_inner;null!=a._validate&&a._validate();var s=l.zpp_inner.x,o=l.zpp_inner;null!=o._validate&&o._validate();var _=l.zpp_inner.y,h=p.zpp_inner;null!=h._isimmutable&&h._isimmutable();var u,x=p.zpp_inner;if(null!=x._validate&&x._validate(),p.zpp_inner.x==s){var d=p.zpp_inner;null!=d._validate&&d._validate(),u=p.zpp_inner.y==_}else u=!1;if(!u){p.zpp_inner.x=s,p.zpp_inner.y=_;var v=p.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(l.zpp_inner.weak){var z=l.zpp_inner;null!=z._isimmutable&&z._isimmutable();var c=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null;var m=l;m.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=m:Ml.poolVec2=m,Ml.nextVec2=m,m.zpp_disp=!0;var y=c;null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=Mi.zpp_pool,Mi.zpp_pool=y}null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var f=t.zpp_inner;null!=f._isimmutable&&f._isimmutable();var b=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null;var g=t;g.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=g:Ml.poolVec2=g,Ml.nextVec2=g,g.zpp_disp=!0;var w=b;null!=w.outer&&(w.outer.zpp_inner=null,w.outer=null),w._isimmutable=null,w._validate=null,w._invalidate=null,w.next=Mi.zpp_pool,Mi.zpp_pool=w;var M=this,C=M.zpp_inner.rot+e;if(M.zpp_inner.immutable_midstep("Body::rotation"),M.zpp_inner.rot!=C){M.zpp_inner.rot=C;var k=M.zpp_inner;k.zip_axis=!0;for(var O=k.shapes.head;null!=O;){var I=O.elt;I.type==me.id_ShapeType_POLYGON&&(I.polygon.invalidate_gverts(),I.polygon.invalidate_gaxi()),I.invalidate_worldCOM(),O=O.next}k.zip_worldCOM=!0,M.zpp_inner.wake()}if(n.zpp_inner.weak=i){var S=n.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var T=n;T.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=T:Ml.poolVec2=T,Ml.nextVec2=T,T.zpp_disp=!0;var A=P;null!=A.outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=Mi.zpp_pool,Mi.zpp_pool=A}return this},setShapeMaterials:function(n){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt,t=i.outer;t.zpp_inner.immutable_midstep("Shape::material"),t.zpp_inner.setMaterial(n.zpp_inner),t.zpp_inner.material.wrapper(),e=e.next}return this},setShapeFilters:function(n){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt,t=i.outer;t.zpp_inner.immutable_midstep("Shape::filter"),t.zpp_inner.setFilter(n.zpp_inner),t.zpp_inner.filter.wrapper(),e=e.next}return this},setShapeFluidProperties:function(n){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var e=this.zpp_inner.shapes.head;null!=e;){var i=e.elt,t=i.outer;t.zpp_inner.setFluid(n.zpp_inner),t.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==t.zpp_inner.fluidProperties&&t.zpp_inner.setFluid((new Rn).zpp_inner),t.zpp_inner.fluidProperties.wrapper(),e=e.next}return this},get_localCOM:function(){if(null==this.zpp_inner.wrap_localCOM){var n,e=this.zpp_inner.localCOMx,t=this.zpp_inner.localCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=n,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=(El=this.zpp_inner,i(El,El.getlocalCOM))}return this.zpp_inner.wrap_localCOM},get_worldCOM:function(){if(null==this.zpp_inner.wrap_worldCOM){var n,e=this.zpp_inner.worldCOMx,t=this.zpp_inner.worldCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=n,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=(El=this.zpp_inner,i(El,El.getworldCOM))}return this.zpp_inner.wrap_worldCOM},normalImpulse:function(n,e){null==e&&(e=!1);var i=0,t=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner.zpp_gl();p.zpp_critical=!0;var a;if(r>p.zpp_i?a=!0:(p.zpp_next=Q.zpp_pool,Q.zpp_pool=p,p.zpp_inner=null,a=!1),!a)break;p.zpp_critical=!1;var s=p.zpp_inner.at(p.zpp_i++),o=s.zpp_inner;if(o.type==Ve.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var _=o.wrapper(),h=(_.zpp_inner.type==Ve.COL?_.zpp_inner.colarb.outer_zn:null).normalImpulse(this,e),u=h.zpp_inner;null!=u._validate&&u._validate(),i+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),l+=1*h.zpp_inner.z,h.dispose()}}return Pn.get(i,t,l)},tangentImpulse:function(n,e){null==e&&(e=!1);var i=0,t=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner.zpp_gl();p.zpp_critical=!0;var a;if(r>p.zpp_i?a=!0:(p.zpp_next=Q.zpp_pool,Q.zpp_pool=p,p.zpp_inner=null,a=!1),!a)break;p.zpp_critical=!1;var s=p.zpp_inner.at(p.zpp_i++),o=s.zpp_inner;if(o.type==Ve.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var _=o.wrapper(),h=(_.zpp_inner.type==Ve.COL?_.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,e),u=h.zpp_inner;null!=u._validate&&u._validate(),i+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),l+=1*h.zpp_inner.z,h.dispose()}}return Pn.get(i,t,l)},totalContactsImpulse:function(n,e){null==e&&(e=!1);var i=0,t=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner.zpp_gl();p.zpp_critical=!0;var a;if(r>p.zpp_i?a=!0:(p.zpp_next=Q.zpp_pool,Q.zpp_pool=p,p.zpp_inner=null,a=!1),!a)break;p.zpp_critical=!1;var s=p.zpp_inner.at(p.zpp_i++),o=s.zpp_inner;if(o.type==Ve.COL&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var _=o.wrapper(),h=(_.zpp_inner.type==Ve.COL?_.zpp_inner.colarb.outer_zn:null).totalImpulse(this,e),u=h.zpp_inner;null!=u._validate&&u._validate(),i+=1*h.zpp_inner.x;var x=h.zpp_inner;null!=x._validate&&x._validate(),t+=1*h.zpp_inner.y;var d=h.zpp_inner;null!=d._validate&&d._validate(),l+=1*h.zpp_inner.z,h.dispose()}}return Pn.get(i,t,l)},rollingImpulse:function(n,e){null==e&&(e=!1);var i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var t=this.zpp_inner.wrap_arbiters.iterator();;){t.zpp_inner.zpp_inner.valmod();var l=t.zpp_inner.zpp_gl();t.zpp_critical=!0;var p;if(l>t.zpp_i?p=!0:(t.zpp_next=Q.zpp_pool,Q.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++),a=r.zpp_inner;if(a.type==Ve.COL&&(null==n||a.b2==n.zpp_inner||a.b1==n.zpp_inner)){var s=a.wrapper();i+=(s.zpp_inner.type==Ve.COL?s.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,e)}}return i},buoyancyImpulse:function(n){var e=0,i=0,t=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var r;if(p>l.zpp_i?r=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++),s=a.zpp_inner;if(s.type==Ve.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),_=(o.zpp_inner.type==Ve.FLUID?o.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this),h=_.zpp_inner;null!=h._validate&&h._validate(),e+=1*_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),t+=1*_.zpp_inner.z,_.dispose()}}return Pn.get(e,i,t)},dragImpulse:function(n){var e=0,i=0,t=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var r;if(p>l.zpp_i?r=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++),s=a.zpp_inner;if(s.type==Ve.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),_=(o.zpp_inner.type==Ve.FLUID?o.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this),h=_.zpp_inner;null!=h._validate&&h._validate(),e+=1*_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),t+=1*_.zpp_inner.z,_.dispose()}}return Pn.get(e,i,t)},totalFluidImpulse:function(n){var e=0,i=0,t=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var p=l.zpp_inner.zpp_gl();l.zpp_critical=!0;var r;if(p>l.zpp_i?r=!0:(l.zpp_next=Q.zpp_pool,Q.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++),s=a.zpp_inner;if(s.type==Ve.FLUID&&(null==n||s.b2==n.zpp_inner||s.b1==n.zpp_inner)){var o=s.wrapper(),_=(o.zpp_inner.type==Ve.FLUID?o.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this),h=_.zpp_inner;null!=h._validate&&h._validate(),e+=1*_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=1*_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),t+=1*_.zpp_inner.z,_.dispose()}}return Pn.get(e,i,t)},constraintsImpulse:function(){for(var n=0,e=0,i=0,t=this.zpp_inner.constraints.head;null!=t;){var l=t.elt,p=l.outer.bodyImpulse(this),r=p.zpp_inner;null!=r._validate&&r._validate(),n+=1*p.zpp_inner.x;var a=p.zpp_inner;null!=a._validate&&a._validate(),e+=1*p.zpp_inner.y;var s=p.zpp_inner;null!=s._validate&&s._validate(),i+=1*p.zpp_inner.z,p.dispose(),t=t.next}return Pn.get(n,e,i)},totalImpulse:function(n,e){null==e&&(e=!1);var i=0,t=0,l=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=bl.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner.zpp_gl();p.zpp_critical=!0;var a;if(r>p.zpp_i?a=!0:(p.zpp_next=Q.zpp_pool,Q.zpp_pool=p,p.zpp_inner=null,a=!1),!a)break;p.zpp_critical=!1;var s=p.zpp_inner.at(p.zpp_i++),o=s.zpp_inner;if(o.type!=Ve.SENSOR&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var _=o.wrapper().totalImpulse(this,e),h=_.zpp_inner;null!=h._validate&&h._validate(),i+=1*_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),t+=1*_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),l+=1*_.zpp_inner.z,_.dispose()}}for(var d=this.zpp_inner.constraints.head;null!=d;){var v=d.elt;if(v.active){var z=v.outer.bodyImpulse(this),c=z.zpp_inner;null!=c._validate&&c._validate(),i+=1*z.zpp_inner.x;var m=z.zpp_inner;null!=m._validate&&m._validate(),t+=1*z.zpp_inner.y;var y=z.zpp_inner;null!=y._validate&&y._validate(),l+=1*z.zpp_inner.z,z.dispose()}d=d.next}return Pn.get(i,t,l)},contains:function(n){var e=n.zpp_inner.weak;n.zpp_inner.weak=!1;var i;i=!1;for(var t=this.zpp_inner.shapes.head;null!=t;){if(t.elt.outer.contains(n)){i=!0;break}t=t.next}if(n.zpp_inner.weak=e){var l=n.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var r=n;r.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=r:Ml.poolVec2=r,Ml.nextVec2=r,r.zpp_disp=!0;var a=p;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=Mi.zpp_pool,Mi.zpp_pool=a}return i},toString:function(){return(this.zpp_inner.world?"(space::world":"("+(this.zpp_inner.type==me.id_BodyType_DYNAMIC?"dynamic":this.zpp_inner.type==me.id_BodyType_STATIC?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:En,__properties__:e(An.prototype.__properties__,{get_worldCOM:"get_worldCOM",get_localCOM:"get_localCOM",set_inertia:"set_inertia",get_inertia:"get_inertia",get_constraintInertia:"get_constraintInertia",set_inertiaMode:"set_inertiaMode",get_inertiaMode:"get_inertiaMode",set_gravMassScale:"set_gravMassScale",get_gravMassScale:"get_gravMassScale",set_gravMass:"set_gravMass",get_gravMass:"get_gravMass",set_gravMassMode:"set_gravMassMode",get_gravMassMode:"get_gravMassMode",set_mass:"set_mass",get_mass:"get_mass",get_constraintMass:"get_constraintMass",set_massMode:"set_massMode",get_massMode:"get_massMode",set_allowRotation:"set_allowRotation",get_allowRotation:"get_allowRotation",set_allowMovement:"set_allowMovement",get_allowMovement:"get_allowMovement",get_bounds:"get_bounds",set_torque:"set_torque",get_torque:"get_torque",set_kinAngVel:"set_kinAngVel",get_kinAngVel:"get_kinAngVel",set_angularVel:"set_angularVel",get_angularVel:"get_angularVel",set_rotation:"set_rotation",get_rotation:"get_rotation",get_constraintVelocity:"get_constraintVelocity",set_force:"set_force",get_force:"get_force",set_surfaceVel:"set_surfaceVel",get_surfaceVel:"get_surfaceVel",set_kinematicVel:"set_kinematicVel",get_kinematicVel:"get_kinematicVel",set_velocity:"set_velocity",get_velocity:"get_velocity",set_position:"set_position",get_position:"get_position",get_constraints:"get_constraints",get_isSleeping:"get_isSleeping",get_arbiters:"get_arbiters",set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_shapes:"get_shapes",set_disableCCD:"set_disableCCD",get_disableCCD:"get_disableCCD",set_isBullet:"set_isBullet",get_isBullet:"get_isBullet",set_type:"set_type",get_type:"get_type"})});var Nn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.BodyIterator"]=Nn,Nn.__name__=["nape","phys","BodyIterator"],Nn.get=function(n){var e;if(null==Nn.zpp_pool){ol.internal=!0;var i=new Nn;ol.internal=!1,e=i}else{var t=Nn.zpp_pool;Nn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Nn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Nn.zpp_pool,Nn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Nn};var Ln=function(){this.zpp_inner=null,this.zpp_inner=new ol,this.zpp_inner.outer=this};l["nape.phys.BodyList"]=Ln,Ln.__name__=["nape","phys","BodyList"],Ln.fromArray=function(n){for(var e=new Ln,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Ln.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Nn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Ln;this.zpp_inner.valmod();for(var i=Nn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Nn.zpp_pool,Nn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Nn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Nn.zpp_pool,Nn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=Nn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Nn.zpp_pool,Nn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Nn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Nn.zpp_pool,Nn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=Nn.zpp_pool,Nn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Ln,__properties__:{get_length:"get_length"}};var Vn=function(){};l["nape.phys.BodyType"]=Vn,Vn.__name__=["nape","phys","BodyType"],Vn.__properties__={get_KINEMATIC:"get_KINEMATIC",get_DYNAMIC:"get_DYNAMIC",get_STATIC:"get_STATIC"},Vn.get_STATIC=function(){return null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1),me.BodyType_STATIC},Vn.get_DYNAMIC=function(){return null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1),me.BodyType_DYNAMIC},Vn.get_KINEMATIC=function(){return null==me.BodyType_KINEMATIC&&(me.internal=!0,me.BodyType_KINEMATIC=new Vn,me.internal=!1),me.BodyType_KINEMATIC},Vn.prototype={toString:function(){return null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1),this==me.BodyType_STATIC?"STATIC":(null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1),this==me.BodyType_DYNAMIC?"DYNAMIC":(null==me.BodyType_KINEMATIC&&(me.internal=!0,me.BodyType_KINEMATIC=new Vn,me.internal=!1),this==me.BodyType_KINEMATIC?"KINEMATIC":""))},__class__:Vn};var jn=function(){this.zpp_inner=null,An.zpp_internalAlloc=!0,An.call(this),An.zpp_internalAlloc=!1,this.zpp_inner=new Si,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(ce.ANY_COMPOUND.zpp_inner)};l["nape.phys.Compound"]=jn,jn.__name__=["nape","phys","Compound"],jn.__super__=An,jn.prototype=e(An.prototype,{zpp_inner:null,get_bodies:function(){return this.zpp_inner.wrap_bodies},get_constraints:function(){return this.zpp_inner.wrap_constraints},get_compounds:function(){return this.zpp_inner.wrap_compounds},get_compound:function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},set_compound:function(n){if(this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},get_space:function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},set_space:function(n){if(this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},toString:function(){return"Compound"+this.zpp_inner_i.id},copy:function(){return this.zpp_inner.copy()},breakApart:function(){this.zpp_inner.breakApart()},visitBodies:function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var i=Nn.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Nn.zpp_pool,Nn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;n(i.zpp_inner.at(i.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var a=Dn.get(r);;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;a.zpp_critical=!0;var _;if(o>a.zpp_i?_=!0:(a.zpp_next=Dn.zpp_pool,Dn.zpp_pool=a,a.zpp_inner=null,_=!1),!_)break;a.zpp_critical=!1;a.zpp_inner.at(a.zpp_i++).visitBodies(n)}},visitConstraints:function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var i=G.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=G.zpp_pool,G.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;n(i.zpp_inner.at(i.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var a=Dn.get(r);;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;a.zpp_critical=!0;var _;if(o>a.zpp_i?_=!0:(a.zpp_next=Dn.zpp_pool,Dn.zpp_pool=a,a.zpp_inner=null,_=!1),!_)break;a.zpp_critical=!1;a.zpp_inner.at(a.zpp_i++).visitConstraints(n)}},visitCompounds:function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var i=Dn.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Dn.zpp_pool,Dn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n(r),r.visitCompounds(n)}},COM:function(n){null==n&&(n=!1);var e;if(null==Ml.poolVec2?e=new On:(e=Ml.poolVec2,Ml.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Ml.nextVec2&&(Ml.nextVec2=null)),null==e.zpp_inner){var t;null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,e.zpp_inner=t,e.zpp_inner.outer=e}else{var l=e.zpp_inner;null!=l._isimmutable&&l._isimmutable();var p,r=e.zpp_inner;if(null!=r._validate&&r._validate(),0==e.zpp_inner.x){var a=e.zpp_inner;null!=a._validate&&a._validate(),p=0==e.zpp_inner.y}else p=!1;if(!p){e.zpp_inner.x=0,e.zpp_inner.y=0;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}e.zpp_inner.weak=n;var o=e,_=0;return this.visitBodies(function(n){if(null!=n.zpp_inner.wrap_shapes.zpp_inner.inner.head){if(null==n.zpp_inner.wrap_worldCOM){var e,t=n.zpp_inner.worldCOMx,l=n.zpp_inner.worldCOMy;if(null==Ml.poolVec2?e=new On:(e=Ml.poolVec2,Ml.poolVec2=e.zpp_pool,e.zpp_pool=null,e.zpp_disp=!1,e==Ml.nextVec2&&(Ml.nextVec2=null)),null==e.zpp_inner){var p;null==Mi.zpp_pool?p=new Mi:(p=Mi.zpp_pool,Mi.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=l,e.zpp_inner=p,e.zpp_inner.outer=e}else{var r=e.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a,s=e.zpp_inner;if(null!=s._validate&&s._validate(),e.zpp_inner.x==t){var h=e.zpp_inner;null!=h._validate&&h._validate(),a=e.zpp_inner.y==l}else a=!1;if(!a){e.zpp_inner.x=t,e.zpp_inner.y=l;var u=e.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}e.zpp_inner.weak=!1,n.zpp_inner.wrap_worldCOM=e,n.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,n.zpp_inner.wrap_worldCOM.zpp_inner._validate=(El=n.zpp_inner,i(El,El.getworldCOM))}var x=n.zpp_inner.wrap_worldCOM;n.zpp_inner.validate_mass();var d=x.mul(n.zpp_inner.cmass,!0);o.addeq(d),n.zpp_inner.validate_mass(),_+=n.zpp_inner.cmass}}),o.muleq(1/_),o},translate:function(n){var e=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(e){null==e.zpp_inner.wrap_pos&&e.zpp_inner.setupPosition(),e.zpp_inner.wrap_pos.addeq(n)}),n.zpp_inner.weak=e){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var l=n;l.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=l:Ml.poolVec2=l,Ml.nextVec2=l,l.zpp_disp=!0;var p=t;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Mi.zpp_pool,Mi.zpp_pool=p}return this},rotate:function(n,e){var i=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(i){i.rotate(n,e)}),n.zpp_inner.weak=i){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=p:Ml.poolVec2=p,Ml.nextVec2=p,p.zpp_disp=!0;var r=l;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r}return this},__class__:jn,__properties__:e(An.prototype.__properties__,{set_space:"set_space",get_space:"get_space",set_compound:"set_compound",get_compound:"get_compound",get_compounds:"get_compounds",get_constraints:"get_constraints",get_bodies:"get_bodies"})});var Dn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.CompoundIterator"]=Dn,Dn.__name__=["nape","phys","CompoundIterator"],Dn.get=function(n){var e;if(null==Dn.zpp_pool){hl.internal=!0;var i=new Dn;hl.internal=!1,e=i}else{var t=Dn.zpp_pool;Dn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Dn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Dn.zpp_pool,Dn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Dn};var Fn=function(){this.zpp_inner=null,this.zpp_inner=new hl,this.zpp_inner.outer=this};l["nape.phys.CompoundList"]=Fn,Fn.__name__=["nape","phys","CompoundList"],Fn.fromArray=function(n){for(var e=new Fn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Fn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Dn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Fn;this.zpp_inner.valmod();for(var i=Dn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Dn.zpp_pool,Dn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Dn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=Dn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Dn.zpp_pool,Dn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Dn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Fn,__properties__:{get_length:"get_length"}};var Rn=function(n,e){null==e&&(e=1),null==n&&(n=1),this.zpp_inner=null,null==Pi.zpp_pool?this.zpp_inner=new Pi:(this.zpp_inner=Pi.zpp_pool,Pi.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),e!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=e/1,this.zpp_inner.invalidate())};l["nape.phys.FluidProperties"]=Rn,Rn.__name__=["nape","phys","FluidProperties"],Rn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=yl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},copy:function(){var n=new Rn(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(n.zpp_inner.userData=o.copy(this.zpp_inner.userData));var e=this.zpp_inner.wrap_gravity;if(null==e){if(null!=n.zpp_inner.wrap_gravity){n.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var i=n.zpp_inner.wrap_gravity,t=i.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null;var p=i;p.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=p:Ml.poolVec2=p,Ml.nextVec2=p,p.zpp_disp=!0;var r=l;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,n.zpp_inner.wrap_gravity=null}}else{null==n.zpp_inner.wrap_gravity&&n.zpp_inner.getgravity();var a=n.zpp_inner.wrap_gravity,s=a.zpp_inner;null!=s._isimmutable&&s._isimmutable();var _=e.zpp_inner;null!=_._validate&&_._validate();var h=e.zpp_inner.x,u=e.zpp_inner;null!=u._validate&&u._validate();var x=e.zpp_inner.y,d=a.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v,z=a.zpp_inner;if(null!=z._validate&&z._validate(),a.zpp_inner.x==h){var c=a.zpp_inner;null!=c._validate&&c._validate(),v=a.zpp_inner.y==x}else v=!1;if(!v){a.zpp_inner.x=h,a.zpp_inner.y=x;var m=a.zpp_inner;null!=m._invalidate&&m._invalidate(m)}if(e.zpp_inner.weak){var y=e.zpp_inner;null!=y._isimmutable&&y._isimmutable();var f=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var b=e;b.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=b:Ml.poolVec2=b,Ml.nextVec2=b,b.zpp_disp=!0;var g=f;null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g._isimmutable=null,g._validate=null,g._invalidate=null,g.next=Mi.zpp_pool,Mi.zpp_pool=g}}return n},get_density:function(){return 1e3*this.zpp_inner.density},set_density:function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},get_viscosity:function(){return this.zpp_inner.viscosity},set_viscosity:function(n){return n!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=n/1,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},get_gravity:function(){return this.zpp_inner.wrap_gravity},set_gravity:function(n){if(null==n){if(null!=this.zpp_inner.wrap_gravity){this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var e=this.zpp_inner.wrap_gravity,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var l=e;l.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=l:Ml.poolVec2=l,Ml.nextVec2=l,l.zpp_disp=!0;var p=t;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Mi.zpp_pool,Mi.zpp_pool=p,this.zpp_inner.wrap_gravity=null}}else{null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var r=this.zpp_inner.wrap_gravity,a=r.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s=n.zpp_inner;null!=s._validate&&s._validate();var o=n.zpp_inner.x,_=n.zpp_inner;null!=_._validate&&_._validate();var h=n.zpp_inner.y,u=r.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x,d=r.zpp_inner;if(null!=d._validate&&d._validate(),r.zpp_inner.x==o){var v=r.zpp_inner;null!=v._validate&&v._validate(),x=r.zpp_inner.y==h}else x=!1;if(!x){r.zpp_inner.x=o,r.zpp_inner.y=h;var z=r.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(n.zpp_inner.weak){var c=n.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var y=n;y.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=y:Ml.poolVec2=y,Ml.nextVec2=y,y.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Mi.zpp_pool,Mi.zpp_pool=f}}return this.zpp_inner.wrap_gravity},toString:function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+_.string(this.zpp_inner.wrap_gravity)+" }"},__class__:Rn,__properties__:{set_gravity:"set_gravity",get_gravity:"get_gravity",set_viscosity:"set_viscosity",get_viscosity:"get_viscosity",set_density:"set_density",get_density:"get_density",get_shapes:"get_shapes",get_userData:"get_userData"}};var Bn=function(){};l["nape.phys.GravMassMode"]=Bn,Bn.__name__=["nape","phys","GravMassMode"],Bn.__properties__={get_SCALED:"get_SCALED",get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},Bn.get_DEFAULT=function(){return null==me.GravMassMode_DEFAULT&&(me.internal=!0,me.GravMassMode_DEFAULT=new Bn,me.internal=!1),me.GravMassMode_DEFAULT},Bn.get_FIXED=function(){return null==me.GravMassMode_FIXED&&(me.internal=!0,me.GravMassMode_FIXED=new Bn,me.internal=!1),me.GravMassMode_FIXED},Bn.get_SCALED=function(){return null==me.GravMassMode_SCALED&&(me.internal=!0,me.GravMassMode_SCALED=new Bn,me.internal=!1),me.GravMassMode_SCALED},Bn.prototype={toString:function(){return null==me.GravMassMode_DEFAULT&&(me.internal=!0,me.GravMassMode_DEFAULT=new Bn,me.internal=!1),this==me.GravMassMode_DEFAULT?"DEFAULT":(null==me.GravMassMode_FIXED&&(me.internal=!0,me.GravMassMode_FIXED=new Bn,me.internal=!1),this==me.GravMassMode_FIXED?"FIXED":(null==me.GravMassMode_SCALED&&(me.internal=!0,me.GravMassMode_SCALED=new Bn,me.internal=!1),this==me.GravMassMode_SCALED?"SCALED":""))},__class__:Bn};var Gn=function(){};l["nape.phys.InertiaMode"]=Gn,Gn.__name__=["nape","phys","InertiaMode"],Gn.__properties__={get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},Gn.get_DEFAULT=function(){return null==me.InertiaMode_DEFAULT&&(me.internal=!0,me.InertiaMode_DEFAULT=new Gn,me.internal=!1),me.InertiaMode_DEFAULT},Gn.get_FIXED=function(){return null==me.InertiaMode_FIXED&&(me.internal=!0,me.InertiaMode_FIXED=new Gn,me.internal=!1),me.InertiaMode_FIXED},Gn.prototype={toString:function(){return null==me.InertiaMode_DEFAULT&&(me.internal=!0,me.InertiaMode_DEFAULT=new Gn,me.internal=!1),this==me.InertiaMode_DEFAULT?"DEFAULT":(null==me.InertiaMode_FIXED&&(me.internal=!0,me.InertiaMode_FIXED=new Gn,me.internal=!1),this==me.InertiaMode_FIXED?"FIXED":"")},__class__:Gn};var Zn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.phys.InteractorIterator"]=Zn,Zn.__name__=["nape","phys","InteractorIterator"],Zn.get=function(n){var e;if(null==Zn.zpp_pool){_l.internal=!0;var i=new Zn;_l.internal=!1,e=i}else{var t=Zn.zpp_pool;Zn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Zn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Zn.zpp_pool,Zn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Zn};var Un=function(){this.zpp_inner=null,this.zpp_inner=new _l,this.zpp_inner.outer=this};l["nape.phys.InteractorList"]=Un,Un.__name__=["nape","phys","InteractorList"],Un.fromArray=function(n){for(var e=new Un,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Un.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner_i)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner_i);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}else this.zpp_inner.inner.add(n.zpp_inner_i);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer_i},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer_i},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner_i){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner_i),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Zn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Un;this.zpp_inner.valmod();for(var i=Zn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Zn.zpp_pool,Zn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Zn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=Zn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Zn.zpp_pool,Zn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Zn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Un,__properties__:{get_length:"get_length"}};var qn=function(){};l["nape.phys.MassMode"]=qn,qn.__name__=["nape","phys","MassMode"],qn.__properties__={get_FIXED:"get_FIXED",get_DEFAULT:"get_DEFAULT"},qn.get_DEFAULT=function(){return null==me.MassMode_DEFAULT&&(me.internal=!0,me.MassMode_DEFAULT=new qn,me.internal=!1),me.MassMode_DEFAULT},qn.get_FIXED=function(){return null==me.MassMode_FIXED&&(me.internal=!0,me.MassMode_FIXED=new qn,me.internal=!1),me.MassMode_FIXED},qn.prototype={toString:function(){return null==me.MassMode_DEFAULT&&(me.internal=!0,me.MassMode_DEFAULT=new qn,me.internal=!1),this==me.MassMode_DEFAULT?"DEFAULT":(null==me.MassMode_FIXED&&(me.internal=!0,me.MassMode_FIXED=new qn,me.internal=!1),this==me.MassMode_FIXED?"FIXED":"")},__class__:qn};var Yn=function(n,e,i,t,l){null==l&&(l=.001),null==t&&(t=1),null==i&&(i=2),null==e&&(e=1),null==n&&(n=0),this.zpp_inner=null,null==Ti.zpp_pool?this.zpp_inner=new Ti:(this.zpp_inner=Ti.zpp_pool,Ti.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);this.zpp_inner.outer=this,n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS)),e!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=e/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ANGDRAG|Ti.ARBITERS)),i!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=i/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS)),t!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=t/1e3,this.zpp_inner.invalidate(Ti.WAKE|Ti.PROPS)),l!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=l/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS))};l["nape.phys.Material"]=Yn,Yn.__name__=["nape","phys","Material"],Yn.wood=function(){return new Yn(.4,.2,.38,.7,.005)},Yn.steel=function(){return new Yn(.2,.57,.74,7.8,.001)},Yn.ice=function(){return new Yn(.3,.03,.1,.9,1e-4)},Yn.rubber=function(){return new Yn(.8,1,1.4,1.5,.01)},Yn.glass=function(){return new Yn(.4,.4,.94,2.6,.002)},Yn.sand=function(){return new Yn(-1,.45,.6,1.6,16)},Yn.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_shapes:function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=yl.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},copy:function(){var n=new Yn(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(n.zpp_inner.userData=o.copy(this.zpp_inner.userData)),n},get_elasticity:function(){return this.zpp_inner.elasticity},set_elasticity:function(n){return n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS)),this.zpp_inner.elasticity},get_dynamicFriction:function(){return this.zpp_inner.dynamicFriction},set_dynamicFriction:function(n){return n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=n/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ANGDRAG|Ti.ARBITERS)),this.zpp_inner.dynamicFriction},get_staticFriction:function(){return this.zpp_inner.staticFriction},set_staticFriction:function(n){return n!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=n/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS)),this.zpp_inner.staticFriction},get_density:function(){return 1e3*this.zpp_inner.density},set_density:function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(Ti.WAKE|Ti.PROPS)),1e3*this.zpp_inner.density},get_rollingFriction:function(){return this.zpp_inner.rollingFriction},set_rollingFriction:function(n){return n!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=n/1,this.zpp_inner.invalidate(Ti.WAKE|Ti.ARBITERS)),this.zpp_inner.rollingFriction},toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:Yn,__properties__:{set_rollingFriction:"set_rollingFriction",get_rollingFriction:"get_rollingFriction",set_density:"set_density",get_density:"get_density",set_staticFriction:"set_staticFriction",get_staticFriction:"get_staticFriction",set_dynamicFriction:"set_dynamicFriction",get_dynamicFriction:"get_dynamicFriction",set_elasticity:"set_elasticity",get_elasticity:"get_elasticity",get_shapes:"get_shapes",get_userData:"get_userData"}};var Kn=function(){this.zpp_inner=null,An.zpp_internalAlloc=!0,An.call(this),An.zpp_internalAlloc=!1};l["nape.shape.Shape"]=Kn,Kn.__name__=["nape","shape","Shape"],Kn.__super__=An,Kn.prototype=e(An.prototype,{zpp_inner:null,get_type:function(){return Ai.types[this.zpp_inner.type]},isCircle:function(){return this.zpp_inner.type==me.id_ShapeType_CIRCLE},isPolygon:function(){return this.zpp_inner.type==me.id_ShapeType_POLYGON},get_body:function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},set_body:function(n){if(this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=n&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=n)){var e=n.zpp_inner.wrap_shapes;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},get_castCircle:function(){return this.zpp_inner.type==me.id_ShapeType_CIRCLE?this.zpp_inner.circle.outer_zn:null},get_castPolygon:function(){return this.zpp_inner.type==me.id_ShapeType_POLYGON?this.zpp_inner.polygon.outer_zn:null},get_worldCOM:function(){if(null==this.zpp_inner.wrap_worldCOM){var n,e=this.zpp_inner.worldCOMx,t=this.zpp_inner.worldCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=n,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=(El=this.zpp_inner,i(El,El.getworldCOM))}return this.zpp_inner.wrap_worldCOM},get_localCOM:function(){return null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==me.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},set_localCOM:function(n){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==me.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM());var e=this.zpp_inner.wrap_localCOM,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_localCOM&&(this.zpp_inner.type==me.id_ShapeType_CIRCLE?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},get_area:function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},get_inertia:function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},get_angDrag:function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},get_material:function(){return this.zpp_inner.material.wrapper()},set_material:function(n){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper()},get_filter:function(){return this.zpp_inner.filter.wrapper()},set_filter:function(n){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()},get_fluidProperties:function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Rn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},set_fluidProperties:function(n){return this.zpp_inner.setFluid(n.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Rn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},get_fluidEnabled:function(){return this.zpp_inner.fluidEnabled},set_fluidEnabled:function(n){if(this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),this.zpp_inner.fluidEnabled=n,n&&null==this.zpp_inner.fluidProperties){var e=new Rn;this.zpp_inner.setFluid(e.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Rn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()}return this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},get_sensorEnabled:function(){return this.zpp_inner.sensorEnabled},set_sensorEnabled:function(n){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=n,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},get_bounds:function(){return this.zpp_inner.aabb.wrapper()},translate:function(n){if(this.zpp_inner.immutable_midstep("Shape::translate()"),n.lsq()>0)if(this.zpp_inner.type==me.id_ShapeType_CIRCLE){var e=this.zpp_inner.circle,i=n.zpp_inner;null!=i._validate&&i._validate();var t=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate(),e.__translate(t,n.zpp_inner.y)}else{var p=this.zpp_inner.polygon,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x,s=n.zpp_inner;null!=s._validate&&s._validate(),p.__translate(a,n.zpp_inner.y)}if(n.zpp_inner.weak){var o=n.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var h=n;h.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=h:Ml.poolVec2=h,Ml.nextVec2=h,h.zpp_disp=!0;var u=_;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u}return this},scale:function(n,e){if(this.zpp_inner.immutable_midstep("Shape::scale()"),this.zpp_inner.type==me.id_ShapeType_CIRCLE){var i=n*n-e*e;y.epsilon*y.epsilon>i*i&&this.zpp_inner.circle.__scale(n,e)}else this.zpp_inner.polygon.__scale(n,e);return this},rotate:function(n){if(this.zpp_inner.immutable_midstep("Shape::rotate()"),0!=n%(2*Math.PI)){var e=Math.cos(n),i=Math.sin(n);this.zpp_inner.type==me.id_ShapeType_CIRCLE?this.zpp_inner.circle.__rotate(i,e):this.zpp_inner.polygon.__rotate(i,e)}return this},transform:function(n){return this.zpp_inner.immutable_midstep("Shape::transform()"),n.singular(),this.zpp_inner.type==me.id_ShapeType_CIRCLE?n.equiorthogonal()&&this.zpp_inner.circle.__transform(n):this.zpp_inner.polygon.__transform(n),this},contains:function(n){$e.validateShape(this.zpp_inner);var e=n.zpp_inner;null!=e._validate&&e._validate();var i=Ke.shapeContains(this.zpp_inner,n.zpp_inner);if(n.zpp_inner.weak){var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=p:Ml.poolVec2=p,Ml.nextVec2=p,p.zpp_disp=!0;var r=l;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r}return i},copy:function(){return this.zpp_inner.copy()},toString:function(){return(this.zpp_inner.type==me.id_ShapeType_CIRCLE?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},__class__:Kn,__properties__:e(An.prototype.__properties__,{get_bounds:"get_bounds",set_sensorEnabled:"set_sensorEnabled",get_sensorEnabled:"get_sensorEnabled",set_fluidEnabled:"set_fluidEnabled",get_fluidEnabled:"get_fluidEnabled",set_fluidProperties:"set_fluidProperties",get_fluidProperties:"get_fluidProperties",set_filter:"set_filter",get_filter:"get_filter",set_material:"set_material",get_material:"get_material",get_angDrag:"get_angDrag",get_inertia:"get_inertia",get_area:"get_area",set_localCOM:"set_localCOM",get_localCOM:"get_localCOM",get_worldCOM:"get_worldCOM",get_castPolygon:"get_castPolygon",get_castCircle:"get_castCircle",set_body:"set_body",get_body:"get_body",get_type:"get_type"})});var Wn=function(n,e,i,t){if(this.zpp_inner_zn=null,Kn.zpp_internalAlloc=!0,Kn.call(this),Kn.zpp_internalAlloc=!1,this.zpp_inner_zn=new Ei,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),null==e)this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0;else{var l=e.zpp_inner;null!=l._validate&&l._validate(),this.zpp_inner.localCOMx=e.zpp_inner.x;var p=e.zpp_inner;if(null!=p._validate&&p._validate(),this.zpp_inner.localCOMy=e.zpp_inner.y,e.zpp_inner.weak){var r=e.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null;var s=e;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}}if(null==i){null==Ti.zpp_pool?this.zpp_inner.material=new Ti:(this.zpp_inner.material=Ti.zpp_pool,Ti.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null)}else this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(i.zpp_inner),this.zpp_inner.material.wrapper();if(null==t){null==Ge.zpp_pool?this.zpp_inner.filter=new Ge:(this.zpp_inner.filter=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null)}else this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(t.zpp_inner),this.zpp_inner.filter.wrapper();this.zpp_inner_i.insert_cbtype(ce.ANY_SHAPE.zpp_inner)};l["nape.shape.Circle"]=Wn,Wn.__name__=["nape","shape","Circle"],Wn.__super__=Kn,Wn.prototype=e(Kn.prototype,{zpp_inner_zn:null,get_radius:function(){return this.zpp_inner_zn.radius},set_radius:function(n){return this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},__class__:Wn,__properties__:e(Kn.prototype.__properties__,{set_radius:"set_radius",get_radius:"get_radius"})});var Jn=function(){this.zpp_inner=null};l["nape.shape.Edge"]=Jn,Jn.__name__=["nape","shape","Edge"],Jn.prototype={zpp_inner:null,get_polygon:function(){return this.zpp_inner.polygon.outer_zn},get_localNormal:function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},get_worldNormal:function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},get_length:function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},get_localProjection:function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},get_worldProjection:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var i=n.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=n.lverts.next,l=n.gverts.next;null!=l;){var p=l,r=t;t=t.next,p.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),p.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),l=l.next}}var a=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=a.elt;a=a.next,h.gp0=o,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var u=n.gverts.next,x=a.elt;a=a.next,x.gp0=o,x.gp1=u,x.gnormx=n.body.axisy*x.lnormx-n.body.axisx*x.lnormy,x.gnormy=x.lnormx*n.body.axisx+x.lnormy*n.body.axisy,x.gprojection=n.body.posx*x.gnormx+n.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}return this.zpp_inner.gprojection},get_localVertex1:function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp0;if(null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Mi.zpp_pool,Mi.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},get_localVertex2:function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp1;if(null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Mi.zpp_pool,Mi.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},get_worldVertex1:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var i=n.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=n.lverts.next,l=n.gverts.next;null!=l;){var p=l,r=t;t=t.next,p.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),p.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),l=l.next}}var a=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=a.elt;a=a.next,h.gp0=o,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var u=n.gverts.next,x=a.elt;a=a.next,x.gp0=o,x.gp1=u,x.gnormx=n.body.axisy*x.lnormx-n.body.axisx*x.lnormy,x.gnormy=x.lnormx*n.body.axisx+x.lnormy*n.body.axisy,x.gprojection=n.body.posx*x.gnormx+n.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}var d=this.zpp_inner.gp0;if(null==d.outer){d.outer=new On;var v=d.outer.zpp_inner;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v,d.outer.zpp_inner=d}return d.outer},get_worldVertex2:function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var i=n.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=n.lverts.next,l=n.gverts.next;null!=l;){var p=l,r=t;t=t.next,p.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),p.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),l=l.next}}var a=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=a.elt;a=a.next,h.gp0=o,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var u=n.gverts.next,x=a.elt;a=a.next,x.gp0=o,x.gp1=u,x.gnormx=n.body.axisy*x.lnormx-n.body.axisx*x.lnormy,x.gnormy=x.lnormx*n.body.axisx+x.lnormy*n.body.axisy,x.gprojection=n.body.posx*x.gnormx+n.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}var d=this.zpp_inner.gp1;if(null==d.outer){d.outer=new On;var v=d.outer.zpp_inner;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v,d.outer.zpp_inner=d}return d.outer},toString:function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var i=n.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=n.lverts.next,l=n.gverts.next;null!=l;){var p=l,r=t;t=t.next,p.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),p.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),l=l.next}}var a=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=a.elt;a=a.next,h.gp0=o,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var u=n.gverts.next,x=a.elt;a=a.next,x.gp0=o,x.gp1=u,x.gnormx=n.body.axisy*x.lnormx-n.body.axisx*x.lnormy,x.gnormy=x.lnormx*n.body.axisx+x.lnormy*n.body.axisy,x.gprojection=n.body.posx*x.gnormx+n.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},__class__:Jn,__properties__:{get_worldVertex2:"get_worldVertex2",get_worldVertex1:"get_worldVertex1",get_localVertex2:"get_localVertex2",get_localVertex1:"get_localVertex1",get_worldProjection:"get_worldProjection",get_localProjection:"get_localProjection",get_length:"get_length",get_worldNormal:"get_worldNormal",get_localNormal:"get_localNormal",get_polygon:"get_polygon"}};var Xn=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.shape.EdgeIterator"]=Xn,Xn.__name__=["nape","shape","EdgeIterator"],Xn.get=function(n){var e;if(null==Xn.zpp_pool){ml.internal=!0;var i=new Xn;ml.internal=!1,e=i}else{var t=Xn.zpp_pool;Xn.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Xn.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=Xn.zpp_pool,Xn.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:Xn};var Hn=function(){this.zpp_inner=null,this.zpp_inner=new ml,this.zpp_inner.outer=this};l["nape.shape.EdgeList"]=Hn,Hn.__name__=["nape","shape","EdgeList"],Hn.fromArray=function(n){for(var e=new Hn,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},Hn.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n==this.zpp_inner.user_length-1?n=n:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-2-n)),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.wrapper()},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),Xn.get(this)},copy:function(n){null==n&&(n=!1);var e=new Hn;this.zpp_inner.valmod();for(var i=Xn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Xn.zpp_pool,Xn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=Xn.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Xn.zpp_pool,Xn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=Xn.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Xn.zpp_pool,Xn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=Xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=Xn.zpp_pool,Xn.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=Xn.zpp_pool,Xn.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:Hn,__properties__:{get_length:"get_length"}};var Qn=function(n,e,i){if(this.zpp_inner_zn=null,Kn.zpp_internalAlloc=!0,Kn.call(this),Kn.zpp_internalAlloc=!1,this.zpp_inner_zn=new Li,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,n instanceof Array&&null==n.__enum__)for(var t=n,l=0;t.length>l;){var p=t[l];++l,m.__instanceof(p,On);var r=p;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var a=this.zpp_inner_zn.wrap_lverts,s=r.zpp_inner;null!=s._validate&&s._validate();var o=r.zpp_inner.x,_=r.zpp_inner;null!=_._validate&&_._validate();var h,u=r.zpp_inner.y;if(null==Ml.poolVec2?h=new On:(h=Ml.poolVec2,Ml.poolVec2=h.zpp_pool,h.zpp_pool=null,h.zpp_disp=!1,h==Ml.nextVec2&&(Ml.nextVec2=null)),null==h.zpp_inner){var x;null==Mi.zpp_pool?x=new Mi:(x=Mi.zpp_pool,Mi.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=o,x.y=u,h.zpp_inner=x,h.zpp_inner.outer=h}else{var d=h.zpp_inner;null!=d._isimmutable&&d._isimmutable();var v,z=h.zpp_inner;if(null!=z._validate&&z._validate(),h.zpp_inner.x==o){var c=h.zpp_inner;null!=c._validate&&c._validate(),v=h.zpp_inner.y==u}else v=!1;if(!v){h.zpp_inner.x=o,h.zpp_inner.y=u;var y=h.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}h.zpp_inner.weak=!1,a.push(h)}else if(m.__instanceof(n,Sn))for(var f=n,b=f.iterator();;){b.zpp_inner.zpp_inner.valmod();var g=b.zpp_inner.zpp_gl();b.zpp_critical=!0;var w;if(g>b.zpp_i?w=!0:(b.zpp_next=In.zpp_pool,In.zpp_pool=b,b.zpp_inner=null,w=!1),!w)break;b.zpp_critical=!1;var M=b.zpp_inner.at(b.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var C=this.zpp_inner_zn.wrap_lverts,k=M.zpp_inner;null!=k._validate&&k._validate();var O=M.zpp_inner.x,I=M.zpp_inner;null!=I._validate&&I._validate();var S,P=M.zpp_inner.y;if(null==Ml.poolVec2?S=new On:(S=Ml.poolVec2,Ml.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==Ml.nextVec2&&(Ml.nextVec2=null)),null==S.zpp_inner){var T;null==Mi.zpp_pool?T=new Mi:(T=Mi.zpp_pool,Mi.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=O,T.y=P,S.zpp_inner=T,S.zpp_inner.outer=S}else{var A=S.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E,N=S.zpp_inner;if(null!=N._validate&&N._validate(),S.zpp_inner.x==O){var L=S.zpp_inner;null!=L._validate&&L._validate(),E=S.zpp_inner.y==P}else E=!1;if(!E){S.zpp_inner.x=O,S.zpp_inner.y=P;var V=S.zpp_inner;null!=V._invalidate&&V._invalidate(V)}}S.zpp_inner.weak=!1,C.push(S)}else if(m.__instanceof(n,zn)){var j=n,D=j.zpp_inner.vertices;if(null!=D)for(var F=D;;){var R,B=F.x,G=F.y;if(null==Ml.poolVec2?R=new On:(R=Ml.poolVec2,Ml.poolVec2=R.zpp_pool,R.zpp_pool=null,R.zpp_disp=!1,R==Ml.nextVec2&&(Ml.nextVec2=null)),null==R.zpp_inner){var Z;null==Mi.zpp_pool?Z=new Mi:(Z=Mi.zpp_pool,Mi.zpp_pool=Z.next,Z.next=null),Z.weak=!1,Z._immutable=!1,Z.x=B,Z.y=G,R.zpp_inner=Z,R.zpp_inner.outer=R}else{var U=R.zpp_inner;null!=U._isimmutable&&U._isimmutable();var q,Y=R.zpp_inner;if(null!=Y._validate&&Y._validate(),R.zpp_inner.x==B){var K=R.zpp_inner;null!=K._validate&&K._validate(),q=R.zpp_inner.y==G}else q=!1;if(!q){R.zpp_inner.x=B,R.zpp_inner.y=G;var W=R.zpp_inner;null!=W._invalidate&&W._invalidate(W)}}R.zpp_inner.weak=!1;var J=R;F=F.next,null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var X=this.zpp_inner_zn.wrap_lverts,H=J.zpp_inner;null!=H._validate&&H._validate();var Q=J.zpp_inner.x,$=J.zpp_inner;null!=$._validate&&$._validate();var nn,en=J.zpp_inner.y;if(null==Ml.poolVec2?nn=new On:(nn=Ml.poolVec2,Ml.poolVec2=nn.zpp_pool,nn.zpp_pool=null,nn.zpp_disp=!1,nn==Ml.nextVec2&&(Ml.nextVec2=null)),null==nn.zpp_inner){var tn;null==Mi.zpp_pool?tn=new Mi:(tn=Mi.zpp_pool,Mi.zpp_pool=tn.next,tn.next=null),tn.weak=!1,tn._immutable=!1,tn.x=Q,tn.y=en,nn.zpp_inner=tn,nn.zpp_inner.outer=nn}else{var ln=nn.zpp_inner;null!=ln._isimmutable&&ln._isimmutable();var pn,rn=nn.zpp_inner;if(null!=rn._validate&&rn._validate(),nn.zpp_inner.x==Q){var an=nn.zpp_inner;null!=an._validate&&an._validate(),pn=nn.zpp_inner.y==en}else pn=!1;if(!pn){nn.zpp_inner.x=Q,nn.zpp_inner.y=en;var sn=nn.zpp_inner;null!=sn._invalidate&&sn._invalidate(sn)}}nn.zpp_inner.weak=!1,X.push(nn);var on=J.zpp_inner;null!=on._isimmutable&&on._isimmutable();var _n=J.zpp_inner;J.zpp_inner.outer=null,J.zpp_inner=null;var hn=J;hn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=hn:Ml.poolVec2=hn,Ml.nextVec2=hn,hn.zpp_disp=!0;var un=_n;if(null!=un.outer&&(un.outer.zpp_inner=null,un.outer=null),un._isimmutable=null,un._validate=null,un._invalidate=null,un.next=Mi.zpp_pool,Mi.zpp_pool=un,F==D)break}}if(n instanceof Array&&null==n.__enum__)for(var xn=n,dn=0;xn.length>dn;){var vn,cn=xn[dn];if(cn.zpp_inner.weak){var mn=cn.zpp_inner;null!=mn._isimmutable&&mn._isimmutable();var yn=cn.zpp_inner;cn.zpp_inner.outer=null,cn.zpp_inner=null;var fn=cn;fn.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=fn:Ml.poolVec2=fn,Ml.nextVec2=fn,fn.zpp_disp=!0;var bn=yn;null!=bn.outer&&(bn.outer.zpp_inner=null,bn.outer=null),bn._isimmutable=null,bn._validate=null,bn._invalidate=null,bn.next=Mi.zpp_pool,Mi.zpp_pool=bn,vn=!0}else vn=!1;vn?xn.splice(dn,1):++dn}else if(m.__instanceof(n,Sn)){var gn=n;null!=gn.zpp_inner._validate&&gn.zpp_inner._validate();for(var wn=gn.zpp_inner.inner,Mn=null,Cn=wn.head;null!=Cn;){var kn=Cn.elt;if(kn.outer.zpp_inner.weak){if(Cn=wn.erase(Mn),kn.outer.zpp_inner.weak){var Pn=kn.outer,Tn=Pn.zpp_inner;null!=Tn._isimmutable&&Tn._isimmutable();var An=Pn.zpp_inner;Pn.zpp_inner.outer=null,Pn.zpp_inner=null;var En=Pn;En.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=En:Ml.poolVec2=En,Ml.nextVec2=En,En.zpp_disp=!0;var Nn=An;null!=Nn.outer&&(Nn.outer.zpp_inner=null,Nn.outer=null),Nn._isimmutable=null,Nn._validate=null,Nn._invalidate=null,Nn.next=Mi.zpp_pool,Mi.zpp_pool=Nn}}else Mn=Cn,Cn=Cn.next}}if(null==e){null==Ti.zpp_pool?this.zpp_inner.material=new Ti:(this.zpp_inner.material=Ti.zpp_pool,Ti.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null)}else this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper();if(null==i){null==Ge.zpp_pool?this.zpp_inner.filter=new Ge:(this.zpp_inner.filter=Ge.zpp_pool,Ge.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null)}else this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper();this.zpp_inner_i.insert_cbtype(ce.ANY_SHAPE.zpp_inner)};l["nape.shape.Polygon"]=Qn,Qn.__name__=["nape","shape","Polygon"],Qn.rect=function(n,e,i,t,l){null==l&&(l=!1);var p;if(null==Ml.poolVec2?p=new On:(p=Ml.poolVec2,Ml.poolVec2=p.zpp_pool,p.zpp_pool=null,p.zpp_disp=!1,p==Ml.nextVec2&&(Ml.nextVec2=null)),null==p.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=e,p.zpp_inner=r,p.zpp_inner.outer=p}else{var a=p.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=p.zpp_inner;if(null!=o._validate&&o._validate(),p.zpp_inner.x==n){var _=p.zpp_inner;null!=_._validate&&_._validate(),s=p.zpp_inner.y==e}else s=!1;if(!s){p.zpp_inner.x=n,p.zpp_inner.y=e;var h=p.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}p.zpp_inner.weak=l;var u,x=n+i;if(null==Ml.poolVec2?u=new On:(u=Ml.poolVec2,Ml.poolVec2=u.zpp_pool,u.zpp_pool=null,u.zpp_disp=!1,u==Ml.nextVec2&&(Ml.nextVec2=null)),null==u.zpp_inner){var d;null==Mi.zpp_pool?d=new Mi:(d=Mi.zpp_pool,Mi.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=x,d.y=e,u.zpp_inner=d,u.zpp_inner.outer=u}else{var v=u.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=u.zpp_inner;if(null!=c._validate&&c._validate(),u.zpp_inner.x==x){var m=u.zpp_inner;null!=m._validate&&m._validate(),z=u.zpp_inner.y==e}else z=!1;if(!z){u.zpp_inner.x=x,u.zpp_inner.y=e;var y=u.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}u.zpp_inner.weak=l;var f,b=n+i,g=e+t;if(null==Ml.poolVec2?f=new On:(f=Ml.poolVec2,Ml.poolVec2=f.zpp_pool,f.zpp_pool=null,f.zpp_disp=!1,f==Ml.nextVec2&&(Ml.nextVec2=null)),null==f.zpp_inner){var w;null==Mi.zpp_pool?w=new Mi:(w=Mi.zpp_pool,Mi.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=b,w.y=g,f.zpp_inner=w,f.zpp_inner.outer=f}else{var M=f.zpp_inner;null!=M._isimmutable&&M._isimmutable();var C,k=f.zpp_inner;if(null!=k._validate&&k._validate(),f.zpp_inner.x==b){var O=f.zpp_inner;null!=O._validate&&O._validate(),C=f.zpp_inner.y==g}else C=!1;if(!C){f.zpp_inner.x=b,f.zpp_inner.y=g;var I=f.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}f.zpp_inner.weak=l;var S,P=e+t;if(null==Ml.poolVec2?S=new On:(S=Ml.poolVec2,Ml.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==Ml.nextVec2&&(Ml.nextVec2=null)),null==S.zpp_inner){var T;null==Mi.zpp_pool?T=new Mi:(T=Mi.zpp_pool,Mi.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=n,T.y=P,S.zpp_inner=T,S.zpp_inner.outer=S}else{var A=S.zpp_inner;null!=A._isimmutable&&A._isimmutable();var E,N=S.zpp_inner;if(null!=N._validate&&N._validate(),S.zpp_inner.x==n){var L=S.zpp_inner;null!=L._validate&&L._validate(),E=S.zpp_inner.y==P}else E=!1;if(!E){S.zpp_inner.x=n,S.zpp_inner.y=P;var V=S.zpp_inner;null!=V._invalidate&&V._invalidate(V)}}return S.zpp_inner.weak=l,[p,u,f,S]},Qn.box=function(n,e,i){return null==i&&(i=!1),Qn.rect(-n/2,-e/2,n,e,i)},Qn.regular=function(n,e,i,t,l){null==l&&(l=!1),null==t&&(t=0);for(var p=[],r=2*Math.PI/i,a=0,s=i;s>a;){var o,_=a++,h=_*r+t,u=Math.cos(h)*n,x=Math.sin(h)*e;if(null==Ml.poolVec2?o=new On:(o=Ml.poolVec2,Ml.poolVec2=o.zpp_pool,o.zpp_pool=null,o.zpp_disp=!1,o==Ml.nextVec2&&(Ml.nextVec2=null)),null==o.zpp_inner){var d;null==Mi.zpp_pool?d=new Mi:(d=Mi.zpp_pool,Mi.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=u,d.y=x,o.zpp_inner=d,o.zpp_inner.outer=o}else{var v=o.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z,c=o.zpp_inner;if(null!=c._validate&&c._validate(),o.zpp_inner.x==u){var m=o.zpp_inner;null!=m._validate&&m._validate(),z=o.zpp_inner.y==x}else z=!1;if(!z){o.zpp_inner.x=u,o.zpp_inner.y=x;var y=o.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}o.zpp_inner.weak=l;p.push(o)}return p},Qn.__super__=Kn,Qn.prototype=e(Kn.prototype,{zpp_inner_zn:null,get_localVerts:function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},get_worldVerts:function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},get_edges:function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},validity:function(){return this.zpp_inner_zn.valid()},__class__:Qn,__properties__:e(Kn.prototype.__properties__,{get_edges:"get_edges",get_worldVerts:"get_worldVerts",get_localVerts:"get_localVerts"})});var $n=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};l["nape.shape.ShapeIterator"]=$n,$n.__name__=["nape","shape","ShapeIterator"],$n.get=function(n){var e;if(null==$n.zpp_pool){yl.internal=!0;var i=new $n;yl.internal=!1,e=i}else{var t=$n.zpp_pool;$n.zpp_pool=t.zpp_next,e=t}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},$n.prototype={zpp_inner:null,zpp_i:null,zpp_critical:null,zpp_next:null,hasNext:function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,e>this.zpp_i||(this.zpp_next=$n.zpp_pool,$n.zpp_pool=this,this.zpp_inner=null,!1)},next:function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},__class__:$n};var ne=function(){this.zpp_inner=null,this.zpp_inner=new yl,this.zpp_inner.outer=this};l["nape.shape.ShapeList"]=ne,ne.__name__=["nape","shape","ShapeList"],ne.fromArray=function(n){for(var e=new ne,i=0;n.length>i;){var t=n[i];++i,e.push(t)}return e},ne.prototype={zpp_inner:null,get_length:function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},has:function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},at:function(n){this.zpp_inner.valmod();if(0>n?!0:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n>=this.zpp_inner.user_length),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),this.zpp_inner.at_index>n||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var i;if(null==this.zpp_inner.inner.head)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=i}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){n=this.zpp_inner.inner.head.elt;var e=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)i=null;else{var t=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),i=t.iterator_at(this.zpp_inner.user_length-2)}n=null==i?this.zpp_inner.inner.head.elt:i.next.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}return this.zpp_inner.invalidate(),n.outer},shift:function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length)e=null;else{var i=this.zpp_inner.inner;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=i.iterator_at(this.zpp_inner.user_length-2)}n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{n=this.zpp_inner.inner.head.elt;var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},add:function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},remove:function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e;e=!1;for(var i=this.zpp_inner.inner.head;null!=i;){if(i.elt==n.zpp_inner){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},empty:function(){return null==this.zpp_inner.inner.head},iterator:function(){return this.zpp_inner.valmod(),$n.get(this)},copy:function(n){null==n&&(n=!1);var e=new ne;this.zpp_inner.valmod();for(var i=$n.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=$n.zpp_pool,$n.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r,a=i.zpp_inner.at(i.zpp_i++);n||(r=a),e.push(r)}return e},merge:function(n){n.zpp_inner.valmod();for(var e=$n.get(n);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||(this.zpp_inner.reverse_flag?this.push(p):this.unshift(p))}},toString:function(){var n="[",e=!0;this.zpp_inner.valmod();for(var i=$n.get(this);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=$n.zpp_pool,$n.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);e||(n+=","),n+=null==r?"NULL":""+r,e=!1}return n+"]"},foreach:function(n){this.zpp_inner.valmod();for(var e=$n.get(this);;){e.zpp_inner.zpp_inner.valmod();var i=e.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var t=i.zpp_inner.user_length;e.zpp_critical=!0;var l;if(t>e.zpp_i?l=!0:(e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(p){e.zpp_next=$n.zpp_pool,$n.zpp_pool=e,e.zpp_inner=null;break}}return this},filter:function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length<=e)break;var i=this.at(e);try{n(i)?++e:this.remove(i)}catch(t){break}}return this},__class__:ne,__properties__:{get_length:"get_length"}};var ee=function(){};l["nape.shape.ShapeType"]=ee,ee.__name__=["nape","shape","ShapeType"],ee.__properties__={get_POLYGON:"get_POLYGON",get_CIRCLE:"get_CIRCLE"},ee.get_CIRCLE=function(){return null==me.ShapeType_CIRCLE&&(me.internal=!0,me.ShapeType_CIRCLE=new ee,me.internal=!1),me.ShapeType_CIRCLE},ee.get_POLYGON=function(){return null==me.ShapeType_POLYGON&&(me.internal=!0,me.ShapeType_POLYGON=new ee,me.internal=!1),me.ShapeType_POLYGON},ee.prototype={toString:function(){return null==me.ShapeType_CIRCLE&&(me.internal=!0,me.ShapeType_CIRCLE=new ee,me.internal=!1),this==me.ShapeType_CIRCLE?"CIRCLE":(null==me.ShapeType_POLYGON&&(me.internal=!0,me.ShapeType_POLYGON=new ee,me.internal=!1),this==me.ShapeType_POLYGON?"POLYGON":"")},__class__:ee};var ie=function(){};l["nape.shape.ValidationResult"]=ie,ie.__name__=["nape","shape","ValidationResult"],ie.__properties__={get_SELF_INTERSECTING:"get_SELF_INTERSECTING",get_CONCAVE:"get_CONCAVE",get_DEGENERATE:"get_DEGENERATE",get_VALID:"get_VALID"},ie.get_VALID=function(){return null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1),me.ValidationResult_VALID},ie.get_DEGENERATE=function(){return null==me.ValidationResult_DEGENERATE&&(me.internal=!0,me.ValidationResult_DEGENERATE=new ie,me.internal=!1),me.ValidationResult_DEGENERATE},ie.get_CONCAVE=function(){return null==me.ValidationResult_CONCAVE&&(me.internal=!0,me.ValidationResult_CONCAVE=new ie,me.internal=!1),me.ValidationResult_CONCAVE},ie.get_SELF_INTERSECTING=function(){return null==me.ValidationResult_SELF_INTERSECTING&&(me.internal=!0,me.ValidationResult_SELF_INTERSECTING=new ie,me.internal=!1),me.ValidationResult_SELF_INTERSECTING},ie.prototype={toString:function(){return null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1),this==me.ValidationResult_VALID?"VALID":(null==me.ValidationResult_DEGENERATE&&(me.internal=!0,me.ValidationResult_DEGENERATE=new ie,me.internal=!1),this==me.ValidationResult_DEGENERATE?"DEGENERATE":(null==me.ValidationResult_CONCAVE&&(me.internal=!0,me.ValidationResult_CONCAVE=new ie,me.internal=!1),this==me.ValidationResult_CONCAVE?"CONCAVE":(null==me.ValidationResult_SELF_INTERSECTING&&(me.internal=!0,me.ValidationResult_SELF_INTERSECTING=new ie,me.internal=!1),this==me.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},__class__:ie};var te=function(){};l["nape.space.Broadphase"]=te,te.__name__=["nape","space","Broadphase"],te.__properties__={get_SWEEP_AND_PRUNE:"get_SWEEP_AND_PRUNE",get_DYNAMIC_AABB_TREE:"get_DYNAMIC_AABB_TREE"},te.get_DYNAMIC_AABB_TREE=function(){return null==me.Broadphase_DYNAMIC_AABB_TREE&&(me.internal=!0,me.Broadphase_DYNAMIC_AABB_TREE=new te,me.internal=!1),me.Broadphase_DYNAMIC_AABB_TREE},te.get_SWEEP_AND_PRUNE=function(){return null==me.Broadphase_SWEEP_AND_PRUNE&&(me.internal=!0,me.Broadphase_SWEEP_AND_PRUNE=new te,me.internal=!1),me.Broadphase_SWEEP_AND_PRUNE},te.prototype={toString:function(){return null==me.Broadphase_DYNAMIC_AABB_TREE&&(me.internal=!0,me.Broadphase_DYNAMIC_AABB_TREE=new te,me.internal=!1),this==me.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==me.Broadphase_SWEEP_AND_PRUNE&&(me.internal=!0,me.Broadphase_SWEEP_AND_PRUNE=new te,me.internal=!1),this==me.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},__class__:te};var le=function(n,e){if(this.zpp_inner=null,this.zpp_inner=new qi(null==n?null:n.zpp_inner,e),this.zpp_inner.outer=this,null!=n&&n.zpp_inner.weak){var i=n.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var l=n;l.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=l:Ml.poolVec2=l,Ml.nextVec2=l,l.zpp_disp=!0;var p=t;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Mi.zpp_pool,Mi.zpp_pool=p}};l["nape.space.Space"]=le,le.__name__=["nape","space","Space"],le.prototype={zpp_inner:null,get_userData:function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},get_gravity:function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},set_gravity:function(n){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var e=this.zpp_inner.wrap_gravity,i=e.zpp_inner;null!=i._isimmutable&&i._isimmutable();var t=n.zpp_inner;null!=t._validate&&t._validate();var l=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner.y,a=e.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==l){var _=e.zpp_inner;null!=_._validate&&_._validate(),s=e.zpp_inner.y==r}else s=!1;if(!s){e.zpp_inner.x=l,e.zpp_inner.y=r;var h=e.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;null!=u._isimmutable&&u._isimmutable();var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var d=n;d.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=d:Ml.poolVec2=d,Ml.nextVec2=d,d.zpp_disp=!0;var v=x;null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v}return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},get_broadphase:function(){return this.zpp_inner.bphase.is_sweep?(null==me.Broadphase_SWEEP_AND_PRUNE&&(me.internal=!0,me.Broadphase_SWEEP_AND_PRUNE=new te,me.internal=!1),me.Broadphase_SWEEP_AND_PRUNE):(null==me.Broadphase_DYNAMIC_AABB_TREE&&(me.internal=!0,me.Broadphase_DYNAMIC_AABB_TREE=new te,me.internal=!1),me.Broadphase_DYNAMIC_AABB_TREE)},get_sortContacts:function(){return this.zpp_inner.sortcontacts},set_sortContacts:function(n){return this.zpp_inner.sortcontacts=n},get_worldAngularDrag:function(){return this.zpp_inner.global_ang_drag},set_worldAngularDrag:function(n){var e=n;return this.zpp_inner.global_ang_drag=e},get_worldLinearDrag:function(){return this.zpp_inner.global_lin_drag},set_worldLinearDrag:function(n){var e=n;return this.zpp_inner.global_lin_drag=e},get_compounds:function(){return this.zpp_inner.wrap_compounds},get_bodies:function(){return this.zpp_inner.wrap_bodies},get_liveBodies:function(){return this.zpp_inner.wrap_live},get_constraints:function(){return this.zpp_inner.wrap_constraints},get_liveConstraints:function(){return this.zpp_inner.wrap_livecon},visitBodies:function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var i=Nn.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Nn.zpp_pool,Nn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;n(i.zpp_inner.at(i.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var a=Dn.get(r);;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;a.zpp_critical=!0;var _;if(o>a.zpp_i?_=!0:(a.zpp_next=Dn.zpp_pool,Dn.zpp_pool=a,a.zpp_inner=null,_=!1),!_)break;a.zpp_critical=!1;a.zpp_inner.at(a.zpp_i++).visitBodies(n)}},visitConstraints:function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var i=G.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=G.zpp_pool,G.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;n(i.zpp_inner.at(i.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var a=Dn.get(r);;){a.zpp_inner.zpp_inner.valmod();var s=a.zpp_inner;s.zpp_inner.valmod(),s.zpp_inner.zip_length&&(s.zpp_inner.zip_length=!1,s.zpp_inner.user_length=s.zpp_inner.inner.length);var o=s.zpp_inner.user_length;a.zpp_critical=!0;var _;if(o>a.zpp_i?_=!0:(a.zpp_next=Dn.zpp_pool,Dn.zpp_pool=a,a.zpp_inner=null,_=!1),!_)break;a.zpp_critical=!1;a.zpp_inner.at(a.zpp_i++).visitConstraints(n)}},visitCompounds:function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var i=Dn.get(e);;){i.zpp_inner.zpp_inner.valmod();var t=i.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var l=t.zpp_inner.user_length;i.zpp_critical=!0;var p;if(l>i.zpp_i?p=!0:(i.zpp_next=Dn.zpp_pool,Dn.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++);n(r),r.visitCompounds(n)}},get_world:function(){return this.zpp_inner.__static},get_arbiters:function(){if(null==this.zpp_inner.wrap_arbiters){var n=new Ue;n.space=this.zpp_inner,this.zpp_inner.wrap_arbiters=n}return this.zpp_inner.wrap_arbiters},get_listeners:function(){return this.zpp_inner.wrap_listeners},clear:function(){this.zpp_inner.clear()},step:function(n,e,i){null==i&&(i=10),null==e&&(e=10),this.zpp_inner.step(n,e,i)},get_timeStamp:function(){return this.zpp_inner.stamp},get_elapsedTime:function(){return this.zpp_inner.time},interactionType:function(n,e){if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null).zpp_inner.type==me.id_BodyType_STATIC&&(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null).zpp_inner.type==me.id_BodyType_STATIC)return null;if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null)==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))return null;var i,t=n.zpp_inner,l=e.zpp_inner,p=t.body,r=l.body;i=!1;for(var a=p.constraints.head;null!=a;){var s=a.elt;if(s.ignore&&s.pair_exists(p.id,r.id)){i=!0;break}a=a.next}var o,_;if(i)_=!1;else{for(var h=t;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:null!=h.icompound?h.icompound.compound:h.ibody.compound;var u,x=null==h?null:h.group;if(null==x)u=!1;else{for(var d=l;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var v=null==d?null:d.group;if(null==v)u=!1;else{for(var z=!1;null!=x&&null!=v;){if(x==v){z=x.ignore;break}v.depth>x.depth?v=v.group:x=x.group}u=z}}_=!u}if(_){var c;if(t.sensorEnabled||l.sensorEnabled){var m=t.filter,y=l.filter;c=0!=(m.sensorMask&y.sensorGroup)&&0!=(y.sensorMask&m.sensorGroup)}else c=!1;if(c)o=2;else{var f;if(t.fluidEnabled||l.fluidEnabled){var b=t.filter,g=l.filter;f=0!=(b.fluidMask&g.fluidGroup)&&0!=(g.fluidMask&b.fluidGroup)}else f=!1;if(!!f&&!(0==p.imass&&0==r.imass&&0==p.iinertia&&0==r.iinertia))o=0;else{var w,M=t.filter,C=l.filter;w=0!=(M.collisionMask&C.collisionGroup)&&0!=(C.collisionMask&M.collisionGroup)&&!(0==p.imass&&0==r.imass&&0==p.iinertia&&0==r.iinertia),o=w?1:-1}}}else o=-1;switch(o){case 0:return null==me.InteractionType_FLUID&&(me.internal=!0,me.InteractionType_FLUID=new A,me.internal=!1),me.InteractionType_FLUID;case 1:return null==me.InteractionType_COLLISION&&(me.internal=!0,me.InteractionType_COLLISION=new A,me.internal=!1),me.InteractionType_COLLISION;case 2:return null==me.InteractionType_SENSOR&&(me.internal=!0,me.InteractionType_SENSOR=new A,me.internal=!1),me.InteractionType_SENSOR;default:return null}},shapesUnderPoint:function(n,e,i){var t=this.zpp_inner,l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=t.shapesUnderPoint(p,n.zpp_inner.y,null==e?null:e.zpp_inner,i);if(n.zpp_inner.weak){var s=n.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=_:Ml.poolVec2=_,Ml.nextVec2=_,_.zpp_disp=!0;var h=o;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Mi.zpp_pool,Mi.zpp_pool=h}return a},bodiesUnderPoint:function(n,e,i){var t=this.zpp_inner,l=n.zpp_inner;null!=l._validate&&l._validate();var p=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var a=t.bodiesUnderPoint(p,n.zpp_inner.y,null==e?null:e.zpp_inner,i);if(n.zpp_inner.weak){var s=n.zpp_inner;null!=s._isimmutable&&s._isimmutable();var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var _=n;_.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=_:Ml.poolVec2=_,Ml.nextVec2=_,_.zpp_disp=!0;var h=o;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Mi.zpp_pool,Mi.zpp_pool=h}return a},shapesInAABB:function(n,e,i,t,l){null==i&&(i=!0),null==e&&(e=!1);var p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner;if(r.maxx-r.minx!=0){var a=n.zpp_inner;null!=a._validate&&a._validate();var s=n.zpp_inner;s.maxy-s.miny==0}else!0;return this.zpp_inner.shapesInAABB(n,i,e,null==t?null:t.zpp_inner,l)},bodiesInAABB:function(n,e,i,t,l){null==i&&(i=!0),null==e&&(e=!1);var p=n.zpp_inner;null!=p._validate&&p._validate();var r=n.zpp_inner;if(r.maxx-r.minx!=0){var a=n.zpp_inner;null!=a._validate&&a._validate();var s=n.zpp_inner;s.maxy-s.miny==0}else!0;return this.zpp_inner.bodiesInAABB(n,i,e,null==t?null:t.zpp_inner,l)},shapesInCircle:function(n,e,i,t,l){null==i&&(i=!1);var p=this.zpp_inner.shapesInCircle(n,e,i,null==t?null:t.zpp_inner,l);if(n.zpp_inner.weak){var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}return p},bodiesInCircle:function(n,e,i,t,l){null==i&&(i=!1);var p=this.zpp_inner.bodiesInCircle(n,e,i,null==t?null:t.zpp_inner,l);if(n.zpp_inner.weak){var r=n.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var s=n;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}return p},shapesInShape:function(n,e,i,t){if(null==e&&(e=!1),n.zpp_inner.type==me.id_ShapeType_POLYGON){n.zpp_inner.polygon.valid();null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1)}return this.zpp_inner.shapesInShape(n.zpp_inner,e,null==i?null:i.zpp_inner,t)},bodiesInShape:function(n,e,i,t){if(null==e&&(e=!1),n.zpp_inner.type==me.id_ShapeType_POLYGON){n.zpp_inner.polygon.valid();null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1)}return this.zpp_inner.bodiesInShape(n.zpp_inner,e,null==i?null:i.zpp_inner,t)},shapesInBody:function(n,e,i){var t=null==i?new ne:i,l=n.zpp_inner.wrap_shapes;l.zpp_inner.valmod();for(var p=$n.get(l);;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var a=r.zpp_inner.user_length;p.zpp_critical=!0;var s;if(a>p.zpp_i?s=!0:(p.zpp_next=$n.zpp_pool,$n.zpp_pool=p,p.zpp_inner=null,s=!1),!s)break;p.zpp_critical=!1;var o=p.zpp_inner.at(p.zpp_i++);this.shapesInShape(o,!1,e,t)}return t},bodiesInBody:function(n,e,i){var t=null==i?new Ln:i,l=n.zpp_inner.wrap_shapes;l.zpp_inner.valmod();for(var p=$n.get(l);;){p.zpp_inner.zpp_inner.valmod();var r=p.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var a=r.zpp_inner.user_length;p.zpp_critical=!0;var s;if(a>p.zpp_i?s=!0:(p.zpp_next=$n.zpp_pool,$n.zpp_pool=p,p.zpp_inner=null,s=!1),!s)break;p.zpp_critical=!1;var o=p.zpp_inner.at(p.zpp_i++);this.bodiesInShape(o,!1,e,t)}return t},convexCast:function(n,e,i,t){return null==i&&(i=!1),this.zpp_inner.convexCast(n.zpp_inner,e,t,i)},convexMultiCast:function(n,e,i,t,l){return null==i&&(i=!1),this.zpp_inner.convexMultiCast(n.zpp_inner,e,t,i,l)},rayCast:function(n,e,i){return null==e&&(e=!1),this.zpp_inner.rayCast(n,e,i)},rayMultiCast:function(n,e,i,t){return null==e&&(e=!1),this.zpp_inner.rayMultiCast(n,e,i,t)},__class__:le,__properties__:{get_elapsedTime:"get_elapsedTime",get_timeStamp:"get_timeStamp",get_listeners:"get_listeners",get_arbiters:"get_arbiters",get_world:"get_world",get_liveConstraints:"get_liveConstraints",get_constraints:"get_constraints",get_liveBodies:"get_liveBodies",get_bodies:"get_bodies",get_compounds:"get_compounds",set_worldLinearDrag:"set_worldLinearDrag",get_worldLinearDrag:"get_worldLinearDrag",set_worldAngularDrag:"set_worldAngularDrag",get_worldAngularDrag:"get_worldAngularDrag",set_sortContacts:"set_sortContacts",get_sortContacts:"get_sortContacts",get_broadphase:"get_broadphase",set_gravity:"set_gravity",get_gravity:"get_gravity",get_userData:"get_userData"}};var pe=function(){};l["nape.util.Debug"]=pe,pe.__name__=["nape","util","Debug"],pe.version=function(){return"Nape 2.0.19"},pe.clearObjectPools=function(){for(;null!=G.zpp_pool;){var n=G.zpp_pool.zpp_next;G.zpp_pool.zpp_next=null,G.zpp_pool=n}for(;null!=Zn.zpp_pool;){var e=Zn.zpp_pool.zpp_next;Zn.zpp_pool.zpp_next=null,Zn.zpp_pool=e}for(;null!=Nn.zpp_pool;){var i=Nn.zpp_pool.zpp_next;Nn.zpp_pool.zpp_next=null,Nn.zpp_pool=i}for(;null!=Dn.zpp_pool;){var t=Dn.zpp_pool.zpp_next;Dn.zpp_pool.zpp_next=null,Dn.zpp_pool=t}for(;null!=E.zpp_pool;){var l=E.zpp_pool.zpp_next;E.zpp_pool.zpp_next=null,E.zpp_pool=l}for(;null!=k.zpp_pool;){var p=k.zpp_pool.zpp_next;k.zpp_pool.zpp_next=null,k.zpp_pool=p}for(;null!=xn.zpp_pool;){var r=xn.zpp_pool.zpp_next;xn.zpp_pool.zpp_next=null,xn.zpp_pool=r}for(;null!=cn.zpp_pool;){var a=cn.zpp_pool.zpp_next;cn.zpp_pool.zpp_next=null,cn.zpp_pool=a}for(;null!=In.zpp_pool;){var s=In.zpp_pool.zpp_next;In.zpp_pool.zpp_next=null,In.zpp_pool=s}for(;null!=Cn.zpp_pool;){var o=Cn.zpp_pool.zpp_next;Cn.zpp_pool.zpp_next=null,Cn.zpp_pool=o}for(;null!=$n.zpp_pool;){var _=$n.zpp_pool.zpp_next;$n.zpp_pool.zpp_next=null,$n.zpp_pool=_}for(;null!=Xn.zpp_pool;){var h=Xn.zpp_pool.zpp_next;Xn.zpp_pool.zpp_next=null,Xn.zpp_pool=h}for(;null!=ln.zpp_pool;){var u=ln.zpp_pool.zpp_next;ln.zpp_pool.zpp_next=null,ln.zpp_pool=u}for(;null!=Q.zpp_pool;){var x=Q.zpp_pool.zpp_next;Q.zpp_pool.zpp_next=null,Q.zpp_pool=x}for(;null!=on.zpp_pool;){var d=on.zpp_pool.zpp_next;on.zpp_pool.zpp_next=null,on.zpp_pool=d}for(;null!=kt.zpp_pool;){var v=kt.zpp_pool.next;kt.zpp_pool.next=null,kt.zpp_pool=v}for(;null!=Ot.zpp_pool;){var z=Ot.zpp_pool.next;Ot.zpp_pool.next=null,Ot.zpp_pool=z}for(;null!=Ti.zpp_pool;){var c=Ti.zpp_pool.next;Ti.zpp_pool.next=null,Ti.zpp_pool=c}for(;null!=It.zpp_pool;){var m=It.zpp_pool.next;It.zpp_pool.next=null,It.zpp_pool=m}for(;null!=Pi.zpp_pool;){var y=Pi.zpp_pool.next;Pi.zpp_pool.next=null,Pi.zpp_pool=y}for(;null!=St.zpp_pool;){var f=St.zpp_pool.next;St.zpp_pool.next=null,St.zpp_pool=f}for(;null!=Pt.zpp_pool;){var b=Pt.zpp_pool.next;Pt.zpp_pool.next=null,Pt.zpp_pool=b}for(;null!=Tt.zpp_pool;){var g=Tt.zpp_pool.next;Tt.zpp_pool.next=null,Tt.zpp_pool=g}for(;null!=_e.zpp_pool;){var w=_e.zpp_pool.next;_e.zpp_pool.next=null,_e.zpp_pool=w}for(;null!=At.zpp_pool;){var M=At.zpp_pool.next;At.zpp_pool.next=null,At.zpp_pool=M}for(;null!=Et.zpp_pool;){var C=Et.zpp_pool.next;Et.zpp_pool.next=null,Et.zpp_pool=C}for(;null!=Nt.zpp_pool;){var O=Nt.zpp_pool.next;Nt.zpp_pool.next=null,Nt.zpp_pool=O}for(;null!=Lt.zpp_pool;){var I=Lt.zpp_pool.next;Lt.zpp_pool.next=null,Lt.zpp_pool=I}for(;null!=Vt.zpp_pool;){var S=Vt.zpp_pool.next;Vt.zpp_pool.next=null,Vt.zpp_pool=S}for(;null!=jt.zpp_pool;){var P=jt.zpp_pool.next;jt.zpp_pool.next=null,jt.zpp_pool=P}for(;null!=Cl.zpp_pool;){var T=Cl.zpp_pool.next;Cl.zpp_pool.next=null,Cl.zpp_pool=T}for(;null!=oe.zpp_pool;){var A=oe.zpp_pool.next;oe.zpp_pool.next=null,oe.zpp_pool=A}for(;null!=Dt.zpp_pool;){var N=Dt.zpp_pool.next;Dt.zpp_pool.next=null,Dt.zpp_pool=N}for(;null!=se.zpp_pool;){var L=se.zpp_pool.next;se.zpp_pool.next=null,se.zpp_pool=L}for(;null!=ni.zpp_pool;){var V=ni.zpp_pool.next;ni.zpp_pool.next=null,ni.zpp_pool=V}for(;null!=ii.zpp_pool;){var j=ii.zpp_pool.next;ii.zpp_pool.next=null,ii.zpp_pool=j}for(;null!=kl.zpp_pool;){var D=kl.zpp_pool.next;kl.zpp_pool.next=null,kl.zpp_pool=D}for(;null!=ri.zpp_pool;){var F=ri.zpp_pool.next;ri.zpp_pool.next=null,ri.zpp_pool=F}for(;null!=Xe.zpp_pool;){var R=Xe.zpp_pool.next;Xe.zpp_pool.next=null,Xe.zpp_pool=R}for(;null!=He.zpp_pool;){var B=He.zpp_pool.next;He.zpp_pool.next=null,He.zpp_pool=B}for(;null!=Ft.zpp_pool;){var Z=Ft.zpp_pool.next;Ft.zpp_pool.next=null,Ft.zpp_pool=Z}for(;null!=Rt.zpp_pool;){var U=Rt.zpp_pool.next;Rt.zpp_pool.next=null,Rt.zpp_pool=U}for(;null!=Mi.zpp_pool;){var q=Mi.zpp_pool.next;Mi.zpp_pool.next=null,Mi.zpp_pool=q}for(;null!=Bt.zpp_pool;){var Y=Bt.zpp_pool.next;Bt.zpp_pool.next=null,Bt.zpp_pool=Y}for(;null!=oi.zpp_pool;){var K=oi.zpp_pool.next;oi.zpp_pool.next=null,oi.zpp_pool=K}for(;null!=Ol.zpp_pool;){var W=Ol.zpp_pool.next;Ol.zpp_pool.next=null,Ol.zpp_pool=W}for(;null!=_i.zpp_pool;){var J=_i.zpp_pool.next;_i.zpp_pool.next=null,_i.zpp_pool=J}for(;null!=Gt.zpp_pool;){var X=Gt.zpp_pool.next;Gt.zpp_pool.next=null,Gt.zpp_pool=X}for(;null!=gi.zpp_pool;){var H=gi.zpp_pool.next;gi.zpp_pool.next=null,gi.zpp_pool=H}for(;null!=Il.zpp_pool;){var $=Il.zpp_pool.next;Il.zpp_pool.next=null,Il.zpp_pool=$}for(;null!=Zt.zpp_pool;){var nn=Zt.zpp_pool.next;Zt.zpp_pool.next=null,Zt.zpp_pool=nn}for(;null!=ci.zpp_pool;){var en=ci.zpp_pool.next;ci.zpp_pool.next=null,ci.zpp_pool=en}for(;null!=mi.zpp_pool;){var tn=mi.zpp_pool.next;mi.zpp_pool.next=null,mi.zpp_pool=tn}for(;null!=Ut.zpp_pool;){var pn=Ut.zpp_pool.next;Ut.zpp_pool.next=null,Ut.zpp_pool=pn}for(;null!=qe.zpp_pool;){var rn=qe.zpp_pool.next;qe.zpp_pool.next=null,qe.zpp_pool=rn}for(;null!=fi.zpp_pool;){var an=fi.zpp_pool.next;fi.zpp_pool.next=null,fi.zpp_pool=an}for(;null!=Sl.zpp_pool;){var sn=Sl.zpp_pool.next;Sl.zpp_pool.next=null,Sl.zpp_pool=sn}for(;null!=ui.zpp_pool;){var _n=ui.zpp_pool.next;ui.zpp_pool.next=null,ui.zpp_pool=_n}for(;null!=xi.zpp_pool;){var hn=xi.zpp_pool.next;xi.zpp_pool.next=null,xi.zpp_pool=hn}for(;null!=Pl.zpp_pool;){var un=Pl.zpp_pool.next;Pl.zpp_pool.next=null,Pl.zpp_pool=un}for(;null!=ti.zpp_pool;){var dn=ti.zpp_pool.next;ti.zpp_pool.next=null,ti.zpp_pool=dn}for(;null!=li.zpp_pool;){var vn=li.zpp_pool.next;li.zpp_pool.next=null,li.zpp_pool=vn}for(;null!=Tl.zpp_pool;){var zn=Tl.zpp_pool.next;Tl.zpp_pool.next=null,Tl.zpp_pool=zn}for(;null!=di.zpp_pool;){var mn=di.zpp_pool.next;di.zpp_pool.next=null,di.zpp_pool=mn}for(;null!=Hi.zpp_pool;){var yn=Hi.zpp_pool.next;Hi.zpp_pool.next=null,Hi.zpp_pool=yn}for(;null!=qt.zpp_pool;){var fn=qt.zpp_pool.next;qt.zpp_pool.next=null,qt.zpp_pool=fn}for(;null!=Yt.zpp_pool;){var bn=Yt.zpp_pool.next;Yt.zpp_pool.next=null,Yt.zpp_pool=bn}for(;null!=Kt.zpp_pool;){var gn=Kt.zpp_pool.next;Kt.zpp_pool.next=null,Kt.zpp_pool=gn}for(;null!=Ni.zpp_pool;){var wn=Ni.zpp_pool.next;Ni.zpp_pool.next=null,Ni.zpp_pool=wn}for(;null!=Wt.zpp_pool;){var Mn=Wt.zpp_pool.next;Wt.zpp_pool.next=null,Wt.zpp_pool=Mn}for(;null!=Jt.zpp_pool;){var kn=Jt.zpp_pool.next;Jt.zpp_pool.next=null,Jt.zpp_pool=kn}for(;null!=Yi.zpp_pool;){var On=Yi.zpp_pool.next;Yi.zpp_pool.next=null,Yi.zpp_pool=On}for(;null!=ji.zpp_pool;){var Sn=ji.zpp_pool.next;ji.zpp_pool.next=null,ji.zpp_pool=Sn}for(;null!=Di.zpp_pool;){var Pn=Di.zpp_pool.next;Di.zpp_pool.next=null,Di.zpp_pool=Pn}for(;null!=Re.zpp_pool;){var Tn=Re.zpp_pool.next;Re.zpp_pool.next=null,Re.zpp_pool=Tn}for(;null!=Xt.zpp_pool;){var An=Xt.zpp_pool.next;Xt.zpp_pool.next=null,Xt.zpp_pool=An}for(;null!=Ht.zpp_pool;){var En=Ht.zpp_pool.next;Ht.zpp_pool.next=null,Ht.zpp_pool=En}for(;null!=Bi.zpp_pool;){var Ln=Bi.zpp_pool.next;Bi.zpp_pool.next=null,Bi.zpp_pool=Ln}for(;null!=Gi.zpp_pool;){var Vn=Gi.zpp_pool.next;Gi.zpp_pool.next=null,Gi.zpp_pool=Vn}for(;null!=Zi.zpp_pool;){var jn=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=jn}for(;null!=Al.zpp_pool;){var Fn=Al.zpp_pool.next;Al.zpp_pool.next=null,Al.zpp_pool=Fn}for(;null!=Qt.zpp_pool;){var Rn=Qt.zpp_pool.next;Qt.zpp_pool.next=null,Qt.zpp_pool=Rn}for(;null!=$t.zpp_pool;){var Bn=$t.zpp_pool.next;$t.zpp_pool.next=null,$t.zpp_pool=Bn}for(;null!=Ge.zpp_pool;){var Gn=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=Gn}for(;null!=nl.zpp_pool;){var Un=nl.zpp_pool.next;nl.zpp_pool.next=null,nl.zpp_pool=Un}for(;null!=el.zpp_pool;){var qn=el.zpp_pool.next;el.zpp_pool.next=null,el.zpp_pool=qn}for(;null!=il.zpp_pool;){var Yn=il.zpp_pool.next;il.zpp_pool.next=null,il.zpp_pool=Yn}for(;null!=je.zpp_pool;){var Kn=je.zpp_pool.next;je.zpp_pool.next=null,je.zpp_pool=Kn}for(;null!=De.zpp_pool;){var Wn=De.zpp_pool.next;De.zpp_pool.next=null,De.zpp_pool=Wn}for(;null!=tl.zpp_pool;){var Jn=tl.zpp_pool.next;tl.zpp_pool.next=null,tl.zpp_pool=Jn}for(;null!=Fe.zpp_pool;){var Hn=Fe.zpp_pool.next;Fe.zpp_pool.next=null,Fe.zpp_pool=Hn}for(;null!=ll.zpp_pool;){var Qn=ll.zpp_pool.next;ll.zpp_pool.next=null,ll.zpp_pool=Qn}for(;null!=pl.zpp_pool;){var ne=pl.zpp_pool.next;pl.zpp_pool.next=null,pl.zpp_pool=ne}for(;null!=rl.zpp_pool;){var ee=rl.zpp_pool.next;rl.zpp_pool.next=null,rl.zpp_pool=ee}for(;null!=Ml.poolGeomPoly;){var ie=Ml.poolGeomPoly.zpp_pool;Ml.poolGeomPoly.zpp_pool=null,Ml.poolGeomPoly=ie}for(;null!=Ml.poolVec2;){var te=Ml.poolVec2.zpp_pool;Ml.poolVec2.zpp_pool=null,Ml.poolVec2=te}for(;null!=Ml.poolVec3;){var le=Ml.poolVec3.zpp_pool;Ml.poolVec3.zpp_pool=null,Ml.poolVec3=le}};var re=function(){};l["zpp_nape.ZPP_Const"]=re,re.__name__=["zpp_nape","ZPP_Const"],re.POSINF=function(){return Infinity},re.NEGINF=function(){return-Infinity};var ae=function(){};l["zpp_nape.ZPP_ID"]=ae,ae.__name__=["zpp_nape","ZPP_ID"],ae.Constraint=function(){return ae._Constraint++},ae.Interactor=function(){return ae._Interactor++},ae.CbType=function(){return ae._CbType++},ae.CbSet=function(){return ae._CbSet++},ae.Listener=function(){return ae._Listener++},ae.ZPP_SimpleVert=function(){return ae._ZPP_SimpleVert++},ae.ZPP_SimpleSeg=function(){return ae._ZPP_SimpleSeg++},ae.Space=function(){return ae._Space++},ae.InteractionGroup=function(){return ae._InteractionGroup++};var se=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};l["zpp_nape.callbacks.ZPP_Callback"]=se,se.__name__=["zpp_nape","callbacks","ZPP_Callback"],se.prototype={outer_body:null,outer_con:null,outer_int:null,wrapper_body:function(){return null==this.outer_body&&(se.internal=!0,this.outer_body=new b,se.internal=!1,this.outer_body.zpp_inner=this),this.outer_body},wrapper_con:function(){return null==this.outer_con&&(se.internal=!0,this.outer_con=new I,se.internal=!1,this.outer_con.zpp_inner=this),this.outer_con},wrapper_int:function(){return null==this.outer_int&&(se.internal=!0,this.outer_int=new P,se.internal=!1,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=bl.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},event:null,listener:null,space:null,index:null,next:null,prev:null,length:null,push:function(n){null!=this.prev?this.prev.next=n:this.next=n,n.prev=this.prev,n.next=null,this.prev=n,this.length++},push_rev:function(n){null!=this.next?this.next.prev=n:this.prev=n,n.next=this.next,n.prev=null,this.next=n,this.length++},pop:function(){var n=this.next;return this.next=n.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,n},pop_rev:function(){var n=this.prev;return this.prev=n.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,n},empty:function(){return null==this.next},clear:function(){for(;!this.empty();)this.pop()},splice:function(n){var e=n.next;return null==n.prev?(this.next=n.next,null!=this.next?this.next.prev=null:this.prev=null):(n.prev.next=n.next,null!=n.next?n.next.prev=n.prev:this.prev=n.prev),this.length--,e},rotateL:function(){this.push(this.pop())},rotateR:function(){this.push_rev(this.pop_rev())},cycleNext:function(n){return null==n.next?this.next:n.next},cyclePrev:function(n){return null==n.prev?this.prev:n.prev},at:function(n){for(var e=this.next;0!=n--;)e=e.next;return e},rev_at:function(n){for(var e=this.prev;0!=n--;)e=e.prev;return e},free:function(){this.int1=this.int2=null,this.body=null,this.constraint=null,this.listener=null,null!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},alloc:function(){},int1:null,int2:null,set:null,wrap_arbiters:null,pre_arbiter:null,pre_swapped:null,genarbs:function(){null==this.wrap_arbiters?this.wrap_arbiters=bl.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},body:null,constraint:null,__class__:se};var oe=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new ge,this.listeners=new he,this.zip_listeners=!0,this.bodylisteners=new ue,this.zip_bodylisteners=!0,this.conlisteners=new xe,this.zip_conlisteners=!0,this.constraints=new de,this.interactors=new ve,this.id=ae.CbSet(),this.cbpairs=new lt};l["zpp_nape.callbacks.ZPP_CbSet"]=oe,oe.__name__=["zpp_nape","callbacks","ZPP_CbSet"],oe.setlt=function(n,e){for(var i=n.cbTypes.head,t=e.cbTypes.head;null!=i&&null!=t;){var l=i.elt,p=t.elt;if(p.id>l.id)return!0;if(l.id>p.id)return!1;i=i.next,t=t.next}return null!=t&&null==i},oe.get=function(n){var e;null==oe.zpp_pool?e=new oe:(e=oe.zpp_pool,oe.zpp_pool=e.next,e.next=null);for(var i=null,t=n.head;null!=t;){var l=t.elt;i=e.cbTypes.insert(i,l),l.cbsets.add(e),t=t.next}return e},oe.compatible=function(n,e,i){var t,l=n.options1,p=e.cbTypes;if(l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)){var r=n.options2,a=i.cbTypes;t=!!r.nonemptyintersection(a,r.includes)&&!r.nonemptyintersection(a,r.excludes)}else t=!1;if(t)return!0;var s=n.options2,o=e.cbTypes;if(s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)){var _=n.options1,h=i.cbTypes;return!!_.nonemptyintersection(h,_.includes)&&!_.nonemptyintersection(h,_.excludes)}return!1},oe.empty_intersection=function(n,e){for(var i=null,t=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,l=t.head;null!=l;){var p=l.elt;if(p.a==n&&p.b==e||p.a==e&&p.b==n){i=p;break}l=l.next}if(null==i){var r;null==_e.zpp_pool?r=new _e:(r=_e.zpp_pool,_e.zpp_pool=r.next,r.next=null),r.zip_listeners=!0,oe.setlt(n,e)?(r.a=n,r.b=e):(r.a=e,r.b=n),i=r,n.cbpairs.add(i),e!=n&&e.cbpairs.add(i)}return i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),null==i.listeners.head},oe.single_intersection=function(n,e,i){for(var t=null,l=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,p=l.head;null!=p;){var r=p.elt;if(r.a==n&&r.b==e||r.a==e&&r.b==n){t=r;break}p=p.next}if(null==t){var a;null==_e.zpp_pool?a=new _e:(a=_e.zpp_pool,_e.zpp_pool=a.next,a.next=null),a.zip_listeners=!0,oe.setlt(n,e)?(a.a=n,a.b=e):(a.a=e,a.b=n),t=a,n.cbpairs.add(t),e!=n&&e.cbpairs.add(t)}t.zip_listeners&&(t.zip_listeners=!1,t.__validate());var s=t.listeners.head;return null!=s&&s.elt==i&&null==s.next},oe.find_all=function(n,e,i,t){for(var l=null,p=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,r=p.head;null!=r;){var a=r.elt;if(a.a==n&&a.b==e||a.a==e&&a.b==n){l=a;break}r=r.next}if(null==l){var s;null==_e.zpp_pool?s=new _e:(s=_e.zpp_pool,_e.zpp_pool=s.next,s.next=null),s.zip_listeners=!0,oe.setlt(n,e)?(s.a=n,s.b=e):(s.a=e,s.b=n),l=s,n.cbpairs.add(l),e!=n&&e.cbpairs.add(l)}l.zip_listeners&&(l.zip_listeners=!1,l.__validate());for(var o=l.listeners.head;null!=o;){var _=o.elt;_.event==i&&t(_),o=o.next}},oe.prototype={cbTypes:null,count:null,next:null,id:null,manager:null,cbpairs:null,increment:function(){this.count++},decrement:function(){return 0==--this.count},invalidate_pairs:function(){for(var n=this.cbpairs.head;null!=n;){n.elt.zip_listeners=!0,n=n.next}},listeners:null,zip_listeners:null,invalidate_listeners:function(){this.zip_listeners=!0,this.invalidate_pairs()},validate_listeners:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},realvalidate_listeners:function(){this.listeners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,i=null,t=this.listeners.head,l=e.listeners.head;null!=l;){var p=l.elt;if(null!=t&&t.elt==p)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var a=t.elt;r=p.precedence>a.precedence||p.precedence==a.precedence&&p.id>a.id}else r=!0;if(r){if(p.space==this.manager.space){var s,o=this.listeners;null==At.zpp_pool?s=new At:(s=At.zpp_pool,At.zpp_pool=s.next,s.next=null),s.elt=p;var _=s;null==i?(_.next=o.head,o.head=_):(_.next=i.next,i.next=_),o.pushmod=o.modified=!0,o.length++,i=_}l=l.next}else i=t,t=t.next}}n=n.next}},bodylisteners:null,zip_bodylisteners:null,invalidate_bodylisteners:function(){this.zip_bodylisteners=!0},validate_bodylisteners:function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,i=null,t=this.bodylisteners.head,l=e.bodylisteners.head;null!=l;){var p=l.elt;if(null!=t&&t.elt==p)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var a=t.elt;r=p.precedence>a.precedence||p.precedence==a.precedence&&p.id>a.id}else r=!0;if(r){var s=p.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&p.space==this.manager.space){var o,_=this.bodylisteners;null==Lt.zpp_pool?o=new Lt:(o=Lt.zpp_pool,Lt.zpp_pool=o.next,o.next=null),o.elt=p;var h=o;null==i?(h.next=_.head,_.head=h):(h.next=i.next,i.next=h),_.pushmod=_.modified=!0,_.length++,i=h}l=l.next}else i=t,t=t.next}}n=n.next}},conlisteners:null,zip_conlisteners:null,invalidate_conlisteners:function(){this.zip_conlisteners=!0},validate_conlisteners:function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},realvalidate_conlisteners:function(){this.conlisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=n.elt,i=null,t=this.conlisteners.head,l=e.conlisteners.head;null!=l;){var p=l.elt;if(null!=t&&t.elt==p)l=l.next,i=t,t=t.next;else{var r;if(null!=t){var a=t.elt;r=p.precedence>a.precedence||p.precedence==a.precedence&&p.id>a.id}else r=!0;if(r){var s=p.options;if(!s.nonemptyintersection(this.cbTypes,s.excludes)&&p.space==this.manager.space){var o,_=this.conlisteners;null==jt.zpp_pool?o=new jt:(o=jt.zpp_pool,jt.zpp_pool=o.next,o.next=null),o.elt=p;var h=o;null==i?(h.next=_.head,_.head=h):(h.next=i.next,i.next=h),_.pushmod=_.modified=!0,_.length++,i=h}l=l.next}else i=t,t=t.next}}n=n.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},interactors:null,wrap_interactors:null,constraints:null,wrap_constraints:null,addConstraint:function(n){this.constraints.add(n)},addInteractor:function(n){this.interactors.add(n)},remConstraint:function(n){this.constraints.remove(n)},remInteractor:function(n){this.interactors.remove(n)},free:function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;){this.cbTypes.pop_unsafe().cbsets.remove(this)}},alloc:function(){},__class__:oe};var _e=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new he};l["zpp_nape.callbacks.ZPP_CbSetPair"]=_e,_e.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],_e.get=function(n,e){var i;return null==_e.zpp_pool?i=new _e:(i=_e.zpp_pool,_e.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,oe.setlt(n,e)?(i.a=n,i.b=e):(i.a=e,i.b=n),i},_e.setlt=function(n,e){return!!oe.setlt(n.a,e.a)||n.a==e.a&&oe.setlt(n.b,e.b)},_e.prototype={a:null,b:null,next:null,free:function(){this.a=this.b=null,this.listeners.clear()},alloc:function(){this.zip_listeners=!0},compatible:function(n){var e,i=n.options1,t=this.a.cbTypes;if(i.nonemptyintersection(t,i.includes)&&!i.nonemptyintersection(t,i.excludes)){var l=n.options2,p=this.b.cbTypes;e=!!l.nonemptyintersection(p,l.includes)&&!l.nonemptyintersection(p,l.excludes)}else e=!1;if(e)return!0;var r=n.options2,a=this.a.cbTypes;if(r.nonemptyintersection(a,r.includes)&&!r.nonemptyintersection(a,r.excludes)){var s=n.options1,o=this.b.cbTypes;return!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}return!1},zip_listeners:null,listeners:null,invalidate:function(){this.zip_listeners=!0},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},__validate:function(){this.listeners.clear();for(var n=this.a.listeners.head,e=this.b.listeners.head;null!=n&&null!=e;){var i=n.elt,t=e.elt;if(i==t){var l,p,r=i.options1,a=this.a.cbTypes;if(r.nonemptyintersection(a,r.includes)&&!r.nonemptyintersection(a,r.excludes)){var s=i.options2,o=this.b.cbTypes;p=!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}else p=!1;if(p)l=!0;else{var _=i.options2,h=this.a.cbTypes;if(_.nonemptyintersection(h,_.includes)&&!_.nonemptyintersection(h,_.excludes)){var u=i.options1,x=this.b.cbTypes;l=!!u.nonemptyintersection(x,u.includes)&&!u.nonemptyintersection(x,u.excludes)}else l=!1}l&&this.listeners.add(i),n=n.next,e=e.next}else i.precedence>t.precedence||i.precedence==t.precedence&&i.id>t.id?n=n.next:e=e.next}},empty_intersection:function(){return null==this.listeners.head},single_intersection:function(n){var e=this.listeners.head;return null!=e&&e.elt==n&&null==e.next},forall:function(n,e){for(var i=this.listeners.head;null!=i;){var t=i.elt;t.event==n&&e(t),i=i.next}},__class__:_e};var he=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_InteractionListener"]=he,he.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],he.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==At.zpp_pool?e=new At:(e=At.zpp_pool,At.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==At.zpp_pool?e=new At:(e=At.zpp_pool,At.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==At.zpp_pool?i=new At:(i=At.zpp_pool,At.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==At.zpp_pool?i=new At:(i=At.zpp_pool,At.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=At.zpp_pool,At.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=At.zpp_pool,At.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=At.zpp_pool,At.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=At.zpp_pool,At.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=At.zpp_pool,At.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=At.zpp_pool,At.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=At.zpp_pool,At.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=At.zpp_pool,At.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=At.zpp_pool,At.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:he};var ue=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_BodyListener"]=ue,ue.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],ue.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Lt.zpp_pool?e=new Lt:(e=Lt.zpp_pool,Lt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Lt.zpp_pool?e=new Lt:(e=Lt.zpp_pool,Lt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Lt.zpp_pool?i=new Lt:(i=Lt.zpp_pool,Lt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Lt.zpp_pool?i=new Lt:(i=Lt.zpp_pool,Lt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Lt.zpp_pool,Lt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Lt.zpp_pool,Lt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Lt.zpp_pool,Lt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Lt.zpp_pool,Lt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Lt.zpp_pool,Lt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Lt.zpp_pool,Lt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Lt.zpp_pool,Lt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Lt.zpp_pool,Lt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Lt.zpp_pool,Lt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ue};var xe=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ConstraintListener"]=xe,xe.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],xe.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==jt.zpp_pool?e=new jt:(e=jt.zpp_pool,jt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==jt.zpp_pool?e=new jt:(e=jt.zpp_pool,jt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==jt.zpp_pool?i=new jt:(i=jt.zpp_pool,jt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==jt.zpp_pool?i=new jt:(i=jt.zpp_pool,jt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=jt.zpp_pool,jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=jt.zpp_pool,jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=jt.zpp_pool,jt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=jt.zpp_pool,jt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=jt.zpp_pool,jt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=jt.zpp_pool,jt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=jt.zpp_pool,jt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=jt.zpp_pool,jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=jt.zpp_pool,jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:xe};var de=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Constraint"]=de,de.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],de.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Pt.zpp_pool?e=new Pt:(e=Pt.zpp_pool,Pt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Pt.zpp_pool?e=new Pt:(e=Pt.zpp_pool,Pt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Pt.zpp_pool?i=new Pt:(i=Pt.zpp_pool,Pt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Pt.zpp_pool?i=new Pt:(i=Pt.zpp_pool,Pt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pt.zpp_pool,Pt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pt.zpp_pool,Pt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Pt.zpp_pool,Pt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Pt.zpp_pool,Pt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Pt.zpp_pool,Pt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Pt.zpp_pool,Pt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Pt.zpp_pool,Pt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pt.zpp_pool,Pt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Pt.zpp_pool,Pt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:de};var ve=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Interactor"]=ve,ve.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],ve.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Nt.zpp_pool?e=new Nt:(e=Nt.zpp_pool,Nt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Nt.zpp_pool?e=new Nt:(e=Nt.zpp_pool,Nt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Nt.zpp_pool?i=new Nt:(i=Nt.zpp_pool,Nt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Nt.zpp_pool?i=new Nt:(i=Nt.zpp_pool,Nt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Nt.zpp_pool,Nt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Nt.zpp_pool,Nt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Nt.zpp_pool,Nt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Nt.zpp_pool,Nt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Nt.zpp_pool,Nt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ve};var ze=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbSet"]=ze,ze.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],ze.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Et.zpp_pool?e=new Et:(e=Et.zpp_pool,Et.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Et.zpp_pool?e=new Et:(e=Et.zpp_pool,Et.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Et.zpp_pool?i=new Et:(i=Et.zpp_pool,Et.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Et.zpp_pool?i=new Et:(i=Et.zpp_pool,Et.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Et.zpp_pool,Et.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Et.zpp_pool,Et.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Et.zpp_pool,Et.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Et.zpp_pool,Et.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Et.zpp_pool,Et.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Et.zpp_pool,Et.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Et.zpp_pool,Et.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Et.zpp_pool,Et.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Et.zpp_pool,Et.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ze};var ce=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=ae.CbType(),this.listeners=new he,this.bodylisteners=new ue,this.conlisteners=new xe,this.constraints=new de,this.interactors=new ve,this.cbsets=new ze};l["zpp_nape.callbacks.ZPP_CbType"]=ce,ce.__name__=["zpp_nape","callbacks","ZPP_CbType"],ce.setlt=function(n,e){return e.id>n.id},ce.prototype={outer:null,userData:null,id:null,cbsets:null,interactors:null,wrap_interactors:null,constraints:null,wrap_constraints:null,addConstraint:function(n){this.constraints.add(n)},addInteractor:function(n){this.interactors.add(n)},remConstraint:function(n){this.constraints.remove(n)},remInteractor:function(n){this.interactors.remove(n)},listeners:null,addint:function(n){for(var e=null,i=this.listeners.head;null!=i;){var t=i.elt;if(n.precedence>t.precedence||n.precedence==t.precedence&&n.id>t.id)break;e=i,i=i.next}var l,p=this.listeners;null==At.zpp_pool?l=new At:(l=At.zpp_pool,At.zpp_pool=l.next,l.next=null),l.elt=n;var r=l;null==e?(r.next=p.head,p.head=r):(r.next=e.next,e.next=r),p.pushmod=p.modified=!0,p.length++;for(var a=this.cbsets.head;null!=a;){var s=a.elt;s.zip_listeners=!0,s.invalidate_pairs(),a=a.next}},removeint:function(n){this.listeners.remove(n);for(var e=this.cbsets.head;null!=e;){var i=e.elt;i.zip_listeners=!0,i.invalidate_pairs(),e=e.next}},invalidateint:function(){for(var n=this.cbsets.head;null!=n;){var e=n.elt;e.zip_listeners=!0,e.invalidate_pairs(),n=n.next}},bodylisteners:null,addbody:function(n){for(var e=null,i=this.bodylisteners.head;null!=i;){var t=i.elt;if(n.precedence>t.precedence||n.precedence==t.precedence&&n.id>t.id)break;e=i,i=i.next}var l,p=this.bodylisteners;null==Lt.zpp_pool?l=new Lt:(l=Lt.zpp_pool,Lt.zpp_pool=l.next,l.next=null),l.elt=n;var r=l;null==e?(r.next=p.head,p.head=r):(r.next=e.next,e.next=r),p.pushmod=p.modified=!0,p.length++;for(var a=this.cbsets.head;null!=a;){a.elt.zip_bodylisteners=!0,a=a.next}},removebody:function(n){this.bodylisteners.remove(n);for(var e=this.cbsets.head;null!=e;){e.elt.zip_bodylisteners=!0,e=e.next}},invalidatebody:function(){for(var n=this.cbsets.head;null!=n;){n.elt.zip_bodylisteners=!0,n=n.next}},conlisteners:null,addconstraint:function(n){for(var e=null,i=this.conlisteners.head;null!=i;){var t=i.elt;if(n.precedence>t.precedence||n.precedence==t.precedence&&n.id>t.id)break;e=i,i=i.next}var l,p=this.conlisteners;null==jt.zpp_pool?l=new jt:(l=jt.zpp_pool,jt.zpp_pool=l.next,l.next=null),l.elt=n;var r=l;null==e?(r.next=p.head,p.head=r):(r.next=e.next,e.next=r),p.pushmod=p.modified=!0,p.length++;for(var a=this.cbsets.head;null!=a;){a.elt.zip_conlisteners=!0,a=a.next}},removeconstraint:function(n){this.conlisteners.remove(n);for(var e=this.cbsets.head;null!=e;){e.elt.zip_conlisteners=!0,e=e.next}},invalidateconstraint:function(){for(var n=this.cbsets.head;null!=n;){n.elt.zip_conlisteners=!0,n=n.next}},__class__:ce};var me=function(){};l["zpp_nape.util.ZPP_Flags"]=me,me.__name__=["zpp_nape","util","ZPP_Flags"],me.GravMassMode_DEFAULT=null,me.GravMassMode_FIXED=null,me.GravMassMode_SCALED=null,me.InertiaMode_DEFAULT=null,me.InertiaMode_FIXED=null,me.MassMode_DEFAULT=null,me.MassMode_FIXED=null,me.BodyType_STATIC=null,me.BodyType_DYNAMIC=null,me.BodyType_KINEMATIC=null,me.ListenerType_BODY=null,me.ListenerType_CONSTRAINT=null,me.PreFlag_ACCEPT=null,me.ListenerType_INTERACTION=null,me.PreFlag_IGNORE=null,me.ListenerType_PRE=null,me.PreFlag_ACCEPT_ONCE=null,me.PreFlag_IGNORE_ONCE=null,me.CbEvent_BEGIN=null,me.CbEvent_ONGOING=null,me.InteractionType_COLLISION=null,me.CbEvent_END=null,me.InteractionType_SENSOR=null,me.CbEvent_WAKE=null,me.InteractionType_FLUID=null,me.CbEvent_SLEEP=null,me.InteractionType_ANY=null,me.CbEvent_BREAK=null,me.CbEvent_PRE=null,me.Winding_UNDEFINED=null,me.Winding_CLOCKWISE=null,me.Winding_ANTICLOCKWISE=null,me.ValidationResult_VALID=null,me.ValidationResult_DEGENERATE=null,me.ValidationResult_CONCAVE=null,me.ValidationResult_SELF_INTERSECTING=null,me.ShapeType_CIRCLE=null,me.ShapeType_POLYGON=null,me.Broadphase_DYNAMIC_AABB_TREE=null,me.Broadphase_SWEEP_AND_PRUNE=null,me.ArbiterType_COLLISION=null,me.ArbiterType_SENSOR=null,me.ArbiterType_FLUID=null;var ye=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=ae.Listener()};l["zpp_nape.callbacks.ZPP_Listener"]=ye,ye.__name__=["zpp_nape","callbacks","ZPP_Listener"],ye.setlt=function(n,e){return n.precedence>e.precedence||n.precedence==e.precedence&&n.id>e.id},ye.prototype={outer:null,id:null,type:null,event:null,precedence:null,body:null,constraint:null,interaction:null,space:null,swapEvent:function(n){},invalidate_precedence:function(){},addedToSpace:function(){},removedFromSpace:function(){},__class__:ye};var fe=function(n,e,i){this.handler=null,this.options=null,this.outer_zn=null,ye.call(this),this.event=e,this.handler=i,this.body=this,this.type=me.id_ListenerType_BODY,this.options=n.zpp_inner};l["zpp_nape.callbacks.ZPP_BodyListener"]=fe,fe.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],fe.__super__=ye,fe.prototype=e(ye.prototype,{outer_zn:null,options:null,handler:null,immutable_options:function(){},addedToSpace:function(){this.options.handler=i(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var e=n.elt,t=null,l=e.bodylisteners.head;null!=l;){var p=l.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;t=l,l=l.next}var r,a=e.bodylisteners;null==Lt.zpp_pool?r=new Lt:(r=Lt.zpp_pool,Lt.zpp_pool=r.next,r.next=null),r.elt=this;var s=r;null==t?(s.next=a.head,a.head=s):(s.next=t.next,t.next=s),a.pushmod=a.modified=!0,a.length++;for(var o=e.cbsets.head;null!=o;){o.elt.zip_bodylisteners=!0,o=o.next}n=n.next}},removedFromSpace:function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.bodylisteners.remove(this);for(var i=e.cbsets.head;null!=i;){i.elt.zip_bodylisteners=!0,i=i.next}n=n.next}this.options.handler=null},cbtype_change:function(n,e,i){this.removedFromSpace();var t=this.options;if(e)if(i){for(var l=null,p=t.includes.head;null!=p;){var r=p.elt;if(r.id>n.id)break;l=p,p=p.next}var a,s=t.includes;null==kt.zpp_pool?a=new kt:(a=kt.zpp_pool,kt.zpp_pool=a.next,a.next=null),a.elt=n;var o=a;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else t.includes.remove(n);else if(i){for(var _=null,h=t.excludes.head;null!=h;){var u=h.elt;if(u.id>n.id)break;_=h,h=h.next}var x,d=t.excludes;null==kt.zpp_pool?x=new kt:(x=kt.zpp_pool,kt.zpp_pool=x.next,x.next=null),x.elt=n;var v=x;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else t.excludes.remove(n);this.addedToSpace()},invalidate_precedence:function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:fe});var be=function(n,e,i){this.handler=null,this.options=null,this.outer_zn=null,ye.call(this),this.event=e,this.handler=i,this.constraint=this,this.type=me.id_ListenerType_CONSTRAINT,this.options=n.zpp_inner};l["zpp_nape.callbacks.ZPP_ConstraintListener"]=be,be.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],be.__super__=ye,be.prototype=e(ye.prototype,{outer_zn:null,options:null,handler:null,immutable_options:function(){},addedToSpace:function(){this.options.handler=i(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var e=n.elt,t=null,l=e.conlisteners.head;null!=l;){var p=l.elt;if(this.precedence>p.precedence||this.precedence==p.precedence&&this.id>p.id)break;t=l,l=l.next}var r,a=e.conlisteners;null==jt.zpp_pool?r=new jt:(r=jt.zpp_pool,jt.zpp_pool=r.next,r.next=null),r.elt=this;var s=r;null==t?(s.next=a.head,a.head=s):(s.next=t.next,t.next=s),a.pushmod=a.modified=!0,a.length++;for(var o=e.cbsets.head;null!=o;){o.elt.zip_conlisteners=!0,o=o.next}n=n.next}},removedFromSpace:function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.conlisteners.remove(this);for(var i=e.cbsets.head;null!=i;){i.elt.zip_conlisteners=!0,i=i.next}n=n.next}this.options.handler=null},cbtype_change:function(n,e,i){this.removedFromSpace();var t=this.options;if(e)if(i){for(var l=null,p=t.includes.head;null!=p;){var r=p.elt;if(r.id>n.id)break;l=p,p=p.next}var a,s=t.includes;null==kt.zpp_pool?a=new kt:(a=kt.zpp_pool,kt.zpp_pool=a.next,a.next=null),a.elt=n;var o=a;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else t.includes.remove(n);else if(i){for(var _=null,h=t.excludes.head;null!=h;){var u=h.elt;if(u.id>n.id)break;_=h,h=h.next}var x,d=t.excludes;null==kt.zpp_pool?x=new kt:(x=kt.zpp_pool,kt.zpp_pool=x.next,x.next=null),x.elt=n;var v=x;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else t.excludes.remove(n);this.addedToSpace()},invalidate_precedence:function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:be});var ge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbType"]=ge,ge.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],ge.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==kt.zpp_pool?e=new kt:(e=kt.zpp_pool,kt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==kt.zpp_pool?e=new kt:(e=kt.zpp_pool,kt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==kt.zpp_pool?i=new kt:(i=kt.zpp_pool,kt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==kt.zpp_pool?i=new kt:(i=kt.zpp_pool,kt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=kt.zpp_pool,kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=kt.zpp_pool,kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=kt.zpp_pool,kt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=kt.zpp_pool,kt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=kt.zpp_pool,kt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=kt.zpp_pool,kt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=kt.zpp_pool,kt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=kt.zpp_pool,kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=kt.zpp_pool,kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ge};var we=function(n,e,i,t){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,ye.call(this),this.type=t,this.interaction=this,this.event=i,this.options1=n.zpp_inner,this.options2=e.zpp_inner,this.allowSleepingCallbacks=!1};l["zpp_nape.callbacks.ZPP_InteractionListener"]=we,we.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],we.__super__=ye,we.prototype=e(ye.prototype,{outer_zni:null,outer_znp:null,itype:null,options1:null,options2:null,handleri:null,allowSleepingCallbacks:null,pure:null,handlerp:null,setInteractionType:function(n){this.itype=n},wake:function(){for(var n=this.options1.includes.head,e=this.options2.includes.head;null!=n&&null!=e;){var i=n.elt,t=e.elt;if(i==t){for(var l=i.interactors.head;null!=l;){l.elt.wake(),l=l.next}n=n.next,e=e.next}else if(t.id>i.id){for(var p=i.interactors.head;null!=p;){var r=p.elt;r.wake(),p=p.next}n=n.next}else{for(var a=t.interactors.head;null!=a;){var s=a.elt;s.wake(),a=a.next}e=e.next}}for(;null!=n;){for(var o=n.elt.interactors.head;null!=o;){o.elt.wake(),o=o.next}n=n.next}for(;null!=e;){for(var _=e.elt.interactors.head;null!=_;){_.elt.wake(),_=_.next}e=e.next}},CbSetset:function(n,e,i){for(var t=we.UCbSet,l=we.VCbSet,p=we.WCbSet,r=n.head,a=e.head;null!=r&&null!=a;){var s=r.elt,o=a.elt;if(s==o){var _;null==Et.zpp_pool?_=new Et:(_=Et.zpp_pool,Et.zpp_pool=_.next,_.next=null),_.elt=s;var h=_;h.next=p.head,p.head=h,p.modified=!0,p.length++,r=r.next,a=a.next}else if(oe.setlt(s,o)){var u;null==Et.zpp_pool?u=new Et:(u=Et.zpp_pool,Et.zpp_pool=u.next,u.next=null),u.elt=s;var x=u;x.next=t.head,t.head=x,t.modified=!0,t.length++,r=r.next}else{var d;null==Et.zpp_pool?d=new Et:(d=Et.zpp_pool,Et.zpp_pool=d.next,d.next=null),d.elt=o;var v=d;v.next=l.head,l.head=v,l.modified=!0,l.length++,a=a.next}}for(;null!=r;){var z,c=r.elt;null==Et.zpp_pool?z=new Et:(z=Et.zpp_pool,Et.zpp_pool=z.next,z.next=null),z.elt=c;var m=z;m.next=t.head,t.head=m,t.modified=!0,t.length++,r=r.next}for(;null!=a;){var y,f=a.elt;null==Et.zpp_pool?y=new Et:(y=Et.zpp_pool,Et.zpp_pool=y.next,y.next=null),y.elt=f;var b=y;b.next=l.head,l.head=b,l.modified=!0,l.length++,a=a.next}for(;null!=t.head;)for(var g=t.pop_unsafe(),w=e.head;null!=w;){var M=w.elt;i(g,M),w=w.next}for(;null!=l.head;)for(var C=l.pop_unsafe(),k=p.head;null!=k;){var O=k.elt;i(C,O),k=k.next}for(;null!=p.head;){var I=p.pop_unsafe();i(I,I);for(var S=p.head;null!=S;){i(I,S.elt),S=S.next}}},CbTypeset:function(n,e,i){for(var t=we.UCbType,l=we.VCbType,p=we.WCbType,r=n.head,a=e.head;null!=r&&null!=a;){var s=r.elt,o=a.elt;if(s==o){var _;null==kt.zpp_pool?_=new kt:(_=kt.zpp_pool,kt.zpp_pool=_.next,_.next=null),_.elt=s;var h=_;h.next=p.head,p.head=h,p.modified=!0,p.length++,r=r.next,a=a.next}else if(o.id>s.id){var u;null==kt.zpp_pool?u=new kt:(u=kt.zpp_pool,kt.zpp_pool=u.next,u.next=null),u.elt=s;var x=u;x.next=t.head,t.head=x,t.modified=!0,t.length++,r=r.next}else{var d;null==kt.zpp_pool?d=new kt:(d=kt.zpp_pool,kt.zpp_pool=d.next,d.next=null),d.elt=o;var v=d;v.next=l.head,l.head=v,l.modified=!0,l.length++,a=a.next}}for(;null!=r;){var z,c=r.elt;null==kt.zpp_pool?z=new kt:(z=kt.zpp_pool,kt.zpp_pool=z.next,z.next=null),z.elt=c;var m=z;m.next=t.head,t.head=m,t.modified=!0,t.length++,r=r.next}for(;null!=a;){var y,f=a.elt;null==kt.zpp_pool?y=new kt:(y=kt.zpp_pool,kt.zpp_pool=y.next,y.next=null),y.elt=f;var b=y;b.next=l.head,l.head=b,l.modified=!0,l.length++,a=a.next}for(;null!=t.head;)for(var g=t.pop_unsafe(),w=e.head;null!=w;){var M=w.elt;i(g,M),w=w.next}for(;null!=l.head;)for(var C=l.pop_unsafe(),k=p.head;null!=k;){var O=k.elt;i(C,O),k=k.next}for(;null!=p.head;){var I=p.pop_unsafe();i(I,I);for(var S=p.head;null!=S;){i(I,S.elt),S=S.next}}},with_uniquesets:function(n){var e,i=this;null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.lt=_e.setlt;for(var t=this.options2.includes,l=we.UCbType,p=we.VCbType,r=we.WCbType,a=this.options1.includes.head,s=t.head;null!=a&&null!=s;){var o=a.elt,_=s.elt;if(o==_){var h;null==kt.zpp_pool?h=new kt:(h=kt.zpp_pool,kt.zpp_pool=h.next,h.next=null),h.elt=o;var u=h;u.next=r.head,r.head=u,r.modified=!0,r.length++,a=a.next,s=s.next}else if(_.id>o.id){var x;null==kt.zpp_pool?x=new kt:(x=kt.zpp_pool,kt.zpp_pool=x.next,x.next=null),x.elt=o;var d=x;d.next=l.head,l.head=d,l.modified=!0,l.length++,a=a.next}else{var v;null==kt.zpp_pool?v=new kt:(v=kt.zpp_pool,kt.zpp_pool=v.next,v.next=null),v.elt=_;var z=v;z.next=p.head,p.head=z,p.modified=!0,p.length++,s=s.next}}for(;null!=a;){var c,m=a.elt;null==kt.zpp_pool?c=new kt:(c=kt.zpp_pool,kt.zpp_pool=c.next,c.next=null),c.elt=m;var y=c;y.next=l.head,l.head=y,l.modified=!0,l.length++,a=a.next}for(;null!=s;){var f,b=s.elt;null==kt.zpp_pool?f=new kt:(f=kt.zpp_pool,kt.zpp_pool=f.next,f.next=null),f.elt=b;var g=f;g.next=p.head,p.head=g,p.modified=!0,p.length++,s=s.next}for(;null!=l.head;)for(var w=l.pop_unsafe(),M=t.head;null!=M;){for(var C=M.elt,k=C.cbsets,O=we.UCbSet,I=we.VCbSet,S=we.WCbSet,P=w.cbsets.head,T=k.head;null!=P&&null!=T;){var A=P.elt,E=T.elt;if(A==E){var N;null==Et.zpp_pool?N=new Et:(N=Et.zpp_pool,Et.zpp_pool=N.next,N.next=null),N.elt=A;var L=N;L.next=S.head,S.head=L,S.modified=!0,S.length++,P=P.next,T=T.next}else if(oe.setlt(A,E)){var V;null==Et.zpp_pool?V=new Et:(V=Et.zpp_pool,Et.zpp_pool=V.next,V.next=null),V.elt=A;var j=V;j.next=O.head,O.head=j,O.modified=!0,O.length++,P=P.next}else{var D;null==Et.zpp_pool?D=new Et:(D=Et.zpp_pool,Et.zpp_pool=D.next,D.next=null),D.elt=E;var F=D;F.next=I.head,I.head=F,I.modified=!0,I.length++,T=T.next}}for(;null!=P;){var R,B=P.elt;null==Et.zpp_pool?R=new Et:(R=Et.zpp_pool,Et.zpp_pool=R.next,R.next=null),R.elt=B;var G=R;G.next=O.head,O.head=G,O.modified=!0,O.length++,P=P.next}for(;null!=T;){var Z,U=T.elt;null==Et.zpp_pool?Z=new Et:(Z=Et.zpp_pool,Et.zpp_pool=Z.next,Z.next=null),Z.elt=U;var q=Z;q.next=I.head,I.head=q,I.modified=!0,I.length++,T=T.next}for(;null!=O.head;)for(var Y=O.pop_unsafe(),K=k.head;null!=K;){var W=K.elt;if(Y.validate(),W.validate(),oe.single_intersection(Y,W,i)){var J;null==_e.zpp_pool?J=new _e:(J=_e.zpp_pool,_e.zpp_pool=J.next,J.next=null),J.zip_listeners=!0,oe.setlt(Y,W)?(J.a=Y,J.b=W):(J.a=W,J.b=Y),e.try_insert(J)}K=K.next}for(;null!=I.head;)for(var X=I.pop_unsafe(),H=S.head;null!=H;){var Q=H.elt;if(X.validate(),Q.validate(),oe.single_intersection(X,Q,i)){var $;null==_e.zpp_pool?$=new _e:($=_e.zpp_pool,_e.zpp_pool=$.next,$.next=null),$.zip_listeners=!0,oe.setlt(X,Q)?($.a=X,$.b=Q):($.a=Q,$.b=X),e.try_insert($)}H=H.next}for(;null!=S.head;){var nn=S.pop_unsafe();if(nn.validate(),nn.validate(),oe.single_intersection(nn,nn,i)){var en;null==_e.zpp_pool?en=new _e:(en=_e.zpp_pool,_e.zpp_pool=en.next,en.next=null),en.zip_listeners=!0,oe.setlt(nn,nn),en.a=nn,en.b=nn,e.try_insert(en)}for(var tn=S.head;null!=tn;){var ln=tn.elt;if(nn.validate(),ln.validate(),oe.single_intersection(nn,ln,i)){var pn;null==_e.zpp_pool?pn=new _e:(pn=_e.zpp_pool,_e.zpp_pool=pn.next,pn.next=null),pn.zip_listeners=!0,oe.setlt(nn,ln)?(pn.a=nn,pn.b=ln):(pn.a=ln,pn.b=nn),e.try_insert(pn)}tn=tn.next}}M=M.next}for(;null!=p.head;)for(var rn=p.pop_unsafe(),an=r.head;null!=an;){for(var sn=an.elt,on=sn.cbsets,_n=we.UCbSet,hn=we.VCbSet,un=we.WCbSet,xn=rn.cbsets.head,dn=on.head;null!=xn&&null!=dn;){var vn=xn.elt,zn=dn.elt;if(vn==zn){var cn;null==Et.zpp_pool?cn=new Et:(cn=Et.zpp_pool,Et.zpp_pool=cn.next,cn.next=null),cn.elt=vn;var mn=cn;mn.next=un.head,un.head=mn,un.modified=!0,un.length++,xn=xn.next,dn=dn.next}else if(oe.setlt(vn,zn)){var yn;null==Et.zpp_pool?yn=new Et:(yn=Et.zpp_pool,Et.zpp_pool=yn.next,yn.next=null),yn.elt=vn;var fn=yn;fn.next=_n.head,_n.head=fn,_n.modified=!0,_n.length++,xn=xn.next}else{var bn;null==Et.zpp_pool?bn=new Et:(bn=Et.zpp_pool,Et.zpp_pool=bn.next,bn.next=null),bn.elt=zn;var gn=bn;gn.next=hn.head,hn.head=gn,hn.modified=!0,hn.length++,dn=dn.next}}for(;null!=xn;){var wn,Mn=xn.elt;null==Et.zpp_pool?wn=new Et:(wn=Et.zpp_pool,Et.zpp_pool=wn.next,wn.next=null),wn.elt=Mn;var Cn=wn;Cn.next=_n.head,_n.head=Cn,_n.modified=!0,_n.length++,xn=xn.next}for(;null!=dn;){var kn,On=dn.elt;null==Et.zpp_pool?kn=new Et:(kn=Et.zpp_pool,Et.zpp_pool=kn.next,kn.next=null),kn.elt=On;var In=kn;In.next=hn.head,hn.head=In,hn.modified=!0,hn.length++,dn=dn.next}for(;null!=_n.head;)for(var Sn=_n.pop_unsafe(),Pn=on.head;null!=Pn;){var Tn=Pn.elt;if(Sn.validate(),Tn.validate(),oe.single_intersection(Sn,Tn,i)){var An;null==_e.zpp_pool?An=new _e:(An=_e.zpp_pool,_e.zpp_pool=An.next,An.next=null),An.zip_listeners=!0,oe.setlt(Sn,Tn)?(An.a=Sn,An.b=Tn):(An.a=Tn,An.b=Sn),e.try_insert(An)}Pn=Pn.next}for(;null!=hn.head;)for(var En=hn.pop_unsafe(),Nn=un.head;null!=Nn;){var Ln=Nn.elt;if(En.validate(),Ln.validate(),oe.single_intersection(En,Ln,i)){var Vn;null==_e.zpp_pool?Vn=new _e:(Vn=_e.zpp_pool,_e.zpp_pool=Vn.next,Vn.next=null),Vn.zip_listeners=!0,oe.setlt(En,Ln)?(Vn.a=En,Vn.b=Ln):(Vn.a=Ln,Vn.b=En),e.try_insert(Vn)}Nn=Nn.next}for(;null!=un.head;){var jn=un.pop_unsafe();if(jn.validate(),jn.validate(),oe.single_intersection(jn,jn,i)){var Dn;null==_e.zpp_pool?Dn=new _e:(Dn=_e.zpp_pool,_e.zpp_pool=Dn.next,Dn.next=null),Dn.zip_listeners=!0,oe.setlt(jn,jn),Dn.a=jn,Dn.b=jn,e.try_insert(Dn)}for(var Fn=un.head;null!=Fn;){var Rn=Fn.elt;if(jn.validate(),Rn.validate(),oe.single_intersection(jn,Rn,i)){var Bn;null==_e.zpp_pool?Bn=new _e:(Bn=_e.zpp_pool,_e.zpp_pool=Bn.next,Bn.next=null),Bn.zip_listeners=!0,oe.setlt(jn,Rn)?(Bn.a=jn,Bn.b=Rn):(Bn.a=Rn,Bn.b=jn),e.try_insert(Bn)}Fn=Fn.next}}an=an.next}for(;null!=r.head;){for(var Gn=r.pop_unsafe(),Zn=Gn.cbsets,Un=we.UCbSet,qn=we.VCbSet,Yn=we.WCbSet,Kn=Gn.cbsets.head,Wn=Zn.head;null!=Kn&&null!=Wn;){var Jn=Kn.elt,Xn=Wn.elt;if(Jn==Xn){var Hn;null==Et.zpp_pool?Hn=new Et:(Hn=Et.zpp_pool,Et.zpp_pool=Hn.next,Hn.next=null),Hn.elt=Jn;var Qn=Hn;Qn.next=Yn.head,Yn.head=Qn,Yn.modified=!0,Yn.length++,Kn=Kn.next,Wn=Wn.next}else if(oe.setlt(Jn,Xn)){var $n;null==Et.zpp_pool?$n=new Et:($n=Et.zpp_pool,Et.zpp_pool=$n.next,$n.next=null),$n.elt=Jn;var ne=$n;ne.next=Un.head,Un.head=ne,Un.modified=!0,Un.length++,Kn=Kn.next}else{var ee;null==Et.zpp_pool?ee=new Et:(ee=Et.zpp_pool,Et.zpp_pool=ee.next,ee.next=null),ee.elt=Xn;var ie=ee;ie.next=qn.head,qn.head=ie,qn.modified=!0,qn.length++,Wn=Wn.next}}for(;null!=Kn;){var te,le=Kn.elt;null==Et.zpp_pool?te=new Et:(te=Et.zpp_pool,Et.zpp_pool=te.next,te.next=null),te.elt=le;var pe=te;pe.next=Un.head,Un.head=pe,Un.modified=!0,Un.length++,Kn=Kn.next}for(;null!=Wn;){var re,ae=Wn.elt;null==Et.zpp_pool?re=new Et:(re=Et.zpp_pool,Et.zpp_pool=re.next,re.next=null),re.elt=ae;var se=re;se.next=qn.head,qn.head=se,qn.modified=!0,qn.length++,Wn=Wn.next}for(;null!=Un.head;)for(var he=Un.pop_unsafe(),ue=Zn.head;null!=ue;){var xe=ue.elt;if(he.validate(),xe.validate(),oe.single_intersection(he,xe,i)){var de;null==_e.zpp_pool?de=new _e:(de=_e.zpp_pool,_e.zpp_pool=de.next,de.next=null),de.zip_listeners=!0,oe.setlt(he,xe)?(de.a=he,de.b=xe):(de.a=xe,de.b=he),e.try_insert(de)}ue=ue.next}for(;null!=qn.head;)for(var ve=qn.pop_unsafe(),ze=Yn.head;null!=ze;){var ce=ze.elt;if(ve.validate(),ce.validate(),oe.single_intersection(ve,ce,i)){var me;null==_e.zpp_pool?me=new _e:(me=_e.zpp_pool,_e.zpp_pool=me.next,me.next=null),me.zip_listeners=!0,oe.setlt(ve,ce)?(me.a=ve,me.b=ce):(me.a=ce,me.b=ve),e.try_insert(me)}ze=ze.next}for(;null!=Yn.head;){var ye=Yn.pop_unsafe();if(ye.validate(),ye.validate(),oe.single_intersection(ye,ye,i)){var fe;null==_e.zpp_pool?fe=new _e:(fe=_e.zpp_pool,_e.zpp_pool=fe.next,fe.next=null),fe.zip_listeners=!0,oe.setlt(ye,ye),fe.a=ye,fe.b=ye,e.try_insert(fe)}for(var be=Yn.head;null!=be;){var ge=be.elt;if(ye.validate(),ge.validate(),oe.single_intersection(ye,ge,i)){var Me;null==_e.zpp_pool?Me=new _e:(Me=_e.zpp_pool,_e.zpp_pool=Me.next,Me.next=null),Me.zip_listeners=!0,oe.setlt(ye,ge)?(Me.a=ye,Me.b=ge):(Me.a=ge,Me.b=ye),e.try_insert(Me)}be=be.next}}for(var Ce=r.head;null!=Ce;){for(var ke=Ce.elt,Oe=ke.cbsets,Ie=we.UCbSet,Se=we.VCbSet,Pe=we.WCbSet,Te=Gn.cbsets.head,Ae=Oe.head;null!=Te&&null!=Ae;){var Ee=Te.elt,Ne=Ae.elt;if(Ee==Ne){var Le;null==Et.zpp_pool?Le=new Et:(Le=Et.zpp_pool,Et.zpp_pool=Le.next,Le.next=null),Le.elt=Ee;var Ve=Le;Ve.next=Pe.head,Pe.head=Ve,Pe.modified=!0,Pe.length++,Te=Te.next,Ae=Ae.next}else if(oe.setlt(Ee,Ne)){var je;null==Et.zpp_pool?je=new Et:(je=Et.zpp_pool,Et.zpp_pool=je.next,je.next=null),je.elt=Ee;var De=je;De.next=Ie.head,Ie.head=De,Ie.modified=!0,Ie.length++,Te=Te.next}else{var Fe;null==Et.zpp_pool?Fe=new Et:(Fe=Et.zpp_pool,Et.zpp_pool=Fe.next,Fe.next=null),Fe.elt=Ne;var Re=Fe;Re.next=Se.head,Se.head=Re,Se.modified=!0,Se.length++,Ae=Ae.next}}for(;null!=Te;){var Be,Ge=Te.elt;null==Et.zpp_pool?Be=new Et:(Be=Et.zpp_pool,Et.zpp_pool=Be.next,Be.next=null),Be.elt=Ge;var Ze=Be;Ze.next=Ie.head,Ie.head=Ze,Ie.modified=!0,Ie.length++,Te=Te.next}for(;null!=Ae;){var Ue,qe=Ae.elt;null==Et.zpp_pool?Ue=new Et:(Ue=Et.zpp_pool,Et.zpp_pool=Ue.next,Ue.next=null),Ue.elt=qe;var Ye=Ue;Ye.next=Se.head,Se.head=Ye,Se.modified=!0,Se.length++,Ae=Ae.next}for(;null!=Ie.head;)for(var Ke=Ie.pop_unsafe(),We=Oe.head;null!=We;){var Je=We.elt;if(Ke.validate(),Je.validate(),oe.single_intersection(Ke,Je,i)){var Xe;null==_e.zpp_pool?Xe=new _e:(Xe=_e.zpp_pool,_e.zpp_pool=Xe.next,Xe.next=null),Xe.zip_listeners=!0,oe.setlt(Ke,Je)?(Xe.a=Ke,Xe.b=Je):(Xe.a=Je,Xe.b=Ke),e.try_insert(Xe)}We=We.next}for(;null!=Se.head;)for(var He=Se.pop_unsafe(),Qe=Pe.head;null!=Qe;){var $e=Qe.elt;if(He.validate(),$e.validate(),oe.single_intersection(He,$e,i)){var ni;null==_e.zpp_pool?ni=new _e:(ni=_e.zpp_pool,_e.zpp_pool=ni.next,ni.next=null),ni.zip_listeners=!0,oe.setlt(He,$e)?(ni.a=He,ni.b=$e):(ni.a=$e,ni.b=He),e.try_insert(ni)}Qe=Qe.next}for(;null!=Pe.head;){var ei=Pe.pop_unsafe();if(ei.validate(),ei.validate(),oe.single_intersection(ei,ei,i)){var ii;null==_e.zpp_pool?ii=new _e:(ii=_e.zpp_pool,_e.zpp_pool=ii.next,ii.next=null),ii.zip_listeners=!0,oe.setlt(ei,ei),ii.a=ei,ii.b=ei,e.try_insert(ii)}for(var ti=Pe.head;null!=ti;){var li=ti.elt;if(ei.validate(),li.validate(),oe.single_intersection(ei,li,i)){var pi;null==_e.zpp_pool?pi=new _e:(pi=_e.zpp_pool,_e.zpp_pool=pi.next,pi.next=null),pi.zip_listeners=!0,oe.setlt(ei,li)?(pi.a=ei,pi.b=li):(pi.a=li,pi.b=ei),e.try_insert(pi)}ti=ti.next}}Ce=Ce.next}}if(null!=e.parent){for(var ri=e.parent;null!=ri;)if(null!=ri.prev)ri=ri.prev;else if(null!=ri.next)ri=ri.next;else{var ai=ri.data;n?i.space.freshListenerType(ai.a,ai.b):i.space.nullListenerType(ai.a,ai.b);var si=ai;si.a=si.b=null,si.listeners.clear(),si.next=_e.zpp_pool,_e.zpp_pool=si;var oi=ri.parent;null!=oi&&(ri==oi.prev?oi.prev=null:oi.next=null,ri.parent=null);var _i=ri;_i.data=null,_i.lt=null,_i.swapped=null,_i.next=kl.zpp_pool,kl.zpp_pool=_i,ri=oi}e.parent=null}var hi=e;hi.data=null,hi.lt=null,hi.swapped=null,hi.next=kl.zpp_pool,kl.zpp_pool=hi},with_union:function(n){for(var e=this.options1.includes.head,i=this.options2.includes.head;null!=e&&null!=i;){var t=e.elt,l=i.elt;t==l?(n(t),e=e.next,i=i.next):l.id>t.id?(n(t),e=e.next):(n(l),i=i.next)}for(;null!=e;)n(e.elt),e=e.next;for(;null!=i;)n(i.elt),i=i.next},addedToSpace:function(){for(var n=this,e=this.type==me.id_ListenerType_PRE,t=this.options1.includes.head,l=this.options2.includes.head;null!=t&&null!=l;){var p=t.elt,r=l.elt;if(p==r){for(var a=null,s=p.listeners.head;null!=s;){var o=s.elt;if(n.precedence>o.precedence||n.precedence==o.precedence&&n.id>o.id)break;a=s,s=s.next}var _,h=p.listeners;null==At.zpp_pool?_=new At:(_=At.zpp_pool,At.zpp_pool=_.next,_.next=null),_.elt=n;var u=_;null==a?(u.next=h.head,h.head=u):(u.next=a.next,a.next=u),h.pushmod=h.modified=!0,h.length++;for(var x=p.cbsets.head;null!=x;){var d=x.elt;d.zip_listeners=!0,d.invalidate_pairs(),x=x.next}if(e)for(var v=p.interactors.head;null!=v;){var z=v.elt;z.wake(),v=v.next}t=t.next,l=l.next}else if(r.id>p.id){for(var c=null,m=p.listeners.head;null!=m;){var y=m.elt;if(n.precedence>y.precedence||n.precedence==y.precedence&&n.id>y.id)break;c=m,m=m.next}var f,b=p.listeners;null==At.zpp_pool?f=new At:(f=At.zpp_pool,At.zpp_pool=f.next,f.next=null),f.elt=n;var g=f;null==c?(g.next=b.head,b.head=g):(g.next=c.next,c.next=g),b.pushmod=b.modified=!0,b.length++;for(var w=p.cbsets.head;null!=w;){var M=w.elt;M.zip_listeners=!0,M.invalidate_pairs(),w=w.next}if(e)for(var C=p.interactors.head;null!=C;){var k=C.elt;k.wake(),C=C.next}t=t.next}else{for(var O=null,I=r.listeners.head;null!=I;){var S=I.elt;if(n.precedence>S.precedence||n.precedence==S.precedence&&n.id>S.id)break;O=I,I=I.next}var P,T=r.listeners;null==At.zpp_pool?P=new At:(P=At.zpp_pool,At.zpp_pool=P.next,P.next=null),P.elt=n;var A=P;null==O?(A.next=T.head,T.head=A):(A.next=O.next,O.next=A),T.pushmod=T.modified=!0,T.length++;for(var E=r.cbsets.head;null!=E;){var N=E.elt;N.zip_listeners=!0,N.invalidate_pairs(),E=E.next}if(e)for(var L=r.interactors.head;null!=L;){var V=L.elt;V.wake(),L=L.next}l=l.next}}for(;null!=t;){for(var j=t.elt,D=null,F=j.listeners.head;null!=F;){var R=F.elt;if(n.precedence>R.precedence||n.precedence==R.precedence&&n.id>R.id)break;D=F,F=F.next}var B,G=j.listeners;null==At.zpp_pool?B=new At:(B=At.zpp_pool,At.zpp_pool=B.next,B.next=null),B.elt=n;var Z=B;null==D?(Z.next=G.head,G.head=Z):(Z.next=D.next,D.next=Z),G.pushmod=G.modified=!0,G.length++;for(var U=j.cbsets.head;null!=U;){var q=U.elt;q.zip_listeners=!0,q.invalidate_pairs(),U=U.next}if(e)for(var Y=j.interactors.head;null!=Y;){var K=Y.elt;K.wake(),Y=Y.next}t=t.next}for(;null!=l;){for(var W=l.elt,J=null,X=W.listeners.head;null!=X;){var H=X.elt;if(n.precedence>H.precedence||n.precedence==H.precedence&&n.id>H.id)break;J=X,X=X.next}var Q,$=W.listeners;null==At.zpp_pool?Q=new At:(Q=At.zpp_pool,At.zpp_pool=Q.next,Q.next=null),Q.elt=n;var nn=Q;null==J?(nn.next=$.head,$.head=nn):(nn.next=J.next,J.next=nn),$.pushmod=$.modified=!0,$.length++;for(var en=W.cbsets.head;null!=en;){var tn=en.elt;tn.zip_listeners=!0,tn.invalidate_pairs(),en=en.next}if(e)for(var ln=W.interactors.head;null!=ln;){var pn=ln.elt;pn.wake(),ln=ln.next}l=l.next}this.options1.handler=i(this,this.cbtype_change1),this.options2.handler=i(this,this.cbtype_change2),this.with_uniquesets(!0)},removedFromSpace:function(){var n=this;this.with_uniquesets(!1);for(var e=this.type==me.id_ListenerType_PRE,i=this.options1.includes.head,t=this.options2.includes.head;null!=i&&null!=t;){var l=i.elt,p=t.elt;if(l==p){l.listeners.remove(n);for(var r=l.cbsets.head;null!=r;){var a=r.elt;a.zip_listeners=!0,a.invalidate_pairs(),r=r.next}if(e)for(var s=l.interactors.head;null!=s;){var o=s.elt;o.wake(),s=s.next}i=i.next,t=t.next}else if(p.id>l.id){l.listeners.remove(n);for(var _=l.cbsets.head;null!=_;){var h=_.elt;h.zip_listeners=!0,h.invalidate_pairs(),_=_.next}if(e)for(var u=l.interactors.head;null!=u;){var x=u.elt;x.wake(),u=u.next}i=i.next}else{p.listeners.remove(n);for(var d=p.cbsets.head;null!=d;){var v=d.elt;v.zip_listeners=!0,v.invalidate_pairs(),d=d.next}if(e)for(var z=p.interactors.head;null!=z;){var c=z.elt;c.wake(),z=z.next}t=t.next}}for(;null!=i;){var m=i.elt;m.listeners.remove(n);for(var y=m.cbsets.head;null!=y;){var f=y.elt;f.zip_listeners=!0,f.invalidate_pairs(),y=y.next}if(e)for(var b=m.interactors.head;null!=b;){var g=b.elt;g.wake(),b=b.next}i=i.next}for(;null!=t;){var w=t.elt;w.listeners.remove(n);for(var M=w.cbsets.head;null!=M;){var C=M.elt;C.zip_listeners=!0,C.invalidate_pairs(),M=M.next}if(e)for(var k=w.interactors.head;null!=k;){var O=k.elt;O.wake(),k=k.next}t=t.next}this.options1.handler=null,this.options2.handler=null},invalidate_precedence:function(){var n=this;if(null!=this.space){for(var e=this.type==me.id_ListenerType_PRE,i=this.options1.includes.head,t=this.options2.includes.head;null!=i&&null!=t;){var l=i.elt,p=t.elt;if(l==p){l.listeners.remove(n);for(var r=l.cbsets.head;null!=r;){var a=r.elt;a.zip_listeners=!0,a.invalidate_pairs(),r=r.next}for(var s=null,o=l.listeners.head;null!=o;){var _=o.elt;if(n.precedence>_.precedence||n.precedence==_.precedence&&n.id>_.id)break;s=o,o=o.next}var h,u=l.listeners;null==At.zpp_pool?h=new At:(h=At.zpp_pool,At.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++;for(var d=l.cbsets.head;null!=d;){var v=d.elt;v.zip_listeners=!0,v.invalidate_pairs(),d=d.next}if(e)for(var z=l.interactors.head;null!=z;){var c=z.elt;c.wake(),z=z.next}i=i.next,t=t.next}else if(p.id>l.id){l.listeners.remove(n);for(var m=l.cbsets.head;null!=m;){var y=m.elt;y.zip_listeners=!0,y.invalidate_pairs(),m=m.next}for(var f=null,b=l.listeners.head;null!=b;){var g=b.elt;if(n.precedence>g.precedence||n.precedence==g.precedence&&n.id>g.id)break;f=b,b=b.next}var w,M=l.listeners;null==At.zpp_pool?w=new At:(w=At.zpp_pool,At.zpp_pool=w.next,w.next=null),w.elt=n;var C=w;null==f?(C.next=M.head,M.head=C):(C.next=f.next,f.next=C),M.pushmod=M.modified=!0,M.length++;for(var k=l.cbsets.head;null!=k;){var O=k.elt;O.zip_listeners=!0,O.invalidate_pairs(),k=k.next}if(e)for(var I=l.interactors.head;null!=I;){var S=I.elt;S.wake(),I=I.next}i=i.next}else{p.listeners.remove(n);for(var P=p.cbsets.head;null!=P;){var T=P.elt;T.zip_listeners=!0,T.invalidate_pairs(),P=P.next}for(var A=null,E=p.listeners.head;null!=E;){var N=E.elt;if(n.precedence>N.precedence||n.precedence==N.precedence&&n.id>N.id)break;A=E,E=E.next}var L,V=p.listeners;null==At.zpp_pool?L=new At:(L=At.zpp_pool,At.zpp_pool=L.next,L.next=null),L.elt=n;var j=L;null==A?(j.next=V.head,V.head=j):(j.next=A.next,A.next=j),V.pushmod=V.modified=!0,V.length++;for(var D=p.cbsets.head;null!=D;){var F=D.elt;F.zip_listeners=!0,F.invalidate_pairs(),D=D.next}if(e)for(var R=p.interactors.head;null!=R;){var B=R.elt;B.wake(),R=R.next}t=t.next}}for(;null!=i;){var G=i.elt;G.listeners.remove(n);for(var Z=G.cbsets.head;null!=Z;){var U=Z.elt;U.zip_listeners=!0,U.invalidate_pairs(),Z=Z.next}for(var q=null,Y=G.listeners.head;null!=Y;){var K=Y.elt;if(n.precedence>K.precedence||n.precedence==K.precedence&&n.id>K.id)break;q=Y,Y=Y.next}var W,J=G.listeners;null==At.zpp_pool?W=new At:(W=At.zpp_pool,At.zpp_pool=W.next,W.next=null),W.elt=n;var X=W;null==q?(X.next=J.head,J.head=X):(X.next=q.next,q.next=X),J.pushmod=J.modified=!0,J.length++;for(var H=G.cbsets.head;null!=H;){var Q=H.elt;Q.zip_listeners=!0,Q.invalidate_pairs(),H=H.next}if(e)for(var $=G.interactors.head;null!=$;){var nn=$.elt;nn.wake(),$=$.next}i=i.next}for(;null!=t;){var en=t.elt;en.listeners.remove(n);for(var tn=en.cbsets.head;null!=tn;){var ln=tn.elt;ln.zip_listeners=!0,ln.invalidate_pairs(),tn=tn.next}for(var pn=null,rn=en.listeners.head;null!=rn;){var an=rn.elt;if(n.precedence>an.precedence||n.precedence==an.precedence&&n.id>an.id)break;pn=rn,rn=rn.next}var sn,on=en.listeners;null==At.zpp_pool?sn=new At:(sn=At.zpp_pool,At.zpp_pool=sn.next,sn.next=null),sn.elt=n;var _n=sn;null==pn?(_n.next=on.head,on.head=_n):(_n.next=pn.next,pn.next=_n),on.pushmod=on.modified=!0,on.length++;for(var hn=en.cbsets.head;null!=hn;){var un=hn.elt;un.zip_listeners=!0,un.invalidate_pairs(),hn=hn.next}if(e)for(var xn=en.interactors.head;null!=xn;){var dn=xn.elt;dn.wake(),xn=xn.next}t=t.next}}},cbtype_change1:function(n,e,i){this.cbtype_change(this.options1,n,e,i)},cbtype_change2:function(n,e,i){this.cbtype_change(this.options2,n,e,i)},cbtype_change:function(n,e,i,t){if(this.removedFromSpace(),i)if(t){for(var l=null,p=n.includes.head;null!=p;){var r=p.elt;if(r.id>e.id)break;l=p,p=p.next}var a,s=n.includes;null==kt.zpp_pool?a=new kt:(a=kt.zpp_pool,kt.zpp_pool=a.next,a.next=null),a.elt=e;var o=a;null==l?(o.next=s.head,s.head=o):(o.next=l.next,l.next=o),s.pushmod=s.modified=!0,s.length++}else n.includes.remove(e);else if(t){for(var _=null,h=n.excludes.head;null!=h;){var u=h.elt;if(u.id>e.id)break;_=h,h=h.next}var x,d=n.excludes;null==kt.zpp_pool?x=new kt:(x=kt.zpp_pool,kt.zpp_pool=x.next,x.next=null),x.elt=e;var v=x;null==_?(v.next=d.head,d.head=v):(v.next=_.next,_.next=v),d.pushmod=d.modified=!0,d.length++}else n.excludes.remove(e);this.addedToSpace()},swapEvent:function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},__class__:we});var Me=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new ge,this.excludes=new ge};l["zpp_nape.callbacks.ZPP_OptionType"]=Me,Me.__name__=["zpp_nape","callbacks","ZPP_OptionType"],Me.argument=function(n){return null==n?new V:m.__instanceof(n,V)?n:(new V).including(n)},Me.prototype={outer:null,handler:null,includes:null,excludes:null,wrap_includes:null,wrap_excludes:null,setup_includes:function(){this.wrap_includes=xl.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=xl.get(this.excludes,!0)},excluded:function(n){return this.nonemptyintersection(n,this.excludes)},included:function(n){return this.nonemptyintersection(n,this.includes)},compatible:function(n){return!!this.nonemptyintersection(n,this.includes)&&!this.nonemptyintersection(n,this.excludes)},nonemptyintersection:function(n,e){for(var i=!1,t=n.head,l=e.head;null!=l&&null!=t;){var p=l.elt,r=t.elt;if(p==r){i=!0;break}r.id>p.id?l=l.next:t=t.next}return i},effect_change:function(n,e,i){if(e)if(i){for(var t=null,l=this.includes.head;null!=l;){var p=l.elt;if(p.id>n.id)break;t=l,l=l.next}var r,a=this.includes;null==kt.zpp_pool?r=new kt:(r=kt.zpp_pool,kt.zpp_pool=r.next,r.next=null),r.elt=n;var s=r;null==t?(s.next=a.head,a.head=s):(s.next=t.next,t.next=s),a.pushmod=a.modified=!0,a.length++}else this.includes.remove(n);else if(i){for(var o=null,_=this.excludes.head;null!=_;){var h=_.elt;if(h.id>n.id)break;o=_,_=_.next}var u,x=this.excludes;null==kt.zpp_pool?u=new kt:(u=kt.zpp_pool,kt.zpp_pool=u.next,u.next=null),u.elt=n;var d=u;null==o?(d.next=x.head,x.head=d):(d.next=o.next,o.next=d),x.pushmod=x.modified=!0,x.length++}else this.excludes.remove(n)},append_type:function(n,e){if(n==this.includes){if(!this.includes.has(e))if(this.excludes.has(e))null!=this.handler?this.handler(e,!1,!1):this.excludes.remove(e);else if(null!=this.handler)this.handler(e,!0,!0);else{for(var i=null,t=this.includes.head;null!=t;){var l=t.elt;if(l.id>e.id)break;i=t,t=t.next}var p,r=this.includes;null==kt.zpp_pool?p=new kt:(p=kt.zpp_pool,kt.zpp_pool=p.next,p.next=null),p.elt=e;var a=p;null==i?(a.next=r.head,r.head=a):(a.next=i.next,i.next=a),r.pushmod=r.modified=!0,r.length++}}else if(!this.excludes.has(e))if(this.includes.has(e))null!=this.handler?this.handler(e,!0,!1):this.includes.remove(e);else if(null!=this.handler)this.handler(e,!1,!0);else{for(var s=null,o=this.excludes.head;null!=o;){var _=o.elt;if(_.id>e.id)break;s=o,o=o.next}var h,u=this.excludes;null==kt.zpp_pool?h=new kt:(h=kt.zpp_pool,kt.zpp_pool=h.next,h.next=null),h.elt=e;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}},set:function(n){if(n!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var e=n.excludes.head;null!=e;){this.append_type(this.excludes,e.elt),e=e.next}for(var i=n.includes.head;null!=i;){this.append_type(this.includes,i.elt),i=i.next}}return this},append:function(n,e){if(m.__instanceof(e,C)){this.append_type(n,e.zpp_inner)}else if(m.__instanceof(e,O)){var i=e;i.zpp_inner.valmod();for(var t=k.get(i);;){t.zpp_inner.zpp_inner.valmod();var l=t.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var p=l.zpp_inner.user_length;t.zpp_critical=!0;var r;if(p>t.zpp_i?r=!0:(t.zpp_next=k.zpp_pool,k.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);this.append_type(n,a.zpp_inner)}}else if(e instanceof Array&&null==e.__enum__)for(var s=e,o=0;s.length>o;){var _=s[o];++o,m.__instanceof(_,C);var h=_;this.append_type(n,h.zpp_inner)}},__class__:Me};var Ce=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=ae.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=Infinity,this.maxError=Infinity,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new ge};l["zpp_nape.constraint.ZPP_Constraint"]=Ce,Ce.__name__=["zpp_nape","constraint","ZPP_Constraint"],Ce.prototype={outer:null,clear:function(){},id:null,userData:null,compound:null,space:null,active:null,stiff:null,frequency:null,damping:null,maxForce:null,maxError:null,breakUnderForce:null,breakUnderError:null,removeOnBreak:null,component:null,ignore:null,__velocity:null,immutable_midstep:function(n){},cbTypes:null,cbSet:null,wrap_cbTypes:null,setupcbTypes:function(){this.wrap_cbTypes=xl.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=i(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=i(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=i(this,this.immutable_cbTypes)},immutable_cbTypes:function(){this.immutable_midstep("Constraint::cbTypes")},wrap_cbTypes_subber:function(n){var e=n.zpp_inner;this.cbTypes.has(e)&&(null!=this.space&&(this.dealloc_cbSet(),e.constraints.remove(this)),this.cbTypes.remove(e),null!=this.space&&(this.alloc_cbSet(),this.wake()))},wrap_cbTypes_adder:function(n){return this.insert_cbtype(n.zpp_inner),!1},insert_cbtype:function(n){if(!this.cbTypes.has(n)){null!=this.space&&(this.dealloc_cbSet(),n.constraints.add(this));for(var e=null,i=this.cbTypes.head;null!=i;){if(i.elt.id>n.id)break;e=i,i=i.next}var t,l=this.cbTypes;null==kt.zpp_pool?t=new kt:(t=kt.zpp_pool,kt.zpp_pool=t.next,t.next=null),t.elt=n;var p=t;null==e?(p.next=l.head,l.head=p):(p.next=e.next,e.next=p),l.pushmod=l.modified=!0,l.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},dealloc_cbSet:function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;){n.cbTypes.pop_unsafe().cbsets.remove(n)}n.next=oe.zpp_pool,oe.zpp_pool=n}this.cbSet=null}},activate:function(){null!=this.space&&this.activeInSpace()},deactivate:function(){null!=this.space&&this.inactiveOrOutSpace()},addedToSpace:function(){this.active&&this.activeInSpace(),this.activeBodies();for(var n=this.cbTypes.head;null!=n;){n.elt.constraints.add(this),n=n.next}},removedFromSpace:function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var n=this.cbTypes.head;null!=n;){n.elt.constraints.remove(this),n=n.next}},activeInSpace:function(){this.alloc_cbSet(),null==Gi.zpp_pool?this.component=new Gi:(this.component=Gi.zpp_pool,Gi.zpp_pool=this.component.next,this.component.next=null);this.component.isBody=!1,this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var n=this.component;n.body=null,n.constraint=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,this.component=null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},validate:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(n,e){return!1},broken:function(){},warmStart:function(){},pre_dt:null,preStep:function(n){return!1},applyImpulseVel:function(){return!1},applyImpulsePos:function(){return!1},wake:function(){null!=this.space&&this.space.wake_constraint(this)},draw:function(n){},copy:function(n,e){return null},copyto:function(n){var e=this.outer;null==e.zpp_inner.wrap_cbTypes&&e.zpp_inner.setupcbTypes();var i=e.zpp_inner.wrap_cbTypes;i.zpp_inner.valmod();for(var t=k.get(i);;){t.zpp_inner.zpp_inner.valmod();var l=t.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var p=l.zpp_inner.user_length;t.zpp_critical=!0;var r;if(p>t.zpp_i?r=!0:(t.zpp_next=k.zpp_pool,k.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);null==n.zpp_inner.wrap_cbTypes&&n.zpp_inner.setupcbTypes();var s=n.zpp_inner.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(a):s.unshift(a)}n.zpp_inner.removeOnBreak=e.zpp_inner.removeOnBreak;var o=e.zpp_inner.breakUnderError;n.zpp_inner.breakUnderError!=o&&(n.zpp_inner.breakUnderError=o,n.zpp_inner.wake());var _=e.zpp_inner.breakUnderForce;n.zpp_inner.breakUnderForce!=_&&(n.zpp_inner.breakUnderForce=_,n.zpp_inner.wake());var h=e.zpp_inner.maxError;n.zpp_inner.maxError!=h&&(n.zpp_inner.maxError=h,n.zpp_inner.wake());var u=e.zpp_inner.maxForce;n.zpp_inner.maxForce!=u&&(n.zpp_inner.maxForce=u,n.zpp_inner.wake());var x=e.zpp_inner.damping;n.zpp_inner.damping!=x&&(n.zpp_inner.damping=x,n.zpp_inner.stiff||n.zpp_inner.wake());var d=e.zpp_inner.frequency;n.zpp_inner.frequency!=d&&(n.zpp_inner.frequency=d,n.zpp_inner.stiff||n.zpp_inner.wake());var v=e.zpp_inner.stiff;n.zpp_inner.stiff!=v&&(n.zpp_inner.stiff=v,n.zpp_inner.wake());var z=e.zpp_inner.ignore;n.zpp_inner.ignore!=z&&(n.zpp_inner.ignore=z,n.zpp_inner.wake());var c=e.zpp_inner.active;n.zpp_inner.active!=c&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.woken=!1),n.zpp_inner.clearcache(),c?(n.zpp_inner.active=c,n.zpp_inner.activate(),null!=n.zpp_inner.space&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.sleeping=!0),n.zpp_inner.space.wake_constraint(n.zpp_inner,!0))):(null!=n.zpp_inner.space&&(n.zpp_inner.wake(),n.zpp_inner.space.live_constraints.remove(n.zpp_inner)),n.zpp_inner.active=c,n.zpp_inner.deactivate()))},__class__:Ce};var ke=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,Ce.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=Infinity,this.stepped=!1};l["zpp_nape.constraint.ZPP_AngleJoint"]=ke,ke.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],ke.__super__=Ce,ke.prototype=e(Ce.prototype,{outer_zn:null,ratio:null,jointMin:null,jointMax:null,slack:null,equal:null,scale:null,is_slack:function(){var n,e=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(e-=this.jointMax,n=!1,this.scale=1):this.jointMin>e?(e=this.jointMin-e,this.scale=-1,n=!1):e>this.jointMax?(e-=this.jointMax,this.scale=1,n=!1):(this.scale=0,e=0,n=!0),n},bodyImpulse:function(n){return this.stepped?n==this.b1?Pn.get(0,0,-this.scale*this.jAcc):Pn.get(0,0,this.ratio*this.scale*this.jAcc):Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,b2:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var i=new B(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(i),null!=n&&null!=this.b1){for(var t=null,l=0;n.length>l;){var p=n[l];if(++l,p.id==this.b1.id){t=p.bc;break}}null!=t?i.zpp_inner_zn.b1=t.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){i.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,a=0;n.length>a;){var s=n[a];if(++a,s.id==this.b2.id){r=s.bc;break}}null!=r?i.zpp_inner_zn.b2=r.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){i.zpp_inner_zn.b2=n.zpp_inner}))}return i},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var i=this.ratio*this.b2.rot-this.b1.rot;this.equal?(i-=this.jointMax,this.slack=!1,this.scale=1):this.jointMin>i?(i=this.jointMin-i,this.scale=-1,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.scale=1,this.slack=!1):(this.scale=0,i=0,this.slack=!0);var t=i;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&t*t>this.maxError*this.maxError)return!0;var l,p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));var r=1/(1+this.gamma);l=n*p*p*this.gamma,this.gamma*=r,this.kMass*=r,this.bias=-t*l,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},applyImpulseVel:function(){if(this.slack)return!1;var n=this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel),e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,i=this.jAcc;return this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),!(!this.breakUnderForce||this.jMax>=this.jAcc&&this.jAcc>=-this.jMax)||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:-this.jMax>this.jAcc&&(this.jAcc=-this.jMax)),e=this.jAcc-i,this.b1.angvel-=this.scale*this.b1.iinertia*e,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*e,!1)},applyImpulsePos:function(){var n,e,i,t=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(t-=this.jointMax,i=!1,this.scale=1):this.jointMin>t?(t=this.jointMin-t,this.scale=-1,i=!1):t>this.jointMax?(t-=this.jointMax,this.scale=1,i=!1):(this.scale=0,t=0,i=!0),n=t,!i){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(n*=.5,e=-n*this.kMass,this.equal||0>e){var l=this.b1,p=-this.scale*e*this.b1.iinertia;if(l.rot+=p,p*p>1e-4)l.axisx=Math.sin(l.rot),l.axisy=Math.cos(l.rot);else{var r=p*p,a=1-.5*r,s=1-r*r/8,o=(a*l.axisx+p*l.axisy)*s;l.axisy=(a*l.axisy-p*l.axisx)*s,l.axisx=o}var _=this.b2,h=this.ratio*this.scale*e*this.b2.iinertia;if(_.rot+=h,h*h>1e-4)_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot);else{var u=h*h,x=1-.5*u,d=1-u*u/8,v=(x*_.axisx+h*_.axisy)*d;_.axisy=(x*_.axisy-h*_.axisx)*d,_.axisx=v}}}return!1},draw:function(n){},__class__:ke});var Oe=function(){this.cb=null,this.bc=null,this.id=0};l["zpp_nape.constraint.ZPP_CopyHelper"]=Oe,Oe.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],Oe.dict=function(n,e){var i=new Oe;return i.id=n,i.bc=e,i},Oe.todo=function(n,e){var i=new Oe;return i.id=n,i.cb=e,i},Oe.prototype={id:null,bc:null,cb:null,__class__:Oe};var Ie=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,Ce.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=Infinity,this.stepped=!1,this.cx1=this.cx2=0};l["zpp_nape.constraint.ZPP_DistanceJoint"]=Ie,Ie.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],Ie.__super__=Ce,Ie.prototype=e(Ce.prototype,{outer_zn:null,jointMin:null,jointMax:null,slack:null,equal:null,is_slack:function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=0,i=0;e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var t=e*e+i*i;if(y.epsilon>t)e=0,i=0,t=0,n=!0;else{t=Math.sqrt(t);var l=1/t;e*=l,i*=l,this.equal?(t-=this.jointMax,n=!1):this.jointMin>t?(t=this.jointMin-t,e=-e,i=-i,n=!1):t>this.jointMax?(t-=this.jointMax,n=!1):(e=0,i=0,t=0,n=!0)}return n},nx:null,ny:null,cx1:null,cx2:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Pn.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):Pn.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,t=this.a1localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=i(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=i(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,t=this.a2localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=i(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=i(this,this.invalidate_a2)},wrap_a2:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var t=i.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var p=new U(null,null,t,l.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(p),null!=n&&null!=this.b1){for(var r=null,a=0;n.length>a;){var s=n[a];if(++a,s.id==this.b1.id){r=s.bc;break}}null!=r?p.zpp_inner_zn.b1=r.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,_=0;n.length>_;){var h=n[_];if(++_,h.id==this.b2.id){o=h.bc;break}}null!=o?p.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var i=this.nx*this.nx+this.ny*this.ny;if(y.epsilon>i)this.nx=0,this.ny=0,i=0,this.slack=!0;else{i=Math.sqrt(i);var t=1/i;this.nx*=t,this.ny*=t,this.equal?(i-=this.jointMax,this.slack=!1):this.jointMin>i?(i=this.jointMin-i,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):i>this.jointMax?(i-=this.jointMax,this.slack=!1):(this.nx=0,this.ny=0,i=0,this.slack=!0)}var l=i;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&l*l>this.maxError*this.maxError)return!0;var p,r=2*Math.PI*this.frequency;this.gamma=1/(n*r*(2*this.damping+r*n));var a=1/(1+this.gamma);p=n*r*r*this.gamma,this.gamma*=a,this.kMass*=a,this.bias=-l*p,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.nx*n,this.b1.vely-=this.ny*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.nx*e,this.b2.vely+=this.ny*e,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc}},applyImpulseVel:function(){if(this.slack)return!1;var n=this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1,e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,i=this.jAcc;if(this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&-this.jMax>this.jAcc)return!0;this.stiff||-this.jMax>this.jAcc&&(this.jAcc=-this.jMax),e=this.jAcc-i;var t=this.b1.imass*e;this.b1.velx-=this.nx*t,this.b1.vely-=this.ny*t;var l=this.b2.imass*e;return this.b2.velx+=this.nx*l,this.b2.vely+=this.ny*l,this.b1.angvel-=this.cx1*this.b1.iinertia*e,this.b2.angvel+=this.cx2*this.b2.iinertia*e,!1},applyImpulsePos:function(){var n,e,i=0,t=0;i=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,p=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,p=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var r,a=0,s=0;a=this.b2.posx+l-(this.b1.posx+i),s=this.b2.posy+p-(this.b1.posy+t);var o=a*a+s*s;if(y.epsilon>o)a=0,s=0,o=0,r=!0;else{o=Math.sqrt(o);var _=1/o;a*=_,s*=_,this.equal?(o-=this.jointMax,r=!1):this.jointMin>o?(o=this.jointMin-o,a=-a,s=-s,r=!1):o>this.jointMax?(o-=this.jointMax,r=!1):(a=0,s=0,o=0,r=!0)}if(n=o,!r){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(y.constraintLinearSlop*y.constraintLinearSlop>n*n)return!1;if((n*=.5)*n>6){var h=this.b1.smass+this.b2.smass;if(h>y.epsilon&&(h=.75/h,e=-n*h,this.equal||0>e)){var u=e*this.b1.imass;this.b1.posx-=a*u,this.b1.posy-=s*u;var x=e*this.b2.imass;this.b2.posx+=a*x,this.b2.posy+=s*x,a=this.b2.posx+l-(this.b1.posx+i),s=this.b2.posy+p-(this.b1.posy+t);var d=a*a+s*s;if(y.epsilon>d)a=0,s=0,d=0,r=!0;else{d=Math.sqrt(d);var v=1/d;a*=v,s*=v,this.equal?(d-=this.jointMax,r=!1):this.jointMin>d?(d=this.jointMin-d,a=-a,s=-s,r=!1):d>this.jointMax?(d-=this.jointMax,r=!1):(a=0,s=0,d=0,r=!0)}n=d,n*=.5}}var z,c;z=s*i-a*t,c=s*l-a*p;var m=this.b1.smass+this.b2.smass+z*z*this.b1.sinertia+c*c*this.b2.sinertia;if(0!=m&&(m=1/m),e=-n*m,this.equal||0>e){var f=this.b1.imass*e;this.b1.posx-=a*f,this.b1.posy-=s*f;var b=this.b2.imass*e;this.b2.posx+=a*b,this.b2.posy+=s*b;var g=this.b1,w=-z*this.b1.iinertia*e;if(g.rot+=w,w*w>1e-4)g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot);else{var M=w*w,C=1-.5*M,k=1-M*M/8,O=(C*g.axisx+w*g.axisy)*k;g.axisy=(C*g.axisy-w*g.axisx)*k,g.axisx=O}var I=this.b2,S=c*this.b2.iinertia*e;if(I.rot+=S,S*S>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var P=S*S,T=1-.5*P,A=1-P*P/8,E=(T*I.axisx+S*I.axisy)*A;I.axisy=(T*I.axisy-S*I.axisx)*A,I.axisx=E}}}return!1},draw:function(n){},__class__:Ie});var Se=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,Ce.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=Infinity,this.jointMin=-Infinity,this.jointMax=Infinity,this.stepped=!1};l["zpp_nape.constraint.ZPP_LineJoint"]=Se,Se.__name__=["zpp_nape","constraint","ZPP_LineJoint"],Se.__super__=Ce,Se.prototype=e(Ce.prototype,{outer_zn:null,scale:null,jointMin:null,jointMax:null,equal:null,dot1:null,dot2:null,cx1:null,cx2:null,bodyImpulse:function(n){if(this.stepped){var e=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,i=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return n==this.b1?Pn.get(-e,-i,this.scale*this.cx1*i-this.dot1*e):Pn.get(e,i,this.scale*this.cx1*i-this.dot1*e)}return Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,t=this.a1localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=i(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=i(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,t=this.a2localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=i(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=i(this,this.invalidate_a2)},wrap_a2:null,zip_n:null,nlocalx:null,nlocaly:null,nrelx:null,nrely:null,validate_n:function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},invalidate_n:function(n){this.immutable_midstep("Constraint::n"),this.nlocalx=n.x,this.nlocaly=n.y,this.zip_n=!0,this.wake()},setup_n:function(){var n,e=this.nlocalx,t=this.nlocaly;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_n=n,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=i(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=i(this,this.invalidate_n)},wrap_n:null,validate_norm:function(){if(this.zip_n){this.zip_n=!1;var n=this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly,e=1/Math.sqrt(n),i=e;this.nlocalx*=i,this.nlocaly*=i}},kMassa:null,kMassb:null,kMassc:null,jAccx:null,jAccy:null,jMax:null,gamma:null,biasx:null,biasy:null,stepped:null,copy:function(n,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var t=i.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var p=l.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_n&&r.zpp_inner_zn.setup_n();var a=new q(null,null,t,p,r.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(a),null!=n&&null!=this.b1){for(var s=null,o=0;n.length>o;){var _=n[o];if(++o,_.id==this.b1.id){s=_.bc;break}}null!=s?a.zpp_inner_zn.b1=s.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){a.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var h=null,u=0;n.length>u;){var x=n[u];if(++u,x.id==this.b2.id){h=x.bc;break}}null!=h?a.zpp_inner_zn.b2=h.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){a.zpp_inner_zn.b2=n.zpp_inner}))}return a},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i=0,t=0,l=0,p=0;i=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,t=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely,l=t*this.nrelx-i*this.nrely,p=this.nrelx*i+this.nrely*t,this.equal?(p-=this.jointMin,this.scale=1):p>this.jointMax?(p-=this.jointMax,this.scale=1):this.jointMin>p?(p=this.jointMin-p,this.scale=-1):(p=0,this.scale=0);var r=0,a=0;r=i+this.a1relx,a=t+this.a1rely,this.dot1=this.nrelx*r+this.nrely*a,this.cx1=a*this.nrelx-r*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);var s,o=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(o!=o)this.kMassa=this.kMassb=this.kMassc=0,s=3;else if(0==o){var _=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,_|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,_|=2),this.kMassb=0,s=_}else{o=1/o;var h=this.kMassc*o;this.kMassc=this.kMassa*o,this.kMassa=h,this.kMassb*=-o,s=0}if(0!=(1&s)&&(this.jAccx=0),0!=(2&s)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&l*l+p*p>this.maxError*this.maxError)return!0;var u,x=2*Math.PI*this.frequency;this.gamma=1/(n*x*(2*this.damping+x*n));var d=1/(1+this.gamma);u=n*x*x*this.gamma,this.gamma*=d;var v=d;this.kMassa*=v,this.kMassb*=v,this.kMassc*=v,this.biasx=l,this.biasy=p;var z=-u;this.biasx*=z,this.biasy*=z;var c=this.maxError,m=this.biasx*this.biasx+this.biasy*this.biasy;if(m>c*c){var y=c*(1/Math.sqrt(m));this.biasx*=y,this.biasy*=y}}var f=e;return this.jAccx*=f,this.jAccy*=f,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,i=this.b1.imass;this.b1.velx-=n*i,this.b1.vely-=e*i;var t=this.b2.imass;this.b2.velx+=n*t,this.b2.vely+=e*t,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0,i=0,t=0;i=this.b2.velx-this.b1.velx,t=this.b2.vely-this.b1.vely,i+=this.b2.kinvelx-this.b1.kinvelx,t+=this.b2.kinvely-this.b1.kinvely,n=t*this.nrelx-i*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,e=this.scale*(this.nrelx*i+this.nrely*t-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var l=0,p=0;l=this.biasx-n,p=this.biasy-e;var r=this.kMassa*l+this.kMassb*p;p=this.kMassb*l+this.kMassc*p,l=r;var a=this.gamma;l-=this.jAccx*a,p-=this.jAccy*a;var s=0,o=0;s=this.jAccx,o=this.jAccy;if(this.jAccx+=1*l,this.jAccy+=1*p,this.jAccy>0&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var _=this.jMax,h=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(h>_*_){var u=_*(1/Math.sqrt(h));this.jAccx*=u,this.jAccy*=u}}l=this.jAccx-s,p=this.jAccy-o;var x=this.scale*this.nrelx*p-this.nrely*l,d=this.nrelx*l+this.scale*this.nrely*p,v=this.b1.imass;this.b1.velx-=x*v,this.b1.vely-=d*v;var z=this.b2.imass;return this.b2.velx+=x*z,this.b2.vely+=d*z,this.b1.angvel+=(this.scale*this.cx1*p-this.dot1*l)*this.b1.iinertia,this.b2.angvel+=(this.dot2*l-this.scale*this.cx2*p)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,e=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy;var i=0,t=0;i=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,p=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,p=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var r,a=0,s=0,o=0,_=0;if(a=this.b2.posx+l-this.b1.posx-i,s=this.b2.posy+p-this.b1.posy-t,o=s*n-a*e,_=n*a+e*s,this.equal?(_-=this.jointMin,r=1):_>this.jointMax?(_-=this.jointMax,r=1):this.jointMin>_?(_=this.jointMin-_,r=-1):(_=0,r=0),this.breakUnderError&&o*o+_*_>this.maxError*this.maxError)return!0;if(y.constraintLinearSlop*y.constraintLinearSlop>o*o+_*_)return!1;var h=0,u=0;if(o*=.5,_*=.5,o*o+_*_>6){var x=this.b1.smass+this.b2.smass;if(x>y.epsilon){x=.8/x;var d=x*(e*o-r*n*_),v=x*(n*o*r-e*o),z=this.b1.imass;this.b1.posx-=d*z,this.b1.posy-=v*z;var c=this.b2.imass;this.b2.posx+=d*c,this.b2.posy+=v*c,a=this.b2.posx+l-this.b1.posx-i,s=this.b2.posy+p-this.b1.posy-t,o=s*n-a*e,_=n*a+e*s,this.equal?(_-=this.jointMin,r=1):_>this.jointMax?(_-=this.jointMax,r=1):this.jointMin>_?(_=this.jointMin-_,r=-1):(_=0,r=0);o*=.5,_*=.5}}var m,f,b,g,w=0,M=0,C=0,k=0,O=0;k=a+i,O=s+t,m=n*k+e*O,b=O*n-k*e,f=n*l+e*p,g=p*n-l*e,w=this.b1.smass+this.b2.smass+m*m*this.b1.sinertia+f*f*this.b2.sinertia,M=-r*(m*b*this.b1.sinertia+f*g*this.b2.sinertia),C=r*r*(this.b1.smass+this.b2.smass+b*b*this.b1.sinertia+g*g*this.b2.sinertia),h=-o,u=-_;var I=w*C-M*M;if(I!=I)u=0,h=u;else if(0==I)0!=w?h/=w:h=0,0!=C?u/=C:u=0;else{I=1/I;var S=I*(C*h-M*u);u=I*(w*u-M*h),h=S}u>0&&(u=0);var P=r*n*u-e*h,T=n*h+r*e*u,A=this.b1.imass;this.b1.posx-=P*A,this.b1.posy-=T*A;var E=this.b2.imass;this.b2.posx+=P*E,this.b2.posy+=T*E;var N=this.b1,L=(r*b*u-m*h)*this.b1.iinertia;if(N.rot+=L,L*L>1e-4)N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot);else{var V=L*L,j=1-.5*V,D=1-V*V/8,F=(j*N.axisx+L*N.axisy)*D;N.axisy=(j*N.axisy-L*N.axisx)*D,N.axisx=F}var R=this.b2,B=(f*h-r*g*u)*this.b2.iinertia;if(R.rot+=B,B*B>1e-4)R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot);else{var G=B*B,Z=1-.5*G,U=1-G*G/8,q=(Z*R.axisx+B*R.axisy)*U;R.axisy=(Z*R.axisy-B*R.axisx)*U,R.axisx=q}return!1},draw:function(n){},__class__:Se});var Pe=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,Ce.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};l["zpp_nape.constraint.ZPP_MotorJoint"]=Pe,Pe.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],Pe.__super__=Ce,Pe.prototype=e(Ce.prototype,{outer_zn:null,ratio:null,rate:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Pn.get(0,0,-this.jAcc):Pn.get(0,0,this.ratio*this.jAcc):Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,b2:null,kMass:null,jAcc:null,jMax:null,stepped:null,copy:function(n,e){var i=new Y(null,null,this.rate,this.ratio);if(this.copyto(i),null!=n&&null!=this.b1){for(var t=null,l=0;n.length>l;){var p=n[l];if(++l,p.id==this.b1.id){t=p.bc;break}}null!=t?i.zpp_inner_zn.b1=t.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){i.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,a=0;n.length>a;){var s=n[a];if(++a,s.id==this.b2.id){r=s.bc;break}}null!=r?i.zpp_inner_zn.b2=r.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){i.zpp_inner_zn.b2=n.zpp_inner}))}return i},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;return this.pre_dt=n,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=e,this.jMax=this.maxForce*n,!1},warmStart:function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},applyImpulseVel:function(){var n=this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate,e=-this.kMass*n,i=this.jAcc;if(this.jAcc+=e,this.breakUnderForce){if(this.jAcc>this.jMax||-this.jMax>this.jAcc)return!0}else-this.jMax>this.jAcc?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return e=this.jAcc-i,this.b1.angvel-=this.b1.iinertia*e,this.b2.angvel+=this.ratio*this.b2.iinertia*e,!1},applyImpulsePos:function(){return!1},__class__:Pe});var Te=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Ce.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=Infinity,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};l["zpp_nape.constraint.ZPP_PivotJoint"]=Te,Te.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],Te.__super__=Ce,Te.prototype=e(Ce.prototype,{outer_zn:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Pn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):Pn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,t=this.a1localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=i(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=i(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,t=this.a2localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=i(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=i(this,this.invalidate_a2)},wrap_a2:null,kMassa:null,kMassb:null,kMassc:null,jAccx:null,jAccy:null,jMax:null,gamma:null,biasx:null,biasy:null,stepped:null,copy:function(n,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var t=i.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var p=new K(null,null,t,l.zpp_inner_zn.wrap_a2);if(this.copyto(p),null!=n&&null!=this.b1){for(var r=null,a=0;n.length>a;){var s=n[a];if(++a,s.id==this.b1.id){r=s.bc;break}}null!=r?p.zpp_inner_zn.b1=r.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,_=0;n.length>_;){var h=n[_];if(++_,h.id==this.b2.id){o=h.bc;break}}null!=o?p.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i=this.b1.smass+this.b2.smass;if(this.kMassa=i,this.kMassb=0,this.kMassc=i,0!=this.b1.sinertia){var t=this.a1relx*this.b1.sinertia,l=this.a1rely*this.b1.sinertia;this.kMassa+=l*this.a1rely,this.kMassb+=-l*this.a1relx,this.kMassc+=t*this.a1relx}if(0!=this.b2.sinertia){var p=this.a2relx*this.b2.sinertia,r=this.a2rely*this.b2.sinertia;this.kMassa+=r*this.a2rely,this.kMassb+=-r*this.a2relx,this.kMassc+=p*this.a2relx}var a,s=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(s!=s)this.kMassa=this.kMassb=this.kMassc=0,a=3;else if(0==s){var o=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,o|=2),this.kMassb=0,a=o}else{s=1/s;var _=this.kMassc*s;this.kMassc=this.kMassa*s,this.kMassa=_,this.kMassb*=-s,a=0}if(0!=(1&a)&&(this.jAccx=0),0!=(2&a)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var h,u=2*Math.PI*this.frequency;this.gamma=1/(n*u*(2*this.damping+u*n));var x=1/(1+this.gamma);h=n*u*u*this.gamma,this.gamma*=x;var d=x;if(this.kMassa*=d,this.kMassb*=d,this.kMassc*=d,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;var v=-h;this.biasx*=v,this.biasy*=v;var z=this.maxError,c=this.biasx*this.biasx+this.biasy*this.biasy;if(c>z*z){var m=z*(1/Math.sqrt(c));this.biasx*=m,this.biasy*=m}}var y=e;return this.jAccx*=y,this.jAccy*=y,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel));var i=0,t=0;i=this.biasx-n,t=this.biasy-e;var l=this.kMassa*i+this.kMassb*t;t=this.kMassb*i+this.kMassc*t,i=l;var p=this.gamma;i-=this.jAccx*p,t-=this.jAccy*p;var r=0,a=0;r=this.jAccx,a=this.jAccy;if(this.jAccx+=1*i,this.jAccy+=1*t,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var s=this.jMax,o=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(o>s*s){var _=s*(1/Math.sqrt(o));this.jAccx*=_,this.jAccy*=_}}i=this.jAccx-r,t=this.jAccy-a;var h=this.b1.imass;this.b1.velx-=i*h,this.b1.vely-=t*h;var u=this.b2.imass;return this.b2.velx+=i*u,this.b2.vely+=t*u,this.b1.angvel-=(t*this.a1relx-i*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(t*this.a2relx-i*this.a2rely)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var i=0,t=0;i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,t=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var l=0,p=0;if(l=this.b2.posx+i-(this.b1.posx+n),p=this.b2.posy+t-(this.b1.posy+e),this.breakUnderError&&l*l+p*p>this.maxError*this.maxError)return!0;if(y.constraintLinearSlop*y.constraintLinearSlop>l*l+p*p)return!1;l*=.5,p*=.5;var r=0,a=0;if(l*l+p*p>6){var s=this.b1.smass+this.b2.smass;if(s>y.epsilon){s=.75/s,r=-l*s,a=-p*s;var o=r*r+a*a;if(o>400){var _=1/Math.sqrt(o)*20;r*=_,a*=_}var h=this.b1.imass;this.b1.posx-=r*h,this.b1.posy-=a*h;var u=this.b2.imass;this.b2.posx+=r*u,this.b2.posy+=a*u,l=this.b2.posx+i-(this.b1.posx+n),p=this.b2.posy+t-(this.b1.posy+e);l*=.5,p*=.5}}var x=0,d=0,v=0,z=this.b1.smass+this.b2.smass;if(x=z,d=0,v=z,0!=this.b1.sinertia){var c=n*this.b1.sinertia,m=e*this.b1.sinertia;x+=m*e,d+=-m*n,v+=c*n}if(0!=this.b2.sinertia){var f=i*this.b2.sinertia,b=t*this.b2.sinertia;x+=b*t,d+=-b*i,v+=f*i}r=-l,a=-p;var g=r*r+a*a;if(g>36){var w=1/Math.sqrt(g)*6;r*=w,a*=w}var M=x*v-d*d;if(M!=M)a=0,r=a;else if(0==M)0!=x?r/=x:r=0,0!=v?a/=v:a=0;else{M=1/M;var C=M*(v*r-d*a);a=M*(x*a-d*r),r=C}var k=this.b1.imass;this.b1.posx-=r*k,this.b1.posy-=a*k;var O=this.b2.imass;this.b2.posx+=r*O,this.b2.posy+=a*O;var I=this.b1,S=-(a*n-r*e)*this.b1.iinertia;if(I.rot+=S,S*S>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var P=S*S,T=1-.5*P,A=1-P*P/8,E=(T*I.axisx+S*I.axisy)*A;I.axisy=(T*I.axisy-S*I.axisx)*A,I.axisx=E}var N=this.b2,L=(a*i-r*t)*this.b2.iinertia;if(N.rot+=L,L*L>1e-4)N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot);else{var V=L*L,j=1-.5*V,D=1-V*V/8,F=(j*N.axisx+L*N.axisy)*D;N.axisy=(j*N.axisy-L*N.axisx)*D,N.axisx=F}return!1},draw:function(n){},__class__:Te});var Ae=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,Ce.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=Infinity,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};l["zpp_nape.constraint.ZPP_PulleyJoint"]=Ae,Ae.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],Ae.__super__=Ce,Ae.prototype=e(Ce.prototype,{outer_zn:null,ratio:null,jointMin:null,jointMax:null,slack:null,equal:null,is_slack:function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var e=0,i=0,t=0,l=0,p=0,r=0,a=0,s=0;p=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),r=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),a=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),s=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var o=Math.sqrt(p*p+r*r),_=Math.sqrt(a*a+s*s);if(0!=o){var h=1/o;e=p*h,i=r*h}if(0!=_){var u=1/_;t=a*u,l=s*u;var x=this.ratio;t*=x,l*=x}else{var d=this.ratio/Math.sqrt(t*t+l*l);t*=d,l*=d}var v=o+this.ratio*_;return this.equal?(v-=this.jointMax,n=!1):this.jointMin>v?(v=this.jointMin-v,e=-e,i=-i,t=-t,l=-l,n=!1):v>this.jointMax?(v-=this.jointMax,n=!1):(e=0,i=0,t=0,l=0,v=0,n=!0),n},n12x:null,n12y:null,n34x:null,n34y:null,cx1:null,cx2:null,cx3:null,cx4:null,bodyImpulse:function(n){if(this.stepped){var e=Pn.get();if(n==this.b1){var i=e,t=i.zpp_inner;null!=t._validate&&t._validate(),i.zpp_inner.x=i.zpp_inner.x-this.jAcc*this.n12x;var l=i.zpp_inner;null!=l._validate&&l._validate();var p=e,r=p.zpp_inner;null!=r._validate&&r._validate(),p.zpp_inner.y=p.zpp_inner.y-this.jAcc*this.n12y;var a=p.zpp_inner;null!=a._validate&&a._validate();var s=e,o=s.zpp_inner;null!=o._validate&&o._validate(),s.zpp_inner.z=s.zpp_inner.z-this.cx1*this.jAcc;var _=s.zpp_inner;null!=_._validate&&_._validate()}if(n==this.b2){var h=e,u=h.zpp_inner;null!=u._validate&&u._validate(),h.zpp_inner.x=h.zpp_inner.x+this.jAcc*this.n12x;var x=h.zpp_inner;null!=x._validate&&x._validate();var d=e,v=d.zpp_inner;null!=v._validate&&v._validate(),d.zpp_inner.y=d.zpp_inner.y+this.jAcc*this.n12y;var z=d.zpp_inner;null!=z._validate&&z._validate();var c=e,m=c.zpp_inner;null!=m._validate&&m._validate(),c.zpp_inner.z=c.zpp_inner.z+this.cx2*this.jAcc;var y=c.zpp_inner;null!=y._validate&&y._validate()}if(n==this.b3){var f=e,b=f.zpp_inner;null!=b._validate&&b._validate(),f.zpp_inner.x=f.zpp_inner.x-this.jAcc*this.n34x;var g=f.zpp_inner;null!=g._validate&&g._validate();var w=e,M=w.zpp_inner;null!=M._validate&&M._validate(),w.zpp_inner.y=w.zpp_inner.y-this.jAcc*this.n34y;var C=w.zpp_inner;null!=C._validate&&C._validate();var k=e,O=k.zpp_inner;null!=O._validate&&O._validate(),k.zpp_inner.z=k.zpp_inner.z-this.cx3*this.jAcc;var I=k.zpp_inner;null!=I._validate&&I._validate()}if(n==this.b4){var S=e,P=S.zpp_inner;null!=P._validate&&P._validate(),S.zpp_inner.x=S.zpp_inner.x+this.jAcc*this.n34x;var T=S.zpp_inner;null!=T._validate&&T._validate();var A=e,E=A.zpp_inner;null!=E._validate&&E._validate(),A.zpp_inner.y=A.zpp_inner.y+this.jAcc*this.n34y;var N=A.zpp_inner;null!=N._validate&&N._validate();var L=e,V=L.zpp_inner;null!=V._validate&&V._validate(),L.zpp_inner.z=L.zpp_inner.z+this.cx4*this.jAcc;var j=L.zpp_inner;null!=j._validate&&j._validate()}return e}return Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,t=this.a1localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=i(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=i(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,t=this.a2localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=i(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=i(this,this.invalidate_a2)},wrap_a2:null,b3:null,a3localx:null,a3localy:null,a3relx:null,a3rely:null,validate_a3:function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},invalidate_a3:function(n){this.immutable_midstep("Constraint::a3"),this.a3localx=n.x,this.a3localy=n.y,this.wake()},setup_a3:function(){var n,e=this.a3localx,t=this.a3localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a3=n,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=i(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=i(this,this.invalidate_a3)},wrap_a3:null,b4:null,a4localx:null,a4localy:null,a4relx:null,a4rely:null,validate_a4:function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},invalidate_a4:function(n){this.immutable_midstep("Constraint::a4"),this.a4localx=n.x,this.a4localy=n.y,this.wake()},setup_a4:function(){var n,e=this.a4localx,t=this.a4localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a4=n,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=i(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=i(this,this.invalidate_a4)},wrap_a4:null,kMass:null,jAcc:null,jMax:null,gamma:null,bias:null,stepped:null,copy:function(n,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var t=i.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var p=l.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_a3&&r.zpp_inner_zn.setup_a3();var a=r.zpp_inner_zn.wrap_a3,s=this.outer_zn;null==s.zpp_inner_zn.wrap_a4&&s.zpp_inner_zn.setup_a4();var o=new W(null,null,null,null,t,p,a,s.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(o),null!=n&&null!=this.b1){for(var _=null,h=0;n.length>h;){var u=n[h];if(++h,u.id==this.b1.id){_=u.bc;break}}null!=_?o.zpp_inner_zn.b1=_.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){o.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var x=null,d=0;n.length>d;){var v=n[d];if(++d,v.id==this.b2.id){x=v.bc;break}}null!=x?o.zpp_inner_zn.b2=x.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){o.zpp_inner_zn.b2=n.zpp_inner}))}if(null!=n&&null!=this.b3){for(var z=null,c=0;n.length>c;){var m=n[c];if(++c,m.id==this.b3.id){z=m.bc;break}}null!=z?o.zpp_inner_zn.b3=z.zpp_inner:e.push(Oe.todo(this.b3.id,function(n){o.zpp_inner_zn.b3=n.zpp_inner}))}if(null!=n&&null!=this.b4){for(var y=null,f=0;n.length>f;){var b=n[f];if(++f,b.id==this.b4.id){y=b.bc;break}}null!=y?o.zpp_inner_zn.b4=y.zpp_inner:e.push(Oe.todo(this.b4.id,function(n){o.zpp_inner_zn.b4=n.zpp_inner}))}return o},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake(),null!=this.b3&&this.b3.type==me.id_BodyType_DYNAMIC&&this.b3.wake(),null!=this.b4&&this.b4.type==me.id_BodyType_DYNAMIC&&this.b4.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}if(this.b3.type==me.id_BodyType_DYNAMIC){var f;if(this.b3.component==this.b3.component.parent)f=this.b3.component;else{for(var b=this.b3.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var M=g.parent;g.parent=b,g=M}f=b}var C;if(this.component==this.component.parent)C=this.component;else{for(var k=this.component,O=null;k!=k.parent;){var I=k.parent;k.parent=O,O=k,k=I}for(;null!=O;){var S=O.parent;O.parent=k,O=S}C=k}f!=C&&(C.rank>f.rank?f.parent=C:f.rank>C.rank?C.parent=f:(C.parent=f,f.rank++))}if(this.b4.type==me.id_BodyType_DYNAMIC){var P;if(this.b4.component==this.b4.component.parent)P=this.b4.component;else{for(var T=this.b4.component,A=null;T!=T.parent;){var E=T.parent;T.parent=A,A=T,T=E}for(;null!=A;){var N=A.parent;A.parent=T,A=N}P=T}var L;if(this.component==this.component.parent)L=this.component;else{for(var V=this.component,j=null;V!=V.parent;){var D=V.parent;V.parent=j,j=V,V=D}for(;null!=j;){var F=j.parent;j.parent=V,j=F}L=V}P!=L&&(L.rank>P.rank?P.parent=L:P.rank>L.rank?L.parent=P:(L.parent=P,P.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&(this.b2.id==e||this.b3.id==e||this.b4.id==e)||this.b2.id==n&&(this.b3.id==e||this.b4.id==e||this.b1.id==e)||this.b3.id==n&&(this.b4.id==e||this.b1.id==e||this.b2.id==e)||this.b4.id==n&&(this.b1.id==e||this.b2.id==e||this.b3.id==e)},clearcache:function(){this.jAcc=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var i=0,t=0,l=0,p=0;i=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),t=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),l=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),p=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var r=Math.sqrt(i*i+t*t),a=Math.sqrt(l*l+p*p);if(0!=r){var s=1/r;this.n12x=i*s,this.n12y=t*s}if(0!=a){var o=1/a;this.n34x=l*o,this.n34y=p*o;var _=this.ratio;this.n34x*=_,this.n34y*=_}else{var h=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y);this.n34x*=h,this.n34y*=h}var u=r+this.ratio*a;this.equal?(u-=this.jointMax,this.slack=!1):this.jointMin>u?(u=this.jointMin-u,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):u>this.jointMax?(u-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,this.n34y=0,u=0,this.slack=!0);var x=u;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;var d=this.ratio*this.ratio,v=this.b1.smass+this.b2.smass+d*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(v-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(v+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(v-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(v+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=v,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&x*x>this.maxError*this.maxError)return!0;var z,c=2*Math.PI*this.frequency;this.gamma=1/(n*c*(2*this.damping+c*n));var m=1/(1+this.gamma);z=n*c*c*this.gamma,this.gamma*=m,this.kMass*=m,this.bias=-x*z,-this.maxError>this.bias?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},warmStart:function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.n12x*n,this.b1.vely-=this.n12y*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.n12x*e,this.b2.vely+=this.n12y*e;var i=this.b3.imass*this.jAcc;this.b3.velx-=this.n34x*i,this.b3.vely-=this.n34y*i;var t=this.b4.imass*this.jAcc;this.b4.velx+=this.n34x*t,this.b4.vely+=this.n34y*t,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc}},applyImpulseVel:function(){if(this.slack)return!1;var n=this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3,e=this.kMass*(this.bias-n)-this.jAcc*this.gamma,i=this.jAcc;if(this.jAcc+=e,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&-this.jMax>this.jAcc)return!0;this.stiff||-this.jMax>this.jAcc&&(this.jAcc=-this.jMax),e=this.jAcc-i;var t=this.b1.imass*e;this.b1.velx-=this.n12x*t,this.b1.vely-=this.n12y*t;var l=this.b2.imass*e;this.b2.velx+=this.n12x*l,this.b2.vely+=this.n12y*l;var p=this.b3.imass*e;this.b3.velx-=this.n34x*p,this.b3.vely-=this.n34y*p;var r=this.b4.imass*e;return this.b4.velx+=this.n34x*r,this.b4.vely+=this.n34y*r,this.b1.angvel-=this.cx1*this.b1.iinertia*e,this.b2.angvel+=this.cx2*this.b2.iinertia*e,this.b3.angvel-=this.cx3*this.b3.iinertia*e,this.b4.angvel+=this.cx4*this.b4.iinertia*e,!1},applyImpulsePos:function(){var n,e,i=0,t=0;i=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,t=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var l=0,p=0;l=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,p=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var r=0,a=0;r=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,a=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy;var s=0,o=0;s=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,o=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var _,h=0,u=0,x=0,d=0;h=this.n12x,u=this.n12y,x=this.n34x,d=this.n34y;var v=0,z=0,c=0,m=0;v=this.b2.posx+l-(this.b1.posx+i),z=this.b2.posy+p-(this.b1.posy+t),c=this.b4.posx+s-(this.b3.posx+r),m=this.b4.posy+o-(this.b3.posy+a);var f=Math.sqrt(v*v+z*z),b=Math.sqrt(c*c+m*m);if(0!=f){var g=1/f;h=v*g,u=z*g}if(0!=b){var w=1/b;x=c*w,d=m*w;var M=this.ratio;x*=M,d*=M}else{var C=this.ratio/Math.sqrt(x*x+d*d);x*=C,d*=C}var k=f+this.ratio*b;if(this.equal?(k-=this.jointMax,_=!1):this.jointMin>k?(k=this.jointMin-k,h=-h,u=-u,x=-x,d=-d,_=!1):k>this.jointMax?(k-=this.jointMax,_=!1):(h=0,u=0,x=0,d=0,k=0,_=!0),n=k,!_){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(y.constraintLinearSlop*y.constraintLinearSlop>n*n)return!1;if((n*=.5)*n>6){var O=this.b1.smass+this.b2.smass;if(O>y.epsilon&&(O=.75/O,e=-n*O,this.equal||0>e)){var I=e*this.b1.imass;this.b1.posx-=h*I,this.b1.posy-=u*I;var S=e*this.b2.imass;this.b2.posx+=h*S,this.b2.posy+=u*S;var P=e*this.b3.imass;this.b3.posx-=x*P,this.b3.posy-=d*P;var T=e*this.b4.imass;this.b4.posx+=x*T,this.b4.posy+=d*T;var A=0,E=0,N=0,L=0;A=this.b2.posx+l-(this.b1.posx+i),E=this.b2.posy+p-(this.b1.posy+t),N=this.b4.posx+s-(this.b3.posx+r),L=this.b4.posy+o-(this.b3.posy+a);var V=Math.sqrt(A*A+E*E),j=Math.sqrt(N*N+L*L);if(0!=V){var D=1/V;h=A*D,u=E*D}if(0!=j){var F=1/j;x=N*F,d=L*F;var R=this.ratio;x*=R,d*=R}else{var B=this.ratio/Math.sqrt(x*x+d*d);x*=B,d*=B}var G=V+this.ratio*j;this.equal?(G-=this.jointMax,_=!1):this.jointMin>G?(G=this.jointMin-G,h=-h,u=-u,x=-x,d=-d,_=!1):G>this.jointMax?(G-=this.jointMax,_=!1):(h=0,u=0,x=0,d=0,G=0,_=!0),n=G,n*=.5}}var Z,U,q,Y;Z=u*i-h*t,U=u*l-h*p,q=d*r-x*a,Y=d*s-x*o;var K=this.ratio*this.ratio,W=this.b1.smass+this.b2.smass+K*(this.b3.smass+this.b4.smass)+this.b1.sinertia*Z*Z+this.b2.sinertia*U*U+this.b3.sinertia*q*q+this.b4.sinertia*Y*Y;this.b1==this.b4&&(W-=2*((h*x+u*d)*this.b1.smass+Z*Y*this.b1.sinertia)),this.b1==this.b3&&(W+=2*((h*x+u*d)*this.b1.smass+Z*q*this.b1.sinertia)),this.b2==this.b3&&(W-=2*((h*x+u*d)*this.b2.smass+U*q*this.b2.sinertia)),this.b2==this.b4&&(W+=2*((h*x+u*d)*this.b2.smass+U*Y*this.b2.sinertia));var J=W;if(0!=J&&(J=1/J),e=-n*J,this.equal||0>e){var X=this.b1.imass*e;this.b1.posx-=h*X,this.b1.posy-=u*X;var H=this.b2.imass*e;this.b2.posx+=h*H,this.b2.posy+=u*H;var Q=this.b3.imass*e;this.b3.posx-=x*Q,this.b3.posy-=d*Q;var $=this.b4.imass*e;this.b4.posx+=x*$,this.b4.posy+=d*$;var nn=this.b1,en=-Z*this.b1.iinertia*e;if(nn.rot+=en,en*en>1e-4)nn.axisx=Math.sin(nn.rot),nn.axisy=Math.cos(nn.rot);else{var tn=en*en,ln=1-.5*tn,pn=1-tn*tn/8,rn=(ln*nn.axisx+en*nn.axisy)*pn;nn.axisy=(ln*nn.axisy-en*nn.axisx)*pn,nn.axisx=rn}var an=this.b2,sn=U*this.b2.iinertia*e;if(an.rot+=sn,sn*sn>1e-4)an.axisx=Math.sin(an.rot),an.axisy=Math.cos(an.rot);else{var on=sn*sn,_n=1-.5*on,hn=1-on*on/8,un=(_n*an.axisx+sn*an.axisy)*hn;an.axisy=(_n*an.axisy-sn*an.axisx)*hn,an.axisx=un}var xn=this.b3,dn=-q*this.b3.iinertia*e;if(xn.rot+=dn,dn*dn>1e-4)xn.axisx=Math.sin(xn.rot),xn.axisy=Math.cos(xn.rot);else{var vn=dn*dn,zn=1-.5*vn,cn=1-vn*vn/8,mn=(zn*xn.axisx+dn*xn.axisy)*cn;xn.axisy=(zn*xn.axisy-dn*xn.axisx)*cn,xn.axisx=mn}var yn=this.b4,fn=Y*this.b4.iinertia*e;if(yn.rot+=fn,fn*fn>1e-4)yn.axisx=Math.sin(yn.rot),yn.axisy=Math.cos(yn.rot);else{var bn=fn*fn,gn=1-.5*bn,wn=1-bn*bn/8,Mn=(gn*yn.axisx+fn*yn.axisy)*wn;yn.axisy=(gn*yn.axisy-fn*yn.axisx)*wn,yn.axisx=Mn}}}return!1},draw:function(n){},__class__:Ae});var Ee=function(n,e){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,Ce.call(this),this.bodies=[],this.dim=n,this.velonly=e,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=Pn.get(0,0,0);for(var i=0,t=n;t>i;){var l=i++;this.jAcc[l]=this.bias[l]=this.J[l]=this.jOld[l]=this.y[l]=0;for(var p=0,r=n;r>p;){this.L[l*n+p++]=0}}this.stepped=!1};l["zpp_nape.constraint.ZPP_UserConstraint"]=Ee,Ee.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],Ee.__super__=Ce,Ee.prototype=e(Ce.prototype,{outer_zn:null,bindVec2_invalidate:function(n){this.outer_zn.__invalidate()},bodies:null,dim:null,jAcc:null,bias:null,addBody:function(n){for(var e=null,i=0,t=this.bodies;t.length>i;){var l=t[i];if(++i,l.body==n){e=l;break}}null==e?(this.bodies.push(new Ne(1,n)),this.active&&null!=this.space&&null!=n&&n.constraints.add(this)):e.cnt++},remBody:function(n){for(var e=null,i=0|this.bodies.length,t=0;i>t;){var l=this.bodies[t];if(l.body==n){l.cnt--,0==l.cnt&&(i>0&&(this.bodies[t]=this.bodies[i-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=n&&n.constraints.remove(this)),e=l;break}++t}return null!=e},bodyImpulse:function(n){for(var e=0,i=this.dim;i>e;){var t=e++;this.J[t]=this.jAcc[t]}var l=Pn.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,n.outer,l),l},activeBodies:function(){for(var n=0,e=this.bodies;e.length>n;){var i=e[n];++n,null!=i.body&&i.body.constraints.add(this)}},inactiveBodies:function(){for(var n=0,e=this.bodies;e.length>n;){var i=e[n];++n,null!=i.body&&i.body.constraints.remove(this)}},stepped:null,copy:function(n,e){this.copyto(this.outer_zn.__copy())},validate:function(){for(var n=0,e=this.bodies;e.length>n;){++n}this.outer_zn.__validate()},wake_connected:function(){for(var n=0,e=this.bodies;e.length>n;){var i=e[n];++n,i.body.type==me.id_BodyType_DYNAMIC&&i.body.wake()}},forest:function(){for(var n=0,e=this.bodies;e.length>n;){var i=e[n];if(++n,i.body.type==me.id_BodyType_DYNAMIC){var t;if(i.body.component==i.body.component.parent)t=i.body.component;else{for(var l=i.body.component,p=null;l!=l.parent;){var r=l.parent;l.parent=p,p=l,l=r}for(;null!=p;){var a=p.parent;p.parent=l,p=a}t=l}var s;if(this.component==this.component.parent)s=this.component;else{for(var o=this.component,_=null;o!=o.parent;){var h=o.parent;o.parent=_,_=o,o=h}for(;null!=_;){var u=_.parent;_.parent=o,_=u}s=o}t!=s&&(s.rank>t.rank?t.parent=s:t.rank>s.rank?s.parent=t:(s.parent=t,t.rank++))}}},pair_exists:function(n,e){for(var i=!1,t=0|this.bodies.length,l=0,p=t;p>l;){for(var r=l++,a=this.bodies[r].body,s=r+1,o=t;o>s;){var _=s++,h=this.bodies[_].body;if(a.id==n&&h.id==e||a.id==e&&h.id==n){i=!0;break}}if(i)break}return i},broken:function(){this.outer_zn.__broken()},clearcache:function(){for(var n=0,e=this.dim;e>n;){this.jAcc[n++]=0}this.pre_dt=-1},lsq:function(n){for(var e=0,i=0,t=this.dim;t>i;){var l=i++;e+=n[l]*n[l]}return e},_clamp:function(n,e){var i=this.lsq(n);if(i>e*e)for(var t=e/Math.sqrt(i),l=0,p=this.dim;p>l;){var r=l++;n[r]*=t}},L:null,solve:function(n){for(var e=0,i=0,t=this.dim;t>i;){for(var l=i++,p=0,r=0,a=l-1;a>r;){var s=r++;p+=this.L[l*this.dim+s]*this.L[l*this.dim+s]}var o=Math.sqrt(n[e++]-p);if(this.L[l*this.dim+l]=o,0!=o){o=1/o;for(var _=l+1,h=this.dim;h>_;){for(var u=_++,x=0,d=0,v=l-1;v>d;){var z=d++;x+=this.L[u*this.dim+z]*this.L[l*this.dim+z]}this.L[u*this.dim+l]=o*(n[e++]-x)}}else{for(var c=l+1,m=this.dim;m>c;){this.L[c++*this.dim+l]=0}e+=this.dim-l-1}}return this.L},y:null,transform:function(n,e){for(var i=0,t=this.dim;t>i;){var l=i++,p=e[l],r=n[l*this.dim+l];if(0!=r){for(var a=0,s=l;s>a;){var o=a++;p-=n[l*this.dim+o]*this.y[o]}this.y[l]=p/r}else this.y[l]=0}for(var _=0,h=this.dim;h>_;){var u=_++,x=this.dim-1-u,d=n[x*this.dim+x];if(0!=d){for(var v=this.y[x],z=x+1,c=this.dim;c>z;){var m=z++;v-=n[m*this.dim+x]*e[m]}e[x]=v/d}else e[x]=0}},soft:null,gamma:null,velonly:null,jMax:null,Keff:null,preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;if(this.pre_dt=n,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var i=0,t=this.dim;t>i;){this.bias[i++]=0}this.gamma=0,this.soft=1}else{var l,p=2*Math.PI*this.frequency;this.gamma=1/(n*p*(2*this.damping+p*n));var r=1/(1+this.gamma);if(l=n*p*p*this.gamma,this.gamma*=r,this.soft=r,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var a=0,s=this.dim;s>a;){this.bias[a++]*=-l}this._clamp(this.bias,this.maxError)}for(var o=0,_=this.dim;_>o;){this.jAcc[o++]*=e}return this.jMax=this.maxForce*n,!1},vec3:null,warmStart:function(){for(var n=0,e=this.bodies;e.length>n;){var i=e[n];++n;var t=i.body;this.outer_zn.__impulse(this.jAcc,t.outer,this.vec3);var l=t.imass,p=t,r=p.velx,a=this.vec3,s=a.zpp_inner;null!=s._validate&&s._validate(),p.velx=r+a.zpp_inner.x*l;var o=t,_=o.vely,h=this.vec3,u=h.zpp_inner;null!=u._validate&&u._validate(),o.vely=_+h.zpp_inner.y*l;var x=t,d=x.angvel,v=this.vec3,z=v.zpp_inner;null!=z._validate&&z._validate(),x.angvel=d+v.zpp_inner.z*t.iinertia}},J:null,jOld:null,applyImpulseVel:function(){this.outer_zn.__velocity(this.J);for(var n=0,e=this.dim;e>n;){var i=n++;this.J[i]=this.bias[i]-this.J[i]}this.transform(this.L,this.J);for(var t=0,l=this.dim;l>t;){var p=t++;this.jOld[p]=this.jAcc[p],this.jAcc[p]+=this.J[p]=this.J[p]*this.soft-this.jAcc[p]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var r=0,a=this.dim;a>r;){var s=r++;this.J[s]=this.jAcc[s]-this.jOld[s]}for(var o=0,_=this.bodies;_.length>o;){var h=_[o];++o;var u=h.body;this.outer_zn.__impulse(this.J,u.outer,this.vec3);var x=u.imass,d=u,v=d.velx,z=this.vec3,c=z.zpp_inner;null!=c._validate&&c._validate(),d.velx=v+z.zpp_inner.x*x;var m=u,y=m.vely,f=this.vec3,b=f.zpp_inner;null!=b._validate&&b._validate(),m.vely=y+f.zpp_inner.y*x;var g=u,w=g.angvel,M=this.vec3,C=M.zpp_inner;null!=C._validate&&C._validate(),g.angvel=w+M.zpp_inner.z*u.iinertia}return!1},applyImpulsePos:function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var n=this.lsq(this.J);if(this.breakUnderError&&n>this.maxError*this.maxError)return!0;if(y.constraintLinearSlop*y.constraintLinearSlop>n)return!1;for(var e=0,i=this.dim;i>e;){this.J[e++]*=-1}this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var t=0,l=this.bodies;l.length>t;){var p=l[t];++t;var r=p.body;this.outer_zn.__impulse(this.J,r.outer,this.vec3);var a=r.imass,s=r,o=s.posx,_=this.vec3,h=_.zpp_inner;null!=h._validate&&h._validate(),s.posx=o+_.zpp_inner.x*a;var u=r,x=u.posy,d=this.vec3,v=d.zpp_inner;null!=v._validate&&v._validate(),u.posy=x+d.zpp_inner.y*a;var z=this.vec3,c=z.zpp_inner;null!=c._validate&&c._validate();var m=z.zpp_inner.z*r.iinertia;if(r.rot+=m,m*m>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var f=m*m,b=1-.5*f,g=1-f*f/8,w=(b*r.axisx+m*r.axisy)*g;r.axisy=(b*r.axisy-m*r.axisx)*g,r.axisx=w}}return!1},draw:function(n){this.outer_zn.__draw(n)},__class__:Ee});var Ne=function(n,e){this.body=null,this.cnt=0,this.cnt=n,this.body=e};l["zpp_nape.constraint.ZPP_UserBody"]=Ne,Ne.__name__=["zpp_nape","constraint","ZPP_UserBody"],Ne.prototype={cnt:null,body:null,__class__:Ne};var Le=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,Ce.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=Infinity,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};l["zpp_nape.constraint.ZPP_WeldJoint"]=Le,Le.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],Le.__super__=Ce,Le.prototype=e(Ce.prototype,{outer_zn:null,bodyImpulse:function(n){return this.stepped?n==this.b1?Pn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):Pn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):Pn.get(0,0,0)},activeBodies:function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},inactiveBodies:function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},b1:null,a1localx:null,a1localy:null,a1relx:null,a1rely:null,validate_a1:function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},invalidate_a1:function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},setup_a1:function(){var n,e=this.a1localx,t=this.a1localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=i(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=i(this,this.invalidate_a1)},wrap_a1:null,b2:null,a2localx:null,a2localy:null,a2relx:null,a2rely:null,validate_a2:function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},invalidate_a2:function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},setup_a2:function(){var n,e=this.a2localx,t=this.a2localy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=i(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=i(this,this.invalidate_a2)},wrap_a2:null,phase:null,kMassa:null,kMassb:null,kMassd:null,kMassc:null,kMasse:null,kMassf:null,jAccx:null,jAccy:null,jAccz:null,jMax:null,gamma:null,biasx:null,biasy:null,biasz:null,stepped:null,copy:function(n,e){var i=this.outer_zn;null==i.zpp_inner_zn.wrap_a1&&i.zpp_inner_zn.setup_a1();var t=i.zpp_inner_zn.wrap_a1,l=this.outer_zn;null==l.zpp_inner_zn.wrap_a2&&l.zpp_inner_zn.setup_a2();var p=new K(null,null,t,l.zpp_inner_zn.wrap_a2);if(this.copyto(p),null!=n&&null!=this.b1){for(var r=null,a=0;n.length>a;){var s=n[a];if(++a,s.id==this.b1.id){r=s.bc;break}}null!=r?p.zpp_inner_zn.b1=r.zpp_inner:e.push(Oe.todo(this.b1.id,function(n){p.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var o=null,_=0;n.length>_;){var h=n[_];if(++_,h.id==this.b2.id){o=h.bc;break}}null!=o?p.zpp_inner_zn.b2=o.zpp_inner:e.push(Oe.todo(this.b2.id,function(n){p.zpp_inner_zn.b2=n.zpp_inner}))}return p},validate:function(){},wake_connected:function(){null!=this.b1&&this.b1.type==me.id_BodyType_DYNAMIC&&this.b1.wake(),null!=this.b2&&this.b2.type==me.id_BodyType_DYNAMIC&&this.b2.wake()},forest:function(){if(this.b1.type==me.id_BodyType_DYNAMIC){var n;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var e=this.b1.component,i=null;e!=e.parent;){var t=e.parent;e.parent=i,i=e,e=t}for(;null!=i;){var l=i.parent;i.parent=e,i=l}n=e}var p;if(this.component==this.component.parent)p=this.component;else{for(var r=this.component,a=null;r!=r.parent;){var s=r.parent;r.parent=a,a=r,r=s}for(;null!=a;){var o=a.parent;a.parent=r,a=o}p=r}n!=p&&(p.rank>n.rank?n.parent=p:n.rank>p.rank?p.parent=n:(p.parent=n,n.rank++))}if(this.b2.type==me.id_BodyType_DYNAMIC){var _;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var h=this.b2.component,u=null;h!=h.parent;){var x=h.parent;h.parent=u,u=h,h=x}for(;null!=u;){var d=u.parent;u.parent=h,u=d}_=h}var v;if(this.component==this.component.parent)v=this.component;else{for(var z=this.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}_!=v&&(v.rank>_.rank?_.parent=v:_.rank>v.rank?v.parent=_:(v.parent=_,_.rank++))}},pair_exists:function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},clearcache:function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},preStep:function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var i=this.b1.smass+this.b2.smass;if(this.kMassa=i,this.kMassb=0,this.kMassd=i,this.kMassc=0,this.kMasse=0,this.kMassf=0,0!=this.b1.sinertia){var t=this.a1relx*this.b1.sinertia,l=this.a1rely*this.b1.sinertia;this.kMassa+=l*this.a1rely,this.kMassb+=-l*this.a1relx,this.kMassd+=t*this.a1relx,this.kMassc+=-l,this.kMasse+=t,this.kMassf+=this.b1.sinertia}if(0!=this.b2.sinertia){var p=this.a2relx*this.b2.sinertia,r=this.a2rely*this.b2.sinertia;this.kMassa+=r*this.a2rely,this.kMassb+=-r*this.a2relx,this.kMassd+=p*this.a2relx,this.kMassc+=-r,this.kMasse+=p,this.kMassf+=this.b2.sinertia}var a,s=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(s!=s)this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,a=7;else if(0==s){var o=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,o|=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,o|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,o|=4),this.kMassb=this.kMassc=this.kMasse=0,a=o}else{s=1/s;var _=s*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),h=s*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),u=s*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),x=s*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),d=s*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),v=s*(this.kMassa*this.kMassd-this.kMassb*this.kMassb);this.kMassa=_,this.kMassb=h,this.kMassd=u,this.kMassc=x,this.kMasse=d,this.kMassf=v,a=0}if(0!=(1&a)&&(this.jAccx=0),0!=(2&a)&&(this.jAccy=0),0!=(4&a)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var z,c=2*Math.PI*this.frequency;this.gamma=1/(n*c*(2*this.damping+c*n));var m=1/(1+this.gamma);z=n*c*c*this.gamma,this.gamma*=m;var y=m;if(this.kMassa*=y,this.kMassb*=y,this.kMassd*=y,this.kMassc*=y,this.kMasse*=y,this.kMassf*=y,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;var f=-z,b=f;this.biasx*=b,this.biasy*=b,this.biasz*=f;var g=this.maxError,w=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;if(w>g*g){var M=g*(1/Math.sqrt(w)),C=M;this.biasx*=C,this.biasy*=C,this.biasz*=M}}var k=e,O=k;return this.jAccx*=O,this.jAccy*=O,this.jAccz*=k,this.jMax=this.maxForce*n,!1},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},applyImpulseVel:function(){var n=0,e=0,i=0;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),i=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel;var t=0,l=0,p=0;t=this.biasx-n,l=this.biasy-e,p=this.biasz-i;var r=this.kMassa*t+this.kMassb*l+this.kMassc*p,a=this.kMassb*t+this.kMassd*l+this.kMasse*p;p=this.kMassc*t+this.kMasse*l+this.kMassf*p,t=r,l=a;var s=this.gamma,o=s;t-=this.jAccx*o,l-=this.jAccy*o,p-=this.jAccz*s;var _=0,h=0,u=0;_=this.jAccx,h=this.jAccy,u=this.jAccz;if(this.jAccx+=1*t,this.jAccy+=1*l,this.jAccz+=1*p,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else if(!this.stiff){var x=this.jMax,d=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz;if(d>x*x){var v=x*(1/Math.sqrt(d)),z=v;this.jAccx*=z,this.jAccy*=z,this.jAccz*=v}}t=this.jAccx-_,l=this.jAccy-h,p=this.jAccz-u;var c=this.b1.imass;this.b1.velx-=t*c,this.b1.vely-=l*c;var m=this.b2.imass;return this.b2.velx+=t*m,this.b2.vely+=l*m,this.b1.angvel-=(l*this.a1relx-t*this.a1rely+p)*this.b1.iinertia,this.b2.angvel+=(l*this.a2relx-t*this.a2rely+p)*this.b2.iinertia,!1},applyImpulsePos:function(){var n=0,e=0;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var i=0,t=0;i=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,t=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var l=0,p=0,r=0;l=this.b2.posx+i-(this.b1.posx+n),p=this.b2.posy+t-(this.b1.posy+e),r=this.b2.rot-this.b1.rot-this.phase;var a=0,s=0,o=0;if(this.breakUnderError&&l*l+p*p+r*r>this.maxError*this.maxError)return!0;var _=!0;y.constraintLinearSlop*y.constraintLinearSlop>l*l+p*p&&(_=!1,l=0,p=0);var h=y.constraintAngularSlop;if(h*h>r*r){if(!_)return!1;r=0}if(l*=.5,p*=.5,r*=.5,l*l+p*p>6){var u=this.b1.smass+this.b2.smass;if(u>y.epsilon){u=.75/u,a=-l*u,s=-p*u;var x=a*a+s*s;if(x>400){var d=1/Math.sqrt(x)*20;a*=d,s*=d}var v=this.b1.imass;this.b1.posx-=a*v,this.b1.posy-=s*v;var z=this.b2.imass;this.b2.posx+=a*z,this.b2.posy+=s*z,l=this.b2.posx+i-(this.b1.posx+n),p=this.b2.posy+t-(this.b1.posy+e),r=this.b2.rot-this.b1.rot-this.phase;l*=.5,p*=.5,r*=.5}}var c=0,m=0,f=0,b=0,g=0,w=0,M=this.b1.smass+this.b2.smass;if(c=M,m=0,f=M,b=0,g=0,w=0,0!=this.b1.sinertia){var C=n*this.b1.sinertia,k=e*this.b1.sinertia;c+=k*e,m+=-k*n,f+=C*n,b+=-k,g+=C,w+=this.b1.sinertia}if(0!=this.b2.sinertia){var O=i*this.b2.sinertia,I=t*this.b2.sinertia;c+=I*t,m+=-I*i,f+=O*i,b+=-I,g+=O,w+=this.b2.sinertia}a=-l,s=-p,o=-r;var S=a*a+s*s;if(S>36){var P=1/Math.sqrt(S)*6;a*=P,s*=P}if(-.25<=o);var T=c*(f*w-g*g)+m*(b*g-m*w)+b*(m*g-b*f);if(T!=T)o=0,s=o,a=s;else if(0==T)0!=c?a/=c:a=0,0!=f?s/=f:s=0,0!=w?o/=w:o=0;else{T=1/T;var A=g*b-m*w,E=m*g-b*f,N=m*b-c*g,L=T*(a*(f*w-g*g)+s*A+o*E),V=T*(a*A+s*(c*w-b*b)+o*N);o=T*(a*E+s*N+o*(c*f-m*m)),a=L,s=V}var j=this.b1.imass;this.b1.posx-=a*j,this.b1.posy-=s*j;var D=this.b2.imass;this.b2.posx+=a*D,this.b2.posy+=s*D;var F=this.b1,R=-(s*n-a*e+o)*this.b1.iinertia;if(F.rot+=R,R*R>1e-4)F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot);else{var B=R*R,G=1-.5*B,Z=1-B*B/8,U=(G*F.axisx+R*F.axisy)*Z;F.axisy=(G*F.axisy-R*F.axisx)*Z,F.axisx=U}var q=this.b2,Y=(s*i-a*t+o)*this.b2.iinertia;if(q.rot+=Y,Y*Y>1e-4)q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot);else{var K=Y*Y,W=1-.5*K,J=1-K*K/8,X=(W*q.axisx+Y*q.axisy)*J;q.axisy=(W*q.axisy-Y*q.axisx)*J,q.axisx=X}return!1},draw:function(n){},__class__:Le});var Ve=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};l["zpp_nape.dynamics.ZPP_Arbiter"]=Ve,Ve.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],Ve.prototype={outer:null,wrapper:function(){return null==this.outer&&(Ve.internal=!0,this.type==Ve.COL?(this.colarb.outer_zn=new en,this.outer=this.colarb.outer_zn):this.type==Ve.FLUID?(this.fluidarb.outer_zn=new rn,this.outer=this.fluidarb.outer_zn):this.outer=new H,this.outer.zpp_inner=this,Ve.internal=!1),this.outer},inactiveme:function(){return!this.active},hnext:null,id:null,di:null,stamp:null,up_stamp:null,sleep_stamp:null,endGenerated:null,active:null,cleared:null,sleeping:null,present:null,intchange:null,presentable:null,continuous:null,fresh:null,immState:null,acting:function(){return!!this.active&&0!=(this.immState&me.id_ImmState_ACCEPT)},invalidated:null,b1:null,b2:null,ws1:null,ws2:null,pair:null,swap_features:function(){var n=this.b1;this.b1=this.b2,this.b2=n;var e=this.ws1;this.ws1=this.ws2,this.ws2=e;var i=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=i},type:null,colarb:null,fluidarb:null,sensorarb:null,lazyRetire:function(n,e){if(this.cleared=!0,null==e||this.b2==e)for(var i=this.b1.arbiters,t=null,l=i.head;null!=l;){if(l.elt==this){var p,r;null==t?(p=i.head,r=p.next,null==(i.head=r)&&(i.pushmod=!0)):(p=t.next,r=p.next,t.next=r,null==r&&(i.pushmod=!0));var a=p;a.elt=null,a.next=Vt.zpp_pool,Vt.zpp_pool=a,i.modified=!0,i.length--,i.pushmod=!0,!0;break}t=l,l=l.next}if(null==e||this.b1==e)for(var s=this.b2.arbiters,o=null,_=s.head;null!=_;){if(_.elt==this){var h,u;null==o?(h=s.head,u=h.next,null==(s.head=u)&&(s.pushmod=!0)):(h=o.next,u=h.next,o.next=u,null==u&&(s.pushmod=!0));var x=h;x.elt=null,x.next=Vt.zpp_pool,Vt.zpp_pool=x,s.modified=!0,s.length--,s.pushmod=!0,!0;break}o=_,_=_.next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,n.f_arbiters.modified=!0},sup_assign:function(n,e,i,t){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=i,this.di=t;var l,p=this.b1.arbiters;null==Vt.zpp_pool?l=new Vt:(l=Vt.zpp_pool,Vt.zpp_pool=l.next,l.next=null),l.elt=this;var r=l;r.next=p.head,p.head=r,p.modified=!0,p.length++;var a,s=this.b2.arbiters;null==Vt.zpp_pool?a=new Vt:(a=Vt.zpp_pool,Vt.zpp_pool=a.next,a.next=null),a.elt=this;var o=a;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},sup_retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,i=n.head;null!=i;){if(i.elt==this){var t,l;null==e?(t=n.head,l=t.next,null==(n.head=l)&&(n.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(n.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=i,i=i.next}for(var r=this.b2.arbiters,a=null,s=r.head;null!=s;){if(s.elt==this){var o,_;null==a?(o=r.head,_=o.next,null==(r.head=_)&&(r.pushmod=!0)):(o=a.next,_=o.next,a.next=_,null==_&&(r.pushmod=!0));var h=o;h.elt=null,h.next=Vt.zpp_pool,Vt.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0,!0;break}a=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},__class__:Ve};var je=function(){this.next=null,Ve.call(this),this.type=Ve.SENSOR,this.sensorarb=this};l["zpp_nape.dynamics.ZPP_SensorArbiter"]=je,je.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],je.__super__=Ve,je.prototype=e(Ve.prototype,{next:null,alloc:function(){},free:function(){},assign:function(n,e,i,t){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=i,this.di=t;var l,p=this.b1.arbiters;null==Vt.zpp_pool?l=new Vt:(l=Vt.zpp_pool,Vt.zpp_pool=l.next,l.next=null),l.elt=this;var r=l;r.next=p.head,p.head=r,p.modified=!0,p.length++;var a,s=this.b2.arbiters;null==Vt.zpp_pool?a=new Vt:(a=Vt.zpp_pool,Vt.zpp_pool=a.next,a.next=null),a.elt=this;var o=a;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,i=n.head;null!=i;){if(i.elt==this){var t,l;null==e?(t=n.head,l=t.next,null==(n.head=l)&&(n.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(n.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=i,i=i.next}for(var r=this.b2.arbiters,a=null,s=r.head;null!=s;){if(s.elt==this){var o,_;null==a?(o=r.head,_=o.next,null==(r.head=_)&&(r.pushmod=!0)):(o=a.next,_=o.next,a.next=_,null==_&&(r.pushmod=!0));var h=o;h.elt=null,h.next=Vt.zpp_pool,Vt.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0,!0;break}a=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;var u=this;u.next=je.zpp_pool,je.zpp_pool=u},makemutable:function(){},makeimmutable:function(){},__class__:je});var De=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,Ve.call(this),this.type=Ve.FLUID,this.fluidarb=this,this.buoyx=0,this.buoyy=0,this.pre_dt=-1};l["zpp_nape.dynamics.ZPP_FluidArbiter"]=De,De.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],De.__super__=Ve,De.prototype=e(Ve.prototype,{outer_zn:null,next:null,alloc:function(){},free:function(){},centroidx:null,centroidy:null,overlap:null,r1x:null,r1y:null,r2x:null,r2y:null,nodrag:null,wMass:null,adamp:null,agamma:null,vMassa:null,vMassb:null,vMassc:null,dampx:null,dampy:null,lgamma:null,nx:null,ny:null,buoyx:null,buoyy:null,position_validate:function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},position_invalidate:function(n){this.centroidx=n.x,this.centroidy=n.y},wrap_position:null,getposition:function(){var n;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=i(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=i(this,this.position_invalidate)},assign:function(n,e,i,t){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=i,this.di=t;var l,p=this.b1.arbiters;null==Vt.zpp_pool?l=new Vt:(l=Vt.zpp_pool,Vt.zpp_pool=l.next,l.next=null),l.elt=this;var r=l;r.next=p.head,p.head=r,p.modified=!0,p.length++;var a,s=this.b2.arbiters;null==Vt.zpp_pool?a=new Vt:(a=Vt.zpp_pool,Vt.zpp_pool=a.next,a.next=null),a.elt=this;var o=a;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,i=n.head;null!=i;){if(i.elt==this){var t,l;null==e?(t=n.head,l=t.next,null==(n.head=l)&&(n.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(n.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=i,i=i.next}for(var r=this.b2.arbiters,a=null,s=r.head;null!=s;){if(s.elt==this){var o,_;null==a?(o=r.head,_=o.next,null==(r.head=_)&&(r.pushmod=!0)):(o=a.next,_=o.next,a.next=_,null==_&&(r.pushmod=!0));var h=o;h.elt=null,h.next=Vt.zpp_pool,Vt.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0,!0;break}a=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;var u=this;u.next=De.zpp_pool,De.zpp_pool=u,this.pre_dt=-1},mutable:null,makemutable:function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},makeimmutable:function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},inject:function(n,e,i){this.overlap=n,this.centroidx=e,this.centroidy=i},pre_dt:null,preStep:function(n,e){-1==this.pre_dt&&(this.pre_dt=e);var i=e/this.pre_dt;this.pre_dt=e,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var t=0,l=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(t=this.ws1.fluidProperties.gravityx,l=this.ws1.fluidProperties.gravityy):(t=n.gravityx,l=n.gravityy);var p=0,r=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(p=this.ws2.fluidProperties.gravityx,r=this.ws2.fluidProperties.gravityy):(p=n.gravityx,r=n.gravityy);var a=0,s=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var o=this.overlap*this.ws1.fluidProperties.density,_=this.overlap*this.ws2.fluidProperties.density;if(o>_){var h=o+_;a-=t*h,s-=l*h}else if(_>o){var u=o+_;a+=p*u,s+=r*u}else{var x=0,d=0;x=t+p,d=l+r;if(x*=.5,d*=.5,this.ws1.worldCOMx*x+this.ws1.worldCOMy*d>this.ws2.worldCOMx*x+this.ws2.worldCOMy*d){var v=o+_;a-=x*v,s-=d*v}else{var z=o+_;a+=x*z,s+=d*z}}}else if(this.ws1.fluidEnabled){var c=this.overlap*this.ws1.fluidProperties.density,m=c;a-=t*m,s-=l*m}else if(this.ws2.fluidEnabled){var f=this.overlap*this.ws2.fluidProperties.density,b=f;a+=p*b,s+=r*b}var g=e;if(a*=g,s*=g,this.buoyx=a,this.buoyy=s,this.b1.type==me.id_BodyType_DYNAMIC){var w=this.b1.imass;this.b1.velx-=a*w,this.b1.vely-=s*w,this.b1.angvel-=(s*this.r1x-a*this.r1y)*this.b1.iinertia}if(this.b2.type==me.id_BodyType_DYNAMIC){var M=this.b2.imass;this.b2.velx+=a*M,this.b2.vely+=s*M,this.b2.angvel+=(s*this.r2x-a*this.r2y)*this.b2.iinertia}if(this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var C=0;if(this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),C+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),C+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=C){var k=this.b1.sinertia+this.b2.sinertia;this.wMass=0!=k?1/k:0;C*=4e-4;var O=2*Math.PI*C;this.agamma=1/(e*O*(2+O*e));var I=1/(1+this.agamma);e*O*O*this.agamma,this.agamma*=I,this.wMass*=I}else this.wMass=0,this.agamma=0;var S=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),P=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));if(y.epsilon*y.epsilon<=S*S+P*P){var T=S*S+P*P,A=1/Math.sqrt(T),E=A;S*=E,P*=E,this.nx=S,this.ny=P}var N=0;if(this.ws1.fluidEnabled){var L=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(this.ws2.type==me.id_ShapeType_CIRCLE)N-=L*this.ws2.circle.radius*y.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var V=this.ws2.polygon,j=0,D=0,F=V.edges.head;null!=F;){var R=F.elt;j+=R.length;var B=L*R.length*(R.gnormx*this.nx+R.gnormy*this.ny);B>0&&(B*=-y.fluidVacuumDrag,B=B),D-=.5*B*y.fluidLinearDrag,F=F.next}N+=D/j}}if(this.ws2.fluidEnabled){var G=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(this.ws1.type==me.id_ShapeType_CIRCLE)N-=G*this.ws1.circle.radius*y.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var Z=this.ws1.polygon,U=0,q=0,Y=Z.edges.head;null!=Y;){var K=Y.elt;U+=K.length;var W=G*K.length*(K.gnormx*this.nx+K.gnormy*this.ny);W>0&&(W*=-y.fluidVacuumDrag,W=W),q-=.5*W*y.fluidLinearDrag,Y=Y.next}N+=q/U}}if(0!=N){var J=this.b1.smass+this.b2.smass,X=0,H=0,Q=0;if(X=J,H=0,Q=J,0!=this.b1.sinertia){var $=this.r1x*this.b1.sinertia,nn=this.r1y*this.b1.sinertia;X+=nn*this.r1y,H+=-nn*this.r1x,Q+=$*this.r1x}if(0!=this.b2.sinertia){var en=this.r2x*this.b2.sinertia,tn=this.r2y*this.b2.sinertia;X+=tn*this.r2y,H+=-tn*this.r2x,Q+=en*this.r2x}var ln=X*Q-H*H;if(ln!=ln)Q=0,H=Q,X=H;else if(0==ln){var pn=0;0!=X?X=1/X:(X=0,pn|=1),0!=Q?Q=1/Q:(Q=0,pn|=2),H=0}else{ln=1/ln;var rn=Q*ln;Q=X*ln,X=rn,H*=-ln}this.vMassa=X,this.vMassb=H,this.vMassc=Q;var an=2*Math.PI*N;this.lgamma=1/(e*an*(2+an*e));var sn=1/(1+this.lgamma);e*an*an*this.lgamma,this.lgamma*=sn;var on=sn;this.vMassa*=on,this.vMassb*=on,this.vMassc*=on}else this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;var _n=i;this.dampx*=_n,this.dampy*=_n,this.adamp*=i},warmStart:function(){var n=this.b1.imass;this.b1.velx-=this.dampx*n,this.b1.vely-=this.dampy*n;var e=this.b2.imass;this.b2.velx+=this.dampx*e,this.b2.vely+=this.dampy*e,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},applyImpulseVel:function(){if(!this.nodrag){var n=this.b1.angvel+this.b1.kinangvel,e=this.b2.angvel+this.b2.kinangvel,i=this.b1.velx+this.b1.kinvelx-this.r1y*n-(this.b2.velx+this.b2.kinvelx-this.r2y*e),t=this.b1.vely+this.b1.kinvely+this.r1x*n-(this.b2.vely+this.b2.kinvely+this.r2x*e),l=this.vMassa*i+this.vMassb*t;t=this.vMassb*i+this.vMassc*t,i=l;var p=this.lgamma;i-=this.dampx*p,t-=this.dampy*p;this.dampx+=1*i,this.dampy+=1*t;var r=this.b1.imass;this.b1.velx-=i*r,this.b1.vely-=t*r;var a=this.b2.imass;this.b2.velx+=i*a,this.b2.vely+=t*a,this.b1.angvel-=this.b1.iinertia*(t*this.r1x-i*this.r1y),this.b2.angvel+=this.b2.iinertia*(t*this.r2x-i*this.r2y);var s=(n-e)*this.wMass-this.adamp*this.agamma;this.adamp+=s,this.b1.angvel-=s*this.b1.iinertia,this.b2.angvel+=s*this.b2.iinertia}},__class__:De});var Fe=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,Ve.call(this),this.pre_dt=-1,this.contacts=new Re,this.innards=new Be,this.type=Ve.COL,this.colarb=this};l["zpp_nape.dynamics.ZPP_ColArbiter"]=Fe,Fe.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Fe.__super__=Ve,Fe.prototype=e(Ve.prototype,{outer_zn:null,dyn_fric:null,stat_fric:null,restitution:null,rfric:null,userdef_dyn_fric:null,userdef_stat_fric:null,userdef_restitution:null,userdef_rfric:null,s1:null,s2:null,contacts:null,wrap_contacts:null,innards:null,nx:null,ny:null,normal_validate:function(){this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},wrap_normal:null,getnormal:function(){var n;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_normal=n,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=i(this,this.normal_validate)},kMassa:null,kMassb:null,kMassc:null,Ka:null,Kb:null,Kc:null,rMass:null,jrAcc:null,rn1a:null,rt1a:null,rn1b:null,rt1b:null,rn2a:null,rt2a:null,rn2b:null,rt2b:null,k1x:null,k1y:null,k2x:null,k2y:null,surfacex:null,surfacey:null,ptype:null,lnormx:null,lnormy:null,lproj:null,radius:null,rev:null,biasCoef:null,__ref_edge1:null,__ref_edge2:null,__ref_vertex:null,c1:null,oc1:null,c2:null,oc2:null,hc2:null,hpc2:null,next:null,alloc:function(){},free:function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},stat:null,injectContact:function(n,e,i,t,l,p,r){null==r&&(r=!1);for(var a=null,s=this.contacts.next;null!=s;){var o=s;if(p==o.hash){a=o;break}s=s.next}if(null==a){null==Re.zpp_pool?a=new Re:(a=Re.zpp_pool,Re.zpp_pool=a.next,a.next=null);var _=a.inner;_.jnAcc=_.jtAcc=0,a.hash=p,a.fresh=!0,a.arbiter=this,this.jrAcc=0;var h=this.contacts;a._inuse=!0;var u=a;u.next=h.next,h.next=u,h.modified=!0,h.length++,this.innards.add(_)}else a.fresh=!1;return a.px=n,a.py=e,this.nx=i,this.ny=t,a.dist=l,a.stamp=this.stamp,a.posOnly=r,a},assign:function(n,e,i,t){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=i,this.di=t;var l,p=this.b1.arbiters;null==Vt.zpp_pool?l=new Vt:(l=Vt.zpp_pool,Vt.zpp_pool=l.next,l.next=null),l.elt=this;var r=l;r.next=p.head,p.head=r,p.modified=!0,p.length++;var a,s=this.b2.arbiters;null==Vt.zpp_pool?a=new Vt:(a=Vt.zpp_pool,Vt.zpp_pool=a.next,a.next=null),a.elt=this;var o=a;o.next=s.head,s.head=o,s.modified=!0,s.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=n,this.s2=e,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},calcProperties:function(){this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},validate_props:function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},retire:function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,i=n.head;null!=i;){if(i.elt==this){var t,l;null==e?(t=n.head,l=t.next,null==(n.head=l)&&(n.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(n.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,n.modified=!0,n.length--,n.pushmod=!0,!0;break}e=i,i=i.next}for(var r=this.b2.arbiters,a=null,s=r.head;null!=s;){if(s.elt==this){var o,_;null==a?(o=r.head,_=o.next,null==(r.head=_)&&(r.pushmod=!0)):(o=a.next,_=o.next,a.next=_,null==_&&(r.pushmod=!0));var h=o;h.elt=null,h.next=Vt.zpp_pool,Vt.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0,!0;break}a=s,s=s.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var u=this.contacts,x=u.next;u.pop();var d=x;d.arbiter=null,d.next=Re.zpp_pool,Re.zpp_pool=d;var v=this.innards,z=v.next;v.next=z.next,z._inuse=!1,null==v.next&&(v.pushmod=!0),v.modified=!0,v.length--}var c=this;c.userdef_dyn_fric=!1,c.userdef_stat_fric=!1,c.userdef_restitution=!1,c.userdef_rfric=!1,c.__ref_edge1=c.__ref_edge2=null,c.next=Fe.zpp_pool,Fe.zpp_pool=c,this.pre_dt=-1},mutable:null,makemutable:function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},makeimmutable:function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},contacts_adder:function(n){},contacts_subber:function(n){for(var e=null,i=null,t=this.innards.next,l=this.contacts.next;null!=l;){var p=l;if(p==n.zpp_inner){this.contacts.erase(e),this.innards.erase(i);var r=p;r.arbiter=null,r.next=Re.zpp_pool,Re.zpp_pool=r;break}e=l,i=t,t=t.next,l=l.next}},setupcontacts:function(){this.wrap_contacts=gl.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=i(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=i(this,this.contacts_subber)},cleanupContacts:function(){var n=!0,e=null,i=null,t=this.innards.next;this.hc2=!1;for(var l=this.contacts.next;null!=l;){var p=l;if(p.stamp+y.arbiterExpirationDelay<this.stamp){var r,a,s=this.contacts;null==e?(r=s.next,a=r.next,null==(s.next=a)&&(s.pushmod=!0)):(r=e.next,a=r.next,e.next=a,null==a&&(s.pushmod=!0)),r._inuse=!1,s.modified=!0,s.length--,s.pushmod=!0,l=a;var o,_,h=this.innards;null==i?(o=h.next,_=o.next,null==(h.next=_)&&(h.pushmod=!0)):(o=i.next,_=o.next,i.next=_,null==_&&(h.pushmod=!0)),o._inuse=!1,h.modified=!0,h.length--,h.pushmod=!0,t=_;var u=p;u.arbiter=null,u.next=Re.zpp_pool,Re.zpp_pool=u}else{var x=p.inner,d=p.active;p.active=p.stamp==this.stamp,p.active&&(n?(n=!1,this.c1=x,this.oc1=p):(this.hc2=!0,this.c2=x,this.oc2=p)),d!=p.active&&(this.contacts.modified=!0),e=l,i=t,t=t.next,l=l.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var v=this.c1;this.c1=this.c2,this.c2=v;var z=this.oc1;this.oc1=this.oc2,this.oc2=z,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(n=!0)}else this.hpc2=!1;return n},pre_dt:null,preStep:function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=this.s1.material.elasticity>-Infinity&&this.s2.material.elasticity>-Infinity?this.s1.material.elasticity<Infinity&&this.s2.material.elasticity<Infinity?(this.s1.material.elasticity+this.s2.material.elasticity)/2:1:0,0>this.restitution&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n;var i=this.b1.smass+this.b2.smass;this.hc2=!1;var t=!0;this.biasCoef=this.b1.type!=me.id_BodyType_DYNAMIC||this.b2.type!=me.id_BodyType_DYNAMIC?this.continuous?y.contactContinuousStaticBiasCoef:y.contactStaticBiasCoef:this.continuous?y.contactContinuousBiasCoef:y.contactBiasCoef,this.continuous=!1;for(var l=null,p=null,r=this.innards.next,a=this.contacts.next;null!=a;){var s=a;if(s.stamp+y.arbiterExpirationDelay<this.stamp){var o,_,h=this.contacts;null==l?(o=h.next,_=o.next,null==(h.next=_)&&(h.pushmod=!0)):(o=l.next,_=o.next,l.next=_,null==_&&(h.pushmod=!0)),o._inuse=!1,h.modified=!0,h.length--,h.pushmod=!0,a=_;var u,x,d=this.innards;null==p?(u=d.next,x=u.next,null==(d.next=x)&&(d.pushmod=!0)):(u=p.next,x=u.next,p.next=x,null==x&&(d.pushmod=!0)),u._inuse=!1,d.modified=!0,d.length--,d.pushmod=!0,r=x;var v=s;v.arbiter=null,v.next=Re.zpp_pool,Re.zpp_pool=v}else{var z=s.inner,c=s.active;if(s.active=s.stamp==this.stamp){t?(t=!1,this.c1=z,this.oc1=s):(this.hc2=!0,this.c2=z,this.oc2=s),z.r2x=s.px-this.b2.posx,z.r2y=s.py-this.b2.posy,z.r1x=s.px-this.b1.posx,z.r1y=s.py-this.b1.posy;var m=z.r2x*this.nx+z.r2y*this.ny,f=i+this.b2.sinertia*(m*m),b=z.r1x*this.nx+z.r1y*this.ny;f+=this.b1.sinertia*(b*b),z.tMass=y.epsilon*y.epsilon>f?0:1/f;var g=this.ny*z.r2x-this.nx*z.r2y,w=i+this.b2.sinertia*(g*g),M=this.ny*z.r1x-this.nx*z.r1y;w+=this.b1.sinertia*(M*M),z.nMass=y.epsilon*y.epsilon>w?0:1/w;var C=0,k=0,O=this.b2.angvel+this.b2.kinangvel;C=this.b2.velx+this.b2.kinvelx-z.r2y*O,k=this.b2.vely+this.b2.kinvely+z.r2x*O,O=this.b1.angvel+this.b1.kinangvel,C-=this.b1.velx+this.b1.kinvelx-z.r1y*O,k-=this.b1.vely+this.b1.kinvely+z.r1x*O;var I=this.nx*C+this.ny*k;s.elasticity=this.restitution,z.bounce=I*s.elasticity,z.bounce>-y.elasticThreshold&&(z.bounce=0),I=k*this.nx-C*this.ny;var S=y.staticFrictionThreshold;z.friction=I*I>S*S?this.dyn_fric:this.stat_fric,z.jnAcc*=e,z.jtAcc*=e}c!=s.active&&(this.contacts.modified=!0),l=a,p=r,r=r.next,a=a.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var P=this.c1;this.c1=this.c2,this.c2=P;var T=this.oc1;this.oc1=this.oc2,this.oc2=T,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(t=!0)}else this.hpc2=!1;if(this.jrAcc*=e,t||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2){this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=i+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=i+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=i+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b;if(y.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)>this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc){this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc;var A=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(A!=A)this.kMassa=this.kMassb=this.kMassc=0;else if(0==A){var E=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,E|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,E|=2),this.kMassb=0}else{A=1/A;var N=this.kMassc*A;this.kMassc=this.kMassa*A,this.kMassa=N,this.kMassb*=-A}}else{if(this.hc2=!1,this.oc1.dist>this.oc2.dist){var L=this.c1;this.c1=this.c2,this.c2=L}this.oc2.active=!1,this.contacts.modified=!0}}this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely;return this.surfacex+=1*this.b1.svelx,this.surfacey+=1*this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),t},warmStart:function(){var n=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,e=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,i=this.b1.imass;this.b1.velx-=n*i,this.b1.vely-=e*i,this.b1.angvel-=this.b1.iinertia*(e*this.c1.r1x-n*this.c1.r1y);var t=this.b2.imass;if(this.b2.velx+=n*t,this.b2.vely+=e*t,this.b2.angvel+=this.b2.iinertia*(e*this.c1.r2x-n*this.c1.r2y),this.hc2){var l=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,p=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,r=this.b1.imass;this.b1.velx-=l*r,this.b1.vely-=p*r,this.b1.angvel-=this.b1.iinertia*(p*this.c2.r1x-l*this.c2.r1y);var a=this.b2.imass;this.b2.velx+=l*a,this.b2.vely+=p*a,this.b2.angvel+=this.b2.iinertia*(p*this.c2.r2x-l*this.c2.r2y)}this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},applyImpulseVel:function(){var n,e,i,t,l,p,r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),a=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);if(i=(a*this.nx-r*this.ny+this.surfacex)*this.c1.tMass,t=this.c1.friction*this.c1.jnAcc,l=this.c1.jtAcc,p=l-i,p>t?p=t:-t>p&&(p=-t),i=p-l,this.c1.jtAcc=p,n=-this.ny*i,e=this.nx*i,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt1b*i*this.b2.iinertia,this.b1.angvel-=this.rt1a*i*this.b1.iinertia,this.hc2){var s=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),o=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);i=(o*this.nx-s*this.ny+this.surfacex)*this.c2.tMass,t=this.c2.friction*this.c2.jnAcc,l=this.c2.jtAcc,p=l-i,p>t?p=t:-t>p&&(p=-t),i=p-l,this.c2.jtAcc=p,n=-this.ny*i,e=this.nx*i,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt2b*i*this.b2.iinertia,this.b1.angvel-=this.rt2a*i*this.b1.iinertia,r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),a=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),s=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),o=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);var _=this.c1.jnAcc,h=this.c2.jnAcc,u=r*this.nx+a*this.ny+this.surfacey+this.c1.bounce-(this.Ka*_+this.Kb*h),x=s*this.nx+o*this.ny+this.surfacey+this.c2.bounce-(this.Kb*_+this.Kc*h),d=-(this.kMassa*u+this.kMassb*x),v=-(this.kMassb*u+this.kMassc*x);0>d||0>v?(d=-this.c1.nMass*u,0>d||0>this.Kb*d+x?(v=-this.c2.nMass*x,0>v||0>this.Kb*v+u?0>u||0>x?(u=0,x=0):(u=-_,x=-h,this.c1.jnAcc=this.c2.jnAcc=0):(u=-_,x=v-h,this.c1.jnAcc=0,this.c2.jnAcc=v)):(u=d-_,x=-h,this.c1.jnAcc=d,this.c2.jnAcc=0)):(u=d-_,x=v-h,this.c1.jnAcc=d,this.c2.jnAcc=v),i=u+x,n=this.nx*i,e=this.ny*i,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=(this.rn1b*u+this.rn2b*x)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*u+this.rn2a*x)*this.b1.iinertia}else{if(0!=this.radius){i=(this.b2.angvel-this.b1.angvel)*this.rMass,t=this.rfric*this.c1.jnAcc,l=this.jrAcc,this.jrAcc-=i,this.jrAcc>t?this.jrAcc=t:-t>this.jrAcc&&(this.jrAcc=-t),i=this.jrAcc-l,this.b2.angvel+=i*this.b2.iinertia,this.b1.angvel-=i*this.b1.iinertia}r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),a=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),i=(this.c1.bounce+(this.nx*r+this.ny*a)+this.surfacey)*this.c1.nMass,l=this.c1.jnAcc,p=l-i,0>p&&(p=0),i=p-l,this.c1.jnAcc=p,n=this.nx*i,e=this.ny*i,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rn1b*i*this.b2.iinertia,this.b1.angvel-=this.rn1a*i*this.b1.iinertia}},applyImpulsePos:function(){if(2==this.ptype){var n=this.c1,e=0,i=0;e=this.b2.axisy*n.lr2x-this.b2.axisx*n.lr2y,i=n.lr2x*this.b2.axisx+n.lr2y*this.b2.axisy;e+=1*this.b2.posx,i+=1*this.b2.posy;var t=0,l=0;t=this.b1.axisy*n.lr1x-this.b1.axisx*n.lr1y,l=n.lr1x*this.b1.axisx+n.lr1y*this.b1.axisy;t+=1*this.b1.posx,l+=1*this.b1.posy;var p=0,r=0;p=e-t,r=i-l;var a=Math.sqrt(p*p+r*r),s=this.radius-y.collisionSlop,o=a-s;if(0>p*this.nx+r*this.ny&&(p=-p,r=-r,o-=this.radius),0>o)if(y.epsilon>a)0!=this.b1.smass?this.b1.posx+=10*y.epsilon:this.b2.posx+=10*y.epsilon;else{var _=1/a;p*=_,r*=_;var h=.5*(t+e),u=.5*(l+i),x=a-s;t=h-this.b1.posx,l=u-this.b1.posy,e=h-this.b2.posx,i=u-this.b2.posy;var d=r*t-p*l,v=r*e-p*i,z=this.b2.smass+v*v*this.b2.sinertia+this.b1.smass+d*d*this.b1.sinertia;if(0!=z){var c=-this.biasCoef*x/z,m=0,f=0,b=c;m=p*b,f=r*b;var g=this.b1.imass;this.b1.posx-=m*g,this.b1.posy-=f*g;var w=this.b1,M=-d*this.b1.iinertia*c;if(w.rot+=M,M*M>1e-4)w.axisx=Math.sin(w.rot),w.axisy=Math.cos(w.rot);else{var C=M*M,k=1-.5*C,O=1-C*C/8,I=(k*w.axisx+M*w.axisy)*O;w.axisy=(k*w.axisy-M*w.axisx)*O,w.axisx=I}var S=this.b2.imass;this.b2.posx+=m*S,this.b2.posy+=f*S;var P=this.b2,T=v*this.b2.iinertia*c;if(P.rot+=T,T*T>1e-4)P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot);else{var A=T*T,E=1-.5*A,N=1-A*A/8,L=(E*P.axisx+T*P.axisy)*N;P.axisy=(E*P.axisy-T*P.axisx)*N,P.axisx=L}}}}else{var V,j=0,D=0,F=0,R=0,B=0,G=0;if(0==this.ptype){j=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,D=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,V=this.lproj+(j*this.b1.posx+D*this.b1.posy),F=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,R=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy;if(F+=1*this.b2.posx,R+=1*this.b2.posy,this.hpc2){B=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,G=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy;B+=1*this.b2.posx,G+=1*this.b2.posy}}else{j=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,D=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,V=this.lproj+(j*this.b2.posx+D*this.b2.posy),F=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,R=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy;if(F+=1*this.b1.posx,R+=1*this.b1.posy,this.hpc2){B=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,G=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy;B+=1*this.b1.posx,G+=1*this.b1.posy}}var Z=F*j+R*D-V-this.radius;Z+=y.collisionSlop;var U=0;if(this.hpc2&&(U=B*j+G*D-V-this.radius,U+=y.collisionSlop),0>Z||0>U){this.rev&&(j=-j,D=-D);var q=0,Y=0;q=F-this.b1.posx,Y=R-this.b1.posy;var K=0,W=0;K=F-this.b2.posx,W=R-this.b2.posy;var J=0,X=0,H=0,Q=0;if(this.hpc2){J=B-this.b1.posx,X=G-this.b1.posy,H=B-this.b2.posx,Q=G-this.b2.posy;var $=D*q-j*Y,nn=D*K-j*W,en=D*J-j*X,tn=D*H-j*Q,ln=this.b1.smass+this.b2.smass;this.kMassa=ln+this.b1.sinertia*$*$+this.b2.sinertia*nn*nn,this.kMassb=ln+this.b1.sinertia*$*en+this.b2.sinertia*nn*tn,this.kMassc=ln+this.b1.sinertia*en*en+this.b2.sinertia*tn*tn;var pn=0,rn=0,an=0;pn=this.kMassa,rn=this.kMassb,an=this.kMassc;for(var sn=Z*this.biasCoef,on=U*this.biasCoef;;){var _n=0,hn=0;_n=sn,hn=on,_n=-_n,hn=-hn;var un=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(un!=un)hn=0,_n=hn;else if(0==un)0!=this.kMassa?_n/=this.kMassa:_n=0,0!=this.kMassc?hn/=this.kMassc:hn=0;else{un=1/un;var xn=un*(this.kMassc*_n-this.kMassb*hn);hn=un*(this.kMassa*hn-this.kMassb*_n),_n=xn}if(_n>=0&&hn>=0){var dn=(_n+hn)*this.b1.imass;this.b1.posx-=j*dn,this.b1.posy-=D*dn;var vn=this.b1,zn=-this.b1.iinertia*($*_n+en*hn);if(vn.rot+=zn,zn*zn>1e-4)vn.axisx=Math.sin(vn.rot),vn.axisy=Math.cos(vn.rot);else{var cn=zn*zn,mn=1-.5*cn,yn=1-cn*cn/8,fn=(mn*vn.axisx+zn*vn.axisy)*yn;vn.axisy=(mn*vn.axisy-zn*vn.axisx)*yn,vn.axisx=fn}var bn=(_n+hn)*this.b2.imass;this.b2.posx+=j*bn,this.b2.posy+=D*bn;var gn=this.b2,wn=this.b2.iinertia*(nn*_n+tn*hn);if(gn.rot+=wn,wn*wn>1e-4)gn.axisx=Math.sin(gn.rot),gn.axisy=Math.cos(gn.rot);else{var Mn=wn*wn,Cn=1-.5*Mn,kn=1-Mn*Mn/8,On=(Cn*gn.axisx+wn*gn.axisy)*kn;gn.axisy=(Cn*gn.axisy-wn*gn.axisx)*kn,gn.axisx=On}break}_n=-sn/pn,hn=0;var In=rn*_n+on;if(_n>=0&&In>=0){var Sn=(_n+hn)*this.b1.imass;this.b1.posx-=j*Sn,this.b1.posy-=D*Sn;var Pn=this.b1,Tn=-this.b1.iinertia*($*_n+en*hn);if(Pn.rot+=Tn,Tn*Tn>1e-4)Pn.axisx=Math.sin(Pn.rot),Pn.axisy=Math.cos(Pn.rot);else{var An=Tn*Tn,En=1-.5*An,Nn=1-An*An/8,Ln=(En*Pn.axisx+Tn*Pn.axisy)*Nn;Pn.axisy=(En*Pn.axisy-Tn*Pn.axisx)*Nn,Pn.axisx=Ln}var Vn=(_n+hn)*this.b2.imass;this.b2.posx+=j*Vn,this.b2.posy+=D*Vn;var jn=this.b2,Dn=this.b2.iinertia*(nn*_n+tn*hn);if(jn.rot+=Dn,Dn*Dn>1e-4)jn.axisx=Math.sin(jn.rot),jn.axisy=Math.cos(jn.rot);else{var Fn=Dn*Dn,Rn=1-.5*Fn,Bn=1-Fn*Fn/8,Gn=(Rn*jn.axisx+Dn*jn.axisy)*Bn;jn.axisy=(Rn*jn.axisy-Dn*jn.axisx)*Bn,jn.axisx=Gn}break}_n=0,hn=-on/an;var Zn=rn*hn+sn;if(hn>=0&&Zn>=0){var Un=(_n+hn)*this.b1.imass;this.b1.posx-=j*Un,this.b1.posy-=D*Un;var qn=this.b1,Yn=-this.b1.iinertia*($*_n+en*hn);if(qn.rot+=Yn,Yn*Yn>1e-4)qn.axisx=Math.sin(qn.rot),qn.axisy=Math.cos(qn.rot);else{var Kn=Yn*Yn,Wn=1-.5*Kn,Jn=1-Kn*Kn/8,Xn=(Wn*qn.axisx+Yn*qn.axisy)*Jn;qn.axisy=(Wn*qn.axisy-Yn*qn.axisx)*Jn,qn.axisx=Xn}var Hn=(_n+hn)*this.b2.imass;this.b2.posx+=j*Hn,this.b2.posy+=D*Hn;var Qn=this.b2,$n=this.b2.iinertia*(nn*_n+tn*hn);if(Qn.rot+=$n,$n*$n>1e-4)Qn.axisx=Math.sin(Qn.rot),Qn.axisy=Math.cos(Qn.rot);else{var ne=$n*$n,ee=1-.5*ne,ie=1-ne*ne/8,te=(ee*Qn.axisx+$n*Qn.axisy)*ie;Qn.axisy=(ee*Qn.axisy-$n*Qn.axisx)*ie,Qn.axisx=te}break}break}}else{var le=D*q-j*Y,pe=D*K-j*W,re=this.b2.smass+pe*pe*this.b2.sinertia+this.b1.smass+le*le*this.b1.sinertia;if(0!=re){var ae=-this.biasCoef*Z/re,se=0,oe=0,_e=ae;se=j*_e,oe=D*_e;var he=this.b1.imass;this.b1.posx-=se*he,this.b1.posy-=oe*he;var ue=this.b1,xe=-le*this.b1.iinertia*ae;if(ue.rot+=xe,xe*xe>1e-4)ue.axisx=Math.sin(ue.rot),ue.axisy=Math.cos(ue.rot);else{var de=xe*xe,ve=1-.5*de,ze=1-de*de/8,ce=(ve*ue.axisx+xe*ue.axisy)*ze;ue.axisy=(ve*ue.axisy-xe*ue.axisx)*ze,ue.axisx=ce}var me=this.b2.imass;this.b2.posx+=se*me,this.b2.posy+=oe*me;var ye=this.b2,fe=pe*this.b2.iinertia*ae;if(ye.rot+=fe,fe*fe>1e-4)ye.axisx=Math.sin(ye.rot),ye.axisy=Math.cos(ye.rot);else{var be=fe*fe,ge=1-.5*be,we=1-be*be/8,Me=(ge*ye.axisx+fe*ye.axisy)*we;ye.axisy=(ge*ye.axisy-fe*ye.axisx)*we,ye.axisx=Me}}}}}},__class__:Fe});var Re=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new Be};l["zpp_nape.dynamics.ZPP_Contact"]=Re,Re.__name__=["zpp_nape","dynamics","ZPP_Contact"],Re.prototype={outer:null,wrapper:function(){return null==this.outer&&(Re.internal=!0,this.outer=new tn,Re.internal=!1,this.outer.zpp_inner=this),this.outer},px:null,py:null,position_validate:function(){this.inactiveme(),this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},wrap_position:null,getposition:function(){var n;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=i(this,this.position_validate)},inactiveme:function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},arbiter:null,inner:null,active:null,posOnly:null,stamp:null,hash:null,fresh:null,dist:null,elasticity:null,free:function(){this.arbiter=null},alloc:function(){},next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},__class__:Re};var Be=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};l["zpp_nape.dynamics.ZPP_IContact"]=Be,Be.__name__=["zpp_nape","dynamics","ZPP_IContact"],Be.prototype={r1x:null,r1y:null,r2x:null,r2y:null,nMass:null,tMass:null,bounce:null,friction:null,jnAcc:null,jtAcc:null,lr1x:null,lr1y:null,lr2x:null,lr2y:null,next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},__class__:Be};var Ge=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new nt,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};l["zpp_nape.dynamics.ZPP_InteractionFilter"]=Ge,Ge.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],Ge.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new an;var n=this.outer.zpp_inner;n.outer=null,n.next=Ge.zpp_pool,Ge.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new nt},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},copy:function(){var n;return null==Ge.zpp_pool?n=new Ge:(n=Ge.zpp_pool,Ge.zpp_pool=n.next,n.next=null),n.collisionGroup=this.collisionGroup,n.collisionMask=this.collisionMask,n.sensorGroup=this.sensorGroup,n.sensorMask=this.sensorMask,n.fluidGroup=this.fluidGroup,n.fluidMask=this.fluidMask,n},collisionGroup:null,collisionMask:null,shouldCollide:function(n){return 0!=(this.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&this.collisionGroup)},sensorGroup:null,sensorMask:null,shouldSense:function(n){return 0!=(this.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&this.sensorGroup)},fluidGroup:null,fluidMask:null,shouldFlow:function(n){return 0!=(this.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&this.fluidGroup)},invalidate:function(){for(var n=this.shapes.head;null!=n;){n.elt.invalidate_filter(),n=n.next}},__class__:Ge};var Ze=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new ct,this.interactors=new ve};l["zpp_nape.dynamics.ZPP_InteractionGroup"]=Ze,Ze.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],Ze.prototype={outer:null,ignore:null,group:null,setGroup:function(n){this.group!=n&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),this.group=n,null!=n?(n.groups.add(this),this.depth=n.depth+1,n.invalidate(!0)):this.invalidate(!0))},groups:null,wrap_groups:null,interactors:null,wrap_interactors:null,depth:null,invalidate:function(n){if(null==n&&(n=!1),n||this.ignore){for(var e=this.interactors.head;null!=e;){var i=e.elt;null!=i.ibody?i.ibody.wake():null!=i.ishape?i.ishape.body.wake():i.icompound.wake(),e=e.next}for(var t=this.groups.head;null!=t;){t.elt.invalidate(n),t=t.next}}},addGroup:function(n){this.groups.add(n),n.depth=this.depth+1},remGroup:function(n){this.groups.remove(n),n.depth=0},addInteractor:function(n){this.interactors.add(n)},remInteractor:function(n,e){null==e&&(e=-1),this.interactors.remove(n)},__class__:Ze};var Ue=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,$.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var n=0;4>n;){n++;this.lengths.push(0)}};l["zpp_nape.dynamics.ZPP_SpaceArbiterList"]=Ue,Ue.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],Ue.__super__=$,Ue.prototype=e($.prototype,{space:null,_length:null,zip_length:null,zpp_gl:function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=0,e=0,i=this.space.c_arbiters_true.head;null!=i;){i.elt.active&&++e,i=i.next}this.lengths[n++]=e,this._length+=e;for(var t=0,l=this.space.c_arbiters_false.head;null!=l;){l.elt.active&&++t,l=l.next}this.lengths[n++]=t,this._length+=t;for(var p=0,r=this.space.f_arbiters.head;null!=r;){r.elt.active&&++p,r=r.next}this.lengths[n++]=p,this._length+=p;for(var a=0,s=this.space.s_arbiters.head;null!=s;){s.elt.active&&++a,s=s.next}this.lengths[n++]=a,this._length+=a,this.zip_length=!1}return this._length},lengths:null,ite_0:null,ite_1:null,ite_2:null,ite_3:null,at_index_0:null,at_index_1:null,at_index_2:null,at_index_3:null,zpp_vm:function(){var n=!1;this.space.c_arbiters_true.modified&&(n=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(n=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(n=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(n=!0,this.space.s_arbiters.modified=!1),n&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},push:function(n){},pop:function(){},unshift:function(n){},shift:function(){},remove:function(n){},clear:function(){},at:function(n){this.zpp_vm(),0>n||this.zpp_gl();var e=null,i=0;if(null==e)if(i+this.lengths[0]>n){var t=n-i;if(this.at_index_0>t||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;;){var l=this.ite_0.elt;if(l.active)break;this.ite_0=this.ite_0.next}for(;this.at_index_0!=t;)for(this.at_index_0++,this.ite_0=this.ite_0.next;;){var p=this.ite_0.elt;if(p.active)break;this.ite_0=this.ite_0.next}e=this.ite_0.elt.wrapper()}else i+=this.lengths[0];if(null==e)if(i+this.lengths[1]>n){var r=n-i;if(this.at_index_1>r||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;;){var a=this.ite_1.elt;if(a.active)break;this.ite_1=this.ite_1.next}for(;this.at_index_1!=r;)for(this.at_index_1++,this.ite_1=this.ite_1.next;;){var s=this.ite_1.elt;if(s.active)break;this.ite_1=this.ite_1.next}e=this.ite_1.elt.wrapper()}else i+=this.lengths[1];if(null==e)if(i+this.lengths[2]>n){var o=n-i;if(this.at_index_2>o||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;;){var _=this.ite_2.elt;if(_.active)break;this.ite_2=this.ite_2.next}for(;this.at_index_2!=o;)for(this.at_index_2++,this.ite_2=this.ite_2.next;;){var h=this.ite_2.elt;if(h.active)break;this.ite_2=this.ite_2.next}e=this.ite_2.elt.wrapper()}else i+=this.lengths[2];if(null==e)if(i+this.lengths[3]>n){var u=n-i;if(this.at_index_3>u||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;;){var x=this.ite_3.elt;if(x.active)break;this.ite_3=this.ite_3.next}for(;this.at_index_3!=u;)for(this.at_index_3++,this.ite_3=this.ite_3.next;;){var d=this.ite_3.elt;if(d.active)break;this.ite_3=this.ite_3.next}e=this.ite_3.elt.wrapper()}else i+=this.lengths[3];return e},__class__:Ue});var qe=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};l["zpp_nape.geom.ZPP_AABB"]=qe,qe.__name__=["zpp_nape","geom","ZPP_AABB"],qe.get=function(n,e,i,t){var l;return null==qe.zpp_pool?l=new qe:(l=qe.zpp_pool,qe.zpp_pool=l.next,l.next=null),l.minx=n,l.miny=e,l.maxx=i,l.maxy=t,l},qe.prototype={_invalidate:null,_validate:null,_immutable:null,validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},outer:null,wrapper:function(){if(null==this.outer){this.outer=new hn;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=qe.zpp_pool,qe.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},next:null,alloc:function(){},free:function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},copy:function(){var n,e=this.minx,i=this.miny,t=this.maxx,l=this.maxy;return null==qe.zpp_pool?n=new qe:(n=qe.zpp_pool,qe.zpp_pool=n.next,n.next=null),n.minx=e,n.miny=i,n.maxx=t,n.maxy=l,n},width:function(){return this.maxx-this.minx},height:function(){return this.maxy-this.miny},perimeter:function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},minx:null,miny:null,wrap_min:null,getmin:function(){if(null==this.wrap_min){var n,e=this.minx,t=this.miny;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_min=n,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=i(this,this.mod_min),this.wrap_min.zpp_inner._validate=i(this,this.dom_min)}return this.wrap_min},dom_min:function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},mod_min:function(n){n.x==this.minx&&n.y==this.miny||(this.minx=n.x,this.miny=n.y,null!=this._invalidate&&this._invalidate(this))},maxx:null,maxy:null,wrap_max:null,getmax:function(){if(null==this.wrap_max){var n,e=this.maxx,t=this.maxy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_max=n,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=i(this,this.mod_max),this.wrap_max.zpp_inner._validate=i(this,this.dom_max)}return this.wrap_max},dom_max:function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},mod_max:function(n){n.x==this.maxx&&n.y==this.maxy||(this.maxx=n.x,this.maxy=n.y,null!=this._invalidate&&this._invalidate(this))},intersectX:function(n){return!(n.minx>this.maxx||this.minx>n.maxx)},intersectY:function(n){return!(n.miny>this.maxy||this.miny>n.maxy)},intersect:function(n){return!(n.miny>this.maxy||this.miny>n.maxy||n.minx>this.maxx)&&n.maxx>=this.minx},combine:function(n){this.minx>n.minx&&(this.minx=n.minx),n.maxx>this.maxx&&(this.maxx=n.maxx),this.miny>n.miny&&(this.miny=n.miny),n.maxy>this.maxy&&(this.maxy=n.maxy)},contains:function(n){return!(this.minx>n.minx||this.miny>n.miny||n.maxx>this.maxx)&&this.maxy>=n.maxy},containsPoint:function(n){return!(this.minx>n.x||n.x>this.maxx||this.miny>n.y)&&this.maxy>=n.y},setCombine:function(n,e){this.minx=e.minx>n.minx?n.minx:e.minx,this.miny=e.miny>n.miny?n.miny:e.miny,this.maxx=n.maxx>e.maxx?n.maxx:e.maxx,this.maxy=n.maxy>e.maxy?n.maxy:e.maxy},setExpand:function(n,e){this.minx=n.minx-e,this.miny=n.miny-e,this.maxx=n.maxx+e,this.maxy=n.maxy+e},setExpandPoint:function(n,e){this.minx>n&&(this.minx=n),n>this.maxx&&(this.maxx=n),this.miny>e&&(this.miny=e),e>this.maxy&&(this.maxy=e)},toString:function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:qe};var Ye=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Vec2"]=Ye,Ye.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],Ye.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Jt.zpp_pool?e=new Jt:(e=Jt.zpp_pool,Jt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Jt.zpp_pool?e=new Jt:(e=Jt.zpp_pool,Jt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Jt.zpp_pool?i=new Jt:(i=Jt.zpp_pool,Jt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Jt.zpp_pool?i=new Jt:(i=Jt.zpp_pool,Jt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Jt.zpp_pool,Jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Jt.zpp_pool,Jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Jt.zpp_pool,Jt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Jt.zpp_pool,Jt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Jt.zpp_pool,Jt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Jt.zpp_pool,Jt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Jt.zpp_pool,Jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Jt.zpp_pool,Jt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:Ye};var Ke=function(){};l["zpp_nape.geom.ZPP_Collide"]=Ke,Ke.__name__=["zpp_nape","geom","ZPP_Collide"],Ke.circleContains=function(n,e){var i=0,t=0;return i=e.x-n.worldCOMx,t=e.y-n.worldCOMy,n.radius*n.radius>i*i+t*t},Ke.polyContains=function(n,e){var i;i=!0;for(var t=n.edges.head;null!=t;){var l=t.elt;if(l.gnormx*e.x+l.gnormy*e.y>l.gprojection){i=!1;break}t=t.next}return i},Ke.shapeContains=function(n,e){return n.type==me.id_ShapeType_CIRCLE?Ke.circleContains(n.circle,e):Ke.polyContains(n.polygon,e)},Ke.bodyContains=function(n,e){var i;i=!1;for(var t=n.shapes.head;null!=t;){if(Ke.shapeContains(t.elt,e)){i=!0;break}t=t.next}return i},Ke.containTest=function(n,e){var i=n.aabb,t=e.aabb;if(i.minx>t.minx||i.miny>t.miny||t.maxx>i.maxx||t.maxy>i.maxy)return!1;if(n.type==me.id_ShapeType_CIRCLE){if(e.type==me.id_ShapeType_CIRCLE){var l=n.circle.radius+-e.circle.radius,p=0,r=0;p=e.circle.worldCOMx-n.circle.worldCOMx,r=e.circle.worldCOMy-n.circle.worldCOMy;return l*l>=p*p+r*r}var a;a=!0;for(var s=e.polygon.gverts.next;null!=s;){var o=s,_=n.circle.radius,h=0,u=0;h=o.x-n.circle.worldCOMx,u=o.y-n.circle.worldCOMy;if(h*h+u*u>_*_){a=!1;break}s=s.next}return a}if(e.type==me.id_ShapeType_CIRCLE){var x;x=!0;for(var d=n.polygon.edges.head;null!=d;){var v=d.elt;if(v.gnormx*e.circle.worldCOMx+v.gnormy*e.circle.worldCOMy+e.circle.radius>v.gprojection){x=!1;break}d=d.next}return x}var z;z=!0;for(var c=n.polygon.edges.head;null!=c;){for(var m=c.elt,y=-1e100,f=e.polygon.gverts.next;null!=f;){var b=f,g=m.gnormx*b.x+m.gnormy*b.y;g>y&&(y=g),f=f.next}if(y>m.gprojection){z=!1;break}c=c.next}return z},Ke.contactCollide=function(n,e,i,t){if(e.type==me.id_ShapeType_POLYGON){if(n.type==me.id_ShapeType_POLYGON){for(var l=!0,p=-1e100,r=-1,a=null,s=null,o=n.polygon.edges.head;null!=o;){for(var _=o.elt,h=1e100,u=e.polygon.gverts.next;null!=u;){var x=u,d=_.gnormx*x.x+_.gnormy*x.y;if(h>d&&(h=d),p>=h-_.gprojection)break;u=u.next}if((h-=_.gprojection)>=0){l=!1;break}h>p&&(p=h,a=_,r=1),o=o.next}if(l){for(var v=e.polygon.edges.head;null!=v;){for(var z=v.elt,c=1e100,m=n.polygon.gverts.next;null!=m;){var f=m,b=z.gnormx*f.x+z.gnormy*f.y;if(c>b&&(c=b),p>=c-z.gprojection)break;m=m.next}if((c-=z.gprojection)>=0){l=!1;break}c>p&&(p=c,s=z,r=2),v=v.next}if(l){var g,w,M;1==r?(n.polygon,g=e.polygon,w=a,M=1):(e.polygon,g=n.polygon,w=s,M=-1);for(var C=null,k=1e100,O=g.edges.head;null!=O;){var I=O.elt,S=w.gnormx*I.gnormx+w.gnormy*I.gnormy;k>S&&(k=S,C=I),O=O.next}var P=0,T=0;P=C.gp0.x,T=C.gp0.y;var A=0,E=0;A=C.gp1.x,E=C.gp1.y;var N=0,L=0;N=A-P,L=E-T;var V=w.gnormy*P-w.gnormx*T,j=w.gnormy*A-w.gnormx*E,D=1/(j-V),F=(-w.tp1-V)*D;if(F>y.epsilon){var R=F;P+=N*R,T+=L*R}var B=(-w.tp0-j)*D;if(-y.epsilon>B){var G=B;A+=N*G,E+=L*G}var Z=0,U=0,q=M;Z=w.gnormx*q,U=w.gnormy*q,i.lnormx=w.lnormx,i.lnormy=w.lnormy,i.lproj=w.lprojection,i.radius=0,i.rev=t!=(-1==M),i.ptype=i.rev?1:0;var Y=P*w.gnormx+T*w.gnormy-w.gprojection,K=A*w.gnormx+E*w.gnormy-w.gprojection;if(Y>0&&K>0)return!1;t&&(Z=-Z,U=-U);for(var W=P-w.gnormx*Y*.5,J=T-w.gnormy*Y*.5,X=i.rev?1:0,H=null,Q=i.contacts.next;null!=Q;){var $=Q;if(X==$.hash){H=$;break}Q=Q.next}if(null==H){null==Re.zpp_pool?H=new Re:(H=Re.zpp_pool,Re.zpp_pool=H.next,H.next=null);var nn=H.inner;nn.jnAcc=nn.jtAcc=0,H.hash=X,H.fresh=!0,H.arbiter=i,i.jrAcc=0;var en=i.contacts;H._inuse=!0;var tn=H;tn.next=en.next,en.next=tn,en.modified=!0,en.length++,i.innards.add(nn)}else H.fresh=!1;H.px=W,H.py=J,i.nx=Z,i.ny=U,H.dist=Y,H.stamp=i.stamp,H.posOnly=Y>0;var ln=H;P-=1*g.body.posx,T-=1*g.body.posy,ln.inner.lr1x=P*g.body.axisy+T*g.body.axisx,ln.inner.lr1y=T*g.body.axisy-P*g.body.axisx;for(var pn=A-w.gnormx*K*.5,rn=E-w.gnormy*K*.5,an=i.rev?0:1,sn=null,on=i.contacts.next;null!=on;){var _n=on;if(an==_n.hash){sn=_n;break}on=on.next}if(null==sn){null==Re.zpp_pool?sn=new Re:(sn=Re.zpp_pool,Re.zpp_pool=sn.next,sn.next=null);var hn=sn.inner;hn.jnAcc=hn.jtAcc=0,sn.hash=an,sn.fresh=!0,sn.arbiter=i,i.jrAcc=0;var un=i.contacts;sn._inuse=!0;var xn=sn;xn.next=un.next,un.next=xn,un.modified=!0,un.length++,i.innards.add(hn)}else sn.fresh=!1;sn.px=pn,sn.py=rn,i.nx=Z,i.ny=U,sn.dist=K,sn.stamp=i.stamp,sn.posOnly=K>0,ln=sn;return A-=1*g.body.posx,E-=1*g.body.posy,ln.inner.lr1x=A*g.body.axisy+E*g.body.axisx,ln.inner.lr1y=E*g.body.axisy-A*g.body.axisx,1==r?(i.__ref_edge1=w,i.__ref_edge2=C):(i.__ref_edge2=w,i.__ref_edge1=C),!0}return!1}return!1}for(var dn=-1e100,vn=!0,zn=null,cn=null,mn=e.polygon.gverts.next,yn=e.polygon.edges.head;null!=yn;){var fn=yn.elt,bn=fn.gnormx*n.circle.worldCOMx+fn.gnormy*n.circle.worldCOMy-fn.gprojection-n.circle.radius;if(bn>0){vn=!1;break}bn>dn&&(dn=bn,zn=fn,cn=mn),mn=mn.next,yn=yn.next}if(vn){var gn=cn,wn=null==cn.next?e.polygon.gverts.next:cn.next,Mn=n.circle.worldCOMy*zn.gnormx-n.circle.worldCOMx*zn.gnormy;if(Mn>gn.y*zn.gnormx-gn.x*zn.gnormy){if(wn.y*zn.gnormx-wn.x*zn.gnormy>Mn){var Cn=0,kn=0,On=n.circle.radius+.5*dn;Cn=zn.gnormx*On,kn=zn.gnormy*On;var In=0,Sn=0;In=n.circle.worldCOMx-Cn,Sn=n.circle.worldCOMy-kn;var Pn;if(t){for(var Tn=zn.gnormx,An=zn.gnormy,En=null,Nn=i.contacts.next;null!=Nn;){var Ln=Nn;if(0==Ln.hash){En=Ln;break}Nn=Nn.next}if(null==En){null==Re.zpp_pool?En=new Re:(En=Re.zpp_pool,Re.zpp_pool=En.next,En.next=null);var Vn=En.inner;Vn.jnAcc=Vn.jtAcc=0,En.hash=0,En.fresh=!0,En.arbiter=i,i.jrAcc=0;var jn=i.contacts;En._inuse=!0;var Dn=En;Dn.next=jn.next,jn.next=Dn,jn.modified=!0,jn.length++,i.innards.add(Vn)}else En.fresh=!1;En.px=In,En.py=Sn,i.nx=Tn,i.ny=An,En.dist=dn,En.stamp=i.stamp,En.posOnly=!1,Pn=En}else{for(var Fn=-zn.gnormx,Rn=-zn.gnormy,Bn=null,Gn=i.contacts.next;null!=Gn;){var Zn=Gn;if(0==Zn.hash){Bn=Zn;break}Gn=Gn.next}if(null==Bn){null==Re.zpp_pool?Bn=new Re:(Bn=Re.zpp_pool,Re.zpp_pool=Bn.next,Bn.next=null);var Un=Bn.inner;Un.jnAcc=Un.jtAcc=0,Bn.hash=0,Bn.fresh=!0,Bn.arbiter=i,i.jrAcc=0;var qn=i.contacts;Bn._inuse=!0;var Yn=Bn;Yn.next=qn.next,qn.next=Yn,qn.modified=!0,qn.length++,i.innards.add(Un)}else Bn.fresh=!1;Bn.px=In,Bn.py=Sn,i.nx=Fn,i.ny=Rn,Bn.dist=dn,Bn.stamp=i.stamp,Bn.posOnly=!1,Pn=Bn}return i.ptype=t?0:1,i.lnormx=zn.lnormx,i.lnormy=zn.lnormy,i.rev=!t,i.lproj=zn.lprojection,i.radius=n.circle.radius,Pn.inner.lr1x=n.circle.localCOMx,Pn.inner.lr1y=n.circle.localCOMy,i.__ref_edge1=zn,i.__ref_vertex=0,!0}var Kn=n.circle.radius,Wn=0,Jn=0;Wn=wn.x-n.circle.worldCOMx,Jn=wn.y-n.circle.worldCOMy;var Xn,Hn=Wn*Wn+Jn*Jn;if(Hn>Kn*Kn)Xn=null;else if(y.epsilon*y.epsilon>Hn){for(var Qn=n.circle.worldCOMx,$n=n.circle.worldCOMy,ne=null,ee=i.contacts.next;null!=ee;){var ie=ee;if(0==ie.hash){ne=ie;break}ee=ee.next}if(null==ne){null==Re.zpp_pool?ne=new Re:(ne=Re.zpp_pool,Re.zpp_pool=ne.next,ne.next=null);var te=ne.inner;te.jnAcc=te.jtAcc=0,ne.hash=0,ne.fresh=!0,ne.arbiter=i,i.jrAcc=0;var le=i.contacts;ne._inuse=!0;var pe=ne;pe.next=le.next,le.next=pe,le.modified=!0,le.length++,i.innards.add(te)}else ne.fresh=!1;ne.px=Qn,ne.py=$n,i.nx=1,i.ny=0,ne.dist=-Kn,ne.stamp=i.stamp,ne.posOnly=!1,Xn=ne}else{var re=1/Math.sqrt(Hn),ae=y.epsilon>re?1e100:1/re,se=.5+(n.circle.radius-.5*Kn)*re;if(t){for(var oe=n.circle.worldCOMx+Wn*se,_e=n.circle.worldCOMy+Jn*se,he=null,ue=i.contacts.next;null!=ue;){var xe=ue;if(0==xe.hash){he=xe;break}ue=ue.next}if(null==he){null==Re.zpp_pool?he=new Re:(he=Re.zpp_pool,Re.zpp_pool=he.next,he.next=null);var de=he.inner;de.jnAcc=de.jtAcc=0,he.hash=0,he.fresh=!0,he.arbiter=i,i.jrAcc=0;var ve=i.contacts;he._inuse=!0;var ze=he;ze.next=ve.next,ve.next=ze,ve.modified=!0,ve.length++,i.innards.add(de)}else he.fresh=!1;he.px=oe,he.py=_e,i.nx=-Wn*re,i.ny=-Jn*re,he.dist=ae-Kn,he.stamp=i.stamp,he.posOnly=!1,Xn=he}else{for(var ce=n.circle.worldCOMx+Wn*se,ye=n.circle.worldCOMy+Jn*se,fe=null,be=i.contacts.next;null!=be;){var ge=be;if(0==ge.hash){fe=ge;break}be=be.next}if(null==fe){null==Re.zpp_pool?fe=new Re:(fe=Re.zpp_pool,Re.zpp_pool=fe.next,fe.next=null);var we=fe.inner;we.jnAcc=we.jtAcc=0,fe.hash=0,fe.fresh=!0,fe.arbiter=i,i.jrAcc=0;var Me=i.contacts;fe._inuse=!0;var Ce=fe;Ce.next=Me.next,Me.next=Ce,Me.modified=!0,Me.length++,i.innards.add(we)}else fe.fresh=!1;fe.px=ce,fe.py=ye,i.nx=Wn*re,i.ny=Jn*re,fe.dist=ae-Kn,fe.stamp=i.stamp,fe.posOnly=!1,Xn=fe}}if(null!=Xn){var ke=Xn.inner;i.ptype=2;var Oe=0,Ie=0;Oe=wn.x-e.polygon.body.posx,Ie=wn.y-e.polygon.body.posy,i.__ref_edge1=zn,i.__ref_vertex=1,t?(ke.lr1x=Oe*e.polygon.body.axisy+Ie*e.polygon.body.axisx,ke.lr1y=Ie*e.polygon.body.axisy-Oe*e.polygon.body.axisx,ke.lr2x=n.circle.localCOMx,ke.lr2y=n.circle.localCOMy):(ke.lr2x=Oe*e.polygon.body.axisy+Ie*e.polygon.body.axisx,ke.lr2y=Ie*e.polygon.body.axisy-Oe*e.polygon.body.axisx,ke.lr1x=n.circle.localCOMx,ke.lr1y=n.circle.localCOMy),i.radius=n.circle.radius}return null!=Xn}var Se=n.circle.radius,Pe=0,Te=0;Pe=gn.x-n.circle.worldCOMx,Te=gn.y-n.circle.worldCOMy;var Ae,Ee=Pe*Pe+Te*Te;if(Ee>Se*Se)Ae=null;else if(y.epsilon*y.epsilon>Ee){for(var Ne=n.circle.worldCOMx,Le=n.circle.worldCOMy,Ve=null,je=i.contacts.next;null!=je;){var De=je;if(0==De.hash){Ve=De;break}je=je.next}if(null==Ve){null==Re.zpp_pool?Ve=new Re:(Ve=Re.zpp_pool,Re.zpp_pool=Ve.next,Ve.next=null);var Fe=Ve.inner;Fe.jnAcc=Fe.jtAcc=0,Ve.hash=0,Ve.fresh=!0,Ve.arbiter=i,i.jrAcc=0;var Be=i.contacts;Ve._inuse=!0;var Ge=Ve;Ge.next=Be.next,Be.next=Ge,Be.modified=!0,Be.length++,i.innards.add(Fe)}else Ve.fresh=!1;Ve.px=Ne,Ve.py=Le,i.nx=1,i.ny=0,Ve.dist=-Se,Ve.stamp=i.stamp,Ve.posOnly=!1,Ae=Ve}else{var Ze=1/Math.sqrt(Ee),Ue=y.epsilon>Ze?1e100:1/Ze,qe=.5+(n.circle.radius-.5*Se)*Ze;if(t){for(var Ye=n.circle.worldCOMx+Pe*qe,Ke=n.circle.worldCOMy+Te*qe,We=null,Je=i.contacts.next;null!=Je;){var Xe=Je;if(0==Xe.hash){We=Xe;break}Je=Je.next}if(null==We){null==Re.zpp_pool?We=new Re:(We=Re.zpp_pool,Re.zpp_pool=We.next,We.next=null);var He=We.inner;He.jnAcc=He.jtAcc=0,We.hash=0,We.fresh=!0,We.arbiter=i,i.jrAcc=0;var Qe=i.contacts;We._inuse=!0;var $e=We;$e.next=Qe.next,Qe.next=$e,Qe.modified=!0,Qe.length++,i.innards.add(He)}else We.fresh=!1;We.px=Ye,We.py=Ke,i.nx=-Pe*Ze,i.ny=-Te*Ze,We.dist=Ue-Se,We.stamp=i.stamp,We.posOnly=!1,Ae=We}else{for(var ni=n.circle.worldCOMx+Pe*qe,ei=n.circle.worldCOMy+Te*qe,ii=null,ti=i.contacts.next;null!=ti;){var li=ti;if(0==li.hash){ii=li;break}ti=ti.next}if(null==ii){null==Re.zpp_pool?ii=new Re:(ii=Re.zpp_pool,Re.zpp_pool=ii.next,ii.next=null);var pi=ii.inner;pi.jnAcc=pi.jtAcc=0,ii.hash=0,ii.fresh=!0,ii.arbiter=i,i.jrAcc=0;var ri=i.contacts;ii._inuse=!0;var ai=ii;ai.next=ri.next,ri.next=ai,ri.modified=!0,ri.length++,i.innards.add(pi)}else ii.fresh=!1;ii.px=ni,ii.py=ei,i.nx=Pe*Ze,i.ny=Te*Ze,ii.dist=Ue-Se,ii.stamp=i.stamp,ii.posOnly=!1,Ae=ii}}if(null!=Ae){var si=Ae.inner;i.ptype=2;var oi=0,_i=0;oi=gn.x-e.polygon.body.posx,_i=gn.y-e.polygon.body.posy,i.__ref_edge1=zn,i.__ref_vertex=-1,t?(si.lr1x=oi*e.polygon.body.axisy+_i*e.polygon.body.axisx,si.lr1y=_i*e.polygon.body.axisy-oi*e.polygon.body.axisx,si.lr2x=n.circle.localCOMx,si.lr2y=n.circle.localCOMy):(si.lr2x=oi*e.polygon.body.axisy+_i*e.polygon.body.axisx,si.lr2y=_i*e.polygon.body.axisy-oi*e.polygon.body.axisx,si.lr1x=n.circle.localCOMx,si.lr1y=n.circle.localCOMy),i.radius=n.circle.radius}return null!=Ae}return!1}var hi=n.circle.radius+e.circle.radius,ui=0,xi=0;ui=e.circle.worldCOMx-n.circle.worldCOMx,xi=e.circle.worldCOMy-n.circle.worldCOMy;var di,vi=ui*ui+xi*xi;if(vi>hi*hi)di=null;else if(y.epsilon*y.epsilon>vi){for(var zi=n.circle.worldCOMx,ci=n.circle.worldCOMy,mi=null,yi=i.contacts.next;null!=yi;){var fi=yi;if(0==fi.hash){mi=fi;break}yi=yi.next}if(null==mi){null==Re.zpp_pool?mi=new Re:(mi=Re.zpp_pool,Re.zpp_pool=mi.next,mi.next=null);var bi=mi.inner;bi.jnAcc=bi.jtAcc=0,mi.hash=0,mi.fresh=!0,mi.arbiter=i,i.jrAcc=0;var gi=i.contacts;mi._inuse=!0;var wi=mi;wi.next=gi.next,gi.next=wi,gi.modified=!0,gi.length++,i.innards.add(bi)}else mi.fresh=!1;mi.px=zi,mi.py=ci,i.nx=1,i.ny=0,mi.dist=-hi,mi.stamp=i.stamp,mi.posOnly=!1,di=mi}else{var Mi=1/Math.sqrt(vi),Ci=y.epsilon>Mi?1e100:1/Mi,ki=.5+(n.circle.radius-.5*hi)*Mi;if(t){for(var Oi=n.circle.worldCOMx+ui*ki,Ii=n.circle.worldCOMy+xi*ki,Si=null,Pi=i.contacts.next;null!=Pi;){var Ti=Pi;if(0==Ti.hash){Si=Ti;break}Pi=Pi.next}if(null==Si){null==Re.zpp_pool?Si=new Re:(Si=Re.zpp_pool,Re.zpp_pool=Si.next,Si.next=null);var Ai=Si.inner;Ai.jnAcc=Ai.jtAcc=0,Si.hash=0,Si.fresh=!0,Si.arbiter=i,i.jrAcc=0;var Ei=i.contacts;Si._inuse=!0;var Ni=Si;Ni.next=Ei.next,Ei.next=Ni,Ei.modified=!0,Ei.length++,i.innards.add(Ai)}else Si.fresh=!1;Si.px=Oi,Si.py=Ii,i.nx=-ui*Mi,i.ny=-xi*Mi,Si.dist=Ci-hi,Si.stamp=i.stamp,Si.posOnly=!1,di=Si}else{for(var Li=n.circle.worldCOMx+ui*ki,Vi=n.circle.worldCOMy+xi*ki,ji=null,Di=i.contacts.next;null!=Di;){var Fi=Di;if(0==Fi.hash){ji=Fi;break}Di=Di.next}if(null==ji){null==Re.zpp_pool?ji=new Re:(ji=Re.zpp_pool,Re.zpp_pool=ji.next,ji.next=null);var Ri=ji.inner;Ri.jnAcc=Ri.jtAcc=0,ji.hash=0,ji.fresh=!0,ji.arbiter=i,i.jrAcc=0;var Bi=i.contacts;ji._inuse=!0;var Gi=ji;Gi.next=Bi.next,Bi.next=Gi,Bi.modified=!0,Bi.length++,i.innards.add(Ri)}else ji.fresh=!1;ji.px=Li,ji.py=Vi,i.nx=ui*Mi,i.ny=xi*Mi,ji.dist=Ci-hi,ji.stamp=i.stamp,ji.posOnly=!1,di=ji}}if(null!=di){var Zi=di.inner;return t?(Zi.lr1x=e.circle.localCOMx,Zi.lr1y=e.circle.localCOMy,Zi.lr2x=n.circle.localCOMx,Zi.lr2y=n.circle.localCOMy):(Zi.lr1x=n.circle.localCOMx,Zi.lr1y=n.circle.localCOMy,Zi.lr2x=e.circle.localCOMx,Zi.lr2y=e.circle.localCOMy),i.radius=n.circle.radius+e.circle.radius,i.ptype=2,!0}return!1},Ke.testCollide_safe=function(n,e){if(e.type==me.id_ShapeType_CIRCLE){var i=n;n=e,e=i}return Ke.testCollide(n,e)},Ke.testCollide=function(n,e){if(e.type==me.id_ShapeType_POLYGON){if(n.type==me.id_ShapeType_POLYGON){for(var i=!0,t=n.polygon.edges.head;null!=t;){for(var l=t.elt,p=1e100,r=e.polygon.gverts.next;null!=r;){var a=r,s=l.gnormx*a.x+l.gnormy*a.y;p>s&&(p=s),r=r.next}if((p-=l.gprojection)>0){i=!1;break}t=t.next}if(i){for(var o=e.polygon.edges.head;null!=o;){for(var _=o.elt,h=1e100,u=n.polygon.gverts.next;null!=u;){var x=u,d=_.gnormx*x.x+_.gnormy*x.y;h>d&&(h=d),u=u.next}if((h-=_.gprojection)>0){i=!1;break}o=o.next}return i}return!1}for(var v=null,z=null,c=!0,m=-1e100,y=e.polygon.gverts.next,f=e.polygon.edges.head;null!=f;){var b=f.elt,g=b.gnormx*n.circle.worldCOMx+b.gnormy*n.circle.worldCOMy-b.gprojection-n.circle.radius;if(g>0){c=!1;break}g>m&&(m=g,v=b,z=y),y=y.next,f=f.next}if(c){var w=z,M=null==z.next?e.polygon.gverts.next:z.next,C=n.circle.worldCOMy*v.gnormx-n.circle.worldCOMx*v.gnormy;if(C>w.y*v.gnormx-w.x*v.gnormy){if(M.y*v.gnormx-M.x*v.gnormy>C)return!0;var k=n.circle.radius,O=0,I=0;O=M.x-n.circle.worldCOMx,I=M.y-n.circle.worldCOMy;return k*k>=O*O+I*I}var S=n.circle.radius,P=0,T=0;P=w.x-n.circle.worldCOMx,T=w.y-n.circle.worldCOMy;return S*S>=P*P+T*T}return!1}var A=n.circle.radius+e.circle.radius,E=0,N=0;return E=e.circle.worldCOMx-n.circle.worldCOMx,N=e.circle.worldCOMy-n.circle.worldCOMy,A*A>=E*E+N*N},Ke.flowCollide=function(n,e,i){if(e.type==me.id_ShapeType_POLYGON){if(n.type==me.id_ShapeType_POLYGON){for(var t=[],l=[],p=!0,r=!0,a=n.polygon.edges.head;null!=a;){for(var s=a.elt,o=1e100,_=0,h=e.polygon.gverts.next;null!=h;){var u=h,x=s.gnormx*u.x+s.gnormy*u.y;o>x&&(o=x),s.gprojection+y.epsilon>x||(l[_]=!0,r=!1),++_,h=h.next}if((o-=s.gprojection)>0){p=!1;break}a=a.next}if(r){var d=e.polygon;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,d.type==me.id_ShapeType_POLYGON){var v=d.polygon;if(null==v.lverts.next.next)v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;else if(null==v.lverts.next.next.next){v.localCOMx=v.lverts.next.x,v.localCOMy=v.lverts.next.y;v.localCOMx+=1*v.lverts.next.next.x,v.localCOMy+=1*v.lverts.next.next.y;v.localCOMx*=.5,v.localCOMy*=.5}else{v.localCOMx=0,v.localCOMy=0;var z=0,c=v.lverts.next,m=c;c=c.next;var f=c;for(c=c.next;null!=c;){var b=c;z+=f.x*(b.y-m.y);var g=b.y*f.x-b.x*f.y;v.localCOMx+=(f.x+b.x)*g,v.localCOMy+=(f.y+b.y)*g,m=f,f=b,c=c.next}c=v.lverts.next;var w=c;z+=f.x*(w.y-m.y);var M=w.y*f.x-w.x*f.y;v.localCOMx+=(f.x+w.x)*M,v.localCOMy+=(f.y+w.y)*M,m=f,f=w,c=c.next;var C=c;z+=f.x*(C.y-m.y);var k=C.y*f.x-C.x*f.y;v.localCOMx+=(f.x+C.x)*k,v.localCOMy+=(f.y+C.y)*k,z=1/(3*z);var O=z;v.localCOMx*=O,v.localCOMy*=O}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var I=d.body;I.zip_axis&&(I.zip_axis=!1,I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}return i.overlap=e.polygon.area,i.centroidx=e.polygon.worldCOMx,i.centroidy=e.polygon.worldCOMy,!0}if(p){r=!0;for(var S=e.polygon.edges.head;null!=S;){for(var P=S.elt,T=1e100,A=0,E=n.polygon.gverts.next;null!=E;){var N=E,L=P.gnormx*N.x+P.gnormy*N.y;T>L&&(T=L),P.gprojection+y.epsilon>L||(t[A]=!0,r=!1),++A,E=E.next}if((T-=P.gprojection)>0){p=!1;break}S=S.next}if(r){var V=n.polygon;if(V.zip_worldCOM&&null!=V.body){if(V.zip_worldCOM=!1,V.zip_localCOM){if(V.zip_localCOM=!1,V.type==me.id_ShapeType_POLYGON){var j=V.polygon;if(null==j.lverts.next.next)j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;else if(null==j.lverts.next.next.next){j.localCOMx=j.lverts.next.x,j.localCOMy=j.lverts.next.y;j.localCOMx+=1*j.lverts.next.next.x,j.localCOMy+=1*j.lverts.next.next.y;j.localCOMx*=.5,j.localCOMy*=.5}else{j.localCOMx=0,j.localCOMy=0;var D=0,F=j.lverts.next,R=F;F=F.next;var B=F;for(F=F.next;null!=F;){var G=F;D+=B.x*(G.y-R.y);var Z=G.y*B.x-G.x*B.y;j.localCOMx+=(B.x+G.x)*Z,j.localCOMy+=(B.y+G.y)*Z,R=B,B=G,F=F.next}F=j.lverts.next;var U=F;D+=B.x*(U.y-R.y);var q=U.y*B.x-U.x*B.y;j.localCOMx+=(B.x+U.x)*q,j.localCOMy+=(B.y+U.y)*q,R=B,B=U,F=F.next;var Y=F;D+=B.x*(Y.y-R.y);var K=Y.y*B.x-Y.x*B.y;j.localCOMx+=(B.x+Y.x)*K,j.localCOMy+=(B.y+Y.y)*K,D=1/(3*D);var W=D;j.localCOMx*=W,j.localCOMy*=W}}null!=V.wrap_localCOM&&(V.wrap_localCOM.zpp_inner.x=V.localCOMx,V.wrap_localCOM.zpp_inner.y=V.localCOMy)}var J=V.body;J.zip_axis&&(J.zip_axis=!1,J.axisx=Math.sin(J.rot),J.axisy=Math.cos(J.rot)),V.worldCOMx=V.body.posx+(V.body.axisy*V.localCOMx-V.body.axisx*V.localCOMy),V.worldCOMy=V.body.posy+(V.localCOMx*V.body.axisx+V.localCOMy*V.body.axisy)}return i.overlap=n.polygon.area,i.centroidx=n.polygon.worldCOMx,i.centroidy=n.polygon.worldCOMy,!0}if(p){for(;null!=Ke.flowpoly.head;){var X=Ke.flowpoly.pop_unsafe();if(!X._inuse){var H=X;null!=H.outer&&(H.outer.zpp_inner=null,H.outer=null),H._isimmutable=null,H._validate=null,H._invalidate=null,H.next=Mi.zpp_pool,Mi.zpp_pool=H}}for(var Q=null,$=!1,nn=n.polygon.gverts.next,en=0,tn=e.polygon.gverts.next,ln=0,pn=0,rn=e.polygon.edgeCnt;rn>pn;){var an=pn++;if(!l[an]){ln=an;break}tn=tn.next}if(null==tn){tn=e.polygon.gverts.next,$=!0;for(var sn=0,on=n.polygon.edgeCnt;on>sn;){var _n=sn++;if(!t[_n]){en=_n;break}nn=nn.next}null==nn?nn=n.polygon.gverts.next:(Ke.flowpoly.add(nn),Q=Ke.flowpoly.head.elt)}else Ke.flowpoly.add(tn),Q=Ke.flowpoly.head.elt;var hn=1;if(null==Ke.flowpoly.head){for(var un=!0,xn=n.polygon.gverts.next,dn=xn,vn=xn.next;null!=vn;){for(var zn=vn,cn=2,mn=e.polygon.gverts.next,yn=mn,fn=mn.next;null!=fn;){var bn=fn,gn=0,wn=0,Mn=0;wn=dn.x-yn.x,Mn=dn.y-yn.y;var Cn=0,kn=0;Cn=zn.x-dn.x,kn=zn.y-dn.y;var On=0,In=0;On=bn.x-yn.x,In=bn.y-yn.y;var Sn,Pn=kn*On-Cn*In;if(Pn*Pn>y.epsilon*y.epsilon){Pn=1/Pn;var Tn=(In*wn-On*Mn)*Pn;if(Tn>y.epsilon&&1-y.epsilon>Tn){var An=(kn*wn-Cn*Mn)*Pn;An>y.epsilon&&1-y.epsilon>An?(gn=Tn,Sn=!0):Sn=!1}else Sn=!1}else Sn=!1;Sn&&cn>gn&&(cn=gn,tn=mn),mn=fn,yn=bn,fn=fn.next}for(;;){fn=e.polygon.gverts.next;var En=fn,Nn=0,Ln=0,Vn=0;Ln=dn.x-yn.x,Vn=dn.y-yn.y;var jn=0,Dn=0;jn=zn.x-dn.x,Dn=zn.y-dn.y;var Fn=0,Rn=0;Fn=En.x-yn.x,Rn=En.y-yn.y;var Bn,Gn=Dn*Fn-jn*Rn;if(Gn*Gn>y.epsilon*y.epsilon){Gn=1/Gn;var Zn=(Rn*Ln-Fn*Vn)*Gn;if(Zn>y.epsilon&&1-y.epsilon>Zn){var Un=(Dn*Ln-jn*Vn)*Gn;Un>y.epsilon&&1-y.epsilon>Un?(Nn=Zn,Bn=!0):Bn=!1}else Bn=!1}else Bn=!1;Bn&&cn>Nn&&(cn=Nn,tn=mn);break}if(2!=cn){var qn=0,Yn=0,Kn=cn;qn=dn.x+(zn.x-dn.x)*Kn,Yn=dn.y+(zn.y-dn.y)*Kn;var Wn;null==Mi.zpp_pool?Wn=new Mi:(Wn=Mi.zpp_pool,Mi.zpp_pool=Wn.next,Wn.next=null),Wn.weak=!1,Wn._immutable=!1,Wn.x=qn,Wn.y=Yn,Q=Wn,Ke.flowpoly.add(Q),$=!0,nn=xn,un=!1;break}xn=vn,dn=zn,vn=vn.next}if(un)for(;;){vn=n.polygon.gverts.next;for(var Jn=vn,Xn=2,Hn=e.polygon.gverts.next,Qn=Hn,$n=Hn.next;null!=$n;){var ne=$n,ee=0,ie=0,te=0;ie=dn.x-Qn.x,te=dn.y-Qn.y;var le=0,pe=0;le=Jn.x-dn.x,pe=Jn.y-dn.y;var re=0,ae=0;re=ne.x-Qn.x,ae=ne.y-Qn.y;var se,oe=pe*re-le*ae;if(oe*oe>y.epsilon*y.epsilon){oe=1/oe;var _e=(ae*ie-re*te)*oe;if(_e>y.epsilon&&1-y.epsilon>_e){var he=(pe*ie-le*te)*oe;he>y.epsilon&&1-y.epsilon>he?(ee=_e,se=!0):se=!1}else se=!1}else se=!1;se&&Xn>ee&&(Xn=ee,tn=Hn),Hn=$n,Qn=ne,$n=$n.next}for(;;){$n=e.polygon.gverts.next;var ue=$n,xe=0,de=0,ve=0;de=dn.x-Qn.x,ve=dn.y-Qn.y;var ze=0,ce=0;ze=Jn.x-dn.x,ce=Jn.y-dn.y;var ye=0,fe=0;ye=ue.x-Qn.x,fe=ue.y-Qn.y;var be,ge=ce*ye-ze*fe;if(ge*ge>y.epsilon*y.epsilon){ge=1/ge;var we=(fe*de-ye*ve)*ge;if(we>y.epsilon&&1-y.epsilon>we){var Me=(ce*de-ze*ve)*ge;Me>y.epsilon&&1-y.epsilon>Me?(xe=we,be=!0):be=!1}else be=!1}else be=!1;be&&Xn>xe&&(Xn=xe,tn=Hn);break}if(2!=Xn){var Ce=0,ke=0,Oe=Xn;Ce=dn.x+(Jn.x-dn.x)*Oe,ke=dn.y+(Jn.y-dn.y)*Oe;var Ie;null==Mi.zpp_pool?Ie=new Mi:(Ie=Mi.zpp_pool,Mi.zpp_pool=Ie.next,Ie.next=null),Ie.weak=!1,Ie._immutable=!1,Ie.x=Ce,Ie.y=ke,Q=Ie,Ke.flowpoly.add(Q),$=!0,nn=xn;break}break}hn=2}for(;;)if($)if(nn=nn.next,++en,null==nn&&(nn=n.polygon.gverts.next,en=0),t[en]){var Se=Ke.flowpoly.head.elt,Pe=nn,Te=tn,Ae=tn.next;null==Ae&&(Ae=e.polygon.gverts.next);for(var Ee=-1,Ne=null,Le=0,Ve=0,je=Ae,De=Ae;;){var Fe=De,Re=0,Be=0,Ge=0;Be=Te.x-Se.x,Ge=Te.y-Se.y;var Ze=0,Ue=0;Ze=Fe.x-Te.x,Ue=Fe.y-Te.y;var qe=0,Ye=0;qe=Pe.x-Se.x,Ye=Pe.y-Se.y;var We,Je=Ue*qe-Ze*Ye;if(Je*Je>y.epsilon*y.epsilon){Je=1/Je;var Xe=(Ye*Be-qe*Ge)*Je;if(Xe>y.epsilon&&1-y.epsilon>Xe){var He=(Ue*Be-Ze*Ge)*Je;He>y.epsilon&&1-y.epsilon>He?(Re=Xe,We=!0):We=!1}else We=!1}else We=!1;if(We&&Re>=Ee){if(Ne=tn,Le=ln,++Ve==hn){Ee=Re,De=je;break}Ee=Re}Te=Fe,tn=De,++ln,e.polygon.edgeCnt>ln||(ln=0),De=De.next,null==De&&(De=e.polygon.gverts.next);break}for(;De!=je;){var Qe=De,$e=0,ni=0,ei=0;ni=Te.x-Se.x,ei=Te.y-Se.y;var ii=0,ti=0;ii=Qe.x-Te.x,ti=Qe.y-Te.y;var li=0,pi=0;li=Pe.x-Se.x,pi=Pe.y-Se.y;var ri,ai=ti*li-ii*pi;if(ai*ai>y.epsilon*y.epsilon){ai=1/ai;var si=(pi*ni-li*ei)*ai;if(si>y.epsilon&&1-y.epsilon>si){var oi=(ti*ni-ii*ei)*ai;oi>y.epsilon&&1-y.epsilon>oi?($e=si,ri=!0):ri=!1}else ri=!1}else ri=!1;if(ri&&$e>=Ee){if(Ne=tn,Le=ln,++Ve==hn){Ee=$e,De=je;break}Ee=$e}Te=Qe,tn=De,++ln,e.polygon.edgeCnt>ln||(ln=0),De=De.next,null==De&&(De=e.polygon.gverts.next)}if(null==Ne)break;var _i=Ne,hi=Ne.next;null==hi&&(hi=e.polygon.gverts.next);var ui=hi,xi=0,di=0,vi=Ee;xi=_i.x+(ui.x-_i.x)*vi,di=_i.y+(ui.y-_i.y)*vi;var zi;if(null!=Q){var ci=0,mi=0;ci=xi-Q.x,mi=di-Q.y,zi=y.epsilon>ci*ci+mi*mi}else zi=!1;if(zi)break;var yi,fi=Ke.flowpoly;null==Mi.zpp_pool?yi=new Mi:(yi=Mi.zpp_pool,Mi.zpp_pool=yi.next,yi.next=null),yi.weak=!1,yi._immutable=!1,yi.x=xi,yi.y=di,fi.add(yi),null==Q&&(Q=Ke.flowpoly.head.elt),tn=Ne,ln=Le,$=!$,hn=2}else{var bi,gi=nn;if(null!=Q){var wi=0,Ci=0;wi=gi.x-Q.x,Ci=gi.y-Q.y,bi=y.epsilon>wi*wi+Ci*Ci}else bi=!1;if(bi)break;Ke.flowpoly.add(gi),null==Q&&(Q=Ke.flowpoly.head.elt),hn=1}else if(tn=tn.next,++ln,null==tn&&(tn=e.polygon.gverts.next,ln=0),l[ln]){var ki=Ke.flowpoly.head.elt,Oi=tn,Ii=nn,Si=nn.next;null==Si&&(Si=n.polygon.gverts.next);for(var Pi=-1,Ti=null,Ai=0,Ei=0,Ni=Si,Li=Si;;){var Vi=Li,ji=0,Di=0,Fi=0;Di=Ii.x-ki.x,Fi=Ii.y-ki.y;var Ri=0,Bi=0;Ri=Vi.x-Ii.x,Bi=Vi.y-Ii.y;var Gi=0,Zi=0;Gi=Oi.x-ki.x,Zi=Oi.y-ki.y;var Ui,qi=Bi*Gi-Ri*Zi;if(qi*qi>y.epsilon*y.epsilon){qi=1/qi;var Yi=(Zi*Di-Gi*Fi)*qi;if(Yi>y.epsilon&&1-y.epsilon>Yi){var Ki=(Bi*Di-Ri*Fi)*qi;Ki>y.epsilon&&1-y.epsilon>Ki?(ji=Yi,Ui=!0):Ui=!1}else Ui=!1}else Ui=!1;if(Ui&&ji>=Pi){if(Ti=nn,Ai=en,++Ei==hn){Pi=ji,Li=Ni;break}Pi=ji}Ii=Vi,nn=Li,++en,n.polygon.edgeCnt>en||(en=0),Li=Li.next,null==Li&&(Li=n.polygon.gverts.next);break}for(;Li!=Ni;){var Wi=Li,Ji=0,Xi=0,Hi=0;Xi=Ii.x-ki.x,Hi=Ii.y-ki.y;var Qi=0,$i=0;Qi=Wi.x-Ii.x,$i=Wi.y-Ii.y;var nt=0,et=0;nt=Oi.x-ki.x,et=Oi.y-ki.y;var it,tt=$i*nt-Qi*et;if(tt*tt>y.epsilon*y.epsilon){tt=1/tt;var lt=(et*Xi-nt*Hi)*tt;if(lt>y.epsilon&&1-y.epsilon>lt){var pt=($i*Xi-Qi*Hi)*tt;pt>y.epsilon&&1-y.epsilon>pt?(Ji=lt,it=!0):it=!1}else it=!1}else it=!1;if(it&&Ji>=Pi){if(Ti=nn,Ai=en,++Ei==hn){Pi=Ji,Li=Ni;break}Pi=Ji}Ii=Wi,nn=Li,++en,n.polygon.edgeCnt>en||(en=0),Li=Li.next,null==Li&&(Li=n.polygon.gverts.next)}if(null==Ti)break;var rt=Ti,at=Ti.next;null==at&&(at=n.polygon.gverts.next);var st=at,ot=0,_t=0,ht=Pi;ot=rt.x+(st.x-rt.x)*ht,_t=rt.y+(st.y-rt.y)*ht;var ut;if(null!=Q){var xt=0,dt=0;xt=ot-Q.x,dt=_t-Q.y,ut=y.epsilon>xt*xt+dt*dt}else ut=!1;if(ut)break;var vt,zt=Ke.flowpoly;null==Mi.zpp_pool?vt=new Mi:(vt=Mi.zpp_pool,Mi.zpp_pool=vt.next,vt.next=null),vt.weak=!1,vt._immutable=!1,vt.x=ot,vt.y=_t,zt.add(vt),null==Q&&(Q=Ke.flowpoly.head.elt),nn=Ti,en=Ai,$=!$,hn=2}else{var ct,mt=tn;if(null!=Q){var yt=0,ft=0;yt=mt.x-Q.x,ft=mt.y-Q.y,ct=y.epsilon>yt*yt+ft*ft}else ct=!1;if(ct)break;Ke.flowpoly.add(mt),null==Q&&(Q=Ke.flowpoly.head.elt),hn=1}if(null!=Ke.flowpoly.head&&null!=Ke.flowpoly.head.next&&null!=Ke.flowpoly.head.next.next){var bt=0,gt=0,wt=0;gt=0,wt=0,bt=0;var Mt=Ke.flowpoly.head,Ct=Mt.elt;Mt=Mt.next;var kt=Mt.elt;for(Mt=Mt.next;null!=Mt;){var Ot=Mt.elt;bt+=kt.x*(Ot.y-Ct.y);var It=Ot.y*kt.x-Ot.x*kt.y;gt+=(kt.x+Ot.x)*It,wt+=(kt.y+Ot.y)*It,Ct=kt,kt=Ot,Mt=Mt.next}Mt=Ke.flowpoly.head;var St=Mt.elt;bt+=kt.x*(St.y-Ct.y);var Pt=St.y*kt.x-St.x*kt.y;gt+=(kt.x+St.x)*Pt,wt+=(kt.y+St.y)*Pt,Ct=kt,kt=St,Mt=Mt.next;var Tt=Mt.elt;bt+=kt.x*(Tt.y-Ct.y);var At=Tt.y*kt.x-Tt.x*kt.y;gt+=(kt.x+Tt.x)*At,wt+=(kt.y+Tt.y)*At,bt*=.5;var Et=1/(6*bt),Nt=Et;return gt*=Nt,wt*=Nt,i.overlap=-bt,i.centroidx=gt,i.centroidy=wt,!0}return!1}return!1}return!1}for(var Lt=[],Vt=!0,jt=null,Dt=null,Ft=-1e100,Rt=!0,Bt=e.polygon.gverts.next,Gt=0,Zt=e.polygon.edges.head;null!=Zt;){var Ut=Zt.elt,qt=Ut.gnormx*n.circle.worldCOMx+Ut.gnormy*n.circle.worldCOMy;if(qt>Ut.gprojection+n.circle.radius){Rt=!1;break}qt+n.circle.radius>Ut.gprojection+y.epsilon&&(Vt=!1,Lt[Gt]=!0),qt-=Ut.gprojection+n.circle.radius,qt>Ft&&(Ft=qt,jt=Ut,Dt=Bt),Bt=Bt.next,++Gt,Zt=Zt.next}if(Rt){if(Vt)return i.overlap=n.circle.area,i.centroidx=n.circle.worldCOMx,i.centroidy=n.circle.worldCOMy,!0;var Yt,Kt=Dt,Wt=null==Dt.next?e.polygon.gverts.next:Dt.next,Jt=n.circle.worldCOMy*jt.gnormx-n.circle.worldCOMx*jt.gnormy;if(Kt.y*jt.gnormx-Kt.x*jt.gnormy<Jt)if(Jt<Wt.y*jt.gnormx-Wt.x*jt.gnormy)Yt=!0;else{var Xt=n.circle.radius,Ht=0,Qt=0;Ht=Wt.x-n.circle.worldCOMx,Qt=Wt.y-n.circle.worldCOMy;var $t=Ht*Ht+Qt*Qt;Yt=Xt*Xt>=$t}else{var nl=n.circle.radius,el=0,il=0;el=Kt.x-n.circle.worldCOMx,il=Kt.y-n.circle.worldCOMy;Yt=nl*nl>=el*el+il*il}if(Yt){for(var tl=[],ll=0,pl=!0,rl=null,al=0,sl=e.polygon.gverts.next;null!=sl;){var ol=sl,_l=0,hl=0;_l=ol.x-n.circle.worldCOMx,hl=ol.y-n.circle.worldCOMy;(tl[ll]=n.circle.radius*n.circle.radius>=_l*_l+hl*hl)?(al=ll,rl=sl):pl=!1,++ll,sl=sl.next}if(pl){var ul=e.polygon;if(ul.zip_worldCOM&&null!=ul.body){if(ul.zip_worldCOM=!1,ul.zip_localCOM){if(ul.zip_localCOM=!1,ul.type==me.id_ShapeType_POLYGON){var xl=ul.polygon;if(null==xl.lverts.next.next)xl.localCOMx=xl.lverts.next.x,xl.localCOMy=xl.lverts.next.y;else if(null==xl.lverts.next.next.next){xl.localCOMx=xl.lverts.next.x,xl.localCOMy=xl.lverts.next.y;xl.localCOMx+=1*xl.lverts.next.next.x,xl.localCOMy+=1*xl.lverts.next.next.y;xl.localCOMx*=.5,xl.localCOMy*=.5}else{xl.localCOMx=0,xl.localCOMy=0;var dl=0,vl=xl.lverts.next,zl=vl;vl=vl.next;var cl=vl;for(vl=vl.next;null!=vl;){var ml=vl;dl+=cl.x*(ml.y-zl.y);var yl=ml.y*cl.x-ml.x*cl.y;xl.localCOMx+=(cl.x+ml.x)*yl,xl.localCOMy+=(cl.y+ml.y)*yl,zl=cl,cl=ml,vl=vl.next}vl=xl.lverts.next;var fl=vl;dl+=cl.x*(fl.y-zl.y);var bl=fl.y*cl.x-fl.x*cl.y;xl.localCOMx+=(cl.x+fl.x)*bl,xl.localCOMy+=(cl.y+fl.y)*bl,zl=cl,cl=fl,vl=vl.next;var gl=vl;dl+=cl.x*(gl.y-zl.y);var wl=gl.y*cl.x-gl.x*cl.y;xl.localCOMx+=(cl.x+gl.x)*wl,xl.localCOMy+=(cl.y+gl.y)*wl,dl=1/(3*dl);var Ml=dl;xl.localCOMx*=Ml,xl.localCOMy*=Ml}}null!=ul.wrap_localCOM&&(ul.wrap_localCOM.zpp_inner.x=ul.localCOMx,ul.wrap_localCOM.zpp_inner.y=ul.localCOMy)}var Cl=ul.body;Cl.zip_axis&&(Cl.zip_axis=!1,Cl.axisx=Math.sin(Cl.rot),Cl.axisy=Math.cos(Cl.rot)),ul.worldCOMx=ul.body.posx+(ul.body.axisy*ul.localCOMx-ul.body.axisx*ul.localCOMy),ul.worldCOMy=ul.body.posy+(ul.localCOMx*ul.body.axisx+ul.localCOMy*ul.body.axisy)}return i.overlap=e.polygon.area,i.centroidx=e.polygon.worldCOMx,i.centroidy=e.polygon.worldCOMy,!0}for(;null!=Ke.flowpoly.head;){var kl=Ke.flowpoly.pop_unsafe();if(!kl._inuse){var Ol=kl;null!=Ol.outer&&(Ol.outer.zpp_inner=null,Ol.outer=null),Ol._isimmutable=null,Ol._validate=null,Ol._invalidate=null,Ol.next=Mi.zpp_pool,Mi.zpp_pool=Ol}}Ke.flowsegs.clear();var Il=null,Sl=1;for(null==rl?(rl=e.polygon.gverts.next,Sl=2):(Il=rl,Ke.flowpoly.add(Il));0!=Sl;)if(1==Sl)if(rl=rl.next,null==rl&&(rl=e.polygon.gverts.next),++al,e.polygon.edgeCnt>al||(al=0),tl[al]){var Pl=0,Tl=0;if(Pl=Il.x-rl.x,Tl=Il.y-rl.y,y.epsilon>Pl*Pl+Tl*Tl)break;Ke.flowpoly.add(rl)}else{var Al=Ke.flowpoly.head.elt,El=rl,Nl=0,Ll=0;Nl=El.x-Al.x,Ll=El.y-Al.y;var Vl=0,jl=0;Vl=Al.x-n.circle.worldCOMx,jl=Al.y-n.circle.worldCOMy;var Dl=Nl*Nl+Ll*Ll,Fl=2*(Vl*Nl+jl*Ll),Rl=Vl*Vl+jl*jl-n.circle.radius*n.circle.radius,Bl=Math.sqrt(Fl*Fl-4*Dl*Rl);Dl=1/(2*Dl);var Gl=(-Fl-Bl)*Dl,Zl=y.epsilon>Gl?(-Fl+Bl)*Dl:Gl,Ul=0,ql=0,Yl=Zl;Ul=Al.x+(El.x-Al.x)*Yl,ql=Al.y+(El.y-Al.y)*Yl;var Kl=0,Wl=0;if(Kl=Il.x-Ul,Wl=Il.y-ql,y.epsilon>Kl*Kl+Wl*Wl)break;var Jl,Xl=Ke.flowpoly;null==Mi.zpp_pool?Jl=new Mi:(Jl=Mi.zpp_pool,Mi.zpp_pool=Jl.next,Jl.next=null),Jl.weak=!1,Jl._immutable=!1,Jl.x=Ul,Jl.y=ql,Xl.add(Jl),Sl=2}else if(2==Sl){var Hl=rl.next;null==Hl&&(Hl=e.polygon.gverts.next);var Ql=rl;Sl=0;for(var $l=Hl,np=Hl;;){var ep=np,ip=al+1;if(ip==e.polygon.edgeCnt&&(ip=0),Lt[al]){if(tl[ip]){var tp=0,lp=0;tp=ep.x-Ql.x,lp=ep.y-Ql.y;var pp=0,rp=0;pp=Ql.x-n.circle.worldCOMx,rp=Ql.y-n.circle.worldCOMy;var ap=tp*tp+lp*lp,sp=2*(pp*tp+rp*lp),op=pp*pp+rp*rp-n.circle.radius*n.circle.radius,_p=Math.sqrt(sp*sp-4*ap*op);ap=1/(2*ap);var hp=(-sp-_p)*ap,up=y.epsilon>hp?(-sp+_p)*ap:hp,xp=0,dp=0,vp=up;xp=Ql.x+(ep.x-Ql.x)*vp,dp=Ql.y+(ep.y-Ql.y)*vp;var zp=0,cp=0;if(zp=Il.x-xp,cp=Il.y-dp,y.epsilon>zp*zp+cp*cp){Sl=0,np=$l;break}var mp;null==Mi.zpp_pool?mp=new Mi:(mp=Mi.zpp_pool,Mi.zpp_pool=mp.next,mp.next=null),mp.weak=!1,mp._immutable=!1,mp.x=xp,mp.y=dp;var yp=mp;Ke.flowsegs.add(Ke.flowpoly.head.elt),Ke.flowsegs.add(yp),Ke.flowpoly.add(yp),Sl=1,np=$l;break}var fp=0,bp=0,gp=0,wp=0;gp=ep.x-Ql.x,wp=ep.y-Ql.y;var Mp=0,Cp=0;Mp=Ql.x-n.circle.worldCOMx,Cp=Ql.y-n.circle.worldCOMy;var kp,Op=gp*gp+wp*wp,Ip=2*(Mp*gp+Cp*wp),Sp=Mp*Mp+Cp*Cp-n.circle.radius*n.circle.radius,Pp=Ip*Ip-4*Op*Sp;if(y.epsilon>Pp*Pp?(0>Pp?fp=10:(bp=-Ip/(2*Op),fp=bp),kp=!1):(Pp=Math.sqrt(Pp),Op=1/(2*Op),fp=(-Ip-Pp)*Op,bp=(-Ip+Pp)*Op,kp=!0),1-y.epsilon>fp&&bp>y.epsilon){var Tp=0,Ap=0,Ep=fp;Tp=Ql.x+(ep.x-Ql.x)*Ep,Ap=Ql.y+(ep.y-Ql.y)*Ep;var Np;if(null!=Il){var Lp=0,Vp=0;Lp=Il.x-Tp,Vp=Il.y-Ap,Np=y.epsilon>Lp*Lp+Vp*Vp}else Np=!1;if(Np){Sl=0,np=$l;break}var jp;null==Mi.zpp_pool?jp=new Mi:(jp=Mi.zpp_pool,Mi.zpp_pool=jp.next,jp.next=null),jp.weak=!1,jp._immutable=!1,jp.x=Tp,jp.y=Ap;var Dp=jp;if(null!=Ke.flowpoly.head&&(Ke.flowsegs.add(Ke.flowpoly.head.elt),Ke.flowsegs.add(Dp)),Ke.flowpoly.add(Dp),null==Il&&(Il=Ke.flowpoly.head.elt),kp){var Fp=0,Rp=0,Bp=bp;Fp=Ql.x+(ep.x-Ql.x)*Bp,Rp=Ql.y+(ep.y-Ql.y)*Bp;var Gp,Zp=Ke.flowpoly;null==Mi.zpp_pool?Gp=new Mi:(Gp=Mi.zpp_pool,Mi.zpp_pool=Gp.next,Gp.next=null),Gp.weak=!1,Gp._immutable=!1,Gp.x=Fp,Gp.y=Rp,Zp.add(Gp)}}}Ql=ep,rl=np,al=ip,np=np.next,null==np&&(np=e.polygon.gverts.next);break}for(;np!=$l;){var Up=np,qp=al+1;if(qp==e.polygon.edgeCnt&&(qp=0),Lt[al]){if(tl[qp]){var Yp=0,Kp=0;Yp=Up.x-Ql.x,Kp=Up.y-Ql.y;var Wp=0,Jp=0;Wp=Ql.x-n.circle.worldCOMx,Jp=Ql.y-n.circle.worldCOMy;var Xp=Yp*Yp+Kp*Kp,Hp=2*(Wp*Yp+Jp*Kp),Qp=Wp*Wp+Jp*Jp-n.circle.radius*n.circle.radius,$p=Math.sqrt(Hp*Hp-4*Xp*Qp);Xp=1/(2*Xp);var nr=(-Hp-$p)*Xp,er=y.epsilon>nr?(-Hp+$p)*Xp:nr,ir=0,tr=0,lr=er;ir=Ql.x+(Up.x-Ql.x)*lr,tr=Ql.y+(Up.y-Ql.y)*lr;var pr=0,rr=0;if(pr=Il.x-ir,rr=Il.y-tr,y.epsilon>pr*pr+rr*rr){Sl=0,np=$l;break}var ar;null==Mi.zpp_pool?ar=new Mi:(ar=Mi.zpp_pool,Mi.zpp_pool=ar.next,ar.next=null),ar.weak=!1,ar._immutable=!1,ar.x=ir,ar.y=tr;var sr=ar;Ke.flowsegs.add(Ke.flowpoly.head.elt),Ke.flowsegs.add(sr),Ke.flowpoly.add(sr),Sl=1,np=$l;break}var or=0,_r=0,hr=0,ur=0;hr=Up.x-Ql.x,ur=Up.y-Ql.y;var xr=0,dr=0;xr=Ql.x-n.circle.worldCOMx,dr=Ql.y-n.circle.worldCOMy;var vr,zr=hr*hr+ur*ur,cr=2*(xr*hr+dr*ur),mr=xr*xr+dr*dr-n.circle.radius*n.circle.radius,yr=cr*cr-4*zr*mr;if(y.epsilon>yr*yr?(0>yr?or=10:(_r=-cr/(2*zr),or=_r),vr=!1):(yr=Math.sqrt(yr),zr=1/(2*zr),or=(-cr-yr)*zr,_r=(-cr+yr)*zr,vr=!0),1-y.epsilon>or&&_r>y.epsilon){var fr=0,br=0,gr=or;fr=Ql.x+(Up.x-Ql.x)*gr,br=Ql.y+(Up.y-Ql.y)*gr;var wr;if(null!=Il){var Mr=0,Cr=0;Mr=Il.x-fr,Cr=Il.y-br,wr=y.epsilon>Mr*Mr+Cr*Cr}else wr=!1;if(wr){Sl=0,np=$l;break}var kr;null==Mi.zpp_pool?kr=new Mi:(kr=Mi.zpp_pool,Mi.zpp_pool=kr.next,kr.next=null),kr.weak=!1,kr._immutable=!1,kr.x=fr,kr.y=br;var Or=kr;if(null!=Ke.flowpoly.head&&(Ke.flowsegs.add(Ke.flowpoly.head.elt),Ke.flowsegs.add(Or)),Ke.flowpoly.add(Or),null==Il&&(Il=Ke.flowpoly.head.elt),vr){var Ir=0,Sr=0,Pr=_r;Ir=Ql.x+(Up.x-Ql.x)*Pr,Sr=Ql.y+(Up.y-Ql.y)*Pr;var Tr,Ar=Ke.flowpoly;null==Mi.zpp_pool?Tr=new Mi:(Tr=Mi.zpp_pool,Mi.zpp_pool=Tr.next,Tr.next=null),Tr.weak=!1,Tr._immutable=!1,Tr.x=Ir,Tr.y=Sr,Ar.add(Tr)}}}Ql=Up,rl=np,al=qp,np=np.next,null==np&&(np=e.polygon.gverts.next)}}if(null==Ke.flowpoly.head)return!1;if(null==Ke.flowpoly.head.next){for(var Er=!0,Nr=e.polygon.edges.head;null!=Nr;){var Lr=Nr.elt;if(Lr.gnormx*n.circle.worldCOMx+Lr.gnormy*n.circle.worldCOMy>Lr.gprojection){Er=!1;break}Nr=Nr.next}return!!Er&&(i.overlap=n.circle.area,i.centroidx=n.circle.worldCOMx,i.centroidy=n.circle.worldCOMy,!0)}var Vr=0,jr=0,Dr=0;if(null!=Ke.flowpoly.head.next.next){var Fr=0,Rr=0,Br=0;Rr=0,Br=0,Fr=0;var Gr=Ke.flowpoly.head,Zr=Gr.elt;Gr=Gr.next;var Ur=Gr.elt;for(Gr=Gr.next;null!=Gr;){var qr=Gr.elt;Fr+=Ur.x*(qr.y-Zr.y);var Yr=qr.y*Ur.x-qr.x*Ur.y;Rr+=(Ur.x+qr.x)*Yr,Br+=(Ur.y+qr.y)*Yr,Zr=Ur,Ur=qr,Gr=Gr.next}Gr=Ke.flowpoly.head;var Kr=Gr.elt;Fr+=Ur.x*(Kr.y-Zr.y);var Wr=Kr.y*Ur.x-Kr.x*Ur.y;Rr+=(Ur.x+Kr.x)*Wr,Br+=(Ur.y+Kr.y)*Wr,Zr=Ur,Ur=Kr,Gr=Gr.next;var Jr=Gr.elt;Fr+=Ur.x*(Jr.y-Zr.y);var Xr=Jr.y*Ur.x-Jr.x*Ur.y;Rr+=(Ur.x+Jr.x)*Xr,Br+=(Ur.y+Jr.y)*Xr,Fr*=.5;var Hr=1/(6*Fr),Qr=Hr;Rr*=Qr,Br*=Qr;var $r=-Fr;Vr+=Rr*$r,jr+=Br*$r,Dr-=Fr}else Ke.flowsegs.add(Ke.flowpoly.head.elt),Ke.flowsegs.add(Ke.flowpoly.head.next.elt);for(;null!=Ke.flowsegs.head;){var na=Ke.flowsegs.pop_unsafe(),ea=Ke.flowsegs.pop_unsafe(),ia=0,ta=0;ia=ea.x-na.x,ta=ea.y-na.y;var la=0,pa=0;la=ia,pa=ta;var ra=la*la+pa*pa,aa=1/Math.sqrt(ra),sa=aa;la*=sa,pa*=sa;var oa=la;la=-pa,pa=oa;var _a=0,ha=0;_a=na.x+ea.x,ha=na.y+ea.y;_a*=.5,ha*=.5;_a-=1*n.circle.worldCOMx,ha-=1*n.circle.worldCOMy;var ua=la*_a+pa*ha,xa=0,da=0,va=ua,za=va/n.circle.radius,ca=Math.sqrt(1-za*za),ma=Math.acos(za);xa=n.circle.radius*(n.circle.radius*ma-va*ca),da=.6666666666666666*n.circle.radius*ca*ca*ca/(ma-za*ca),_a=n.circle.worldCOMx,ha=n.circle.worldCOMy;var ya=da;_a+=la*ya,ha+=pa*ya;var fa=xa;Vr+=_a*fa,jr+=ha*fa,Dr+=xa}var ba=1/Dr;return Vr*=ba,jr*=ba,i.overlap=Dr,i.centroidx=Vr,i.centroidy=jr,!0}return!1}return!1}var ga=n.circle,wa=e.circle,Ma=0,Ca=0;Ma=wa.worldCOMx-ga.worldCOMx,Ca=wa.worldCOMy-ga.worldCOMy;var ka=ga.radius+wa.radius,Oa=Ma*Ma+Ca*Ca;if(Oa>ka*ka)return!1;if(y.epsilon*y.epsilon>Oa)return wa.radius>ga.radius?(i.overlap=ga.area,i.centroidx=ga.worldCOMx,i.centroidy=ga.worldCOMy):(i.overlap=wa.area,i.centroidx=wa.worldCOMx,i.centroidy=wa.worldCOMy),!0;var Ia=Math.sqrt(Oa),Sa=1/Ia,Pa=.5*(Ia-(wa.radius*wa.radius-ga.radius*ga.radius)*Sa);if(-ga.radius<Pa){var Ta=Ia-Pa;if(-wa.radius<Ta){var Aa=0,Ea=0,Na=0,La=0,Va=Pa,ja=Va/ga.radius,Da=Math.sqrt(1-ja*ja),Fa=Math.acos(ja);Aa=ga.radius*(ga.radius*Fa-Va*Da),Ea=.6666666666666666*ga.radius*Da*Da*Da/(Fa-ja*Da);var Ra=Ta,Ba=Ra/wa.radius,Ga=Math.sqrt(1-Ba*Ba),Za=Math.acos(Ba);Na=wa.radius*(wa.radius*Za-Ra*Ga),La=.6666666666666666*wa.radius*Ga*Ga*Ga/(Za-Ba*Ga);var Ua=Aa+Na,qa=(Ea*Aa+(Ia-La)*Na)/Ua*Sa;i.overlap=Ua,i.centroidx=ga.worldCOMx+Ma*qa,i.centroidy=ga.worldCOMy+Ca*qa}else i.overlap=wa.area,i.centroidx=wa.worldCOMx,i.centroidy=wa.worldCOMy}else i.overlap=ga.area,i.centroidx=ga.worldCOMx,i.centroidy=ga.worldCOMy;return!0};var We=function(){};l["zpp_nape.geom.ZPP_Convex"]=We,We.__name__=["zpp_nape","geom","ZPP_Convex"],We.isinner=function(n,e,i){var t=0,l=0;t=n.x-e.x,l=n.y-e.y;var p=0;return p=i.x-e.x,(i.y-e.y)*t-p*l>=0},We.optimise=function(n){var e=n.vertices,i=n.vertices;if(null!=e)for(var t=e;;){var l=t;if(l.sort(),(t=t.next)==i)break}var p=n.vertices,r=n.vertices;if(null!=p)for(var a=p;;){for(var s=a,o=s.prev,_=null,h=s.diagonals.head;null!=h;){var u=h.elt,x=null==h.next?s.next:h.next.elt;if(We.isinner(x,s,o)){for(var d=!0,v=u,z=v.prev,c=null,m=v.diagonals.head;null!=m;){var y=m.elt;if(y==s){var f=null==m.next?v.next:m.next.elt;d=We.isinner(f,v,z);break}z=y,c=m,m=m.next}d?(h=s.diagonals.erase(_),v.diagonals.erase(c)):(o=u,_=h,h=h.next)}else _=h,o=u,h=h.next}if((a=a.next)==r)break}};var Je=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};l["zpp_nape.geom.ZPP_ConvexRayResult"]=Je,Je.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],Je.getRay=function(n,e,i,t){var l;null==Je.rayPool?(Je.internal=!0,l=new Mn,l.zpp_inner=new Je,l.zpp_inner.ray=l,Je.internal=!1):(l=Je.rayPool.ray,Je.rayPool=Je.rayPool.next,l.zpp_inner.next=null);var p=l.zpp_inner;return p.normal=n,n.zpp_inner._immutable=!0,p.toiDistance=e,p.inner=i,p.shape=t,l},Je.getConvex=function(n,e,i,t){var l;null==Je.convexPool?(Je.internal=!0,l=new un,l.zpp_inner=new Je,l.zpp_inner.convex=l,Je.internal=!1):(l=Je.convexPool.convex,Je.convexPool=Je.convexPool.next,l.zpp_inner.next=null);var p=l.zpp_inner;return p.normal=n,p.position=e,n.zpp_inner._immutable=!0,e.zpp_inner._immutable=!0,p.toiDistance=i,p.shape=t,l},Je.prototype={normal:null,shape:null,convex:null,position:null,ray:null,inner:null,next:null,toiDistance:null,disposed:function(){},free:function(){this.normal.zpp_inner._immutable=!1;var n=this.normal,e=n.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var t=n;t.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=t:Ml.poolVec2=t,Ml.nextVec2=t,t.zpp_disp=!0;var l=i;if(null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,null!=this.position){this.position.zpp_inner._immutable=!1;var p=this.position,r=p.zpp_inner;null!=r._isimmutable&&r._isimmutable();var a=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null;var s=p;s.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=s:Ml.poolVec2=s,Ml.nextVec2=s,s.zpp_disp=!0;var o=a;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=Mi.zpp_pool,Mi.zpp_pool=o}this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=Je.convexPool,Je.convexPool=this):(this.next=Je.rayPool,Je.rayPool=this)},__class__:Je};var Xe=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};l["zpp_nape.geom.ZPP_CutVert"]=Xe,Xe.__name__=["zpp_nape","geom","ZPP_CutVert"],Xe.path=function(n){var e;return null==Xe.zpp_pool?e=new Xe:(e=Xe.zpp_pool,Xe.zpp_pool=e.next,e.next=null),e.vert=n,e.parent=e,e.rank=0,e.used=!1,e},Xe.prototype={prev:null,next:null,posx:null,posy:null,vert:null,value:null,positive:null,parent:null,rank:null,used:null,alloc:function(){},free:function(){this.vert=null,this.parent=null},__class__:Xe};var He=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};l["zpp_nape.geom.ZPP_CutInt"]=He,He.__name__=["zpp_nape","geom","ZPP_CutInt"],He.get=function(n,e,i,t,l,p,r){null==r&&(r=!1),null==p&&(p=!1);var a;return null==He.zpp_pool?a=new He:(a=He.zpp_pool,He.zpp_pool=a.next,a.next=null),a.virtualint=p,a.end=e,a.start=i,a.path0=t,a.path1=l,a.time=n,a.vertex=r,a},He.prototype={next:null,time:null,virtualint:null,vertex:null,path0:null,end:null,start:null,path1:null,alloc:function(){},free:function(){this.end=this.start=null,this.path0=this.path1=null},__class__:He};var Qe=function(){};l["zpp_nape.geom.ZPP_Cutter"]=Qe,Qe.__name__=["zpp_nape","geom","ZPP_Cutter"],Qe.run=function(n,e,i,t,l,p){var r=0,a=0,s=e.zpp_inner;null!=s._validate&&s._validate(),r=e.zpp_inner.x;var o=e.zpp_inner;null!=o._validate&&o._validate(),a=e.zpp_inner.y;var _=0,h=0,u=i.zpp_inner;null!=u._validate&&u._validate(),_=i.zpp_inner.x-r;var x=i.zpp_inner;null!=x._validate&&x._validate(),h=i.zpp_inner.y-a;for(var d=t?0:-Infinity,v=l?1:Infinity,z=-(a*_-r*h),c=null,m=!1,y=n;;){var f;null==Xe.zpp_pool?f=new Xe:(f=Xe.zpp_pool,Xe.zpp_pool=f.next,f.next=null),f.vert=y,f.posx=f.vert.x,f.posy=f.vert.y,f.value=f.posy*_-f.posx*h+z,f.positive=f.value>0,0==f.value&&(m=!0);var b=f;if(null==c?c=b.prev=b.next=b:(b.prev=c,b.next=c.next,c.next.prev=b,c.next=b),c=b,(y=y.next)==n)break}if(m){var g=null,w=c,M=c;if(null!=w)for(var C=w;;){var k=C;if(0!=k.value){g=k;break}if((C=C.next)==M)break}var O=0,I=0;O=_,I=h;var S=O*O+I*I,P=1/Math.sqrt(S),T=P;O*=T,I*=T;var A=O;O=-I,I=A;for(var E=null,N=g;;)if(0==N.value||null!=E&&N!=E.next){var L=E.value*N.value;if(0!=L){var V,j=E.next;if(L>0)V=E.positive;else{var D=j.next,F=0,R=0;F=j.posx+D.posx,R=j.posy+D.posy;F*=.5,R*=.5;var B=F+1e-8*O,G=R+1e-8*I,Z=!1,U=n,q=n;if(null!=U)for(var Y=U;;){var K=Y,W=K.prev;if(!(G>K.y&&W.y>=G||G>W.y&&K.y>=G)||K.x>B&&W.x>B||B>K.x+(G-K.y)/(W.y-K.y)*(W.x-K.x)&&(Z=!Z),(Y=Y.next)==q)break}V=Z}var J=j,X=N;if(null!=J)for(var H=J;;){var Q=H;if(Q.positive=V,(H=H.next)==X)break}if(E=N,(N=N.next)==g)break}else if((N=N.next)==g)break}else if(E=N,(N=N.next)==g)break;for(;;){if(0!=N.value&&(null==E||N==E.next)){E=N,N=N.next;break}var $=E.value*N.value;if(0==$){N=N.next;break}var nn,en=E.next;if($>0)nn=E.positive;else{var tn=en.next,ln=0,pn=0;ln=en.posx+tn.posx,pn=en.posy+tn.posy;ln*=.5,pn*=.5;var rn=ln+1e-8*O,an=pn+1e-8*I,sn=!1,on=n,_n=n;if(null!=on)for(var hn=on;;){var un=hn,xn=un.prev;if(!(an>un.y&&xn.y>=an||an>xn.y&&un.y>=an)||un.x>rn&&xn.x>rn||rn>un.x+(an-un.y)/(xn.y-un.y)*(xn.x-un.x)&&(sn=!sn),(hn=hn.next)==_n)break}nn=sn}var dn=en,vn=N;if(null!=dn)for(var cn=dn;;){var yn=cn;if(yn.positive=nn,(cn=cn.next)==vn)break}E=N,N=N.next;break}}null==Qe.ints&&(Qe.ints=new pt),null==Qe.paths&&(Qe.paths=new rt);var fn,bn=null,gn=c.posx,wn=c.posy;null==ni.zpp_pool?fn=new ni:(fn=ni.zpp_pool,ni.zpp_pool=fn.next,fn.next=null),fn.forced=!1,fn.x=gn,fn.y=wn;var Mn=fn;null==bn?bn=Mn.prev=Mn.next=Mn:(Mn.next=bn,Mn.prev=bn.prev,bn.prev.next=Mn,bn.prev=Mn);var Cn,kn=bn;null==Xe.zpp_pool?Cn=new Xe:(Cn=Xe.zpp_pool,Xe.zpp_pool=Cn.next,Cn.next=null),Cn.vert=bn,Cn.parent=Cn,Cn.rank=0,Cn.used=!1;var On=Cn;Qe.paths.add(On);for(var In=c;;){var Sn,Pn=In.next,Tn=Pn.posx,An=Pn.posy;null==ni.zpp_pool?Sn=new ni:(Sn=ni.zpp_pool,ni.zpp_pool=Sn.next,Sn.next=null),Sn.forced=!1,Sn.x=Tn,Sn.y=An;var En=Sn;if(In.positive==Pn.positive){var Nn=En;null==bn?bn=Nn.prev=Nn.next=Nn:(Nn.next=bn,Nn.prev=bn.prev,bn.prev.next=Nn,bn.prev=Nn)}else{var Ln=0,Vn=0;Ln=Pn.posx-In.posx,Vn=Pn.posy-In.posy;var jn=h*Ln-_*Vn;jn=1/jn;var Dn=0,Fn=0;Dn=r-In.posx,Fn=a-In.posy;var Rn=(Vn*Dn-Ln*Fn)*jn;if(d>Rn||Rn>v){var Bn,Gn=Qe.ints;null==He.zpp_pool?Bn=new He:(Bn=He.zpp_pool,He.zpp_pool=Bn.next,Bn.next=null),Bn.virtualint=!0,Bn.end=null,Bn.start=null,Bn.path0=null,Bn.path1=null,Bn.time=Rn,Bn.vertex=!1,Gn.add(Bn);var Zn=En;null==bn?bn=Zn.prev=Zn.next=Zn:(Zn.next=bn,Zn.prev=bn.prev,bn.prev.next=Zn,bn.prev=Zn)}else if(0==In.value){var Un=bn.prev;bn=null;var qn,Yn=Un.x,Kn=Un.y;null==ni.zpp_pool?qn=new ni:(qn=ni.zpp_pool,ni.zpp_pool=qn.next,qn.next=null),qn.forced=!1,qn.x=Yn,qn.y=Kn;var Wn=qn;null==bn?bn=Wn.prev=Wn.next=Wn:(Wn.next=bn,Wn.prev=bn.prev,bn.prev.next=Wn,bn.prev=Wn);var Jn=En;null==bn?bn=Jn.prev=Jn.next=Jn:(Jn.next=bn,Jn.prev=bn.prev,bn.prev.next=Jn,bn.prev=Jn);var Xn,Hn=Qe.paths.head.elt,Qn=Qe.paths;null==Xe.zpp_pool?Xn=new Xe:(Xn=Xe.zpp_pool,Xe.zpp_pool=Xn.next,Xn.next=null),Xn.vert=bn,Xn.parent=Xn,Xn.rank=0,Xn.used=!1,Qn.add(Xn);var $n,ne=Qe.paths.head.elt,ee=Qe.ints;null==He.zpp_pool?$n=new He:($n=He.zpp_pool,He.zpp_pool=$n.next,$n.next=null),$n.virtualint=!0,$n.end=Un,$n.start=bn,$n.path0=Hn,$n.path1=ne,$n.time=Rn,$n.vertex=!1,ee.add($n)}else if(0==Pn.value){var ie=En;null==bn?bn=ie.prev=ie.next=ie:(ie.next=bn,ie.prev=bn.prev,bn.prev.next=ie,bn.prev=ie);var te=bn.prev;bn=null;var le,pe=Pn.posx,re=Pn.posy;null==ni.zpp_pool?le=new ni:(le=ni.zpp_pool,ni.zpp_pool=le.next,le.next=null),le.forced=!1,le.x=pe,le.y=re;var ae=le;null==bn?bn=ae.prev=ae.next=ae:(ae.next=bn,ae.prev=bn.prev,bn.prev.next=ae,bn.prev=ae);var se,oe=Qe.paths.head.elt,_e=Qe.paths;null==Xe.zpp_pool?se=new Xe:(se=Xe.zpp_pool,Xe.zpp_pool=se.next,se.next=null),se.vert=bn,se.parent=se,se.rank=0,se.used=!1,_e.add(se);var he,ue=Qe.paths.head.elt,xe=Qe.ints;null==He.zpp_pool?he=new He:(he=He.zpp_pool,He.zpp_pool=he.next,he.next=null),he.virtualint=!0,he.end=te,he.start=bn,he.path0=oe,he.path1=ue,he.time=Rn,he.vertex=!1,xe.add(he)}else{var de=(h*Dn-_*Fn)*jn,ve=0,ze=0;ve=In.posx,ze=In.posy;var ce=de;ve+=Ln*ce,ze+=Vn*ce;var me;null==ni.zpp_pool?me=new ni:(me=ni.zpp_pool,ni.zpp_pool=me.next,me.next=null),me.forced=!1,me.x=ve,me.y=ze;var ye=me;null==bn?bn=ye.prev=ye.next=ye:(ye.next=bn,ye.prev=bn.prev,bn.prev.next=ye,bn.prev=ye);var fe=bn.prev;bn=null;var be;null==ni.zpp_pool?be=new ni:(be=ni.zpp_pool,ni.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=ve,be.y=ze;var ge=be;null==bn?bn=ge.prev=ge.next=ge:(ge.next=bn,ge.prev=bn.prev,bn.prev.next=ge,bn.prev=ge);var we=En;null==bn?bn=we.prev=we.next=we:(we.next=bn,we.prev=bn.prev,bn.prev.next=we,bn.prev=we);var Me,Ce=Qe.paths.head.elt,ke=Qe.paths;null==Xe.zpp_pool?Me=new Xe:(Me=Xe.zpp_pool,Xe.zpp_pool=Me.next,Me.next=null),Me.vert=bn,Me.parent=Me,Me.rank=0,Me.used=!1,ke.add(Me);var Oe,Ie=Qe.paths.head.elt,Se=Qe.ints;null==He.zpp_pool?Oe=new He:(Oe=He.zpp_pool,He.zpp_pool=Oe.next,Oe.next=null),Oe.virtualint=!1,Oe.end=fe,Oe.start=bn,Oe.path0=Ce,Oe.path1=Ie,Oe.time=Rn,Oe.vertex=!1,Se.add(Oe)}}if((In=In.next)==c)break}var Pe=bn.prev;Pe.next.prev=kn.prev,kn.prev.next=Pe.next,Pe.next=kn,kn.prev=Pe;var Te,Ae=Qe.paths.head.elt;if(On==On.parent)Te=On;else{for(var Ee=On,Ne=null;Ee!=Ee.parent;){var Le=Ee.parent;Ee.parent=Ne,Ne=Ee,Ee=Le}for(;null!=Ne;){var Ve=Ne.parent;Ne.parent=Ee,Ne=Ve}Te=Ee}var je;if(Ae==Ae.parent)je=Ae;else{for(var De=Ae,Fe=null;De!=De.parent;){var Re=De.parent;De.parent=Fe,Fe=De,De=Re}for(;null!=Fe;){var Be=Fe.parent;Fe.parent=De,Fe=Be}je=De}Te!=je&&(je.rank>Te.rank?Te.parent=je:Te.rank>je.rank?je.parent=Te:(je.parent=Te,Te.rank++));var Ge=Qe.ints;if(null!=Ge.head&&null!=Ge.head.next){for(var Ze,Ue,qe,Ye=Ge.head,Ke=null,We=null,Je=null,$e=null,ei=1;;){for(Ze=0,We=Ye,Ye=null,Ke=Ye;null!=We;){for(++Ze,Je=We,Ue=0,qe=ei;null!=Je&&ei>Ue;)++Ue,Je=Je.next;for(;Ue>0||qe>0&&null!=Je;)0==Ue?($e=Je,Je=Je.next,--qe):0==qe||null==Je?($e=We,We=We.next,--Ue):Je.elt.time>We.elt.time?($e=We,We=We.next,--Ue):($e=Je,Je=Je.next,--qe),null!=Ke?Ke.next=$e:Ye=$e,Ke=$e;We=Je}if(Ke.next=null,ei<<=1,Ze<=1)break}Ge.head=Ye,Ge.modified=!0,Ge.pushmod=!0}for(;null!=Qe.ints.head;){var ii=Qe.ints.pop_unsafe(),ti=Qe.ints.pop_unsafe();if(ii.virtualint||ti.virtualint){if(ii.virtualint&&!ti.virtualint){var li;if(null!=ti.end&&ti.end.prev==ti.end){ti.end.next=ti.end.prev=null;var pi=ti.end;if(null!=pi.wrap){pi.wrap.zpp_inner._inuse=!1;var ri=pi.wrap,ai=ri.zpp_inner;null!=ai._isimmutable&&ai._isimmutable();var si=ri.zpp_inner;ri.zpp_inner.outer=null,ri.zpp_inner=null;var oi=ri;oi.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=oi:Ml.poolVec2=oi,Ml.nextVec2=oi,oi.zpp_disp=!0;var _i=si;null!=_i.outer&&(_i.outer.zpp_inner=null,_i.outer=null),_i._isimmutable=null,_i._validate=null,_i._invalidate=null,_i.next=Mi.zpp_pool,Mi.zpp_pool=_i,pi.wrap=null}pi.prev=pi.next=null,pi.next=ni.zpp_pool,ni.zpp_pool=pi,li=null}else{var hi=ti.end.prev;ti.end.prev.next=ti.end.next,ti.end.next.prev=ti.end.prev,ti.end.next=ti.end.prev=null;var ui=ti.end;if(null!=ui.wrap){ui.wrap.zpp_inner._inuse=!1;var xi=ui.wrap,di=xi.zpp_inner;null!=di._isimmutable&&di._isimmutable();var vi=xi.zpp_inner;xi.zpp_inner.outer=null,xi.zpp_inner=null;var zi=xi;zi.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=zi:Ml.poolVec2=zi,Ml.nextVec2=zi,zi.zpp_disp=!0;var ci=vi;null!=ci.outer&&(ci.outer.zpp_inner=null,ci.outer=null),ci._isimmutable=null,ci._validate=null,ci._invalidate=null,ci.next=Mi.zpp_pool,Mi.zpp_pool=ci,ui.wrap=null}ui.prev=ui.next=null,ui.next=ni.zpp_pool,ni.zpp_pool=ui,ti.end=null,li=hi}if(ti.end=li,!ti.vertex)if(ti.end!=ti.path0.vert){ti.start.x=ti.end.x,ti.start.y=ti.end.y;var mi;if(null!=ti.end&&ti.end.prev==ti.end){ti.end.next=ti.end.prev=null;var yi=ti.end;if(null!=yi.wrap){yi.wrap.zpp_inner._inuse=!1;var fi=yi.wrap,bi=fi.zpp_inner;null!=bi._isimmutable&&bi._isimmutable();var gi=fi.zpp_inner;fi.zpp_inner.outer=null,fi.zpp_inner=null;var wi=fi;wi.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=wi:Ml.poolVec2=wi,Ml.nextVec2=wi,wi.zpp_disp=!0;var Ci=gi;null!=Ci.outer&&(Ci.outer.zpp_inner=null,Ci.outer=null),Ci._isimmutable=null,Ci._validate=null,Ci._invalidate=null,Ci.next=Mi.zpp_pool,Mi.zpp_pool=Ci,yi.wrap=null}yi.prev=yi.next=null,yi.next=ni.zpp_pool,ni.zpp_pool=yi,mi=null}else{var ki=ti.end.prev;ti.end.prev.next=ti.end.next,ti.end.next.prev=ti.end.prev,ti.end.next=ti.end.prev=null;var Oi=ti.end;if(null!=Oi.wrap){Oi.wrap.zpp_inner._inuse=!1;var Ii=Oi.wrap,Si=Ii.zpp_inner;null!=Si._isimmutable&&Si._isimmutable();var Pi=Ii.zpp_inner;Ii.zpp_inner.outer=null,Ii.zpp_inner=null;var Ti=Ii;Ti.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Ti:Ml.poolVec2=Ti,Ml.nextVec2=Ti,Ti.zpp_disp=!0;var Ai=Pi;null!=Ai.outer&&(Ai.outer.zpp_inner=null,Ai.outer=null),Ai._isimmutable=null,Ai._validate=null,Ai._invalidate=null,Ai.next=Mi.zpp_pool,Mi.zpp_pool=Ai,Oi.wrap=null}Oi.prev=Oi.next=null,Oi.next=ni.zpp_pool,ni.zpp_pool=Oi,ti.end=null,mi=ki}ti.end=mi}else{var Ei=ti.start.next;if(ti.start.x=Ei.x,ti.start.y=Ei.y,null!=Ei&&Ei.prev==Ei){Ei.next=Ei.prev=null;var Ni=Ei;if(null!=Ni.wrap){Ni.wrap.zpp_inner._inuse=!1;var Li=Ni.wrap,Vi=Li.zpp_inner;null!=Vi._isimmutable&&Vi._isimmutable();var ji=Li.zpp_inner;Li.zpp_inner.outer=null,Li.zpp_inner=null;var Di=Li;Di.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Di:Ml.poolVec2=Di,Ml.nextVec2=Di,Di.zpp_disp=!0;var Fi=ji;null!=Fi.outer&&(Fi.outer.zpp_inner=null,Fi.outer=null),Fi._isimmutable=null,Fi._validate=null,Fi._invalidate=null,Fi.next=Mi.zpp_pool,Mi.zpp_pool=Fi,Ni.wrap=null}Ni.prev=Ni.next=null,Ni.next=ni.zpp_pool,ni.zpp_pool=Ni,Ei=null}else{Ei.prev.next=Ei.next,Ei.next.prev=Ei.prev,Ei.next=Ei.prev=null;var Ri=Ei;if(null!=Ri.wrap){Ri.wrap.zpp_inner._inuse=!1;var Bi=Ri.wrap,Gi=Bi.zpp_inner;null!=Gi._isimmutable&&Gi._isimmutable();var Zi=Bi.zpp_inner;Bi.zpp_inner.outer=null,Bi.zpp_inner=null;var Ui=Bi;Ui.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Ui:Ml.poolVec2=Ui,Ml.nextVec2=Ui,Ui.zpp_disp=!0;var qi=Zi;null!=qi.outer&&(qi.outer.zpp_inner=null,qi.outer=null),qi._isimmutable=null,qi._validate=null,qi._invalidate=null,qi.next=Mi.zpp_pool,Mi.zpp_pool=qi,Ri.wrap=null}Ri.prev=Ri.next=null,Ri.next=ni.zpp_pool,ni.zpp_pool=Ri}}ti.end.next.prev=ti.start.prev,ti.start.prev.next=ti.end.next,ti.end.next=ti.start,ti.start.prev=ti.end;var Yi;if(ti.path0==ti.path0.parent)Yi=ti.path0;else{for(var Ki=ti.path0,Wi=null;Ki!=Ki.parent;){var Ji=Ki.parent;Ki.parent=Wi,Wi=Ki,Ki=Ji}for(;null!=Wi;){var Xi=Wi.parent;Wi.parent=Ki,Wi=Xi}Yi=Ki}var Hi;if(ti.path1==ti.path1.parent)Hi=ti.path1;else{for(var Qi=ti.path1,$i=null;Qi!=Qi.parent;){var nt=Qi.parent;Qi.parent=$i,$i=Qi,Qi=nt}for(;null!=$i;){var et=$i.parent;$i.parent=Qi,$i=et}Hi=Qi}Yi!=Hi&&(Hi.rank>Yi.rank?Yi.parent=Hi:Yi.rank>Hi.rank?Hi.parent=Yi:(Hi.parent=Yi,Yi.rank++))}else if(ti.virtualint&&!ii.virtualint){var it;if(null!=ii.end&&ii.end.prev==ii.end){ii.end.next=ii.end.prev=null;var tt=ii.end;if(null!=tt.wrap){tt.wrap.zpp_inner._inuse=!1;var lt=tt.wrap,at=lt.zpp_inner;null!=at._isimmutable&&at._isimmutable();var st=lt.zpp_inner;lt.zpp_inner.outer=null,lt.zpp_inner=null;var ot=lt;ot.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=ot:Ml.poolVec2=ot,Ml.nextVec2=ot,ot.zpp_disp=!0;var _t=st;null!=_t.outer&&(_t.outer.zpp_inner=null,_t.outer=null),_t._isimmutable=null,_t._validate=null,_t._invalidate=null,_t.next=Mi.zpp_pool,Mi.zpp_pool=_t,tt.wrap=null}tt.prev=tt.next=null,tt.next=ni.zpp_pool,ni.zpp_pool=tt,it=null}else{var ht=ii.end.prev;ii.end.prev.next=ii.end.next,ii.end.next.prev=ii.end.prev,ii.end.next=ii.end.prev=null;var ut=ii.end;if(null!=ut.wrap){ut.wrap.zpp_inner._inuse=!1;var xt=ut.wrap,dt=xt.zpp_inner;null!=dt._isimmutable&&dt._isimmutable();var vt=xt.zpp_inner;xt.zpp_inner.outer=null,xt.zpp_inner=null;var zt=xt;zt.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=zt:Ml.poolVec2=zt,Ml.nextVec2=zt,zt.zpp_disp=!0;var ct=vt;null!=ct.outer&&(ct.outer.zpp_inner=null,ct.outer=null),ct._isimmutable=null,ct._validate=null,ct._invalidate=null,ct.next=Mi.zpp_pool,Mi.zpp_pool=ct,ut.wrap=null}ut.prev=ut.next=null,ut.next=ni.zpp_pool,ni.zpp_pool=ut,ii.end=null,it=ht}if(ii.end=it,!ii.vertex)if(ii.end!=ii.path0.vert){ii.start.x=ii.end.x,ii.start.y=ii.end.y;var mt;if(null!=ii.end&&ii.end.prev==ii.end){ii.end.next=ii.end.prev=null;var yt=ii.end;if(null!=yt.wrap){yt.wrap.zpp_inner._inuse=!1;var ft=yt.wrap,bt=ft.zpp_inner;null!=bt._isimmutable&&bt._isimmutable();var gt=ft.zpp_inner;ft.zpp_inner.outer=null,ft.zpp_inner=null;var wt=ft;wt.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=wt:Ml.poolVec2=wt,Ml.nextVec2=wt,wt.zpp_disp=!0;var Mt=gt;null!=Mt.outer&&(Mt.outer.zpp_inner=null,Mt.outer=null),Mt._isimmutable=null,Mt._validate=null,Mt._invalidate=null,Mt.next=Mi.zpp_pool,Mi.zpp_pool=Mt,yt.wrap=null}yt.prev=yt.next=null,yt.next=ni.zpp_pool,ni.zpp_pool=yt,mt=null}else{var Ct=ii.end.prev;ii.end.prev.next=ii.end.next,ii.end.next.prev=ii.end.prev,ii.end.next=ii.end.prev=null;var kt=ii.end;if(null!=kt.wrap){kt.wrap.zpp_inner._inuse=!1;var Ot=kt.wrap,It=Ot.zpp_inner;null!=It._isimmutable&&It._isimmutable();var St=Ot.zpp_inner;Ot.zpp_inner.outer=null,Ot.zpp_inner=null;var Pt=Ot;Pt.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Pt:Ml.poolVec2=Pt,Ml.nextVec2=Pt,Pt.zpp_disp=!0;var Tt=St;null!=Tt.outer&&(Tt.outer.zpp_inner=null,Tt.outer=null),Tt._isimmutable=null,Tt._validate=null,Tt._invalidate=null,Tt.next=Mi.zpp_pool,Mi.zpp_pool=Tt,kt.wrap=null}kt.prev=kt.next=null,kt.next=ni.zpp_pool,ni.zpp_pool=kt,ii.end=null,mt=Ct}ii.end=mt}else{var At=ii.start.next;if(ii.start.x=At.x,ii.start.y=At.y,null!=At&&At.prev==At){At.next=At.prev=null;var Et=At;if(null!=Et.wrap){Et.wrap.zpp_inner._inuse=!1;var Nt=Et.wrap,Lt=Nt.zpp_inner;null!=Lt._isimmutable&&Lt._isimmutable();var Vt=Nt.zpp_inner;Nt.zpp_inner.outer=null,Nt.zpp_inner=null;var jt=Nt;jt.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=jt:Ml.poolVec2=jt,Ml.nextVec2=jt,jt.zpp_disp=!0;var Dt=Vt;null!=Dt.outer&&(Dt.outer.zpp_inner=null,Dt.outer=null),Dt._isimmutable=null,Dt._validate=null,Dt._invalidate=null,Dt.next=Mi.zpp_pool,Mi.zpp_pool=Dt,Et.wrap=null}Et.prev=Et.next=null,Et.next=ni.zpp_pool,ni.zpp_pool=Et,At=null}else{At.prev.next=At.next,At.next.prev=At.prev,At.next=At.prev=null;var Ft=At;if(null!=Ft.wrap){Ft.wrap.zpp_inner._inuse=!1;var Rt=Ft.wrap,Bt=Rt.zpp_inner;null!=Bt._isimmutable&&Bt._isimmutable();var Gt=Rt.zpp_inner;Rt.zpp_inner.outer=null,Rt.zpp_inner=null;var Zt=Rt;Zt.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=Zt:Ml.poolVec2=Zt,Ml.nextVec2=Zt,Zt.zpp_disp=!0;var Ut=Gt;null!=Ut.outer&&(Ut.outer.zpp_inner=null,Ut.outer=null),Ut._isimmutable=null,Ut._validate=null,Ut._invalidate=null,Ut.next=Mi.zpp_pool,Mi.zpp_pool=Ut,Ft.wrap=null}Ft.prev=Ft.next=null,Ft.next=ni.zpp_pool,ni.zpp_pool=Ft}}ii.end.next.prev=ii.start.prev,ii.start.prev.next=ii.end.next,ii.end.next=ii.start,ii.start.prev=ii.end;var qt;if(ii.path0==ii.path0.parent)qt=ii.path0;else{for(var Yt=ii.path0,Kt=null;Yt!=Yt.parent;){var Wt=Yt.parent;Yt.parent=Kt,Kt=Yt,Yt=Wt}for(;null!=Kt;){var Jt=Kt.parent;Kt.parent=Yt,Kt=Jt}qt=Yt}var Xt;if(ii.path1==ii.path1.parent)Xt=ii.path1;else{for(var Ht=ii.path1,Qt=null;Ht!=Ht.parent;){var $t=Ht.parent;Ht.parent=Qt,Qt=Ht,Ht=$t}for(;null!=Qt;){var nl=Qt.parent;Qt.parent=Ht,Qt=nl}Xt=Ht}qt!=Xt&&(Xt.rank>qt.rank?qt.parent=Xt:qt.rank>Xt.rank?Xt.parent=qt:(Xt.parent=qt,qt.rank++))}}else{ii.end.next.prev=ti.start.prev,ti.start.prev.next=ii.end.next,ii.end.next=ti.start,ti.start.prev=ii.end,ti.end.next.prev=ii.start.prev,ii.start.prev.next=ti.end.next,ti.end.next=ii.start,ii.start.prev=ti.end;var el;if(ii.path0==ii.path0.parent)el=ii.path0;else{for(var il=ii.path0,tl=null;il!=il.parent;){var ll=il.parent;il.parent=tl,tl=il,il=ll}for(;null!=tl;){var pl=tl.parent;tl.parent=il,tl=pl}el=il}var rl;if(ti.path1==ti.path1.parent)rl=ti.path1;else{for(var al=ti.path1,sl=null;al!=al.parent;){var ol=al.parent;al.parent=sl,sl=al,al=ol}for(;null!=sl;){var _l=sl.parent;sl.parent=al,sl=_l}rl=al}el!=rl&&(rl.rank>el.rank?el.parent=rl:el.rank>rl.rank?rl.parent=el:(rl.parent=el,el.rank++));var hl;if(ii.path1==ii.path1.parent)hl=ii.path1;else{for(var ul=ii.path1,xl=null;ul!=ul.parent;){var dl=ul.parent;ul.parent=xl,xl=ul,ul=dl}for(;null!=xl;){var vl=xl.parent;xl.parent=ul,xl=vl}hl=ul}var zl;if(ti.path0==ti.path0.parent)zl=ti.path0;else{for(var cl=ti.path0,ml=null;cl!=cl.parent;){var yl=cl.parent;cl.parent=ml,ml=cl,cl=yl}for(;null!=ml;){var fl=ml.parent;ml.parent=cl,ml=fl}zl=cl}hl!=zl&&(zl.rank>hl.rank?hl.parent=zl:hl.rank>zl.rank?zl.parent=hl:(zl.parent=hl,hl.rank++))}var bl=ii;bl.end=bl.start=null,bl.path0=bl.path1=null,bl.next=He.zpp_pool,He.zpp_pool=bl;var gl=ti;gl.end=gl.start=null,gl.path0=gl.path1=null,gl.next=He.zpp_pool,He.zpp_pool=gl}for(var wl=null==p?new mn:p,Cl=Qe.paths.head;null!=Cl;){var kl,Ol=Cl.elt;if(Ol==Ol.parent)kl=Ol;else{for(var Il=Ol,Sl=null;Il!=Il.parent;){var Pl=Il.parent;Il.parent=Sl,Sl=Il,Il=Pl}for(;null!=Sl;){var Tl=Sl.parent;Sl.parent=Il,Sl=Tl}kl=Il}if(kl.used)Cl=Cl.next;else{kl.used=!0;for(var Al=kl.vert,El=!0;null!=kl.vert&&(El||Al!=kl.vert);)if(El=!1,Al.x==Al.next.x&&Al.y==Al.next.y)if(Al==kl.vert&&(kl.vert=Al.next==Al?null:Al.next,El=!0),null!=Al&&Al.prev==Al)Al.next=Al.prev=null,Al=null,Al=Al;else{var Nl=Al.next;Al.prev.next=Al.next,Al.next.prev=Al.prev,Al.next=Al.prev=null,Al=null,Al=Nl}else Al=Al.next;if(null!=kl.vert){var Ll=zn.get();Ll.zpp_inner.vertices=kl.vert,wl.zpp_inner.reverse_flag?wl.push(Ll):wl.unshift(Ll)}Cl=Cl.next}}for(;null!=Qe.paths.head;){var Vl=Qe.paths.pop_unsafe(),jl=Vl;jl.vert=null,jl.parent=null,jl.next=Xe.zpp_pool,Xe.zpp_pool=jl}for(;null!=c;)if(null!=c&&c.prev==c){c.next=c.prev=null;var Dl=c;Dl.vert=null,Dl.parent=null,Dl.next=Xe.zpp_pool,Xe.zpp_pool=Dl,c=null,c=c}else{var Fl=c.next;c.prev.next=c.next,c.next.prev=c.prev,c.next=c.prev=null;var Rl=c;Rl.vert=null,Rl.parent=null,Rl.next=Xe.zpp_pool,Xe.zpp_pool=Rl,c=null,c=Fl}return wl};var $e=function(){};l["zpp_nape.geom.ZPP_Geom"]=$e,$e.__name__=["zpp_nape","geom","ZPP_Geom"],$e.validateShape=function(n){if(n.type==me.id_ShapeType_POLYGON){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var i=e.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var t=e.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var l=e.lverts.next,p=e.gverts.next;null!=p;){var r=p,a=l;l=l.next,r.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),r.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),p=p.next}}var s=e.edges.head,o=e.gverts.next,_=o;for(o=o.next;null!=o;){var h=o,u=s.elt;s=s.next,u.gp0=_,u.gp1=h,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,_=h,o=o.next}var x=e.gverts.next,d=s.elt;s=s.next,d.gp0=_,d.gp1=x,d.gnormx=e.body.axisy*d.lnormx-e.body.axisx*d.lnormy,d.gnormy=d.lnormx*e.body.axisx+d.lnormy*e.body.axisy,d.gprojection=e.body.posx*d.gnormx+e.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var v=n.circle;if(v.zip_worldCOM&&null!=v.body){if(v.zip_worldCOM=!1,v.zip_localCOM){if(v.zip_localCOM=!1,v.type==me.id_ShapeType_POLYGON){var z=v.polygon;if(null==z.lverts.next.next)z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y;else if(null==z.lverts.next.next.next){z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y;z.localCOMx+=1*z.lverts.next.next.x,z.localCOMy+=1*z.lverts.next.next.y;z.localCOMx*=.5,z.localCOMy*=.5}else{z.localCOMx=0,z.localCOMy=0;var c=0,m=z.lverts.next,y=m;m=m.next;var f=m;for(m=m.next;null!=m;){var b=m;c+=f.x*(b.y-y.y);var g=b.y*f.x-b.x*f.y;z.localCOMx+=(f.x+b.x)*g,z.localCOMy+=(f.y+b.y)*g,y=f,f=b,m=m.next}m=z.lverts.next;var w=m;c+=f.x*(w.y-y.y);var M=w.y*f.x-w.x*f.y;z.localCOMx+=(f.x+w.x)*M,z.localCOMy+=(f.y+w.y)*M,y=f,f=w,m=m.next;var C=m;c+=f.x*(C.y-y.y);var k=C.y*f.x-C.x*f.y;z.localCOMx+=(f.x+C.x)*k,z.localCOMy+=(f.y+C.y)*k,c=1/(3*c);var O=c;z.localCOMx*=O,z.localCOMy*=O}}null!=v.wrap_localCOM&&(v.wrap_localCOM.zpp_inner.x=v.localCOMx,v.wrap_localCOM.zpp_inner.y=v.localCOMy)}var I=v.body;I.zip_axis&&(I.zip_axis=!1,I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)),v.worldCOMx=v.body.posx+(v.body.axisy*v.localCOMx-v.body.axisx*v.localCOMy),v.worldCOMy=v.body.posy+(v.localCOMx*v.body.axisx+v.localCOMy*v.body.axisy)}var S=v.radius,P=v.radius;v.aabb.minx=v.worldCOMx-S,v.aabb.miny=v.worldCOMy-P,v.aabb.maxx=v.worldCOMx+S,v.aabb.maxy=v.worldCOMy+P}else{var T=n.polygon;if(T.zip_gverts&&null!=T.body){T.zip_gverts=!1,T.validate_lverts();var A=T.body;A.zip_axis&&(A.zip_axis=!1,A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot));for(var E=T.lverts.next,N=T.gverts.next;null!=N;){var L=N,V=E;E=E.next,L.x=T.body.posx+(T.body.axisy*V.x-T.body.axisx*V.y),L.y=T.body.posy+(V.x*T.body.axisx+V.y*T.body.axisy),N=N.next}}var j=T.gverts.next;T.aabb.minx=j.x,T.aabb.miny=j.y,T.aabb.maxx=j.x,T.aabb.maxy=j.y;for(var D=T.gverts.next.next;null!=D;){var F=D;T.aabb.minx>F.x&&(T.aabb.minx=F.x),F.x>T.aabb.maxx&&(T.aabb.maxx=F.x),T.aabb.miny>F.y&&(T.aabb.miny=F.y),F.y>T.aabb.maxy&&(T.aabb.maxy=F.y),D=D.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var R=n.polygon;if(null==R.lverts.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;else if(null==R.lverts.next.next.next){R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;R.localCOMx+=1*R.lverts.next.next.x,R.localCOMy+=1*R.lverts.next.next.y;R.localCOMx*=.5,R.localCOMy*=.5}else{R.localCOMx=0,R.localCOMy=0;var B=0,G=R.lverts.next,Z=G;G=G.next;var U=G;for(G=G.next;null!=G;){var q=G;B+=U.x*(q.y-Z.y);var Y=q.y*U.x-q.x*U.y;R.localCOMx+=(U.x+q.x)*Y,R.localCOMy+=(U.y+q.y)*Y,Z=U,U=q,G=G.next}G=R.lverts.next;var K=G;B+=U.x*(K.y-Z.y);var W=K.y*U.x-K.x*U.y;R.localCOMx+=(U.x+K.x)*W,R.localCOMy+=(U.y+K.y)*W,Z=U,U=K,G=G.next;var J=G;B+=U.x*(J.y-Z.y);var X=J.y*U.x-J.x*U.y;R.localCOMx+=(U.x+J.x)*X,R.localCOMy+=(U.y+J.y)*X,B=1/(3*B);var H=B;R.localCOMx*=H,R.localCOMy*=H}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var Q=n.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}};var ni=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};l["zpp_nape.geom.ZPP_GeomVert"]=ni,ni.__name__=["zpp_nape","geom","ZPP_GeomVert"],ni.get=function(n,e){var i;return null==ni.zpp_pool?i=new ni:(i=ni.zpp_pool,ni.zpp_pool=i.next,i.next=null),i.forced=!1,i.x=n,i.y=e,i},ni.prototype={x:null,y:null,prev:null,next:null,wrap:null,forced:null,free:function(){if(null!=this.wrap){this.wrap.zpp_inner._inuse=!1;var n=this.wrap,e=n.zpp_inner;null!=e._isimmutable&&e._isimmutable();var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var t=n;t.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=t:Ml.poolVec2=t,Ml.nextVec2=t,t.zpp_disp=!0;var l=i;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,this.wrap=null}this.prev=this.next=null},alloc:function(){this.forced=!1},wrapper:function(){if(null==this.wrap){var n,e=this.x,t=this.y;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap=n,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=i(this,this.modwrap),this.wrap.zpp_inner._validate=i(this,this.getwrap)}return this.wrap},modwrap:function(n){this.x=n.x,this.y=n.y},getwrap:function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},__class__:ni};var ei=function(n){this.vertices=null,this.outer=null,this.outer=n};l["zpp_nape.geom.ZPP_GeomPoly"]=ei,ei.__name__=["zpp_nape","geom","ZPP_GeomPoly"],ei.prototype={outer:null,vertices:null,__class__:ei};var ii=function Wl(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,Wl.internal=!0,this.outer=new yn,Wl.internal=!1};l["zpp_nape.geom.ZPP_GeomVertexIterator"]=ii,ii.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],ii.get=function(n,e){var i;return null==ii.zpp_pool?i=new ii:(i=ii.zpp_pool,ii.zpp_pool=i.next,i.next=null),i.outer.zpp_inner=i,i.ptr=n,i.forward=e,i.start=n,i.first=null!=n,i.outer},ii.prototype={ptr:null,start:null,first:null,forward:null,outer:null,next:null,free:function(){this.outer.zpp_inner=null,this.ptr=this.start=null},alloc:function(){},__class__:ii};var ti=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};l["zpp_nape.geom.ZPP_MarchSpan"]=ti,ti.__name__=["zpp_nape","geom","ZPP_MarchSpan"],ti.prototype={parent:null,rank:null,out:null,next:null,free:function(){this.parent=this},alloc:function(){this.out=!1,this.rank=0},__class__:ti};var li=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};l["zpp_nape.geom.ZPP_MarchPair"]=li,li.__name__=["zpp_nape","geom","ZPP_MarchPair"],li.prototype={p1:null,key1:null,okey1:null,p2:null,key2:null,okey2:null,pr:null,keyr:null,okeyr:null,pd:null,span1:null,span2:null,spanr:null,next:null,free:function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},alloc:function(){},__class__:li};var pi=function(){};l["zpp_nape.geom.ZPP_MarchingSquares"]=pi,pi.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],pi.isos=null,pi.ints=null,pi.map=null,pi.run=function(n,e,i,t,l,p,r,a,s){var o=p.zpp_inner;null!=o._validate&&o._validate();var _=(t-e)/p.zpp_inner.x,h=0|_,u=p.zpp_inner;null!=u._validate&&u._validate();var x=(l-i)/p.zpp_inner.y,d=0|x;_!=h&&++h,x!=d&&++d,a&&(null==pi.map?pi.map=new Xi(h,d):pi.map.resize(h,d,null)),null==pi.isos?pi.isos=new Wi(h+1,d+1):pi.isos.resize(h+1,d+1,0);for(var v=0,z=d+1;z>v;){var c,m=v++;if(0==m)c=i;else if(d<m)c=l;else{var y=p.zpp_inner;null!=y._validate&&y._validate(),c=i+p.zpp_inner.y*m}for(var f=0,b=h+1;b>f;){var g,w=f++;if(0==w)g=e;else if(h<w)g=t;else{var M=p.zpp_inner;null!=M._validate&&M._validate(),g=e+p.zpp_inner.x*w}var C=pi.isos;C.list[m*C.width+w]=n(g,c)}}null==pi.ints?pi.ints=new Ji(h+1,1+(d<<1)):pi.ints.resize(h+1,1+(d<<1),null);var k=null;a&&(null==ti.zpp_pool?k=new ti:(k=ti.zpp_pool,ti.zpp_pool=k.next,k.next=null),k.out=!1,k.rank=0);for(var O=i,I=0,S=d;S>I;){var P,T=I++,A=O;if(T==d-1)P=l;else{var E=p.zpp_inner;null!=E._validate&&E._validate(),P=i+p.zpp_inner.y*(T+1)}O=P;for(var N=e,L=null,V=0,j=h;j>V;){var D,F=V++,R=N;if(F==h-1)D=t;else{var B=p.zpp_inner;null!=B._validate&&B._validate(),D=e+p.zpp_inner.x*(F+1)}N=D;var G=0==F||!a,Z=0==T||!a,U=F==h-1||!a,q=T==d-1||!a,Y=pi.me.marchSquare(n,pi.isos,pi.ints,R,A,D,P,F,T,G,Z,U,q,r);if(null!=Y)if(a){var K=null!=Y.p2&&14!=Y.okey2?Y.p2:Y.p1;Y.pd=0==(128&(K==Y.p2?Y.okey2:Y.okey1))?K.prev:K.prev.prev;var W=pi.map;W.list[T*W.width+F]=Y;var J;if(null!=L){var X=Y.key1,H=1&X|(192&X)>>5,Q=0;0!=(1&H)&&++Q,0!=(2&H)&&++Q,0!=(4&H)&&++Q,J=Q>=2}else J=!1;if(J)pi.me.combLR(L,Y),Y.span1=L.spanr;else{null==ti.zpp_pool?Y.span1=new ti:(Y.span1=ti.zpp_pool,ti.zpp_pool=Y.span1.next,Y.span1.next=null);var $=Y.span1;$.out=!1,$.rank=0,Y.span1.next=k,k=Y.span1}if(null!=Y.p2){null==ti.zpp_pool?Y.span2=new ti:(Y.span2=ti.zpp_pool,ti.zpp_pool=Y.span2.next,Y.span2.next=null);var nn=Y.span2;nn.out=!1,nn.rank=0,Y.span2.next=k,k=Y.span2,Y.spanr=Y.span2}else Y.spanr=Y.span1;var en=(28&Y.keyr)>>2,tn=0;0!=(1&en)&&++tn,0!=(2&en)&&++tn,0!=(4&en)&&++tn,L=2>tn?null:Y}else{pi.me.output(s,Y.p1),null!=Y.p2&&pi.me.output(s,Y.p2);var ln=Y;ln.p1=ln.p2=ln.pr=ln.pd=null,ln.span1=ln.span2=ln.spanr=null,ln.next=li.zpp_pool,li.zpp_pool=ln}else L=null}}if(a){for(var pn=1,rn=d;rn>pn;)for(var an=pn++,sn=null,on=0,_n=h;_n>on;){var hn=on++,un=pi.map,xn=un.list[an*un.width+hn];if(null!=xn){var dn=null!=xn.p2&&14==xn.okey2?xn.okey2:xn.okey1,vn=7&dn,zn=0;if(0!=(1&vn)&&++zn,0!=(2&vn)&&++zn,0!=(4&vn)&&++zn,2>zn)sn=null;else{var cn=pi.map,mn=cn.list[(an-1)*cn.width+hn];if(null!=mn){var yn=null!=mn.p2&&56==mn.okey2?mn.okey2:mn.okey1,fn=(112&yn)>>4,bn=0;if(0!=(1&fn)&&++bn,0!=(2&fn)&&++bn,0!=(4&fn)&&++bn,2>bn)sn=null;else{var gn,wn=null!=mn.p2&&56==mn.okey2?mn.span2:mn.span1,Mn=null!=xn.p2&&14==xn.okey2?xn.span2:xn.span1;if(wn==wn.parent)gn=wn;else{for(var Cn=wn,kn=null;Cn!=Cn.parent;){var On=Cn.parent;Cn.parent=kn,kn=Cn,Cn=On}for(;null!=kn;){var In=kn.parent;kn.parent=Cn,kn=In}gn=Cn}var Sn;if(Mn==Mn.parent)Sn=Mn;else{for(var Pn=Mn,Tn=null;Pn!=Pn.parent;){var An=Pn.parent;Pn.parent=Tn,Tn=Pn,Pn=An}for(;null!=Tn;){var En=Tn.parent;Tn.parent=Pn,Tn=En}Sn=Pn}if(gn==Sn)sn!=Mn&&pi.me.combUD_virtual(mn,xn);else{var Nn;if(wn==wn.parent)Nn=wn;else{for(var Ln=wn,Vn=null;Ln!=Ln.parent;){var jn=Ln.parent;Ln.parent=Vn,Vn=Ln,Ln=jn}for(;null!=Vn;){var Dn=Vn.parent;Vn.parent=Ln,Vn=Dn}Nn=Ln}var Fn;if(Mn==Mn.parent)Fn=Mn;else{for(var Rn=Mn,Bn=null;Rn!=Rn.parent;){var Gn=Rn.parent;Rn.parent=Bn,Bn=Rn,Rn=Gn}for(;null!=Bn;){var Zn=Bn.parent;Bn.parent=Rn,Bn=Zn}Fn=Rn}Nn!=Fn&&(Fn.rank>Nn.rank?Nn.parent=Fn:Nn.rank>Fn.rank?Fn.parent=Nn:(Fn.parent=Nn,Nn.rank++)),pi.me.combUD(mn,xn)}var Un=Mn==xn.span2?xn.okey2:xn.okey1;sn=0!=(4&Un)?Mn:null}}else sn=null}}else sn=null}for(var qn=0,Yn=d;Yn>qn;)for(var Kn=qn++,Wn=0,Jn=h;Jn>Wn;){var Xn=Wn++,Hn=pi.map,Qn=Hn.list[Kn*Hn.width+Xn];if(null!=Qn){var $n;if(Qn.span1==Qn.span1.parent)$n=Qn.span1;else{for(var ne=Qn.span1,ee=null;ne!=ne.parent;){var ie=ne.parent;ne.parent=ee,ee=ne,ne=ie}for(;null!=ee;){var te=ee.parent;ee.parent=ne,ee=te}$n=ne}if($n.out||($n.out=!0,pi.me.output(s,Qn.p1)),null!=Qn.p2){if(Qn.span2==Qn.span2.parent)$n=Qn.span2;else{for(var le=Qn.span2,pe=null;le!=le.parent;){var re=le.parent;le.parent=pe,pe=le,le=re}for(;null!=pe;){var ae=pe.parent;pe.parent=le,pe=ae}$n=le}$n.out||($n.out=!0,pi.me.output(s,Qn.p2))}var se=Qn;se.p1=se.p2=se.pr=se.pd=null,se.span1=se.span2=se.spanr=null,se.next=li.zpp_pool,li.zpp_pool=se;var oe=pi.map;oe.list[Kn*oe.width+Xn]=null}}for(;null!=k;){var _e=k;k=_e.next;var he=_e;he.parent=he,he.next=ti.zpp_pool,ti.zpp_pool=he}}},pi.ISO=function(n,e,i){return n(e,i)},pi.prototype={output:function(n,e){var i;if(null==e||e.next==e||e.next==e.prev)i=!0;else{var t=0,l=e,p=e;if(null!=l)for(var r=l;;){var a=r;if(t+=a.x*(a.next.y-a.prev.y),(r=r.next)==p)break}var s=.5*t;i=y.epsilon*y.epsilon>s*s}if(i)for(;null!=e;)if(null!=e&&e.prev==e)e.next=e.prev=null,e=null,e=e;else{var o=e.next;e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,e=null,e=o}else{var _=zn.get();_.zpp_inner.vertices=e,n.zpp_inner.reverse_flag?n.push(_):n.unshift(_)}},linkright:function(n,e){var i=7&e;return 0==i?n:3==i?n.next.next:n.next},linkleft:function(n,e){return 0==(1&e)?n.prev:n},linkdown:function(n,e){return 0==(128&e)?n.prev:n.prev.prev},linkup:function(n,e){return n},combLR:function(n,e){var i=n.pr,t=7&n.okeyr,l=0==t?i:3==t?i.next.next:i.next,p=e.p1,r=0==(1&e.okey1)?p.prev:p,a=l.next,s=r.prev;if(0!=(4&n.keyr)){e.pr==e.p1&&(e.pr=l.prev),e.p1=l.prev,l.prev.next=r.next,r.next.prev=l.prev;var o=l;if(null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var _=o.wrap,h=_.zpp_inner;null!=h._isimmutable&&h._isimmutable();var u=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null;var x=_;x.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=x:Ml.poolVec2=x,Ml.nextVec2=x,x.zpp_disp=!0;var d=u;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=Mi.zpp_pool,Mi.zpp_pool=d,o.wrap=null}o.prev=o.next=null,o.next=ni.zpp_pool,ni.zpp_pool=o}else l.next=r.next,r.next.prev=l;var v=r;if(null!=v.wrap){v.wrap.zpp_inner._inuse=!1;var z=v.wrap,c=z.zpp_inner;null!=c._isimmutable&&c._isimmutable();var m=z.zpp_inner;z.zpp_inner.outer=null,z.zpp_inner=null;var y=z;y.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=y:Ml.poolVec2=y,Ml.nextVec2=y,y.zpp_disp=!0;var f=m;null!=f.outer&&(f.outer.zpp_inner=null,f.outer=null),f._isimmutable=null,f._validate=null,f._invalidate=null,f.next=Mi.zpp_pool,Mi.zpp_pool=f,v.wrap=null}if(v.prev=v.next=null,v.next=ni.zpp_pool,ni.zpp_pool=v,0!=(16&n.keyr)){e.pd=a.next,a.next.prev=s.prev,s.prev.next=a.next;var b=a;if(null!=b.wrap){b.wrap.zpp_inner._inuse=!1;var g=b.wrap,w=g.zpp_inner;null!=w._isimmutable&&w._isimmutable();var M=g.zpp_inner;g.zpp_inner.outer=null,g.zpp_inner=null;var C=g;C.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=C:Ml.poolVec2=C,Ml.nextVec2=C,C.zpp_disp=!0;var k=M;null!=k.outer&&(k.outer.zpp_inner=null,k.outer=null),k._isimmutable=null,k._validate=null,k._invalidate=null,k.next=Mi.zpp_pool,Mi.zpp_pool=k,b.wrap=null}b.prev=b.next=null,b.next=ni.zpp_pool,ni.zpp_pool=b}else a.prev=s.prev,s.prev.next=a;var O=s;if(null!=O.wrap){O.wrap.zpp_inner._inuse=!1;var I=O.wrap,S=I.zpp_inner;null!=S._isimmutable&&S._isimmutable();var P=I.zpp_inner;I.zpp_inner.outer=null,I.zpp_inner=null;var T=I;T.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=T:Ml.poolVec2=T,Ml.nextVec2=T,T.zpp_disp=!0;var A=P;null!=A.outer&&(A.outer.zpp_inner=null,A.outer=null),A._isimmutable=null,A._validate=null,A._invalidate=null,A.next=Mi.zpp_pool,Mi.zpp_pool=A,O.wrap=null}O.prev=O.next=null,O.next=ni.zpp_pool,ni.zpp_pool=O},combUD:function(n,e){var i=null!=e.p2&&14==e.key2?e.p2:e.p1,t=n.pd,l=i,p=t.prev,r=l.next;l.next=t.next,t.next.prev=l;var a=t;if(null!=a.wrap){a.wrap.zpp_inner._inuse=!1;var s=a.wrap,o=s.zpp_inner;null!=o._isimmutable&&o._isimmutable();var _=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null;var h=s;h.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=h:Ml.poolVec2=h,Ml.nextVec2=h,h.zpp_disp=!0;var u=_;null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u,a.wrap=null}a.prev=a.next=null,a.next=ni.zpp_pool,ni.zpp_pool=a,r.prev=p.prev,p.prev.next=r,p==n.p1&&(n.p1=r);var x=p;if(null!=x.wrap){x.wrap.zpp_inner._inuse=!1;var d=x.wrap,v=d.zpp_inner;null!=v._isimmutable&&v._isimmutable();var z=d.zpp_inner;d.zpp_inner.outer=null,d.zpp_inner=null;var c=d;c.zpp_pool=null,null!=Ml.nextVec2?Ml.nextVec2.zpp_pool=c:Ml.poolVec2=c,Ml.nextVec2=c,c.zpp_disp=!0;var m=z;null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=Mi.zpp_pool,Mi.zpp_pool=m,x.wrap=null}x.prev=x.next=null,x.next=ni.zpp_pool,ni.zpp_pool=x},combUD_virtual:function(n,e){var i=null!=e.p2&&14==e.key2?e.p2:e.p1,t=n.pd,l=i;t.forced=l.forced=t.prev.forced=l.next.forced=!0},combLeft:function(n){var e=1&n|(192&n)>>5,i=0;return 0!=(1&e)&&++i,0!=(2&e)&&++i,0!=(4&e)&&++i,i>=2},combRight:function(n){var e=(28&n)>>2,i=0;return 0!=(1&e)&&++i,0!=(2&e)&&++i,0!=(4&e)&&++i,i>=2},combUp:function(n){var e=7&n,i=0;return 0!=(1&e)&&++i,0!=(2&e)&&++i,0!=(4&e)&&++i,i>=2},combDown:function(n){var e=(112&n)>>4,i=0;return 0!=(1&e)&&++i,0!=(2&e)&&++i,0!=(4&e)&&++i,i>=2},comb:function(n){var e=0;return 0!=(1&n)&&++e,0!=(2&n)&&++e,0!=(4&n)&&++e,e>=2},marchSquare:function(n,e,i,t,l,p,r,a,s,o,_,h,u,x){var d=0,v=e.list[s*e.width+a];0>v&&(d|=8);var z=e.list[s*e.width+(a+1)];0>z&&(d|=4);var c=e.list[(s+1)*e.width+(a+1)];0>c&&(d|=2);var m=e.list[(s+1)*e.width+a];if(0>m&&(d|=1),0==d)return null;var y;if(null==li.zpp_pool?y=new li:(y=li.zpp_pool,li.zpp_pool=y.next,y.next=null),10!=d&&5!=d){var f=pi.look_march[d];y.okey1=f;for(var b=0;8>b;){var g=b++;if(0!=(f&1<<g)){var w=null;if(0==g){var M;null==ni.zpp_pool?M=new ni:(M=ni.zpp_pool,ni.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=t,M.y=l,w=M,(o||_)&&(w.forced=!0)}else if(2==g){var C;null==ni.zpp_pool?C=new ni:(C=ni.zpp_pool,ni.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=p,C.y=l,w=C,(h||_)&&(w.forced=!0)}else if(4==g){var k;null==ni.zpp_pool?k=new ni:(k=ni.zpp_pool,ni.zpp_pool=k.next,k.next=null),k.forced=!1,k.x=p,k.y=r,w=k,(h||u)&&(w.forced=!0)}else if(6==g){var O;null==ni.zpp_pool?O=new ni:(O=ni.zpp_pool,ni.zpp_pool=O.next,O.next=null),O.forced=!1,O.x=t,O.y=r,w=O,(o||u)&&(w.forced=!0)}else if(1==g){if(null==(w=i.list[(s<<1)*i.width+a])){var I,S=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?I=new ni:(I=ni.zpp_pool,ni.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=S,I.y=l,w=I,i.list[(s<<1)*i.width+a]=w}else{var P,T=w.x,A=w.y;null==ni.zpp_pool?P=new ni:(P=ni.zpp_pool,ni.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=T,P.y=A,w=P}_&&(w.forced=!0),w.x!=t&&w.x!=p||(w.x==t&&0!=(1&f)||w.x==p&&0!=(4&f))&&(f^=2)}else if(5==g){if(null==(w=i.list[(2+(s<<1))*i.width+a])){var E,N=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?E=new ni:(E=ni.zpp_pool,ni.zpp_pool=E.next,E.next=null),E.forced=!1,E.x=N,E.y=r,w=E,i.list[(2+(s<<1))*i.width+a]=w}else{var L,V=w.x,j=w.y;null==ni.zpp_pool?L=new ni:(L=ni.zpp_pool,ni.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=V,L.y=j,w=L}u&&(w.forced=!0),w.x!=t&&w.x!=p||(w.x==t&&0!=(64&f)||w.x==p&&0!=(16&f))&&(f^=32)}else if(3==g){if(null==(w=i.list[(1+(s<<1))*i.width+(a+1)])){var D,F=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?D=new ni:(D=ni.zpp_pool,ni.zpp_pool=D.next,D.next=null),D.forced=!1,D.x=p,D.y=F,w=D,i.list[(1+(s<<1))*i.width+(a+1)]=w}else{var R,B=w.x,G=w.y;null==ni.zpp_pool?R=new ni:(R=ni.zpp_pool,ni.zpp_pool=R.next,R.next=null),R.forced=!1,R.x=B,R.y=G,w=R}h&&(w.forced=!0),w.y!=l&&w.y!=r||(w.y==l&&0!=(4&f)||w.y==r&&0!=(16&f))&&(f^=8)}else{if(null==(w=i.list[(1+(s<<1))*i.width+a])){var Z,U=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?Z=new ni:(Z=ni.zpp_pool,ni.zpp_pool=Z.next,Z.next=null),Z.forced=!1,Z.x=t,Z.y=U,w=Z,i.list[(1+(s<<1))*i.width+a]=w}else{var q,Y=w.x,K=w.y;null==ni.zpp_pool?q=new ni:(q=ni.zpp_pool,ni.zpp_pool=q.next,q.next=null),q.forced=!1,q.x=Y,q.y=K,w=q}o&&(w.forced=!0),w.y!=l&&w.y!=r||(w.y==l&&0!=(1&f)||w.y==r&&0!=(64&f))&&(f^=128)}var W=w;null==y.p1?y.p1=W.prev=W.next=W:(W.prev=y.p1,W.next=y.p1.next,y.p1.next.prev=W,y.p1.next=W),y.p1=W}}y.p1=y.p1.next,y.key1=f,1!=f&&4!=f&&16!=f&&64!=f&&3!=f&&12!=f&&48!=f&&192!=f&&129!=f&&6!=f&&24!=f&&96!=f&&5!=f&&20!=f&&80!=f&&65!=f&&17!=f&&68!=f||(f=0,y.key1=0,y.p1=null),0==f?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var J=0>n(.5*(t+p),.5*(l+r));if(10==d)if(J){var X=187;y.okey1=X;for(var H=0;8>H;){var Q=H++;if(0!=(X&1<<Q)){var $=null;if(0==Q){var nn;null==ni.zpp_pool?nn=new ni:(nn=ni.zpp_pool,ni.zpp_pool=nn.next,nn.next=null),nn.forced=!1,nn.x=t,nn.y=l,$=nn,(o||_)&&($.forced=!0)}else if(2==Q){var en;null==ni.zpp_pool?en=new ni:(en=ni.zpp_pool,ni.zpp_pool=en.next,en.next=null),en.forced=!1,en.x=p,en.y=l,$=en,(h||_)&&($.forced=!0)}else if(4==Q){var tn;null==ni.zpp_pool?tn=new ni:(tn=ni.zpp_pool,ni.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=p,tn.y=r,$=tn,(h||u)&&($.forced=!0)}else if(6==Q){var ln;null==ni.zpp_pool?ln=new ni:(ln=ni.zpp_pool,ni.zpp_pool=ln.next,ln.next=null),ln.forced=!1,ln.x=t,ln.y=r,$=ln,(o||u)&&($.forced=!0)}else if(1==Q){if(null==($=i.list[(s<<1)*i.width+a])){var pn,rn=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?pn=new ni:(pn=ni.zpp_pool,ni.zpp_pool=pn.next,pn.next=null),pn.forced=!1,pn.x=rn,pn.y=l,$=pn,i.list[(s<<1)*i.width+a]=$}else{var an,sn=$.x,on=$.y;null==ni.zpp_pool?an=new ni:(an=ni.zpp_pool,ni.zpp_pool=an.next,an.next=null),an.forced=!1,an.x=sn,an.y=on,$=an}_&&($.forced=!0),$.x!=t&&$.x!=p||($.x==t&&0!=(1&X)||$.x==p&&0!=(4&X))&&(X^=2)}else if(5==Q){if(null==($=i.list[(2+(s<<1))*i.width+a])){var _n,hn=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?_n=new ni:(_n=ni.zpp_pool,ni.zpp_pool=_n.next,_n.next=null),_n.forced=!1,_n.x=hn,_n.y=r,$=_n,i.list[(2+(s<<1))*i.width+a]=$}else{var un,xn=$.x,dn=$.y;null==ni.zpp_pool?un=new ni:(un=ni.zpp_pool,ni.zpp_pool=un.next,un.next=null),un.forced=!1,un.x=xn,un.y=dn,$=un}u&&($.forced=!0),$.x!=t&&$.x!=p||($.x==t&&0!=(64&X)||$.x==p&&0!=(16&X))&&(X^=32)}else if(3==Q){if(null==($=i.list[(1+(s<<1))*i.width+(a+1)])){var vn,zn=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?vn=new ni:(vn=ni.zpp_pool,ni.zpp_pool=vn.next,vn.next=null),vn.forced=!1,vn.x=p,vn.y=zn,$=vn,i.list[(1+(s<<1))*i.width+(a+1)]=$}else{var cn,mn=$.x,yn=$.y;null==ni.zpp_pool?cn=new ni:(cn=ni.zpp_pool,ni.zpp_pool=cn.next,cn.next=null),cn.forced=!1,cn.x=mn,cn.y=yn,$=cn}h&&($.forced=!0),$.y!=l&&$.y!=r||($.y==l&&0!=(4&X)||$.y==r&&0!=(16&X))&&(X^=8)}else{if(null==($=i.list[(1+(s<<1))*i.width+a])){var fn,bn=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?fn=new ni:(fn=ni.zpp_pool,ni.zpp_pool=fn.next,fn.next=null),fn.forced=!1,fn.x=t,fn.y=bn,$=fn,i.list[(1+(s<<1))*i.width+a]=$}else{var gn,wn=$.x,Mn=$.y;null==ni.zpp_pool?gn=new ni:(gn=ni.zpp_pool,ni.zpp_pool=gn.next,gn.next=null),gn.forced=!1,gn.x=wn,gn.y=Mn,$=gn}o&&($.forced=!0),$.y!=l&&$.y!=r||($.y==l&&0!=(1&X)||$.y==r&&0!=(64&X))&&(X^=128)}var Cn=$;null==y.p1?y.p1=Cn.prev=Cn.next=Cn:(Cn.prev=y.p1,Cn.next=y.p1.next,y.p1.next.prev=Cn,y.p1.next=Cn),y.p1=Cn}}y.p1=y.p1.next,y.key1=X,1!=X&&4!=X&&16!=X&&64!=X&&3!=X&&12!=X&&48!=X&&192!=X&&129!=X&&6!=X&&24!=X&&96!=X&&5!=X&&20!=X&&80!=X&&65!=X&&17!=X&&68!=X||(X=0,y.key1=0,y.p1=null),0==X?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var kn=131;y.okey1=kn;for(var On=0;8>On;){var In=On++;if(0!=(kn&1<<In)){var Sn=null;if(0==In){var Pn;null==ni.zpp_pool?Pn=new ni:(Pn=ni.zpp_pool,ni.zpp_pool=Pn.next,Pn.next=null),Pn.forced=!1,Pn.x=t,Pn.y=l,Sn=Pn,(o||_)&&(Sn.forced=!0)}else if(2==In){var Tn;null==ni.zpp_pool?Tn=new ni:(Tn=ni.zpp_pool,ni.zpp_pool=Tn.next,Tn.next=null),Tn.forced=!1,Tn.x=p,Tn.y=l,Sn=Tn,(h||_)&&(Sn.forced=!0)}else if(4==In){var An;null==ni.zpp_pool?An=new ni:(An=ni.zpp_pool,ni.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=p,An.y=r,Sn=An,(h||u)&&(Sn.forced=!0)}else if(6==In){var En;null==ni.zpp_pool?En=new ni:(En=ni.zpp_pool,ni.zpp_pool=En.next,En.next=null),En.forced=!1,En.x=t,En.y=r,Sn=En,(o||u)&&(Sn.forced=!0)}else if(1==In){if(null==(Sn=i.list[(s<<1)*i.width+a])){var Nn,Ln=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?Nn=new ni:(Nn=ni.zpp_pool,ni.zpp_pool=Nn.next,Nn.next=null),Nn.forced=!1,Nn.x=Ln,Nn.y=l,Sn=Nn,i.list[(s<<1)*i.width+a]=Sn}else{var Vn,jn=Sn.x,Dn=Sn.y;null==ni.zpp_pool?Vn=new ni:(Vn=ni.zpp_pool,ni.zpp_pool=Vn.next,Vn.next=null),Vn.forced=!1,Vn.x=jn,Vn.y=Dn,Sn=Vn}_&&(Sn.forced=!0),Sn.x!=t&&Sn.x!=p||(Sn.x==t&&0!=(1&kn)||Sn.x==p&&0!=(4&kn))&&(kn^=2)}else if(5==In){if(null==(Sn=i.list[(2+(s<<1))*i.width+a])){var Fn,Rn=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?Fn=new ni:(Fn=ni.zpp_pool,ni.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=Rn,Fn.y=r,Sn=Fn,i.list[(2+(s<<1))*i.width+a]=Sn}else{var Bn,Gn=Sn.x,Zn=Sn.y;null==ni.zpp_pool?Bn=new ni:(Bn=ni.zpp_pool,ni.zpp_pool=Bn.next,Bn.next=null),Bn.forced=!1,Bn.x=Gn,Bn.y=Zn,Sn=Bn}u&&(Sn.forced=!0),Sn.x!=t&&Sn.x!=p||(Sn.x==t&&0!=(64&kn)||Sn.x==p&&0!=(16&kn))&&(kn^=32)}else if(3==In){if(null==(Sn=i.list[(1+(s<<1))*i.width+(a+1)])){var Un,qn=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?Un=new ni:(Un=ni.zpp_pool,ni.zpp_pool=Un.next,Un.next=null),Un.forced=!1,Un.x=p,Un.y=qn,Sn=Un,i.list[(1+(s<<1))*i.width+(a+1)]=Sn}else{var Yn,Kn=Sn.x,Wn=Sn.y;null==ni.zpp_pool?Yn=new ni:(Yn=ni.zpp_pool,ni.zpp_pool=Yn.next,Yn.next=null),Yn.forced=!1,Yn.x=Kn,Yn.y=Wn,Sn=Yn}h&&(Sn.forced=!0),Sn.y!=l&&Sn.y!=r||(Sn.y==l&&0!=(4&kn)||Sn.y==r&&0!=(16&kn))&&(kn^=8)}else{if(null==(Sn=i.list[(1+(s<<1))*i.width+a])){var Jn,Xn=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?Jn=new ni:(Jn=ni.zpp_pool,ni.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=t,Jn.y=Xn,Sn=Jn,i.list[(1+(s<<1))*i.width+a]=Sn}else{var Hn,Qn=Sn.x,$n=Sn.y;null==ni.zpp_pool?Hn=new ni:(Hn=ni.zpp_pool,ni.zpp_pool=Hn.next,Hn.next=null),Hn.forced=!1,Hn.x=Qn,Hn.y=$n,Sn=Hn}o&&(Sn.forced=!0),Sn.y!=l&&Sn.y!=r||(Sn.y==l&&0!=(1&kn)||Sn.y==r&&0!=(64&kn))&&(kn^=128)}var ne=Sn;null==y.p1?y.p1=ne.prev=ne.next=ne:(ne.prev=y.p1,ne.next=y.p1.next,y.p1.next.prev=ne,y.p1.next=ne),y.p1=ne}}if(y.p1=y.p1.next,y.key1=kn,1!=kn&&4!=kn&&16!=kn&&64!=kn&&3!=kn&&12!=kn&&48!=kn&&192!=kn&&129!=kn&&6!=kn&&24!=kn&&96!=kn&&5!=kn&&20!=kn&&80!=kn&&65!=kn&&17!=kn&&68!=kn||(kn=0,y.key1=0,y.p1=null),0!=kn){var ee=56;y.okey2=ee;for(var ie=0;8>ie;){var te=ie++;if(0!=(ee&1<<te)){var le=null;if(0==te){var pe;null==ni.zpp_pool?pe=new ni:(pe=ni.zpp_pool,ni.zpp_pool=pe.next,pe.next=null),pe.forced=!1,pe.x=t,pe.y=l,le=pe,(o||_)&&(le.forced=!0)}else if(2==te){var re;null==ni.zpp_pool?re=new ni:(re=ni.zpp_pool,ni.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=p,re.y=l,le=re,(h||_)&&(le.forced=!0)}else if(4==te){var ae;null==ni.zpp_pool?ae=new ni:(ae=ni.zpp_pool,ni.zpp_pool=ae.next,ae.next=null),ae.forced=!1,ae.x=p,ae.y=r,le=ae,(h||u)&&(le.forced=!0)}else if(6==te){var se;null==ni.zpp_pool?se=new ni:(se=ni.zpp_pool,ni.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=t,se.y=r,le=se,(o||u)&&(le.forced=!0)}else if(1==te){if(null==(le=i.list[(s<<1)*i.width+a])){var oe,_e=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?oe=new ni:(oe=ni.zpp_pool,ni.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=_e,oe.y=l,le=oe,i.list[(s<<1)*i.width+a]=le}else{var he,ue=le.x,xe=le.y;null==ni.zpp_pool?he=new ni:(he=ni.zpp_pool,ni.zpp_pool=he.next,he.next=null),he.forced=!1,he.x=ue,he.y=xe,le=he}_&&(le.forced=!0),le.x!=t&&le.x!=p||(le.x==t&&0!=(1&ee)||le.x==p&&0!=(4&ee))&&(ee^=2)}else if(5==te){if(null==(le=i.list[(2+(s<<1))*i.width+a])){var de,ve=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?de=new ni:(de=ni.zpp_pool,ni.zpp_pool=de.next,de.next=null),de.forced=!1,de.x=ve,de.y=r,le=de,i.list[(2+(s<<1))*i.width+a]=le}else{var ze,ce=le.x,me=le.y;null==ni.zpp_pool?ze=new ni:(ze=ni.zpp_pool,ni.zpp_pool=ze.next,ze.next=null),ze.forced=!1,ze.x=ce,ze.y=me,le=ze}u&&(le.forced=!0),le.x!=t&&le.x!=p||(le.x==t&&0!=(64&ee)||le.x==p&&0!=(16&ee))&&(ee^=32)}else if(3==te){if(null==(le=i.list[(1+(s<<1))*i.width+(a+1)])){var ye,fe=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?ye=new ni:(ye=ni.zpp_pool,ni.zpp_pool=ye.next,ye.next=null),ye.forced=!1,ye.x=p,ye.y=fe,le=ye,i.list[(1+(s<<1))*i.width+(a+1)]=le}else{var be,ge=le.x,we=le.y;null==ni.zpp_pool?be=new ni:(be=ni.zpp_pool,ni.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=ge,be.y=we,le=be}h&&(le.forced=!0),le.y!=l&&le.y!=r||(le.y==l&&0!=(4&ee)||le.y==r&&0!=(16&ee))&&(ee^=8)}else{if(null==(le=i.list[(1+(s<<1))*i.width+a])){var Me,Ce=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?Me=new ni:(Me=ni.zpp_pool,ni.zpp_pool=Me.next,Me.next=null),Me.forced=!1,Me.x=t,Me.y=Ce,le=Me,i.list[(1+(s<<1))*i.width+a]=le}else{var ke,Oe=le.x,Ie=le.y;null==ni.zpp_pool?ke=new ni:(ke=ni.zpp_pool,ni.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Oe,ke.y=Ie,le=ke}o&&(le.forced=!0),le.y!=l&&le.y!=r||(le.y==l&&0!=(1&ee)||le.y==r&&0!=(64&ee))&&(ee^=128)}var Se=le;null==y.p2?y.p2=Se.prev=Se.next=Se:(Se.prev=y.p2,Se.next=y.p2.next,y.p2.next.prev=Se,y.p2.next=Se),y.p2=Se}}y.p2=y.p2.next,y.key2=ee,1!=ee&&4!=ee&&16!=ee&&64!=ee&&3!=ee&&12!=ee&&48!=ee&&192!=ee&&129!=ee&&6!=ee&&24!=ee&&96!=ee&&5!=ee&&20!=ee&&80!=ee&&65!=ee&&17!=ee&&68!=ee||(ee=0,y.key2=0,y.p2=null),0==ee?(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1):(y.pr=y.p2,y.okeyr=y.okey2,y.keyr=y.key2)}else{var Pe=56;y.okey1=Pe;for(var Te=0;8>Te;){var Ae=Te++;if(0!=(Pe&1<<Ae)){var Ee=null;if(0==Ae){var Ne;null==ni.zpp_pool?Ne=new ni:(Ne=ni.zpp_pool,ni.zpp_pool=Ne.next,Ne.next=null),Ne.forced=!1,Ne.x=t,Ne.y=l,Ee=Ne,(o||_)&&(Ee.forced=!0)}else if(2==Ae){var Le;null==ni.zpp_pool?Le=new ni:(Le=ni.zpp_pool,ni.zpp_pool=Le.next,Le.next=null),Le.forced=!1,Le.x=p,Le.y=l,Ee=Le,(h||_)&&(Ee.forced=!0)}else if(4==Ae){var Ve;null==ni.zpp_pool?Ve=new ni:(Ve=ni.zpp_pool,ni.zpp_pool=Ve.next,Ve.next=null),Ve.forced=!1,Ve.x=p,Ve.y=r,Ee=Ve,(h||u)&&(Ee.forced=!0)}else if(6==Ae){var je;null==ni.zpp_pool?je=new ni:(je=ni.zpp_pool,ni.zpp_pool=je.next,je.next=null),je.forced=!1,je.x=t,je.y=r,Ee=je,(o||u)&&(Ee.forced=!0)}else if(1==Ae){if(null==(Ee=i.list[(s<<1)*i.width+a])){var De,Fe=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?De=new ni:(De=ni.zpp_pool,ni.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=Fe,De.y=l,Ee=De,i.list[(s<<1)*i.width+a]=Ee}else{var Re,Be=Ee.x,Ge=Ee.y;null==ni.zpp_pool?Re=new ni:(Re=ni.zpp_pool,ni.zpp_pool=Re.next,Re.next=null),Re.forced=!1,Re.x=Be,Re.y=Ge,Ee=Re}_&&(Ee.forced=!0),Ee.x!=t&&Ee.x!=p||(Ee.x==t&&0!=(1&Pe)||Ee.x==p&&0!=(4&Pe))&&(Pe^=2)}else if(5==Ae){if(null==(Ee=i.list[(2+(s<<1))*i.width+a])){var Ze,Ue=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?Ze=new ni:(Ze=ni.zpp_pool,ni.zpp_pool=Ze.next,Ze.next=null),Ze.forced=!1,Ze.x=Ue,Ze.y=r,Ee=Ze,i.list[(2+(s<<1))*i.width+a]=Ee}else{var qe,Ye=Ee.x,Ke=Ee.y;null==ni.zpp_pool?qe=new ni:(qe=ni.zpp_pool,ni.zpp_pool=qe.next,qe.next=null),qe.forced=!1,qe.x=Ye,qe.y=Ke,Ee=qe}u&&(Ee.forced=!0),Ee.x!=t&&Ee.x!=p||(Ee.x==t&&0!=(64&Pe)||Ee.x==p&&0!=(16&Pe))&&(Pe^=32)}else if(3==Ae){if(null==(Ee=i.list[(1+(s<<1))*i.width+(a+1)])){var We,Je=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?We=new ni:(We=ni.zpp_pool,ni.zpp_pool=We.next,We.next=null),We.forced=!1,We.x=p,We.y=Je,Ee=We,i.list[(1+(s<<1))*i.width+(a+1)]=Ee}else{var Xe,He=Ee.x,Qe=Ee.y;null==ni.zpp_pool?Xe=new ni:(Xe=ni.zpp_pool,ni.zpp_pool=Xe.next,Xe.next=null),Xe.forced=!1,Xe.x=He,Xe.y=Qe,Ee=Xe}h&&(Ee.forced=!0),Ee.y!=l&&Ee.y!=r||(Ee.y==l&&0!=(4&Pe)||Ee.y==r&&0!=(16&Pe))&&(Pe^=8)}else{if(null==(Ee=i.list[(1+(s<<1))*i.width+a])){var $e,ei=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?$e=new ni:($e=ni.zpp_pool,ni.zpp_pool=$e.next,$e.next=null),$e.forced=!1,$e.x=t,$e.y=ei,Ee=$e,i.list[(1+(s<<1))*i.width+a]=Ee}else{var ii,ti=Ee.x,ri=Ee.y;null==ni.zpp_pool?ii=new ni:(ii=ni.zpp_pool,ni.zpp_pool=ii.next,ii.next=null),ii.forced=!1,ii.x=ti,ii.y=ri,Ee=ii}o&&(Ee.forced=!0),Ee.y!=l&&Ee.y!=r||(Ee.y==l&&0!=(1&Pe)||Ee.y==r&&0!=(64&Pe))&&(Pe^=128)}var ai=Ee;null==y.p1?y.p1=ai.prev=ai.next=ai:(ai.prev=y.p1,ai.next=y.p1.next,y.p1.next.prev=ai,y.p1.next=ai),y.p1=ai}}y.p1=y.p1.next,y.key1=Pe,1!=Pe&&4!=Pe&&16!=Pe&&64!=Pe&&3!=Pe&&12!=Pe&&48!=Pe&&192!=Pe&&129!=Pe&&6!=Pe&&24!=Pe&&96!=Pe&&5!=Pe&&20!=Pe&&80!=Pe&&65!=Pe&&17!=Pe&&68!=Pe||(Pe=0,y.key1=0,y.p1=null),0==Pe?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}}else if(J){var si=238;y.okey1=si;for(var oi=0;8>oi;){var _i=oi++;if(0!=(si&1<<_i)){var hi=null;if(0==_i){var ui;null==ni.zpp_pool?ui=new ni:(ui=ni.zpp_pool,ni.zpp_pool=ui.next,ui.next=null),ui.forced=!1,ui.x=t,ui.y=l,hi=ui,(o||_)&&(hi.forced=!0)}else if(2==_i){var xi;null==ni.zpp_pool?xi=new ni:(xi=ni.zpp_pool,ni.zpp_pool=xi.next,xi.next=null),xi.forced=!1,xi.x=p,xi.y=l,hi=xi,(h||_)&&(hi.forced=!0)}else if(4==_i){var di;null==ni.zpp_pool?di=new ni:(di=ni.zpp_pool,ni.zpp_pool=di.next,di.next=null),di.forced=!1,di.x=p,di.y=r,hi=di,(h||u)&&(hi.forced=!0)}else if(6==_i){var vi;null==ni.zpp_pool?vi=new ni:(vi=ni.zpp_pool,ni.zpp_pool=vi.next,vi.next=null),vi.forced=!1,vi.x=t,vi.y=r,hi=vi,(o||u)&&(hi.forced=!0)}else if(1==_i){if(null==(hi=i.list[(s<<1)*i.width+a])){var zi,ci=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?zi=new ni:(zi=ni.zpp_pool,ni.zpp_pool=zi.next,zi.next=null),zi.forced=!1,zi.x=ci,zi.y=l,hi=zi,i.list[(s<<1)*i.width+a]=hi}else{var mi,yi=hi.x,fi=hi.y;null==ni.zpp_pool?mi=new ni:(mi=ni.zpp_pool,ni.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=yi,mi.y=fi,hi=mi}_&&(hi.forced=!0),hi.x!=t&&hi.x!=p||(hi.x==t&&0!=(1&si)||hi.x==p&&0!=(4&si))&&(si^=2)}else if(5==_i){if(null==(hi=i.list[(2+(s<<1))*i.width+a])){var bi,gi=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?bi=new ni:(bi=ni.zpp_pool,ni.zpp_pool=bi.next,bi.next=null),bi.forced=!1,bi.x=gi,bi.y=r,hi=bi,i.list[(2+(s<<1))*i.width+a]=hi}else{var wi,Mi=hi.x,Ci=hi.y;null==ni.zpp_pool?wi=new ni:(wi=ni.zpp_pool,ni.zpp_pool=wi.next,wi.next=null),wi.forced=!1,wi.x=Mi,wi.y=Ci,hi=wi}u&&(hi.forced=!0),hi.x!=t&&hi.x!=p||(hi.x==t&&0!=(64&si)||hi.x==p&&0!=(16&si))&&(si^=32)}else if(3==_i){if(null==(hi=i.list[(1+(s<<1))*i.width+(a+1)])){var ki,Oi=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?ki=new ni:(ki=ni.zpp_pool,ni.zpp_pool=ki.next,ki.next=null),ki.forced=!1,ki.x=p,ki.y=Oi,hi=ki,i.list[(1+(s<<1))*i.width+(a+1)]=hi}else{var Ii,Si=hi.x,Pi=hi.y;null==ni.zpp_pool?Ii=new ni:(Ii=ni.zpp_pool,ni.zpp_pool=Ii.next,Ii.next=null),Ii.forced=!1,Ii.x=Si,Ii.y=Pi,hi=Ii}h&&(hi.forced=!0),hi.y!=l&&hi.y!=r||(hi.y==l&&0!=(4&si)||hi.y==r&&0!=(16&si))&&(si^=8)}else{if(null==(hi=i.list[(1+(s<<1))*i.width+a])){var Ti,Ai=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?Ti=new ni:(Ti=ni.zpp_pool,ni.zpp_pool=Ti.next,Ti.next=null),Ti.forced=!1,Ti.x=t,Ti.y=Ai,hi=Ti,i.list[(1+(s<<1))*i.width+a]=hi}else{var Ei,Ni=hi.x,Li=hi.y;null==ni.zpp_pool?Ei=new ni:(Ei=ni.zpp_pool,ni.zpp_pool=Ei.next,Ei.next=null),Ei.forced=!1,Ei.x=Ni,Ei.y=Li,hi=Ei}o&&(hi.forced=!0),hi.y!=l&&hi.y!=r||(hi.y==l&&0!=(1&si)||hi.y==r&&0!=(64&si))&&(si^=128)}var Vi=hi;null==y.p1?y.p1=Vi.prev=Vi.next=Vi:(Vi.prev=y.p1,Vi.next=y.p1.next,y.p1.next.prev=Vi,y.p1.next=Vi),y.p1=Vi}}y.p1=y.p1.next,y.key1=si,1!=si&&4!=si&&16!=si&&64!=si&&3!=si&&12!=si&&48!=si&&192!=si&&129!=si&&6!=si&&24!=si&&96!=si&&5!=si&&20!=si&&80!=si&&65!=si&&17!=si&&68!=si||(si=0,y.key1=0,y.p1=null),0==si?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}else{var ji=224;y.okey1=ji;for(var Di=0;8>Di;){var Fi=Di++;if(0!=(ji&1<<Fi)){var Ri=null;if(0==Fi){var Bi;null==ni.zpp_pool?Bi=new ni:(Bi=ni.zpp_pool,ni.zpp_pool=Bi.next,Bi.next=null),Bi.forced=!1,Bi.x=t,Bi.y=l,Ri=Bi,(o||_)&&(Ri.forced=!0)}else if(2==Fi){var Gi;null==ni.zpp_pool?Gi=new ni:(Gi=ni.zpp_pool,ni.zpp_pool=Gi.next,Gi.next=null),Gi.forced=!1,Gi.x=p,Gi.y=l,Ri=Gi,(h||_)&&(Ri.forced=!0)}else if(4==Fi){var Zi;null==ni.zpp_pool?Zi=new ni:(Zi=ni.zpp_pool,ni.zpp_pool=Zi.next,Zi.next=null),Zi.forced=!1,Zi.x=p,Zi.y=r,Ri=Zi,(h||u)&&(Ri.forced=!0)}else if(6==Fi){var Ui;null==ni.zpp_pool?Ui=new ni:(Ui=ni.zpp_pool,ni.zpp_pool=Ui.next,Ui.next=null),Ui.forced=!1,Ui.x=t,Ui.y=r,Ri=Ui,(o||u)&&(Ri.forced=!0)}else if(1==Fi){if(null==(Ri=i.list[(s<<1)*i.width+a])){var qi,Yi=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?qi=new ni:(qi=ni.zpp_pool,ni.zpp_pool=qi.next,qi.next=null),qi.forced=!1,qi.x=Yi,qi.y=l,Ri=qi,i.list[(s<<1)*i.width+a]=Ri}else{var Ki,Wi=Ri.x,Ji=Ri.y;null==ni.zpp_pool?Ki=new ni:(Ki=ni.zpp_pool,ni.zpp_pool=Ki.next,Ki.next=null),Ki.forced=!1,Ki.x=Wi,Ki.y=Ji,Ri=Ki}_&&(Ri.forced=!0),Ri.x!=t&&Ri.x!=p||(Ri.x==t&&0!=(1&ji)||Ri.x==p&&0!=(4&ji))&&(ji^=2)}else if(5==Fi){if(null==(Ri=i.list[(2+(s<<1))*i.width+a])){var Xi,Hi=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?Xi=new ni:(Xi=ni.zpp_pool,ni.zpp_pool=Xi.next,Xi.next=null),Xi.forced=!1,Xi.x=Hi,Xi.y=r,Ri=Xi,i.list[(2+(s<<1))*i.width+a]=Ri}else{var Qi,$i=Ri.x,nt=Ri.y;null==ni.zpp_pool?Qi=new ni:(Qi=ni.zpp_pool,ni.zpp_pool=Qi.next,Qi.next=null),Qi.forced=!1,Qi.x=$i,Qi.y=nt,Ri=Qi}u&&(Ri.forced=!0),Ri.x!=t&&Ri.x!=p||(Ri.x==t&&0!=(64&ji)||Ri.x==p&&0!=(16&ji))&&(ji^=32)}else if(3==Fi){if(null==(Ri=i.list[(1+(s<<1))*i.width+(a+1)])){var et,it=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?et=new ni:(et=ni.zpp_pool,ni.zpp_pool=et.next,et.next=null),et.forced=!1,et.x=p,et.y=it,Ri=et,i.list[(1+(s<<1))*i.width+(a+1)]=Ri}else{var tt,lt=Ri.x,pt=Ri.y;null==ni.zpp_pool?tt=new ni:(tt=ni.zpp_pool,ni.zpp_pool=tt.next,tt.next=null),tt.forced=!1,tt.x=lt,tt.y=pt,Ri=tt}h&&(Ri.forced=!0),Ri.y!=l&&Ri.y!=r||(Ri.y==l&&0!=(4&ji)||Ri.y==r&&0!=(16&ji))&&(ji^=8)}else{if(null==(Ri=i.list[(1+(s<<1))*i.width+a])){var rt,at=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?rt=new ni:(rt=ni.zpp_pool,ni.zpp_pool=rt.next,rt.next=null),rt.forced=!1,rt.x=t,rt.y=at,Ri=rt,i.list[(1+(s<<1))*i.width+a]=Ri}else{var st,ot=Ri.x,_t=Ri.y;null==ni.zpp_pool?st=new ni:(st=ni.zpp_pool,ni.zpp_pool=st.next,st.next=null),st.forced=!1,st.x=ot,st.y=_t,Ri=st}o&&(Ri.forced=!0),Ri.y!=l&&Ri.y!=r||(Ri.y==l&&0!=(1&ji)||Ri.y==r&&0!=(64&ji))&&(ji^=128)}var ht=Ri;null==y.p1?y.p1=ht.prev=ht.next=ht:(ht.prev=y.p1,ht.next=y.p1.next,y.p1.next.prev=ht,y.p1.next=ht),y.p1=ht}}if(y.p1=y.p1.next,y.key1=ji,1!=ji&&4!=ji&&16!=ji&&64!=ji&&3!=ji&&12!=ji&&48!=ji&&192!=ji&&129!=ji&&6!=ji&&24!=ji&&96!=ji&&5!=ji&&20!=ji&&80!=ji&&65!=ji&&17!=ji&&68!=ji||(ji=0,y.key1=0,y.p1=null),0!=ji){var ut=14;y.okey2=ut;for(var xt=0;8>xt;){var dt=xt++;if(0!=(ut&1<<dt)){var vt=null;if(0==dt){var zt;null==ni.zpp_pool?zt=new ni:(zt=ni.zpp_pool,ni.zpp_pool=zt.next,zt.next=null),zt.forced=!1,zt.x=t,zt.y=l,vt=zt,(o||_)&&(vt.forced=!0)}else if(2==dt){var ct;null==ni.zpp_pool?ct=new ni:(ct=ni.zpp_pool,ni.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=p,ct.y=l,vt=ct,(h||_)&&(vt.forced=!0)}else if(4==dt){var mt;null==ni.zpp_pool?mt=new ni:(mt=ni.zpp_pool,ni.zpp_pool=mt.next,mt.next=null),mt.forced=!1,mt.x=p,mt.y=r,vt=mt,(h||u)&&(vt.forced=!0)}else if(6==dt){var yt;null==ni.zpp_pool?yt=new ni:(yt=ni.zpp_pool,ni.zpp_pool=yt.next,yt.next=null),yt.forced=!1,yt.x=t,yt.y=r,vt=yt,(o||u)&&(vt.forced=!0)}else if(1==dt){if(null==(vt=i.list[(s<<1)*i.width+a])){var ft,bt=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?ft=new ni:(ft=ni.zpp_pool,ni.zpp_pool=ft.next,ft.next=null),ft.forced=!1,ft.x=bt,ft.y=l,vt=ft,i.list[(s<<1)*i.width+a]=vt}else{var gt,wt=vt.x,Mt=vt.y;null==ni.zpp_pool?gt=new ni:(gt=ni.zpp_pool,ni.zpp_pool=gt.next,gt.next=null),gt.forced=!1,gt.x=wt,gt.y=Mt,vt=gt}_&&(vt.forced=!0),vt.x!=t&&vt.x!=p||(vt.x==t&&0!=(1&ut)||vt.x==p&&0!=(4&ut))&&(ut^=2)}else if(5==dt){if(null==(vt=i.list[(2+(s<<1))*i.width+a])){var Ct,kt=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?Ct=new ni:(Ct=ni.zpp_pool,ni.zpp_pool=Ct.next,Ct.next=null),Ct.forced=!1,Ct.x=kt,Ct.y=r,vt=Ct,i.list[(2+(s<<1))*i.width+a]=vt}else{var Ot,It=vt.x,St=vt.y;null==ni.zpp_pool?Ot=new ni:(Ot=ni.zpp_pool,ni.zpp_pool=Ot.next,Ot.next=null),Ot.forced=!1,Ot.x=It,Ot.y=St,vt=Ot}u&&(vt.forced=!0),vt.x!=t&&vt.x!=p||(vt.x==t&&0!=(64&ut)||vt.x==p&&0!=(16&ut))&&(ut^=32)}else if(3==dt){if(null==(vt=i.list[(1+(s<<1))*i.width+(a+1)])){var Pt,Tt=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?Pt=new ni:(Pt=ni.zpp_pool,ni.zpp_pool=Pt.next,Pt.next=null),Pt.forced=!1,Pt.x=p,Pt.y=Tt,vt=Pt,i.list[(1+(s<<1))*i.width+(a+1)]=vt}else{var At,Et=vt.x,Nt=vt.y;null==ni.zpp_pool?At=new ni:(At=ni.zpp_pool,ni.zpp_pool=At.next,At.next=null),At.forced=!1,At.x=Et,At.y=Nt,vt=At}h&&(vt.forced=!0),vt.y!=l&&vt.y!=r||(vt.y==l&&0!=(4&ut)||vt.y==r&&0!=(16&ut))&&(ut^=8)}else{if(null==(vt=i.list[(1+(s<<1))*i.width+a])){var Lt,Vt=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?Lt=new ni:(Lt=ni.zpp_pool,ni.zpp_pool=Lt.next,Lt.next=null),Lt.forced=!1,Lt.x=t,Lt.y=Vt,vt=Lt,i.list[(1+(s<<1))*i.width+a]=vt}else{var jt,Dt=vt.x,Ft=vt.y;null==ni.zpp_pool?jt=new ni:(jt=ni.zpp_pool,ni.zpp_pool=jt.next,jt.next=null),jt.forced=!1,jt.x=Dt,jt.y=Ft,vt=jt}o&&(vt.forced=!0),vt.y!=l&&vt.y!=r||(vt.y==l&&0!=(1&ut)||vt.y==r&&0!=(64&ut))&&(ut^=128)}var Rt=vt;null==y.p2?y.p2=Rt.prev=Rt.next=Rt:(Rt.prev=y.p2,Rt.next=y.p2.next,y.p2.next.prev=Rt,y.p2.next=Rt),y.p2=Rt}}y.p2=y.p2.next,y.key2=ut,1!=ut&&4!=ut&&16!=ut&&64!=ut&&3!=ut&&12!=ut&&48!=ut&&192!=ut&&129!=ut&&6!=ut&&24!=ut&&96!=ut&&5!=ut&&20!=ut&&80!=ut&&65!=ut&&17!=ut&&68!=ut||(ut=0,y.key2=0,y.p2=null),0==ut?(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1):(y.pr=y.p2,y.okeyr=y.okey2,y.keyr=y.key2)}else{var Bt=14;y.okey1=Bt;for(var Gt=0;8>Gt;){var Zt=Gt++;if(0!=(Bt&1<<Zt)){var Ut=null;if(0==Zt){var qt;null==ni.zpp_pool?qt=new ni:(qt=ni.zpp_pool,ni.zpp_pool=qt.next,qt.next=null),qt.forced=!1,qt.x=t,qt.y=l,Ut=qt,(o||_)&&(Ut.forced=!0)}else if(2==Zt){var Yt;null==ni.zpp_pool?Yt=new ni:(Yt=ni.zpp_pool,ni.zpp_pool=Yt.next,Yt.next=null),Yt.forced=!1,Yt.x=p,Yt.y=l,Ut=Yt,(h||_)&&(Ut.forced=!0)}else if(4==Zt){var Kt;null==ni.zpp_pool?Kt=new ni:(Kt=ni.zpp_pool,ni.zpp_pool=Kt.next,Kt.next=null),Kt.forced=!1,Kt.x=p,Kt.y=r,Ut=Kt,(h||u)&&(Ut.forced=!0)}else if(6==Zt){var Wt;null==ni.zpp_pool?Wt=new ni:(Wt=ni.zpp_pool,ni.zpp_pool=Wt.next,Wt.next=null),Wt.forced=!1,Wt.x=t,Wt.y=r,Ut=Wt,(o||u)&&(Ut.forced=!0)}else if(1==Zt){if(null==(Ut=i.list[(s<<1)*i.width+a])){var Jt,Xt=this.xlerp(t,p,l,v,z,n,x);null==ni.zpp_pool?Jt=new ni:(Jt=ni.zpp_pool,ni.zpp_pool=Jt.next,Jt.next=null),Jt.forced=!1,Jt.x=Xt,Jt.y=l,Ut=Jt,i.list[(s<<1)*i.width+a]=Ut}else{var Ht,Qt=Ut.x,$t=Ut.y;null==ni.zpp_pool?Ht=new ni:(Ht=ni.zpp_pool,ni.zpp_pool=Ht.next,Ht.next=null),Ht.forced=!1,Ht.x=Qt,Ht.y=$t,Ut=Ht}_&&(Ut.forced=!0),Ut.x!=t&&Ut.x!=p||(Ut.x==t&&0!=(1&Bt)||Ut.x==p&&0!=(4&Bt))&&(Bt^=2)}else if(5==Zt){if(null==(Ut=i.list[(2+(s<<1))*i.width+a])){var nl,el=this.xlerp(t,p,r,m,c,n,x);null==ni.zpp_pool?nl=new ni:(nl=ni.zpp_pool,ni.zpp_pool=nl.next,nl.next=null),nl.forced=!1,nl.x=el,nl.y=r,Ut=nl,i.list[(2+(s<<1))*i.width+a]=Ut}else{var il,tl=Ut.x,ll=Ut.y;null==ni.zpp_pool?il=new ni:(il=ni.zpp_pool,ni.zpp_pool=il.next,il.next=null),il.forced=!1,il.x=tl,il.y=ll,Ut=il}u&&(Ut.forced=!0),Ut.x!=t&&Ut.x!=p||(Ut.x==t&&0!=(64&Bt)||Ut.x==p&&0!=(16&Bt))&&(Bt^=32)}else if(3==Zt){if(null==(Ut=i.list[(1+(s<<1))*i.width+(a+1)])){var pl,rl=this.ylerp(l,r,p,z,c,n,x);null==ni.zpp_pool?pl=new ni:(pl=ni.zpp_pool,ni.zpp_pool=pl.next,pl.next=null),pl.forced=!1,pl.x=p,pl.y=rl,Ut=pl,i.list[(1+(s<<1))*i.width+(a+1)]=Ut}else{var al,sl=Ut.x,ol=Ut.y;null==ni.zpp_pool?al=new ni:(al=ni.zpp_pool,ni.zpp_pool=al.next,al.next=null),al.forced=!1,al.x=sl,al.y=ol,Ut=al}h&&(Ut.forced=!0),Ut.y!=l&&Ut.y!=r||(Ut.y==l&&0!=(4&Bt)||Ut.y==r&&0!=(16&Bt))&&(Bt^=8)}else{if(null==(Ut=i.list[(1+(s<<1))*i.width+a])){var _l,hl=this.ylerp(l,r,t,v,m,n,x);null==ni.zpp_pool?_l=new ni:(_l=ni.zpp_pool,ni.zpp_pool=_l.next,_l.next=null),_l.forced=!1,_l.x=t,_l.y=hl,Ut=_l,i.list[(1+(s<<1))*i.width+a]=Ut}else{var ul,xl=Ut.x,dl=Ut.y;null==ni.zpp_pool?ul=new ni:(ul=ni.zpp_pool,ni.zpp_pool=ul.next,ul.next=null),ul.forced=!1,ul.x=xl,ul.y=dl,Ut=ul}o&&(Ut.forced=!0),Ut.y!=l&&Ut.y!=r||(Ut.y==l&&0!=(1&Bt)||Ut.y==r&&0!=(64&Bt))&&(Bt^=128)}var vl=Ut;null==y.p1?y.p1=vl.prev=vl.next=vl:(vl.prev=y.p1,vl.next=y.p1.next,y.p1.next.prev=vl,y.p1.next=vl),y.p1=vl}}y.p1=y.p1.next,y.key1=Bt,1!=Bt&&4!=Bt&&16!=Bt&&64!=Bt&&3!=Bt&&12!=Bt&&48!=Bt&&192!=Bt&&129!=Bt&&6!=Bt&&24!=Bt&&96!=Bt&&5!=Bt&&20!=Bt&&80!=Bt&&65!=Bt&&17!=Bt&&68!=Bt||(Bt=0,y.key1=0,y.p1=null),0==Bt?y=null:(y.pr=y.p1,y.okeyr=y.okey1,y.keyr=y.key1)}}}return y},lerp:function(n,e,i,t){if(0==i)return n;if(0==t)return e;var l=i-t,p=y.epsilon*y.epsilon>l*l?.5:i/l;return 0>p?p=0:p>1&&(p=1),n+p*(e-n)},xlerp:function(n,e,i,t,l,p,r){var a;if(0==t)a=n;else if(0==l)a=e;else{var s=t-l,o=y.epsilon*y.epsilon>s*s?.5:t/s;0>o?o=0:o>1&&(o=1),a=n+o*(e-n)}for(;0!=r--&&a>n&&e>a;){var _=p(a,i);if(0==_)break;if(0>t*_?(e=a,l=_):(n=a,t=_),0==t)a=n;else if(0==l)a=e;else{var h=t-l,u=y.epsilon*y.epsilon>h*h?.5:t/h;0>u?u=0:u>1&&(u=1),a=n+u*(e-n)}}return a},ylerp:function(n,e,i,t,l,p,r){var a;if(0==t)a=n;else if(0==l)a=e;else{var s=t-l,o=y.epsilon*y.epsilon>s*s?.5:t/s;0>o?o=0:o>1&&(o=1),a=n+o*(e-n)}for(;0!=r--&&a>n&&e>a;){var _=p(i,a);if(0==_)break;if(0>t*_?(e=a,l=_):(n=a,t=_),0==t)a=n;else if(0==l)a=e;else{var h=t-l,u=y.epsilon*y.epsilon>h*h?.5:t/h;0>u?u=0:u>1&&(u=1),a=n+u*(e-n)}}return a},__class__:pi};var ri=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};l["zpp_nape.geom.ZPP_Mat23"]=ri,ri.__name__=["zpp_nape","geom","ZPP_Mat23"],ri.get=function(){var n;return null==ri.zpp_pool?n=new ri:(n=ri.zpp_pool,ri.zpp_pool=n.next,n.next=null),n},ri.identity=function(){var n=ri.get();return n.setas(1,0,0,1,0,0),n},ri.prototype={outer:null,wrapper:function(){if(null==this.outer){this.outer=new bn;var n=this.outer.zpp_inner;n.next=ri.zpp_pool,ri.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},a:null,b:null,c:null,d:null,tx:null,ty:null,_invalidate:null,invalidate:function(){null!=this._invalidate&&this._invalidate()},set:function(n){this.setas(n.a,n.b,n.c,n.d,n.tx,n.ty)},setas:function(n,e,i,t,l,p){this.tx=l,this.ty=p,this.a=n,this.b=e,this.c=i,this.d=t},next:null,free:function(){},alloc:function(){},__class__:ri};var ai=function(n,e){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=n,this.n=e,this.x=[];for(var i=0,t=n*e;t>i;){i++;this.x.push(0)}};l["zpp_nape.geom.ZPP_MatMN"]=ai,ai.__name__=["zpp_nape","geom","ZPP_MatMN"],ai.prototype={outer:null,m:null,n:null,x:null,__class__:ai};var si=function(){};l["zpp_nape.geom.ZPP_Monotone"]=si,si.__name__=["zpp_nape","geom","ZPP_Monotone"],si.bisector=function(n){var e=n.prev,i=n.next,t=0,l=0;t=n.x-e.x,l=n.y-e.y;var p=0,r=0;p=i.x-n.x,r=i.y-n.y;var a;null==Mi.zpp_pool?a=new Mi:(a=Mi.zpp_pool,Mi.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=-l-r,a.y=t+p;var s=a,o=s.x*s.x+s.y*s.y,_=1/Math.sqrt(o),h=_;return s.x*=h,s.y*=h,0>r*t-p*l&&(s.x=-s.x,s.y=-s.y),s},si.below=function(n,e){if(e.y>n.y)return!0;if(n.y>e.y)return!1;if(e.x>n.x)return!0;if(n.x>e.x)return!1;var i=si.bisector(n),t=si.bisector(e);i.x+=1*n.x,i.y+=1*n.y;t.x+=1*e.x,t.y+=1*e.y;var l=t.x>i.x||i.x==t.x&&t.y>i.y,p=i;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Mi.zpp_pool,Mi.zpp_pool=p;var r=t;return null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,l},si.above=function(n,e){return si.below(e,n)},si.left_vertex=function(n){var e=n.prev;return e.y>n.y||e.y==n.y&&n.y>n.next.y},si.isMonotone=function(n){var e=n,i=n,t=n.next,l=n;if(null!=t)for(var p=t;;){var r=p;if(e.y>r.y&&(e=r),r.y>i.y&&(i=r),(p=p.next)==l)break}var a=!0,s=e;if(i!=e.next){var o=e.next,_=i;if(null!=o)for(var h=o;;){var u=h;if(s.y>u.y){a=!1;break}if(s=u,(h=h.next)==_)break}}if(!a)return!1;if(s=e,i!=e.prev){var x=e.prev,d=i;if(null!=x)for(var v=x;;){var z=v;if(s.y>z.y){a=!1;break}if(s=z,(v=v.prev)==d)break}}return a},si.sharedPPoly=null,si.getShared=function(){return null==si.sharedPPoly&&(si.sharedPPoly=new _i),si.sharedPPoly},si.decompose=function(n,e){if(null==e?e=new _i(n):e.init(n),null==e.vertices)return e;null==si.queue&&(si.queue=new at);var i=e.vertices,t=e.vertices;if(null!=i)for(var l=i;;){var p=l;si.queue.add(p);var r=0,a=0;r=p.next.x-p.x,a=p.next.y-p.y;var s=0,o=0;s=p.prev.x-p.x,o=p.prev.y-p.y;var _=o*r-s*a>0;if(p.type=si.below(p.prev,p)?si.below(p.next,p)?_?0:3:4:si.below(p,p.next)?_?1:2:4,(l=l.next)==t)break}var h=si.queue;if(null!=h.head&&null!=h.head.next){for(var u,x,d,v=h.head,z=null,c=null,m=null,y=null,f=1;;){for(u=0,c=v,v=null,z=v;null!=c;){for(++u,m=c,x=0,d=f;null!=m&&f>x;)++x,m=m.next;for(;x>0||d>0&&null!=m;)0==x?(y=m,m=m.next,--d):0==d||null==m?(y=c,c=c.next,--x):si.above(c.elt,m.elt)?(y=c,c=c.next,--x):(y=m,m=m.next,--d),null!=z?z.next=y:v=y,z=y;c=m}if(z.next=null,f<<=1,u<=1)break}h.head=v,h.modified=!0,h.pushmod=!0}if(null==si.edges){null==Ol.zpp_pool?si.edges=new Ol:(si.edges=Ol.zpp_pool,Ol.zpp_pool=si.edges.next,si.edges.next=null);si.edges.lt=oi.edge_lt,si.edges.swapped=oi.edge_swap}for(;null!=si.queue.head;){var b=si.queue.pop_unsafe();switch(b.type){case 0:b.helper=b,b.node=si.edges.insert(b);break;case 1:var g=b.prev;2==g.helper.type&&e.add_diagonal(b,g.helper),si.edges.remove_node(g.node),g.helper=null;break;case 2:var w=b.prev;2==w.helper.type&&e.add_diagonal(b,w.helper),si.edges.remove_node(w.node),w.helper=null;var M=null;if(!si.edges.empty()){for(var C=si.edges.parent;null!=C.prev;)C=C.prev;for(;null!=C;){var k=C.data;if(!oi.vert_lt(k,b)){M=k;break}if(null!=C.next)for(C=C.next;null!=C.prev;)C=C.prev;else{for(;null!=C.parent&&C==C.parent.next;)C=C.parent;C=C.parent}}}var O=M;null!=O&&(2==O.helper.type&&e.add_diagonal(b,O.helper),O.helper=b);break;case 3:var I=null;if(!si.edges.empty()){for(var S=si.edges.parent;null!=S.prev;)S=S.prev;for(;null!=S;){var P=S.data;if(!oi.vert_lt(P,b)){I=P;break}if(null!=S.next)for(S=S.next;null!=S.prev;)S=S.prev;else{for(;null!=S.parent&&S==S.parent.next;)S=S.parent;S=S.parent}}}var T=I;null!=T&&(e.add_diagonal(b,T.helper),T.helper=b),b.node=si.edges.insert(b),b.helper=b;break;case 4:var A=b.prev;if(si.left_vertex(b))2==A.helper.type&&e.add_diagonal(b,A.helper),si.edges.remove_node(A.node),A.helper=null,b.node=si.edges.insert(b),b.helper=b;else{var E=null;if(!si.edges.empty()){for(var N=si.edges.parent;null!=N.prev;)N=N.prev;for(;null!=N;){var L=N.data;if(!oi.vert_lt(L,b)){E=L;break}if(null!=N.next)for(N=N.next;null!=N.prev;)N=N.prev;else{for(;null!=N.parent&&N==N.parent.next;)N=N.parent;N=N.parent}}}var V=E;2==V.helper.type&&e.add_diagonal(b,V.helper),V.helper=b}}}return e};var oi=function Jl(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=Jl.nextId++,this.diagonals=new at};l["zpp_nape.geom.ZPP_PartitionVertex"]=oi,oi.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],oi.get=function(n){var e;return null==oi.zpp_pool?e=new oi:(e=oi.zpp_pool,oi.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e},oi.rightdistance=function(n,e){var i=n.next.y>n.y,t=0,l=0;t=n.next.x-n.x,l=n.next.y-n.y;var p=0,r=0;return p=e.x-n.x,r=e.y-n.y,(i?-1:1)*(r*t-p*l)},oi.vert_lt=function(n,e){if(e==n||e==n.next)return!0;if(n.y==n.next.y){var i=n.x,t=n.next.x;return e.x>=(t>i?i:t)}return 0>=oi.rightdistance(n,e)},oi.edge_swap=function(n,e){var i=n.node;n.node=e.node,e.node=i},oi.edge_lt=function(n,e){if(n==e&&n.next==e.next)return!1;if(n==e.next)return!oi.vert_lt(n,e);if(e==n.next)return oi.vert_lt(e,n);if(n.y==n.next.y){if(e.y==e.next.y){var i=n.x,t=n.next.x,l=e.x,p=e.next.x;return(i>t?i:t)>(l>p?l:p)}return oi.rightdistance(e,n)>0||oi.rightdistance(e,n.next)>0}var r=oi.rightdistance(n,e),a=oi.rightdistance(n,e.next);if(0==r&&0==a){var s=n.x,o=n.next.x,_=e.x,h=e.next.x;return(s>o?s:o)>(_>h?_:h)}if(r*a>=0)return 0>r||0>a;var u=oi.rightdistance(e,n),x=oi.rightdistance(e,n.next);return u*x>=0&&(u>0||x>0)},oi.prototype={id:null,mag:null,x:null,y:null,forced:null,diagonals:null,type:null,helper:null,rightchain:null,next:null,prev:null,alloc:function(){},free:function(){this.helper=null},copy:function(){var n;return null==oi.zpp_pool?n=new oi:(n=oi.zpp_pool,oi.zpp_pool=n.next,n.next=null),n.x=this.x,n.y=this.y,n.forced=this.forced,n},sort:function(){var n=0,e=0,i=0,t=0;n=this.prev.x-this.x,e=this.prev.y-this.y,i=this.next.x-this.x,t=this.next.y-this.y;var l=t*n-i*e,p=l>0?-1:0==l?0:1,r=this.diagonals;if(null!=r.head&&null!=r.head.next){for(var a,s,o,_=r.head,h=null,u=null,x=null,d=null,v=1;;){for(a=0,u=_,_=null,h=_;null!=u;){for(++a,x=u,s=0,o=v;null!=x&&v>s;)++s,x=x.next;for(;s>0||o>0&&null!=x;){if(0==s)d=x,x=x.next,--o;else if(0==o||null==x)d=u,u=u.next,--s;else{var z;if(1==p){n=u.elt.x-this.x,e=u.elt.y-this.y,i=x.elt.x-this.x,t=x.elt.y-this.y;var c=t*n-i*e;z=1==(c>0?-1:0==c?0:1)}else{n=this.prev.x-this.x,e=this.prev.y-this.y,i=u.elt.x-this.x,t=u.elt.y-this.y;var m=t*n-i*e,y=m>0?-1:0==m?0:1;n=this.prev.x-this.x,e=this.prev.y-this.y,i=x.elt.x-this.x,t=x.elt.y-this.y;var f=t*n-i*e,b=f>0?-1:0==f?0:1;if(y*b==1||y*b==0&&(1==y||1==b)){n=u.elt.x-this.x,e=u.elt.y-this.y,i=x.elt.x-this.x,t=x.elt.y-this.y;var g=t*n-i*e;z=1==(g>0?-1:0==g?0:1)}else if(-1==y||-1==b)z=-1==b;else if(0==y&&0==b){n=this.x-this.prev.x,e=this.y-this.prev.y,i=u.elt.x-this.x,t=u.elt.y-this.y;var w=n*i+e*t;i=x.elt.x-this.x,t=x.elt.y-this.y;var M=n*i+e*t;z=0>w&&M>0||(M>=0||0>=w)}else z=!0}z?(d=u,u=u.next,--s):(d=x,x=x.next,--o)}null!=h?h.next=d:_=d,h=d}u=x}if(h.next=null,v<<=1,a<=1)break}r.head=_,r.modified=!0,r.pushmod=!0}},node:null,__class__:oi};var _i=function(n){this.next=null,this.vertices=null,this.init(n)};l["zpp_nape.geom.ZPP_PartitionedPoly"]=_i,_i.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],_i.sharedPPList=null,_i.getSharedPP=function(){return null==_i.sharedPPList&&(_i.sharedPPList=new st),_i.sharedPPList},_i.sharedGVList=null,_i.getShared=function(){return null==_i.sharedGVList&&(_i.sharedGVList=new ot),_i.sharedGVList},_i.prototype={vertices:null,eq:function(n,e){var i=0,t=0;return i=n.x-e.x,t=n.y-e.y,y.epsilon*y.epsilon>i*i+t*t},next:null,alloc:function(){},free:function(){},init:function(n){if(null!=n){var e=0,i=n,t=n;if(null!=i)for(var l=i;;){var p=l;if(e+=p.x*(p.next.y-p.prev.y),(l=l.next)==t)break}for(var r=.5*e>0,a=n;;){var s;if(r){var o;null==oi.zpp_pool?o=new oi:(o=oi.zpp_pool,oi.zpp_pool=o.next,o.next=null),o.x=a.x,o.y=a.y;var _=o;null==this.vertices?this.vertices=_.prev=_.next=_:(_.prev=this.vertices,_.next=this.vertices.next,this.vertices.next.prev=_,this.vertices.next=_),s=_}else{var h;null==oi.zpp_pool?h=new oi:(h=oi.zpp_pool,oi.zpp_pool=h.next,h.next=null),h.x=a.x,h.y=a.y;var u=h;null==this.vertices?this.vertices=u.prev=u.next=u:(u.next=this.vertices,u.prev=this.vertices.prev,this.vertices.prev.next=u,this.vertices.prev=u),s=u}if(this.vertices=s,this.vertices.forced=a.forced,(a=a.next)==n)break}this.remove_collinear_vertices()}},remove_collinear_vertices:function(){for(var n=this.vertices,e=!0;e||n!=this.vertices;)if(e=!1,this.eq(n,n.next)){if(n==this.vertices&&(this.vertices=n.next,e=!0),n.forced&&(n.next.forced=!0),null!=n&&n.prev==n){n.next=n.prev=null;var i=n;i.helper=null,i.next=oi.zpp_pool,oi.zpp_pool=i,n=null,n=n}else{var t=n.next;n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null;var l=n;l.helper=null,l.next=oi.zpp_pool,oi.zpp_pool=l,n=null,n=t}if(null==n){this.vertices=null;break}}else n=n.next;if(null==this.vertices)return!0;for(var p;;){for(p=!1,n=this.vertices,e=!0;e||n!=this.vertices;){e=!1;var r=n.prev,a=0,s=0;a=n.x-r.x,s=n.y-r.y;var o=0,_=0;o=n.next.x-n.x,_=n.next.y-n.y;var h=_*a-o*s;if(h*h<y.epsilon*y.epsilon){if(n==this.vertices&&(this.vertices=n.next,e=!0),null!=n&&n.prev==n){n.next=n.prev=null;var u=n;u.helper=null,u.next=oi.zpp_pool,oi.zpp_pool=u,n=null,n=n}else{var x=n.next;n.prev.next=n.next,n.next.prev=n.prev,n.next=n.prev=null;var d=n;d.helper=null,d.next=oi.zpp_pool,oi.zpp_pool=d,n=null,n=x}if(p=!0,null==n){p=!1,this.vertices=null;break}}else n=n.next}if(!p)break}return null==this.vertices},add_diagonal:function(n,e){n.diagonals.add(e),e.diagonals.add(n),n.forced=e.forced=!0},extract_partitions:function(n){if(null==n&&(n=new st),null!=this.vertices){var e=this.vertices,i=this.vertices;if(null!=e)for(var t=e;;){var l=t;if(l.sort(),(t=t.next)==i)break}for(this.pull_partitions(this.vertices,n);null!=this.vertices;){var p;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var r=this.vertices;r.helper=null,r.next=oi.zpp_pool,oi.zpp_pool=r,p=this.vertices=null}else{var a=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var s=this.vertices;s.helper=null,s.next=oi.zpp_pool,oi.zpp_pool=s,this.vertices=null,p=a}this.vertices=p}for(var o=null,_=n.head;null!=_;){_.elt.remove_collinear_vertices()?n.erase(o):(o=_,_=_.next)}}return n},pull_partitions:function(n,e){var i;null==_i.zpp_pool?i=new _i:(i=_i.zpp_pool,_i.zpp_pool=i.next,i.next=null);for(var t=n;;){var l;null==oi.zpp_pool?l=new oi:(l=oi.zpp_pool,oi.zpp_pool=l.next,l.next=null),l.x=t.x,l.y=t.y,l.forced=t.forced;var p=l;if(null==i.vertices?i.vertices=p.prev=p.next=p:(p.prev=i.vertices,p.next=i.vertices.next,i.vertices.next.prev=p,i.vertices.next=p),i.vertices=p,i.vertices.forced=t.forced,null!=t.diagonals.head){var r=t.diagonals,a=r.head.elt;r.pop();if(a==n)break;t=this.pull_partitions(t,e)}else t=t.next;if(t==n)break}var s=0,o=i.vertices,_=i.vertices;if(null!=o)for(var h=o;;){var u=h;if(s+=u.x*(u.next.y-u.prev.y),(h=h.next)==_)break}return.5*s!=0&&e.add(i),t},extract:function(n){if(null==n&&(n=new ot),null!=this.vertices){var e=this.vertices,i=this.vertices;if(null!=e)for(var t=e;;){var l=t;if(l.sort(),(t=t.next)==i)break}for(this.pull(this.vertices,n);null!=this.vertices;){var p;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var r=this.vertices;r.helper=null,r.next=oi.zpp_pool,oi.zpp_pool=r,p=this.vertices=null}else{var a=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var s=this.vertices;s.helper=null,s.next=oi.zpp_pool,oi.zpp_pool=s,this.vertices=null,p=a}this.vertices=p}}return n},pull:function(n,e){for(var i=null,t=n;;){var l,p=t.x,r=t.y;null==ni.zpp_pool?l=new ni:(l=ni.zpp_pool,ni.zpp_pool=l.next,l.next=null),l.forced=!1,l.x=p,l.y=r;var a=l;if(null==i?i=a.prev=a.next=a:(a.prev=i,a.next=i.next,i.next.prev=a,i.next=a),i=a,i.forced=t.forced,null!=t.diagonals.head){var s=t.diagonals,o=s.head.elt;s.pop();if(o==n)break;t=this.pull(t,e)}else t=t.next;if(t==n)break}var _=0,h=i,u=i;if(null!=h)for(var x=h;;){var d=x;if(_+=d.x*(d.next.y-d.prev.y),(x=x.next)==u)break}var v=.5*_;if(v*v>=y.epsilon*y.epsilon){for(var z=i,c=!0;c||z!=i;){c=!1;var m=0,f=0;if(m=z.x-z.next.x,f=z.y-z.next.y,y.epsilon*y.epsilon>m*m+f*f){if(z==i&&(i=z.next,c=!0),z.forced&&(z.next.forced=!0),null!=z&&z.prev==z)z.next=z.prev=null,z=null,z=z;else{var b=z.next;z.prev.next=z.next,z.next.prev=z.prev,z.next=z.prev=null,z=null,z=b}if(null==z){i=null;break}}else z=z.next}if(null!=i)for(var g;;){for(g=!1,z=i,c=!0;c||z!=i;){c=!1;var w=z.prev,M=0,C=0;M=z.x-w.x,C=z.y-w.y;var k=0,O=0;k=z.next.x-z.x,O=z.next.y-z.y;var I=O*M-k*C;if(I*I<y.epsilon*y.epsilon){if(z==i&&(i=z.next,c=!0),null!=z&&z.prev==z)z.next=z.prev=null,z=null,z=z;else{var S=z.next;z.prev.next=z.next,z.next.prev=z.prev,z.next=z.prev=null,z=null,z=S}if(g=!0,null==z){g=!1,i=null;break}}else z=z.next}if(!g)break}null!=i&&e.add(i)}return t},__class__:_i};var hi=function(){this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,this.origin=null;var n;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.weak=!1,e._immutable=!1,e.x=0,e.y=0,n.zpp_inner=e,n.zpp_inner.outer=n}else{var t=n.zpp_inner;null!=t._isimmutable&&t._isimmutable();var l,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),l=0==n.zpp_inner.y}else l=!1;if(!l){n.zpp_inner.x=0,n.zpp_inner.y=0;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.origin=n,this.origin.zpp_inner._invalidate=i(this,this.origin_invalidate);var s;if(null==Ml.poolVec2?s=new On:(s=Ml.poolVec2,Ml.poolVec2=s.zpp_pool,s.zpp_pool=null,s.zpp_disp=!1,s==Ml.nextVec2&&(Ml.nextVec2=null)),null==s.zpp_inner){var o;null==Mi.zpp_pool?o=new Mi:(o=Mi.zpp_pool,Mi.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=0,o.y=0,s.zpp_inner=o,s.zpp_inner.outer=s}else{var _=s.zpp_inner;null!=_._isimmutable&&_._isimmutable();var h,u=s.zpp_inner;if(null!=u._validate&&u._validate(),0==s.zpp_inner.x){var x=s.zpp_inner;null!=x._validate&&x._validate(),h=0==s.zpp_inner.y}else h=!1;if(!h){s.zpp_inner.x=0,s.zpp_inner.y=0;var d=s.zpp_inner;null!=d._invalidate&&d._invalidate(d)}}s.zpp_inner.weak=!1,this.direction=s,this.direction.zpp_inner._invalidate=i(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};l["zpp_nape.geom.ZPP_Ray"]=hi,hi.__name__=["zpp_nape","geom","ZPP_Ray"],hi.prototype={origin:null,direction:null,maxdist:null,userData:null,originx:null,originy:null,dirx:null,diry:null,idirx:null,idiry:null,normalx:null,normaly:null,absnormalx:null,absnormaly:null,origin_invalidate:function(n){this.originx=n.x,this.originy=n.y},direction_invalidate:function(n){this.dirx=n.x,this.diry=n.y,this.zip_dir=!0},zip_dir:null,invalidate_dir:function(){this.zip_dir=!0},validate_dir:function(){if(this.zip_dir){this.zip_dir=!1;var n=this.dirx*this.dirx+this.diry*this.diry,e=1/Math.sqrt(n),i=e;this.dirx*=i,this.diry*=i,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx;var t=this.normalx;this.absnormalx=0>t?-t:t;var l=this.normaly;this.absnormaly=0>l?-l:l}},rayAABB:function(){var n=this.originx,e=n,i=this.originy,t=i;if(this.maxdist<Infinity?(e+=this.maxdist*this.dirx,t+=this.maxdist*this.diry):(this.dirx>0?e=Infinity:0>this.dirx&&(e=-Infinity),this.diry>0?t=Infinity:0>this.diry&&(t=-Infinity)),n>e){var l=n;n=e,e=l}if(i>t){var p=i;i=t,t=p}var r;return null==qe.zpp_pool?r=new qe:(r=qe.zpp_pool,qe.zpp_pool=r.next,r.next=null),r.minx=n,r.miny=i,r.maxx=e,r.maxy=t,r},aabbtest:function(n){var e=this.normalx*(this.originx-.5*(n.minx+n.maxx))+this.normaly*(this.originy-.5*(n.miny+n.maxy)),i=.5*this.absnormalx*(n.maxx-n.minx)+.5*this.absnormaly*(n.maxy-n.miny),t=e;return i>(0>t?-t:t)},aabbsect:function(n){var e=this.originx>=n.minx&&n.maxx>=this.originx,i=this.originy>=n.miny&&n.maxy>=this.originy;if(e&&i)return 0;for(var t=-1;(0>this.dirx||n.maxx>this.originx)&&(this.dirx>0||this.originx>n.minx)&&(0>this.diry||n.maxy>this.originy)&&(this.diry>0||this.originy>n.miny);){if(this.dirx>0){var l=(n.minx-this.originx)*this.idirx;if(l>=0&&this.maxdist>=l){var p=this.originy+l*this.diry;if(p>=n.miny&&n.maxy>=p){t=l;break}}}else if(0>this.dirx){var r=(n.maxx-this.originx)*this.idirx;if(r>=0&&this.maxdist>=r){var a=this.originy+r*this.diry;if(a>=n.miny&&n.maxy>=a){t=r;break}}}if(this.diry>0){var s=(n.miny-this.originy)*this.idiry;if(s>=0&&this.maxdist>=s){var o=this.originx+s*this.dirx;if(o>=n.minx&&n.maxx>=o){t=s;break}}}else if(0>this.diry){var _=(n.maxy-this.originy)*this.idiry;if(_>=0&&this.maxdist>=_){var h=this.originx+_*this.dirx;if(h>=n.minx&&n.maxx>=h){t=_;break}}}break}return t},circlesect:function(n,e,i){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,p=t.lverts.next,r=p;p=p.next;var a=p;for(p=p.next;null!=p;){var s=p;l+=a.x*(s.y-r.y);var o=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*o,t.localCOMy+=(a.y+s.y)*o,r=a,a=s,p=p.next}p=t.lverts.next;var _=p;l+=a.x*(_.y-r.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h,r=a,a=_,p=p.next;var u=p;l+=a.x*(u.y-r.y);var x=u.y*a.x-u.x*a.y;t.localCOMx+=(a.x+u.x)*x,t.localCOMy+=(a.y+u.y)*x,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var v=n.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=0,c=0;z=this.originx-n.worldCOMx,c=this.originy-n.worldCOMy;var m=this.dirx*this.dirx+this.diry*this.diry,y=2*(z*this.dirx+c*this.diry),f=z*z+c*c-n.radius*n.radius,b=y*y-4*m*f;if(0==b){var g=-y/2*m;if(e&&0>=f||0>=g||g>=i||g>this.maxdist)return null;var w=0,M=0;w=this.originx,M=this.originy;var C=g;w+=this.dirx*C,M+=this.diry*C;w-=1*n.worldCOMx,M-=1*n.worldCOMy;var k=w*w+M*M,O=1/Math.sqrt(k),I=O;w*=I,M*=I,f>0||(w=-w,M=-M);var S;if(null==Ml.poolVec2?S=new On:(S=Ml.poolVec2,Ml.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==Ml.nextVec2&&(Ml.nextVec2=null)),null==S.zpp_inner){var P;null==Mi.zpp_pool?P=new Mi:(P=Mi.zpp_pool,Mi.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=w,P.y=M,S.zpp_inner=P,S.zpp_inner.outer=S}else{var T=S.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A,E=S.zpp_inner;if(null!=E._validate&&E._validate(),S.zpp_inner.x==w){var N=S.zpp_inner;null!=N._validate&&N._validate(),A=S.zpp_inner.y==M}else A=!1;if(!A){S.zpp_inner.x=w,S.zpp_inner.y=M;var L=S.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}return S.zpp_inner.weak=!1,Je.getRay(S,g,0>=f,n.outer)}b=Math.sqrt(b),m=1/(2*m);var V=(-y-b)*m,j=(-y+b)*m;if(V>0){if(i>V&&this.maxdist>=V){var D=0,F=0;D=this.originx,F=this.originy;var R=V;D+=this.dirx*R,F+=this.diry*R;D-=1*n.worldCOMx,F-=1*n.worldCOMy;var B=D*D+F*F,G=1/Math.sqrt(B),Z=G;D*=Z,F*=Z;var U;if(null==Ml.poolVec2?U=new On:(U=Ml.poolVec2,Ml.poolVec2=U.zpp_pool,U.zpp_pool=null,U.zpp_disp=!1,U==Ml.nextVec2&&(Ml.nextVec2=null)),null==U.zpp_inner){var q;null==Mi.zpp_pool?q=new Mi:(q=Mi.zpp_pool,Mi.zpp_pool=q.next,q.next=null),q.weak=!1,q._immutable=!1,q.x=D,q.y=F,U.zpp_inner=q,U.zpp_inner.outer=U}else{var Y=U.zpp_inner;null!=Y._isimmutable&&Y._isimmutable();var K,W=U.zpp_inner;if(null!=W._validate&&W._validate(),U.zpp_inner.x==D){var J=U.zpp_inner;null!=J._validate&&J._validate(),K=U.zpp_inner.y==F}else K=!1;if(!K){U.zpp_inner.x=D,U.zpp_inner.y=F;var X=U.zpp_inner;null!=X._invalidate&&X._invalidate(X)}}return U.zpp_inner.weak=!1,Je.getRay(U,V,!1,n.outer)}return null}if(j>0&&e){if(i>j&&this.maxdist>=j){var H=0,Q=0;H=this.originx,Q=this.originy;var $=j;H+=this.dirx*$,Q+=this.diry*$;H-=1*n.worldCOMx,Q-=1*n.worldCOMy;var nn=H*H+Q*Q,en=1/Math.sqrt(nn),tn=en;H*=tn,Q*=tn,H=-H,Q=-Q;var ln;if(null==Ml.poolVec2?ln=new On:(ln=Ml.poolVec2,Ml.poolVec2=ln.zpp_pool,ln.zpp_pool=null,ln.zpp_disp=!1,ln==Ml.nextVec2&&(Ml.nextVec2=null)),null==ln.zpp_inner){var pn;null==Mi.zpp_pool?pn=new Mi:(pn=Mi.zpp_pool,Mi.zpp_pool=pn.next,pn.next=null),pn.weak=!1,pn._immutable=!1,pn.x=H,pn.y=Q,ln.zpp_inner=pn,ln.zpp_inner.outer=ln}else{var rn=ln.zpp_inner;null!=rn._isimmutable&&rn._isimmutable();var an,sn=ln.zpp_inner;if(null!=sn._validate&&sn._validate(),ln.zpp_inner.x==H){var on=ln.zpp_inner;null!=on._validate&&on._validate(),an=ln.zpp_inner.y==Q}else an=!1;if(!an){ln.zpp_inner.x=H,ln.zpp_inner.y=Q;var _n=ln.zpp_inner;null!=_n._invalidate&&_n._invalidate(_n)}}return ln.zpp_inner.weak=!1,Je.getRay(ln,j,!0,n.outer)}return null}return null},circlesect2:function(n,e,i){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var t=n.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,p=t.lverts.next,r=p;p=p.next;var a=p;for(p=p.next;null!=p;){var s=p;l+=a.x*(s.y-r.y);var o=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*o,t.localCOMy+=(a.y+s.y)*o,r=a,a=s,p=p.next}p=t.lverts.next;var _=p;l+=a.x*(_.y-r.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h,r=a,a=_,p=p.next;var u=p;l+=a.x*(u.y-r.y);var x=u.y*a.x-u.x*a.y;t.localCOMx+=(a.x+u.x)*x,t.localCOMy+=(a.y+u.y)*x,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var v=n.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z=0,c=0;z=this.originx-n.worldCOMx,c=this.originy-n.worldCOMy;var m=this.dirx*this.dirx+this.diry*this.diry,y=2*(z*this.dirx+c*this.diry),f=z*z+c*c-n.radius*n.radius,b=y*y-4*m*f;if(0==b){var g=-y/2*m;if((!e||f>0)&&g>0&&this.maxdist>=g){var w=0,M=0;w=this.originx,M=this.originy;var C=g;w+=this.dirx*C,M+=this.diry*C;w-=1*n.worldCOMx,M-=1*n.worldCOMy;var k=w*w+M*M,O=1/Math.sqrt(k),I=O;w*=I,M*=I,f>0||(w=-w,M=-M);var S;if(null==Ml.poolVec2?S=new On:(S=Ml.poolVec2,Ml.poolVec2=S.zpp_pool,S.zpp_pool=null,S.zpp_disp=!1,S==Ml.nextVec2&&(Ml.nextVec2=null)),null==S.zpp_inner){var P;null==Mi.zpp_pool?P=new Mi:(P=Mi.zpp_pool,Mi.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=w,P.y=M,S.zpp_inner=P,S.zpp_inner.outer=S}else{var T=S.zpp_inner;null!=T._isimmutable&&T._isimmutable();var A,E=S.zpp_inner;if(null!=E._validate&&E._validate(),S.zpp_inner.x==w){var N=S.zpp_inner;null!=N._validate&&N._validate(),A=S.zpp_inner.y==M}else A=!1;if(!A){S.zpp_inner.x=w,S.zpp_inner.y=M;var L=S.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}S.zpp_inner.weak=!1;for(var V=Je.getRay(S,g,0>=f,n.outer),j=null,D=i.zpp_inner.inner.head;null!=D;){var F=D.elt;if(F.zpp_inner.toiDistance>V.zpp_inner.toiDistance)break;j=D,D=D.next}var R,B=i.zpp_inner.inner;null==rl.zpp_pool?R=new rl:(R=rl.zpp_pool,rl.zpp_pool=R.next,R.next=null),R.elt=V;var G=R;null==j?(G.next=B.head,B.head=G):(G.next=j.next,j.next=G),B.pushmod=B.modified=!0,B.length++}}else{b=Math.sqrt(b),m=1/(2*m);var Z=(-y-b)*m,U=(-y+b)*m;if(Z>0&&this.maxdist>=Z){var q=0,Y=0;q=this.originx,Y=this.originy;var K=Z;q+=this.dirx*K,Y+=this.diry*K;q-=1*n.worldCOMx,Y-=1*n.worldCOMy;var W=q*q+Y*Y,J=1/Math.sqrt(W),X=J;q*=X,Y*=X;var H;if(null==Ml.poolVec2?H=new On:(H=Ml.poolVec2,Ml.poolVec2=H.zpp_pool,H.zpp_pool=null,H.zpp_disp=!1,H==Ml.nextVec2&&(Ml.nextVec2=null)),null==H.zpp_inner){var Q;null==Mi.zpp_pool?Q=new Mi:(Q=Mi.zpp_pool,Mi.zpp_pool=Q.next,Q.next=null),Q.weak=!1,Q._immutable=!1,Q.x=q,Q.y=Y,H.zpp_inner=Q,H.zpp_inner.outer=H}else{var $=H.zpp_inner;null!=$._isimmutable&&$._isimmutable();var nn,en=H.zpp_inner;if(null!=en._validate&&en._validate(),H.zpp_inner.x==q){var tn=H.zpp_inner;null!=tn._validate&&tn._validate(),nn=H.zpp_inner.y==Y}else nn=!1;if(!nn){H.zpp_inner.x=q,H.zpp_inner.y=Y;var ln=H.zpp_inner;null!=ln._invalidate&&ln._invalidate(ln)}}H.zpp_inner.weak=!1;for(var pn=Je.getRay(H,Z,!1,n.outer),rn=null,an=i.zpp_inner.inner.head;null!=an;){var sn=an.elt;if(sn.zpp_inner.toiDistance>pn.zpp_inner.toiDistance)break;rn=an,an=an.next}var on,_n=i.zpp_inner.inner;null==rl.zpp_pool?on=new rl:(on=rl.zpp_pool,rl.zpp_pool=on.next,on.next=null),on.elt=pn;var hn=on;null==rn?(hn.next=_n.head,_n.head=hn):(hn.next=rn.next,rn.next=hn),_n.pushmod=_n.modified=!0,_n.length++}if(U>0&&this.maxdist>=U&&e){var un=0,xn=0;un=this.originx,xn=this.originy;var dn=U;un+=this.dirx*dn,xn+=this.diry*dn;un-=1*n.worldCOMx,xn-=1*n.worldCOMy;var vn=un*un+xn*xn,zn=1/Math.sqrt(vn),cn=zn;un*=cn,xn*=cn,un=-un,xn=-xn;var mn;if(null==Ml.poolVec2?mn=new On:(mn=Ml.poolVec2,Ml.poolVec2=mn.zpp_pool,mn.zpp_pool=null,mn.zpp_disp=!1,mn==Ml.nextVec2&&(Ml.nextVec2=null)),null==mn.zpp_inner){var yn;null==Mi.zpp_pool?yn=new Mi:(yn=Mi.zpp_pool,Mi.zpp_pool=yn.next,yn.next=null),yn.weak=!1,yn._immutable=!1,yn.x=un,yn.y=xn,mn.zpp_inner=yn,mn.zpp_inner.outer=mn}else{var fn=mn.zpp_inner;null!=fn._isimmutable&&fn._isimmutable();var bn,gn=mn.zpp_inner;if(null!=gn._validate&&gn._validate(),mn.zpp_inner.x==un){var wn=mn.zpp_inner;null!=wn._validate&&wn._validate(),bn=mn.zpp_inner.y==xn}else bn=!1;if(!bn){mn.zpp_inner.x=un,mn.zpp_inner.y=xn;var Mn=mn.zpp_inner;null!=Mn._invalidate&&Mn._invalidate(Mn)}}mn.zpp_inner.weak=!1;for(var Cn=Je.getRay(mn,U,!0,n.outer),kn=null,In=i.zpp_inner.inner.head;null!=In;){var Sn=In.elt;if(Sn.zpp_inner.toiDistance>Cn.zpp_inner.toiDistance)break;kn=In,In=In.next}var Pn,Tn=i.zpp_inner.inner;null==rl.zpp_pool?Pn=new rl:(Pn=rl.zpp_pool,rl.zpp_pool=Pn.next,Pn.next=null),Pn.elt=Cn;var An=Pn;null==kn?(An.next=Tn.head,Tn.head=An):(An.next=kn.next,kn.next=An),Tn.pushmod=Tn.modified=!0,Tn.length++}}},polysect:function(n,e,i){for(var t=i,l=null,p=n.edges.head,r=n.gverts.next,a=r,s=r.next;null!=s;){var o=s,_=p.elt;if(e||0>_.gnormx*this.dirx+_.gnormy*this.diry){var h=0,u=0;h=o.x-a.x,u=o.y-a.y;var x=0,d=0;x=a.x-this.originx,d=a.y-this.originy;var v=u*this.dirx-h*this.diry;if(v*v>y.epsilon){v=1/v;var z=(u*x-h*d)*v;if(z>0&&t>z&&this.maxdist>=z){var c=(this.diry*x-this.dirx*d)*v;c>-y.epsilon&&1+y.epsilon>c&&(t=z,l=p.elt)}}}p=p.next,r=s,a=o,s=s.next}for(;;){s=n.gverts.next;var m=s,f=p.elt;if(e||0>f.gnormx*this.dirx+f.gnormy*this.diry){var b=0,g=0;b=m.x-a.x,g=m.y-a.y;var w=0,M=0;w=a.x-this.originx,M=a.y-this.originy;var C=g*this.dirx-b*this.diry;if(C*C>y.epsilon){C=1/C;var k=(g*w-b*M)*C;if(k>0&&t>k&&this.maxdist>=k){var O=(this.diry*w-this.dirx*M)*C;O>-y.epsilon&&1+y.epsilon>O&&(t=k,l=p.elt)}}}p=p.next;break}if(null!=l){var I=0,S=0;I=l.gnormx,S=l.gnormy;var P=I*this.dirx+S*this.diry>0;P&&(I=-I,S=-S);var T;if(null==Ml.poolVec2?T=new On:(T=Ml.poolVec2,Ml.poolVec2=T.zpp_pool,T.zpp_pool=null,T.zpp_disp=!1,T==Ml.nextVec2&&(Ml.nextVec2=null)),null==T.zpp_inner){var A;null==Mi.zpp_pool?A=new Mi:(A=Mi.zpp_pool,Mi.zpp_pool=A.next,A.next=null),A.weak=!1,A._immutable=!1,A.x=I,A.y=S,T.zpp_inner=A,T.zpp_inner.outer=T}else{var E=T.zpp_inner;null!=E._isimmutable&&E._isimmutable();var N,L=T.zpp_inner;if(null!=L._validate&&L._validate(),T.zpp_inner.x==I){var V=T.zpp_inner;null!=V._validate&&V._validate(),N=T.zpp_inner.y==S}else N=!1;if(!N){T.zpp_inner.x=I,T.zpp_inner.y=S;var j=T.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}return T.zpp_inner.weak=!1,Je.getRay(T,t,P,n.outer)}return null},polysect2:function(n,e,i){for(var t=Infinity,l=-1,p=null,r=null,a=n.edges.head,s=n.gverts.next,o=s,_=s.next;null!=_;){var h=_,u=a.elt;if(e||0>u.gnormx*this.dirx+u.gnormy*this.diry){var x=0,d=0;x=h.x-o.x,d=h.y-o.y;var v=0,z=0;v=o.x-this.originx,z=o.y-this.originy;var c=d*this.dirx-x*this.diry;if(c*c>y.epsilon){c=1/c;var m=(d*v-x*z)*c;if(m>0&&this.maxdist>=m&&(t>m||m>l)){var f=(this.diry*v-this.dirx*z)*c;f>-y.epsilon&&1+y.epsilon>f&&(t>m&&(t=m,p=a.elt),m>l&&(l=m,r=a.elt))}}}a=a.next,s=_,o=h,_=_.next}for(;;){_=n.gverts.next;var b=_,g=a.elt;if(e||0>g.gnormx*this.dirx+g.gnormy*this.diry){var w=0,M=0;w=b.x-o.x,M=b.y-o.y;var C=0,k=0;C=o.x-this.originx,k=o.y-this.originy;var O=M*this.dirx-w*this.diry;if(O*O>y.epsilon){O=1/O;var I=(M*C-w*k)*O;if(I>0&&this.maxdist>=I&&(t>I||I>l)){var S=(this.diry*C-this.dirx*k)*O;S>-y.epsilon&&1+y.epsilon>S&&(t>I&&(t=I,p=a.elt),I>l&&(l=I,r=a.elt))}}}a=a.next;break}if(null!=p){var P=0,T=0;P=p.gnormx,T=p.gnormy;var A=P*this.dirx+T*this.diry>0;A&&(P=-P,T=-T);var E;if(null==Ml.poolVec2?E=new On:(E=Ml.poolVec2,Ml.poolVec2=E.zpp_pool,E.zpp_pool=null,E.zpp_disp=!1,E==Ml.nextVec2&&(Ml.nextVec2=null)),null==E.zpp_inner){var N;null==Mi.zpp_pool?N=new Mi:(N=Mi.zpp_pool,Mi.zpp_pool=N.next,N.next=null),N.weak=!1,N._immutable=!1,N.x=P,N.y=T,E.zpp_inner=N,E.zpp_inner.outer=E}else{var L=E.zpp_inner;null!=L._isimmutable&&L._isimmutable();var V,j=E.zpp_inner;if(null!=j._validate&&j._validate(),E.zpp_inner.x==P){var D=E.zpp_inner;null!=D._validate&&D._validate(),V=E.zpp_inner.y==T}else V=!1;if(!V){E.zpp_inner.x=P,E.zpp_inner.y=T;var F=E.zpp_inner;null!=F._invalidate&&F._invalidate(F)}}E.zpp_inner.weak=!1;for(var R=Je.getRay(E,t,A,n.outer),B=null,G=i.zpp_inner.inner.head;null!=G;){var Z=G.elt;if(Z.zpp_inner.toiDistance>R.zpp_inner.toiDistance)break;B=G,G=G.next}var U,q=i.zpp_inner.inner;null==rl.zpp_pool?U=new rl:(U=rl.zpp_pool,rl.zpp_pool=U.next,U.next=null),U.elt=R;var Y=U;null==B?(Y.next=q.head,q.head=Y):(Y.next=B.next,B.next=Y),q.pushmod=q.modified=!0,q.length++}if(null!=r&&p!=r){var K=0,W=0;K=r.gnormx,W=r.gnormy;var J=K*this.dirx+W*this.diry>0;J&&(K=-K,W=-W);var X;if(null==Ml.poolVec2?X=new On:(X=Ml.poolVec2,Ml.poolVec2=X.zpp_pool,X.zpp_pool=null,X.zpp_disp=!1,X==Ml.nextVec2&&(Ml.nextVec2=null)),null==X.zpp_inner){var H;null==Mi.zpp_pool?H=new Mi:(H=Mi.zpp_pool,Mi.zpp_pool=H.next,H.next=null),H.weak=!1,H._immutable=!1,H.x=K,H.y=W,X.zpp_inner=H,X.zpp_inner.outer=X}else{var Q=X.zpp_inner;null!=Q._isimmutable&&Q._isimmutable();var $,nn=X.zpp_inner;if(null!=nn._validate&&nn._validate(),X.zpp_inner.x==K){var en=X.zpp_inner;null!=en._validate&&en._validate(),$=X.zpp_inner.y==W}else $=!1;if(!$){X.zpp_inner.x=K,X.zpp_inner.y=W;var tn=X.zpp_inner;null!=tn._invalidate&&tn._invalidate(tn)}}X.zpp_inner.weak=!1;for(var ln=Je.getRay(X,l,J,n.outer),pn=null,rn=i.zpp_inner.inner.head;null!=rn;){var an=rn.elt;if(an.zpp_inner.toiDistance>ln.zpp_inner.toiDistance)break;pn=rn,rn=rn.next}var sn,on=i.zpp_inner.inner;null==rl.zpp_pool?sn=new rl:(sn=rl.zpp_pool,rl.zpp_pool=sn.next,sn.next=null),sn.elt=ln;var _n=sn;null==pn?(_n.next=on.head,on.head=_n):(_n.next=pn.next,pn.next=_n),on.pushmod=on.modified=!0,on.length++}},__class__:hi};var ui=function Xl(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=ae.ZPP_SimpleVert(),null==Sl.zpp_pool?this.links=new Sl:(this.links=Sl.zpp_pool,Sl.zpp_pool=this.links.next,this.links.next=null);this.links.lt=Xl.less_xy};l["zpp_nape.geom.ZPP_SimpleVert"]=ui,ui.__name__=["zpp_nape","geom","ZPP_SimpleVert"],ui.less_xy=function(n,e){return e.y>n.y||n.y==e.y&&e.x>n.x},ui.swap_nodes=function(n,e){var i=n.node;n.node=e.node,e.node=i},ui.get=function(n,e){var i;return null==ui.zpp_pool?i=new ui:(i=ui.zpp_pool,ui.zpp_pool=i.next,i.next=null),i.x=n,i.y=e,i},ui.prototype={forced:null,x:null,y:null,links:null,id:null,next:null,node:null,free:function(){this.links.clear(),this.node=null,this.forced=!1},alloc:function(){},__class__:ui};var xi=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=ae.ZPP_SimpleSeg(),null==Sl.zpp_pool?this.vertices=new Sl:(this.vertices=Sl.zpp_pool,Sl.zpp_pool=this.vertices.next,this.vertices.next=null);this.vertices.lt=i(this,this.less_xy)};l["zpp_nape.geom.ZPP_SimpleSeg"]=xi,xi.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],xi.get=function(n,e){var i;return null==xi.zpp_pool?i=new xi:(i=xi.zpp_pool,xi.zpp_pool=i.next,i.next=null),i.left=n,i.right=e,i.vertices.insert(n),i.vertices.insert(e),i},xi.prototype={left:null,right:null,vertices:null,id:null,next:null,free:function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},alloc:function(){},prev:null,node:null,less_xy:function(n,e){return e.x>n.x||n.x==e.x&&e.y>n.y},__class__:xi};var di=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};l["zpp_nape.geom.ZPP_SimpleEvent"]=di,di.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],di.swap_nodes=function(n,e){var i=n.node;n.node=e.node,e.node=i},di.less_xy=function(n,e){return e.vertex.x>n.vertex.x||e.vertex.x>=n.vertex.x&&(e.vertex.y>n.vertex.y||e.vertex.y>=n.vertex.y&&e.type>n.type)},di.get=function(n){var e;return null==di.zpp_pool?e=new di:(e=di.zpp_pool,di.zpp_pool=e.next,e.next=null),e.vertex=n,e},di.prototype={type:null,vertex:null,segment:null,segment2:null,node:null,next:null,free:function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},alloc:function(){},__class__:di};var vi=function(){this.tree=null,this.sweepx=0,null==Pl.zpp_pool?this.tree=new Pl:(this.tree=Pl.zpp_pool,Pl.zpp_pool=this.tree.next,this.tree.next=null);this.tree.lt=i(this,this.edge_lt),this.tree.swapped=i(this,this.swap_nodes)};l["zpp_nape.geom.ZPP_SimpleSweep"]=vi,vi.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],vi.prototype={sweepx:null,tree:null,swap_nodes:function(n,e){var i=n.node;n.node=e.node,e.node=i},edge_lt:function(n,e){var i,t=0,l=0,p=0,r=0;if(n.left==e.left&&n.right==e.right)return!1;if(n.left==e.right)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.left.y:n.right.y>e.left.y:(i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.left.x-n.left.x,r=e.left.y-n.left.y,0>(i?l*p-t*r:r*t-p*l));if(n.right==e.left){var a;return e.left.x==e.right.x?a=e.right.y>e.left.y?e.left.y>n.left.y:e.right.y>n.left.y:(i=e.left.x>e.right.x,t=e.right.x-e.left.x,l=e.right.y-e.left.y,p=n.left.x-e.left.x,r=n.left.y-e.left.y,a=0>(i?l*p-t*r:r*t-p*l)),!a}if(n.left==e.left)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.right.y:n.right.y>e.right.y:(i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.right.x-n.left.x,r=e.right.y-n.left.y,0>(i?l*p-t*r:r*t-p*l));if(n.right==e.right)return n.left.x==n.right.x?n.right.y>n.left.y?n.left.y>e.left.y:n.right.y>e.left.y:(i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.left.x-n.left.x,r=e.left.y-n.left.y,0>(i?l*p-t*r:r*t-p*l));if(n.left.x==n.right.x){if(e.left.x==e.right.x){return(n.right.y>n.left.y?n.right:n.left).y>(e.right.y>e.left.y?e.right:e.left).y}i=e.left.x>e.right.x,t=e.right.x-e.left.x,l=e.right.y-e.left.y,p=n.left.x-e.left.x,r=n.left.y-e.left.y;var s=i?l*p-t*r:r*t-p*l;i=e.left.x>e.right.x,t=e.right.x-e.left.x,l=e.right.y-e.left.y,p=n.right.x-e.left.x,r=n.right.y-e.left.y;return 0>s*(i?l*p-t*r:r*t-p*l)?this.sweepx>=n.left.x:s>=0}if(e.left.x==e.right.x){i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.left.x-n.left.x,r=e.left.y-n.left.y;var o=i?l*p-t*r:r*t-p*l;i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.right.x-n.left.x,r=e.right.y-n.left.y;return 0>o*(i?l*p-t*r:r*t-p*l)?e.left.x>this.sweepx:0>o}i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.left.x-n.left.x,r=e.left.y-n.left.y;var _=0>(i?l*p-t*r:r*t-p*l);if(i=n.left.x>n.right.x,t=n.right.x-n.left.x,l=n.right.y-n.left.y,p=e.right.x-n.left.x,r=e.right.y-n.left.y,_==0>(i?l*p-t*r:r*t-p*l))return _;i=e.left.x>e.right.x,t=e.right.x-e.left.x,l=e.right.y-e.left.y,p=n.left.x-e.left.x,r=n.left.y-e.left.y;var h=(i?l*p-t*r:r*t-p*l)>=0;return i=e.left.x>e.right.x,t=e.right.x-e.left.x,l=e.right.y-e.left.y,p=n.right.x-e.left.x,r=n.right.y-e.left.y,h==(i?l*p-t*r:r*t-p*l)>=0?h:(this.sweepx-n.left.x)/(n.right.x-n.left.x)*(n.right.y-n.left.y)+n.left.y>(this.sweepx-e.left.x)/(e.right.x-e.left.x)*(e.right.y-e.left.y)+e.left.y},clear:function(){this.tree.clear()},add:function(n){n.node=this.tree.insert(n);var e=this.tree.successor_node(n.node),i=this.tree.predecessor_node(n.node);return null!=e&&(n.next=e.data,e.data.prev=n),null!=i&&(n.prev=i.data,i.data.next=n),n},remove:function(n){var e=this.tree.successor_node(n.node),i=this.tree.predecessor_node(n.node);null!=e&&(e.data.prev=n.prev),null!=i&&(i.data.next=n.next),this.tree.remove_node(n.node),n.node=null},intersect:function(n,e){if(null==n||null==e)return!1;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return!1;var i=(e.left.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.left.y-n.left.y),t=(e.right.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.right.y-n.left.y);if(i*t>0)return!1;var l=(n.left.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.left.y-e.left.y),p=(n.right.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.right.y-e.left.y);return l*p<=0},intersection:function(n,e){if(null==n||null==e)return null;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return null;var i=0,t=0;i=n.right.x-n.left.x,t=n.right.y-n.left.y;var l=0,p=0;l=e.right.x-e.left.x,p=e.right.y-e.left.y;var r=p*i-l*t;if(0==r)return null;r=1/r;var a=0,s=0;a=e.left.x-n.left.x,s=e.left.y-n.left.y;var o=(p*a-l*s)*r;if(0>o||o>1)return null;var _=(t*a-i*s)*r;if(0>_||_>1)return null;var h;if(0==_||1==_||0==o||1==o){var u=0==_;1==_&&u||1==_&&(u=!0),0==o&&u||0==o&&(u=!0),h=0==_?e.left:1==_?e.right:0==o?n.left:n.right}else{var x,d=.5*(n.left.x+i*o+e.left.x+l*_),v=.5*(n.left.y+t*o+e.left.y+p*_);null==ui.zpp_pool?x=new ui:(x=ui.zpp_pool,ui.zpp_pool=x.next,x.next=null),x.x=d,x.y=v,h=x}var z;null==di.zpp_pool?z=new di:(z=di.zpp_pool,di.zpp_pool=z.next,z.next=null),z.vertex=h;var c=z;return c.type=0,c.segment=n,c.segment2=e,c},__class__:vi};var zi=function(){};l["zpp_nape.geom.ZPP_Simple"]=zi,zi.__name__=["zpp_nape","geom","ZPP_Simple"],zi.decompose=function(n,e){if(null==zi.sweep&&(zi.sweep=new vi,zi.inthash=new Qi),null==zi.vertices){null==Sl.zpp_pool?zi.vertices=new Sl:(zi.vertices=Sl.zpp_pool,Sl.zpp_pool=zi.vertices.next,zi.vertices.next=null);zi.vertices.lt=ui.less_xy,zi.vertices.swapped=ui.swap_nodes}if(null==zi.queue){null==Tl.zpp_pool?zi.queue=new Tl:(zi.queue=Tl.zpp_pool,Tl.zpp_pool=zi.queue.next,zi.queue.next=null);zi.queue.lt=di.less_xy,zi.queue.swapped=di.swap_nodes}var i=null,t=null,l=n,p=n;if(null!=l)for(var r=l;;){var a,s=r,o=s.x,_=s.y;null==ui.zpp_pool?a=new ui:(a=ui.zpp_pool,ui.zpp_pool=a.next,a.next=null),a.x=o,a.y=_;for(var h=a,u=zi.vertices.parent;null!=u;)if(zi.vertices.lt(h,u.data))u=u.prev;else{if(!zi.vertices.lt(u.data,h))break;u=u.next}var x=u;if(null!=x){var d=h;d.links.clear(),d.node=null,d.forced=!1,d.next=ui.zpp_pool,ui.zpp_pool=d,h=x.data}else h.node=zi.vertices.insert(h);if(null!=t){var v;null==di.zpp_pool?v=new di:(v=di.zpp_pool,di.zpp_pool=v.next,v.next=null),v.vertex=t;var z,c=v;null==di.zpp_pool?z=new di:(z=di.zpp_pool,di.zpp_pool=z.next,z.next=null),z.vertex=h;var m,y=z;di.less_xy(c,y)?(c.type=1,y.type=2,m=xi.get(t,h)):(c.type=2,y.type=1,m=xi.get(h,t)),c.segment=y.segment=m,zi.queue.insert(c),zi.queue.insert(y),t.links.insert(h),h.links.insert(t)}if(t=h,null==i&&(i=h),(r=r.next)==p)break}var f;null==di.zpp_pool?f=new di:(f=di.zpp_pool,di.zpp_pool=f.next,f.next=null),f.vertex=t;var b,g=f;null==di.zpp_pool?b=new di:(b=di.zpp_pool,di.zpp_pool=b.next,b.next=null),b.vertex=i;var w,M=b;if(di.less_xy(g,M)?(g.type=1,M.type=2,w=xi.get(t,i)):(g.type=2,M.type=1,w=xi.get(i,t)),g.segment=M.segment=w,zi.queue.insert(g),zi.queue.insert(M),t.links.insert(i),i.links.insert(t),null==zi.ints){null==Tl.zpp_pool?zi.ints=new Tl:(zi.ints=Tl.zpp_pool,Tl.zpp_pool=zi.ints.next,zi.ints.next=null);zi.ints.lt=di.less_xy}for(;!zi.queue.empty();){var C=zi.queue.pop_front();if(zi.sweep.sweepx=C.vertex.x,1==C.type){var k=C.segment;if(zi.sweep.add(k),null!=k.next&&null!=k&&!(k.id>k.next.id?zi.inthash.has(k.next.id,k.id):zi.inthash.has(k.id,k.next.id))){var O=zi.sweep.intersection(k.next,k);if(null!=O)if(O.vertex.x<zi.sweep.sweepx){var I=O.vertex;I.links.clear(),I.node=null,I.forced=!1,I.next=ui.zpp_pool,ui.zpp_pool=I;var S=O;S.vertex=null,S.segment=S.segment2=null,S.node=null,S.next=di.zpp_pool,di.zpp_pool=S}else{for(var P=zi.queue.parent;null!=P;)if(zi.queue.lt(O,P.data))P=P.prev;else{if(!zi.queue.lt(P.data,O))break;P=P.next}var T=P;if(null==T){for(var A=zi.ints.parent;null!=A;)if(zi.ints.lt(O,A.data))A=A.prev;else{if(!zi.ints.lt(A.data,O))break;A=A.next}var E=A;if(null!=E){var N=O.vertex;N.links.clear(),N.node=null,N.forced=!1,N.next=ui.zpp_pool,ui.zpp_pool=N,O.vertex=E.data.vertex,E.data=O,zi.queue.insert(O)}else zi.queue.insert(O),zi.ints.insert(O);if(k.id>k.next.id){var L,V=zi.inthash,j=k.next.id,D=k.id;null==Hi.zpp_pool?L=new Hi:(L=Hi.zpp_pool,Hi.zpp_pool=L.next,L.next=null),L.id=j,L.di=D;var F=L;F.value=!0,V.add(F)}else{var R,B=zi.inthash,G=k.id,Z=k.next.id;null==Hi.zpp_pool?R=new Hi:(R=Hi.zpp_pool,Hi.zpp_pool=R.next,R.next=null),R.id=G,R.di=Z;var U=R;U.value=!0,B.add(U)}}else{var q=O.vertex;q.links.clear(),q.node=null,q.forced=!1,q.next=ui.zpp_pool,ui.zpp_pool=q;var Y=O;Y.vertex=null,Y.segment=Y.segment2=null,Y.node=null,Y.next=di.zpp_pool,di.zpp_pool=Y}}}if(null!=k&&null!=k.prev&&!(k.prev.id>k.id?zi.inthash.has(k.id,k.prev.id):zi.inthash.has(k.prev.id,k.id))){var K=zi.sweep.intersection(k,k.prev);if(null!=K)if(K.vertex.x<zi.sweep.sweepx){var W=K.vertex;W.links.clear(),W.node=null,W.forced=!1,W.next=ui.zpp_pool,ui.zpp_pool=W;var J=K;J.vertex=null,J.segment=J.segment2=null,J.node=null,J.next=di.zpp_pool,di.zpp_pool=J}else{for(var X=zi.queue.parent;null!=X;)if(zi.queue.lt(K,X.data))X=X.prev;else{if(!zi.queue.lt(X.data,K))break;X=X.next}var H=X;if(null==H){for(var Q=zi.ints.parent;null!=Q;)if(zi.ints.lt(K,Q.data))Q=Q.prev;else{if(!zi.ints.lt(Q.data,K))break;Q=Q.next}var $=Q;if(null!=$){var nn=K.vertex;nn.links.clear(),nn.node=null,nn.forced=!1,nn.next=ui.zpp_pool,ui.zpp_pool=nn,K.vertex=$.data.vertex,$.data=K,zi.queue.insert(K)}else zi.queue.insert(K),zi.ints.insert(K);if(k.prev.id>k.id){var en,tn=zi.inthash,ln=k.id,pn=k.prev.id;null==Hi.zpp_pool?en=new Hi:(en=Hi.zpp_pool,Hi.zpp_pool=en.next,en.next=null),en.id=ln,en.di=pn;var rn=en;rn.value=!0,tn.add(rn)}else{var an,sn=zi.inthash,on=k.prev.id,_n=k.id;null==Hi.zpp_pool?an=new Hi:(an=Hi.zpp_pool,Hi.zpp_pool=an.next,an.next=null),an.id=on,an.di=_n;var hn=an;hn.value=!0,sn.add(hn)}}else{var un=K.vertex;un.links.clear(),un.node=null,un.forced=!1,un.next=ui.zpp_pool,ui.zpp_pool=un;var xn=K;xn.vertex=null,xn.segment=xn.segment2=null,xn.node=null,xn.next=di.zpp_pool,di.zpp_pool=xn}}}}else if(2==C.type){var dn=C.segment;if(null!=dn.node){var vn=dn.next,zn=dn.prev;zi.sweep.remove(dn);var cn=dn;if(cn.left=cn.right=null,cn.prev=null,cn.node=null,cn.vertices.clear(),cn.next=xi.zpp_pool,xi.zpp_pool=cn,null!=vn&&null!=zn&&!(zn.id>vn.id?zi.inthash.has(vn.id,zn.id):zi.inthash.has(zn.id,vn.id))){var mn=zi.sweep.intersection(vn,zn);if(null!=mn)if(mn.vertex.x<zi.sweep.sweepx){var yn=mn.vertex;yn.links.clear(),yn.node=null,yn.forced=!1,yn.next=ui.zpp_pool,ui.zpp_pool=yn;var fn=mn;fn.vertex=null,fn.segment=fn.segment2=null,fn.node=null,fn.next=di.zpp_pool,di.zpp_pool=fn}else{for(var bn=zi.queue.parent;null!=bn;)if(zi.queue.lt(mn,bn.data))bn=bn.prev;else{if(!zi.queue.lt(bn.data,mn))break;bn=bn.next}var gn=bn;if(null==gn){for(var wn=zi.ints.parent;null!=wn;)if(zi.ints.lt(mn,wn.data))wn=wn.prev;else{if(!zi.ints.lt(wn.data,mn))break;wn=wn.next}var Mn=wn;if(null!=Mn){var Cn=mn.vertex;Cn.links.clear(),Cn.node=null,Cn.forced=!1,Cn.next=ui.zpp_pool,ui.zpp_pool=Cn,mn.vertex=Mn.data.vertex,Mn.data=mn,zi.queue.insert(mn)}else zi.queue.insert(mn),zi.ints.insert(mn);if(zn.id>vn.id){var kn,On=zi.inthash,In=vn.id,Sn=zn.id;null==Hi.zpp_pool?kn=new Hi:(kn=Hi.zpp_pool,Hi.zpp_pool=kn.next,kn.next=null),kn.id=In,kn.di=Sn;var Pn=kn;Pn.value=!0,On.add(Pn)}else{var Tn,An=zi.inthash,En=zn.id,Nn=vn.id;null==Hi.zpp_pool?Tn=new Hi:(Tn=Hi.zpp_pool,Hi.zpp_pool=Tn.next,Tn.next=null),Tn.id=En,Tn.di=Nn;var Ln=Tn;Ln.value=!0,An.add(Ln)}}else{var Vn=mn.vertex;Vn.links.clear(),Vn.node=null,Vn.forced=!1,Vn.next=ui.zpp_pool,ui.zpp_pool=Vn;var jn=mn;jn.vertex=null,jn.segment=jn.segment2=null,jn.node=null,jn.next=di.zpp_pool,di.zpp_pool=jn}}}}}else{var Dn=C.vertex,Fn=null==Dn.node,Rn=C.segment,Bn=C.segment2;if(Bn.next!=Rn){var Gn=Rn;Rn=Bn,Bn=Gn}for(var Zn=Rn.vertices.parent;null!=Zn;)if(Rn.vertices.lt(Dn,Zn.data))Zn=Zn.prev;else{if(!Rn.vertices.lt(Zn.data,Dn))break;Zn=Zn.next}for(var Un=null==Zn,qn=Bn.vertices.parent;null!=qn;)if(Bn.vertices.lt(Dn,qn.data))qn=qn.prev;else{if(!Bn.vertices.lt(qn.data,Dn))break;qn=qn.next}var Yn=null==qn;if(Un){var Kn=Rn.vertices.insert(Dn),Wn=Dn==Rn.left?Dn:Rn.vertices.predecessor_node(Kn).data,Jn=Dn==Rn.right?Dn:Rn.vertices.successor_node(Kn).data;Wn.links.remove(Jn),Dn!=Wn&&Wn.links.insert(Dn),Jn.links.remove(Wn),Dn!=Jn&&Jn.links.insert(Dn),Dn!=Wn&&Dn.links.insert(Wn),Dn!=Jn&&Dn.links.insert(Jn)}if(Yn){var Xn=Bn.vertices.insert(Dn),Hn=Dn==Bn.left?Dn:Bn.vertices.predecessor_node(Xn).data,Qn=Dn==Bn.right?Dn:Bn.vertices.successor_node(Xn).data;Hn.links.remove(Qn),Dn!=Hn&&Hn.links.insert(Dn),Qn.links.remove(Hn),Dn!=Qn&&Qn.links.insert(Dn),Dn!=Hn&&Dn.links.insert(Hn),Dn!=Qn&&Dn.links.insert(Qn)}if(Fn&&(Dn.node=zi.vertices.insert(Dn)),Dn.forced=!0,Fn){var $n=Rn.node,ne=Bn.node;$n.data=Bn,ne.data=Rn,Rn.node=ne,Bn.node=$n,Bn.next=Rn.next,Rn.next=Bn,Rn.prev=Bn.prev,Bn.prev=Rn,null!=Rn.prev&&(Rn.prev.next=Rn),null!=Bn.next&&(Bn.next.prev=Bn)}if(null!=Bn.next&&null!=Bn&&!(Bn.id>Bn.next.id?zi.inthash.has(Bn.next.id,Bn.id):zi.inthash.has(Bn.id,Bn.next.id))){var ee=zi.sweep.intersection(Bn.next,Bn);if(null!=ee)if(ee.vertex.x<zi.sweep.sweepx){var ie=ee.vertex;ie.links.clear(),ie.node=null,ie.forced=!1,ie.next=ui.zpp_pool,ui.zpp_pool=ie;var te=ee;te.vertex=null,te.segment=te.segment2=null,te.node=null,te.next=di.zpp_pool,di.zpp_pool=te}else{for(var le=zi.queue.parent;null!=le;)if(zi.queue.lt(ee,le.data))le=le.prev;else{if(!zi.queue.lt(le.data,ee))break;le=le.next}var pe=le;if(null==pe){for(var re=zi.ints.parent;null!=re;)if(zi.ints.lt(ee,re.data))re=re.prev;else{if(!zi.ints.lt(re.data,ee))break;re=re.next}var ae=re;if(null!=ae){var se=ee.vertex;se.links.clear(),se.node=null,se.forced=!1,se.next=ui.zpp_pool,ui.zpp_pool=se,ee.vertex=ae.data.vertex,ae.data=ee,zi.queue.insert(ee)}else zi.queue.insert(ee),zi.ints.insert(ee);if(Bn.id>Bn.next.id){var oe,_e=zi.inthash,he=Bn.next.id,ue=Bn.id;null==Hi.zpp_pool?oe=new Hi:(oe=Hi.zpp_pool,Hi.zpp_pool=oe.next,oe.next=null),oe.id=he,oe.di=ue;var xe=oe;xe.value=!0,_e.add(xe)}else{var de,ve=zi.inthash,ze=Bn.id,ce=Bn.next.id;null==Hi.zpp_pool?de=new Hi:(de=Hi.zpp_pool,Hi.zpp_pool=de.next,de.next=null),de.id=ze,de.di=ce;var me=de;me.value=!0,ve.add(me)}}else{var ye=ee.vertex;ye.links.clear(),ye.node=null,ye.forced=!1,ye.next=ui.zpp_pool,ui.zpp_pool=ye;var fe=ee;fe.vertex=null,fe.segment=fe.segment2=null,fe.node=null,fe.next=di.zpp_pool,di.zpp_pool=fe}}}if(null!=Rn&&null!=Rn.prev&&!(Rn.prev.id>Rn.id?zi.inthash.has(Rn.id,Rn.prev.id):zi.inthash.has(Rn.prev.id,Rn.id))){var be=zi.sweep.intersection(Rn,Rn.prev);if(null!=be)if(be.vertex.x<zi.sweep.sweepx){var ge=be.vertex;ge.links.clear(),ge.node=null,ge.forced=!1,ge.next=ui.zpp_pool,ui.zpp_pool=ge;var we=be;we.vertex=null,we.segment=we.segment2=null,we.node=null,we.next=di.zpp_pool,di.zpp_pool=we}else{for(var Me=zi.queue.parent;null!=Me;)if(zi.queue.lt(be,Me.data))Me=Me.prev;else{if(!zi.queue.lt(Me.data,be))break;Me=Me.next}var Ce=Me;if(null==Ce){for(var ke=zi.ints.parent;null!=ke;)if(zi.ints.lt(be,ke.data))ke=ke.prev;else{if(!zi.ints.lt(ke.data,be))break;ke=ke.next}var Oe=ke;if(null!=Oe){var Ie=be.vertex;Ie.links.clear(),Ie.node=null,Ie.forced=!1,Ie.next=ui.zpp_pool,ui.zpp_pool=Ie,be.vertex=Oe.data.vertex,Oe.data=be,zi.queue.insert(be)}else zi.queue.insert(be),zi.ints.insert(be);if(Rn.prev.id>Rn.id){var Se,Pe=zi.inthash,Te=Rn.id,Ae=Rn.prev.id;null==Hi.zpp_pool?Se=new Hi:(Se=Hi.zpp_pool,Hi.zpp_pool=Se.next,Se.next=null),Se.id=Te,Se.di=Ae;var Ee=Se;Ee.value=!0,Pe.add(Ee)}else{var Ne,Le=zi.inthash,Ve=Rn.prev.id,je=Rn.id;null==Hi.zpp_pool?Ne=new Hi:(Ne=Hi.zpp_pool,Hi.zpp_pool=Ne.next,Ne.next=null),Ne.id=Ve,Ne.di=je;var De=Ne;De.value=!0,Le.add(De)}}else{var Fe=be.vertex;Fe.links.clear(),Fe.node=null,Fe.forced=!1,Fe.next=ui.zpp_pool,ui.zpp_pool=Fe;var Re=be;Re.vertex=null,Re.segment=Re.segment2=null,Re.node=null,Re.next=di.zpp_pool,di.zpp_pool=Re}}}zi.ints.remove(C)}var Be=C;Be.vertex=null,Be.segment=Be.segment2=null,Be.node=null,Be.next=di.zpp_pool,di.zpp_pool=Be}for(var Ge=0,Ze=zi.inthash.table.length;Ze>Ge;){var Ue=Ge++,qe=zi.inthash.table[Ue];if(null!=qe){for(;null!=qe;){var Ye=qe.hnext;qe.hnext=null;var Ke=qe;Ke.next=Hi.zpp_pool,Hi.zpp_pool=Ke,qe=Ye}zi.inthash.table[Ue]=null}}for(null==e&&(e=new ot);!zi.vertices.empty();)zi.clip_polygon(zi.vertices,e);return e},zi.clip_polygon=function(n,e){var i=null,t=n.first(),l=t,p=t.links.parent,r=null==p.prev?p.next:p.prev,a=p.data,s=r.data,o=0,_=0;o=t.x-a.x,_=t.y-a.y;var h=0,u=0;h=s.x-t.x,0>(u=s.y-t.y)*o-h*_&&(s=a);var x,d=t.x,v=t.y;null==ni.zpp_pool?x=new ni:(x=ni.zpp_pool,ni.zpp_pool=x.next,x.next=null),x.forced=!1,x.x=d,x.y=v;var z=x;for(null==i?i=z.prev=z.next=z:(z.prev=i,z.next=i.next,i.next.prev=z,i.next=z),i=z,i.forced=t.forced;;){if(t.links.remove(s),s.links.remove(t),s==l){if(t.links.empty()){n.remove(t);var c=t;c.links.clear(),c.node=null,c.forced=!1,c.next=ui.zpp_pool,ui.zpp_pool=c}break}var m,y=s.x,f=s.y;null==ni.zpp_pool?m=new ni:(m=ni.zpp_pool,ni.zpp_pool=m.next,m.next=null),m.forced=!1,m.x=y,m.y=f;var b=m;if(null==i?i=b.prev=b.next=b:(b.prev=i,b.next=i.next,i.next.prev=b,i.next=b),i=b,i.forced=s.forced,s.links.singular()){if(t.links.empty()){n.remove(t);var g=t;g.links.clear(),g.node=null,g.forced=!1,g.next=ui.zpp_pool,ui.zpp_pool=g}t=s,s=s.links.parent.data}else{var w=null,M=0;if(!s.links.empty()){for(var C=s.links.parent;null!=C.prev;)C=C.prev;for(;null!=C;){var k=C.data;if(null==w){w=k;var O=0,I=0;O=s.x-t.x,I=s.y-t.y;var S=0,P=0;S=k.x-s.x,P=k.y-s.y,M=P*O-S*I}else{var T=0,A=0;T=s.x-t.x,A=s.y-t.y;var E=0,N=0;E=k.x-s.x,N=k.y-s.y;var L=N*T-E*A;if(L>0&&0>=M)w=k,M=L;else if(M*L>=0){var V=0,j=0;V=s.x-k.x,j=s.y-k.y;var D=0,F=0;D=w.x-s.x,F=w.y-s.y;var R=F*V-D*j;R>0&&(w=k,M=L)}}if(null!=C.next)for(C=C.next;null!=C.prev;)C=C.prev;else{for(;null!=C.parent&&C==C.parent.next;)C=C.parent;C=C.parent}}}if(t.links.empty()){n.remove(t);var B=t;B.links.clear(),B.node=null,B.forced=!1,B.next=ui.zpp_pool,ui.zpp_pool=B}t=s,s=w}}n.remove(l);var G=l;G.links.clear(),G.node=null,G.forced=!1,G.next=ui.zpp_pool,ui.zpp_pool=G,e.add(i)},zi.isSimple=function(n){null==zi.sweep&&(zi.sweep=new vi,zi.inthash=new Qi);var e=zi.list_vertices;null==e&&(e=zi.list_vertices=new ht);var i=n,t=n;if(null!=i)for(var l=i;;){var p,r=l,a=r.x,s=r.y;if(null==ui.zpp_pool?p=new ui:(p=ui.zpp_pool,ui.zpp_pool=p.next,p.next=null),p.x=a,p.y=s,e.add(p),(l=l.next)==t)break}var o=zi.list_queue;null==o&&(o=zi.list_queue=new ut);var _=e.head,h=_.elt;for(_=_.next;null!=_;){var u,x=_.elt;null==di.zpp_pool?u=new di:(u=di.zpp_pool,di.zpp_pool=u.next,u.next=null),u.vertex=h;var d,v=o.add(u);null==di.zpp_pool?d=new di:(d=di.zpp_pool,di.zpp_pool=d.next,d.next=null),d.vertex=x;var z,c=o.add(d);di.less_xy(v,c)?(v.type=1,c.type=2,z=xi.get(h,x)):(v.type=2,c.type=1,z=xi.get(x,h)),v.segment=c.segment=z,h=x,_=_.next}var m,y=e.head.elt;null==di.zpp_pool?m=new di:(m=di.zpp_pool,di.zpp_pool=m.next,m.next=null),m.vertex=h;var f,b=o.add(m);null==di.zpp_pool?f=new di:(f=di.zpp_pool,di.zpp_pool=f.next,f.next=null),f.vertex=y;var g,w=o.add(f);di.less_xy(b,w)?(b.type=1,w.type=2,g=xi.get(h,y)):(b.type=2,w.type=1,g=xi.get(y,h)),b.segment=w.segment=g;var M=o;if(null!=M.head&&null!=M.head.next){for(var C,k,O,I=M.head,S=null,P=null,T=null,A=null,E=1;;){for(C=0,P=I,I=null,S=I;null!=P;){for(++C,T=P,k=0,O=E;null!=T&&E>k;)++k,T=T.next;for(;k>0||O>0&&null!=T;)0==k?(A=T,T=T.next,--O):0==O||null==T?(A=P,P=P.next,--k):di.less_xy(P.elt,T.elt)?(A=P,P=P.next,--k):(A=T,T=T.next,--O),null!=S?S.next=A:I=A,S=A;P=T}if(S.next=null,E<<=1,C<=1)break}M.head=I,M.modified=!0,M.pushmod=!0}for(var N=!0;null!=o.head;){var L=o.pop_unsafe(),V=L.segment;if(1==L.type){if(zi.sweep.add(V),zi.sweep.intersect(V,V.next)||zi.sweep.intersect(V,V.prev)){N=!1;break}}else if(2==L.type){if(zi.sweep.intersect(V.prev,V.next)){N=!1;break}zi.sweep.remove(V);var j=V;j.left=j.right=null,j.prev=null,j.node=null,j.vertices.clear(),j.next=xi.zpp_pool,xi.zpp_pool=j}var D=L;D.vertex=null,D.segment=D.segment2=null,D.node=null,D.next=di.zpp_pool,di.zpp_pool=D}for(;null!=o.head;){var F=o.pop_unsafe();if(2==F.type){var R=F.segment;R.left=R.right=null,R.prev=null,R.node=null,R.vertices.clear(),R.next=xi.zpp_pool,xi.zpp_pool=R}var B=F;B.vertex=null,B.segment=B.segment2=null,B.node=null,B.next=di.zpp_pool,di.zpp_pool=B}for(zi.sweep.clear();null!=e.head;){var G=e.pop_unsafe();G.links.clear(),G.node=null,G.forced=!1,G.next=ui.zpp_pool,ui.zpp_pool=G}return N};var ci=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};l["zpp_nape.geom.ZPP_SimplifyV"]=ci,ci.__name__=["zpp_nape","geom","ZPP_SimplifyV"],ci.get=function(n){var e;return null==ci.zpp_pool?e=new ci:(e=ci.zpp_pool,ci.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e.flag=!1,e},ci.prototype={x:null,y:null,next:null,prev:null,flag:null,forced:null,free:function(){},alloc:function(){},__class__:ci};var mi=function(){this.max=null,this.min=null,this.next=null};l["zpp_nape.geom.ZPP_SimplifyP"]=mi,mi.__name__=["zpp_nape","geom","ZPP_SimplifyP"],mi.get=function(n,e){var i;return null==mi.zpp_pool?i=new mi:(i=mi.zpp_pool,mi.zpp_pool=i.next,i.next=null),i.min=n,i.max=e,i},mi.prototype={next:null,min:null,max:null,free:function(){this.min=this.max=null},alloc:function(){},__class__:mi};var yi=function(){};l["zpp_nape.geom.ZPP_Simplify"]=yi,yi.__name__=["zpp_nape","geom","ZPP_Simplify"],yi.lessval=function(n,e){return n.x-e.x+(n.y-e.y)},yi.less=function(n,e){return 0>n.x-e.x+(n.y-e.y)},yi.distance=function(n,e,i){var t=0,l=0;t=i.x-e.x,l=i.y-e.y;var p=0,r=0;if(p=n.x-e.x,r=n.y-e.y,0==t*t+l*l)return p*p+r*r;var a=(p*t+r*l)/(t*t+l*l);if(a>0){if(1>a){var s=a;return p-=t*s,r-=l*s,p*p+r*r}var o=0,_=0;return o=n.x-i.x,_=n.y-i.y,o*o+_*_}return p*p+r*r},yi.simplify=function(n,e){var i=null,t=null,l=null;e*=e,null==yi.stack&&(yi.stack=new _t);for(var p=null,r=null,a=n;;){var s;null==ci.zpp_pool?s=new ci:(s=ci.zpp_pool,ci.zpp_pool=s.next,s.next=null),s.x=a.x,s.y=a.y,s.flag=!1;var o=s;if(o.forced=a.forced){if(o.flag=!0,null!=p){var _,h=yi.stack;null==mi.zpp_pool?_=new mi:(_=mi.zpp_pool,mi.zpp_pool=_.next,_.next=null),_.min=p,_.max=o,h.add(_)}else r=o;p=o}var u=o;if(null==i?i=u.prev=u.next=u:(u.prev=i,u.next=i.next,i.next.prev=u,i.next=u),i=u,null==t?(t=i,l=i):(0>i.x-t.x+(i.y-t.y)&&(t=i),0>l.x-i.x+(l.y-i.y)&&(l=i)),(a=a.next)==n)break}if(null==yi.stack.head)if(null==r){t.flag=l.flag=!0;var x,d=yi.stack;null==mi.zpp_pool?x=new mi:(x=mi.zpp_pool,mi.zpp_pool=x.next,x.next=null),x.min=t,x.max=l,d.add(x);var v,z=yi.stack;null==mi.zpp_pool?v=new mi:(v=mi.zpp_pool,mi.zpp_pool=v.next,v.next=null),v.min=l,v.max=t,z.add(v)}else{var c=t.x-r.x+(t.y-r.y);0>c&&(c=-c);var m=l.x-r.x+(l.y-r.y);if(0>m&&(m=-m),c>m){t.flag=r.flag=!0;var y,f=yi.stack;null==mi.zpp_pool?y=new mi:(y=mi.zpp_pool,mi.zpp_pool=y.next,y.next=null),y.min=t,y.max=r,f.add(y);var b,g=yi.stack;null==mi.zpp_pool?b=new mi:(b=mi.zpp_pool,mi.zpp_pool=b.next,b.next=null),b.min=r,b.max=t,g.add(b)}else{l.flag=r.flag=!0;var w,M=yi.stack;null==mi.zpp_pool?w=new mi:(w=mi.zpp_pool,mi.zpp_pool=w.next,w.next=null),w.min=l,w.max=r,M.add(w);var C,k=yi.stack;null==mi.zpp_pool?C=new mi:(C=mi.zpp_pool,mi.zpp_pool=C.next,C.next=null),C.min=r,C.max=l,k.add(C)}}else{var O,I=yi.stack;null==mi.zpp_pool?O=new mi:(O=mi.zpp_pool,mi.zpp_pool=O.next,O.next=null),O.min=p,O.max=r,I.add(O)}for(;null!=yi.stack.head;){var S=yi.stack.pop_unsafe(),P=S.min,T=S.max,A=S;A.min=A.max=null,A.next=mi.zpp_pool,mi.zpp_pool=A;for(var E=e,N=null,L=P.next;L!=T;){var V=yi.distance(L,P,T);V>E&&(E=V,N=L),L=L.next}if(null!=N){N.flag=!0;var j,D=yi.stack;null==mi.zpp_pool?j=new mi:(j=mi.zpp_pool,mi.zpp_pool=j.next,j.next=null),j.min=P,j.max=N,D.add(j);var F,R=yi.stack;null==mi.zpp_pool?F=new mi:(F=mi.zpp_pool,mi.zpp_pool=F.next,F.next=null),F.min=N,F.max=T,R.add(F)}}for(var B=null;null!=i;){if(i.flag){var G,Z=i.x,U=i.y;null==ni.zpp_pool?G=new ni:(G=ni.zpp_pool,ni.zpp_pool=G.next,G.next=null),G.forced=!1,G.x=Z,G.y=U;var q=G;null==B?B=q.prev=q.next=q:(q.prev=B,q.next=B.next,B.next.prev=q,B.next=q),B=q,B.forced=i.forced}if(null!=i&&i.prev==i){i.next=i.prev=null;var Y=i;Y.next=ci.zpp_pool,ci.zpp_pool=Y,i=null,i=i}else{var K=i.next;i.prev.next=i.next,i.next.prev=i.prev,i.next=i.prev=null;var W=i;W.next=ci.zpp_pool,ci.zpp_pool=W,i=null,i=K}}return B};var fi=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new Mi,this.c2=new Mi,this.axis=new Mi};l["zpp_nape.geom.ZPP_ToiEvent"]=fi,fi.__name__=["zpp_nape","geom","ZPP_ToiEvent"],fi.prototype={next:null,alloc:function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},free:function(){},toi:null,s1:null,s2:null,arbiter:null,frozen1:null,frozen2:null,c1:null,c2:null,axis:null,slipped:null,failed:null,kinematic:null,__class__:fi};var bi=function(){};l["zpp_nape.geom.ZPP_SweepDistance"]=bi,bi.__name__=["zpp_nape","geom","ZPP_SweepDistance"],bi.dynamicSweep=function(n,e,i,t,l){null==l&&(l=!1);var p=n.s1,r=n.s2,a=p.body,s=r.body,o=0,_=0;o=s.velx-a.velx,_=s.vely-a.vely;var h=a.angvel;0>h&&(h=-h);var u=s.angvel;0>u&&(u=-u);var x=p.sweepCoef*h+r.sweepCoef*u;if(!l&&!n.kinematic&&y.dynamicSweepLinearThreshold*y.dynamicSweepLinearThreshold>o*o+_*_&&y.dynamicSweepAngularThreshold>x)return n.toi=-1,void(n.failed=!0);for(var d=n.c1,v=n.c2,z=n.axis,c=i,m=0;;){var f=c*e,b=f-a.sweepTime;if(0!=b){a.sweepTime=f;var g=b;if(a.posx+=a.velx*g,a.posy+=a.vely*g,0!=a.angvel){var w=a.sweep_angvel*b;if(a.rot+=w,w*w>1e-4)a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot);else{var M=w*w,C=1-.5*M,k=1-M*M/8,O=(C*a.axisx+w*a.axisy)*k;a.axisy=(C*a.axisy-w*a.axisx)*k,a.axisx=O}}}if(p.type==me.id_ShapeType_CIRCLE)p.worldCOMx=a.posx+(a.axisy*p.localCOMx-a.axisx*p.localCOMy),p.worldCOMy=a.posy+(p.localCOMx*a.axisx+p.localCOMy*a.axisy);else{for(var I=p.polygon,S=I.lverts.next,P=I.gverts.next;null!=P;){var T=P,A=S;S=S.next,T.x=a.posx+(a.axisy*A.x-a.axisx*A.y),T.y=a.posy+(A.x*a.axisx+A.y*a.axisy),P=P.next}var E=I.edges.head,N=I.gverts.next,L=N;for(N=N.next;null!=N;){var V=N,j=E.elt;E=E.next,j.gnormx=a.axisy*j.lnormx-a.axisx*j.lnormy,j.gnormy=j.lnormx*a.axisx+j.lnormy*a.axisy,j.gprojection=a.posx*j.gnormx+a.posy*j.gnormy+j.lprojection,j.tp0=L.y*j.gnormx-L.x*j.gnormy,j.tp1=V.y*j.gnormx-V.x*j.gnormy,L=V,N=N.next}var D=I.gverts.next,F=E.elt;E=E.next,F.gnormx=a.axisy*F.lnormx-a.axisx*F.lnormy,F.gnormy=F.lnormx*a.axisx+F.lnormy*a.axisy,F.gprojection=a.posx*F.gnormx+a.posy*F.gnormy+F.lprojection,F.tp0=L.y*F.gnormx-L.x*F.gnormy,F.tp1=D.y*F.gnormx-D.x*F.gnormy}var R=c*e,B=R-s.sweepTime;if(0!=B){s.sweepTime=R;var G=B;if(s.posx+=s.velx*G,s.posy+=s.vely*G,0!=s.angvel){var Z=s.sweep_angvel*B;if(s.rot+=Z,Z*Z>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var U=Z*Z,q=1-.5*U,Y=1-U*U/8,K=(q*s.axisx+Z*s.axisy)*Y;s.axisy=(q*s.axisy-Z*s.axisx)*Y,s.axisx=K}}}if(r.type==me.id_ShapeType_CIRCLE)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var W=r.polygon,J=W.lverts.next,X=W.gverts.next;null!=X;){var H=X,Q=J;J=J.next,H.x=s.posx+(s.axisy*Q.x-s.axisx*Q.y),H.y=s.posy+(Q.x*s.axisx+Q.y*s.axisy),X=X.next}var $=W.edges.head,nn=W.gverts.next,en=nn;for(nn=nn.next;null!=nn;){var tn=nn,ln=$.elt;$=$.next,ln.gnormx=s.axisy*ln.lnormx-s.axisx*ln.lnormy,ln.gnormy=ln.lnormx*s.axisx+ln.lnormy*s.axisy,ln.gprojection=s.posx*ln.gnormx+s.posy*ln.gnormy+ln.lprojection,ln.tp0=en.y*ln.gnormx-en.x*ln.gnormy,ln.tp1=tn.y*ln.gnormx-tn.x*ln.gnormy,en=tn,nn=nn.next}var pn=W.gverts.next,rn=$.elt;$=$.next,rn.gnormx=s.axisy*rn.lnormx-s.axisx*rn.lnormy,rn.gnormy=rn.lnormx*s.axisx+rn.lnormy*s.axisy,rn.gprojection=s.posx*rn.gnormx+s.posy*rn.gnormy+rn.lprojection,rn.tp0=en.y*rn.gnormx-en.x*rn.gnormy,rn.tp1=pn.y*rn.gnormx-pn.x*rn.gnormy}var an,sn=p,on=r,_n=d,hn=v;if(sn.type==me.id_ShapeType_CIRCLE&&on.type==me.id_ShapeType_CIRCLE){var un,xn=sn.circle,dn=on.circle,vn=0,zn=0;vn=dn.worldCOMx-xn.worldCOMx,zn=dn.worldCOMy-xn.worldCOMy;var cn=Math.sqrt(vn*vn+zn*zn);if(1e100>(un=cn-(xn.radius+dn.radius))){if(0==cn)vn=1,zn=0;else{var mn=1/cn;vn*=mn,zn*=mn}var yn=xn.radius;_n.x=xn.worldCOMx+vn*yn,_n.y=xn.worldCOMy+zn*yn;var fn=-dn.radius;hn.x=dn.worldCOMx+vn*fn,hn.y=dn.worldCOMy+zn*fn,z.x=vn,z.y=zn}an=un}else{var bn=!1;if(sn.type==me.id_ShapeType_CIRCLE&&on.type==me.id_ShapeType_POLYGON){var gn=sn;sn=on,on=gn;var wn=_n;_n=hn,hn=wn,bn=!0}if(sn.type==me.id_ShapeType_POLYGON&&on.type==me.id_ShapeType_CIRCLE){for(var Mn=sn.polygon,Cn=on.circle,kn=-1e100,On=null,In=Mn.edges.head;null!=In;){var Sn=In.elt,Pn=Sn.gnormx*Cn.worldCOMx+Sn.gnormy*Cn.worldCOMy-Sn.gprojection-Cn.radius;if(Pn>1e100){kn=Pn;break}Pn>0?Pn>kn&&(kn=Pn,On=Sn):0>kn&&Pn>kn&&(kn=Pn,On=Sn),In=In.next}if(1e100>kn){var Tn=On.gp0,An=On.gp1,En=Cn.worldCOMy*On.gnormx-Cn.worldCOMx*On.gnormy;if(Tn.y*On.gnormx-Tn.x*On.gnormy<En)if(En<An.y*On.gnormx-An.x*On.gnormy){var Nn=-Cn.radius;hn.x=Cn.worldCOMx+On.gnormx*Nn,hn.y=Cn.worldCOMy+On.gnormy*Nn;var Ln=-kn;_n.x=hn.x+On.gnormx*Ln,_n.y=hn.y+On.gnormy*Ln,z.x=On.gnormx,z.y=On.gnormy}else{var Vn=0,jn=0;Vn=Cn.worldCOMx-An.x,jn=Cn.worldCOMy-An.y;var Dn=Math.sqrt(Vn*Vn+jn*jn);if(1e100>(kn=Dn-Cn.radius)){if(0==Dn)Vn=1,jn=0;else{var Fn=1/Dn;Vn*=Fn,jn*=Fn}_n.x=An.x+0*Vn,_n.y=An.y+0*jn;var Rn=-Cn.radius;hn.x=Cn.worldCOMx+Vn*Rn,hn.y=Cn.worldCOMy+jn*Rn,z.x=Vn,z.y=jn}}else{var Bn=0,Gn=0;Bn=Cn.worldCOMx-Tn.x,Gn=Cn.worldCOMy-Tn.y;var Zn=Math.sqrt(Bn*Bn+Gn*Gn);if(1e100>(kn=Zn-Cn.radius)){if(0==Zn)Bn=1,Gn=0;else{var Un=1/Zn;Bn*=Un,Gn*=Un}_n.x=Tn.x+0*Bn,_n.y=Tn.y+0*Gn;var qn=-Cn.radius;hn.x=Cn.worldCOMx+Bn*qn,hn.y=Cn.worldCOMy+Gn*qn,z.x=Bn,z.y=Gn}}}bn&&(z.x=-z.x,z.y=-z.y),an=kn}else{for(var Yn=sn.polygon,Kn=on.polygon,Wn=-1e100,Jn=null,Xn=null,Hn=0,Qn=Yn.edges.head;null!=Qn;){for(var $n=Qn.elt,ne=1e100,ee=Kn.gverts.next;null!=ee;){var ie=ee,te=$n.gnormx*ie.x+$n.gnormy*ie.y;ne>te&&(ne=te),ee=ee.next}if((ne-=$n.gprojection)>1e100){Wn=ne;break}ne>0?ne>Wn&&(Wn=ne,Jn=$n,Hn=1):0>Wn&&ne>Wn&&(Wn=ne,Jn=$n,Hn=1),Qn=Qn.next}if(1e100>Wn){for(var le=Kn.edges.head;null!=le;){for(var pe=le.elt,re=1e100,ae=Yn.gverts.next;null!=ae;){var se=ae,oe=pe.gnormx*se.x+pe.gnormy*se.y;re>oe&&(re=oe),ae=ae.next}if((re-=pe.gprojection)>1e100){Wn=re;break}re>0?re>Wn&&(Wn=re,Xn=pe,Hn=2):0>Wn&&re>Wn&&(Wn=re,Xn=pe,Hn=2),le=le.next}if(1e100>Wn){var _e,he;if(1==Hn)Yn,_e=Kn,he=Jn;else{Kn,_e=Yn,he=Xn;var ue=_n;_n=hn,hn=ue,bn=!bn}for(var xe=null,de=1e100,ve=_e.edges.head;null!=ve;){var ze=ve.elt,ce=he.gnormx*ze.gnormx+he.gnormy*ze.gnormy;de>ce&&(de=ce,xe=ze),ve=ve.next}if(bn?(z.x=-he.gnormx,z.y=-he.gnormy):(z.x=he.gnormx,z.y=he.gnormy),0>Wn){var ye=0,fe=0;ye=xe.gp0.x,fe=xe.gp0.y;var be=0,ge=0;be=xe.gp1.x,ge=xe.gp1.y;var we=0,Me=0;we=be-ye,Me=ge-fe;var Ce=he.gnormy*ye-he.gnormx*fe,ke=he.gnormy*be-he.gnormx*ge,Oe=1/(ke-Ce),Ie=(-he.tp1-Ce)*Oe;if(Ie>y.epsilon){var Se=Ie;ye+=we*Se,fe+=Me*Se}var Pe=(-he.tp0-ke)*Oe;if(-y.epsilon>Pe){var Te=Pe;be+=we*Te,ge+=Me*Te}var Ae=ye*he.gnormx+fe*he.gnormy-he.gprojection,Ee=be*he.gnormx+ge*he.gnormy-he.gprojection;if(Ee>Ae){hn.x=ye,hn.y=fe;var Ne=-Ae;_n.x=hn.x+he.gnormx*Ne,_n.y=hn.y+he.gnormy*Ne,an=Ae}else{hn.x=be,hn.y=ge;var Le=-Ee;_n.x=hn.x+he.gnormx*Le,_n.y=hn.y+he.gnormy*Le,an=Ee}}else{var Ve=he.gp0,je=he.gp1,De=xe.gp0,Fe=xe.gp1,Re=0,Be=0,Ge=0,Ze=0;Re=je.x-Ve.x,Be=je.y-Ve.y,Ge=Fe.x-De.x,Ze=Fe.y-De.y;var Ue=1/(Re*Re+Be*Be),qe=1/(Ge*Ge+Ze*Ze),Ye=-(Re*(Ve.x-De.x)+Be*(Ve.y-De.y))*Ue,Ke=-(Re*(Ve.x-Fe.x)+Be*(Ve.y-Fe.y))*Ue,We=-(Ge*(De.x-Ve.x)+Ze*(De.y-Ve.y))*qe,Je=-(Ge*(De.x-je.x)+Ze*(De.y-je.y))*qe;0>Ye?Ye=0:Ye>1&&(Ye=1),0>Ke?Ke=0:Ke>1&&(Ke=1),0>We?We=0:We>1&&(We=1),0>Je?Je=0:Je>1&&(Je=1);var Xe=0,He=0,Qe=Ye;Xe=Ve.x+Re*Qe,He=Ve.y+Be*Qe;var $e=0,ni=0,ei=Ke;$e=Ve.x+Re*ei,ni=Ve.y+Be*ei;var ii=0,ti=0,li=We;ii=De.x+Ge*li,ti=De.y+Ze*li;var pi=0,ri=0,ai=Je;pi=De.x+Ge*ai,ri=De.y+Ze*ai;var si=0,oi=0;si=Xe-De.x,oi=He-De.y;var _i=si*si+oi*oi,hi=0,ui=0;hi=$e-Fe.x,ui=ni-Fe.y;var xi=hi*hi+ui*ui,di=0,vi=0;di=ii-Ve.x,vi=ti-Ve.y;var zi=di*di+vi*vi,ci=0,mi=0;ci=pi-je.x,mi=ri-je.y;var yi=ci*ci+mi*mi,fi=0,bi=0,gi=null;xi>_i?(fi=Xe,bi=He,gi=De):(fi=$e,bi=ni,gi=Fe,_i=xi);var wi=0,Mi=0,Ci=null;if(yi>zi?(wi=ii,Mi=ti,Ci=Ve):(wi=pi,Mi=ri,Ci=je,zi=yi),zi>_i?(_n.x=fi,_n.y=bi,hn.x=gi.x,hn.y=gi.y,Wn=Math.sqrt(_i)):(hn.x=wi,hn.y=Mi,_n.x=Ci.x,_n.y=Ci.y,Wn=Math.sqrt(zi)),0!=Wn){z.x=hn.x-_n.x,z.y=hn.y-_n.y;var ki=1/Wn;z.x*=ki,z.y*=ki,bn&&(z.x=-z.x,z.y=-z.y)}an=Wn}}else an=1e100}else an=1e100}}var Oi=an+t,Ii=o*z.x+_*z.y;if(y.distanceThresholdCCD>Oi){if(l)break;var Si=0,Pi=0;Si=d.x-a.posx,Pi=d.y-a.posy;var Ti=0,Ai=0;Ti=v.x-s.posx,Ai=v.y-s.posy;var Ei=Ii-a.sweep_angvel*(z.y*Si-z.x*Pi)+s.sweep_angvel*(z.y*Ti-z.x*Ai);if(Ei>0&&(n.slipped=!0),0>=Ei||.5*y.distanceThresholdCCD>Oi)break}var Ni=(x-Ii)*e;if(0>=Ni){c=-1;break}var Li=Oi/Ni;if(1e-6>Li&&(Li=1e-6),(c+=Li)>=1){c=1;var Vi=c*e,ji=Vi-a.sweepTime;if(0!=ji){a.sweepTime=Vi;var Di=ji;if(a.posx+=a.velx*Di,a.posy+=a.vely*Di,0!=a.angvel){var Fi=a.sweep_angvel*ji;if(a.rot+=Fi,Fi*Fi>1e-4)a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot);else{var Ri=Fi*Fi,Bi=1-.5*Ri,Gi=1-Ri*Ri/8,Zi=(Bi*a.axisx+Fi*a.axisy)*Gi;a.axisy=(Bi*a.axisy-Fi*a.axisx)*Gi,a.axisx=Zi}}}if(p.type==me.id_ShapeType_CIRCLE)p.worldCOMx=a.posx+(a.axisy*p.localCOMx-a.axisx*p.localCOMy),p.worldCOMy=a.posy+(p.localCOMx*a.axisx+p.localCOMy*a.axisy);else{for(var Ui=p.polygon,qi=Ui.lverts.next,Yi=Ui.gverts.next;null!=Yi;){var Ki=Yi,Wi=qi;qi=qi.next,Ki.x=a.posx+(a.axisy*Wi.x-a.axisx*Wi.y),Ki.y=a.posy+(Wi.x*a.axisx+Wi.y*a.axisy),Yi=Yi.next}var Ji=Ui.edges.head,Xi=Ui.gverts.next,Hi=Xi;for(Xi=Xi.next;null!=Xi;){var Qi=Xi,$i=Ji.elt;Ji=Ji.next,$i.gnormx=a.axisy*$i.lnormx-a.axisx*$i.lnormy,$i.gnormy=$i.lnormx*a.axisx+$i.lnormy*a.axisy,$i.gprojection=a.posx*$i.gnormx+a.posy*$i.gnormy+$i.lprojection,$i.tp0=Hi.y*$i.gnormx-Hi.x*$i.gnormy,$i.tp1=Qi.y*$i.gnormx-Qi.x*$i.gnormy,Hi=Qi,Xi=Xi.next}var nt=Ui.gverts.next,et=Ji.elt;Ji=Ji.next,et.gnormx=a.axisy*et.lnormx-a.axisx*et.lnormy,et.gnormy=et.lnormx*a.axisx+et.lnormy*a.axisy,et.gprojection=a.posx*et.gnormx+a.posy*et.gnormy+et.lprojection,et.tp0=Hi.y*et.gnormx-Hi.x*et.gnormy,et.tp1=nt.y*et.gnormx-nt.x*et.gnormy}var it=c*e,tt=it-s.sweepTime;if(0!=tt){s.sweepTime=it;var lt=tt;if(s.posx+=s.velx*lt,s.posy+=s.vely*lt,0!=s.angvel){var pt=s.sweep_angvel*tt;if(s.rot+=pt,pt*pt>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var rt=pt*pt,at=1-.5*rt,st=1-rt*rt/8,ot=(at*s.axisx+pt*s.axisy)*st;s.axisy=(at*s.axisy-pt*s.axisx)*st,s.axisx=ot}}}if(r.type==me.id_ShapeType_CIRCLE)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var _t=r.polygon,ht=_t.lverts.next,ut=_t.gverts.next;null!=ut;){var xt=ut,dt=ht;ht=ht.next,xt.x=s.posx+(s.axisy*dt.x-s.axisx*dt.y),xt.y=s.posy+(dt.x*s.axisx+dt.y*s.axisy),ut=ut.next}var vt=_t.edges.head,zt=_t.gverts.next,ct=zt;for(zt=zt.next;null!=zt;){var mt=zt,yt=vt.elt;vt=vt.next,yt.gnormx=s.axisy*yt.lnormx-s.axisx*yt.lnormy,yt.gnormy=yt.lnormx*s.axisx+yt.lnormy*s.axisy,yt.gprojection=s.posx*yt.gnormx+s.posy*yt.gnormy+yt.lprojection,yt.tp0=ct.y*yt.gnormx-ct.x*yt.gnormy,yt.tp1=mt.y*yt.gnormx-mt.x*yt.gnormy,ct=mt,zt=zt.next}var ft=_t.gverts.next,bt=vt.elt;vt=vt.next,bt.gnormx=s.axisy*bt.lnormx-s.axisx*bt.lnormy,bt.gnormy=bt.lnormx*s.axisx+bt.lnormy*s.axisy,bt.gprojection=s.posx*bt.gnormx+s.posy*bt.gnormy+bt.lprojection,bt.tp0=ct.y*bt.gnormx-ct.x*bt.gnormy,bt.tp1=ft.y*bt.gnormx-ft.x*bt.gnormy}var gt,wt=p,Mt=r,Ct=d,kt=v;if(wt.type==me.id_ShapeType_CIRCLE&&Mt.type==me.id_ShapeType_CIRCLE){var Ot,It=wt.circle,St=Mt.circle,Pt=0,Tt=0;Pt=St.worldCOMx-It.worldCOMx,Tt=St.worldCOMy-It.worldCOMy;var At=Math.sqrt(Pt*Pt+Tt*Tt);if(1e100>(Ot=At-(It.radius+St.radius))){if(0==At)Pt=1,Tt=0;else{var Et=1/At;Pt*=Et,Tt*=Et}var Nt=It.radius;Ct.x=It.worldCOMx+Pt*Nt,Ct.y=It.worldCOMy+Tt*Nt;var Lt=-St.radius;kt.x=St.worldCOMx+Pt*Lt,kt.y=St.worldCOMy+Tt*Lt,z.x=Pt,z.y=Tt}gt=Ot}else{var Vt=!1;if(wt.type==me.id_ShapeType_CIRCLE&&Mt.type==me.id_ShapeType_POLYGON){var jt=wt;wt=Mt,Mt=jt;var Dt=Ct;Ct=kt,kt=Dt,Vt=!0}if(wt.type==me.id_ShapeType_POLYGON&&Mt.type==me.id_ShapeType_CIRCLE){for(var Ft=wt.polygon,Rt=Mt.circle,Bt=-1e100,Gt=null,Zt=Ft.edges.head;null!=Zt;){var Ut=Zt.elt,qt=Ut.gnormx*Rt.worldCOMx+Ut.gnormy*Rt.worldCOMy-Ut.gprojection-Rt.radius;if(qt>1e100){Bt=qt;break}qt>0?qt>Bt&&(Bt=qt,Gt=Ut):0>Bt&&qt>Bt&&(Bt=qt,Gt=Ut),Zt=Zt.next}if(1e100>Bt){var Yt=Gt.gp0,Kt=Gt.gp1,Wt=Rt.worldCOMy*Gt.gnormx-Rt.worldCOMx*Gt.gnormy;if(Yt.y*Gt.gnormx-Yt.x*Gt.gnormy<Wt)if(Wt<Kt.y*Gt.gnormx-Kt.x*Gt.gnormy){var Jt=-Rt.radius;kt.x=Rt.worldCOMx+Gt.gnormx*Jt,kt.y=Rt.worldCOMy+Gt.gnormy*Jt;var Xt=-Bt;Ct.x=kt.x+Gt.gnormx*Xt,Ct.y=kt.y+Gt.gnormy*Xt,z.x=Gt.gnormx,z.y=Gt.gnormy}else{var Ht=0,Qt=0;Ht=Rt.worldCOMx-Kt.x,Qt=Rt.worldCOMy-Kt.y;var $t=Math.sqrt(Ht*Ht+Qt*Qt);if(1e100>(Bt=$t-Rt.radius)){if(0==$t)Ht=1,Qt=0;else{var nl=1/$t;Ht*=nl,Qt*=nl}Ct.x=Kt.x+0*Ht,Ct.y=Kt.y+0*Qt;var el=-Rt.radius;kt.x=Rt.worldCOMx+Ht*el,kt.y=Rt.worldCOMy+Qt*el,z.x=Ht,z.y=Qt}}else{var il=0,tl=0;il=Rt.worldCOMx-Yt.x,tl=Rt.worldCOMy-Yt.y;var ll=Math.sqrt(il*il+tl*tl);if(1e100>(Bt=ll-Rt.radius)){if(0==ll)il=1,tl=0;else{var pl=1/ll;il*=pl,tl*=pl}Ct.x=Yt.x+0*il,Ct.y=Yt.y+0*tl;var rl=-Rt.radius;kt.x=Rt.worldCOMx+il*rl,kt.y=Rt.worldCOMy+tl*rl,z.x=il,z.y=tl}}}Vt&&(z.x=-z.x,z.y=-z.y),gt=Bt}else{for(var al=wt.polygon,sl=Mt.polygon,ol=-1e100,_l=null,hl=null,ul=0,xl=al.edges.head;null!=xl;){for(var dl=xl.elt,vl=1e100,zl=sl.gverts.next;null!=zl;){var cl=zl,ml=dl.gnormx*cl.x+dl.gnormy*cl.y;vl>ml&&(vl=ml),zl=zl.next}if((vl-=dl.gprojection)>1e100){ol=vl;break}vl>0?vl>ol&&(ol=vl,_l=dl,ul=1):0>ol&&vl>ol&&(ol=vl,_l=dl,ul=1),xl=xl.next}if(1e100>ol){for(var yl=sl.edges.head;null!=yl;){for(var fl=yl.elt,bl=1e100,gl=al.gverts.next;null!=gl;){var wl=gl,Ml=fl.gnormx*wl.x+fl.gnormy*wl.y;bl>Ml&&(bl=Ml),gl=gl.next}if((bl-=fl.gprojection)>1e100){ol=bl;break}bl>0?bl>ol&&(ol=bl,hl=fl,ul=2):0>ol&&bl>ol&&(ol=bl,hl=fl,ul=2),yl=yl.next}if(1e100>ol){var Cl,kl;if(1==ul)al,Cl=sl,kl=_l;else{sl,Cl=al,kl=hl;var Ol=Ct;Ct=kt,kt=Ol,Vt=!Vt}for(var Il=null,Sl=1e100,Pl=Cl.edges.head;null!=Pl;){var Tl=Pl.elt,Al=kl.gnormx*Tl.gnormx+kl.gnormy*Tl.gnormy;Sl>Al&&(Sl=Al,Il=Tl),Pl=Pl.next}if(Vt?(z.x=-kl.gnormx,z.y=-kl.gnormy):(z.x=kl.gnormx,z.y=kl.gnormy),0>ol){var El=0,Nl=0;El=Il.gp0.x,Nl=Il.gp0.y;var Ll=0,Vl=0;Ll=Il.gp1.x,Vl=Il.gp1.y;var jl=0,Dl=0;jl=Ll-El,Dl=Vl-Nl;var Fl=kl.gnormy*El-kl.gnormx*Nl,Rl=kl.gnormy*Ll-kl.gnormx*Vl,Bl=1/(Rl-Fl),Gl=(-kl.tp1-Fl)*Bl;if(Gl>y.epsilon){var Zl=Gl;El+=jl*Zl,Nl+=Dl*Zl}var Ul=(-kl.tp0-Rl)*Bl;if(-y.epsilon>Ul){var ql=Ul;Ll+=jl*ql,Vl+=Dl*ql}var Yl=El*kl.gnormx+Nl*kl.gnormy-kl.gprojection,Kl=Ll*kl.gnormx+Vl*kl.gnormy-kl.gprojection;if(Kl>Yl){kt.x=El,kt.y=Nl;var Wl=-Yl;Ct.x=kt.x+kl.gnormx*Wl,Ct.y=kt.y+kl.gnormy*Wl,gt=Yl}else{kt.x=Ll,kt.y=Vl;var Jl=-Kl;Ct.x=kt.x+kl.gnormx*Jl,Ct.y=kt.y+kl.gnormy*Jl,gt=Kl}}else{var Xl=kl.gp0,Hl=kl.gp1,Ql=Il.gp0,$l=Il.gp1,np=0,ep=0,ip=0,tp=0;np=Hl.x-Xl.x,ep=Hl.y-Xl.y,ip=$l.x-Ql.x,tp=$l.y-Ql.y;var lp=1/(np*np+ep*ep),pp=1/(ip*ip+tp*tp),rp=-(np*(Xl.x-Ql.x)+ep*(Xl.y-Ql.y))*lp,ap=-(np*(Xl.x-$l.x)+ep*(Xl.y-$l.y))*lp,sp=-(ip*(Ql.x-Xl.x)+tp*(Ql.y-Xl.y))*pp,op=-(ip*(Ql.x-Hl.x)+tp*(Ql.y-Hl.y))*pp;0>rp?rp=0:rp>1&&(rp=1),0>ap?ap=0:ap>1&&(ap=1),0>sp?sp=0:sp>1&&(sp=1),0>op?op=0:op>1&&(op=1);var _p=0,hp=0,up=rp;_p=Xl.x+np*up,hp=Xl.y+ep*up;var xp=0,dp=0,vp=ap;xp=Xl.x+np*vp,dp=Xl.y+ep*vp;var zp=0,cp=0,mp=sp;zp=Ql.x+ip*mp,cp=Ql.y+tp*mp;var yp=0,fp=0,bp=op;yp=Ql.x+ip*bp,fp=Ql.y+tp*bp;var gp=0,wp=0;gp=_p-Ql.x,wp=hp-Ql.y;var Mp=gp*gp+wp*wp,Cp=0,kp=0;Cp=xp-$l.x,kp=dp-$l.y;var Op=Cp*Cp+kp*kp,Ip=0,Sp=0;Ip=zp-Xl.x,Sp=cp-Xl.y;var Pp=Ip*Ip+Sp*Sp,Tp=0,Ap=0;Tp=yp-Hl.x,Ap=fp-Hl.y;var Ep=Tp*Tp+Ap*Ap,Np=0,Lp=0,Vp=null;Op>Mp?(Np=_p,Lp=hp,Vp=Ql):(Np=xp,Lp=dp,Vp=$l,Mp=Op);var jp=0,Dp=0,Fp=null;if(Ep>Pp?(jp=zp,Dp=cp,Fp=Xl):(jp=yp,Dp=fp,Fp=Hl,Pp=Ep),Pp>Mp?(Ct.x=Np,Ct.y=Lp,kt.x=Vp.x,kt.y=Vp.y,ol=Math.sqrt(Mp)):(kt.x=jp,kt.y=Dp,Ct.x=Fp.x,Ct.y=Fp.y,ol=Math.sqrt(Pp)),0!=ol){z.x=kt.x-Ct.x,z.y=kt.y-Ct.y;var Rp=1/ol;z.x*=Rp,z.y*=Rp,Vt&&(z.x=-z.x,z.y=-z.y)}gt=ol}}else gt=1e100}else gt=1e100}}var Bp=gt+t,Gp=o*z.x+_*z.y;if(y.distanceThresholdCCD>Bp){if(l)break;var Zp=0,Up=0;Zp=d.x-a.posx,Up=d.y-a.posy;var qp=0,Yp=0;qp=v.x-s.posx,Yp=v.y-s.posy;var Kp=Gp-a.sweep_angvel*(z.y*Zp-z.x*Up)+s.sweep_angvel*(z.y*qp-z.x*Yp);if(Kp>0&&(n.slipped=!0),0>=Kp||.5*y.distanceThresholdCCD>Bp)break}c=-1;break}if(++m>=40){Oi>t&&(n.failed=!0);break}}n.toi=c},bi.staticSweep=function(n,e,i,t){var l=n.s1,p=n.s2,r=l.body,a=0,s=0;a=-r.velx,s=-r.vely;var o=r.sweep_angvel;0>o&&(o=-o);for(var _=l.sweepCoef*o,h=n.c1,u=n.c2,x=n.axis,d=i,v=0;;){var z=d*e,c=z-r.sweepTime;if(0!=c){r.sweepTime=z;var m=c;if(r.posx+=r.velx*m,r.posy+=r.vely*m,0!=r.angvel){var f=r.sweep_angvel*c;if(r.rot+=f,f*f>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var b=f*f,g=1-.5*b,w=1-b*b/8,M=(g*r.axisx+f*r.axisy)*w;r.axisy=(g*r.axisy-f*r.axisx)*w,r.axisx=M}}}if(l.type==me.id_ShapeType_CIRCLE)l.worldCOMx=r.posx+(r.axisy*l.localCOMx-r.axisx*l.localCOMy),l.worldCOMy=r.posy+(l.localCOMx*r.axisx+l.localCOMy*r.axisy);else{for(var C=l.polygon,k=C.lverts.next,O=C.gverts.next;null!=O;){var I=O,S=k;k=k.next,I.x=r.posx+(r.axisy*S.x-r.axisx*S.y),I.y=r.posy+(S.x*r.axisx+S.y*r.axisy),O=O.next}var P=C.edges.head,T=C.gverts.next,A=T;for(T=T.next;null!=T;){var E=T,N=P.elt;P=P.next,N.gnormx=r.axisy*N.lnormx-r.axisx*N.lnormy,N.gnormy=N.lnormx*r.axisx+N.lnormy*r.axisy,N.gprojection=r.posx*N.gnormx+r.posy*N.gnormy+N.lprojection,N.tp0=A.y*N.gnormx-A.x*N.gnormy,N.tp1=E.y*N.gnormx-E.x*N.gnormy,A=E,T=T.next}var L=C.gverts.next,V=P.elt;P=P.next,V.gnormx=r.axisy*V.lnormx-r.axisx*V.lnormy,V.gnormy=V.lnormx*r.axisx+V.lnormy*r.axisy,V.gprojection=r.posx*V.gnormx+r.posy*V.gnormy+V.lprojection,V.tp0=A.y*V.gnormx-A.x*V.gnormy,V.tp1=L.y*V.gnormx-L.x*V.gnormy}var j,D=l,F=p,R=h,B=u;if(D.type==me.id_ShapeType_CIRCLE&&F.type==me.id_ShapeType_CIRCLE){var G,Z=D.circle,U=F.circle,q=0,Y=0;q=U.worldCOMx-Z.worldCOMx,Y=U.worldCOMy-Z.worldCOMy;var K=Math.sqrt(q*q+Y*Y);if(1e100>(G=K-(Z.radius+U.radius))){if(0==K)q=1,Y=0;else{var W=1/K;q*=W,Y*=W}var J=Z.radius;R.x=Z.worldCOMx+q*J,R.y=Z.worldCOMy+Y*J;var X=-U.radius;B.x=U.worldCOMx+q*X,B.y=U.worldCOMy+Y*X,x.x=q,x.y=Y}j=G}else{var H=!1;if(D.type==me.id_ShapeType_CIRCLE&&F.type==me.id_ShapeType_POLYGON){var Q=D;D=F,F=Q;var $=R;R=B,B=$,H=!0}if(D.type==me.id_ShapeType_POLYGON&&F.type==me.id_ShapeType_CIRCLE){for(var nn=D.polygon,en=F.circle,tn=-1e100,ln=null,pn=nn.edges.head;null!=pn;){var rn=pn.elt,an=rn.gnormx*en.worldCOMx+rn.gnormy*en.worldCOMy-rn.gprojection-en.radius;if(an>1e100){tn=an;break}an>0?an>tn&&(tn=an,ln=rn):0>tn&&an>tn&&(tn=an,ln=rn),pn=pn.next}if(1e100>tn){var sn=ln.gp0,on=ln.gp1,_n=en.worldCOMy*ln.gnormx-en.worldCOMx*ln.gnormy;if(sn.y*ln.gnormx-sn.x*ln.gnormy<_n)if(_n<on.y*ln.gnormx-on.x*ln.gnormy){var hn=-en.radius;B.x=en.worldCOMx+ln.gnormx*hn,B.y=en.worldCOMy+ln.gnormy*hn;var un=-tn;R.x=B.x+ln.gnormx*un,R.y=B.y+ln.gnormy*un,x.x=ln.gnormx,x.y=ln.gnormy}else{var xn=0,dn=0;xn=en.worldCOMx-on.x,dn=en.worldCOMy-on.y;var vn=Math.sqrt(xn*xn+dn*dn);if(1e100>(tn=vn-en.radius)){if(0==vn)xn=1,dn=0;else{var zn=1/vn;xn*=zn,dn*=zn}R.x=on.x+0*xn,R.y=on.y+0*dn;var cn=-en.radius;B.x=en.worldCOMx+xn*cn,B.y=en.worldCOMy+dn*cn,x.x=xn,x.y=dn}}else{var mn=0,yn=0;mn=en.worldCOMx-sn.x,yn=en.worldCOMy-sn.y;var fn=Math.sqrt(mn*mn+yn*yn);if(1e100>(tn=fn-en.radius)){if(0==fn)mn=1,yn=0;else{var bn=1/fn;mn*=bn,yn*=bn}R.x=sn.x+0*mn,R.y=sn.y+0*yn;var gn=-en.radius;B.x=en.worldCOMx+mn*gn,B.y=en.worldCOMy+yn*gn,x.x=mn,x.y=yn}}}H&&(x.x=-x.x,x.y=-x.y),j=tn}else{for(var wn=D.polygon,Mn=F.polygon,Cn=-1e100,kn=null,On=null,In=0,Sn=wn.edges.head;null!=Sn;){for(var Pn=Sn.elt,Tn=1e100,An=Mn.gverts.next;null!=An;){var En=An,Nn=Pn.gnormx*En.x+Pn.gnormy*En.y;Tn>Nn&&(Tn=Nn),An=An.next}if((Tn-=Pn.gprojection)>1e100){Cn=Tn;break}Tn>0?Tn>Cn&&(Cn=Tn,kn=Pn,In=1):0>Cn&&Tn>Cn&&(Cn=Tn,kn=Pn,In=1),Sn=Sn.next}if(1e100>Cn){for(var Ln=Mn.edges.head;null!=Ln;){for(var Vn=Ln.elt,jn=1e100,Dn=wn.gverts.next;null!=Dn;){var Fn=Dn,Rn=Vn.gnormx*Fn.x+Vn.gnormy*Fn.y;jn>Rn&&(jn=Rn),Dn=Dn.next}if((jn-=Vn.gprojection)>1e100){Cn=jn;break}jn>0?jn>Cn&&(Cn=jn,On=Vn,In=2):0>Cn&&jn>Cn&&(Cn=jn,On=Vn,In=2),Ln=Ln.next}if(1e100>Cn){var Bn,Gn;if(1==In)wn,Bn=Mn,Gn=kn;else{Mn,Bn=wn,Gn=On;var Zn=R;R=B,B=Zn,H=!H}for(var Un=null,qn=1e100,Yn=Bn.edges.head;null!=Yn;){var Kn=Yn.elt,Wn=Gn.gnormx*Kn.gnormx+Gn.gnormy*Kn.gnormy;qn>Wn&&(qn=Wn,Un=Kn),Yn=Yn.next}if(H?(x.x=-Gn.gnormx,x.y=-Gn.gnormy):(x.x=Gn.gnormx,x.y=Gn.gnormy),0>Cn){var Jn=0,Xn=0;Jn=Un.gp0.x,Xn=Un.gp0.y;var Hn=0,Qn=0;Hn=Un.gp1.x,Qn=Un.gp1.y;var $n=0,ne=0;$n=Hn-Jn,ne=Qn-Xn;var ee=Gn.gnormy*Jn-Gn.gnormx*Xn,ie=Gn.gnormy*Hn-Gn.gnormx*Qn,te=1/(ie-ee),le=(-Gn.tp1-ee)*te;if(le>y.epsilon){var pe=le;Jn+=$n*pe,Xn+=ne*pe}var re=(-Gn.tp0-ie)*te;if(-y.epsilon>re){var ae=re;Hn+=$n*ae,Qn+=ne*ae}var se=Jn*Gn.gnormx+Xn*Gn.gnormy-Gn.gprojection,oe=Hn*Gn.gnormx+Qn*Gn.gnormy-Gn.gprojection;if(oe>se){B.x=Jn,B.y=Xn;var _e=-se;R.x=B.x+Gn.gnormx*_e,R.y=B.y+Gn.gnormy*_e,j=se}else{B.x=Hn,B.y=Qn;var he=-oe;R.x=B.x+Gn.gnormx*he,R.y=B.y+Gn.gnormy*he,j=oe}}else{var ue=Gn.gp0,xe=Gn.gp1,de=Un.gp0,ve=Un.gp1,ze=0,ce=0,ye=0,fe=0;ze=xe.x-ue.x,ce=xe.y-ue.y,ye=ve.x-de.x,fe=ve.y-de.y;var be=1/(ze*ze+ce*ce),ge=1/(ye*ye+fe*fe),we=-(ze*(ue.x-de.x)+ce*(ue.y-de.y))*be,Me=-(ze*(ue.x-ve.x)+ce*(ue.y-ve.y))*be,Ce=-(ye*(de.x-ue.x)+fe*(de.y-ue.y))*ge,ke=-(ye*(de.x-xe.x)+fe*(de.y-xe.y))*ge;0>we?we=0:we>1&&(we=1),0>Me?Me=0:Me>1&&(Me=1),0>Ce?Ce=0:Ce>1&&(Ce=1),0>ke?ke=0:ke>1&&(ke=1);var Oe=0,Ie=0,Se=we;Oe=ue.x+ze*Se,Ie=ue.y+ce*Se;var Pe=0,Te=0,Ae=Me;Pe=ue.x+ze*Ae,Te=ue.y+ce*Ae;var Ee=0,Ne=0,Le=Ce;Ee=de.x+ye*Le,Ne=de.y+fe*Le;var Ve=0,je=0,De=ke;Ve=de.x+ye*De,je=de.y+fe*De;var Fe=0,Re=0;Fe=Oe-de.x,Re=Ie-de.y;var Be=Fe*Fe+Re*Re,Ge=0,Ze=0;Ge=Pe-ve.x,Ze=Te-ve.y;var Ue=Ge*Ge+Ze*Ze,qe=0,Ye=0;qe=Ee-ue.x,Ye=Ne-ue.y;var Ke=qe*qe+Ye*Ye,We=0,Je=0;We=Ve-xe.x,Je=je-xe.y;var Xe=We*We+Je*Je,He=0,Qe=0,$e=null;Ue>Be?(He=Oe,Qe=Ie,$e=de):(He=Pe,Qe=Te,$e=ve,Be=Ue);var ni=0,ei=0,ii=null;if(Xe>Ke?(ni=Ee,ei=Ne,ii=ue):(ni=Ve,ei=je,ii=xe,Ke=Xe),Ke>Be?(R.x=He,R.y=Qe,B.x=$e.x,B.y=$e.y,Cn=Math.sqrt(Be)):(B.x=ni,B.y=ei,R.x=ii.x,R.y=ii.y,Cn=Math.sqrt(Ke)),0!=Cn){x.x=B.x-R.x,x.y=B.y-R.y;var ti=1/Cn;x.x*=ti,x.y*=ti,H&&(x.x=-x.x,x.y=-x.y)}j=Cn}}else j=1e100}else j=1e100}}var li=j+t,pi=a*x.x+s*x.y;if(y.distanceThresholdCCD>li){var ri=0,ai=0;ri=h.x-r.posx,ai=h.y-r.posy;var si=pi-r.sweep_angvel*(x.y*ri-x.x*ai);if(si>0&&(n.slipped=!0),0>=si||.5*y.distanceThresholdCCD>li)break}var oi=(_-pi)*e;if(0>=oi){d=-1;break}var _i=li/oi;if(1e-6>_i&&(_i=1e-6),(d+=_i)>=1){d=1;var hi=d*e,ui=hi-r.sweepTime;if(0!=ui){r.sweepTime=hi;var xi=ui;if(r.posx+=r.velx*xi,r.posy+=r.vely*xi,0!=r.angvel){var di=r.sweep_angvel*ui;if(r.rot+=di,di*di>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var vi=di*di,zi=1-.5*vi,ci=1-vi*vi/8,mi=(zi*r.axisx+di*r.axisy)*ci;r.axisy=(zi*r.axisy-di*r.axisx)*ci,r.axisx=mi}}}if(l.type==me.id_ShapeType_CIRCLE)l.worldCOMx=r.posx+(r.axisy*l.localCOMx-r.axisx*l.localCOMy),l.worldCOMy=r.posy+(l.localCOMx*r.axisx+l.localCOMy*r.axisy);else{for(var yi=l.polygon,fi=yi.lverts.next,bi=yi.gverts.next;null!=bi;){var gi=bi,wi=fi;fi=fi.next,gi.x=r.posx+(r.axisy*wi.x-r.axisx*wi.y),gi.y=r.posy+(wi.x*r.axisx+wi.y*r.axisy),bi=bi.next}var Mi=yi.edges.head,Ci=yi.gverts.next,ki=Ci;for(Ci=Ci.next;null!=Ci;){var Oi=Ci,Ii=Mi.elt;Mi=Mi.next,Ii.gnormx=r.axisy*Ii.lnormx-r.axisx*Ii.lnormy,Ii.gnormy=Ii.lnormx*r.axisx+Ii.lnormy*r.axisy,Ii.gprojection=r.posx*Ii.gnormx+r.posy*Ii.gnormy+Ii.lprojection,Ii.tp0=ki.y*Ii.gnormx-ki.x*Ii.gnormy,Ii.tp1=Oi.y*Ii.gnormx-Oi.x*Ii.gnormy,ki=Oi,Ci=Ci.next}var Si=yi.gverts.next,Pi=Mi.elt;Mi=Mi.next,Pi.gnormx=r.axisy*Pi.lnormx-r.axisx*Pi.lnormy,Pi.gnormy=Pi.lnormx*r.axisx+Pi.lnormy*r.axisy,Pi.gprojection=r.posx*Pi.gnormx+r.posy*Pi.gnormy+Pi.lprojection,Pi.tp0=ki.y*Pi.gnormx-ki.x*Pi.gnormy,Pi.tp1=Si.y*Pi.gnormx-Si.x*Pi.gnormy}var Ti,Ai=l,Ei=p,Ni=h,Li=u;if(Ai.type==me.id_ShapeType_CIRCLE&&Ei.type==me.id_ShapeType_CIRCLE){var Vi,ji=Ai.circle,Di=Ei.circle,Fi=0,Ri=0;Fi=Di.worldCOMx-ji.worldCOMx,Ri=Di.worldCOMy-ji.worldCOMy;var Bi=Math.sqrt(Fi*Fi+Ri*Ri);if(1e100>(Vi=Bi-(ji.radius+Di.radius))){if(0==Bi)Fi=1,Ri=0;else{var Gi=1/Bi;Fi*=Gi,Ri*=Gi}var Zi=ji.radius;Ni.x=ji.worldCOMx+Fi*Zi,Ni.y=ji.worldCOMy+Ri*Zi;var Ui=-Di.radius;Li.x=Di.worldCOMx+Fi*Ui,Li.y=Di.worldCOMy+Ri*Ui,x.x=Fi,x.y=Ri}Ti=Vi}else{var qi=!1;if(Ai.type==me.id_ShapeType_CIRCLE&&Ei.type==me.id_ShapeType_POLYGON){var Yi=Ai;Ai=Ei,Ei=Yi;var Ki=Ni;Ni=Li,Li=Ki,qi=!0}if(Ai.type==me.id_ShapeType_POLYGON&&Ei.type==me.id_ShapeType_CIRCLE){for(var Wi=Ai.polygon,Ji=Ei.circle,Xi=-1e100,Hi=null,Qi=Wi.edges.head;null!=Qi;){var $i=Qi.elt,nt=$i.gnormx*Ji.worldCOMx+$i.gnormy*Ji.worldCOMy-$i.gprojection-Ji.radius;if(nt>1e100){Xi=nt;break}nt>0?nt>Xi&&(Xi=nt,Hi=$i):0>Xi&&nt>Xi&&(Xi=nt,Hi=$i),Qi=Qi.next}if(1e100>Xi){var et=Hi.gp0,it=Hi.gp1,tt=Ji.worldCOMy*Hi.gnormx-Ji.worldCOMx*Hi.gnormy;if(et.y*Hi.gnormx-et.x*Hi.gnormy<tt)if(tt<it.y*Hi.gnormx-it.x*Hi.gnormy){var lt=-Ji.radius;Li.x=Ji.worldCOMx+Hi.gnormx*lt,Li.y=Ji.worldCOMy+Hi.gnormy*lt;var pt=-Xi;Ni.x=Li.x+Hi.gnormx*pt,Ni.y=Li.y+Hi.gnormy*pt,x.x=Hi.gnormx,x.y=Hi.gnormy}else{var rt=0,at=0;rt=Ji.worldCOMx-it.x,at=Ji.worldCOMy-it.y;var st=Math.sqrt(rt*rt+at*at);if(1e100>(Xi=st-Ji.radius)){if(0==st)rt=1,at=0;else{var ot=1/st;rt*=ot,at*=ot}Ni.x=it.x+0*rt,Ni.y=it.y+0*at;var _t=-Ji.radius;Li.x=Ji.worldCOMx+rt*_t,Li.y=Ji.worldCOMy+at*_t,x.x=rt,x.y=at}}else{var ht=0,ut=0;ht=Ji.worldCOMx-et.x,ut=Ji.worldCOMy-et.y;var xt=Math.sqrt(ht*ht+ut*ut);if(1e100>(Xi=xt-Ji.radius)){if(0==xt)ht=1,ut=0;else{var dt=1/xt;ht*=dt,ut*=dt}Ni.x=et.x+0*ht,Ni.y=et.y+0*ut;var vt=-Ji.radius;Li.x=Ji.worldCOMx+ht*vt,Li.y=Ji.worldCOMy+ut*vt,x.x=ht,x.y=ut}}}qi&&(x.x=-x.x,x.y=-x.y),Ti=Xi}else{for(var zt=Ai.polygon,ct=Ei.polygon,mt=-1e100,yt=null,ft=null,bt=0,gt=zt.edges.head;null!=gt;){for(var wt=gt.elt,Mt=1e100,Ct=ct.gverts.next;null!=Ct;){var kt=Ct,Ot=wt.gnormx*kt.x+wt.gnormy*kt.y;Mt>Ot&&(Mt=Ot),Ct=Ct.next}if((Mt-=wt.gprojection)>1e100){mt=Mt;break}Mt>0?Mt>mt&&(mt=Mt,yt=wt,bt=1):0>mt&&Mt>mt&&(mt=Mt,yt=wt,bt=1),gt=gt.next}if(1e100>mt){for(var It=ct.edges.head;null!=It;){for(var St=It.elt,Pt=1e100,Tt=zt.gverts.next;null!=Tt;){var At=Tt,Et=St.gnormx*At.x+St.gnormy*At.y;Pt>Et&&(Pt=Et),Tt=Tt.next}if((Pt-=St.gprojection)>1e100){mt=Pt;break}Pt>0?Pt>mt&&(mt=Pt,ft=St,bt=2):0>mt&&Pt>mt&&(mt=Pt,ft=St,bt=2),It=It.next}if(1e100>mt){var Nt,Lt;if(1==bt)zt,Nt=ct,Lt=yt;else{ct,Nt=zt,Lt=ft;var Vt=Ni;Ni=Li,Li=Vt,qi=!qi}for(var jt=null,Dt=1e100,Ft=Nt.edges.head;null!=Ft;){var Rt=Ft.elt,Bt=Lt.gnormx*Rt.gnormx+Lt.gnormy*Rt.gnormy;Dt>Bt&&(Dt=Bt,jt=Rt),Ft=Ft.next}if(qi?(x.x=-Lt.gnormx,x.y=-Lt.gnormy):(x.x=Lt.gnormx,x.y=Lt.gnormy),0>mt){var Gt=0,Zt=0;Gt=jt.gp0.x,Zt=jt.gp0.y;var Ut=0,qt=0;Ut=jt.gp1.x,qt=jt.gp1.y;var Yt=0,Kt=0;Yt=Ut-Gt,Kt=qt-Zt;var Wt=Lt.gnormy*Gt-Lt.gnormx*Zt,Jt=Lt.gnormy*Ut-Lt.gnormx*qt,Xt=1/(Jt-Wt),Ht=(-Lt.tp1-Wt)*Xt;if(Ht>y.epsilon){var Qt=Ht;Gt+=Yt*Qt,Zt+=Kt*Qt}var $t=(-Lt.tp0-Jt)*Xt;if(-y.epsilon>$t){var nl=$t;Ut+=Yt*nl,qt+=Kt*nl}var el=Gt*Lt.gnormx+Zt*Lt.gnormy-Lt.gprojection,il=Ut*Lt.gnormx+qt*Lt.gnormy-Lt.gprojection;if(il>el){Li.x=Gt,Li.y=Zt;var tl=-el;Ni.x=Li.x+Lt.gnormx*tl,Ni.y=Li.y+Lt.gnormy*tl,Ti=el}else{Li.x=Ut,Li.y=qt;var ll=-il;Ni.x=Li.x+Lt.gnormx*ll,Ni.y=Li.y+Lt.gnormy*ll,Ti=il}}else{var pl=Lt.gp0,rl=Lt.gp1,al=jt.gp0,sl=jt.gp1,ol=0,_l=0,hl=0,ul=0;ol=rl.x-pl.x,_l=rl.y-pl.y,hl=sl.x-al.x,ul=sl.y-al.y;var xl=1/(ol*ol+_l*_l),dl=1/(hl*hl+ul*ul),vl=-(ol*(pl.x-al.x)+_l*(pl.y-al.y))*xl,zl=-(ol*(pl.x-sl.x)+_l*(pl.y-sl.y))*xl,cl=-(hl*(al.x-pl.x)+ul*(al.y-pl.y))*dl,ml=-(hl*(al.x-rl.x)+ul*(al.y-rl.y))*dl;0>vl?vl=0:vl>1&&(vl=1),0>zl?zl=0:zl>1&&(zl=1),0>cl?cl=0:cl>1&&(cl=1),0>ml?ml=0:ml>1&&(ml=1);var yl=0,fl=0,bl=vl;yl=pl.x+ol*bl,fl=pl.y+_l*bl;var gl=0,wl=0,Ml=zl;gl=pl.x+ol*Ml,wl=pl.y+_l*Ml;var Cl=0,kl=0,Ol=cl;Cl=al.x+hl*Ol,kl=al.y+ul*Ol;var Il=0,Sl=0,Pl=ml;Il=al.x+hl*Pl,Sl=al.y+ul*Pl;var Tl=0,Al=0;Tl=yl-al.x,Al=fl-al.y;var El=Tl*Tl+Al*Al,Nl=0,Ll=0;Nl=gl-sl.x,Ll=wl-sl.y;var Vl=Nl*Nl+Ll*Ll,jl=0,Dl=0;jl=Cl-pl.x,Dl=kl-pl.y;var Fl=jl*jl+Dl*Dl,Rl=0,Bl=0;Rl=Il-rl.x,Bl=Sl-rl.y;var Gl=Rl*Rl+Bl*Bl,Zl=0,Ul=0,ql=null;Vl>El?(Zl=yl,Ul=fl,ql=al):(Zl=gl,Ul=wl,ql=sl,El=Vl);var Yl=0,Kl=0,Wl=null;if(Gl>Fl?(Yl=Cl,Kl=kl,Wl=pl):(Yl=Il,Kl=Sl,Wl=rl,Fl=Gl),Fl>El?(Ni.x=Zl,Ni.y=Ul,Li.x=ql.x,Li.y=ql.y,mt=Math.sqrt(El)):(Li.x=Yl,Li.y=Kl,Ni.x=Wl.x,Ni.y=Wl.y,mt=Math.sqrt(Fl)),0!=mt){x.x=Li.x-Ni.x,x.y=Li.y-Ni.y;var Jl=1/mt;x.x*=Jl,x.y*=Jl,qi&&(x.x=-x.x,x.y=-x.y)}Ti=mt}}else Ti=1e100}else Ti=1e100}}var Xl=Ti+t,Hl=a*x.x+s*x.y;if(y.distanceThresholdCCD>Xl){var Ql=0,$l=0;Ql=h.x-r.posx,$l=h.y-r.posy;var np=Hl-r.sweep_angvel*(x.y*Ql-x.x*$l);if(np>0&&(n.slipped=!0),0>=np||.5*y.distanceThresholdCCD>Xl)break}d=-1;break}if(++v>=40){li>t&&(n.failed=!0);break}}n.toi=d},bi.distanceBody=function(n,e,i,t){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1;var p;null==Mi.zpp_pool?p=new Mi:(p=Mi.zpp_pool,Mi.zpp_pool=p.next,p.next=null),p.weak=!1;var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1;for(var a=1e100,s=n.shapes.head;null!=s;){for(var o=s.elt,_=e.shapes.head;null!=_;){var h,u=_.elt,x=o,d=u,v=l,z=p;if(x.type==me.id_ShapeType_CIRCLE&&d.type==me.id_ShapeType_CIRCLE){var c,m=x.circle,f=d.circle,b=0,g=0;b=f.worldCOMx-m.worldCOMx,g=f.worldCOMy-m.worldCOMy;var w=Math.sqrt(b*b+g*g);if(c=w-(m.radius+f.radius),a>c){if(0==w)b=1,g=0;else{var M=1/w;b*=M,g*=M}var C=m.radius;v.x=m.worldCOMx+b*C,v.y=m.worldCOMy+g*C;var k=-f.radius;z.x=f.worldCOMx+b*k,z.y=f.worldCOMy+g*k,r.x=b,r.y=g}h=c}else{var O=!1;if(x.type==me.id_ShapeType_CIRCLE&&d.type==me.id_ShapeType_POLYGON){var I=x;x=d,d=I;var S=v;v=z,z=S,O=!0}if(x.type==me.id_ShapeType_POLYGON&&d.type==me.id_ShapeType_CIRCLE){for(var P=x.polygon,T=d.circle,A=-1e100,E=null,N=P.edges.head;null!=N;){var L=N.elt,V=L.gnormx*T.worldCOMx+L.gnormy*T.worldCOMy-L.gprojection-T.radius;if(V>a){A=V;break}V>0?V>A&&(A=V,E=L):0>A&&V>A&&(A=V,E=L),N=N.next}if(a>A){var j=E.gp0,D=E.gp1,F=T.worldCOMy*E.gnormx-T.worldCOMx*E.gnormy;if(j.y*E.gnormx-j.x*E.gnormy<F)if(F<D.y*E.gnormx-D.x*E.gnormy){var R=-T.radius;z.x=T.worldCOMx+E.gnormx*R,z.y=T.worldCOMy+E.gnormy*R;var B=-A;v.x=z.x+E.gnormx*B,v.y=z.y+E.gnormy*B,r.x=E.gnormx,r.y=E.gnormy}else{var G=0,Z=0;G=T.worldCOMx-D.x,Z=T.worldCOMy-D.y;var U=Math.sqrt(G*G+Z*Z);if(A=U-T.radius,a>A){if(0==U)G=1,Z=0;else{var q=1/U;G*=q,Z*=q}v.x=D.x+0*G,v.y=D.y+0*Z;var Y=-T.radius;z.x=T.worldCOMx+G*Y,z.y=T.worldCOMy+Z*Y,r.x=G,r.y=Z}}else{var K=0,W=0;K=T.worldCOMx-j.x,W=T.worldCOMy-j.y;var J=Math.sqrt(K*K+W*W);if(A=J-T.radius,a>A){if(0==J)K=1,W=0;else{var X=1/J;K*=X,W*=X}v.x=j.x+0*K,v.y=j.y+0*W;var H=-T.radius;z.x=T.worldCOMx+K*H,z.y=T.worldCOMy+W*H,r.x=K,r.y=W}}}O&&(r.x=-r.x,r.y=-r.y),h=A}else{for(var Q=x.polygon,$=d.polygon,nn=-1e100,en=null,tn=null,ln=0,pn=Q.edges.head;null!=pn;){for(var rn=pn.elt,an=1e100,sn=$.gverts.next;null!=sn;){var on=sn,_n=rn.gnormx*on.x+rn.gnormy*on.y;an>_n&&(an=_n),sn=sn.next}if((an-=rn.gprojection)>a){nn=an;break}an>0?an>nn&&(nn=an,en=rn,ln=1):0>nn&&an>nn&&(nn=an,en=rn,ln=1),pn=pn.next}if(a>nn){for(var hn=$.edges.head;null!=hn;){for(var un=hn.elt,xn=1e100,dn=Q.gverts.next;null!=dn;){var vn=dn,zn=un.gnormx*vn.x+un.gnormy*vn.y;xn>zn&&(xn=zn),dn=dn.next}if((xn-=un.gprojection)>a){nn=xn;break}xn>0?xn>nn&&(nn=xn,tn=un,ln=2):0>nn&&xn>nn&&(nn=xn,tn=un,ln=2),hn=hn.next}if(a>nn){var cn,mn;if(1==ln)Q,cn=$,mn=en;else{$,cn=Q,mn=tn;var yn=v;v=z,z=yn,O=!O}for(var fn=null,bn=1e100,gn=cn.edges.head;null!=gn;){var wn=gn.elt,Mn=mn.gnormx*wn.gnormx+mn.gnormy*wn.gnormy;bn>Mn&&(bn=Mn,fn=wn),gn=gn.next}if(O?(r.x=-mn.gnormx,r.y=-mn.gnormy):(r.x=mn.gnormx,r.y=mn.gnormy),0>nn){var Cn=0,kn=0;Cn=fn.gp0.x,kn=fn.gp0.y;var On=0,In=0;On=fn.gp1.x,In=fn.gp1.y;var Sn=0,Pn=0;Sn=On-Cn,Pn=In-kn;var Tn=mn.gnormy*Cn-mn.gnormx*kn,An=mn.gnormy*On-mn.gnormx*In,En=1/(An-Tn),Nn=(-mn.tp1-Tn)*En;if(Nn>y.epsilon){var Ln=Nn;Cn+=Sn*Ln,kn+=Pn*Ln}var Vn=(-mn.tp0-An)*En;if(-y.epsilon>Vn){var jn=Vn;On+=Sn*jn,In+=Pn*jn}var Dn=Cn*mn.gnormx+kn*mn.gnormy-mn.gprojection,Fn=On*mn.gnormx+In*mn.gnormy-mn.gprojection;if(Fn>Dn){z.x=Cn,z.y=kn;var Rn=-Dn;v.x=z.x+mn.gnormx*Rn,v.y=z.y+mn.gnormy*Rn,h=Dn}else{z.x=On,z.y=In;var Bn=-Fn;v.x=z.x+mn.gnormx*Bn,v.y=z.y+mn.gnormy*Bn,h=Fn}}else{var Gn=mn.gp0,Zn=mn.gp1,Un=fn.gp0,qn=fn.gp1,Yn=0,Kn=0,Wn=0,Jn=0;Yn=Zn.x-Gn.x,Kn=Zn.y-Gn.y,Wn=qn.x-Un.x,Jn=qn.y-Un.y;var Xn=1/(Yn*Yn+Kn*Kn),Hn=1/(Wn*Wn+Jn*Jn),Qn=-(Yn*(Gn.x-Un.x)+Kn*(Gn.y-Un.y))*Xn,$n=-(Yn*(Gn.x-qn.x)+Kn*(Gn.y-qn.y))*Xn,ne=-(Wn*(Un.x-Gn.x)+Jn*(Un.y-Gn.y))*Hn,ee=-(Wn*(Un.x-Zn.x)+Jn*(Un.y-Zn.y))*Hn;0>Qn?Qn=0:Qn>1&&(Qn=1),0>$n?$n=0:$n>1&&($n=1),0>ne?ne=0:ne>1&&(ne=1),0>ee?ee=0:ee>1&&(ee=1);var ie=0,te=0,le=Qn;ie=Gn.x+Yn*le,te=Gn.y+Kn*le;var pe=0,re=0,ae=$n;pe=Gn.x+Yn*ae,re=Gn.y+Kn*ae;var se=0,oe=0,_e=ne;se=Un.x+Wn*_e,oe=Un.y+Jn*_e;var he=0,ue=0,xe=ee;he=Un.x+Wn*xe,ue=Un.y+Jn*xe;var de=0,ve=0;de=ie-Un.x,ve=te-Un.y;var ze=de*de+ve*ve,ce=0,ye=0;ce=pe-qn.x,ye=re-qn.y;var fe=ce*ce+ye*ye,be=0,ge=0;be=se-Gn.x,ge=oe-Gn.y;var we=be*be+ge*ge,Me=0,Ce=0;Me=he-Zn.x,Ce=ue-Zn.y;var ke=Me*Me+Ce*Ce,Oe=0,Ie=0,Se=null;fe>ze?(Oe=ie,Ie=te,Se=Un):(Oe=pe,Ie=re,Se=qn,ze=fe);var Pe=0,Te=0,Ae=null;if(ke>we?(Pe=se,Te=oe,Ae=Gn):(Pe=he,Te=ue,Ae=Zn,we=ke),we>ze?(v.x=Oe,v.y=Ie,z.x=Se.x,z.y=Se.y,nn=Math.sqrt(ze)):(z.x=Pe,z.y=Te,v.x=Ae.x,v.y=Ae.y,nn=Math.sqrt(we)),0!=nn){r.x=z.x-v.x,r.y=z.y-v.y;var Ee=1/nn;r.x*=Ee,r.y*=Ee,O&&(r.x=-r.x,r.y=-r.y)}h=nn}}else h=a}else h=a}}a>h&&(a=h,i.x=l.x,i.y=l.y,t.x=p.x,t.y=p.y),_=_.next}s=s.next}var Ne=l;null!=Ne.outer&&(Ne.outer.zpp_inner=null,Ne.outer=null),Ne._isimmutable=null,Ne._validate=null,Ne._invalidate=null,Ne.next=Mi.zpp_pool,Mi.zpp_pool=Ne;var Le=p;null!=Le.outer&&(Le.outer.zpp_inner=null,Le.outer=null),Le._isimmutable=null,Le._validate=null,Le._invalidate=null,Le.next=Mi.zpp_pool,Mi.zpp_pool=Le;var Ve=r;return null!=Ve.outer&&(Ve.outer.zpp_inner=null,Ve.outer=null),Ve._isimmutable=null,Ve._validate=null,Ve._invalidate=null,Ve.next=Mi.zpp_pool,Mi.zpp_pool=Ve,a},bi.distance=function(n,e,i,t,l,p){if(null==p&&(p=1e100),n.type==me.id_ShapeType_CIRCLE&&e.type==me.id_ShapeType_CIRCLE){var r,a=n.circle,s=e.circle,o=0,_=0;o=s.worldCOMx-a.worldCOMx,_=s.worldCOMy-a.worldCOMy;var h=Math.sqrt(o*o+_*_);if(r=h-(a.radius+s.radius),p>r){if(0==h)o=1,_=0;else{var u=1/h;o*=u,_*=u}var x=a.radius;i.x=a.worldCOMx+o*x,i.y=a.worldCOMy+_*x;var d=-s.radius;t.x=s.worldCOMx+o*d,t.y=s.worldCOMy+_*d,l.x=o,l.y=_}return r}var v=!1;if(n.type==me.id_ShapeType_CIRCLE&&e.type==me.id_ShapeType_POLYGON){var z=n;n=e,e=z;var c=i;i=t,t=c,v=!0}if(n.type==me.id_ShapeType_POLYGON&&e.type==me.id_ShapeType_CIRCLE){for(var m=n.polygon,f=e.circle,b=-1e100,g=null,w=m.edges.head;null!=w;){var M=w.elt,C=M.gnormx*f.worldCOMx+M.gnormy*f.worldCOMy-M.gprojection-f.radius;if(C>p){b=C;break}C>0?C>b&&(b=C,g=M):0>b&&C>b&&(b=C,g=M),w=w.next}if(p>b){var k=g.gp0,O=g.gp1,I=f.worldCOMy*g.gnormx-f.worldCOMx*g.gnormy;if(k.y*g.gnormx-k.x*g.gnormy<I)if(I<O.y*g.gnormx-O.x*g.gnormy){var S=-f.radius;t.x=f.worldCOMx+g.gnormx*S,t.y=f.worldCOMy+g.gnormy*S;var P=-b;i.x=t.x+g.gnormx*P,i.y=t.y+g.gnormy*P,l.x=g.gnormx,l.y=g.gnormy}else{var T=0,A=0;T=f.worldCOMx-O.x,A=f.worldCOMy-O.y;var E=Math.sqrt(T*T+A*A);if(b=E-f.radius,p>b){if(0==E)T=1,A=0;else{var N=1/E;T*=N,A*=N}i.x=O.x+0*T,i.y=O.y+0*A;var L=-f.radius;t.x=f.worldCOMx+T*L,t.y=f.worldCOMy+A*L,l.x=T,l.y=A}}else{var V=0,j=0;V=f.worldCOMx-k.x,j=f.worldCOMy-k.y;var D=Math.sqrt(V*V+j*j);if(b=D-f.radius,p>b){if(0==D)V=1,j=0;else{var F=1/D;V*=F,j*=F}i.x=k.x+0*V,i.y=k.y+0*j;var R=-f.radius;t.x=f.worldCOMx+V*R,t.y=f.worldCOMy+j*R,l.x=V,l.y=j}}}return v&&(l.x=-l.x,l.y=-l.y),b}for(var B=n.polygon,G=e.polygon,Z=-1e100,U=null,q=null,Y=0,K=B.edges.head;null!=K;){for(var W=K.elt,J=1e100,X=G.gverts.next;null!=X;){var H=X,Q=W.gnormx*H.x+W.gnormy*H.y;J>Q&&(J=Q),X=X.next}if((J-=W.gprojection)>p){Z=J;break}J>0?J>Z&&(Z=J,U=W,Y=1):0>Z&&J>Z&&(Z=J,U=W,Y=1),K=K.next}if(p>Z){for(var $=G.edges.head;null!=$;){for(var nn=$.elt,en=1e100,tn=B.gverts.next;null!=tn;){var ln=tn,pn=nn.gnormx*ln.x+nn.gnormy*ln.y;en>pn&&(en=pn),tn=tn.next}if((en-=nn.gprojection)>p){Z=en;break}en>0?en>Z&&(Z=en,q=nn,Y=2):0>Z&&en>Z&&(Z=en,q=nn,Y=2),$=$.next}if(p>Z){var rn,an;if(1==Y)B,rn=G,an=U;else{G,rn=B,an=q;var sn=i;i=t,t=sn,v=!v}for(var on=null,_n=1e100,hn=rn.edges.head;null!=hn;){var un=hn.elt,xn=an.gnormx*un.gnormx+an.gnormy*un.gnormy;_n>xn&&(_n=xn,on=un),hn=hn.next}if(v?(l.x=-an.gnormx,l.y=-an.gnormy):(l.x=an.gnormx,l.y=an.gnormy),0>Z){var dn=0,vn=0;dn=on.gp0.x,vn=on.gp0.y;var zn=0,cn=0;zn=on.gp1.x,cn=on.gp1.y;var mn=0,yn=0;mn=zn-dn,yn=cn-vn;var fn=an.gnormy*dn-an.gnormx*vn,bn=an.gnormy*zn-an.gnormx*cn,gn=1/(bn-fn),wn=(-an.tp1-fn)*gn;if(wn>y.epsilon){var Mn=wn;dn+=mn*Mn,vn+=yn*Mn}var Cn=(-an.tp0-bn)*gn;if(-y.epsilon>Cn){var kn=Cn;zn+=mn*kn,cn+=yn*kn}var On=dn*an.gnormx+vn*an.gnormy-an.gprojection,In=zn*an.gnormx+cn*an.gnormy-an.gprojection;if(In>On){t.x=dn,t.y=vn;var Sn=-On;return i.x=t.x+an.gnormx*Sn,i.y=t.y+an.gnormy*Sn,On}t.x=zn,t.y=cn;var Pn=-In;return i.x=t.x+an.gnormx*Pn,i.y=t.y+an.gnormy*Pn,In}var Tn=an.gp0,An=an.gp1,En=on.gp0,Nn=on.gp1,Ln=0,Vn=0,jn=0,Dn=0;Ln=An.x-Tn.x,Vn=An.y-Tn.y,jn=Nn.x-En.x,Dn=Nn.y-En.y;var Fn=1/(Ln*Ln+Vn*Vn),Rn=1/(jn*jn+Dn*Dn),Bn=-(Ln*(Tn.x-En.x)+Vn*(Tn.y-En.y))*Fn,Gn=-(Ln*(Tn.x-Nn.x)+Vn*(Tn.y-Nn.y))*Fn,Zn=-(jn*(En.x-Tn.x)+Dn*(En.y-Tn.y))*Rn,Un=-(jn*(En.x-An.x)+Dn*(En.y-An.y))*Rn;0>Bn?Bn=0:Bn>1&&(Bn=1),0>Gn?Gn=0:Gn>1&&(Gn=1),0>Zn?Zn=0:Zn>1&&(Zn=1),0>Un?Un=0:Un>1&&(Un=1);var qn=0,Yn=0,Kn=Bn;qn=Tn.x+Ln*Kn,Yn=Tn.y+Vn*Kn;var Wn=0,Jn=0,Xn=Gn;Wn=Tn.x+Ln*Xn,Jn=Tn.y+Vn*Xn;var Hn=0,Qn=0,$n=Zn;Hn=En.x+jn*$n,Qn=En.y+Dn*$n;var ne=0,ee=0,ie=Un;ne=En.x+jn*ie,ee=En.y+Dn*ie;var te=0,le=0;te=qn-En.x,le=Yn-En.y;var pe=te*te+le*le,re=0,ae=0;re=Wn-Nn.x,ae=Jn-Nn.y;var se=re*re+ae*ae,oe=0,_e=0;oe=Hn-Tn.x,_e=Qn-Tn.y;var he=oe*oe+_e*_e,ue=0,xe=0;ue=ne-An.x,xe=ee-An.y;var de=ue*ue+xe*xe,ve=0,ze=0,ce=null;se>pe?(ve=qn,ze=Yn,ce=En):(ve=Wn,ze=Jn,ce=Nn,pe=se);var ye=0,fe=0,be=null;if(de>he?(ye=Hn,fe=Qn,be=Tn):(ye=ne,fe=ee,be=An,he=de),he>pe?(i.x=ve,i.y=ze,t.x=ce.x,t.y=ce.y,Z=Math.sqrt(pe)):(t.x=ye,t.y=fe,i.x=be.x,i.y=be.y,Z=Math.sqrt(he)),0!=Z){l.x=t.x-i.x,l.y=t.y-i.y;var ge=1/Z;l.x*=ge,l.y*=ge,v&&(l.x=-l.x,l.y=-l.y)}return Z}return p}return p};var gi=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};l["zpp_nape.geom.ZPP_PartitionPair"]=gi,gi.__name__=["zpp_nape","geom","ZPP_PartitionPair"],gi.get=function(n,e){var i;return null==gi.zpp_pool?i=new gi:(i=gi.zpp_pool,gi.zpp_pool=i.next,i.next=null),i.a=n,i.b=e,e.id>n.id?(i.id=n.id,i.di=e.id):(i.id=e.id,i.di=n.id),i},gi.edge_swap=function(n,e){var i=n.node;n.node=e.node,e.node=i},gi.edge_lt=function(n,e){return e.id>n.id||n.id==e.id&&e.di>n.di},gi.prototype={next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},free:function(){this.a=this.b=null,this.node=null},alloc:function(){},a:null,b:null,id:null,di:null,node:null,__class__:gi};var wi=function(){};l["zpp_nape.geom.ZPP_Triangular"]=wi,wi.__name__=["zpp_nape","geom","ZPP_Triangular"],wi.lt=function(n,e){return e.y>n.y||n.y==e.y&&e.x>n.x},wi.right_turn=function(n,e,i){var t=0,l=0;t=i.x-e.x,l=i.y-e.y;var p=0;return p=e.x-n.x,(e.y-n.y)*t-p*l},wi.delaunay=function(n,e,i,t){var l,p,r,a=0,s=0,o=0,_=0;return a=i.x-e.x,s=i.y-e.y,o=e.x-n.x,_=e.y-n.y,_*a-o*s<0?(a=t.x-i.x,s=t.y-i.y,o=i.x-e.x,_=i.y-e.y,r=_*a-o*s>=0):r=!0,r?p=!0:(a=n.x-t.x,s=n.y-t.y,o=t.x-i.x,_=t.y-i.y,p=_*a-o*s>=0),p?l=!0:(a=e.x-n.x,s=e.y-n.y,o=n.x-t.x,_=n.y-t.y,l=_*a-o*s>=0),!!l||e.x*(i.y*t.mag-i.mag*t.y)-i.x*(e.y*t.mag-e.mag*t.y)+t.x*(e.y*i.mag-e.mag*i.y)-(n.x*(i.y*t.mag-i.mag*t.y)-i.x*(n.y*t.mag-n.mag*t.y)+t.x*(n.y*i.mag-n.mag*i.y))+(n.x*(e.y*t.mag-e.mag*t.y)-e.x*(n.y*t.mag-n.mag*t.y)+t.x*(n.y*e.mag-n.mag*e.y))-(n.x*(e.y*i.mag-e.mag*i.y)-e.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*e.mag-n.mag*e.y))>0},wi.optimise=function(n){var e=n.vertices,i=n.vertices;if(null!=e)for(var t=e;;){var l=t;if(l.sort(),l.mag=l.x*l.x+l.y*l.y,(t=t.next)==i)break}if(null==wi.edgeSet){null==Il.zpp_pool?wi.edgeSet=new Il:(wi.edgeSet=Il.zpp_pool,Il.zpp_pool=wi.edgeSet.next,wi.edgeSet.next=null);wi.edgeSet.lt=gi.edge_lt,wi.edgeSet.swapped=gi.edge_swap}var p;null==gi.zpp_pool?p=new gi:(p=gi.zpp_pool,gi.zpp_pool=p.next,p.next=null);var r=n.vertices,a=n.vertices;if(null!=r)for(var s=r;;){var o=s,_=o.next;o.diagonals.reverse();for(var h=o.diagonals.head;null!=h;){var u=h.elt;if(u.id<o.id)_=u,h=h.next;else{var x=null==h.next?o.prev:h.next.elt;if(!wi.delaunay(o,_,u,x)){var d;null==gi.zpp_pool?d=new gi:(d=gi.zpp_pool,gi.zpp_pool=d.next,d.next=null),d.a=o,d.b=u,u.id>o.id?(d.id=o.id,d.di=u.id):(d.id=u.id,d.di=o.id);var v=d;p.add(v),v.node=wi.edgeSet.insert(v)}_=u,h=h.next}}if((s=s.next)==a)break}for(;null!=p.next;){for(var z=p.pop_unsafe(),c=z.a,m=z.b,y=c.next,f=null,b=c.diagonals.head;null!=b;){var g=b.elt;if(g==m){b=b.next,f=null==b?c.prev:b.elt;break}y=g,b=b.next}if(c.diagonals.remove(m),m.diagonals.remove(c),m==y.next)y.diagonals.add(f);else for(var w=y.diagonals.head;null!=w;){var M=w.elt;if(M==m){y.diagonals.insert(w,f);break}w=w.next}if(c==f.next)f.diagonals.add(y);else for(var C=f.diagonals.head;null!=C;){var k=C.elt;if(k==c){f.diagonals.insert(C,y);break}C=C.next}wi.edgeSet.remove_node(z.node);var O=z;O.a=O.b=null,O.node=null,O.next=gi.zpp_pool,gi.zpp_pool=O}var I=p;I.a=I.b=null,I.node=null,I.next=gi.zpp_pool,gi.zpp_pool=I},wi.triangulate=function(n){var e=n.vertices,i=n.vertices,t=n.vertices.next,l=n.vertices;if(null!=t)for(var p=t;;){var r=p;if((e.y>r.y||r.y==e.y&&e.x>r.x)&&(e=r),(r.y>i.y||i.y==r.y&&r.x>i.x)&&(i=r),(p=p.next)==l)break}null==wi.queue&&(wi.queue=new at);var a=i.prev,s=i.next;for(wi.queue.add(i);a!=e||s!=e;)a==e||s!=e&&(s.y>a.y||a.y==s.y&&s.x>a.x)?(wi.queue.add(s),s.rightchain=!1,s=s.next):(wi.queue.add(a),a.rightchain=!0,a=a.prev);wi.queue.add(e),null==wi.stack&&(wi.stack=new at),wi.stack.add(wi.queue.pop_unsafe());var o=wi.queue.pop_unsafe();for(wi.stack.add(o);;){var _=wi.queue.pop_unsafe();if(null==wi.queue.head)break;if(_.rightchain!=wi.stack.head.elt.rightchain){for(;;){var h=wi.stack.pop_unsafe();if(null==wi.stack.head)break;n.add_diagonal(h,_)}wi.stack.add(o)}else{for(var u=wi.stack.pop_unsafe();null!=wi.stack.head;){var x=wi.stack.head.elt,d=0,v=0;d=_.x-u.x,v=_.y-u.y;var z=0,c=0;z=u.x-x.x,c=u.y-x.y;var m=c*d-z*v;if(_.rightchain&&m>=0||!_.rightchain&&0>=m)break;n.add_diagonal(x,_),u=x,wi.stack.pop()}wi.stack.add(u)}wi.stack.add(_),o=_}if(null!=wi.stack.head)for(wi.stack.pop();null!=wi.stack.head;){var y=wi.stack.pop_unsafe();if(null==wi.stack.head)break;n.add_diagonal(i,y)}return n};var Mi=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};l["zpp_nape.geom.ZPP_Vec2"]=Mi,Mi.__name__=["zpp_nape","geom","ZPP_Vec2"],Mi.get=function(n,e,i){null==i&&(i=!1);var t;return null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=i,t.x=n,t.y=e,t},Mi.prototype={_invalidate:null,_validate:null,validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=this._invalidate&&this._invalidate(this)},_immutable:null,_isimmutable:null,immutable:function(){null!=this._isimmutable&&this._isimmutable()},outer:null,wrapper:function(){if(null==this.outer){this.outer=new On;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},weak:null,free:function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},alloc:function(){this.weak=!1},next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},x:null,y:null,copy:function(){var n,e=this.x,i=this.y;return null==Mi.zpp_pool?n=new Mi:(n=Mi.zpp_pool,Mi.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=e,n.y=i,n},toString:function(){return"{ x: "+this.x+" y: "+this.y+" }"},__class__:Mi};var Ci=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};l["zpp_nape.geom.ZPP_Vec3"]=Ci,Ci.__name__=["zpp_nape","geom","ZPP_Vec3"],Ci.prototype={outer:null,x:null,y:null,z:null,immutable:null,_validate:null,validate:function(){null!=this._validate&&this._validate()},__class__:Ci};var ki=function(){};l["zpp_nape.geom.ZPP_VecMath"]=ki,ki.__name__=["zpp_nape","geom","ZPP_VecMath"],ki.vec_dsq=function(n,e,i,t){var l=0,p=0;return l=n-i,p=e-t,l*l+p*p},ki.vec_distance=function(n,e,i,t){var l=0,p=0;return l=n-i,p=e-t,Math.sqrt(l*l+p*p)};var Oi=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=ae.Interactor(),this.cbsets=new $i,this.cbTypes=new ge};l["zpp_nape.phys.ZPP_Interactor"]=Oi,Oi.__name__=["zpp_nape","phys","ZPP_Interactor"],Oi.get=function(n,e){for(var i=e.id>n.id?n.id:e.id,t=e.id>n.id?e.id:n.id,l=e.cbsets.length>n.cbsets.length?n.cbsets:e.cbsets,p=null,r=l.head;null!=r;){var a=r.elt;if(a.id==i&&a.di==t){p=a;break}r=r.next}return p},Oi.int_callback=function(n,e,i){var t,l=n.int1,p=n.int2,r=e.options1,a=l.cbTypes;if(r.nonemptyintersection(a,r.includes)&&!r.nonemptyintersection(a,r.excludes)){var s=e.options2,o=p.cbTypes;t=!!s.nonemptyintersection(o,s.includes)&&!s.nonemptyintersection(o,s.excludes)}else t=!1;t?(i.int1=l,i.int2=p):(i.int1=p,i.int2=l)},Oi.prototype={outer_i:null,id:null,userData:null,ishape:null,ibody:null,icompound:null,isShape:function(){return null!=this.ishape},isBody:function(){return null!=this.ibody},isCompound:function(){return null!=this.icompound},__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var n=this.cbTypes.head;null!=n;){n.elt.interactors.add(this),n=n.next}this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);for(var n=this.cbTypes.head;null!=n;){n.elt.interactors.remove(this),n=n.next}this.dealloc_cbSet()},wake:function(){if(null!=this.ishape){var n=this.ishape.body;null!=n&&null!=n.space&&n.space.non_inlined_wake(n)}else null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},cbsets:null,getSpace:function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space},group:null,cbTypes:null,cbSet:null,wrap_cbTypes:null,setupcbTypes:function(){this.wrap_cbTypes=xl.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=i(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=i(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0,this.wrap_cbTypes.zpp_inner._modifiable=i(this,this.immutable_cbTypes)},immutable_cbTypes:function(){this.immutable_midstep("Interactor::cbTypes")},wrap_cbTypes_subber:function(n){var e=n.zpp_inner;if(this.cbTypes.has(e)){var i=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=i&&(this.dealloc_cbSet(),e.interactors.remove(this)),this.cbTypes.remove(e),null!=i&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(n){return this.insert_cbtype(n.zpp_inner),!1},insert_cbtype:function(n){if(!this.cbTypes.has(n)){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=e&&(this.dealloc_cbSet(),n.interactors.add(this));for(var i=null,t=this.cbTypes.head;null!=t;){if(t.elt.id>n.id)break;i=t,t=t.next}var l,p=this.cbTypes;null==kt.zpp_pool?l=new kt:(l=kt.zpp_pool,kt.zpp_pool=l.next,l.next=null),l.elt=n;var r=l;null==i?(r.next=p.head,p.head=r):(r.next=i.next,i.next=r),p.pushmod=p.modified=!0,p.length++,null!=e&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=n.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),n.freshInteractorType(this))},dealloc_cbSet:function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),n.nullInteractorType(this),0==--this.cbSet.count){n.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;){e.cbTypes.pop_unsafe().cbsets.remove(e)}e.next=oe.zpp_pool,oe.zpp_pool=e}this.cbSet=null}},setGroup:function(n){if(this.group!=n){var e=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space);e&&null!=this.group&&this.group.interactors.remove(this),this.group=n,e&&null!=n&&n.interactors.add(this),e&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():this.icompound.wake())}},immutable_midstep:function(n){if(null!=this.ibody);else null!=this.ishape?this.ishape.__immutable_midstep(n):this.icompound.__imutable_midstep(n)},lookup_group:function(){for(var n=this;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:null!=n.icompound?n.icompound.compound:n.ibody.compound;return null==n?null:n.group},copyto:function(n){n.zpp_inner_i.group=this.group;var e=this.outer_i;null==e.zpp_inner_i.wrap_cbTypes&&e.zpp_inner_i.setupcbTypes();var i=e.zpp_inner_i.wrap_cbTypes;i.zpp_inner.valmod();for(var t=k.get(i);;){t.zpp_inner.zpp_inner.valmod();var l=t.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var p=l.zpp_inner.user_length;t.zpp_critical=!0;var r;if(p>t.zpp_i?r=!0:(t.zpp_next=k.zpp_pool,k.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();var s=n.zpp_inner_i.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(a):s.unshift(a)}null!=this.userData&&(n.zpp_inner_i.userData=o.copy(this.userData))},__class__:Oi};var Ii=function(){this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,Oi.call(this),this.ibody=this,this.world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=Infinity,this.pre_posy=Infinity,this.pre_rot=Infinity,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0;var n;null==qe.zpp_pool?n=new qe:(n=qe.zpp_pool,qe.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0;this.aabb._validate=i(this,this.aabb_validate),this.massMode=me.id_MassMode_DEFAULT,this.gravMassMode=me.id_GravMassMode_DEFAULT,this.gravMassScale=1,this.inertiaMode=me.id_InertiaMode_DEFAULT,this.arbiters=new tt,this.constraints=new de,this.shapes=new nt,this.wrap_shapes=yl.get(this.shapes),this.wrap_shapes.zpp_inner.adder=i(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=i(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=i(this,this.shapes_invalidate),this.wrap_shapes.zpp_inner._modifiable=i(this,this.shapes_modifiable),this.kinematicDelaySleep=!1};l["zpp_nape.phys.ZPP_Body"]=Ii,Ii.__name__=["zpp_nape","phys","ZPP_Body"],Ii.bodysetlt=function(n,e){return e.id>n.id},Ii.__static=function(){null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1);var n=new En(me.BodyType_STATIC),e=n.zpp_inner;return e.world=!0,e.wrap_shapes.zpp_inner.immutable=!0,e.smass=e.imass=e.cmass=e.mass=e.gravMass=0,e.sinertia=e.iinertia=e.cinertia=e.inertia=0,e.cbTypes.clear(),n},Ii.__super__=Oi,Ii.prototype=e(Oi.prototype,{outer:null,world:null,type:null,isStatic:function(){return this.type==me.id_BodyType_STATIC},isDynamic:function(){return this.type==me.id_BodyType_DYNAMIC},isKinematic:function(){return this.type==me.id_BodyType_KINEMATIC},invalidate_type:function(){this.invalidate_mass(),this.invalidate_inertia()},compound:null,shapes:null,wrap_shapes:null,invalidate_shapes:function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},space:null,arbiters:null,wrap_arbiters:null,constraints:null,wrap_constraints:null,component:null,graph_depth:null,init_bodysetlist:function(){null==Ii.bodyset&&(Ii.bodyset=new Cl,Ii.bodyset.lt=Ii.bodysetlt,Ii.bodystack=new et)},connectedBodies_cont:function(n){n!=n.zpp_inner.space.__static&&Ii.bodyset.try_insert_bool(n.zpp_inner)&&(Ii.bodystack.add(n.zpp_inner),n.zpp_inner.graph_depth=Ii.cur_graph_depth+1)},connectedBodies:function(n,e){var t=this;null==Ii.bodyset&&(Ii.bodyset=new Cl,Ii.bodyset.lt=Ii.bodysetlt,Ii.bodystack=new et);var l=null==e?new Ln:e;for(Ii.bodystack.add(this),Ii.bodyset.insert(this),this.graph_depth=0;null!=Ii.bodystack.head;){var p=Ii.bodystack.pop_unsafe();if(p.graph_depth!=n){Ii.cur_graph_depth=p.graph_depth;for(var r=p.constraints.head;null!=r;){r.elt.outer.visitBodies(i(this,this.connectedBodies_cont)),r=r.next}}}var a=Ii.bodyset;if(null!=a.parent){for(var s=a.parent;null!=s;)if(null!=s.prev)s=s.prev;else if(null!=s.next)s=s.next;else{var o=s.data;if(o!=t){var _=o.outer;l.zpp_inner.reverse_flag?l.push(_):l.unshift(_)}var h=s.parent;null!=h&&(s==h.prev?h.prev=null:h.next=null,s.parent=null);var u=s;u.data=null,u.lt=null,u.swapped=null,u.next=Cl.zpp_pool,Cl.zpp_pool=u,s=h}a.parent=null}return l},interactingBodies:function(n,e,i){var t=this;null==Ii.bodyset&&(Ii.bodyset=new Cl,Ii.bodyset.lt=Ii.bodysetlt,Ii.bodystack=new et);var l=null==i?new Ln:i;for(Ii.bodyset.insert(this),Ii.bodystack.add(this),this.graph_depth=0;null!=Ii.bodystack.head;){var p=Ii.bodystack.pop_unsafe();if(p.graph_depth!=e)for(var r=p.arbiters.head;null!=r;){var a=r.elt;if(0!=(a.type&n)){var s=a.b1==p?a.b2:a.b1;Ii.bodyset.try_insert_bool(s)&&(Ii.bodystack.add(s),s.graph_depth=p.graph_depth+1)}r=r.next}}var o=Ii.bodyset;if(null!=o.parent){for(var _=o.parent;null!=_;)if(null!=_.prev)_=_.prev;else if(null!=_.next)_=_.next;else{var h=_.data;if(h!=t){var u=h.outer;l.zpp_inner.reverse_flag?l.push(u):l.unshift(u)}var x=_.parent;null!=x&&(_==x.prev?x.prev=null:x.next=null,_.parent=null);var d=_;d.data=null,d.lt=null,d.swapped=null,d.next=Cl.zpp_pool,Cl.zpp_pool=d,_=x}o.parent=null}return l},atRest:function(n){if(this.type!=me.id_BodyType_DYNAMIC)return this.component.sleeping;var e=y.linearSleepThreshold;e*=e;var i;if(this.velx*this.velx+this.vely*this.vely>e)i=!1;else{var t=0,l=0;if(t=this.posx-this.pre_posx,l=this.posy-this.pre_posy,t*t+l*l>.25*e*n*n)i=!1;else{var p=0,r=0;p=this.aabb.maxx-this.aabb.minx,r=this.aabb.maxy-this.aabb.miny;var a=p*p+r*r,s=y.angularSleepThreshold;if(s*=s,4*this.angvel*this.angvel*a>s)i=!1;else{var o=this.rot-this.pre_rot;i=o*o*a<=s*n*n}}}return i||(this.component.waket=this.space.stamp),this.space.stamp>this.component.waket+y.sleepDelay},refreshArbiters:function(){for(var n=this.arbiters.head;null!=n;){n.elt.invalidated=!0,n=n.next}},sweepTime:null,sweep_angvel:null,sweepFrozen:null,sweepRadius:null,bullet:null,bulletEnabled:null,disableCCD:null,sweepIntegrate:function(n){var e=n-this.sweepTime;if(0!=e){this.sweepTime=n;var i=e;if(this.posx+=this.velx*i,this.posy+=this.vely*i,0!=this.angvel){var t=this.sweep_angvel*e;if(this.rot+=t,t*t>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var l=t*t,p=1-.5*l,r=1-l*l/8,a=(p*this.axisx+t*this.axisy)*r;this.axisy=(p*this.axisy-t*this.axisx)*r,this.axisx=a}}}},sweepValidate:function(n){if(n.type==me.id_ShapeType_CIRCLE)n.worldCOMx=this.posx+(this.axisy*n.localCOMx-this.axisx*n.localCOMy),n.worldCOMy=this.posy+(n.localCOMx*this.axisx+n.localCOMy*this.axisy);else{for(var e=n.polygon,i=e.lverts.next,t=e.gverts.next;null!=t;){var l=t,p=i;i=i.next,l.x=this.posx+(this.axisy*p.x-this.axisx*p.y),l.y=this.posy+(p.x*this.axisx+p.y*this.axisy),t=t.next}var r=e.edges.head,a=e.gverts.next,s=a;for(a=a.next;null!=a;){var o=a,_=r.elt;r=r.next,_.gnormx=this.axisy*_.lnormx-this.axisx*_.lnormy,_.gnormy=_.lnormx*this.axisx+_.lnormy*this.axisy,_.gprojection=this.posx*_.gnormx+this.posy*_.gnormy+_.lprojection,_.tp0=s.y*_.gnormx-s.x*_.gnormy,_.tp1=o.y*_.gnormx-o.x*_.gnormy,s=o,a=a.next}var h=e.gverts.next,u=r.elt;r=r.next,u.gnormx=this.axisy*u.lnormx-this.axisx*u.lnormy,u.gnormy=u.lnormx*this.axisx+u.lnormy*this.axisy,u.gprojection=this.posx*u.gnormx+this.posy*u.gnormy+u.lprojection,u.tp0=s.y*u.gnormx-s.x*u.gnormy,u.tp1=h.y*u.gnormx-h.x*u.gnormy}},pre_posx:null,pre_posy:null,posx:null,posy:null,wrap_pos:null,velx:null,vely:null,wrap_vel:null,forcex:null,forcey:null,wrap_force:null,kinvelx:null,kinvely:null,wrap_kinvel:null,svelx:null,svely:null,wrap_svel:null,invalidate_pos:function(){for(var n=this.shapes.head;null!=n;){var e=n.elt;e.type==me.id_ShapeType_POLYGON&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},pos_invalidate:function(n){if(this.immutable_midstep("Body::position"),this.posx!=n.x||this.posy!=n.y){this.posx=n.x,this.posy=n.y;for(var e=this.shapes.head;null!=e;){var i=e.elt;i.type==me.id_ShapeType_POLYGON&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.wake()}},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(n){this.velx=n.x,this.vely=n.y,this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},kinvel_invalidate:function(n){this.kinvelx=n.x,this.kinvely=n.y,this.wake()},kinvel_validate:function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},svel_invalidate:function(n){this.svelx=n.x,this.svely=n.y,this.wake()},svel_validate:function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},force_invalidate:function(n){this.forcex=n.x,this.forcey=n.y,this.wake()},force_validate:function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},setupPosition:function(){var n,e=this.posx,t=this.posy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_pos=n,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=i(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=i(this,this.pos_validate))},setupVelocity:function(){var n,e=this.velx,t=this.vely;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_vel=n,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=i(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=i(this,this.vel_validate))},setupkinvel:function(){var n,e=this.kinvelx,t=this.kinvely;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_kinvel=n,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=i(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=i(this,this.kinvel_validate))},setupsvel:function(){var n,e=this.svelx,t=this.svely;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_svel=n,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=i(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=i(this,this.svel_validate))},setupForce:function(){var n,e=this.forcex,t=this.forcey;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_force=n,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=i(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=i(this,this.force_validate))},cvel_validate:function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},wrapcvel:null,setup_cvel:function(){this.wrapcvel=Pn.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=i(this,this.cvel_validate)},angvel:null,torque:null,kinangvel:null,pre_rot:null,rot:null,invalidate_rot:function(){this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.type==me.id_ShapeType_POLYGON&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},axisx:null,axisy:null,zip_axis:null,validate_axis:function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},quick_validate_axis:function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},delta_rot:function(n){if(this.rot+=n,n*n>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var e=n*n,i=1-.5*e,t=1-e*e/8,l=(i*this.axisx+n*this.axisy)*t;this.axisy=(i*this.axisy-n*this.axisx)*t,this.axisx=l}},kinematicDelaySleep:null,mass:null,zip_mass:null,massMode:null,imass:null,smass:null,cmass:null,nomove:null,invalidate_mass:function(){this.zip_mass=!0,this.invalidate_gravMass()},validate_mass:function(){if(this.zip_mass){if(this.zip_mass=!1,this.massMode==me.id_MassMode_DEFAULT){this.cmass=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cmass+=e.area*e.material.density,n=n.next}}this.type!=me.id_BodyType_DYNAMIC||this.nomove?(this.mass=Infinity,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},gravMass:null,zip_gravMass:null,gravMassMode:null,gravMassScale:null,zip_gravMassScale:null,invalidate_gravMass:function(){this.gravMassMode!=me.id_GravMassMode_FIXED&&(this.zip_gravMass=!0),this.gravMassMode!=me.id_GravMassMode_SCALED&&(this.zip_gravMassScale=!0),this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),this.gravMassMode==me.id_GravMassMode_DEFAULT?(this.validate_mass(),this.gravMass=this.cmass):this.gravMassMode==me.id_GravMassMode_SCALED&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_gravMassScale:function(){this.gravMassMode!=me.id_GravMassMode_SCALED?this.zip_gravMassScale=!0:this.invalidate_gravMass()},validate_gravMassScale:function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,this.gravMassMode==me.id_GravMassMode_DEFAULT?this.gravMassScale=1:this.gravMassMode==me.id_GravMassMode_FIXED&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},inertiaMode:null,inertia:null,zip_inertia:null,cinertia:null,iinertia:null,sinertia:null,norotate:null,invalidate_inertia:function(){this.zip_inertia=!0,this.wake()},validate_inertia:function(){if(this.zip_inertia){if(this.zip_inertia=!1,this.inertiaMode==me.id_InertiaMode_DEFAULT){this.cinertia=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cinertia+=e.inertia*e.area*e.material.density,n=n.next}}this.type!=me.id_BodyType_DYNAMIC||this.norotate?(this.inertia=Infinity,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},invalidate_wake:function(){this.wake()},aabb:null,zip_aabb:null,validate_aabb:function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=Infinity,this.aabb.miny=Infinity,this.aabb.maxx=-Infinity,this.aabb.maxy=-Infinity;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==me.id_ShapeType_CIRCLE){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,i.type==me.id_ShapeType_POLYGON){var t=i.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,p=t.lverts.next,r=p;p=p.next;var a=p;for(p=p.next;null!=p;){var s=p;l+=a.x*(s.y-r.y);var o=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*o,t.localCOMy+=(a.y+s.y)*o,r=a,a=s,p=p.next}p=t.lverts.next;var _=p;l+=a.x*(_.y-r.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h,r=a,a=_,p=p.next;var u=p;l+=a.x*(u.y-r.y);var x=u.y*a.x-u.x*a.y;t.localCOMx+=(a.x+u.x)*x,t.localCOMy+=(a.y+u.y)*x,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var v=i.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var z=i.radius,c=i.radius;i.aabb.minx=i.worldCOMx-z,i.aabb.miny=i.worldCOMy-c,i.aabb.maxx=i.worldCOMx+z,i.aabb.maxy=i.worldCOMy+c}else{var m=e.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var y=m.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=m.lverts.next,b=m.gverts.next;null!=b;){var g=b,w=f;f=f.next,g.x=m.body.posx+(m.body.axisy*w.x-m.body.axisx*w.y),g.y=m.body.posy+(w.x*m.body.axisx+w.y*m.body.axisy),b=b.next}}var M=m.gverts.next;m.aabb.minx=M.x,m.aabb.miny=M.y,m.aabb.maxx=M.x,m.aabb.maxy=M.y;for(var C=m.gverts.next.next;null!=C;){var k=C;m.aabb.minx>k.x&&(m.aabb.minx=k.x),k.x>m.aabb.maxx&&(m.aabb.maxx=k.x),m.aabb.miny>k.y&&(m.aabb.miny=k.y),k.y>m.aabb.maxy&&(m.aabb.maxy=k.y),C=C.next}}var O=this.aabb,I=e.aabb;O.minx>I.minx&&(O.minx=I.minx),I.maxx>O.maxx&&(O.maxx=I.maxx),O.miny>I.miny&&(O.miny=I.miny),I.maxy>O.maxy&&(O.maxy=I.maxy),n=n.next}}},invalidate_aabb:function(){this.zip_aabb=!0},localCOMx:null,localCOMy:null,zip_localCOM:null,worldCOMx:null,worldCOMy:null,zip_worldCOM:null,wrap_localCOM:null,wrap_worldCOM:null,invalidate_localCOM:function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},invalidate_worldCOM:function(){this.zip_worldCOM=!0},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var n=0,e=0,i=0,t=this.shapes.head;null!=t;){var l=t.elt;if(l.zip_localCOM){if(l.zip_localCOM=!1,l.type==me.id_ShapeType_POLYGON){var p=l.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next){p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;p.localCOMx+=1*p.lverts.next.next.x,p.localCOMy+=1*p.lverts.next.next.y;p.localCOMx*=.5,p.localCOMy*=.5}else{p.localCOMx=0,p.localCOMy=0;var r=0,a=p.lverts.next,s=a;a=a.next;var o=a;for(a=a.next;null!=a;){var _=a;r+=o.x*(_.y-s.y);var h=_.y*o.x-_.x*o.y;p.localCOMx+=(o.x+_.x)*h,p.localCOMy+=(o.y+_.y)*h,s=o,o=_,a=a.next}a=p.lverts.next;var u=a;r+=o.x*(u.y-s.y);var x=u.y*o.x-u.x*o.y;p.localCOMx+=(o.x+u.x)*x,p.localCOMy+=(o.y+u.y)*x,s=o,o=u,a=a.next;var d=a;r+=o.x*(d.y-s.y);var v=d.y*o.x-d.x*o.y;p.localCOMx+=(o.x+d.x)*v,p.localCOMy+=(o.y+d.y)*v,r=1/(3*r);var z=r;p.localCOMx*=z,p.localCOMy*=z}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}l.validate_area_inertia();var c=l.area*l.material.density;n+=l.localCOMx*c,e+=l.localCOMy*c,i+=l.area*l.material.density,t=t.next}if(0!=i){var m=1/i;this.localCOMx=n*m,this.localCOMy=e*m}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&this.massMode==me.id_MassMode_DEFAULT&&(this.zip_mass=!1,this.cmass=i,this.type==me.id_BodyType_DYNAMIC?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Infinity,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},getlocalCOM:function(){this.validate_localCOM()},getworldCOM:function(){this.validate_worldCOM()},__immutable_midstep:function(n){},clear:function(){for(;null!=this.shapes.head;){var n=this.shapes.pop_unsafe();n.removedFromBody(),n.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var e=this.shapes.head;null!=e;){var i=e.elt;i.type==me.id_ShapeType_POLYGON&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var t=this.shapes.head;null!=t;){var l=t.elt;l.type==me.id_ShapeType_POLYGON&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),t=t.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=me.id_MassMode_DEFAULT,this.gravMassMode=me.id_GravMassMode_DEFAULT,this.gravMassScale=1,this.inertiaMode=me.id_InertiaMode_DEFAULT,this.norotate=!1,this.nomove=!1},aabb_validate:function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=Infinity,this.aabb.miny=Infinity,this.aabb.maxx=-Infinity,this.aabb.maxy=-Infinity;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==me.id_ShapeType_CIRCLE){var i=e.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,i.type==me.id_ShapeType_POLYGON){var t=i.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,p=t.lverts.next,r=p;p=p.next;var a=p;for(p=p.next;null!=p;){var s=p;l+=a.x*(s.y-r.y);var o=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*o,t.localCOMy+=(a.y+s.y)*o,r=a,a=s,p=p.next}p=t.lverts.next;var _=p;l+=a.x*(_.y-r.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h,r=a,a=_,p=p.next;var u=p;l+=a.x*(u.y-r.y);var x=u.y*a.x-u.x*a.y;t.localCOMx+=(a.x+u.x)*x,t.localCOMy+=(a.y+u.y)*x,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var v=i.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var z=i.radius,c=i.radius;i.aabb.minx=i.worldCOMx-z,i.aabb.miny=i.worldCOMy-c,i.aabb.maxx=i.worldCOMx+z,i.aabb.maxy=i.worldCOMy+c}else{var m=e.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var y=m.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=m.lverts.next,b=m.gverts.next;null!=b;){var g=b,w=f;f=f.next,g.x=m.body.posx+(m.body.axisy*w.x-m.body.axisx*w.y),g.y=m.body.posy+(w.x*m.body.axisx+w.y*m.body.axisy),b=b.next}}var M=m.gverts.next;m.aabb.minx=M.x,m.aabb.miny=M.y,m.aabb.maxx=M.x,m.aabb.maxy=M.y;for(var C=m.gverts.next.next;null!=C;){var k=C;m.aabb.minx>k.x&&(m.aabb.minx=k.x),k.x>m.aabb.maxx&&(m.aabb.maxx=k.x),m.aabb.miny>k.y&&(m.aabb.miny=k.y),k.y>m.aabb.maxy&&(m.aabb.maxy=k.y),C=C.next}}var O=this.aabb,I=e.aabb;O.minx>I.minx&&(O.minx=I.minx),I.maxx>O.maxx&&(O.maxx=I.maxx),O.miny>I.miny&&(O.miny=I.miny),I.maxy>O.maxy&&(O.maxy=I.maxy),n=n.next}}},shapes_adder:function(n){if(n.zpp_inner.body!=this){if(null!=n.zpp_inner.body&&n.zpp_inner.body.wrap_shapes.remove(n),n.zpp_inner.body=this,n.zpp_inner.addedToBody(),null!=this.space){var e=this.space,i=n.zpp_inner,t=i.body;t.world||(t.component.waket=e.stamp+(e.midstep?0:1),t.type==me.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&e.really_wake(t,!1)),e.bphase.insert(i),i.addedToSpace()}return n.zpp_inner.type==me.id_ShapeType_POLYGON&&(n.zpp_inner.polygon.invalidate_gaxi(),n.zpp_inner.polygon.invalidate_gverts()),!0}return!1},shapes_subber:function(n){null!=this.space&&this.space.removed_shape(n.zpp_inner),n.zpp_inner.body=null,n.zpp_inner.removedFromBody()},shapes_invalidate:function(n){this.invalidate_shapes()},shapes_modifiable:function(){this.immutable_midstep("Body::shapes")},addedToSpace:function(){null==Gi.zpp_pool?this.component=new Gi:(this.component=Gi.zpp_pool,Gi.zpp_pool=this.component.next,this.component.next=null);this.component.isBody=!0,this.component.body=this,this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=this.arbiters.head;){var n=this.arbiters.pop_unsafe(),e=this.space;if(n.cleared=!0,n.b2==this)for(var i=n.b1.arbiters,t=null,l=i.head;null!=l;){if(l.elt==n){var p,r;null==t?(p=i.head,r=p.next,null==(i.head=r)&&(i.pushmod=!0)):(p=t.next,r=p.next,t.next=r,null==r&&(i.pushmod=!0));var a=p;a.elt=null,a.next=Vt.zpp_pool,Vt.zpp_pool=a,i.modified=!0,i.length--,i.pushmod=!0,!0;break}t=l,l=l.next}if(n.b1==this)for(var s=n.b2.arbiters,o=null,_=s.head;null!=_;){if(_.elt==n){var h,u;null==o?(h=s.head,u=h.next,null==(s.head=u)&&(s.pushmod=!0)):(h=o.next,u=h.next,o.next=u,null==u&&(s.pushmod=!0));var x=h;x.elt=null,x.next=Vt.zpp_pool,Vt.zpp_pool=x,s.modified=!0,s.length--,s.pushmod=!0,!0;break}o=_,_=_.next}null!=n.pair&&(n.pair.arb=null,n.pair=null),n.active=!1,e.f_arbiters.modified=!0}var d=this.component;d.body=null,d.constraint=null,d.next=Gi.zpp_pool,Gi.zpp_pool=d,this.component=null,this.__iremovedFromSpace()},copy:function(){var n=(new En).zpp_inner;n.type=this.type,n.bulletEnabled=this.bulletEnabled,n.disableCCD=this.disableCCD;for(var e=this.shapes.head;null!=e;){var i=e.elt,t=n.outer.zpp_inner.wrap_shapes,l=i.outer.copy();t.zpp_inner.reverse_flag?t.push(l):t.unshift(l),e=e.next}if(n.posx=this.posx,n.posy=this.posy,n.velx=this.velx,n.vely=this.vely,n.forcex=this.forcex,n.forcey=this.forcey,n.rot=this.rot,n.angvel=this.angvel,n.torque=this.torque,n.kinvelx=this.kinvelx,n.kinvely=this.kinvely,n.kinangvel=this.kinangvel,n.svelx=this.svelx,n.svely=this.svely,this.zip_axis){n.zip_axis=!0;for(var p=n.shapes.head;null!=p;){var r=p.elt;r.type==me.id_ShapeType_POLYGON&&(r.polygon.invalidate_gverts(),r.polygon.invalidate_gaxi()),r.invalidate_worldCOM(),p=p.next}n.zip_worldCOM=!0}else n.axisx=this.axisx,n.axisy=this.axisy;return n.rot=this.rot,n.massMode=this.massMode,n.gravMassMode=this.gravMassMode,n.inertiaMode=this.inertiaMode,n.norotate=this.norotate,n.nomove=this.nomove,n.cmass=this.cmass,n.cinertia=this.cinertia,this.zip_mass?n.invalidate_mass():n.mass=this.mass,this.zip_gravMass?n.invalidate_gravMass():n.gravMass=this.gravMass,this.zip_gravMassScale?n.invalidate_gravMassScale():n.gravMassScale=this.gravMassScale,this.zip_inertia?n.invalidate_inertia():n.inertia=this.inertia,this.zip_aabb?n.zip_aabb=!0:(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(n.zip_localCOM=!0,n.zip_worldCOM=!0):(n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy),this.zip_worldCOM?n.zip_worldCOM=!0:(n.worldCOMx=this.worldCOMx,n.worldCOMy=this.worldCOMy),this.copyto(n.outer),n.outer},__class__:Ii});var Si=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,Oi.call(this),this.icompound=this,this.depth=1;this.bodies=new et,this.wrap_bodies=ol.get(this.bodies),this.wrap_bodies.zpp_inner.adder=i(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=i(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=i(this,this.bodies_modifiable),this.constraints=new de,this.wrap_constraints=sl.get(this.constraints),this.wrap_constraints.zpp_inner.adder=i(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=i(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=i(this,this.constraints_modifiable),this.compounds=new it,this.wrap_compounds=hl.get(this.compounds),this.wrap_compounds.zpp_inner.adder=i(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=i(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=i(this,this.compounds_modifiable)};l["zpp_nape.phys.ZPP_Compound"]=Si,Si.__name__=["zpp_nape","phys","ZPP_Compound"],Si.__super__=Oi,Si.prototype=e(Oi.prototype,{outer:null,bodies:null,constraints:null,compounds:null,wrap_bodies:null,wrap_constraints:null,wrap_compounds:null,depth:null,compound:null,space:null,__imutable_midstep:function(n){},addedToSpace:function(){this.__iaddedToSpace()},removedFromSpace:function(){this.__iremovedFromSpace()},breakApart:function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var n=this.bodies.pop_unsafe();null!=(n.compound=this.compound)?this.compound.bodies.add(n):null!=this.space&&this.space.bodies.add(n),null!=this.space&&this.space.freshInteractorType(n)}for(;null!=this.constraints.head;){var e=this.constraints.pop_unsafe();null!=(e.compound=this.compound)?this.compound.constraints.add(e):null!=this.space&&this.space.constraints.add(e)}for(;null!=this.compounds.head;){var i=this.compounds.pop_unsafe();null!=(i.compound=this.compound)?this.compound.compounds.add(i):null!=this.space&&this.space.compounds.add(i),null!=this.space&&this.space.freshInteractorType(i)}this.compound=null,this.space=null},bodies_adder:function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_bodies.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_bodies.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addBody(n.zpp_inner),!0)},bodies_subber:function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remBody(n.zpp_inner)},bodies_modifiable:function(){this.immutable_midstep("Compound::bodies")},constraints_adder:function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_constraints.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_constraints.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addConstraint(n.zpp_inner),!0)},constraints_subber:function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remConstraint(n.zpp_inner)},constraints_modifiable:function(){this.immutable_midstep("Compound::constraints")},compounds_adder:function(n){for(var e=this;null!=e&&e!=n.zpp_inner;)e=e.compound;return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_compounds.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),n.zpp_inner.compound=this,n.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(n.zpp_inner),!0)},compounds_subber:function(n){n.zpp_inner.compound=null,n.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(n.zpp_inner)},compounds_modifiable:function(){this.immutable_midstep("Compound::compounds")},copy:function(n,e){var i=null==n;null==n&&(n=[]),null==e&&(e=[]);for(var t=new jn,l=this.compounds.head;null!=l;){var p=l.elt,r=p.copy(n,e);if(r.zpp_inner.immutable_midstep("Compound::compound"),(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)!=t&&(null!=(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer)&&(null==r.zpp_inner.compound?null:r.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(r),null!=t)){var a=t.zpp_inner.wrap_compounds;a.zpp_inner.reverse_flag?a.push(r):a.unshift(r)}l=l.next}for(var s=this.bodies.head;null!=s;){var o=s.elt,_=o.outer.copy();if(n.push(Oe.dict(o.id,_)),(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer)!=t&&(null!=(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer)&&(null==_.zpp_inner.compound?null:_.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(_),null!=t)){var h=t.zpp_inner.wrap_bodies;h.zpp_inner.reverse_flag?h.push(_):h.unshift(_)}s=s.next}for(var u=this.constraints.head;null!=u;){var x=u.elt,d=x.copy(n,e);if((null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer)!=t&&(null!=(null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer)&&(null==d.zpp_inner.compound?null:d.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(d),null!=t)){var v=t.zpp_inner.wrap_constraints;v.zpp_inner.reverse_flag?v.push(d):v.unshift(d)}u=u.next}if(i)for(;e.length>0;)for(var z=e.pop(),c=0;n.length>c;){var m=n[c];if(++c,m.id==z.id){z.cb(m.bc);break}}return this.copyto(t),t},__class__:Si});var Pi=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new nt,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};l["zpp_nape.phys.ZPP_FluidProperties"]=Pi,Pi.__name__=["zpp_nape","phys","ZPP_FluidProperties"],Pi.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new Rn;var n=this.outer.zpp_inner;n.outer=null,n.next=Pi.zpp_pool,Pi.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new nt},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},copy:function(){var n;return null==Pi.zpp_pool?n=new Pi:(n=Pi.zpp_pool,Pi.zpp_pool=n.next,n.next=null),n.viscosity=this.viscosity,n.density=this.density,n},viscosity:null,density:null,gravityx:null,gravityy:null,wrap_gravity:null,gravity_invalidate:function(n){this.gravityx=n.x,this.gravityy=n.y,this.invalidate()},gravity_validate:function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},getgravity:function(){var n,e=this.gravityx,t=this.gravityy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=i(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=i(this,this.gravity_validate)},invalidate:function(){for(var n=this.shapes.head;null!=n;){n.elt.invalidate_fluidprops(),n=n.next}},__class__:Pi};var Ti=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new nt,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};l["zpp_nape.phys.ZPP_Material"]=Ti,Ti.__name__=["zpp_nape","phys","ZPP_Material"],Ti.prototype={next:null,userData:null,outer:null,wrapper:function(){if(null==this.outer){this.outer=new Yn;var n=this.outer.zpp_inner;n.outer=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},free:function(){this.outer=null},alloc:function(){},shapes:null,wrap_shapes:null,feature_cons:function(){this.shapes=new nt},addShape:function(n){this.shapes.add(n)},remShape:function(n){this.shapes.remove(n)},dynamicFriction:null,staticFriction:null,density:null,elasticity:null,rollingFriction:null,copy:function(){var n=new Ti;return n.dynamicFriction=this.dynamicFriction,n.staticFriction=this.staticFriction,n.density=this.density,n.elasticity=this.elasticity,n.rollingFriction=this.rollingFriction,n},set:function(n){this.dynamicFriction=n.dynamicFriction,this.staticFriction=n.staticFriction,this.density=n.density,this.elasticity=n.elasticity,this.rollingFriction=n.rollingFriction},invalidate:function(n){for(var e=this.shapes.head;null!=e;){e.elt.invalidate_material(n),e=e.next}},__class__:Ti};var Ai=function(n){this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,Oi.call(this),this.pairs=new xt,this.ishape=this,this.type=n;var e;null==qe.zpp_pool?e=new qe:(e=qe.zpp_pool,qe.zpp_pool=e.next,e.next=null),e.minx=0,e.miny=0,e.maxx=0,e.maxy=0,this.aabb=e,this.aabb._immutable=!0;this.aabb._validate=i(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new Ti,this.sweepRadius=this.sweepCoef=0};l["zpp_nape.shape.ZPP_Shape"]=Ai,Ai.__name__=["zpp_nape","shape","ZPP_Shape"],Ai.__super__=Oi,Ai.prototype=e(Oi.prototype,{outer:null,body:null,type:null,isCircle:function(){return this.type==me.id_ShapeType_CIRCLE},isPolygon:function(){return this.type==me.id_ShapeType_POLYGON},area:null,zip_area_inertia:null,inertia:null,angDrag:null,zip_angDrag:null,localCOMx:null,localCOMy:null,zip_localCOM:null,worldCOMx:null,worldCOMy:null,zip_worldCOM:null,wrap_localCOM:null,wrap_worldCOM:null,sweepRadius:null,zip_sweepRadius:null,sweepCoef:null,invalidate_sweepRadius:function(){this.zip_sweepRadius=!0},validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,this.type==me.id_ShapeType_CIRCLE?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},circle:null,polygon:null,refmaterial:null,material:null,filter:null,fluidProperties:null,fluidEnabled:null,sensorEnabled:null,sweep:null,node:null,pairs:null,clear:function(){this.type==me.id_ShapeType_CIRCLE?this.circle.__clear():this.polygon.__clear()},aabb:null,zip_aabb:null,validate_aabb:function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,this.type==me.id_ShapeType_CIRCLE){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var i=0,t=e.lverts.next,l=t;t=t.next;var p=t;for(t=t.next;null!=t;){var r=t;i+=p.x*(r.y-l.y);var a=r.y*p.x-r.x*p.y;e.localCOMx+=(p.x+r.x)*a,e.localCOMy+=(p.y+r.y)*a,l=p,p=r,t=t.next}t=e.lverts.next;var s=t;i+=p.x*(s.y-l.y);var o=s.y*p.x-s.x*p.y;e.localCOMx+=(p.x+s.x)*o,e.localCOMy+=(p.y+s.y)*o,l=p,p=s,t=t.next;var _=t;i+=p.x*(_.y-l.y);var h=_.y*p.x-_.x*p.y;e.localCOMx+=(p.x+_.x)*h,e.localCOMy+=(p.y+_.y)*h,i=1/(3*i);var u=i;e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,v=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-v,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+v}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var c=z.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var m=z.lverts.next,y=z.gverts.next;null!=y;){var f=y,b=m;m=m.next,f.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),f.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),y=y.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;z.aabb.minx>M.x&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),z.aabb.miny>M.y&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},force_validate_aabb:function(){if(this.type==me.id_ShapeType_CIRCLE){var n=this.circle;n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy),n.aabb.minx=n.worldCOMx-n.radius,n.aabb.miny=n.worldCOMy-n.radius,n.aabb.maxx=n.worldCOMx+n.radius,n.aabb.maxy=n.worldCOMy+n.radius}else{var e=this.polygon,i=e.lverts.next,t=e.gverts.next,l=i;i=i.next,t.x=e.body.posx+(e.body.axisy*l.x-e.body.axisx*l.y),t.y=e.body.posy+(l.x*e.body.axisx+l.y*e.body.axisy),e.aabb.minx=t.x,e.aabb.miny=t.y,e.aabb.maxx=t.x,e.aabb.maxy=t.y;for(var p=e.gverts.next.next;null!=p;){var r=p,a=i;i=i.next,r.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),r.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),e.aabb.minx>r.x&&(e.aabb.minx=r.x),r.x>e.aabb.maxx&&(e.aabb.maxx=r.x),e.aabb.miny>r.y&&(e.aabb.miny=r.y),r.y>e.aabb.maxy&&(e.aabb.maxy=r.y),p=p.next}}},invalidate_aabb:function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},validate_area_inertia:function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,this.type==me.id_ShapeType_CIRCLE?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)&&(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,this.type==me.id_ShapeType_CIRCLE?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},validate_localCOM:function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,i=n.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i;e+=l.x*(p.y-t.y);var r=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*r,n.localCOMy+=(l.y+p.y)*r,t=l,l=p,i=i.next}i=n.lverts.next;var a=i;e+=l.x*(a.y-t.y);var s=a.y*l.x-a.x*l.y;n.localCOMx+=(l.x+a.x)*s,n.localCOMy+=(l.y+a.y)*s,t=l,l=a,i=i.next;var o=i;e+=l.x*(o.y-t.y);var _=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*_,n.localCOMy+=(l.y+o.y)*_,e=1/(3*e);var h=e;n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},validate_worldCOM:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,i=n.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i;e+=l.x*(p.y-t.y);var r=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*r,n.localCOMy+=(l.y+p.y)*r,t=l,l=p,i=i.next}i=n.lverts.next;var a=i;e+=l.x*(a.y-t.y);var s=a.y*l.x-a.x*l.y;n.localCOMx+=(l.x+a.x)*s,n.localCOMy+=(l.y+a.y)*s,t=l,l=a,i=i.next;var o=i;e+=l.x*(o.y-t.y);var _=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*_,n.localCOMy+=(l.y+o.y)*_,e=1/(3*e);var h=e;n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},getworldCOM:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,i=n.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i;e+=l.x*(p.y-t.y);var r=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*r,n.localCOMy+=(l.y+p.y)*r,t=l,l=p,i=i.next}i=n.lverts.next;var a=i;e+=l.x*(a.y-t.y);var s=a.y*l.x-a.x*l.y;n.localCOMx+=(l.x+a.x)*s,n.localCOMy+=(l.y+a.y)*s,t=l,l=a,i=i.next;var o=i;e+=l.x*(o.y-t.y);var _=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*_,n.localCOMy+=(l.y+o.y)*_,e=1/(3*e);var h=e;n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},invalidate_area_inertia:function(){if(this.zip_area_inertia=!0,null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){if(this.zip_localCOM=!0,this.invalidate_area_inertia(),this.type==me.id_ShapeType_CIRCLE&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0}},invalidate_worldCOM:function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},invalidate_material:function(n){if(0!=(n&Ti.WAKE)&&this.wake(),0!=(n&Ti.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(n&Ti.PROPS)&&null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}0!=(n&Ti.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},invalidate_fluidprops:function(){this.fluidEnabled&&this.wake()},aabb_validate:function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,this.type==me.id_ShapeType_CIRCLE){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var i=0,t=e.lverts.next,l=t;t=t.next;var p=t;for(t=t.next;null!=t;){var r=t;i+=p.x*(r.y-l.y);var a=r.y*p.x-r.x*p.y;e.localCOMx+=(p.x+r.x)*a,e.localCOMy+=(p.y+r.y)*a,l=p,p=r,t=t.next}t=e.lverts.next;var s=t;i+=p.x*(s.y-l.y);var o=s.y*p.x-s.x*p.y;e.localCOMx+=(p.x+s.x)*o,e.localCOMy+=(p.y+s.y)*o,l=p,p=s,t=t.next;var _=t;i+=p.x*(_.y-l.y);var h=_.y*p.x-_.x*p.y;e.localCOMx+=(p.x+_.x)*h,e.localCOMy+=(p.y+_.y)*h,i=1/(3*i);var u=i;e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,v=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-v,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+v}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var c=z.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var m=z.lverts.next,y=z.gverts.next;null!=y;){var f=y,b=m;m=m.next,f.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),f.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),y=y.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;z.aabb.minx>M.x&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),z.aabb.miny>M.y&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},setMaterial:function(n){this.material!=n&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(n){this.filter!=n&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake())},setFluid:function(n){this.fluidProperties!=n&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.fluidEnabled&&this.wake())},__immutable_midstep:function(n){},addedToBody:function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},copy:function(){var n=null;n=this.type==me.id_ShapeType_CIRCLE?this.circle.__copy():this.polygon.__copy(),this.zip_area_inertia?n.invalidate_area_inertia():(n.area=this.area,n.inertia=this.inertia),this.zip_sweepRadius?n.zip_sweepRadius=!0:(n.sweepRadius=this.sweepRadius,n.sweepCoef=this.sweepCoef),this.zip_angDrag?n.invalidate_angDrag():n.angDrag=this.angDrag,this.zip_aabb?(n.zip_aabb=!0,null!=n.body&&(n.body.zip_aabb=!0)):(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy);var e=n.material;e.outer=null,e.next=Ti.zpp_pool,Ti.zpp_pool=e;var i=n.filter;return i.outer=null,i.next=Ge.zpp_pool,Ge.zpp_pool=i,n.material=this.material,n.filter=this.filter,null!=this.fluidProperties&&(n.fluidProperties=this.fluidProperties),n.fluidEnabled=this.fluidEnabled,n.sensorEnabled=this.sensorEnabled,null!=this.userData&&(n.userData=o.copy(this.userData)),this.copyto(n.outer),n.outer},__class__:Ai});var Ei=function(){this.radius=0,this.outer_zn=null,Ai.call(this,me.id_ShapeType_CIRCLE),this.circle=this,this.zip_localCOM=!1};l["zpp_nape.shape.ZPP_Circle"]=Ei,Ei.__name__=["zpp_nape","shape","ZPP_Circle"],Ei.__super__=Ai,Ei.prototype=e(Ai.prototype,{outer_zn:null,radius:null,__clear:function(){},invalidate_radius:function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},localCOM_validate:function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},localCOM_invalidate:function(n){this.localCOMx=n.x,this.localCOMy=n.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},localCOM_immutable:function(){},setupLocalCOM:function(){var n,e=this.localCOMx,t=this.localCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=i(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=i(this,this.localCOM_invalidate),this.wrap_localCOM.zpp_inner._isimmutable=i(this,this.localCOM_immutable)},__validate_aabb:function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,i=n.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i;e+=l.x*(p.y-t.y);var r=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*r,n.localCOMy+=(l.y+p.y)*r,t=l,l=p,i=i.next}i=n.lverts.next;var a=i;e+=l.x*(a.y-t.y);var s=a.y*l.x-a.x*l.y;n.localCOMx+=(l.x+a.x)*s,n.localCOMy+=(l.y+a.y)*s,t=l,l=a,i=i.next;var o=i;e+=l.x*(o.y-t.y);var _=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*_,n.localCOMy+=(l.y+o.y)*_,e=1/(3*e);var h=e;n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}var x=this.radius,d=this.radius;this.aabb.minx=this.worldCOMx-x,this.aabb.miny=this.worldCOMy-d,this.aabb.maxx=this.worldCOMx+x,this.aabb.maxy=this.worldCOMy+d},_force_validate_aabb:function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var n=this.radius*this.radius;this.area=n*Math.PI,this.inertia=.5*n+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},__validate_angDrag:function(){var n=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,e=this.radius*this.radius;this.angDrag=(n+2*e)*(this.material.dynamicFriction*y.fluidAngularDragFriction)+.5*y.fluidAngularDrag*(1+y.fluidVacuumDrag)*n,this.angDrag/=2*(n+.5*e)},__scale:function(n,e){var i=((0>n?-n:n)+(0>e?-e:e))/2;this.radius*=0>i?-i:i,this.invalidate_radius(),this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0&&(this.localCOMx*=n,this.localCOMy*=e,this.invalidate_localCOM())},__translate:function(n,e){this.localCOMx+=1*n,this.localCOMy+=1*e,this.invalidate_localCOM()},__rotate:function(n,e){if(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0){var i=0,t=0;i=e*this.localCOMx-n*this.localCOMy,t=this.localCOMx*n+this.localCOMy*e,this.localCOMx=i,this.localCOMy=t,this.invalidate_localCOM()}},__transform:function(n){var e=n.zpp_inner.a*n.zpp_inner.d-n.zpp_inner.b*n.zpp_inner.c;0>e&&(e=-e),this.radius*=Math.sqrt(e);var i=n.zpp_inner.a*this.localCOMx+n.zpp_inner.b*this.localCOMy+n.zpp_inner.tx;this.localCOMy=n.zpp_inner.c*this.localCOMx+n.zpp_inner.d*this.localCOMy+n.zpp_inner.ty,this.localCOMx=i,this.invalidate_radius(),this.invalidate_localCOM()},__copy:function(){var n=new Wn(this.radius).zpp_inner_zn;return n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy,n.zip_localCOM=!1,n},__class__:Ei});var Ni=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};l["zpp_nape.shape.ZPP_Edge"]=Ni,Ni.__name__=["zpp_nape","shape","ZPP_Edge"],Ni.prototype={next:null,free:function(){this.polygon=null},alloc:function(){},polygon:null,outer:null,wrapper:function(){return null==this.outer&&(Ni.internal=!0,this.outer=new Jn,Ni.internal=!1,this.outer.zpp_inner=this),this.outer},lnormx:null,lnormy:null,wrap_lnorm:null,gnormx:null,gnormy:null,wrap_gnorm:null,length:null,lprojection:null,gprojection:null,lp0:null,gp0:null,lp1:null,gp1:null,tp0:null,tp1:null,lnorm_validate:function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},gnorm_validate:function(){var n=this.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var i=n.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var t=n.lverts.next,l=n.gverts.next;null!=l;){var p=l,r=t;t=t.next,p.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),p.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),l=l.next}}var a=n.edges.head,s=n.gverts.next,o=s;for(s=s.next;null!=s;){var _=s,h=a.elt;a=a.next,h.gp0=o,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,o=_,s=s.next}var u=n.gverts.next,x=a.elt;a=a.next,x.gp0=o,x.gp1=u,x.gnormx=n.body.axisy*x.lnormx-n.body.axisx*x.lnormy,x.gnormy=x.lnormx*n.body.axisx+x.lnormy*n.body.axisy,x.gprojection=n.body.posx*x.gnormx+n.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},getlnorm:function(){var n,e=this.lnormx,t=this.lnormy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_lnorm=n,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=i(this,this.lnorm_validate)},getgnorm:function(){var n,e=this.gnormx,t=this.gnormy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gnorm=n,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=i(this,this.gnorm_validate)},__class__:Ni};var Li=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,Ai.call(this,me.id_ShapeType_POLYGON),this.polygon=this,this.lverts=new Mi,this.gverts=new Mi,this.edges=new dt,this.edgeCnt=0};l["zpp_nape.shape.ZPP_Polygon"]=Li,Li.__name__=["zpp_nape","shape","ZPP_Polygon"],Li.__super__=Ai,Li.prototype=e(Ai.prototype,{outer_zn:null,lverts:null,wrap_lverts:null,gverts:null,wrap_gverts:null,edges:null,wrap_edges:null,edgeCnt:null,reverse_flag:null,__clear:function(){},lverts_pa_invalidate:function(n){this.invalidate_lverts()},lverts_pa_immutable:function(){},gverts_pa_validate:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var t=i,l=e;e=e.next,t.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),t.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}},lverts_post_adder:function(n){n.zpp_inner._invalidate=i(this,this.lverts_pa_invalidate),n.zpp_inner._isimmutable=i(this,this.lverts_pa_immutable);for(var e=null,t=null,l=this.lverts.next;null!=l;){if(l==n.zpp_inner)break;e=null==e?this.gverts.next:e.next,t=null==t?this.edges.head:t.next,l=l.next}var p;null==Mi.zpp_pool?p=new Mi:(p=Mi.zpp_pool,Mi.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!0,p.x=0,p.y=0;var r=p;if(this.gverts.insert(e,r),null!=this.lverts.next.next)if(null==this.lverts.next.next.next){var a;null==Ni.zpp_pool?a=new Ni:(a=Ni.zpp_pool,Ni.zpp_pool=a.next,a.next=null),a.polygon=this,this.edges.add(a);var s;null==Ni.zpp_pool?s=new Ni:(s=Ni.zpp_pool,Ni.zpp_pool=s.next,s.next=null),s.polygon=this,this.edges.add(s),this.edgeCnt+=2}else{var o;null==Ni.zpp_pool?o=new Ni:(o=Ni.zpp_pool,Ni.zpp_pool=o.next,o.next=null),o.polygon=this,this.edges.insert(t,o),this.edgeCnt++}r._validate=i(this,this.gverts_pa_validate)},lverts_subber:function(n){this.cleanup_lvert(n.zpp_inner)},lverts_invalidate:function(n){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},lverts_modifiable:function(){this.immutable_midstep("Polygon::localVerts")},gverts_validate:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var t=i,l=e;e=e.next,t.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),t.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}},edges_validate:function(){this.validate_lverts()},getlverts:function(){this.wrap_lverts=al.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=i(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=i(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=i(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=i(this,this.lverts_validate),this.wrap_lverts.zpp_inner._modifiable=i(this,this.lverts_modifiable),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},getgverts:function(){this.wrap_gverts=al.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=i(this,this.gverts_validate)},getedges:function(){this.wrap_edges=ml.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=i(this,this.edges_validate)},zip_lverts:null,invalidate_lverts:function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},zip_laxi:null,invalidate_laxi:function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},zip_gverts:null,invalidate_gverts:function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},zip_gaxi:null,invalidate_gaxi:function(){this.zip_gaxi=!0},zip_valid:null,validation:null,valid:function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),3>this.lverts.length)return null==me.ValidationResult_DEGENERATE&&(me.internal=!0,me.ValidationResult_DEGENERATE=new ie,me.internal=!1),this.validation=me.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),y.epsilon>this.area)return null==me.ValidationResult_DEGENERATE&&(me.internal=!0,me.ValidationResult_DEGENERATE=new ie,me.internal=!1),this.validation=me.ValidationResult_DEGENERATE;var n=!1,e=!1,i=!0,t=this.lverts.next,l=t;t=t.next;var p=t;for(t=t.next;null!=t;){var r=t,a=0,s=0;a=r.x-p.x,s=r.y-p.y;var o=0,_=0;o=p.x-l.x,_=p.y-l.y;var h=_*a-o*s;if(h>y.epsilon?e=!0:-y.epsilon>h&&(n=!0),e&&n){i=!1;break}l=p,p=r,t=t.next}if(i){t=this.lverts.next;for(var u=t;;){var x=0,d=0;x=u.x-p.x,d=u.y-p.y;var v=0,z=0;v=p.x-l.x,z=p.y-l.y;var c=z*x-v*d;if(c>y.epsilon?e=!0:-y.epsilon>c&&(n=!0),e&&n){i=!1;break}break}if(i){l=p,p=u,t=t.next;for(var m=t;;){var f=0,b=0;f=m.x-p.x,b=m.y-p.y;var g=0,w=0;g=p.x-l.x,w=p.y-l.y;var M=w*f-g*b;if(M>y.epsilon?e=!0:-y.epsilon>M&&(n=!0),e&&n)break;break}}}if(e&&n)return null==me.ValidationResult_CONCAVE&&(me.internal=!0,me.ValidationResult_CONCAVE=new ie,me.internal=!1),this.validation=me.ValidationResult_CONCAVE;var C=!0,k=!0,O=this.lverts.next,I=O;for(O=O.next;null!=O;){var S=O;if(!C){k=!1;break}var P=!0,T=this.lverts.next,A=T;for(T=T.next;null!=T;){var E=T;if(I!=A&&I!=E&&S!=A&&S!=E){var N=0,L=0;N=I.x-A.x,L=I.y-A.y;var V=0,j=0;V=S.x-I.x,j=S.y-I.y;var D=0,F=0;D=E.x-A.x,F=E.y-A.y;var R=j*D-V*F;if(R*R>y.epsilon){R=1/R;var B=(F*N-D*L)*R;if(B>y.epsilon&&1-y.epsilon>B){var G=(j*N-V*L)*R;if(G>y.epsilon&&1-y.epsilon>G){C=!1,P=!1;break}}}A=E,T=T.next}else A=E,T=T.next}if(P)for(;;){var Z=this.lverts.next;if(I==A||I==Z||S==A||S==Z)break;var U=0,q=0;U=I.x-A.x,q=I.y-A.y;var Y=0,K=0;Y=S.x-I.x,K=S.y-I.y;var W=0,J=0;W=Z.x-A.x,J=Z.y-A.y;var X=K*W-Y*J;if(X*X>y.epsilon){X=1/X;var H=(J*U-W*q)*X;if(H>y.epsilon&&1-y.epsilon>H){var Q=(K*U-Y*q)*X;if(Q>y.epsilon&&1-y.epsilon>Q){C=!1;break}}}break}I=S,O=O.next}if(k)for(;;){var $=this.lverts.next;if(!C)break;var nn=!0,en=this.lverts.next,tn=en;for(en=en.next;null!=en;){var ln=en;if(I!=tn&&I!=ln&&$!=tn&&$!=ln){var pn=0,rn=0;pn=I.x-tn.x,rn=I.y-tn.y;var an=0,sn=0;an=$.x-I.x,sn=$.y-I.y;var on=0,_n=0;on=ln.x-tn.x,_n=ln.y-tn.y;var hn=sn*on-an*_n;if(hn*hn>y.epsilon){hn=1/hn;var un=(_n*pn-on*rn)*hn;if(un>y.epsilon&&1-y.epsilon>un){var xn=(sn*pn-an*rn)*hn;if(xn>y.epsilon&&1-y.epsilon>xn){C=!1,nn=!1;break}}}tn=ln,en=en.next}else tn=ln,en=en.next}if(nn)for(;;){var dn=this.lverts.next;if(I==tn||I==dn||$==tn||$==dn)break;var vn=0,zn=0;vn=I.x-tn.x,zn=I.y-tn.y;var cn=0,mn=0;cn=$.x-I.x,mn=$.y-I.y;var yn=0,fn=0;yn=dn.x-tn.x,fn=dn.y-tn.y;var bn=mn*yn-cn*fn;if(bn*bn>y.epsilon){bn=1/bn;var gn=(fn*vn-yn*zn)*bn;if(gn>y.epsilon&&1-y.epsilon>gn){var wn=(mn*vn-cn*zn)*bn;if(wn>y.epsilon&&1-y.epsilon>wn){C=!1;break}}}break}break}return C?(null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1),this.validation=me.ValidationResult_VALID):(null==me.ValidationResult_SELF_INTERSECTING&&(me.internal=!0,me.ValidationResult_SELF_INTERSECTING=new ie,me.internal=!1),this.validation=me.ValidationResult_SELF_INTERSECTING)}return this.validation},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,this.lverts.length>2&&(this.validate_area_inertia(),0>this.area&&(this.reverse_vertices(),this.area=-this.area)))},cleanup_lvert:function(n){for(var e=null,i=null,t=this.lverts.next;null!=t;){if(t==n)break;e=null==e?this.gverts.next:e.next,i=null==i?this.edges.head:i.next,t=t.next}var l=null==e?this.gverts.next:e.next;this.gverts.erase(e);var p=l;if(null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=Mi.zpp_pool,Mi.zpp_pool=p,2==this.edgeCnt){var r=this.edges.pop_unsafe(),a=r;a.polygon=null,a.next=Ni.zpp_pool,Ni.zpp_pool=a,r=this.edges.pop_unsafe();var s=r;s.polygon=null,s.next=Ni.zpp_pool,Ni.zpp_pool=s,this.edgeCnt=0}else if(0!=this.edgeCnt){var o=null==i?this.edges.head.elt:i.next.elt;this.edges.erase(i);var _=o;_.polygon=null,_.next=Ni.zpp_pool,Ni.zpp_pool=_,this.edgeCnt--}},zip_sanitation:null,splice_collinear:function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},splice_collinear_real:function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var n=null,e=this.lverts.next;null!=e;){var i=null==e.next?this.lverts.next:e.next,t=e,l=i,p=0,r=0;p=t.x-l.x,r=t.y-l.y,y.epsilon*y.epsilon>p*p+r*r?(this.cleanup_lvert(e),e=this.lverts.erase(n)):(n=e,e=e.next)}if(null!=this.lverts.next)for(var a;;){a=!1;for(var s=this.lverts.next;null!=s;){var o=null==s.next?this.lverts.next:s.next,_=null==o.next?this.lverts.next:o.next,h=s,u=o,x=_,d=0,v=0;d=u.x-h.x,v=u.y-h.y;var z=0,c=0;z=x.x-u.x,c=x.y-u.y;var m=c*d-z*v;y.epsilon*y.epsilon>m*m?(this.cleanup_lvert(o),this.lverts.erase(null==s.next?null:s),a=!0,s=s.next):s=s.next}if(!a)break}}},reverse_vertices:function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();var n=this.edges.head,e=this.lverts.next,i=e;for(e=e.next;null!=e;){var t=e,l=n.elt;n=n.next,l.lp0=i,l.lp1=t;var p=0,r=0;p=i.x-t.x,r=i.y-t.y;var a=Math.sqrt(p*p+r*r);l.length=a;var s=1/a;p*=s,r*=s;var o=p;p=-r,r=o,l.lprojection=p*i.x+r*i.y,l.lnormx=p,l.lnormy=r,null!=l.wrap_lnorm&&(l.wrap_lnorm.zpp_inner.x=p,l.wrap_lnorm.zpp_inner.y=r),i=t,e=e.next}var _=this.lverts.next,h=n.elt;n=n.next,h.lp0=i,h.lp1=_;var u=0,x=0;u=i.x-_.x,x=i.y-_.y;var d=Math.sqrt(u*u+x*x);h.length=d;var v=1/d;u*=v,x*=v;var z=u;u=-x,x=z,h.lprojection=u*i.x+x*i.y,h.lnormx=u,h.lnormy=x,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=u,h.wrap_lnorm.zpp_inner.y=x)}},validate_gverts:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var t=i,l=e;e=e.next,t.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),t.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}},validate_gaxi:function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var n=this.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var i=this.lverts.next,t=this.gverts.next;null!=t;){var l=t,p=i;i=i.next,l.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),l.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),t=t.next}}var r=this.edges.head,a=this.gverts.next,s=a;for(a=a.next;null!=a;){var o=a,_=r.elt;r=r.next,_.gp0=s,_.gp1=o,_.gnormx=this.body.axisy*_.lnormx-this.body.axisx*_.lnormy,_.gnormy=_.lnormx*this.body.axisx+_.lnormy*this.body.axisy,_.gprojection=this.body.posx*_.gnormx+this.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,s=o,a=a.next}var h=this.gverts.next,u=r.elt;r=r.next,u.gp0=s,u.gp1=h,u.gnormx=this.body.axisy*u.lnormx-this.body.axisx*u.lnormy,u.gnormy=u.lnormx*this.body.axisx+u.lnormy*this.body.axisy,u.gprojection=this.body.posx*u.gnormx+this.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}},__validate_aabb:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,i=this.gverts.next;null!=i;){var t=i,l=e;e=e.next,t.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),t.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}var p=this.gverts.next;this.aabb.minx=p.x,this.aabb.miny=p.y,this.aabb.maxx=p.x,this.aabb.maxy=p.y;for(var r=this.gverts.next.next;null!=r;){var a=r;this.aabb.minx>a.x&&(this.aabb.minx=a.x),a.x>this.aabb.maxx&&(this.aabb.maxx=a.x),this.aabb.miny>a.y&&(this.aabb.miny=a.y),a.y>this.aabb.maxy&&(this.aabb.maxy=a.y),r=r.next}},_force_validate_aabb:function(){var n=this.lverts.next,e=this.gverts.next,i=n;n=n.next,e.x=this.body.posx+(this.body.axisy*i.x-this.body.axisx*i.y),e.y=this.body.posy+(i.x*this.body.axisx+i.y*this.body.axisy),this.aabb.minx=e.x,this.aabb.miny=e.y,this.aabb.maxx=e.x,this.aabb.maxy=e.y;for(var t=this.gverts.next.next;null!=t;){var l=t,p=n;n=n.next,l.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),l.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),this.aabb.minx>l.x&&(this.aabb.minx=l.x),l.x>this.aabb.maxx&&(this.aabb.maxx=l.x),this.aabb.miny>l.y&&(this.aabb.miny=l.y),l.y>this.aabb.maxy&&(this.aabb.maxy=l.y),t=t.next}},__validate_sweepRadius:function(){var n=0,e=0;this.validate_laxi();for(var i=this.lverts.next;null!=i;){var t=i,l=t.x*t.x+t.y*t.y;l>n&&(n=l),i=i.next}for(var p=this.edges.head;null!=p;){var r=p.elt;if(e>r.lprojection&&0>(e=r.lprojection))break;p=p.next}0>e&&(e=0),this.sweepRadius=Math.sqrt(n),this.sweepCoef=this.sweepRadius-e},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{this.area=0;var n=0,e=0,i=this.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i,r=l.y*t.x-l.x*t.y;n+=r*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),e+=r,this.area+=l.x*(p.y-t.y),t=l,l=p,i=i.next}i=this.lverts.next;var a=i,s=l.y*t.x-l.x*t.y;n+=s*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),e+=s,this.area+=l.x*(a.y-t.y),t=l,l=a,i=i.next;var o=i,_=l.y*t.x-l.x*t.y;n+=_*(l.x*l.x+l.y*l.y+(l.x*t.x+l.y*t.y)+(t.x*t.x+t.y*t.y)),e+=_,this.area+=l.x*(o.y-t.y),this.inertia=n/(6*e),this.area*=.5,0>this.area&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){this.validate_area_inertia(),this.validate_laxi();for(var n=0,e=this.edges.head,i=0,t=this.lverts.next,l=t,p=t.next;null!=p;){var r=p,a=e.elt;e=e.next,i+=a.length;var s=0,o=0;s=r.x-l.x,o=r.y-l.y,n+=a.length*y.fluidAngularDragFriction*this.material.dynamicFriction*a.lprojection*a.lprojection;var _=-(l.y*a.lnormx-l.x*a.lnormy)/(o*a.lnormx-s*a.lnormy);if(_>0){var h=_>1?1:_,u=0,x=0;u=l.x,x=l.y;var d=h;u+=s*d,x+=o*d;var v=a.lnormy*l.x-a.lnormx*l.y,z=a.lnormy*u-a.lnormx*x;n+=(z*z*z-v*v*v)/(3*(z-v))*h*a.length*y.fluidAngularDrag}if(1>_){var c=0>_?0:_,m=0,f=0;m=l.x,f=l.y;var b=c;m+=s*b,f+=o*b;var g=a.lnormy*m-a.lnormx*f,w=a.lnormy*r.x-a.lnormx*r.y;n+=(w*w*w-g*g*g)/(3*(w-g))*y.fluidVacuumDrag*(1-c)*a.length*y.fluidAngularDrag}t=p,l=r,p=p.next}for(;;){p=this.lverts.next;var M=p,C=e.elt;e=e.next,i+=C.length;var k=0,O=0;k=M.x-l.x,O=M.y-l.y,n+=C.length*y.fluidAngularDragFriction*this.material.dynamicFriction*C.lprojection*C.lprojection;var I=-(l.y*C.lnormx-l.x*C.lnormy)/(O*C.lnormx-k*C.lnormy);if(I>0){var S=I>1?1:I,P=0,T=0;P=l.x,T=l.y;var A=S;P+=k*A,T+=O*A;var E=C.lnormy*l.x-C.lnormx*l.y,N=C.lnormy*P-C.lnormx*T;n+=(N*N*N-E*E*E)/(3*(N-E))*S*C.length*y.fluidAngularDrag}if(1>I){var L=0>I?0:I,V=0,j=0;V=l.x,j=l.y;var D=L;V+=k*D,j+=O*D;var F=C.lnormy*V-C.lnormx*j,R=C.lnormy*M.x-C.lnormx*M.y;n+=(R*R*R-F*F*F)/(3*(R-F))*y.fluidVacuumDrag*(1-L)*C.length*y.fluidAngularDrag}break}this.angDrag=n/(this.inertia*i)},__validate_localCOM:function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next){this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y;this.localCOMx*=.5,this.localCOMy*=.5}else{this.localCOMx=0,this.localCOMy=0;var n=0,e=this.lverts.next,i=e;e=e.next;var t=e;for(e=e.next;null!=e;){var l=e;n+=t.x*(l.y-i.y);var p=l.y*t.x-l.x*t.y;this.localCOMx+=(t.x+l.x)*p,this.localCOMy+=(t.y+l.y)*p,i=t,t=l,e=e.next}e=this.lverts.next;var r=e;n+=t.x*(r.y-i.y);var a=r.y*t.x-r.x*t.y;this.localCOMx+=(t.x+r.x)*a,this.localCOMy+=(t.y+r.y)*a,i=t,t=r,e=e.next;var s=e;n+=t.x*(s.y-i.y);var o=s.y*t.x-s.x*t.y;this.localCOMx+=(t.x+s.x)*o,this.localCOMy+=(t.y+s.y)*o,n=1/(3*n);var _=n;this.localCOMx*=_,this.localCOMy*=_}},localCOM_validate:function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next){n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;n.localCOMx+=1*n.lverts.next.next.x,n.localCOMy+=1*n.lverts.next.next.y;n.localCOMx*=.5,n.localCOMy*=.5}else{n.localCOMx=0,n.localCOMy=0;var e=0,i=n.lverts.next,t=i;i=i.next;var l=i;for(i=i.next;null!=i;){var p=i;e+=l.x*(p.y-t.y);var r=p.y*l.x-p.x*l.y;n.localCOMx+=(l.x+p.x)*r,n.localCOMy+=(l.y+p.y)*r,t=l,l=p,i=i.next}i=n.lverts.next;var a=i;e+=l.x*(a.y-t.y);var s=a.y*l.x-a.x*l.y;n.localCOMx+=(l.x+a.x)*s,n.localCOMy+=(l.y+a.y)*s,t=l,l=a,i=i.next;var o=i;e+=l.x*(o.y-t.y);var _=o.y*l.x-o.x*l.y;n.localCOMx+=(l.x+o.x)*_,n.localCOMy+=(l.y+o.y)*_,e=1/(3*e);var h=e;n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},localCOM_invalidate:function(n){if(this.zip_localCOM){if(this.zip_localCOM=!1,this.type==me.id_ShapeType_POLYGON){var e=this.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next){e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;e.localCOMx+=1*e.lverts.next.next.x,e.localCOMy+=1*e.lverts.next.next.y;e.localCOMx*=.5,e.localCOMy*=.5}else{e.localCOMx=0,e.localCOMy=0;var i=0,t=e.lverts.next,l=t;t=t.next;var p=t;for(t=t.next;null!=t;){var r=t;i+=p.x*(r.y-l.y);var a=r.y*p.x-r.x*p.y;e.localCOMx+=(p.x+r.x)*a,e.localCOMy+=(p.y+r.y)*a,l=p,p=r,t=t.next}t=e.lverts.next;var s=t;i+=p.x*(s.y-l.y);var o=s.y*p.x-s.x*p.y;e.localCOMx+=(p.x+s.x)*o,e.localCOMy+=(p.y+s.y)*o,l=p,p=s,t=t.next;var _=t;i+=p.x*(_.y-l.y);var h=_.y*p.x-_.x*p.y;e.localCOMx+=(p.x+_.x)*h,e.localCOMy+=(p.y+_.y)*h,i=1/(3*i);var u=i;e.localCOMx*=u,e.localCOMy*=u}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var x=0,d=0;x=n.x-this.localCOMx,d=n.y-this.localCOMy;for(var v=this.lverts.next;null!=v;){var z=v;z.x+=1*x,z.y+=1*d,v=v.next}this.invalidate_lverts()},setupLocalCOM:function(){var n,e=this.localCOMx,t=this.localCOMy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=i(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=i(this,this.localCOM_invalidate)},__translate:function(n,e){for(var i=this.lverts.next;null!=i;){var t=i;t.x+=1*n,t.y+=1*e,i=i.next}this.invalidate_lverts()},__scale:function(n,e){for(var i=this.lverts.next;null!=i;){var t=i;t.x*=n,t.y*=e,i=i.next}this.invalidate_lverts()},__rotate:function(n,e){for(var i=this.lverts.next;null!=i;){var t=i,l=0,p=0;l=e*t.x-n*t.y,p=t.x*n+t.y*e,t.x=l,t.y=p,i=i.next}this.invalidate_lverts()},__transform:function(n){for(var e=this.lverts.next;null!=e;){var i=e,t=n.zpp_inner.a*i.x+n.zpp_inner.b*i.y+n.zpp_inner.tx;i.y=n.zpp_inner.c*i.x+n.zpp_inner.d*i.y+n.zpp_inner.ty,i.x=t,e=e.next}this.invalidate_lverts()},__copy:function(){var n=this.outer_zn;return null==n.zpp_inner_zn.wrap_lverts&&n.zpp_inner_zn.getlverts(),new Qn(n.zpp_inner_zn.wrap_lverts).zpp_inner_zn},__class__:Li});var Vi=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};l["zpp_nape.space.ZPP_Broadphase"]=Vi,Vi.__name__=["zpp_nape","space","ZPP_Broadphase"],Vi.prototype={space:null,is_sweep:null,sweep:null,dynab:null,insert:function(n){this.is_sweep?this.sweep.__insert(n):this.dynab.__insert(n)},remove:function(n){this.is_sweep?this.sweep.__remove(n):this.dynab.__remove(n)},sync:function(n){if(this.is_sweep){if(!this.sweep.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==me.id_ShapeType_POLYGON){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var t=0,l=i.lverts.next,p=l;l=l.next;var r=l;for(l=l.next;null!=l;){var a=l;t+=r.x*(a.y-p.y);var s=a.y*r.x-a.x*r.y;i.localCOMx+=(r.x+a.x)*s,i.localCOMy+=(r.y+a.y)*s,p=r,r=a,l=l.next}l=i.lverts.next;var o=l;t+=r.x*(o.y-p.y);var _=o.y*r.x-o.x*r.y;i.localCOMx+=(r.x+o.x)*_,i.localCOMy+=(r.y+o.y)*_,p=r,r=o,l=l.next;var h=l;t+=r.x*(h.y-p.y);var u=h.y*r.x-h.x*r.y;i.localCOMx+=(r.x+h.x)*u,i.localCOMy+=(r.y+h.y)*u,t=1/(3*t);var x=t;i.localCOMx*=x,i.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var v=e.radius,z=e.radius;e.aabb.minx=e.worldCOMx-v,e.aabb.miny=e.worldCOMy-z,e.aabb.maxx=e.worldCOMx+v,e.aabb.maxy=e.worldCOMy+z}else{var c=n.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var m=c.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var y=c.lverts.next,f=c.gverts.next;null!=f;){var b=f,g=y;y=y.next,b.x=c.body.posx+(c.body.axisy*g.x-c.body.axisx*g.y),b.y=c.body.posy+(g.x*c.body.axisx+g.y*c.body.axisy),f=f.next}}var w=c.gverts.next;c.aabb.minx=w.x,c.aabb.miny=w.y,c.aabb.maxx=w.x,c.aabb.maxy=w.y;for(var M=c.gverts.next.next;null!=M;){var C=M;c.aabb.minx>C.x&&(c.aabb.minx=C.x),C.x>c.aabb.maxx&&(c.aabb.maxx=C.x),c.aabb.miny>C.y&&(c.aabb.miny=C.y),C.y>c.aabb.maxy&&(c.aabb.maxy=C.y),M=M.next}}}else{var k=this.dynab,O=n.node;if(!O.synced){if(!k.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var I=n.circle;if(I.zip_worldCOM&&null!=I.body){if(I.zip_worldCOM=!1,I.zip_localCOM){if(I.zip_localCOM=!1,I.type==me.id_ShapeType_POLYGON){var S=I.polygon;if(null==S.lverts.next.next)S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y;else if(null==S.lverts.next.next.next){S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y;S.localCOMx+=1*S.lverts.next.next.x,S.localCOMy+=1*S.lverts.next.next.y;S.localCOMx*=.5,S.localCOMy*=.5}else{S.localCOMx=0,S.localCOMy=0;var P=0,T=S.lverts.next,A=T;T=T.next;var E=T;for(T=T.next;null!=T;){var N=T;P+=E.x*(N.y-A.y);var L=N.y*E.x-N.x*E.y;S.localCOMx+=(E.x+N.x)*L,S.localCOMy+=(E.y+N.y)*L,A=E,E=N,T=T.next}T=S.lverts.next;var V=T;P+=E.x*(V.y-A.y);var j=V.y*E.x-V.x*E.y;S.localCOMx+=(E.x+V.x)*j,S.localCOMy+=(E.y+V.y)*j,A=E,E=V,T=T.next;var D=T;P+=E.x*(D.y-A.y);var F=D.y*E.x-D.x*E.y;S.localCOMx+=(E.x+D.x)*F,S.localCOMy+=(E.y+D.y)*F,P=1/(3*P);var R=P;S.localCOMx*=R,S.localCOMy*=R}}null!=I.wrap_localCOM&&(I.wrap_localCOM.zpp_inner.x=I.localCOMx,I.wrap_localCOM.zpp_inner.y=I.localCOMy)}var B=I.body;B.zip_axis&&(B.zip_axis=!1,B.axisx=Math.sin(B.rot),B.axisy=Math.cos(B.rot)),I.worldCOMx=I.body.posx+(I.body.axisy*I.localCOMx-I.body.axisx*I.localCOMy),I.worldCOMy=I.body.posy+(I.localCOMx*I.body.axisx+I.localCOMy*I.body.axisy)}var G=I.radius,Z=I.radius;I.aabb.minx=I.worldCOMx-G,I.aabb.miny=I.worldCOMy-Z,I.aabb.maxx=I.worldCOMx+G,I.aabb.maxy=I.worldCOMy+Z}else{var U=n.polygon;if(U.zip_gverts&&null!=U.body){U.zip_gverts=!1,U.validate_lverts();var q=U.body;q.zip_axis&&(q.zip_axis=!1,q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot));for(var Y=U.lverts.next,K=U.gverts.next;null!=K;){var W=K,J=Y;Y=Y.next,W.x=U.body.posx+(U.body.axisy*J.x-U.body.axisx*J.y),W.y=U.body.posy+(J.x*U.body.axisx+J.y*U.body.axisy),K=K.next}}var X=U.gverts.next;U.aabb.minx=X.x,U.aabb.miny=X.y,U.aabb.maxx=X.x,U.aabb.maxy=X.y;for(var H=U.gverts.next.next;null!=H;){var Q=H;U.aabb.minx>Q.x&&(U.aabb.minx=Q.x),Q.x>U.aabb.maxx&&(U.aabb.maxx=Q.x),U.aabb.miny>Q.y&&(U.aabb.miny=Q.y),Q.y>U.aabb.maxy&&(U.aabb.maxy=Q.y),H=H.next}}var $;if(O.dyn==(n.body.type!=me.id_BodyType_STATIC&&!n.body.component.sleeping)){var nn=O.aabb,en=n.aabb;$=!!(nn.minx>en.minx||nn.miny>en.miny||en.maxx>nn.maxx||en.maxy>nn.maxy)}else $=!0;$&&(O.synced=!0,O.snext=k.syncs,k.syncs=O)}}},broadphase:function(n,e){},clear:function(){},shapesUnderPoint:function(n,e,i,t){return null},bodiesUnderPoint:function(n,e,i,t){return null},aabbShape:null,matrix:null,updateAABBShape:function(n){if(null==this.aabbShape){null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1);var e=new En(me.BodyType_STATIC),i=e.zpp_inner.wrap_shapes,t=this.aabbShape=new Qn(Qn.rect(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny));i.zpp_inner.reverse_flag?i.push(t):i.unshift(t)}else{var l=this.aabbShape.zpp_inner.aabb,p=(n.maxx-n.minx)/(l.maxx-l.minx),r=(n.maxy-n.miny)/(l.maxy-l.miny);null==this.matrix&&(this.matrix=new bn);var a=this.matrix;a.zpp_inner.a=p;var s=a.zpp_inner;null!=s._invalidate&&s._invalidate();var o=this.matrix,_=this.matrix;_.zpp_inner.c=0;var h=_.zpp_inner;null!=h._invalidate&&h._invalidate();var u=_.zpp_inner.c;o.zpp_inner.b=u;var x=o.zpp_inner;null!=x._invalidate&&x._invalidate();var d=this.matrix;d.zpp_inner.d=r;var v=d.zpp_inner;null!=v._invalidate&&v._invalidate();var z=this.matrix,c=n.minx-p*l.minx;z.zpp_inner.tx=c;var m=z.zpp_inner;null!=m._invalidate&&m._invalidate();var y=this.matrix,f=n.miny-r*l.miny;y.zpp_inner.ty=f;var b=y.zpp_inner;null!=b._invalidate&&b._invalidate(),this.aabbShape.transform(this.matrix)}var g=this.aabbShape.zpp_inner;if(g.zip_aabb&&null!=g.body)if(g.zip_aabb=!1,g.type==me.id_ShapeType_CIRCLE){var w=g.circle;if(w.zip_worldCOM&&null!=w.body){if(w.zip_worldCOM=!1,w.zip_localCOM){if(w.zip_localCOM=!1,w.type==me.id_ShapeType_POLYGON){var M=w.polygon;if(null==M.lverts.next.next)M.localCOMx=M.lverts.next.x,M.localCOMy=M.lverts.next.y;else if(null==M.lverts.next.next.next){M.localCOMx=M.lverts.next.x,M.localCOMy=M.lverts.next.y;M.localCOMx+=1*M.lverts.next.next.x,M.localCOMy+=1*M.lverts.next.next.y;M.localCOMx*=.5,M.localCOMy*=.5}else{M.localCOMx=0,M.localCOMy=0;var C=0,k=M.lverts.next,O=k;k=k.next;var I=k;for(k=k.next;null!=k;){var S=k;C+=I.x*(S.y-O.y);var P=S.y*I.x-S.x*I.y;M.localCOMx+=(I.x+S.x)*P,M.localCOMy+=(I.y+S.y)*P,O=I,I=S,k=k.next}k=M.lverts.next;var T=k;C+=I.x*(T.y-O.y);var A=T.y*I.x-T.x*I.y;M.localCOMx+=(I.x+T.x)*A,M.localCOMy+=(I.y+T.y)*A,O=I,I=T,k=k.next;var E=k;C+=I.x*(E.y-O.y);var N=E.y*I.x-E.x*I.y;M.localCOMx+=(I.x+E.x)*N,M.localCOMy+=(I.y+E.y)*N,C=1/(3*C);var L=C;M.localCOMx*=L,M.localCOMy*=L}}null!=w.wrap_localCOM&&(w.wrap_localCOM.zpp_inner.x=w.localCOMx,w.wrap_localCOM.zpp_inner.y=w.localCOMy)}var V=w.body;V.zip_axis&&(V.zip_axis=!1,V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)),w.worldCOMx=w.body.posx+(w.body.axisy*w.localCOMx-w.body.axisx*w.localCOMy),w.worldCOMy=w.body.posy+(w.localCOMx*w.body.axisx+w.localCOMy*w.body.axisy)}var j=w.radius,D=w.radius;w.aabb.minx=w.worldCOMx-j,w.aabb.miny=w.worldCOMy-D,w.aabb.maxx=w.worldCOMx+j,w.aabb.maxy=w.worldCOMy+D}else{var F=g.polygon;if(F.zip_gverts&&null!=F.body){F.zip_gverts=!1,F.validate_lverts();var R=F.body;R.zip_axis&&(R.zip_axis=!1,R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot));for(var B=F.lverts.next,G=F.gverts.next;null!=G;){var Z=G,U=B;B=B.next,Z.x=F.body.posx+(F.body.axisy*U.x-F.body.axisx*U.y),Z.y=F.body.posy+(U.x*F.body.axisx+U.y*F.body.axisy),G=G.next}}var q=F.gverts.next;F.aabb.minx=q.x,F.aabb.miny=q.y,F.aabb.maxx=q.x,F.aabb.maxy=q.y;for(var Y=F.gverts.next.next;null!=Y;){var K=Y;F.aabb.minx>K.x&&(F.aabb.minx=K.x),K.x>F.aabb.maxx&&(F.aabb.maxx=K.x),F.aabb.miny>K.y&&(F.aabb.miny=K.y),K.y>F.aabb.maxy&&(F.aabb.maxy=K.y),Y=Y.next}}var W=this.aabbShape.zpp_inner.polygon;if(W.zip_gaxi&&null!=W.body){W.zip_gaxi=!1,W.validate_laxi();var J=W.body;if(J.zip_axis&&(J.zip_axis=!1,J.axisx=Math.sin(J.rot),J.axisy=Math.cos(J.rot)),W.zip_gverts&&null!=W.body){W.zip_gverts=!1,W.validate_lverts();var X=W.body;X.zip_axis&&(X.zip_axis=!1,X.axisx=Math.sin(X.rot),X.axisy=Math.cos(X.rot));for(var H=W.lverts.next,Q=W.gverts.next;null!=Q;){var $=Q,nn=H;H=H.next,$.x=W.body.posx+(W.body.axisy*nn.x-W.body.axisx*nn.y),$.y=W.body.posy+(nn.x*W.body.axisx+nn.y*W.body.axisy),Q=Q.next}}var en=W.edges.head,tn=W.gverts.next,ln=tn;for(tn=tn.next;null!=tn;){var pn=tn,rn=en.elt;en=en.next,rn.gp0=ln,rn.gp1=pn,rn.gnormx=W.body.axisy*rn.lnormx-W.body.axisx*rn.lnormy,rn.gnormy=rn.lnormx*W.body.axisx+rn.lnormy*W.body.axisy,rn.gprojection=W.body.posx*rn.gnormx+W.body.posy*rn.gnormy+rn.lprojection,null!=rn.wrap_gnorm&&(rn.wrap_gnorm.zpp_inner.x=rn.gnormx,rn.wrap_gnorm.zpp_inner.y=rn.gnormy),rn.tp0=rn.gp0.y*rn.gnormx-rn.gp0.x*rn.gnormy,rn.tp1=rn.gp1.y*rn.gnormx-rn.gp1.x*rn.gnormy,ln=pn,tn=tn.next}var an=W.gverts.next,sn=en.elt;en=en.next,sn.gp0=ln,sn.gp1=an,sn.gnormx=W.body.axisy*sn.lnormx-W.body.axisx*sn.lnormy,sn.gnormy=sn.lnormx*W.body.axisx+sn.lnormy*W.body.axisy,sn.gprojection=W.body.posx*sn.gnormx+W.body.posy*sn.gnormy+sn.lprojection,null!=sn.wrap_gnorm&&(sn.wrap_gnorm.zpp_inner.x=sn.gnormx,sn.wrap_gnorm.zpp_inner.y=sn.gnormy),sn.tp0=sn.gp0.y*sn.gnormx-sn.gp0.x*sn.gnormy,sn.tp1=sn.gp1.y*sn.gnormx-sn.gp1.x*sn.gnormy}},shapesInAABB:function(n,e,i,t,l){return null},bodiesInAABB:function(n,e,i,t,l){return null},circShape:null,updateCircShape:function(n,e,i){if(null==this.circShape){null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1);var t,l=new En(me.BodyType_STATIC),p=l.zpp_inner.wrap_shapes;if(null==Ml.poolVec2?t=new On:(t=Ml.poolVec2,Ml.poolVec2=t.zpp_pool,t.zpp_pool=null,t.zpp_disp=!1,t==Ml.nextVec2&&(Ml.nextVec2=null)),null==t.zpp_inner){var r;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=e,t.zpp_inner=r,t.zpp_inner.outer=t}else{var a=t.zpp_inner;null!=a._isimmutable&&a._isimmutable();var s,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==n){var _=t.zpp_inner;null!=_._validate&&_._validate(),s=t.zpp_inner.y==e}else s=!1;if(!s){t.zpp_inner.x=n,t.zpp_inner.y=e;var h=t.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}t.zpp_inner.weak=!1;var u=this.circShape=new Wn(i,t);p.zpp_inner.reverse_flag?p.push(u):p.unshift(u)}else{var x=this.circShape.zpp_inner.circle,d=i/x.radius;null==this.matrix&&(this.matrix=new bn);var v=this.matrix,z=this.matrix;z.zpp_inner.d=d;var c=z.zpp_inner;null!=c._invalidate&&c._invalidate();var m=z.zpp_inner.d;v.zpp_inner.a=m;var y=v.zpp_inner;null!=y._invalidate&&y._invalidate();var f=this.matrix,b=this.matrix;b.zpp_inner.c=0;var g=b.zpp_inner;null!=g._invalidate&&g._invalidate();var w=b.zpp_inner.c;f.zpp_inner.b=w;var M=f.zpp_inner;null!=M._invalidate&&M._invalidate();var C=this.matrix,k=n-d*x.localCOMx;C.zpp_inner.tx=k;var O=C.zpp_inner;null!=O._invalidate&&O._invalidate();var I=this.matrix,S=e-d*x.localCOMy;I.zpp_inner.ty=S;var P=I.zpp_inner;null!=P._invalidate&&P._invalidate(),this.circShape.transform(this.matrix)}var T=this.circShape.zpp_inner;if(T.zip_aabb&&null!=T.body)if(T.zip_aabb=!1,T.type==me.id_ShapeType_CIRCLE){var A=T.circle;if(A.zip_worldCOM&&null!=A.body){if(A.zip_worldCOM=!1,A.zip_localCOM){if(A.zip_localCOM=!1,A.type==me.id_ShapeType_POLYGON){var E=A.polygon;if(null==E.lverts.next.next)E.localCOMx=E.lverts.next.x,E.localCOMy=E.lverts.next.y;else if(null==E.lverts.next.next.next){E.localCOMx=E.lverts.next.x,E.localCOMy=E.lverts.next.y;E.localCOMx+=1*E.lverts.next.next.x,E.localCOMy+=1*E.lverts.next.next.y;E.localCOMx*=.5,E.localCOMy*=.5}else{E.localCOMx=0,E.localCOMy=0;var N=0,L=E.lverts.next,V=L;L=L.next;var j=L;for(L=L.next;null!=L;){var D=L;N+=j.x*(D.y-V.y);var F=D.y*j.x-D.x*j.y;E.localCOMx+=(j.x+D.x)*F,E.localCOMy+=(j.y+D.y)*F,V=j,j=D,L=L.next}L=E.lverts.next;var R=L;N+=j.x*(R.y-V.y);var B=R.y*j.x-R.x*j.y;E.localCOMx+=(j.x+R.x)*B,E.localCOMy+=(j.y+R.y)*B,V=j,j=R,L=L.next;var G=L;N+=j.x*(G.y-V.y);var Z=G.y*j.x-G.x*j.y;E.localCOMx+=(j.x+G.x)*Z,E.localCOMy+=(j.y+G.y)*Z,N=1/(3*N);var U=N;E.localCOMx*=U,E.localCOMy*=U}}null!=A.wrap_localCOM&&(A.wrap_localCOM.zpp_inner.x=A.localCOMx,A.wrap_localCOM.zpp_inner.y=A.localCOMy)}var q=A.body;q.zip_axis&&(q.zip_axis=!1,q.axisx=Math.sin(q.rot),q.axisy=Math.cos(q.rot)),A.worldCOMx=A.body.posx+(A.body.axisy*A.localCOMx-A.body.axisx*A.localCOMy),A.worldCOMy=A.body.posy+(A.localCOMx*A.body.axisx+A.localCOMy*A.body.axisy)}var Y=A.radius,K=A.radius;A.aabb.minx=A.worldCOMx-Y,A.aabb.miny=A.worldCOMy-K,A.aabb.maxx=A.worldCOMx+Y,A.aabb.maxy=A.worldCOMy+K}else{var W=T.polygon;if(W.zip_gverts&&null!=W.body){W.zip_gverts=!1,W.validate_lverts();var J=W.body;J.zip_axis&&(J.zip_axis=!1,J.axisx=Math.sin(J.rot),J.axisy=Math.cos(J.rot));for(var X=W.lverts.next,H=W.gverts.next;null!=H;){var Q=H,$=X;X=X.next,Q.x=W.body.posx+(W.body.axisy*$.x-W.body.axisx*$.y),Q.y=W.body.posy+($.x*W.body.axisx+$.y*W.body.axisy),H=H.next}}var nn=W.gverts.next;W.aabb.minx=nn.x,W.aabb.miny=nn.y,W.aabb.maxx=nn.x,W.aabb.maxy=nn.y;for(var en=W.gverts.next.next;null!=en;){var tn=en;W.aabb.minx>tn.x&&(W.aabb.minx=tn.x),tn.x>W.aabb.maxx&&(W.aabb.maxx=tn.x),W.aabb.miny>tn.y&&(W.aabb.miny=tn.y),tn.y>W.aabb.maxy&&(W.aabb.maxy=tn.y),en=en.next}}},shapesInCircle:function(n,e,i,t,l,p){return null},bodiesInCircle:function(n,e,i,t,l,p){return null},validateShape:function(n){if(n.type==me.id_ShapeType_POLYGON){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var i=e.body;if(i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var t=e.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var l=e.lverts.next,p=e.gverts.next;null!=p;){var r=p,a=l;l=l.next,r.x=e.body.posx+(e.body.axisy*a.x-e.body.axisx*a.y),r.y=e.body.posy+(a.x*e.body.axisx+a.y*e.body.axisy),p=p.next}}var s=e.edges.head,o=e.gverts.next,_=o;for(o=o.next;null!=o;){var h=o,u=s.elt;s=s.next,u.gp0=_,u.gp1=h,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,_=h,o=o.next}var x=e.gverts.next,d=s.elt;s=s.next,d.gp0=_,d.gp1=x,d.gnormx=e.body.axisy*d.lnormx-e.body.axisx*d.lnormy,d.gnormy=d.lnormx*e.body.axisx+d.lnormy*e.body.axisy,d.gprojection=e.body.posx*d.gnormx+e.body.posy*d.gnormy+d.lprojection,null!=d.wrap_gnorm&&(d.wrap_gnorm.zpp_inner.x=d.gnormx,d.wrap_gnorm.zpp_inner.y=d.gnormy),d.tp0=d.gp0.y*d.gnormx-d.gp0.x*d.gnormy,d.tp1=d.gp1.y*d.gnormx-d.gp1.x*d.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var v=n.circle;if(v.zip_worldCOM&&null!=v.body){if(v.zip_worldCOM=!1,v.zip_localCOM){if(v.zip_localCOM=!1,v.type==me.id_ShapeType_POLYGON){var z=v.polygon;if(null==z.lverts.next.next)z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y;else if(null==z.lverts.next.next.next){z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y;z.localCOMx+=1*z.lverts.next.next.x,z.localCOMy+=1*z.lverts.next.next.y;z.localCOMx*=.5,z.localCOMy*=.5}else{z.localCOMx=0,z.localCOMy=0;var c=0,m=z.lverts.next,y=m;m=m.next;var f=m;for(m=m.next;null!=m;){var b=m;c+=f.x*(b.y-y.y);var g=b.y*f.x-b.x*f.y;z.localCOMx+=(f.x+b.x)*g,z.localCOMy+=(f.y+b.y)*g,y=f,f=b,m=m.next}m=z.lverts.next;var w=m;c+=f.x*(w.y-y.y);var M=w.y*f.x-w.x*f.y;z.localCOMx+=(f.x+w.x)*M,z.localCOMy+=(f.y+w.y)*M,y=f,f=w,m=m.next;var C=m;c+=f.x*(C.y-y.y);var k=C.y*f.x-C.x*f.y;z.localCOMx+=(f.x+C.x)*k,z.localCOMy+=(f.y+C.y)*k,c=1/(3*c);var O=c;z.localCOMx*=O,z.localCOMy*=O}}null!=v.wrap_localCOM&&(v.wrap_localCOM.zpp_inner.x=v.localCOMx,v.wrap_localCOM.zpp_inner.y=v.localCOMy)}var I=v.body;I.zip_axis&&(I.zip_axis=!1,I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot)),v.worldCOMx=v.body.posx+(v.body.axisy*v.localCOMx-v.body.axisx*v.localCOMy),v.worldCOMy=v.body.posy+(v.localCOMx*v.body.axisx+v.localCOMy*v.body.axisy)}var S=v.radius,P=v.radius;v.aabb.minx=v.worldCOMx-S,v.aabb.miny=v.worldCOMy-P,v.aabb.maxx=v.worldCOMx+S,v.aabb.maxy=v.worldCOMy+P}else{var T=n.polygon;if(T.zip_gverts&&null!=T.body){T.zip_gverts=!1,T.validate_lverts();var A=T.body;A.zip_axis&&(A.zip_axis=!1,A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot));for(var E=T.lverts.next,N=T.gverts.next;null!=N;){var L=N,V=E;E=E.next,L.x=T.body.posx+(T.body.axisy*V.x-T.body.axisx*V.y),L.y=T.body.posy+(V.x*T.body.axisx+V.y*T.body.axisy),N=N.next}}var j=T.gverts.next;T.aabb.minx=j.x,T.aabb.miny=j.y,T.aabb.maxx=j.x,T.aabb.maxy=j.y;for(var D=T.gverts.next.next;null!=D;){var F=D;T.aabb.minx>F.x&&(T.aabb.minx=F.x),F.x>T.aabb.maxx&&(T.aabb.maxx=F.x),T.aabb.miny>F.y&&(T.aabb.miny=F.y),F.y>T.aabb.maxy&&(T.aabb.maxy=F.y),D=D.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,n.type==me.id_ShapeType_POLYGON){var R=n.polygon;if(null==R.lverts.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;else if(null==R.lverts.next.next.next){R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;R.localCOMx+=1*R.lverts.next.next.x,R.localCOMy+=1*R.lverts.next.next.y;R.localCOMx*=.5,R.localCOMy*=.5}else{R.localCOMx=0,R.localCOMy=0;var B=0,G=R.lverts.next,Z=G;G=G.next;var U=G;for(G=G.next;null!=G;){var q=G;B+=U.x*(q.y-Z.y);var Y=q.y*U.x-q.x*U.y;R.localCOMx+=(U.x+q.x)*Y,R.localCOMy+=(U.y+q.y)*Y,Z=U,U=q,G=G.next}G=R.lverts.next;var K=G;B+=U.x*(K.y-Z.y);var W=K.y*U.x-K.x*U.y;R.localCOMx+=(U.x+K.x)*W,R.localCOMy+=(U.y+K.y)*W,Z=U,U=K,G=G.next;var J=G;B+=U.x*(J.y-Z.y);var X=J.y*U.x-J.x*U.y;R.localCOMx+=(U.x+J.x)*X,R.localCOMy+=(U.y+J.y)*X,B=1/(3*B);var H=B;R.localCOMx*=H,R.localCOMy*=H}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var Q=n.body;Q.zip_axis&&(Q.zip_axis=!1,Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},shapesInShape:function(n,e,i,t){return null},bodiesInShape:function(n,e,i,t){return null},rayCast:function(n,e,i){return null},rayMultiCast:function(n,e,i,t){return null},__class__:Vi};var ji=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};l["zpp_nape.space.ZPP_AABBNode"]=ji,ji.__name__=["zpp_nape","space","ZPP_AABBNode"],ji.prototype={aabb:null,shape:null,dyn:null,parent:null,child1:null,child2:null,height:null,rayt:null,next:null,alloc:function(){null==qe.zpp_pool?this.aabb=new qe:(this.aabb=qe.zpp_pool,qe.zpp_pool=this.aabb.next,this.aabb.next=null);this.moved=!1,this.synced=!1,this.first_sync=!1},free:function(){this.height=-1;var n=this.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=qe.zpp_pool,qe.zpp_pool=n,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},mnext:null,moved:null,snext:null,synced:null,first_sync:null,isLeaf:function(){return null==this.child1},__class__:ji};var Di=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};l["zpp_nape.space.ZPP_AABBPair"]=Di,Di.__name__=["zpp_nape","space","ZPP_AABBPair"],Di.prototype={n1:null,n2:null,first:null,sleeping:null,id:null,di:null,arb:null,next:null,alloc:function(){},free:function(){this.n1=this.n2=null,this.sleeping=!1},__class__:Di};var Fi=function(){this.root=null};l["zpp_nape.space.ZPP_AABBTree"]=Fi,Fi.__name__=["zpp_nape","space","ZPP_AABBTree"],Fi.prototype={root:null,clear:function(){if(null!=this.root){var n=null;for(this.root.next=n,n=this.root;null!=n;){var e=n;n=e.next,e.next=null;var i=e;null==i.child1?(i.shape.node=null,i.shape.removedFromSpace(),i.shape=null):(null!=i.child1&&(i.child1.next=n,n=i.child1),null!=i.child2&&(i.child2.next=n,n=i.child2));var t=i;t.height=-1;var l=t.aabb;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l.wrap_min=l.wrap_max=null,l._invalidate=null,l._validate=null,l.next=qe.zpp_pool,qe.zpp_pool=l,t.child1=t.child2=t.parent=null,t.next=null,t.snext=null,t.mnext=null,t.next=ji.zpp_pool,ji.zpp_pool=t}this.root=null}},insertLeaf:function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,i=this.root;null!=i.child1;){var t=i.child1,l=i.child2,p=i.aabb,r=2*(p.maxx-p.minx+(p.maxy-p.miny)),a=Fi.tmpaabb,s=i.aabb;a.minx=e.minx>s.minx?s.minx:e.minx,a.miny=e.miny>s.miny?s.miny:e.miny,a.maxx=s.maxx>e.maxx?s.maxx:e.maxx,a.maxy=s.maxy>e.maxy?s.maxy:e.maxy;var o=Fi.tmpaabb,_=2*(o.maxx-o.minx+(o.maxy-o.miny)),h=2*_,u=2*(_-r),x=Fi.tmpaabb,d=t.aabb;x.minx=d.minx>e.minx?e.minx:d.minx,x.miny=d.miny>e.miny?e.miny:d.miny,x.maxx=e.maxx>d.maxx?e.maxx:d.maxx,x.maxy=e.maxy>d.maxy?e.maxy:d.maxy;var v;if(null==t.child1){var z=Fi.tmpaabb;v=2*(z.maxx-z.minx+(z.maxy-z.miny))+u}else{var c=t.aabb,m=2*(c.maxx-c.minx+(c.maxy-c.miny)),y=Fi.tmpaabb;v=2*(y.maxx-y.minx+(y.maxy-y.miny))-m+u}var f=Fi.tmpaabb,b=l.aabb;f.minx=b.minx>e.minx?e.minx:b.minx,f.miny=b.miny>e.miny?e.miny:b.miny,f.maxx=e.maxx>b.maxx?e.maxx:b.maxx,f.maxy=e.maxy>b.maxy?e.maxy:b.maxy;var g;if(null==l.child1){var w=Fi.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+u}else{var M=l.aabb,C=2*(M.maxx-M.minx+(M.maxy-M.miny)),k=Fi.tmpaabb;g=2*(k.maxx-k.minx+(k.maxy-k.miny))-C+u}if(v>h&&g>h)break;i=g>v?t:l}var O,I=i,S=I.parent;null==ji.zpp_pool?O=new ji:(O=ji.zpp_pool,ji.zpp_pool=O.next,O.next=null),null==qe.zpp_pool?O.aabb=new qe:(O.aabb=qe.zpp_pool,qe.zpp_pool=O.aabb.next,O.aabb.next=null);O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var P=O.aabb,T=I.aabb;for(P.minx=T.minx>e.minx?e.minx:T.minx,P.miny=T.miny>e.miny?e.miny:T.miny,P.maxx=e.maxx>T.maxx?e.maxx:T.maxx,P.maxy=e.maxy>T.maxy?e.maxy:T.maxy,O.height=I.height+1,null!=S?(S.child1==I?S.child1=O:S.child2=O,O.child1=I,O.child2=n,I.parent=O,n.parent=O):(O.child1=I,O.child2=n,I.parent=O,n.parent=O,this.root=O),i=n.parent;null!=i;){if(null==i.child1||2>i.height)i=i;else{var A=i.child1,E=i.child2,N=E.height-A.height;if(N>1){var L=E.child1,V=E.child2;if(E.child1=i,E.parent=i.parent,i.parent=E,null!=E.parent?E.parent.child1==i?E.parent.child1=E:E.parent.child2=E:this.root=E,L.height>V.height){E.child2=L,i.child2=V,V.parent=i;var j=i.aabb,D=A.aabb,F=V.aabb;j.minx=F.minx>D.minx?D.minx:F.minx,j.miny=F.miny>D.miny?D.miny:F.miny,j.maxx=D.maxx>F.maxx?D.maxx:F.maxx,j.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=E.aabb,B=i.aabb,G=L.aabb;R.minx=G.minx>B.minx?B.minx:G.minx,R.miny=G.miny>B.miny?B.miny:G.miny,R.maxx=B.maxx>G.maxx?B.maxx:G.maxx,R.maxy=B.maxy>G.maxy?B.maxy:G.maxy;var Z=A.height,U=V.height;i.height=1+(Z>U?Z:U);var q=i.height,Y=L.height;E.height=1+(q>Y?q:Y)}else{E.child2=V,i.child2=L,L.parent=i;var K=i.aabb,W=A.aabb,J=L.aabb;K.minx=J.minx>W.minx?W.minx:J.minx,K.miny=J.miny>W.miny?W.miny:J.miny,K.maxx=W.maxx>J.maxx?W.maxx:J.maxx,K.maxy=W.maxy>J.maxy?W.maxy:J.maxy;var X=E.aabb,H=i.aabb,Q=V.aabb;X.minx=Q.minx>H.minx?H.minx:Q.minx,X.miny=Q.miny>H.miny?H.miny:Q.miny,X.maxx=H.maxx>Q.maxx?H.maxx:Q.maxx,X.maxy=H.maxy>Q.maxy?H.maxy:Q.maxy;var $=A.height,nn=L.height;i.height=1+($>nn?$:nn);var en=i.height,tn=V.height;E.height=1+(en>tn?en:tn)}i=E}else if(-1>N){var ln=A.child1,pn=A.child2;if(A.child1=i,A.parent=i.parent,i.parent=A,null!=A.parent?A.parent.child1==i?A.parent.child1=A:A.parent.child2=A:this.root=A,ln.height>pn.height){A.child2=ln,i.child1=pn,pn.parent=i;var rn=i.aabb,an=E.aabb,sn=pn.aabb;rn.minx=sn.minx>an.minx?an.minx:sn.minx,rn.miny=sn.miny>an.miny?an.miny:sn.miny,rn.maxx=an.maxx>sn.maxx?an.maxx:sn.maxx,rn.maxy=an.maxy>sn.maxy?an.maxy:sn.maxy;var on=A.aabb,_n=i.aabb,hn=ln.aabb;on.minx=hn.minx>_n.minx?_n.minx:hn.minx,on.miny=hn.miny>_n.miny?_n.miny:hn.miny,on.maxx=_n.maxx>hn.maxx?_n.maxx:hn.maxx,on.maxy=_n.maxy>hn.maxy?_n.maxy:hn.maxy;var un=E.height,xn=pn.height;i.height=1+(un>xn?un:xn);var dn=i.height,vn=ln.height;A.height=1+(dn>vn?dn:vn)}else{A.child2=pn,i.child1=ln,ln.parent=i;var zn=i.aabb,cn=E.aabb,mn=ln.aabb;zn.minx=mn.minx>cn.minx?cn.minx:mn.minx,zn.miny=mn.miny>cn.miny?cn.miny:mn.miny,zn.maxx=cn.maxx>mn.maxx?cn.maxx:mn.maxx,zn.maxy=cn.maxy>mn.maxy?cn.maxy:mn.maxy;var yn=A.aabb,fn=i.aabb,bn=pn.aabb;yn.minx=bn.minx>fn.minx?fn.minx:bn.minx,yn.miny=bn.miny>fn.miny?fn.miny:bn.miny,yn.maxx=fn.maxx>bn.maxx?fn.maxx:bn.maxx,yn.maxy=fn.maxy>bn.maxy?fn.maxy:bn.maxy;var gn=E.height,wn=ln.height;i.height=1+(gn>wn?gn:wn);var Mn=i.height,Cn=pn.height;A.height=1+(Mn>Cn?Mn:Cn)}i=A}else i=i}var kn=i.child1,On=i.child2,In=kn.height,Sn=On.height;i.height=1+(In>Sn?In:Sn);var Pn=i.aabb,Tn=kn.aabb,An=On.aabb;Pn.minx=An.minx>Tn.minx?Tn.minx:An.minx,Pn.miny=An.miny>Tn.miny?Tn.miny:An.miny,Pn.maxx=Tn.maxx>An.maxx?Tn.maxx:An.maxx,Pn.maxy=Tn.maxy>An.maxy?Tn.maxy:An.maxy,i=i.parent}}},inlined_insertLeaf:function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,i=this.root;null!=i.child1;){var t=i.child1,l=i.child2,p=i.aabb,r=2*(p.maxx-p.minx+(p.maxy-p.miny)),a=Fi.tmpaabb,s=i.aabb;a.minx=e.minx>s.minx?s.minx:e.minx,a.miny=e.miny>s.miny?s.miny:e.miny,a.maxx=s.maxx>e.maxx?s.maxx:e.maxx,a.maxy=s.maxy>e.maxy?s.maxy:e.maxy;var o=Fi.tmpaabb,_=2*(o.maxx-o.minx+(o.maxy-o.miny)),h=2*_,u=2*(_-r),x=Fi.tmpaabb,d=t.aabb;x.minx=d.minx>e.minx?e.minx:d.minx,x.miny=d.miny>e.miny?e.miny:d.miny,x.maxx=e.maxx>d.maxx?e.maxx:d.maxx,x.maxy=e.maxy>d.maxy?e.maxy:d.maxy;var v;if(null==t.child1){var z=Fi.tmpaabb;v=2*(z.maxx-z.minx+(z.maxy-z.miny))+u}else{var c=t.aabb,m=2*(c.maxx-c.minx+(c.maxy-c.miny)),y=Fi.tmpaabb;v=2*(y.maxx-y.minx+(y.maxy-y.miny))-m+u}var f=Fi.tmpaabb,b=l.aabb;f.minx=b.minx>e.minx?e.minx:b.minx,f.miny=b.miny>e.miny?e.miny:b.miny,f.maxx=e.maxx>b.maxx?e.maxx:b.maxx,f.maxy=e.maxy>b.maxy?e.maxy:b.maxy;var g;if(null==l.child1){var w=Fi.tmpaabb;g=2*(w.maxx-w.minx+(w.maxy-w.miny))+u}else{var M=l.aabb,C=2*(M.maxx-M.minx+(M.maxy-M.miny)),k=Fi.tmpaabb;g=2*(k.maxx-k.minx+(k.maxy-k.miny))-C+u}if(v>h&&g>h)break;i=g>v?t:l}var O,I=i,S=I.parent;null==ji.zpp_pool?O=new ji:(O=ji.zpp_pool,ji.zpp_pool=O.next,O.next=null),null==qe.zpp_pool?O.aabb=new qe:(O.aabb=qe.zpp_pool,qe.zpp_pool=O.aabb.next,O.aabb.next=null);O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var P=O.aabb,T=I.aabb;for(P.minx=T.minx>e.minx?e.minx:T.minx,P.miny=T.miny>e.miny?e.miny:T.miny,P.maxx=e.maxx>T.maxx?e.maxx:T.maxx,P.maxy=e.maxy>T.maxy?e.maxy:T.maxy,O.height=I.height+1,null!=S?(S.child1==I?S.child1=O:S.child2=O,O.child1=I,O.child2=n,I.parent=O,n.parent=O):(O.child1=I,O.child2=n,I.parent=O,n.parent=O,this.root=O),i=n.parent;null!=i;){if(null==i.child1||2>i.height)i=i;else{var A=i.child1,E=i.child2,N=E.height-A.height;if(N>1){var L=E.child1,V=E.child2;if(E.child1=i,E.parent=i.parent,i.parent=E,null!=E.parent?E.parent.child1==i?E.parent.child1=E:E.parent.child2=E:this.root=E,L.height>V.height){E.child2=L,i.child2=V,V.parent=i;var j=i.aabb,D=A.aabb,F=V.aabb;j.minx=F.minx>D.minx?D.minx:F.minx,j.miny=F.miny>D.miny?D.miny:F.miny,j.maxx=D.maxx>F.maxx?D.maxx:F.maxx,j.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=E.aabb,B=i.aabb,G=L.aabb;R.minx=G.minx>B.minx?B.minx:G.minx,R.miny=G.miny>B.miny?B.miny:G.miny,R.maxx=B.maxx>G.maxx?B.maxx:G.maxx,R.maxy=B.maxy>G.maxy?B.maxy:G.maxy;var Z=A.height,U=V.height;i.height=1+(Z>U?Z:U);var q=i.height,Y=L.height;E.height=1+(q>Y?q:Y)}else{E.child2=V,i.child2=L,L.parent=i;var K=i.aabb,W=A.aabb,J=L.aabb;K.minx=J.minx>W.minx?W.minx:J.minx,K.miny=J.miny>W.miny?W.miny:J.miny,K.maxx=W.maxx>J.maxx?W.maxx:J.maxx,K.maxy=W.maxy>J.maxy?W.maxy:J.maxy;var X=E.aabb,H=i.aabb,Q=V.aabb;X.minx=Q.minx>H.minx?H.minx:Q.minx,X.miny=Q.miny>H.miny?H.miny:Q.miny,X.maxx=H.maxx>Q.maxx?H.maxx:Q.maxx,X.maxy=H.maxy>Q.maxy?H.maxy:Q.maxy;var $=A.height,nn=L.height;i.height=1+($>nn?$:nn);var en=i.height,tn=V.height;E.height=1+(en>tn?en:tn)}i=E}else if(-1>N){var ln=A.child1,pn=A.child2;if(A.child1=i,A.parent=i.parent,i.parent=A,null!=A.parent?A.parent.child1==i?A.parent.child1=A:A.parent.child2=A:this.root=A,ln.height>pn.height){A.child2=ln,i.child1=pn,pn.parent=i;var rn=i.aabb,an=E.aabb,sn=pn.aabb;rn.minx=sn.minx>an.minx?an.minx:sn.minx,rn.miny=sn.miny>an.miny?an.miny:sn.miny,rn.maxx=an.maxx>sn.maxx?an.maxx:sn.maxx,rn.maxy=an.maxy>sn.maxy?an.maxy:sn.maxy;var on=A.aabb,_n=i.aabb,hn=ln.aabb;on.minx=hn.minx>_n.minx?_n.minx:hn.minx,on.miny=hn.miny>_n.miny?_n.miny:hn.miny,on.maxx=_n.maxx>hn.maxx?_n.maxx:hn.maxx,on.maxy=_n.maxy>hn.maxy?_n.maxy:hn.maxy;var un=E.height,xn=pn.height;i.height=1+(un>xn?un:xn);var dn=i.height,vn=ln.height;A.height=1+(dn>vn?dn:vn)}else{A.child2=pn,i.child1=ln,ln.parent=i;var zn=i.aabb,cn=E.aabb,mn=ln.aabb;zn.minx=mn.minx>cn.minx?cn.minx:mn.minx,zn.miny=mn.miny>cn.miny?cn.miny:mn.miny,zn.maxx=cn.maxx>mn.maxx?cn.maxx:mn.maxx,zn.maxy=cn.maxy>mn.maxy?cn.maxy:mn.maxy;var yn=A.aabb,fn=i.aabb,bn=pn.aabb;yn.minx=bn.minx>fn.minx?fn.minx:bn.minx,yn.miny=bn.miny>fn.miny?fn.miny:bn.miny,yn.maxx=fn.maxx>bn.maxx?fn.maxx:bn.maxx,yn.maxy=fn.maxy>bn.maxy?fn.maxy:bn.maxy;var gn=E.height,wn=ln.height;i.height=1+(gn>wn?gn:wn);var Mn=i.height,Cn=pn.height;A.height=1+(Mn>Cn?Mn:Cn)}i=A}else i=i}var kn=i.child1,On=i.child2,In=kn.height,Sn=On.height;i.height=1+(In>Sn?In:Sn);var Pn=i.aabb,Tn=kn.aabb,An=On.aabb;Pn.minx=An.minx>Tn.minx?Tn.minx:An.minx,Pn.miny=An.miny>Tn.miny?Tn.miny:An.miny,Pn.maxx=Tn.maxx>An.maxx?Tn.maxx:An.maxx,Pn.maxy=Tn.maxy>An.maxy?Tn.maxy:An.maxy,i=i.parent}}},removeLeaf:function(n){if(n==this.root)this.root=null;else{var e=n.parent,i=e.parent,t=e.child1==n?e.child2:e.child1;if(null!=i){i.child1==e?i.child1=t:i.child2=t,t.parent=i;var l=e;l.height=-1;var p=l.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=qe.zpp_pool,qe.zpp_pool=p,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=ji.zpp_pool,ji.zpp_pool=l;for(var r=i;null!=r;){if(null==r.child1||2>r.height)r=r;else{var a=r.child1,s=r.child2,o=s.height-a.height;if(o>1){var _=s.child1,h=s.child2;if(s.child1=r,s.parent=r.parent,r.parent=s,null!=s.parent?s.parent.child1==r?s.parent.child1=s:s.parent.child2=s:this.root=s,_.height>h.height){s.child2=_,r.child2=h,h.parent=r;var u=r.aabb,x=a.aabb,d=h.aabb;u.minx=d.minx>x.minx?x.minx:d.minx,u.miny=d.miny>x.miny?x.miny:d.miny,u.maxx=x.maxx>d.maxx?x.maxx:d.maxx,u.maxy=x.maxy>d.maxy?x.maxy:d.maxy;var v=s.aabb,z=r.aabb,c=_.aabb;v.minx=c.minx>z.minx?z.minx:c.minx,v.miny=c.miny>z.miny?z.miny:c.miny,v.maxx=z.maxx>c.maxx?z.maxx:c.maxx,v.maxy=z.maxy>c.maxy?z.maxy:c.maxy;var m=a.height,y=h.height;r.height=1+(m>y?m:y);var f=r.height,b=_.height;s.height=1+(f>b?f:b)}else{s.child2=h,r.child2=_,_.parent=r;var g=r.aabb,w=a.aabb,M=_.aabb;g.minx=M.minx>w.minx?w.minx:M.minx,g.miny=M.miny>w.miny?w.miny:M.miny,g.maxx=w.maxx>M.maxx?w.maxx:M.maxx,g.maxy=w.maxy>M.maxy?w.maxy:M.maxy;var C=s.aabb,k=r.aabb,O=h.aabb;C.minx=O.minx>k.minx?k.minx:O.minx,C.miny=O.miny>k.miny?k.miny:O.miny,C.maxx=k.maxx>O.maxx?k.maxx:O.maxx,C.maxy=k.maxy>O.maxy?k.maxy:O.maxy;var I=a.height,S=_.height;r.height=1+(I>S?I:S);var P=r.height,T=h.height;s.height=1+(P>T?P:T)}r=s}else if(-1>o){var A=a.child1,E=a.child2;if(a.child1=r,a.parent=r.parent,r.parent=a,null!=a.parent?a.parent.child1==r?a.parent.child1=a:a.parent.child2=a:this.root=a,A.height>E.height){a.child2=A,r.child1=E,E.parent=r;var N=r.aabb,L=s.aabb,V=E.aabb;N.minx=V.minx>L.minx?L.minx:V.minx,N.miny=V.miny>L.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy;var j=a.aabb,D=r.aabb,F=A.aabb;j.minx=F.minx>D.minx?D.minx:F.minx,j.miny=F.miny>D.miny?D.miny:F.miny,j.maxx=D.maxx>F.maxx?D.maxx:F.maxx,j.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=s.height,B=E.height;r.height=1+(R>B?R:B);var G=r.height,Z=A.height;a.height=1+(G>Z?G:Z)}else{a.child2=E,r.child1=A,A.parent=r;var U=r.aabb,q=s.aabb,Y=A.aabb;U.minx=Y.minx>q.minx?q.minx:Y.minx,U.miny=Y.miny>q.miny?q.miny:Y.miny,U.maxx=q.maxx>Y.maxx?q.maxx:Y.maxx,U.maxy=q.maxy>Y.maxy?q.maxy:Y.maxy;var K=a.aabb,W=r.aabb,J=E.aabb;K.minx=J.minx>W.minx?W.minx:J.minx,K.miny=J.miny>W.miny?W.miny:J.miny,K.maxx=W.maxx>J.maxx?W.maxx:J.maxx,K.maxy=W.maxy>J.maxy?W.maxy:J.maxy;var X=s.height,H=A.height;r.height=1+(X>H?X:H);var Q=r.height,$=E.height;a.height=1+(Q>$?Q:$)}r=a}else r=r}var nn=r.child1,en=r.child2,tn=r.aabb,ln=nn.aabb,pn=en.aabb;tn.minx=pn.minx>ln.minx?ln.minx:pn.minx,tn.miny=pn.miny>ln.miny?ln.miny:pn.miny,tn.maxx=ln.maxx>pn.maxx?ln.maxx:pn.maxx,tn.maxy=ln.maxy>pn.maxy?ln.maxy:pn.maxy;var rn=nn.height,an=en.height;r.height=1+(rn>an?rn:an),r=r.parent}}else{this.root=t,t.parent=null;var sn=e;sn.height=-1;var on=sn.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=qe.zpp_pool,qe.zpp_pool=on,sn.child1=sn.child2=sn.parent=null,sn.next=null,sn.snext=null,sn.mnext=null,sn.next=ji.zpp_pool,ji.zpp_pool=sn}}},inlined_removeLeaf:function(n){if(n==this.root)return void(this.root=null);var e=n.parent,i=e.parent,t=e.child1==n?e.child2:e.child1;if(null!=i){i.child1==e?i.child1=t:i.child2=t,t.parent=i;var l=e;l.height=-1;var p=l.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=qe.zpp_pool,qe.zpp_pool=p,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=ji.zpp_pool,ji.zpp_pool=l;for(var r=i;null!=r;){if(null==r.child1||2>r.height)r=r;else{var a=r.child1,s=r.child2,o=s.height-a.height;if(o>1){var _=s.child1,h=s.child2;if(s.child1=r,s.parent=r.parent,r.parent=s,null!=s.parent?s.parent.child1==r?s.parent.child1=s:s.parent.child2=s:this.root=s,_.height>h.height){s.child2=_,r.child2=h,h.parent=r;var u=r.aabb,x=a.aabb,d=h.aabb;u.minx=d.minx>x.minx?x.minx:d.minx,u.miny=d.miny>x.miny?x.miny:d.miny,u.maxx=x.maxx>d.maxx?x.maxx:d.maxx,u.maxy=x.maxy>d.maxy?x.maxy:d.maxy;var v=s.aabb,z=r.aabb,c=_.aabb;v.minx=c.minx>z.minx?z.minx:c.minx,v.miny=c.miny>z.miny?z.miny:c.miny,v.maxx=z.maxx>c.maxx?z.maxx:c.maxx,v.maxy=z.maxy>c.maxy?z.maxy:c.maxy;var m=a.height,y=h.height;r.height=1+(m>y?m:y);var f=r.height,b=_.height;s.height=1+(f>b?f:b)}else{s.child2=h,r.child2=_,_.parent=r;var g=r.aabb,w=a.aabb,M=_.aabb;g.minx=M.minx>w.minx?w.minx:M.minx,g.miny=M.miny>w.miny?w.miny:M.miny,g.maxx=w.maxx>M.maxx?w.maxx:M.maxx,g.maxy=w.maxy>M.maxy?w.maxy:M.maxy;var C=s.aabb,k=r.aabb,O=h.aabb;C.minx=O.minx>k.minx?k.minx:O.minx,C.miny=O.miny>k.miny?k.miny:O.miny,C.maxx=k.maxx>O.maxx?k.maxx:O.maxx,C.maxy=k.maxy>O.maxy?k.maxy:O.maxy;var I=a.height,S=_.height;r.height=1+(I>S?I:S);var P=r.height,T=h.height;s.height=1+(P>T?P:T)}r=s}else if(-1>o){var A=a.child1,E=a.child2;if(a.child1=r,a.parent=r.parent,r.parent=a,null!=a.parent?a.parent.child1==r?a.parent.child1=a:a.parent.child2=a:this.root=a,A.height>E.height){a.child2=A,r.child1=E,E.parent=r;var N=r.aabb,L=s.aabb,V=E.aabb;N.minx=V.minx>L.minx?L.minx:V.minx,N.miny=V.miny>L.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy;var j=a.aabb,D=r.aabb,F=A.aabb;j.minx=F.minx>D.minx?D.minx:F.minx,j.miny=F.miny>D.miny?D.miny:F.miny,j.maxx=D.maxx>F.maxx?D.maxx:F.maxx,j.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=s.height,B=E.height;r.height=1+(R>B?R:B);var G=r.height,Z=A.height;a.height=1+(G>Z?G:Z)}else{a.child2=E,r.child1=A,A.parent=r;var U=r.aabb,q=s.aabb,Y=A.aabb;U.minx=Y.minx>q.minx?q.minx:Y.minx,U.miny=Y.miny>q.miny?q.miny:Y.miny,U.maxx=q.maxx>Y.maxx?q.maxx:Y.maxx,U.maxy=q.maxy>Y.maxy?q.maxy:Y.maxy;var K=a.aabb,W=r.aabb,J=E.aabb;K.minx=J.minx>W.minx?W.minx:J.minx,K.miny=J.miny>W.miny?W.miny:J.miny,K.maxx=W.maxx>J.maxx?W.maxx:J.maxx,K.maxy=W.maxy>J.maxy?W.maxy:J.maxy;var X=s.height,H=A.height;r.height=1+(X>H?X:H);var Q=r.height,$=E.height;a.height=1+(Q>$?Q:$)}r=a}else r=r}var nn=r.child1,en=r.child2,tn=r.aabb,ln=nn.aabb,pn=en.aabb;tn.minx=pn.minx>ln.minx?ln.minx:pn.minx,tn.miny=pn.miny>ln.miny?ln.miny:pn.miny,tn.maxx=ln.maxx>pn.maxx?ln.maxx:pn.maxx,tn.maxy=ln.maxy>pn.maxy?ln.maxy:pn.maxy;var rn=nn.height,an=en.height;r.height=1+(rn>an?rn:an),r=r.parent}}else{this.root=t,t.parent=null;var sn=e;sn.height=-1;var on=sn.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=qe.zpp_pool,qe.zpp_pool=on,sn.child1=sn.child2=sn.parent=null,sn.next=null,sn.snext=null,sn.mnext=null,sn.next=ji.zpp_pool,ji.zpp_pool=sn}},balance:function(n){if(null==n.child1||2>n.height)return n;var e=n.child1,i=n.child2,t=i.height-e.height;if(t>1){var l=i.child1,p=i.child2;if(i.child1=n,i.parent=n.parent,n.parent=i,null!=i.parent?i.parent.child1==n?i.parent.child1=i:i.parent.child2=i:this.root=i,l.height>p.height){i.child2=l,n.child2=p,p.parent=n;var r=n.aabb,a=e.aabb,s=p.aabb;r.minx=s.minx>a.minx?a.minx:s.minx,r.miny=s.miny>a.miny?a.miny:s.miny,r.maxx=a.maxx>s.maxx?a.maxx:s.maxx,r.maxy=a.maxy>s.maxy?a.maxy:s.maxy;var o=i.aabb,_=n.aabb,h=l.aabb;o.minx=h.minx>_.minx?_.minx:h.minx,o.miny=h.miny>_.miny?_.miny:h.miny,o.maxx=_.maxx>h.maxx?_.maxx:h.maxx,o.maxy=_.maxy>h.maxy?_.maxy:h.maxy;var u=e.height,x=p.height;n.height=1+(u>x?u:x);var d=n.height,v=l.height;i.height=1+(d>v?d:v)}else{i.child2=p,n.child2=l,l.parent=n;var z=n.aabb,c=e.aabb,m=l.aabb;z.minx=m.minx>c.minx?c.minx:m.minx,z.miny=m.miny>c.miny?c.miny:m.miny,z.maxx=c.maxx>m.maxx?c.maxx:m.maxx,z.maxy=c.maxy>m.maxy?c.maxy:m.maxy;var y=i.aabb,f=n.aabb,b=p.aabb;y.minx=b.minx>f.minx?f.minx:b.minx,y.miny=b.miny>f.miny?f.miny:b.miny,y.maxx=f.maxx>b.maxx?f.maxx:b.maxx,y.maxy=f.maxy>b.maxy?f.maxy:b.maxy;var g=e.height,w=l.height;n.height=1+(g>w?g:w);var M=n.height,C=p.height;i.height=1+(M>C?M:C)}return i}if(-1>t){var k=e.child1,O=e.child2;if(e.child1=n,e.parent=n.parent,n.parent=e,null!=e.parent?e.parent.child1==n?e.parent.child1=e:e.parent.child2=e:this.root=e,k.height>O.height){e.child2=k,n.child1=O,O.parent=n;var I=n.aabb,S=i.aabb,P=O.aabb;I.minx=P.minx>S.minx?S.minx:P.minx,I.miny=P.miny>S.miny?S.miny:P.miny,I.maxx=S.maxx>P.maxx?S.maxx:P.maxx,I.maxy=S.maxy>P.maxy?S.maxy:P.maxy;var T=e.aabb,A=n.aabb,E=k.aabb;T.minx=E.minx>A.minx?A.minx:E.minx,T.miny=E.miny>A.miny?A.miny:E.miny,T.maxx=A.maxx>E.maxx?A.maxx:E.maxx,T.maxy=A.maxy>E.maxy?A.maxy:E.maxy;var N=i.height,L=O.height;n.height=1+(N>L?N:L);var V=n.height,j=k.height;e.height=1+(V>j?V:j)}else{e.child2=O,n.child1=k,k.parent=n;var D=n.aabb,F=i.aabb,R=k.aabb;D.minx=R.minx>F.minx?F.minx:R.minx,D.miny=R.miny>F.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy;var B=e.aabb,G=n.aabb,Z=O.aabb;B.minx=Z.minx>G.minx?G.minx:Z.minx,B.miny=Z.miny>G.miny?G.miny:Z.miny,B.maxx=G.maxx>Z.maxx?G.maxx:Z.maxx,B.maxy=G.maxy>Z.maxy?G.maxy:Z.maxy;var U=i.height,q=k.height;n.height=1+(U>q?U:q);var Y=n.height,K=O.height;e.height=1+(Y>K?Y:K)}return e}return n},__class__:Fi};var Ri=function(n){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,Vi.call(this),this.space=n,this.is_sweep=!1,this.dynab=this,this.stree=new Fi,this.dtree=new Fi};l["zpp_nape.space.ZPP_DynAABBPhase"]=Ri,Ri.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],Ri.__super__=Vi,Ri.prototype=e(Vi.prototype,{stree:null,dtree:null,pairs:null,syncs:null,moves:null,dyn:function(n){return n.body.type!=me.id_BodyType_STATIC&&!n.body.component.sleeping},__insert:function(n){var e;null==ji.zpp_pool?e=new ji:(e=ji.zpp_pool,ji.zpp_pool=e.next,e.next=null),null==qe.zpp_pool?e.aabb=new qe:(e.aabb=qe.zpp_pool,qe.zpp_pool=e.aabb.next,e.aabb.next=null);e.moved=!1,e.synced=!1,e.first_sync=!1,e.shape=n,n.node=e,e.synced=!0,e.first_sync=!0,e.snext=this.syncs,this.syncs=e},__remove:function(n){var e=n.node;if(e.first_sync||(e.dyn?this.dtree.removeLeaf(e):this.stree.removeLeaf(e)),n.node=null,e.synced){for(var i=null,t=this.syncs;null!=t&&t!=e;)i=t,t=t.snext;null==i?this.syncs=t.snext:i.snext=t.snext,t.snext=null,e.synced=!1}if(e.moved){for(var l=null,p=this.moves;null!=p&&p!=e;)l=p,p=p.mnext;null==l?this.moves=p.mnext:l.mnext=p.mnext,p.mnext=null,e.moved=!1}for(var r=null,a=this.pairs;null!=a;){var s=a.next;if(a.n1!=e&&a.n2!=e)r=a,a=s;else{null==r?this.pairs=s:r.next=s,null!=a.arb&&(a.arb.pair=null),a.arb=null,a.n1.shape.pairs.remove(a),a.n2.shape.pairs.remove(a);var o=a;o.n1=o.n2=null,o.sleeping=!1,o.next=Di.zpp_pool,Di.zpp_pool=o,a=s}}for(;null!=n.pairs.head;){var _=n.pairs.pop_unsafe();_.n1==e?_.n2.shape.pairs.remove(_):_.n1.shape.pairs.remove(_),null!=_.arb&&(_.arb.pair=null),_.arb=null;var h=_;h.n1=h.n2=null,h.sleeping=!1,h.next=Di.zpp_pool,Di.zpp_pool=h}var u=e;u.height=-1;var x=u.aabb;null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x.wrap_min=x.wrap_max=null,x._invalidate=null,x._validate=null,x.next=qe.zpp_pool,qe.zpp_pool=x,u.child1=u.child2=u.parent=null,u.next=null,u.snext=null,u.mnext=null,u.next=ji.zpp_pool,ji.zpp_pool=u},__sync:function(n){var e=n.node;if(!e.synced){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var i=n.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,i.type==me.id_ShapeType_POLYGON){var t=i.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next){t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;t.localCOMx+=1*t.lverts.next.next.x,t.localCOMy+=1*t.lverts.next.next.y;t.localCOMx*=.5,t.localCOMy*=.5}else{t.localCOMx=0,t.localCOMy=0;var l=0,p=t.lverts.next,r=p;p=p.next;var a=p;for(p=p.next;null!=p;){var s=p;l+=a.x*(s.y-r.y);var o=s.y*a.x-s.x*a.y;t.localCOMx+=(a.x+s.x)*o,t.localCOMy+=(a.y+s.y)*o,r=a,a=s,p=p.next}p=t.lverts.next;var _=p;l+=a.x*(_.y-r.y);var h=_.y*a.x-_.x*a.y;t.localCOMx+=(a.x+_.x)*h,t.localCOMy+=(a.y+_.y)*h,r=a,a=_,p=p.next;var u=p;l+=a.x*(u.y-r.y);var x=u.y*a.x-u.x*a.y;t.localCOMx+=(a.x+u.x)*x,t.localCOMy+=(a.y+u.y)*x,l=1/(3*l);var d=l;t.localCOMx*=d,t.localCOMy*=d}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var v=i.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var z=i.radius,c=i.radius;i.aabb.minx=i.worldCOMx-z,i.aabb.miny=i.worldCOMy-c,i.aabb.maxx=i.worldCOMx+z,i.aabb.maxy=i.worldCOMy+c}else{var m=n.polygon;if(m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var y=m.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot));for(var f=m.lverts.next,b=m.gverts.next;null!=b;){var g=b,w=f;f=f.next,g.x=m.body.posx+(m.body.axisy*w.x-m.body.axisx*w.y),g.y=m.body.posy+(w.x*m.body.axisx+w.y*m.body.axisy),b=b.next}}var M=m.gverts.next;m.aabb.minx=M.x,m.aabb.miny=M.y,m.aabb.maxx=M.x,m.aabb.maxy=M.y;for(var C=m.gverts.next.next;null!=C;){var k=C;m.aabb.minx>k.x&&(m.aabb.minx=k.x),k.x>m.aabb.maxx&&(m.aabb.maxx=k.x),m.aabb.miny>k.y&&(m.aabb.miny=k.y),k.y>m.aabb.maxy&&(m.aabb.maxy=k.y),C=C.next}}var O;if(e.dyn==(n.body.type!=me.id_BodyType_STATIC&&!n.body.component.sleeping)){var I=e.aabb,S=n.aabb;O=!!(I.minx>S.minx||I.miny>S.miny||S.maxx>I.maxx||S.maxy>I.maxy)}else O=!0;O&&(e.synced=!0,e.snext=this.syncs,this.syncs=e)}},sync_broadphase:function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var n=this.syncs;null!=n;){var e=n.shape;if(n.first_sync)n.first_sync=!1;else{var i=n.dyn?this.dtree:this.stree;if(n==i.root)i.root=null;else{var t=n.parent,l=t.parent,p=t.child1==n?t.child2:t.child1;if(null!=l){l.child1==t?l.child1=p:l.child2=p,p.parent=l;var r=t;r.height=-1;var a=r.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=qe.zpp_pool,qe.zpp_pool=a,r.child1=r.child2=r.parent=null,r.next=null,r.snext=null,r.mnext=null,r.next=ji.zpp_pool,ji.zpp_pool=r;for(var s=l;null!=s;){if(null==s.child1||2>s.height)s=s;else{var o=s.child1,_=s.child2,h=_.height-o.height;if(h>1){var u=_.child1,x=_.child2;if(_.child1=s,_.parent=s.parent,s.parent=_,null!=_.parent?_.parent.child1==s?_.parent.child1=_:_.parent.child2=_:i.root=_,u.height>x.height){_.child2=u,s.child2=x,x.parent=s;var d=s.aabb,v=o.aabb,z=x.aabb;d.minx=z.minx>v.minx?v.minx:z.minx,d.miny=z.miny>v.miny?v.miny:z.miny,d.maxx=v.maxx>z.maxx?v.maxx:z.maxx,d.maxy=v.maxy>z.maxy?v.maxy:z.maxy;var c=_.aabb,m=s.aabb,y=u.aabb;c.minx=y.minx>m.minx?m.minx:y.minx,c.miny=y.miny>m.miny?m.miny:y.miny,c.maxx=m.maxx>y.maxx?m.maxx:y.maxx,c.maxy=m.maxy>y.maxy?m.maxy:y.maxy;var f=o.height,b=x.height;s.height=1+(f>b?f:b);var g=s.height,w=u.height;_.height=1+(g>w?g:w)}else{_.child2=x,s.child2=u,u.parent=s;var M=s.aabb,C=o.aabb,k=u.aabb;M.minx=k.minx>C.minx?C.minx:k.minx,M.miny=k.miny>C.miny?C.miny:k.miny,M.maxx=C.maxx>k.maxx?C.maxx:k.maxx,M.maxy=C.maxy>k.maxy?C.maxy:k.maxy;var O=_.aabb,I=s.aabb,S=x.aabb;O.minx=S.minx>I.minx?I.minx:S.minx,O.miny=S.miny>I.miny?I.miny:S.miny,O.maxx=I.maxx>S.maxx?I.maxx:S.maxx,O.maxy=I.maxy>S.maxy?I.maxy:S.maxy;var P=o.height,T=u.height;s.height=1+(P>T?P:T);var A=s.height,E=x.height;_.height=1+(A>E?A:E)}s=_}else if(-1>h){var N=o.child1,L=o.child2;if(o.child1=s,o.parent=s.parent,s.parent=o,null!=o.parent?o.parent.child1==s?o.parent.child1=o:o.parent.child2=o:i.root=o,N.height>L.height){o.child2=N,s.child1=L,L.parent=s;var V=s.aabb,j=_.aabb,D=L.aabb;V.minx=D.minx>j.minx?j.minx:D.minx,V.miny=D.miny>j.miny?j.miny:D.miny,V.maxx=j.maxx>D.maxx?j.maxx:D.maxx,V.maxy=j.maxy>D.maxy?j.maxy:D.maxy;var F=o.aabb,R=s.aabb,B=N.aabb;F.minx=B.minx>R.minx?R.minx:B.minx,F.miny=B.miny>R.miny?R.miny:B.miny,F.maxx=R.maxx>B.maxx?R.maxx:B.maxx,F.maxy=R.maxy>B.maxy?R.maxy:B.maxy;var G=_.height,Z=L.height;s.height=1+(G>Z?G:Z);var U=s.height,q=N.height;o.height=1+(U>q?U:q)}else{o.child2=L,s.child1=N,N.parent=s;var Y=s.aabb,K=_.aabb,W=N.aabb;Y.minx=W.minx>K.minx?K.minx:W.minx,Y.miny=W.miny>K.miny?K.miny:W.miny,Y.maxx=K.maxx>W.maxx?K.maxx:W.maxx,Y.maxy=K.maxy>W.maxy?K.maxy:W.maxy;var J=o.aabb,X=s.aabb,H=L.aabb;J.minx=H.minx>X.minx?X.minx:H.minx,J.miny=H.miny>X.miny?X.miny:H.miny,J.maxx=X.maxx>H.maxx?X.maxx:H.maxx,J.maxy=X.maxy>H.maxy?X.maxy:H.maxy;var Q=_.height,$=N.height;s.height=1+(Q>$?Q:$);var nn=s.height,en=L.height;o.height=1+(nn>en?nn:en)}s=o}else s=s}var tn=s.child1,ln=s.child2,pn=s.aabb,rn=tn.aabb,an=ln.aabb;pn.minx=an.minx>rn.minx?rn.minx:an.minx,pn.miny=an.miny>rn.miny?rn.miny:an.miny,pn.maxx=rn.maxx>an.maxx?rn.maxx:an.maxx,pn.maxy=rn.maxy>an.maxy?rn.maxy:an.maxy;var sn=tn.height,on=ln.height;s.height=1+(sn>on?sn:on),s=s.parent}}else{i.root=p,p.parent=null;var _n=t;_n.height=-1;var hn=_n.aabb;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn.wrap_min=hn.wrap_max=null,hn._invalidate=null,hn._validate=null,hn.next=qe.zpp_pool,qe.zpp_pool=hn,_n.child1=_n.child2=_n.parent=null,_n.next=null,_n.snext=null,_n.mnext=null,_n.next=ji.zpp_pool,ji.zpp_pool=_n}}}var un=n.aabb;if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,e.type==me.id_ShapeType_CIRCLE){var xn=e.circle;if(xn.zip_worldCOM&&null!=xn.body){if(xn.zip_worldCOM=!1,xn.zip_localCOM){if(xn.zip_localCOM=!1,xn.type==me.id_ShapeType_POLYGON){var dn=xn.polygon;if(null==dn.lverts.next.next)dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y;else if(null==dn.lverts.next.next.next){dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y;dn.localCOMx+=1*dn.lverts.next.next.x,dn.localCOMy+=1*dn.lverts.next.next.y;dn.localCOMx*=.5,dn.localCOMy*=.5}else{dn.localCOMx=0,dn.localCOMy=0;var vn=0,zn=dn.lverts.next,cn=zn;zn=zn.next;var mn=zn;for(zn=zn.next;null!=zn;){var yn=zn;vn+=mn.x*(yn.y-cn.y);var fn=yn.y*mn.x-yn.x*mn.y;dn.localCOMx+=(mn.x+yn.x)*fn,dn.localCOMy+=(mn.y+yn.y)*fn,cn=mn,mn=yn,zn=zn.next}zn=dn.lverts.next;var bn=zn;vn+=mn.x*(bn.y-cn.y);var gn=bn.y*mn.x-bn.x*mn.y;dn.localCOMx+=(mn.x+bn.x)*gn,dn.localCOMy+=(mn.y+bn.y)*gn,cn=mn,mn=bn,zn=zn.next;var wn=zn;vn+=mn.x*(wn.y-cn.y);var Mn=wn.y*mn.x-wn.x*mn.y;dn.localCOMx+=(mn.x+wn.x)*Mn,dn.localCOMy+=(mn.y+wn.y)*Mn,vn=1/(3*vn);var Cn=vn;dn.localCOMx*=Cn,dn.localCOMy*=Cn}}null!=xn.wrap_localCOM&&(xn.wrap_localCOM.zpp_inner.x=xn.localCOMx,xn.wrap_localCOM.zpp_inner.y=xn.localCOMy)}var kn=xn.body;kn.zip_axis&&(kn.zip_axis=!1,kn.axisx=Math.sin(kn.rot),kn.axisy=Math.cos(kn.rot)),xn.worldCOMx=xn.body.posx+(xn.body.axisy*xn.localCOMx-xn.body.axisx*xn.localCOMy),xn.worldCOMy=xn.body.posy+(xn.localCOMx*xn.body.axisx+xn.localCOMy*xn.body.axisy)}var On=xn.radius,In=xn.radius;xn.aabb.minx=xn.worldCOMx-On,xn.aabb.miny=xn.worldCOMy-In,xn.aabb.maxx=xn.worldCOMx+On,xn.aabb.maxy=xn.worldCOMy+In}else{var Sn=e.polygon;if(Sn.zip_gverts&&null!=Sn.body){Sn.zip_gverts=!1,Sn.validate_lverts();var Pn=Sn.body;Pn.zip_axis&&(Pn.zip_axis=!1,Pn.axisx=Math.sin(Pn.rot),Pn.axisy=Math.cos(Pn.rot));for(var Tn=Sn.lverts.next,An=Sn.gverts.next;null!=An;){var En=An,Nn=Tn;Tn=Tn.next,En.x=Sn.body.posx+(Sn.body.axisy*Nn.x-Sn.body.axisx*Nn.y),En.y=Sn.body.posy+(Nn.x*Sn.body.axisx+Nn.y*Sn.body.axisy),An=An.next}}var Ln=Sn.gverts.next;Sn.aabb.minx=Ln.x,Sn.aabb.miny=Ln.y,Sn.aabb.maxx=Ln.x,Sn.aabb.maxy=Ln.y;for(var Vn=Sn.gverts.next.next;null!=Vn;){var jn=Vn;Sn.aabb.minx>jn.x&&(Sn.aabb.minx=jn.x),jn.x>Sn.aabb.maxx&&(Sn.aabb.maxx=jn.x),Sn.aabb.miny>jn.y&&(Sn.aabb.miny=jn.y),jn.y>Sn.aabb.maxy&&(Sn.aabb.maxy=jn.y),Vn=Vn.next}}var Dn=e.aabb;un.minx=Dn.minx-3,un.miny=Dn.miny-3,un.maxx=Dn.maxx+3,un.maxy=Dn.maxy+3;var Fn=(n.dyn=e.body.type!=me.id_BodyType_STATIC&&!e.body.component.sleeping)?this.dtree:this.stree;if(null==Fn.root)Fn.root=n,Fn.root.parent=null;else{for(var Rn=n.aabb,Bn=Fn.root;null!=Bn.child1;){var Gn=Bn.child1,Zn=Bn.child2,Un=Bn.aabb,qn=2*(Un.maxx-Un.minx+(Un.maxy-Un.miny)),Yn=Fi.tmpaabb,Kn=Bn.aabb;Yn.minx=Rn.minx>Kn.minx?Kn.minx:Rn.minx,Yn.miny=Rn.miny>Kn.miny?Kn.miny:Rn.miny,Yn.maxx=Kn.maxx>Rn.maxx?Kn.maxx:Rn.maxx,Yn.maxy=Kn.maxy>Rn.maxy?Kn.maxy:Rn.maxy;var Wn=Fi.tmpaabb,Jn=2*(Wn.maxx-Wn.minx+(Wn.maxy-Wn.miny)),Xn=2*Jn,Hn=2*(Jn-qn),Qn=Fi.tmpaabb,$n=Gn.aabb;Qn.minx=$n.minx>Rn.minx?Rn.minx:$n.minx,Qn.miny=$n.miny>Rn.miny?Rn.miny:$n.miny,Qn.maxx=Rn.maxx>$n.maxx?Rn.maxx:$n.maxx,Qn.maxy=Rn.maxy>$n.maxy?Rn.maxy:$n.maxy;var ne;if(null==Gn.child1){var ee=Fi.tmpaabb;ne=2*(ee.maxx-ee.minx+(ee.maxy-ee.miny))+Hn}else{var ie=Gn.aabb,te=2*(ie.maxx-ie.minx+(ie.maxy-ie.miny)),le=Fi.tmpaabb,pe=2*(le.maxx-le.minx+(le.maxy-le.miny));ne=pe-te+Hn}var re=Fi.tmpaabb,ae=Zn.aabb;re.minx=ae.minx>Rn.minx?Rn.minx:ae.minx,re.miny=ae.miny>Rn.miny?Rn.miny:ae.miny,re.maxx=Rn.maxx>ae.maxx?Rn.maxx:ae.maxx,re.maxy=Rn.maxy>ae.maxy?Rn.maxy:ae.maxy;var se;if(null==Zn.child1){var oe=Fi.tmpaabb;se=2*(oe.maxx-oe.minx+(oe.maxy-oe.miny))+Hn}else{var _e=Zn.aabb,he=2*(_e.maxx-_e.minx+(_e.maxy-_e.miny)),ue=Fi.tmpaabb,xe=2*(ue.maxx-ue.minx+(ue.maxy-ue.miny));se=xe-he+Hn}if(ne>Xn&&se>Xn)break;Bn=se>ne?Gn:Zn}var de,ve=Bn,ze=ve.parent;null==ji.zpp_pool?de=new ji:(de=ji.zpp_pool,ji.zpp_pool=de.next,de.next=null),null==qe.zpp_pool?de.aabb=new qe:(de.aabb=qe.zpp_pool,qe.zpp_pool=de.aabb.next,de.aabb.next=null);de.moved=!1,de.synced=!1,de.first_sync=!1,de.parent=ze;var ce=de.aabb,ye=ve.aabb;for(ce.minx=ye.minx>Rn.minx?Rn.minx:ye.minx,ce.miny=ye.miny>Rn.miny?Rn.miny:ye.miny,ce.maxx=Rn.maxx>ye.maxx?Rn.maxx:ye.maxx,ce.maxy=Rn.maxy>ye.maxy?Rn.maxy:ye.maxy,de.height=ve.height+1,null!=ze?(ze.child1==ve?ze.child1=de:ze.child2=de,de.child1=ve,de.child2=n,ve.parent=de,n.parent=de):(de.child1=ve,de.child2=n,ve.parent=de,n.parent=de,Fn.root=de),Bn=n.parent;null!=Bn;){if(null==Bn.child1||2>Bn.height)Bn=Bn;else{var fe=Bn.child1,be=Bn.child2,ge=be.height-fe.height;if(ge>1){var we=be.child1,Me=be.child2;if(be.child1=Bn,be.parent=Bn.parent,Bn.parent=be,null!=be.parent?be.parent.child1==Bn?be.parent.child1=be:be.parent.child2=be:Fn.root=be,we.height>Me.height){be.child2=we,Bn.child2=Me,Me.parent=Bn;var Ce=Bn.aabb,ke=fe.aabb,Oe=Me.aabb;Ce.minx=Oe.minx>ke.minx?ke.minx:Oe.minx,Ce.miny=Oe.miny>ke.miny?ke.miny:Oe.miny,Ce.maxx=ke.maxx>Oe.maxx?ke.maxx:Oe.maxx,Ce.maxy=ke.maxy>Oe.maxy?ke.maxy:Oe.maxy;var Ie=be.aabb,Se=Bn.aabb,Pe=we.aabb;Ie.minx=Pe.minx>Se.minx?Se.minx:Pe.minx,Ie.miny=Pe.miny>Se.miny?Se.miny:Pe.miny,Ie.maxx=Se.maxx>Pe.maxx?Se.maxx:Pe.maxx,Ie.maxy=Se.maxy>Pe.maxy?Se.maxy:Pe.maxy;var Te=fe.height,Ae=Me.height;Bn.height=1+(Te>Ae?Te:Ae);var Ee=Bn.height,Ne=we.height;be.height=1+(Ee>Ne?Ee:Ne)}else{be.child2=Me,Bn.child2=we,we.parent=Bn;var Le=Bn.aabb,Ve=fe.aabb,je=we.aabb;Le.minx=je.minx>Ve.minx?Ve.minx:je.minx,Le.miny=je.miny>Ve.miny?Ve.miny:je.miny,Le.maxx=Ve.maxx>je.maxx?Ve.maxx:je.maxx,Le.maxy=Ve.maxy>je.maxy?Ve.maxy:je.maxy;var De=be.aabb,Fe=Bn.aabb,Re=Me.aabb;De.minx=Re.minx>Fe.minx?Fe.minx:Re.minx,De.miny=Re.miny>Fe.miny?Fe.miny:Re.miny,De.maxx=Fe.maxx>Re.maxx?Fe.maxx:Re.maxx,De.maxy=Fe.maxy>Re.maxy?Fe.maxy:Re.maxy;var Be=fe.height,Ge=we.height;Bn.height=1+(Be>Ge?Be:Ge);var Ze=Bn.height,Ue=Me.height;be.height=1+(Ze>Ue?Ze:Ue)}Bn=be}else if(-1>ge){var Ye=fe.child1,Ke=fe.child2;if(fe.child1=Bn,fe.parent=Bn.parent,Bn.parent=fe,null!=fe.parent?fe.parent.child1==Bn?fe.parent.child1=fe:fe.parent.child2=fe:Fn.root=fe,Ye.height>Ke.height){fe.child2=Ye,Bn.child1=Ke,Ke.parent=Bn;var We=Bn.aabb,Je=be.aabb,Xe=Ke.aabb;We.minx=Xe.minx>Je.minx?Je.minx:Xe.minx,We.miny=Xe.miny>Je.miny?Je.miny:Xe.miny,We.maxx=Je.maxx>Xe.maxx?Je.maxx:Xe.maxx,We.maxy=Je.maxy>Xe.maxy?Je.maxy:Xe.maxy;var He=fe.aabb,Qe=Bn.aabb,$e=Ye.aabb;He.minx=$e.minx>Qe.minx?Qe.minx:$e.minx,He.miny=$e.miny>Qe.miny?Qe.miny:$e.miny,He.maxx=Qe.maxx>$e.maxx?Qe.maxx:$e.maxx,He.maxy=Qe.maxy>$e.maxy?Qe.maxy:$e.maxy;var ni=be.height,ei=Ke.height;Bn.height=1+(ni>ei?ni:ei);var ii=Bn.height,ti=Ye.height;fe.height=1+(ii>ti?ii:ti)}else{fe.child2=Ke,Bn.child1=Ye,Ye.parent=Bn;var li=Bn.aabb,pi=be.aabb,ri=Ye.aabb;li.minx=ri.minx>pi.minx?pi.minx:ri.minx,li.miny=ri.miny>pi.miny?pi.miny:ri.miny,li.maxx=pi.maxx>ri.maxx?pi.maxx:ri.maxx,li.maxy=pi.maxy>ri.maxy?pi.maxy:ri.maxy;var ai=fe.aabb,si=Bn.aabb,oi=Ke.aabb;ai.minx=oi.minx>si.minx?si.minx:oi.minx,ai.miny=oi.miny>si.miny?si.miny:oi.miny,ai.maxx=si.maxx>oi.maxx?si.maxx:oi.maxx,ai.maxy=si.maxy>oi.maxy?si.maxy:oi.maxy;var _i=be.height,hi=Ye.height;Bn.height=1+(_i>hi?_i:hi);var ui=Bn.height,xi=Ke.height;fe.height=1+(ui>xi?ui:xi)}Bn=fe}else Bn=Bn}var di=Bn.child1,vi=Bn.child2,zi=di.height,ci=vi.height;Bn.height=1+(zi>ci?zi:ci);var mi=Bn.aabb,yi=di.aabb,fi=vi.aabb;mi.minx=fi.minx>yi.minx?yi.minx:fi.minx,mi.miny=fi.miny>yi.miny?yi.miny:fi.miny,mi.maxx=yi.maxx>fi.maxx?yi.maxx:fi.maxx,mi.maxy=yi.maxy>fi.maxy?yi.maxy:fi.maxy,Bn=Bn.parent}}n.synced=!1,n.moved=!0,n.mnext=n.snext,n.snext=null,n=n.mnext}var bi=this.syncs;this.syncs=this.moves,this.moves=bi}else for(;null!=this.syncs;){var gi=this.syncs;this.syncs=gi.snext,gi.snext=null;var wi=gi,Mi=wi.shape;if(wi.first_sync)wi.first_sync=!1;else{var Ci=wi.dyn?this.dtree:this.stree;if(wi==Ci.root)Ci.root=null;else{var ki=wi.parent,Oi=ki.parent,Ii=ki.child1==wi?ki.child2:ki.child1;if(null!=Oi){Oi.child1==ki?Oi.child1=Ii:Oi.child2=Ii,Ii.parent=Oi;var Si=ki;Si.height=-1;var Pi=Si.aabb;null!=Pi.outer&&(Pi.outer.zpp_inner=null,Pi.outer=null),Pi.wrap_min=Pi.wrap_max=null,Pi._invalidate=null,Pi._validate=null,Pi.next=qe.zpp_pool,qe.zpp_pool=Pi,Si.child1=Si.child2=Si.parent=null,Si.next=null,Si.snext=null,Si.mnext=null,Si.next=ji.zpp_pool,ji.zpp_pool=Si;for(var Ti=Oi;null!=Ti;){if(null==Ti.child1||2>Ti.height)Ti=Ti;else{var Ai=Ti.child1,Ei=Ti.child2,Ni=Ei.height-Ai.height;if(Ni>1){var Li=Ei.child1,Vi=Ei.child2;if(Ei.child1=Ti,Ei.parent=Ti.parent,Ti.parent=Ei,null!=Ei.parent?Ei.parent.child1==Ti?Ei.parent.child1=Ei:Ei.parent.child2=Ei:Ci.root=Ei,Li.height>Vi.height){Ei.child2=Li,Ti.child2=Vi,Vi.parent=Ti;var Di=Ti.aabb,Ri=Ai.aabb,Bi=Vi.aabb;Di.minx=Bi.minx>Ri.minx?Ri.minx:Bi.minx,Di.miny=Bi.miny>Ri.miny?Ri.miny:Bi.miny,Di.maxx=Ri.maxx>Bi.maxx?Ri.maxx:Bi.maxx,Di.maxy=Ri.maxy>Bi.maxy?Ri.maxy:Bi.maxy;var Gi=Ei.aabb,Zi=Ti.aabb,Ui=Li.aabb;Gi.minx=Ui.minx>Zi.minx?Zi.minx:Ui.minx,Gi.miny=Ui.miny>Zi.miny?Zi.miny:Ui.miny,Gi.maxx=Zi.maxx>Ui.maxx?Zi.maxx:Ui.maxx,Gi.maxy=Zi.maxy>Ui.maxy?Zi.maxy:Ui.maxy;var qi=Ai.height,Yi=Vi.height;Ti.height=1+(qi>Yi?qi:Yi);var Ki=Ti.height,Wi=Li.height;Ei.height=1+(Ki>Wi?Ki:Wi)}else{Ei.child2=Vi,Ti.child2=Li,Li.parent=Ti;var Ji=Ti.aabb,Xi=Ai.aabb,Hi=Li.aabb;Ji.minx=Hi.minx>Xi.minx?Xi.minx:Hi.minx,Ji.miny=Hi.miny>Xi.miny?Xi.miny:Hi.miny,Ji.maxx=Xi.maxx>Hi.maxx?Xi.maxx:Hi.maxx,Ji.maxy=Xi.maxy>Hi.maxy?Xi.maxy:Hi.maxy;var Qi=Ei.aabb,$i=Ti.aabb,nt=Vi.aabb;Qi.minx=nt.minx>$i.minx?$i.minx:nt.minx,Qi.miny=nt.miny>$i.miny?$i.miny:nt.miny,Qi.maxx=$i.maxx>nt.maxx?$i.maxx:nt.maxx,Qi.maxy=$i.maxy>nt.maxy?$i.maxy:nt.maxy;var et=Ai.height,it=Li.height;Ti.height=1+(et>it?et:it);var tt=Ti.height,lt=Vi.height;Ei.height=1+(tt>lt?tt:lt)}Ti=Ei}else if(-1>Ni){var pt=Ai.child1,rt=Ai.child2;if(Ai.child1=Ti,Ai.parent=Ti.parent,Ti.parent=Ai,null!=Ai.parent?Ai.parent.child1==Ti?Ai.parent.child1=Ai:Ai.parent.child2=Ai:Ci.root=Ai,pt.height>rt.height){Ai.child2=pt,Ti.child1=rt,rt.parent=Ti;var at=Ti.aabb,st=Ei.aabb,ot=rt.aabb;at.minx=ot.minx>st.minx?st.minx:ot.minx,at.miny=ot.miny>st.miny?st.miny:ot.miny,at.maxx=st.maxx>ot.maxx?st.maxx:ot.maxx,at.maxy=st.maxy>ot.maxy?st.maxy:ot.maxy;var _t=Ai.aabb,ht=Ti.aabb,ut=pt.aabb;_t.minx=ut.minx>ht.minx?ht.minx:ut.minx,_t.miny=ut.miny>ht.miny?ht.miny:ut.miny,_t.maxx=ht.maxx>ut.maxx?ht.maxx:ut.maxx,_t.maxy=ht.maxy>ut.maxy?ht.maxy:ut.maxy;var xt=Ei.height,dt=rt.height;Ti.height=1+(xt>dt?xt:dt);var vt=Ti.height,zt=pt.height;Ai.height=1+(vt>zt?vt:zt)}else{Ai.child2=rt,Ti.child1=pt,pt.parent=Ti;var ct=Ti.aabb,mt=Ei.aabb,yt=pt.aabb;ct.minx=yt.minx>mt.minx?mt.minx:yt.minx,ct.miny=yt.miny>mt.miny?mt.miny:yt.miny,ct.maxx=mt.maxx>yt.maxx?mt.maxx:yt.maxx,ct.maxy=mt.maxy>yt.maxy?mt.maxy:yt.maxy;var ft=Ai.aabb,bt=Ti.aabb,gt=rt.aabb;ft.minx=gt.minx>bt.minx?bt.minx:gt.minx,ft.miny=gt.miny>bt.miny?bt.miny:gt.miny,ft.maxx=bt.maxx>gt.maxx?bt.maxx:gt.maxx,ft.maxy=bt.maxy>gt.maxy?bt.maxy:gt.maxy;var wt=Ei.height,Mt=pt.height;Ti.height=1+(wt>Mt?wt:Mt);var Ct=Ti.height,kt=rt.height;Ai.height=1+(Ct>kt?Ct:kt)}Ti=Ai}else Ti=Ti}var Ot=Ti.child1,It=Ti.child2,St=Ti.aabb,Pt=Ot.aabb,Tt=It.aabb;St.minx=Tt.minx>Pt.minx?Pt.minx:Tt.minx,St.miny=Tt.miny>Pt.miny?Pt.miny:Tt.miny,St.maxx=Pt.maxx>Tt.maxx?Pt.maxx:Tt.maxx,St.maxy=Pt.maxy>Tt.maxy?Pt.maxy:Tt.maxy;var At=Ot.height,Et=It.height;Ti.height=1+(At>Et?At:Et),Ti=Ti.parent}}else{Ci.root=Ii,Ii.parent=null;var Nt=ki;Nt.height=-1;var Lt=Nt.aabb;null!=Lt.outer&&(Lt.outer.zpp_inner=null,Lt.outer=null),Lt.wrap_min=Lt.wrap_max=null,Lt._invalidate=null,Lt._validate=null,Lt.next=qe.zpp_pool,qe.zpp_pool=Lt,Nt.child1=Nt.child2=Nt.parent=null,Nt.next=null,Nt.snext=null,Nt.mnext=null,Nt.next=ji.zpp_pool,ji.zpp_pool=Nt}}}var Vt=wi.aabb;if(!this.space.continuous&&Mi.zip_aabb&&null!=Mi.body)if(Mi.zip_aabb=!1,Mi.type==me.id_ShapeType_CIRCLE){var jt=Mi.circle;if(jt.zip_worldCOM&&null!=jt.body){if(jt.zip_worldCOM=!1,jt.zip_localCOM){if(jt.zip_localCOM=!1,jt.type==me.id_ShapeType_POLYGON){var Dt=jt.polygon;if(null==Dt.lverts.next.next)Dt.localCOMx=Dt.lverts.next.x,Dt.localCOMy=Dt.lverts.next.y;else if(null==Dt.lverts.next.next.next){Dt.localCOMx=Dt.lverts.next.x,Dt.localCOMy=Dt.lverts.next.y;Dt.localCOMx+=1*Dt.lverts.next.next.x,Dt.localCOMy+=1*Dt.lverts.next.next.y;Dt.localCOMx*=.5,Dt.localCOMy*=.5}else{Dt.localCOMx=0,Dt.localCOMy=0;var Ft=0,Rt=Dt.lverts.next,Bt=Rt;Rt=Rt.next;var Gt=Rt;for(Rt=Rt.next;null!=Rt;){var Zt=Rt;Ft+=Gt.x*(Zt.y-Bt.y);var Ut=Zt.y*Gt.x-Zt.x*Gt.y;Dt.localCOMx+=(Gt.x+Zt.x)*Ut,Dt.localCOMy+=(Gt.y+Zt.y)*Ut,Bt=Gt,Gt=Zt,Rt=Rt.next}Rt=Dt.lverts.next;var qt=Rt;Ft+=Gt.x*(qt.y-Bt.y);var Yt=qt.y*Gt.x-qt.x*Gt.y;Dt.localCOMx+=(Gt.x+qt.x)*Yt,Dt.localCOMy+=(Gt.y+qt.y)*Yt,Bt=Gt,Gt=qt,Rt=Rt.next;var Kt=Rt;Ft+=Gt.x*(Kt.y-Bt.y);var Wt=Kt.y*Gt.x-Kt.x*Gt.y;Dt.localCOMx+=(Gt.x+Kt.x)*Wt,Dt.localCOMy+=(Gt.y+Kt.y)*Wt,Ft=1/(3*Ft);var Jt=Ft;Dt.localCOMx*=Jt,Dt.localCOMy*=Jt}}null!=jt.wrap_localCOM&&(jt.wrap_localCOM.zpp_inner.x=jt.localCOMx,jt.wrap_localCOM.zpp_inner.y=jt.localCOMy)}var Xt=jt.body;Xt.zip_axis&&(Xt.zip_axis=!1,Xt.axisx=Math.sin(Xt.rot),Xt.axisy=Math.cos(Xt.rot)),jt.worldCOMx=jt.body.posx+(jt.body.axisy*jt.localCOMx-jt.body.axisx*jt.localCOMy),jt.worldCOMy=jt.body.posy+(jt.localCOMx*jt.body.axisx+jt.localCOMy*jt.body.axisy)}var Ht=jt.radius,Qt=jt.radius;jt.aabb.minx=jt.worldCOMx-Ht,jt.aabb.miny=jt.worldCOMy-Qt,jt.aabb.maxx=jt.worldCOMx+Ht,jt.aabb.maxy=jt.worldCOMy+Qt}else{var $t=Mi.polygon;if($t.zip_gverts&&null!=$t.body){$t.zip_gverts=!1,$t.validate_lverts();var nl=$t.body;nl.zip_axis&&(nl.zip_axis=!1,nl.axisx=Math.sin(nl.rot),nl.axisy=Math.cos(nl.rot));for(var el=$t.lverts.next,il=$t.gverts.next;null!=il;){var tl=il,ll=el;el=el.next,tl.x=$t.body.posx+($t.body.axisy*ll.x-$t.body.axisx*ll.y),tl.y=$t.body.posy+(ll.x*$t.body.axisx+ll.y*$t.body.axisy),il=il.next}}var pl=$t.gverts.next;$t.aabb.minx=pl.x,$t.aabb.miny=pl.y,$t.aabb.maxx=pl.x,$t.aabb.maxy=pl.y;for(var rl=$t.gverts.next.next;null!=rl;){var al=rl;$t.aabb.minx>al.x&&($t.aabb.minx=al.x),al.x>$t.aabb.maxx&&($t.aabb.maxx=al.x),$t.aabb.miny>al.y&&($t.aabb.miny=al.y),al.y>$t.aabb.maxy&&($t.aabb.maxy=al.y),rl=rl.next}}var sl=Mi.aabb;Vt.minx=sl.minx-3,Vt.miny=sl.miny-3,Vt.maxx=sl.maxx+3,Vt.maxy=sl.maxy+3;var ol=(wi.dyn=Mi.body.type!=me.id_BodyType_STATIC&&!Mi.body.component.sleeping)?this.dtree:this.stree;if(null==ol.root)ol.root=wi,ol.root.parent=null;else{for(var _l=wi.aabb,hl=ol.root;null!=hl.child1;){var ul=hl.child1,xl=hl.child2,dl=hl.aabb,vl=2*(dl.maxx-dl.minx+(dl.maxy-dl.miny)),zl=Fi.tmpaabb,cl=hl.aabb;zl.minx=_l.minx>cl.minx?cl.minx:_l.minx,zl.miny=_l.miny>cl.miny?cl.miny:_l.miny,zl.maxx=cl.maxx>_l.maxx?cl.maxx:_l.maxx,zl.maxy=cl.maxy>_l.maxy?cl.maxy:_l.maxy;var ml=Fi.tmpaabb,yl=2*(ml.maxx-ml.minx+(ml.maxy-ml.miny)),fl=2*yl,bl=2*(yl-vl),gl=Fi.tmpaabb,wl=ul.aabb;gl.minx=wl.minx>_l.minx?_l.minx:wl.minx,gl.miny=wl.miny>_l.miny?_l.miny:wl.miny,gl.maxx=_l.maxx>wl.maxx?_l.maxx:wl.maxx,gl.maxy=_l.maxy>wl.maxy?_l.maxy:wl.maxy;var Ml;if(null==ul.child1){var Cl=Fi.tmpaabb;Ml=2*(Cl.maxx-Cl.minx+(Cl.maxy-Cl.miny))+bl}else{var kl=ul.aabb,Ol=2*(kl.maxx-kl.minx+(kl.maxy-kl.miny)),Il=Fi.tmpaabb,Sl=2*(Il.maxx-Il.minx+(Il.maxy-Il.miny));Ml=Sl-Ol+bl}var Pl=Fi.tmpaabb,Tl=xl.aabb;Pl.minx=Tl.minx>_l.minx?_l.minx:Tl.minx,Pl.miny=Tl.miny>_l.miny?_l.miny:Tl.miny,Pl.maxx=_l.maxx>Tl.maxx?_l.maxx:Tl.maxx,Pl.maxy=_l.maxy>Tl.maxy?_l.maxy:Tl.maxy;var Al;if(null==xl.child1){var El=Fi.tmpaabb;Al=2*(El.maxx-El.minx+(El.maxy-El.miny))+bl}else{var Nl=xl.aabb,Ll=2*(Nl.maxx-Nl.minx+(Nl.maxy-Nl.miny)),Vl=Fi.tmpaabb,jl=2*(Vl.maxx-Vl.minx+(Vl.maxy-Vl.miny));Al=jl-Ll+bl}if(Ml>fl&&Al>fl)break;hl=Al>Ml?ul:xl}var Dl,Fl=hl,Rl=Fl.parent;null==ji.zpp_pool?Dl=new ji:(Dl=ji.zpp_pool,ji.zpp_pool=Dl.next,Dl.next=null),null==qe.zpp_pool?Dl.aabb=new qe:(Dl.aabb=qe.zpp_pool,qe.zpp_pool=Dl.aabb.next,Dl.aabb.next=null);Dl.moved=!1,Dl.synced=!1,Dl.first_sync=!1,Dl.parent=Rl;var Bl=Dl.aabb,Gl=Fl.aabb;for(Bl.minx=Gl.minx>_l.minx?_l.minx:Gl.minx,Bl.miny=Gl.miny>_l.miny?_l.miny:Gl.miny,Bl.maxx=_l.maxx>Gl.maxx?_l.maxx:Gl.maxx,Bl.maxy=_l.maxy>Gl.maxy?_l.maxy:Gl.maxy,Dl.height=Fl.height+1,null!=Rl?(Rl.child1==Fl?Rl.child1=Dl:Rl.child2=Dl,Dl.child1=Fl,Dl.child2=wi,Fl.parent=Dl,wi.parent=Dl):(Dl.child1=Fl,Dl.child2=wi,Fl.parent=Dl,wi.parent=Dl,ol.root=Dl),hl=wi.parent;null!=hl;){if(null==hl.child1||2>hl.height)hl=hl;else{var Zl=hl.child1,Ul=hl.child2,ql=Ul.height-Zl.height;if(ql>1){var Yl=Ul.child1,Kl=Ul.child2;if(Ul.child1=hl,Ul.parent=hl.parent,hl.parent=Ul,null!=Ul.parent?Ul.parent.child1==hl?Ul.parent.child1=Ul:Ul.parent.child2=Ul:ol.root=Ul,Yl.height>Kl.height){Ul.child2=Yl,hl.child2=Kl,Kl.parent=hl;var Wl=hl.aabb,Jl=Zl.aabb,Xl=Kl.aabb;Wl.minx=Xl.minx>Jl.minx?Jl.minx:Xl.minx,Wl.miny=Xl.miny>Jl.miny?Jl.miny:Xl.miny,Wl.maxx=Jl.maxx>Xl.maxx?Jl.maxx:Xl.maxx,Wl.maxy=Jl.maxy>Xl.maxy?Jl.maxy:Xl.maxy;var Hl=Ul.aabb,Ql=hl.aabb,$l=Yl.aabb;Hl.minx=$l.minx>Ql.minx?Ql.minx:$l.minx,Hl.miny=$l.miny>Ql.miny?Ql.miny:$l.miny,Hl.maxx=Ql.maxx>$l.maxx?Ql.maxx:$l.maxx,Hl.maxy=Ql.maxy>$l.maxy?Ql.maxy:$l.maxy;var np=Zl.height,ep=Kl.height;hl.height=1+(np>ep?np:ep);var ip=hl.height,tp=Yl.height;Ul.height=1+(ip>tp?ip:tp)}else{Ul.child2=Kl,hl.child2=Yl,Yl.parent=hl;var lp=hl.aabb,pp=Zl.aabb,rp=Yl.aabb;lp.minx=rp.minx>pp.minx?pp.minx:rp.minx,lp.miny=rp.miny>pp.miny?pp.miny:rp.miny,lp.maxx=pp.maxx>rp.maxx?pp.maxx:rp.maxx,lp.maxy=pp.maxy>rp.maxy?pp.maxy:rp.maxy;var ap=Ul.aabb,sp=hl.aabb,op=Kl.aabb;ap.minx=op.minx>sp.minx?sp.minx:op.minx,ap.miny=op.miny>sp.miny?sp.miny:op.miny,ap.maxx=sp.maxx>op.maxx?sp.maxx:op.maxx,ap.maxy=sp.maxy>op.maxy?sp.maxy:op.maxy;var _p=Zl.height,hp=Yl.height;hl.height=1+(_p>hp?_p:hp);var up=hl.height,xp=Kl.height;Ul.height=1+(up>xp?up:xp)}hl=Ul}else if(-1>ql){var dp=Zl.child1,vp=Zl.child2;if(Zl.child1=hl,Zl.parent=hl.parent,hl.parent=Zl,null!=Zl.parent?Zl.parent.child1==hl?Zl.parent.child1=Zl:Zl.parent.child2=Zl:ol.root=Zl,dp.height>vp.height){Zl.child2=dp,hl.child1=vp,vp.parent=hl;var zp=hl.aabb,cp=Ul.aabb,mp=vp.aabb;zp.minx=mp.minx>cp.minx?cp.minx:mp.minx,zp.miny=mp.miny>cp.miny?cp.miny:mp.miny,zp.maxx=cp.maxx>mp.maxx?cp.maxx:mp.maxx,zp.maxy=cp.maxy>mp.maxy?cp.maxy:mp.maxy;var yp=Zl.aabb,fp=hl.aabb,bp=dp.aabb;yp.minx=bp.minx>fp.minx?fp.minx:bp.minx,yp.miny=bp.miny>fp.miny?fp.miny:bp.miny,yp.maxx=fp.maxx>bp.maxx?fp.maxx:bp.maxx,yp.maxy=fp.maxy>bp.maxy?fp.maxy:bp.maxy;var gp=Ul.height,wp=vp.height;hl.height=1+(gp>wp?gp:wp);var Mp=hl.height,Cp=dp.height;Zl.height=1+(Mp>Cp?Mp:Cp)}else{Zl.child2=vp,hl.child1=dp,dp.parent=hl;var kp=hl.aabb,Op=Ul.aabb,Ip=dp.aabb;kp.minx=Ip.minx>Op.minx?Op.minx:Ip.minx,kp.miny=Ip.miny>Op.miny?Op.miny:Ip.miny,kp.maxx=Op.maxx>Ip.maxx?Op.maxx:Ip.maxx,kp.maxy=Op.maxy>Ip.maxy?Op.maxy:Ip.maxy;var Sp=Zl.aabb,Pp=hl.aabb,Tp=vp.aabb;Sp.minx=Tp.minx>Pp.minx?Pp.minx:Tp.minx,Sp.miny=Tp.miny>Pp.miny?Pp.miny:Tp.miny,Sp.maxx=Pp.maxx>Tp.maxx?Pp.maxx:Tp.maxx,Sp.maxy=Pp.maxy>Tp.maxy?Pp.maxy:Tp.maxy;var Ap=Ul.height,Ep=dp.height;hl.height=1+(Ap>Ep?Ap:Ep);var Np=hl.height,Lp=vp.height;Zl.height=1+(Np>Lp?Np:Lp)}hl=Zl}else hl=hl}var Vp=hl.child1,jp=hl.child2,Dp=Vp.height,Fp=jp.height;hl.height=1+(Dp>Fp?Dp:Fp);var Rp=hl.aabb,Bp=Vp.aabb,Gp=jp.aabb;Rp.minx=Gp.minx>Bp.minx?Bp.minx:Gp.minx,Rp.miny=Gp.miny>Bp.miny?Bp.miny:Gp.miny,Rp.maxx=Bp.maxx>Gp.maxx?Bp.maxx:Gp.maxx,Rp.maxy=Bp.maxy>Gp.maxy?Bp.maxy:Gp.maxy,hl=hl.parent}}wi.synced=!1,wi.moved||(wi.moved=!0,wi.mnext=this.moves,this.moves=wi)}},broadphase:function(n,e){for(var i=this.syncs;null!=i;){var t=i.shape;if(i.first_sync)i.first_sync=!1;else{var l=i.dyn?this.dtree:this.stree;if(i==l.root)l.root=null;else{var p=i.parent,r=p.parent,a=p.child1==i?p.child2:p.child1;if(null!=r){r.child1==p?r.child1=a:r.child2=a,a.parent=r;var s=p;s.height=-1;var o=s.aabb;null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o.wrap_min=o.wrap_max=null,o._invalidate=null,o._validate=null,o.next=qe.zpp_pool,qe.zpp_pool=o,s.child1=s.child2=s.parent=null,s.next=null,s.snext=null,s.mnext=null,s.next=ji.zpp_pool,ji.zpp_pool=s;for(var _=r;null!=_;){if(null==_.child1||2>_.height)_=_;else{var h=_.child1,u=_.child2,x=u.height-h.height;if(x>1){var d=u.child1,v=u.child2;if(u.child1=_,u.parent=_.parent,_.parent=u,null!=u.parent?u.parent.child1==_?u.parent.child1=u:u.parent.child2=u:l.root=u,d.height>v.height){u.child2=d,_.child2=v,v.parent=_;var z=_.aabb,c=h.aabb,m=v.aabb;z.minx=m.minx>c.minx?c.minx:m.minx,z.miny=m.miny>c.miny?c.miny:m.miny,z.maxx=c.maxx>m.maxx?c.maxx:m.maxx,z.maxy=c.maxy>m.maxy?c.maxy:m.maxy;var y=u.aabb,f=_.aabb,b=d.aabb;y.minx=b.minx>f.minx?f.minx:b.minx,y.miny=b.miny>f.miny?f.miny:b.miny,y.maxx=f.maxx>b.maxx?f.maxx:b.maxx,y.maxy=f.maxy>b.maxy?f.maxy:b.maxy;var g=h.height,w=v.height;_.height=1+(g>w?g:w);var M=_.height,C=d.height;u.height=1+(M>C?M:C)}else{u.child2=v,_.child2=d,d.parent=_;var k=_.aabb,O=h.aabb,I=d.aabb;k.minx=I.minx>O.minx?O.minx:I.minx,k.miny=I.miny>O.miny?O.miny:I.miny,k.maxx=O.maxx>I.maxx?O.maxx:I.maxx,k.maxy=O.maxy>I.maxy?O.maxy:I.maxy;var S=u.aabb,P=_.aabb,T=v.aabb;S.minx=T.minx>P.minx?P.minx:T.minx,S.miny=T.miny>P.miny?P.miny:T.miny,S.maxx=P.maxx>T.maxx?P.maxx:T.maxx,S.maxy=P.maxy>T.maxy?P.maxy:T.maxy;var A=h.height,E=d.height;_.height=1+(A>E?A:E);var N=_.height,L=v.height;u.height=1+(N>L?N:L)}_=u}else if(-1>x){var V=h.child1,j=h.child2;if(h.child1=_,h.parent=_.parent,_.parent=h,null!=h.parent?h.parent.child1==_?h.parent.child1=h:h.parent.child2=h:l.root=h,V.height>j.height){h.child2=V,_.child1=j,j.parent=_;var D=_.aabb,F=u.aabb,R=j.aabb;D.minx=R.minx>F.minx?F.minx:R.minx,D.miny=R.miny>F.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy;var B=h.aabb,G=_.aabb,Z=V.aabb;B.minx=Z.minx>G.minx?G.minx:Z.minx,B.miny=Z.miny>G.miny?G.miny:Z.miny,B.maxx=G.maxx>Z.maxx?G.maxx:Z.maxx,B.maxy=G.maxy>Z.maxy?G.maxy:Z.maxy;var U=u.height,q=j.height;_.height=1+(U>q?U:q);var Y=_.height,K=V.height;h.height=1+(Y>K?Y:K)}else{h.child2=j,_.child1=V,V.parent=_;var W=_.aabb,J=u.aabb,X=V.aabb;W.minx=X.minx>J.minx?J.minx:X.minx,W.miny=X.miny>J.miny?J.miny:X.miny,W.maxx=J.maxx>X.maxx?J.maxx:X.maxx,W.maxy=J.maxy>X.maxy?J.maxy:X.maxy;var H=h.aabb,Q=_.aabb,$=j.aabb;H.minx=$.minx>Q.minx?Q.minx:$.minx,H.miny=$.miny>Q.miny?Q.miny:$.miny,H.maxx=Q.maxx>$.maxx?Q.maxx:$.maxx,H.maxy=Q.maxy>$.maxy?Q.maxy:$.maxy;var nn=u.height,en=V.height;_.height=1+(nn>en?nn:en);var tn=_.height,ln=j.height;h.height=1+(tn>ln?tn:ln)}_=h}else _=_}var pn=_.child1,rn=_.child2,an=_.aabb,sn=pn.aabb,on=rn.aabb;an.minx=on.minx>sn.minx?sn.minx:on.minx,an.miny=on.miny>sn.miny?sn.miny:on.miny,an.maxx=sn.maxx>on.maxx?sn.maxx:on.maxx,an.maxy=sn.maxy>on.maxy?sn.maxy:on.maxy;var _n=pn.height,hn=rn.height;_.height=1+(_n>hn?_n:hn),_=_.parent}}else{l.root=a,a.parent=null;var un=p;un.height=-1;var xn=un.aabb;null!=xn.outer&&(xn.outer.zpp_inner=null,xn.outer=null),xn.wrap_min=xn.wrap_max=null,xn._invalidate=null,xn._validate=null,xn.next=qe.zpp_pool,qe.zpp_pool=xn,un.child1=un.child2=un.parent=null,un.next=null,un.snext=null,un.mnext=null,un.next=ji.zpp_pool,ji.zpp_pool=un}}}var dn=i.aabb;if(!n.continuous&&t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,t.type==me.id_ShapeType_CIRCLE){var vn=t.circle;if(vn.zip_worldCOM&&null!=vn.body){if(vn.zip_worldCOM=!1,vn.zip_localCOM){if(vn.zip_localCOM=!1,vn.type==me.id_ShapeType_POLYGON){var zn=vn.polygon;if(null==zn.lverts.next.next)zn.localCOMx=zn.lverts.next.x,zn.localCOMy=zn.lverts.next.y;else if(null==zn.lverts.next.next.next){zn.localCOMx=zn.lverts.next.x,zn.localCOMy=zn.lverts.next.y;zn.localCOMx+=1*zn.lverts.next.next.x,zn.localCOMy+=1*zn.lverts.next.next.y;zn.localCOMx*=.5,zn.localCOMy*=.5}else{zn.localCOMx=0,zn.localCOMy=0;var cn=0,mn=zn.lverts.next,yn=mn;mn=mn.next;var fn=mn;for(mn=mn.next;null!=mn;){var bn=mn;cn+=fn.x*(bn.y-yn.y);var gn=bn.y*fn.x-bn.x*fn.y;zn.localCOMx+=(fn.x+bn.x)*gn,zn.localCOMy+=(fn.y+bn.y)*gn,yn=fn,fn=bn,mn=mn.next}mn=zn.lverts.next;var wn=mn;cn+=fn.x*(wn.y-yn.y);var Mn=wn.y*fn.x-wn.x*fn.y;zn.localCOMx+=(fn.x+wn.x)*Mn,zn.localCOMy+=(fn.y+wn.y)*Mn,yn=fn,fn=wn,mn=mn.next;var Cn=mn;cn+=fn.x*(Cn.y-yn.y);var kn=Cn.y*fn.x-Cn.x*fn.y;zn.localCOMx+=(fn.x+Cn.x)*kn,zn.localCOMy+=(fn.y+Cn.y)*kn,cn=1/(3*cn);var On=cn;zn.localCOMx*=On,zn.localCOMy*=On}}null!=vn.wrap_localCOM&&(vn.wrap_localCOM.zpp_inner.x=vn.localCOMx,vn.wrap_localCOM.zpp_inner.y=vn.localCOMy)}var In=vn.body;In.zip_axis&&(In.zip_axis=!1,In.axisx=Math.sin(In.rot),In.axisy=Math.cos(In.rot)),vn.worldCOMx=vn.body.posx+(vn.body.axisy*vn.localCOMx-vn.body.axisx*vn.localCOMy),vn.worldCOMy=vn.body.posy+(vn.localCOMx*vn.body.axisx+vn.localCOMy*vn.body.axisy)}var Sn=vn.radius,Pn=vn.radius;vn.aabb.minx=vn.worldCOMx-Sn,vn.aabb.miny=vn.worldCOMy-Pn,vn.aabb.maxx=vn.worldCOMx+Sn,vn.aabb.maxy=vn.worldCOMy+Pn}else{var Tn=t.polygon;if(Tn.zip_gverts&&null!=Tn.body){Tn.zip_gverts=!1,Tn.validate_lverts();var An=Tn.body;An.zip_axis&&(An.zip_axis=!1,An.axisx=Math.sin(An.rot),An.axisy=Math.cos(An.rot));for(var En=Tn.lverts.next,Nn=Tn.gverts.next;null!=Nn;){var Ln=Nn,Vn=En;En=En.next,Ln.x=Tn.body.posx+(Tn.body.axisy*Vn.x-Tn.body.axisx*Vn.y),Ln.y=Tn.body.posy+(Vn.x*Tn.body.axisx+Vn.y*Tn.body.axisy),Nn=Nn.next}}var jn=Tn.gverts.next;Tn.aabb.minx=jn.x,Tn.aabb.miny=jn.y,Tn.aabb.maxx=jn.x,Tn.aabb.maxy=jn.y;for(var Dn=Tn.gverts.next.next;null!=Dn;){var Fn=Dn;Tn.aabb.minx>Fn.x&&(Tn.aabb.minx=Fn.x),Fn.x>Tn.aabb.maxx&&(Tn.aabb.maxx=Fn.x),Tn.aabb.miny>Fn.y&&(Tn.aabb.miny=Fn.y),Fn.y>Tn.aabb.maxy&&(Tn.aabb.maxy=Fn.y),Dn=Dn.next}}var Rn=t.aabb;dn.minx=Rn.minx-3,dn.miny=Rn.miny-3,dn.maxx=Rn.maxx+3,dn.maxy=Rn.maxy+3;var Bn=(i.dyn=t.body.type!=me.id_BodyType_STATIC&&!t.body.component.sleeping)?this.dtree:this.stree;if(null==Bn.root)Bn.root=i,Bn.root.parent=null;else{for(var Gn=i.aabb,Zn=Bn.root;null!=Zn.child1;){var Un=Zn.child1,qn=Zn.child2,Yn=Zn.aabb,Kn=2*(Yn.maxx-Yn.minx+(Yn.maxy-Yn.miny)),Wn=Fi.tmpaabb,Jn=Zn.aabb;Wn.minx=Gn.minx>Jn.minx?Jn.minx:Gn.minx,Wn.miny=Gn.miny>Jn.miny?Jn.miny:Gn.miny,Wn.maxx=Jn.maxx>Gn.maxx?Jn.maxx:Gn.maxx,Wn.maxy=Jn.maxy>Gn.maxy?Jn.maxy:Gn.maxy;var Xn=Fi.tmpaabb,Hn=2*(Xn.maxx-Xn.minx+(Xn.maxy-Xn.miny)),Qn=2*Hn,$n=2*(Hn-Kn),ne=Fi.tmpaabb,ee=Un.aabb;ne.minx=ee.minx>Gn.minx?Gn.minx:ee.minx,ne.miny=ee.miny>Gn.miny?Gn.miny:ee.miny,ne.maxx=Gn.maxx>ee.maxx?Gn.maxx:ee.maxx,ne.maxy=Gn.maxy>ee.maxy?Gn.maxy:ee.maxy;var ie;if(null==Un.child1){var te=Fi.tmpaabb;ie=2*(te.maxx-te.minx+(te.maxy-te.miny))+$n}else{var le=Un.aabb,pe=2*(le.maxx-le.minx+(le.maxy-le.miny)),re=Fi.tmpaabb;ie=2*(re.maxx-re.minx+(re.maxy-re.miny))-pe+$n}var ae=Fi.tmpaabb,se=qn.aabb;ae.minx=se.minx>Gn.minx?Gn.minx:se.minx,ae.miny=se.miny>Gn.miny?Gn.miny:se.miny,ae.maxx=Gn.maxx>se.maxx?Gn.maxx:se.maxx,ae.maxy=Gn.maxy>se.maxy?Gn.maxy:se.maxy;var oe;if(null==qn.child1){var _e=Fi.tmpaabb;oe=2*(_e.maxx-_e.minx+(_e.maxy-_e.miny))+$n}else{var he=qn.aabb,ue=2*(he.maxx-he.minx+(he.maxy-he.miny)),xe=Fi.tmpaabb;oe=2*(xe.maxx-xe.minx+(xe.maxy-xe.miny))-ue+$n}if(ie>Qn&&oe>Qn)break;Zn=oe>ie?Un:qn}var de,ve=Zn,ze=ve.parent;null==ji.zpp_pool?de=new ji:(de=ji.zpp_pool,ji.zpp_pool=de.next,de.next=null),null==qe.zpp_pool?de.aabb=new qe:(de.aabb=qe.zpp_pool,qe.zpp_pool=de.aabb.next,de.aabb.next=null);de.moved=!1,de.synced=!1,de.first_sync=!1,de.parent=ze;var ce=de.aabb,ye=ve.aabb;for(ce.minx=ye.minx>Gn.minx?Gn.minx:ye.minx,ce.miny=ye.miny>Gn.miny?Gn.miny:ye.miny,ce.maxx=Gn.maxx>ye.maxx?Gn.maxx:ye.maxx,ce.maxy=Gn.maxy>ye.maxy?Gn.maxy:ye.maxy,de.height=ve.height+1,null!=ze?(ze.child1==ve?ze.child1=de:ze.child2=de,de.child1=ve,de.child2=i,ve.parent=de,i.parent=de):(de.child1=ve,de.child2=i,ve.parent=de,i.parent=de,Bn.root=de),Zn=i.parent;null!=Zn;){if(null==Zn.child1||2>Zn.height)Zn=Zn;else{var fe=Zn.child1,be=Zn.child2,ge=be.height-fe.height;if(ge>1){var we=be.child1,Me=be.child2;if(be.child1=Zn,be.parent=Zn.parent,Zn.parent=be,null!=be.parent?be.parent.child1==Zn?be.parent.child1=be:be.parent.child2=be:Bn.root=be,we.height>Me.height){be.child2=we,Zn.child2=Me,Me.parent=Zn;var Ce=Zn.aabb,ke=fe.aabb,Oe=Me.aabb;Ce.minx=Oe.minx>ke.minx?ke.minx:Oe.minx,Ce.miny=Oe.miny>ke.miny?ke.miny:Oe.miny,Ce.maxx=ke.maxx>Oe.maxx?ke.maxx:Oe.maxx,Ce.maxy=ke.maxy>Oe.maxy?ke.maxy:Oe.maxy;var Ie=be.aabb,Se=Zn.aabb,Pe=we.aabb;Ie.minx=Pe.minx>Se.minx?Se.minx:Pe.minx,Ie.miny=Pe.miny>Se.miny?Se.miny:Pe.miny,Ie.maxx=Se.maxx>Pe.maxx?Se.maxx:Pe.maxx,Ie.maxy=Se.maxy>Pe.maxy?Se.maxy:Pe.maxy;var Te=fe.height,Ae=Me.height;Zn.height=1+(Te>Ae?Te:Ae);var Ee=Zn.height,Ne=we.height;be.height=1+(Ee>Ne?Ee:Ne)}else{be.child2=Me,Zn.child2=we,we.parent=Zn;var Le=Zn.aabb,Ve=fe.aabb,je=we.aabb;Le.minx=je.minx>Ve.minx?Ve.minx:je.minx,Le.miny=je.miny>Ve.miny?Ve.miny:je.miny,Le.maxx=Ve.maxx>je.maxx?Ve.maxx:je.maxx,Le.maxy=Ve.maxy>je.maxy?Ve.maxy:je.maxy;var De=be.aabb,Fe=Zn.aabb,Re=Me.aabb;De.minx=Re.minx>Fe.minx?Fe.minx:Re.minx,De.miny=Re.miny>Fe.miny?Fe.miny:Re.miny,De.maxx=Fe.maxx>Re.maxx?Fe.maxx:Re.maxx,De.maxy=Fe.maxy>Re.maxy?Fe.maxy:Re.maxy;var Be=fe.height,Ge=we.height;Zn.height=1+(Be>Ge?Be:Ge);var Ze=Zn.height,Ue=Me.height;be.height=1+(Ze>Ue?Ze:Ue)}Zn=be}else if(-1>ge){var Ye=fe.child1,Ke=fe.child2;if(fe.child1=Zn,fe.parent=Zn.parent,Zn.parent=fe,null!=fe.parent?fe.parent.child1==Zn?fe.parent.child1=fe:fe.parent.child2=fe:Bn.root=fe,Ye.height>Ke.height){fe.child2=Ye,Zn.child1=Ke,Ke.parent=Zn;var We=Zn.aabb,Je=be.aabb,Xe=Ke.aabb;We.minx=Xe.minx>Je.minx?Je.minx:Xe.minx,We.miny=Xe.miny>Je.miny?Je.miny:Xe.miny,We.maxx=Je.maxx>Xe.maxx?Je.maxx:Xe.maxx,We.maxy=Je.maxy>Xe.maxy?Je.maxy:Xe.maxy;var He=fe.aabb,Qe=Zn.aabb,$e=Ye.aabb;He.minx=$e.minx>Qe.minx?Qe.minx:$e.minx,He.miny=$e.miny>Qe.miny?Qe.miny:$e.miny,He.maxx=Qe.maxx>$e.maxx?Qe.maxx:$e.maxx,He.maxy=Qe.maxy>$e.maxy?Qe.maxy:$e.maxy;var ni=be.height,ei=Ke.height;Zn.height=1+(ni>ei?ni:ei);var ii=Zn.height,ti=Ye.height;fe.height=1+(ii>ti?ii:ti)}else{fe.child2=Ke,Zn.child1=Ye,Ye.parent=Zn;var li=Zn.aabb,pi=be.aabb,ri=Ye.aabb;li.minx=ri.minx>pi.minx?pi.minx:ri.minx,li.miny=ri.miny>pi.miny?pi.miny:ri.miny,li.maxx=pi.maxx>ri.maxx?pi.maxx:ri.maxx,li.maxy=pi.maxy>ri.maxy?pi.maxy:ri.maxy;var ai=fe.aabb,si=Zn.aabb,oi=Ke.aabb;ai.minx=oi.minx>si.minx?si.minx:oi.minx,ai.miny=oi.miny>si.miny?si.miny:oi.miny,ai.maxx=si.maxx>oi.maxx?si.maxx:oi.maxx,ai.maxy=si.maxy>oi.maxy?si.maxy:oi.maxy;var _i=be.height,hi=Ye.height;Zn.height=1+(_i>hi?_i:hi);var ui=Zn.height,xi=Ke.height;fe.height=1+(ui>xi?ui:xi)}Zn=fe}else Zn=Zn}var di=Zn.child1,vi=Zn.child2,zi=di.height,ci=vi.height;Zn.height=1+(zi>ci?zi:ci);var mi=Zn.aabb,yi=di.aabb,fi=vi.aabb;mi.minx=fi.minx>yi.minx?yi.minx:fi.minx,mi.miny=fi.miny>yi.miny?yi.miny:fi.miny,mi.maxx=yi.maxx>fi.maxx?yi.maxx:fi.maxx,mi.maxy=yi.maxy>fi.maxy?yi.maxy:fi.maxy,Zn=Zn.parent}}i.synced=!1,i=i.snext}for(;null!=this.syncs;){var bi=this.syncs;this.syncs=bi.snext,bi.snext=null;var gi=bi;if(!gi.moved){gi.moved=!1;var wi=gi.shape;if(!wi.body.component.sleeping){var Mi=gi.aabb,Ci=null;for(null!=this.dtree.root&&(this.dtree.root.next=Ci,Ci=this.dtree.root);null!=Ci;){var ki=Ci;Ci=ki.next,ki.next=null;var Oi=ki;if(Oi!=gi)if(null==Oi.child1){var Ii=Oi.shape;if(Ii.body!=wi.body&&(Ii.body.type!=me.id_BodyType_STATIC||wi.body.type!=me.id_BodyType_STATIC)){var Si=Oi.aabb;if(!(Si.miny>Mi.maxy||Mi.miny>Si.maxy||Si.minx>Mi.maxx||Mi.minx>Si.maxx)){var Pi,Ti;Ii.id>wi.id?(Pi=wi.id,Ti=Ii.id):(Pi=Ii.id,Ti=wi.id);for(var Ai=Ii.pairs.length>wi.pairs.length?wi:Ii,Ei=null,Ni=Ai.pairs.head;null!=Ni;){var Li=Ni.elt;if(Li.id==Pi&&Li.di==Ti){Ei=Li;break}Ni=Ni.next}if(null!=Ei){Ei.sleeping&&(Ei.sleeping=!1,Ei.next=this.pairs,this.pairs=Ei,Ei.first=!0);continue}null==Di.zpp_pool?Ei=new Di:(Ei=Di.zpp_pool,Di.zpp_pool=Ei.next,Ei.next=null),Ei.n1=gi,Ei.n2=Oi,Ei.id=Pi,Ei.di=Ti,Ei.next=this.pairs,this.pairs=Ei,Ei.first=!0;var Vi,Ri=wi.pairs;null==Kt.zpp_pool?Vi=new Kt:(Vi=Kt.zpp_pool,Kt.zpp_pool=Vi.next,Vi.next=null),Vi.elt=Ei;var Bi=Vi;Bi.next=Ri.head,Ri.head=Bi,Ri.modified=!0,Ri.length++;var Gi,Zi=Ii.pairs;null==Kt.zpp_pool?Gi=new Kt:(Gi=Kt.zpp_pool,Kt.zpp_pool=Gi.next,Gi.next=null),Gi.elt=Ei;var Ui=Gi;Ui.next=Zi.head,Zi.head=Ui,Zi.modified=!0,Zi.length++}}}else{var qi=Oi.aabb;qi.miny>Mi.maxy||Mi.miny>qi.maxy||qi.minx>Mi.maxx||Mi.minx>qi.maxx||(null!=Oi.child1&&(Oi.child1.next=Ci,Ci=Oi.child1),null!=Oi.child2&&(Oi.child2.next=Ci,Ci=Oi.child2))}}for(null!=this.stree.root&&(this.stree.root.next=Ci,Ci=this.stree.root);null!=Ci;){var Yi=Ci;Ci=Yi.next,Yi.next=null;var Ki=Yi;if(Ki!=gi)if(null==Ki.child1){var Wi=Ki.shape;if(Wi.body!=wi.body&&(Wi.body.type!=me.id_BodyType_STATIC||wi.body.type!=me.id_BodyType_STATIC)){var Ji=Ki.aabb;if(!(Ji.miny>Mi.maxy||Mi.miny>Ji.maxy||Ji.minx>Mi.maxx||Mi.minx>Ji.maxx)){var Xi,Hi;Wi.id>wi.id?(Xi=wi.id,Hi=Wi.id):(Xi=Wi.id,Hi=wi.id);for(var Qi=Wi.pairs.length>wi.pairs.length?wi:Wi,$i=null,nt=Qi.pairs.head;null!=nt;){var et=nt.elt;if(et.id==Xi&&et.di==Hi){$i=et;break}nt=nt.next}if(null!=$i){$i.sleeping&&($i.sleeping=!1,$i.next=this.pairs,this.pairs=$i,$i.first=!0);continue}null==Di.zpp_pool?$i=new Di:($i=Di.zpp_pool,Di.zpp_pool=$i.next,$i.next=null),$i.n1=gi,$i.n2=Ki,$i.id=Xi,$i.di=Hi,$i.next=this.pairs,this.pairs=$i,$i.first=!0;var it,tt=wi.pairs;null==Kt.zpp_pool?it=new Kt:(it=Kt.zpp_pool,Kt.zpp_pool=it.next,it.next=null),it.elt=$i;var lt=it;lt.next=tt.head,tt.head=lt,tt.modified=!0,tt.length++;var pt,rt=Wi.pairs;null==Kt.zpp_pool?pt=new Kt:(pt=Kt.zpp_pool,Kt.zpp_pool=pt.next,pt.next=null),pt.elt=$i;var at=pt;at.next=rt.head,rt.head=at,rt.modified=!0,rt.length++}}}else{var st=Ki.aabb;st.miny>Mi.maxy||Mi.miny>st.maxy||st.minx>Mi.maxx||Mi.minx>st.maxx||(null!=Ki.child1&&(Ki.child1.next=Ci,Ci=Ki.child1),null!=Ki.child2&&(Ki.child2.next=Ci,Ci=Ki.child2))}}}}}for(;null!=this.moves;){var ot=this.moves;this.moves=ot.mnext,ot.mnext=null;var _t=ot;_t.moved=!1;var ht=_t.shape;if(!ht.body.component.sleeping){var ut=_t.aabb,xt=null;for(null!=this.dtree.root&&(this.dtree.root.next=xt,xt=this.dtree.root);null!=xt;){var dt=xt;xt=dt.next,dt.next=null;var vt=dt;if(vt!=_t)if(null==vt.child1){var zt=vt.shape;if(zt.body!=ht.body&&(zt.body.type!=me.id_BodyType_STATIC||ht.body.type!=me.id_BodyType_STATIC)){var ct=vt.aabb;if(!(ct.miny>ut.maxy||ut.miny>ct.maxy||ct.minx>ut.maxx||ut.minx>ct.maxx)){var mt,yt;zt.id>ht.id?(mt=ht.id,yt=zt.id):(mt=zt.id,yt=ht.id);for(var ft=zt.pairs.length>ht.pairs.length?ht:zt,bt=null,gt=ft.pairs.head;null!=gt;){var wt=gt.elt;if(wt.id==mt&&wt.di==yt){bt=wt;break}gt=gt.next}if(null!=bt){bt.sleeping&&(bt.sleeping=!1,bt.next=this.pairs,this.pairs=bt,bt.first=!0);continue}null==Di.zpp_pool?bt=new Di:(bt=Di.zpp_pool,Di.zpp_pool=bt.next,bt.next=null),bt.n1=_t,bt.n2=vt,bt.id=mt,bt.di=yt,bt.next=this.pairs,this.pairs=bt,bt.first=!0;var Mt,Ct=ht.pairs;null==Kt.zpp_pool?Mt=new Kt:(Mt=Kt.zpp_pool,Kt.zpp_pool=Mt.next,Mt.next=null),Mt.elt=bt;var kt=Mt;kt.next=Ct.head,Ct.head=kt,Ct.modified=!0,Ct.length++;var Ot,It=zt.pairs;null==Kt.zpp_pool?Ot=new Kt:(Ot=Kt.zpp_pool,Kt.zpp_pool=Ot.next,Ot.next=null),Ot.elt=bt;var St=Ot;St.next=It.head,It.head=St,It.modified=!0,It.length++}}}else{var Pt=vt.aabb;Pt.miny>ut.maxy||ut.miny>Pt.maxy||Pt.minx>ut.maxx||ut.minx>Pt.maxx||(null!=vt.child1&&(vt.child1.next=xt,xt=vt.child1),null!=vt.child2&&(vt.child2.next=xt,xt=vt.child2))}}for(null!=this.stree.root&&(this.stree.root.next=xt,xt=this.stree.root);null!=xt;){var Tt=xt;xt=Tt.next,Tt.next=null;var At=Tt;if(At!=_t)if(null==At.child1){var Et=At.shape;if(Et.body!=ht.body&&(Et.body.type!=me.id_BodyType_STATIC||ht.body.type!=me.id_BodyType_STATIC)){var Nt=At.aabb;if(!(Nt.miny>ut.maxy||ut.miny>Nt.maxy||Nt.minx>ut.maxx||ut.minx>Nt.maxx)){var Lt,Vt;Et.id>ht.id?(Lt=ht.id,Vt=Et.id):(Lt=Et.id,Vt=ht.id);for(var jt=Et.pairs.length>ht.pairs.length?ht:Et,Dt=null,Ft=jt.pairs.head;null!=Ft;){var Rt=Ft.elt;if(Rt.id==Lt&&Rt.di==Vt){Dt=Rt;break}Ft=Ft.next}if(null!=Dt){Dt.sleeping&&(Dt.sleeping=!1,Dt.next=this.pairs,this.pairs=Dt,Dt.first=!0);continue}null==Di.zpp_pool?Dt=new Di:(Dt=Di.zpp_pool,Di.zpp_pool=Dt.next,Dt.next=null),Dt.n1=_t,Dt.n2=At,Dt.id=Lt,Dt.di=Vt,Dt.next=this.pairs,this.pairs=Dt,Dt.first=!0;var Bt,Gt=ht.pairs;null==Kt.zpp_pool?Bt=new Kt:(Bt=Kt.zpp_pool,Kt.zpp_pool=Bt.next,Bt.next=null),Bt.elt=Dt;var Zt=Bt;Zt.next=Gt.head,Gt.head=Zt,Gt.modified=!0,Gt.length++;var Ut,qt=Et.pairs;null==Kt.zpp_pool?Ut=new Kt:(Ut=Kt.zpp_pool,Kt.zpp_pool=Ut.next,Ut.next=null),Ut.elt=Dt;var Yt=Ut;Yt.next=qt.head,qt.head=Yt,qt.modified=!0,qt.length++}}}else{var Wt=At.aabb;Wt.miny>ut.maxy||ut.miny>Wt.maxy||Wt.minx>ut.maxx||ut.minx>Wt.maxx||(null!=At.child1&&(At.child1.next=xt,xt=At.child1),null!=At.child2&&(At.child2.next=xt,xt=At.child2))}}}}for(var Jt=null,Xt=this.pairs;null!=Xt;){var Ht;if(Xt.first)Ht=!1;else{var Qt=Xt.n1.aabb,$t=Xt.n2.aabb;Ht=!!($t.miny>Qt.maxy||Qt.miny>$t.maxy||$t.minx>Qt.maxx||Qt.minx>$t.maxx)}if(Ht){null==Jt?this.pairs=Xt.next:Jt.next=Xt.next;for(var nl=Xt.n1.shape.pairs,el=null,il=nl.head;null!=il;){if(il.elt==Xt){var tl,ll;null==el?(tl=nl.head,ll=tl.next,null==(nl.head=ll)&&(nl.pushmod=!0)):(tl=el.next,ll=tl.next,el.next=ll,null==ll&&(nl.pushmod=!0));var pl=tl;pl.elt=null,pl.next=Kt.zpp_pool,Kt.zpp_pool=pl,nl.modified=!0,nl.length--,nl.pushmod=!0,!0;break}el=il,il=il.next}for(var rl=Xt.n2.shape.pairs,al=null,sl=rl.head;null!=sl;){if(sl.elt==Xt){var ol,_l;null==al?(ol=rl.head,_l=ol.next,null==(rl.head=_l)&&(rl.pushmod=!0)):(ol=al.next,_l=ol.next,al.next=_l,null==_l&&(rl.pushmod=!0));var hl=ol;hl.elt=null,hl.next=Kt.zpp_pool,Kt.zpp_pool=hl,rl.modified=!0,rl.length--,rl.pushmod=!0,!0;break}al=sl,sl=sl.next}var ul=Xt.next;null!=Xt.arb&&(Xt.arb.pair=null),Xt.arb=null;var xl=Xt;xl.n1=xl.n2=null,xl.sleeping=!1,xl.next=Di.zpp_pool,Di.zpp_pool=xl,Xt=ul}else{var dl=Xt.n1.shape,vl=dl.body,zl=Xt.n2.shape,cl=zl.body;if(Xt.first||!vl.component.sleeping&&vl.type!=me.id_BodyType_STATIC||!cl.component.sleeping&&cl.type!=me.id_BodyType_STATIC){Xt.first=!1;var ml=dl.aabb,yl=zl.aabb;if(!(yl.miny>ml.maxy||ml.miny>yl.maxy||yl.minx>ml.maxx||ml.minx>yl.maxx)){var fl=Xt.arb;Xt.arb=e?n.narrowPhase(dl,zl,vl.type!=me.id_BodyType_DYNAMIC||cl.type!=me.id_BodyType_DYNAMIC,Xt.arb,!1):n.continuousEvent(dl,zl,vl.type!=me.id_BodyType_DYNAMIC||cl.type!=me.id_BodyType_DYNAMIC,Xt.arb,!1),null==Xt.arb?null!=fl&&(fl.pair=null):Xt.arb.pair=Xt}Jt=Xt,Xt=Xt.next}else Xt.sleeping=!0,null==Jt?this.pairs=Xt.next:Jt.next=Xt.next,Xt=Xt.next}}},clear:function(){for(;null!=this.syncs;){var n=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=n}for(;null!=this.moves;){var e=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=e}for(;null!=this.pairs;){var i=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var t=this.pairs.n1.shape.pairs,l=this.pairs,p=null,r=t.head;null!=r;){if(r.elt==l){var a,s;null==p?(a=t.head,s=a.next,null==(t.head=s)&&(t.pushmod=!0)):(a=p.next,s=a.next,p.next=s,null==s&&(t.pushmod=!0));var o=a;o.elt=null,o.next=Kt.zpp_pool,Kt.zpp_pool=o,t.modified=!0,t.length--,t.pushmod=!0,!0;break}p=r,r=r.next}for(var _=this.pairs.n2.shape.pairs,h=this.pairs,u=null,x=_.head;null!=x;){if(x.elt==h){var d,v;null==u?(d=_.head,v=d.next,null==(_.head=v)&&(_.pushmod=!0)):(d=u.next,v=d.next,u.next=v,null==v&&(_.pushmod=!0));var z=d;z.elt=null,z.next=Kt.zpp_pool,Kt.zpp_pool=z,_.modified=!0,_.length--,_.pushmod=!0,!0;break}u=x,x=x.next}var c=this.pairs;c.n1=c.n2=null,c.sleeping=!1,c.next=Di.zpp_pool,Di.zpp_pool=c,this.pairs=i}this.dtree.clear(),this.stree.clear()},treeStack:null,shapesUnderPoint:function(n,e,i,t){this.sync_broadphase();var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;var p=l,r=null==t?new ne:t;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(!(s.minx>p.x||p.x>s.maxx||s.miny>p.y||p.y>s.maxy))if(null==a.child1){var o;if(null!=i){var _=a.shape.filter;o=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else o=!0;o&&(a.shape.type==me.id_ShapeType_CIRCLE?Ke.circleContains(a.shape.circle,p)&&r.push(a.shape.outer):Ke.polyContains(a.shape.polygon,p)&&r.push(a.shape.outer))}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h=this.treeStack.pop_unsafe(),u=h.aabb;if(!(u.minx>p.x||p.x>u.maxx||u.miny>p.y||p.y>u.maxy))if(null==h.child1){var x;if(null!=i){var d=h.shape.filter;x=0!=(d.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&d.collisionGroup)}else x=!0;x&&(h.shape.type==me.id_ShapeType_CIRCLE?Ke.circleContains(h.shape.circle,p)&&r.push(h.shape.outer):Ke.polyContains(h.shape.polygon,p)&&r.push(h.shape.outer))}else null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)}var v=p;return null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=Mi.zpp_pool,Mi.zpp_pool=v,r},bodiesUnderPoint:function(n,e,i,t){this.sync_broadphase();var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;var p=l,r=null==t?new Ln:t;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(!(s.minx>p.x||p.x>s.maxx||s.miny>p.y||p.y>s.maxy))if(null==a.child1){var o=a.shape.body.outer;if(!r.has(o)){var _;if(null!=i){var h=a.shape.filter;_=0!=(h.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup)}else _=!0;_&&(a.shape.type==me.id_ShapeType_CIRCLE?Ke.circleContains(a.shape.circle,p)&&r.push(o):Ke.polyContains(a.shape.polygon,p)&&r.push(o))}}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(!(x.minx>p.x||p.x>x.maxx||x.miny>p.y||p.y>x.maxy))if(null==u.child1){var d=u.shape.body.outer;if(!r.has(d)){var v;if(null!=i){var z=u.shape.filter;v=0!=(z.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup)}else v=!0;v&&(u.shape.type==me.id_ShapeType_CIRCLE?Ke.circleContains(u.shape.circle,p)&&r.push(d):Ke.polyContains(u.shape.polygon,p)&&r.push(d))}}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}var c=p;return null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=Mi.zpp_pool,Mi.zpp_pool=c,r},treeStack2:null,shapesInAABB:function(n,e,i,t,l){this.sync_broadphase(),this.updateAABBShape(n);var p=this.aabbShape.zpp_inner.aabb,r=null==l?new ne:l;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(p.minx>s.minx||p.miny>s.miny||s.maxx>p.maxx||s.maxy>p.maxy){var o=a.aabb;if(!(p.miny>o.maxy||o.miny>p.maxy||p.minx>o.maxx||o.minx>p.maxx))if(null==a.child1){var _;if(null!=t){var h=a.shape.filter;_=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else _=!0;if(_)if(e)if(i)Ke.containTest(this.aabbShape.zpp_inner,a.shape)&&r.push(a.shape.outer);else{var u=a.shape.aabb;p.minx>u.minx||p.miny>u.miny||u.maxx>p.maxx||u.maxy>p.maxy?Ke.testCollide_safe(a.shape,this.aabbShape.zpp_inner)&&r.push(a.shape.outer):r.push(a.shape.outer)}else{var x;if(i){var d=a.shape.aabb;x=!(p.minx>d.minx||p.miny>d.miny||d.maxx>p.maxx)&&p.maxy>=d.maxy}else x=!0;x&&r.push(a.shape.outer)}}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}else if(null==a.child1){var v;if(null!=t){var z=a.shape.filter;v=0!=(z.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&z.collisionGroup)}else v=!0;v&&r.push(a.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new zt),this.treeStack2.add(a);null!=this.treeStack2.head;){var c=this.treeStack2.pop_unsafe();if(null==c.child1){var m;if(null!=t){var y=c.shape.filter;m=0!=(y.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&y.collisionGroup)}else m=!0;m&&r.push(c.shape.outer)}else null!=c.child1&&this.treeStack2.add(c.child1),null!=c.child2&&this.treeStack2.add(c.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var f=this.treeStack.pop_unsafe(),b=f.aabb;if(p.minx>b.minx||p.miny>b.miny||b.maxx>p.maxx||b.maxy>p.maxy){var g=f.aabb;if(!(p.miny>g.maxy||g.miny>p.maxy||p.minx>g.maxx||g.minx>p.maxx))if(null==f.child1){var w;if(null!=t){var M=f.shape.filter;w=0!=(M.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&M.collisionGroup)}else w=!0;if(w)if(e)if(i)Ke.containTest(this.aabbShape.zpp_inner,f.shape)&&r.push(f.shape.outer);else{var C=f.shape.aabb;p.minx>C.minx||p.miny>C.miny||C.maxx>p.maxx||C.maxy>p.maxy?Ke.testCollide_safe(f.shape,this.aabbShape.zpp_inner)&&r.push(f.shape.outer):r.push(f.shape.outer)}else{var k;if(i){var O=f.shape.aabb;k=!(p.minx>O.minx||p.miny>O.miny||O.maxx>p.maxx)&&p.maxy>=O.maxy}else k=!0;k&&r.push(f.shape.outer)}}else null!=f.child1&&this.treeStack.add(f.child1),null!=f.child2&&this.treeStack.add(f.child2)}else if(null==f.child1){var I;if(null!=t){var S=f.shape.filter;I=0!=(S.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&S.collisionGroup)}else I=!0;I&&r.push(f.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new zt),this.treeStack2.add(f);null!=this.treeStack2.head;){var P=this.treeStack2.pop_unsafe();if(null==P.child1){var T;if(null!=t){var A=P.shape.filter;T=0!=(A.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&A.collisionGroup)}else T=!0;T&&r.push(P.shape.outer)}else null!=P.child1&&this.treeStack2.add(P.child1),null!=P.child2&&this.treeStack2.add(P.child2)}}return r},failed:null,bodiesInAABB:function(n,e,i,t,l){this.sync_broadphase(),this.updateAABBShape(n);var p=this.aabbShape.zpp_inner.aabb,r=null==l?new Ln:l;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(p.minx>s.minx||p.miny>s.miny||s.maxx>p.maxx||s.maxy>p.maxy){var o=a.aabb;if(!(p.miny>o.maxy||o.miny>p.maxy||p.minx>o.maxx||o.minx>p.maxx))if(null==a.child1){var _,h=a.shape.body.outer;if(null!=t){var u=a.shape.filter;_=0!=(u.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&u.collisionGroup)}else _=!0;if(_)if(e)if(i){if(!this.failed.has(h)){var x=Ke.containTest(this.aabbShape.zpp_inner,a.shape);!r.has(h)&&x?r.push(h):x||(r.remove(h),this.failed.push(h))}}else!r.has(h)&&Ke.testCollide_safe(a.shape,this.aabbShape.zpp_inner)&&r.push(h);else if(i){if(!this.failed.has(h)){var d=a.shape.aabb,v=!(p.minx>d.minx||p.miny>d.miny||d.maxx>p.maxx||d.maxy>p.maxy);!r.has(h)&&v?r.push(h):v||(r.remove(h),this.failed.push(h))}}else{var z;if(r.has(h))z=!1;else{var c=a.shape.aabb;z=!(p.minx>c.minx||p.miny>c.miny||c.maxx>p.maxx)&&p.maxy>=c.maxy}z&&r.push(h)}}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}else if(null==a.child1){var m;if(null!=t){var y=a.shape.filter;m=0!=(y.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&y.collisionGroup)}else m=!0;if(m){var f=a.shape.body.outer;r.has(f)||r.push(f)}}else for(null==this.treeStack2&&(this.treeStack2=new zt),this.treeStack2.add(a);null!=this.treeStack2.head;){var b=this.treeStack2.pop_unsafe();if(null==b.child1){var g;if(null!=t){var w=b.shape.filter;g=0!=(w.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&w.collisionGroup)}else g=!0;if(g){var M=b.shape.body.outer;r.has(M)||r.push(M)}}else null!=b.child1&&this.treeStack2.add(b.child1),null!=b.child2&&this.treeStack2.add(b.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var C=this.treeStack.pop_unsafe(),k=C.aabb;if(p.minx>k.minx||p.miny>k.miny||k.maxx>p.maxx||k.maxy>p.maxy){var O=C.aabb;if(!(p.miny>O.maxy||O.miny>p.maxy||p.minx>O.maxx||O.minx>p.maxx))if(null==C.child1){var I,S=C.shape.body.outer;if(null!=t){var P=C.shape.filter;I=0!=(P.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&P.collisionGroup)}else I=!0;if(I)if(e)if(i){if(!this.failed.has(S)){var T=Ke.containTest(this.aabbShape.zpp_inner,C.shape);!r.has(S)&&T?r.push(S):T||(r.remove(S),this.failed.push(S))}}else!r.has(S)&&Ke.testCollide_safe(C.shape,this.aabbShape.zpp_inner)&&r.push(S);else if(i){if(!this.failed.has(S)){var A=C.shape.aabb,E=!(p.minx>A.minx||p.miny>A.miny||A.maxx>p.maxx||A.maxy>p.maxy);!r.has(S)&&E?r.push(S):E||(r.remove(S),this.failed.push(S))}}else{var N;if(r.has(S))N=!1;else{var L=C.shape.aabb;N=!(p.minx>L.minx||p.miny>L.miny||L.maxx>p.maxx)&&p.maxy>=L.maxy}N&&r.push(S)}}else null!=C.child1&&this.treeStack.add(C.child1),null!=C.child2&&this.treeStack.add(C.child2)}else if(null==C.child1){var V;if(null!=t){var j=C.shape.filter;V=0!=(j.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&j.collisionGroup)}else V=!0;if(V){var D=C.shape.body.outer;r.has(D)||r.push(D)}}else for(null==this.treeStack2&&(this.treeStack2=new zt),this.treeStack2.add(C);null!=this.treeStack2.head;){var F=this.treeStack2.pop_unsafe();if(null==F.child1){var R;if(null!=t){var B=F.shape.filter;R=0!=(B.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&B.collisionGroup)}else R=!0;if(R){var G=F.shape.body.outer;r.has(G)||r.push(G)}}else null!=F.child1&&this.treeStack2.add(F.child1),null!=F.child2&&this.treeStack2.add(F.child2)}}return this.failed.clear(),r},shapesInCircle:function(n,e,i,t,l,p){this.sync_broadphase(),this.updateCircShape(n,e,i);var r=this.circShape.zpp_inner.aabb,a=null==p?new ne:p;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var s=this.treeStack.pop_unsafe(),o=s.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx))if(null==s.child1){var _;if(null!=l){var h=s.shape.filter;_=0!=(h.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&h.collisionGroup)}else _=!0;_&&(t?Ke.containTest(this.circShape.zpp_inner,s.shape)&&a.push(s.shape.outer):Ke.testCollide_safe(s.shape,this.circShape.zpp_inner)&&a.push(s.shape.outer))}else null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(!(r.miny>x.maxy||x.miny>r.maxy||r.minx>x.maxx||x.minx>r.maxx))if(null==u.child1){var d;if(null!=l){var v=u.shape.filter;d=0!=(v.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&v.collisionGroup)}else d=!0;d&&(t?Ke.containTest(this.circShape.zpp_inner,u.shape)&&a.push(u.shape.outer):Ke.testCollide_safe(u.shape,this.circShape.zpp_inner)&&a.push(u.shape.outer))}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return a},bodiesInCircle:function(n,e,i,t,l,p){this.sync_broadphase(),this.updateCircShape(n,e,i);var r=this.circShape.zpp_inner.aabb,a=null==p?new Ln:p;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var s=this.treeStack.pop_unsafe(),o=s.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx))if(null==s.child1){var _,h=s.shape.body.outer;if(null!=l){var u=s.shape.filter;_=0!=(u.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&u.collisionGroup)}else _=!0;if(_)if(t){if(!this.failed.has(h)){var x=Ke.containTest(this.circShape.zpp_inner,s.shape);!a.has(h)&&x?a.push(h):x||(a.remove(h),this.failed.push(h))}}else!a.has(h)&&Ke.testCollide_safe(s.shape,this.circShape.zpp_inner)&&a.push(h)}else null!=s.child1&&this.treeStack.add(s.child1),null!=s.child2&&this.treeStack.add(s.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),v=d.aabb;if(!(r.miny>v.maxy||v.miny>r.maxy||r.minx>v.maxx||v.minx>r.maxx))if(null==d.child1){var z,c=d.shape.body.outer;if(null!=l){var m=d.shape.filter;z=0!=(m.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&m.collisionGroup)}else z=!0;if(z)if(t){if(!this.failed.has(c)){var y=Ke.containTest(this.circShape.zpp_inner,d.shape);!a.has(c)&&y?a.push(c):y||(a.remove(c),this.failed.push(c))}}else!a.has(c)&&Ke.testCollide_safe(d.shape,this.circShape.zpp_inner)&&a.push(c)}else null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)}return this.failed.clear(),a},shapesInShape:function(n,e,i,t){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,p=null==t?new ne:t;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r=this.treeStack.pop_unsafe(),a=r.aabb;if(!(l.miny>a.maxy||a.miny>l.maxy||l.minx>a.maxx||a.minx>l.maxx))if(null==r.child1){var s;if(null!=i){var o=r.shape.filter;s=0!=(o.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup)}else s=!0;s&&(e?Ke.containTest(n,r.shape)&&p.push(r.shape.outer):Ke.testCollide_safe(r.shape,n)&&p.push(r.shape.outer))}else null!=r.child1&&this.treeStack.add(r.child1),null!=r.child2&&this.treeStack.add(r.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),h=_.aabb;if(!(l.miny>h.maxy||h.miny>l.maxy||l.minx>h.maxx||h.minx>l.maxx))if(null==_.child1){var u;if(null!=i){var x=_.shape.filter;u=0!=(x.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&x.collisionGroup)}else u=!0;u&&(e?Ke.containTest(n,_.shape)&&p.push(_.shape.outer):Ke.testCollide_safe(_.shape,n)&&p.push(_.shape.outer))}else null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)}return p},bodiesInShape:function(n,e,i,t){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,p=null==t?new Ln:t;if(null==this.failed&&(this.failed=new Ln),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r=this.treeStack.pop_unsafe(),a=r.aabb;if(!(l.miny>a.maxy||a.miny>l.maxy||l.minx>a.maxx||a.minx>l.maxx))if(null==r.child1){var s,o=r.shape.body.outer;if(null!=i){var _=r.shape.filter;s=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else s=!0;if(s)if(e){if(!this.failed.has(o)){var h=Ke.containTest(n,r.shape);!p.has(o)&&h?p.push(o):h||(p.remove(o),this.failed.push(o))}}else!p.has(o)&&Ke.testCollide_safe(r.shape,n)&&p.push(o)}else null!=r.child1&&this.treeStack.add(r.child1),null!=r.child2&&this.treeStack.add(r.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new zt),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(!(l.miny>x.maxy||x.miny>l.maxy||l.minx>x.maxx||x.minx>l.maxx))if(null==u.child1){var d,v=u.shape.body.outer;if(null!=i){var z=u.shape.filter;d=0!=(z.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup)}else d=!0;if(d)if(e){if(!this.failed.has(v)){var c=Ke.containTest(n,u.shape);!p.has(v)&&c?p.push(v):c||(p.remove(v),this.failed.push(v))}}else!p.has(v)&&Ke.testCollide_safe(u.shape,n)&&p.push(v)}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return this.failed.clear(),p},openlist:null,rayCast:function(n,e,i){null==this.openlist&&(this.openlist=new zt),this.sync_broadphase(),n.validate_dir();var t=n.maxdist;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)){var l=n.aabbsect(this.dtree.root.aabb);if(l>=0&&t>l){this.dtree.root.rayt=l;for(var p=null,r=this.openlist.head;null!=r;){if(r.elt.rayt>this.dtree.root.rayt)break;p=r,r=r.next}var a,s=this.openlist,o=this.dtree.root;null==Ht.zpp_pool?a=new Ht:(a=Ht.zpp_pool,Ht.zpp_pool=a.next,a.next=null),a.elt=o;var _=a;null==p?(_.next=s.head,s.head=_):(_.next=p.next,p.next=_),s.pushmod=s.modified=!0,s.length++}}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)){var h=n.aabbsect(this.stree.root.aabb);if(h>=0&&t>h){this.stree.root.rayt=h;for(var u=null,x=this.openlist.head;null!=x;){if(x.elt.rayt>this.stree.root.rayt)break;u=x,x=x.next}var d,v=this.openlist,z=this.stree.root;null==Ht.zpp_pool?d=new Ht:(d=Ht.zpp_pool,Ht.zpp_pool=d.next,d.next=null),d.elt=z;var c=d;null==u?(c.next=v.head,v.head=c):(c.next=u.next,u.next=c),v.pushmod=v.modified=!0,v.length++}}for(var m=null;null!=this.openlist.head;){var y=this.openlist.pop_unsafe();if(y.rayt>=t)break;if(null==y.child1){var f,b=y.shape;if(null!=i){var g=b.filter;f=0!=(g.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&g.collisionGroup)}else f=!0;if(f){var w=b.type==me.id_ShapeType_CIRCLE?n.circlesect(b.circle,e,t):n.aabbtest(b.aabb)?n.polysect(b.polygon,e,t):null;null!=w&&(t=w.zpp_inner.toiDistance,null!=m&&m.zpp_inner.free(),m=w)}}else{if(null!=y.child1&&n.aabbtest(y.child1.aabb)){var M=n.aabbsect(y.child1.aabb);if(M>=0&&t>M){y.child1.rayt=M;for(var C=null,k=this.openlist.head;null!=k;){if(k.elt.rayt>y.child1.rayt)break;C=k,k=k.next}var O,I=this.openlist,S=y.child1;null==Ht.zpp_pool?O=new Ht:(O=Ht.zpp_pool,Ht.zpp_pool=O.next,O.next=null),O.elt=S;var P=O;null==C?(P.next=I.head,I.head=P):(P.next=C.next,C.next=P),I.pushmod=I.modified=!0,I.length++}}if(null!=y.child2&&n.aabbtest(y.child2.aabb)){var T=n.aabbsect(y.child2.aabb);if(T>=0&&t>T){y.child2.rayt=T;for(var A=null,E=this.openlist.head;null!=E;){if(E.elt.rayt>y.child2.rayt)break;A=E,E=E.next}var N,L=this.openlist,V=y.child2;null==Ht.zpp_pool?N=new Ht:(N=Ht.zpp_pool,Ht.zpp_pool=N.next,N.next=null),N.elt=V;var j=N;null==A?(j.next=L.head,L.head=j):(j.next=A.next,A.next=j),L.pushmod=L.modified=!0,L.length++}}}}return this.openlist.clear(),m},rayMultiCast:function(n,e,i,t){null==this.openlist&&(this.openlist=new zt),this.sync_broadphase(),n.validate_dir();var l=n.maxdist>=Infinity,p=null==t?new kn:t;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb))if(l)this.openlist.add(this.dtree.root);else{var r=n.aabbsect(this.dtree.root.aabb);r>=0&&n.maxdist>r&&this.openlist.add(this.dtree.root)}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb))if(l)this.openlist.add(this.stree.root);else{var a=n.aabbsect(this.stree.root.aabb);a>=0&&n.maxdist>a&&this.openlist.add(this.stree.root)}for(;null!=this.openlist.head;){var s=this.openlist.pop_unsafe();if(null==s.child1){var o,_=s.shape;if(null!=i){var h=_.filter;o=0!=(h.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup)}else o=!0;o&&(_.type==me.id_ShapeType_CIRCLE?n.circlesect2(_.circle,e,p):n.aabbtest(_.aabb)&&n.polysect2(_.polygon,e,p))}else{if(null!=s.child1&&n.aabbtest(s.child1.aabb))if(l)this.openlist.add(s.child1);else{var u=n.aabbsect(s.child1.aabb);u>=0&&n.maxdist>u&&this.openlist.add(s.child1)}if(null!=s.child2&&n.aabbtest(s.child2.aabb))if(l)this.openlist.add(s.child2);else{var x=n.aabbsect(s.child2.aabb);x>=0&&n.maxdist>x&&this.openlist.add(s.child2)}}}return this.openlist.clear(),p},__class__:Ri});var Bi=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new vt};l["zpp_nape.space.ZPP_Island"]=Bi,Bi.__name__=["zpp_nape","space","ZPP_Island"],Bi.prototype={next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},comps:null,sleep:null,waket:null,free:function(){},alloc:function(){this.waket=0},__class__:Bi};var Gi=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,this.parent=this,this.rank=0,this.woken=!1};l["zpp_nape.space.ZPP_Component"]=Gi,Gi.__name__=["zpp_nape","space","ZPP_Component"],Gi.prototype={next:null,parent:null,rank:null,isBody:null,body:null,constraint:null,island:null,sleeping:null,waket:null,woken:null,free:function(){this.body=null,this.constraint=null},alloc:function(){},reset:function(){this.sleeping=!1,this.island=null,this.parent=this,this.rank=0},__class__:Gi};var Zi=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new tt};l["zpp_nape.space.ZPP_CallbackSet"]=Zi,Zi.__name__=["zpp_nape","space","ZPP_CallbackSet"],Zi.get=function(n,e){var i;return null==Zi.zpp_pool?i=new Zi:(i=Zi.zpp_pool,Zi.zpp_pool=i.next,i.next=null),i.freed=!1,i.lazydel=!1,i.COLLISIONstate=me.id_PreFlag_ACCEPT,i.COLLISIONstamp=0,i.SENSORstate=me.id_PreFlag_ACCEPT,i.SENSORstamp=0,i.FLUIDstate=me.id_PreFlag_ACCEPT,i.FLUIDstamp=0,e.id>n.id?(i.int1=n,i.int2=e):(i.int1=e,i.int2=n),i.id=i.int1.id,i.di=i.int2.id,i},Zi.prototype={id:null,di:null,int1:null,int2:null,arbiters:null,COLLISIONstate:null,COLLISIONstamp:null,SENSORstate:null,SENSORstamp:null,FLUIDstate:null,FLUIDstamp:null,next:null,elem:function(){return this},begin:function(){return this.next},_inuse:null,modified:null,pushmod:null,length:null,setbegin:function(n){this.next=n,this.modified=!0,this.pushmod=!0},add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},inlined_add:function(n){n._inuse=!0;var e=n;return e.next=this.next,this.next=e,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.next;null!=e;){this.add(e),e=e.next}},insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},inlined_insert:function(n,e){e._inuse=!0;var i=e;return null==n?(i.next=this.next,this.next=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.next;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.next;return this.pop(),n},remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.next;null!=i;){if(i==n){var t,l;null==e?(t=this.next,l=t.next,null==(this.next=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0)),t._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.next,t=!1;null!=i;){if(i==n){var l,p;null==e?(l=this.next,p=l.next,null==(this.next=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0)),l._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;return null==n?(e=this.next,i=e.next,null==(this.next=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){},inlined_clear:function(){},reverse:function(){for(var n=this.next,e=null;null!=n;){var i=n.next;n.next=e,this.next=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.next},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.next;null!=i;){if(i==n){e=!0;break}i=i.next}return e},front:function(){return this.next},back:function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},iterator_at:function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e:null},freed:null,lazydel:null,free:function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},alloc:function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=me.id_PreFlag_ACCEPT,this.COLLISIONstamp=0,this.SENSORstate=me.id_PreFlag_ACCEPT,this.SENSORstamp=0,this.FLUIDstate=me.id_PreFlag_ACCEPT,this.FLUIDstamp=0},add_arb:function(n){var e;e=!1;for(var i=this.arbiters.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}if(e)return!1;var t,l=this.arbiters;null==Vt.zpp_pool?t=new Vt:(t=Vt.zpp_pool,Vt.zpp_pool=t.next,t.next=null),t.elt=n;var p=t;return p.next=l.head,l.head=p,l.modified=!0,l.length++,!0},try_remove_arb:function(n){for(var e=this.arbiters,i=null,t=e.head,l=!1;null!=t;){if(t.elt==n){var p,r;null==i?(p=e.head,r=p.next,null==(e.head=r)&&(e.pushmod=!0)):(p=i.next,r=p.next,i.next=r,null==r&&(e.pushmod=!0));var a=p;a.elt=null,a.next=Vt.zpp_pool,Vt.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0,l=!0;break}i=t,t=t.next}return l},remove_arb:function(n){for(var e=this.arbiters,i=null,t=e.head;null!=t;){if(t.elt==n){var l,p;null==i?(l=e.head,p=l.next,null==(e.head=p)&&(e.pushmod=!0)):(l=i.next,p=l.next,i.next=p,null==p&&(e.pushmod=!0));var r=l;r.elt=null,r.next=Vt.zpp_pool,Vt.zpp_pool=r,e.modified=!0,e.length--,e.pushmod=!0,!0;break}i=t,t=t.next}},empty_arb:function(n){var e;e=!0;for(var i=this.arbiters.head;null!=i;){{if(0!=(i.elt.type&n)){e=!1;break}i=i.next}}return e},really_empty:function(){return null==this.arbiters.head},sleeping:function(){var n;n=!0;for(var e=this.arbiters.head;null!=e;){{if(!e.elt.sleeping){n=!1;break}e=e.next}}return n},__class__:Zi};var Ui=function(n){this.space=null,this.cbsets=null,null==Al.zpp_pool?this.cbsets=new Al:(this.cbsets=Al.zpp_pool,Al.zpp_pool=this.cbsets.next,this.cbsets.next=null);this.cbsets.lt=oe.setlt,this.space=n};l["zpp_nape.space.ZPP_CbSetManager"]=Ui,Ui.__name__=["zpp_nape","space","ZPP_CbSetManager"],Ui.prototype={cbsets:null,space:null,get:function(n){if(null==n.head)return null;var e;null==oe.zpp_pool?e=new oe:(e=oe.zpp_pool,oe.zpp_pool=e.next,e.next=null);var i=e.cbTypes;e.cbTypes=n;var t,l=this.cbsets.find_weak(e);if(null!=l)t=l.data;else{var p=oe.get(n);this.cbsets.insert(p),p.manager=this,t=p}e.cbTypes=i;var r=e;for(r.listeners.clear(),r.zip_listeners=!0,r.bodylisteners.clear(),r.zip_bodylisteners=!0,r.conlisteners.clear(),r.zip_conlisteners=!0;null!=r.cbTypes.head;){r.cbTypes.pop_unsafe().cbsets.remove(r)}return r.next=oe.zpp_pool,oe.zpp_pool=r,t},remove:function(n){for(this.cbsets.remove(n);null!=n.cbpairs.head;){var e=n.cbpairs.pop_unsafe();e.a!=e.b&&(n==e.a?e.b.cbpairs.remove(e):e.a.cbpairs.remove(e));var i=e;i.a=i.b=null,i.listeners.clear(),i.next=_e.zpp_pool,_e.zpp_pool=i}n.manager=null},clear:function(){},validate:function(){if(!this.cbsets.empty()){for(var n=this.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;){if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}},pair:function(n,e){for(var i=null,t=e.cbpairs.length>n.cbpairs.length?n.cbpairs:e.cbpairs,l=t.head;null!=l;){var p=l.elt;if(p.a==n&&p.b==e||p.a==e&&p.b==n){i=p;break}l=l.next}if(null==i){var r;null==_e.zpp_pool?r=new _e:(r=_e.zpp_pool,_e.zpp_pool=r.next,r.next=null),r.zip_listeners=!0,oe.setlt(n,e)?(r.a=n,r.b=e):(r.a=e,r.b=n),i=r,n.cbpairs.add(i),e!=n&&e.cbpairs.add(i)}return i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),i},valid_listener:function(n){return n.space==this.space},__class__:Ui};var qi=function(n,e){this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new gt,this.global_lin_drag=.015,this.global_ang_drag=.015,se.internal=!0,this.precb=new j,this.precb.zpp_inner=new se,se.internal=!1,this.sortcontacts=!0,this.pre_dt=0;var t;null!=e?(null==me.Broadphase_DYNAMIC_AABB_TREE&&(me.internal=!0,me.Broadphase_DYNAMIC_AABB_TREE=new te,me.internal=!1),t=e==me.Broadphase_DYNAMIC_AABB_TREE):t=!0,t?this.bphase=new Ri(this):(null==me.Broadphase_SWEEP_AND_PRUNE&&(me.internal=!0,me.Broadphase_SWEEP_AND_PRUNE=new te,me.internal=!1),e==me.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Ki(this))),this.time=0;null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new et,this.wrap_bodies=ol.get(this.bodies),this.wrap_bodies.zpp_inner.adder=i(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=i(this,this.bodies_subber),this.wrap_bodies.zpp_inner._modifiable=i(this,this.bodies_modifiable),this.compounds=new it,this.wrap_compounds=hl.get(this.compounds),this.wrap_compounds.zpp_inner.adder=i(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=i(this,this.compounds_subber),this.wrap_compounds.zpp_inner._modifiable=i(this,this.compounds_modifiable),this.kinematics=new et,this.c_arbiters_true=new ft,this.c_arbiters_false=new ft,this.f_arbiters=new mt,this.s_arbiters=new yt,this.islands=new Bi,this.live=new et,this.wrap_live=ol.get(this.live,!0),this.staticsleep=new et,this.constraints=new de,this.wrap_constraints=sl.get(this.constraints),this.wrap_constraints.zpp_inner.adder=i(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=i(this,this.constraints_subber),this.wrap_constraints.zpp_inner._modifiable=i(this,this.constraints_modifiable),this.live_constraints=new de,this.wrap_livecon=sl.get(this.live_constraints,!0),this.__static=Ii.__static(),this.__static.zpp_inner.space=this,this.callbacks=new se,this.midstep=!1,this.listeners=new bt,this.wrap_listeners=ul.get(this.listeners),this.wrap_listeners.zpp_inner.adder=i(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=i(this,this.listeners_subber),this.wrap_listeners.zpp_inner._modifiable=i(this,this.listeners_modifiable),this.callbackset_list=new Zi,this.mrca1=new ve,this.mrca2=new ve,this.prelisteners=new he,this.cbsets=new Ui(this)};l["zpp_nape.space.ZPP_Space"]=qi,qi.__name__=["zpp_nape","space","ZPP_Space"],qi.prototype={outer:null,userData:null,gravityx:null,gravityy:null,wrap_gravity:null,getgravity:function(){var n,e=this.gravityx,t=this.gravityy;if(null==Ml.poolVec2?n=new On:(n=Ml.poolVec2,Ml.poolVec2=n.zpp_pool,n.zpp_pool=null,n.zpp_disp=!1,n==Ml.nextVec2&&(Ml.nextVec2=null)),null==n.zpp_inner){var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=e,l.y=t,n.zpp_inner=l,n.zpp_inner.outer=n}else{var p=n.zpp_inner;null!=p._isimmutable&&p._isimmutable();var r,a=n.zpp_inner;if(null!=a._validate&&a._validate(),n.zpp_inner.x==e){var s=n.zpp_inner;null!=s._validate&&s._validate(),r=n.zpp_inner.y==t}else r=!1;if(!r){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=i(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=i(this,this.gravity_validate)},gravity_invalidate:function(n){this.gravityx=n.x,this.gravityy=n.y;for(var e=new it,i=this.bodies.head;null!=i;){var t=i.elt,l=t;l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==me.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!1)),i=i.next}for(var p=this.compounds.head;null!=p;){e.add(p.elt),p=p.next}for(;null!=e.head;){for(var r=e.pop_unsafe(),a=r.bodies.head;null!=a;){var s=a.elt,o=s;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),o.type==me.id_BodyType_KINEMATIC&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),a=a.next}for(var _=r.compounds.head;null!=_;){e.add(_.elt),_=_.next}}},gravity_validate:function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},bodies:null,wrap_bodies:null,compounds:null,wrap_compounds:null,constraints:null,wrap_constraints:null,kinematics:null,bphase:null,__static:null,global_lin_drag:null,global_ang_drag:null,stamp:null,midstep:null,time:null,sortcontacts:null,c_arbiters_true:null,c_arbiters_false:null,f_arbiters:null,s_arbiters:null,wrap_arbiters:null,live:null,wrap_live:null,live_constraints:null,wrap_livecon:null,staticsleep:null,islands:null,listeners:null,wrap_listeners:null,callbacks:null,callbackset_list:null,cbsets:null,clear:function(){for(;null!=this.listeners.head;){this.remListener(this.listeners.pop_unsafe())}for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear();var e=n;e.int1=e.int2=null,e.id=e.di=-1,e.freed=!0,e.next=Zi.zpp_pool,Zi.zpp_pool=e}for(;null!=this.c_arbiters_true.head;){var i=this.c_arbiters_true.pop_unsafe();if(!i.cleared){for(var t=i.b1.arbiters,l=null,p=t.head;null!=p;){if(p.elt==i){var r,a;null==l?(r=t.head,a=r.next,null==(t.head=a)&&(t.pushmod=!0)):(r=l.next,a=r.next,l.next=a,null==a&&(t.pushmod=!0));var s=r;s.elt=null,s.next=Vt.zpp_pool,Vt.zpp_pool=s,t.modified=!0,t.length--,t.pushmod=!0,!0;break}l=p,p=p.next}for(var o=i.b2.arbiters,_=null,h=o.head;null!=h;){if(h.elt==i){var u,x;null==_?(u=o.head,x=u.next,null==(o.head=x)&&(o.pushmod=!0)):(u=_.next,x=u.next,_.next=x,null==x&&(o.pushmod=!0));var d=u;d.elt=null,d.next=Vt.zpp_pool,Vt.zpp_pool=d,o.modified=!0,o.length--,o.pushmod=!0,!0;break}_=h,h=h.next}null!=i.pair&&(i.pair.arb=null,i.pair=null)}for(i.b1=i.b2=null,i.active=!1,i.intchange=!1;null!=i.contacts.next;){var v=i.contacts,z=v.next;v.pop();var c=z;c.arbiter=null,c.next=Re.zpp_pool,Re.zpp_pool=c;var m=i.innards,y=m.next;m.next=y.next,y._inuse=!1,null==m.next&&(m.pushmod=!0),m.modified=!0,m.length--}var f=i;f.userdef_dyn_fric=!1,f.userdef_stat_fric=!1,f.userdef_restitution=!1,f.userdef_rfric=!1,f.__ref_edge1=f.__ref_edge2=null,f.next=Fe.zpp_pool,Fe.zpp_pool=f,i.pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var b=this.c_arbiters_false.pop_unsafe();if(!b.cleared){for(var g=b.b1.arbiters,w=null,M=g.head;null!=M;){if(M.elt==b){var C,k;null==w?(C=g.head,k=C.next,null==(g.head=k)&&(g.pushmod=!0)):(C=w.next,k=C.next,w.next=k,null==k&&(g.pushmod=!0));var O=C;O.elt=null,O.next=Vt.zpp_pool,Vt.zpp_pool=O,g.modified=!0,g.length--,g.pushmod=!0,!0;break}w=M,M=M.next}for(var I=b.b2.arbiters,S=null,P=I.head;null!=P;){if(P.elt==b){var T,A;null==S?(T=I.head,A=T.next,null==(I.head=A)&&(I.pushmod=!0)):(T=S.next,A=T.next,S.next=A,null==A&&(I.pushmod=!0));var E=T;E.elt=null,E.next=Vt.zpp_pool,Vt.zpp_pool=E,I.modified=!0,I.length--,I.pushmod=!0,!0;break}S=P,P=P.next}null!=b.pair&&(b.pair.arb=null,b.pair=null)}for(b.b1=b.b2=null,b.active=!1,b.intchange=!1;null!=b.contacts.next;){var N=b.contacts,L=N.next;N.pop();var V=L;V.arbiter=null,V.next=Re.zpp_pool,Re.zpp_pool=V;var j=b.innards,D=j.next;j.next=D.next,D._inuse=!1,null==j.next&&(j.pushmod=!0),j.modified=!0,j.length--}var F=b;F.userdef_dyn_fric=!1,F.userdef_stat_fric=!1,F.userdef_restitution=!1,F.userdef_rfric=!1,F.__ref_edge1=F.__ref_edge2=null,F.next=Fe.zpp_pool,Fe.zpp_pool=F,b.pre_dt=-1}for(;null!=this.s_arbiters.head;){var R=this.s_arbiters.pop_unsafe();if(!R.cleared){for(var B=R.b1.arbiters,G=null,Z=B.head;null!=Z;){if(Z.elt==R){var U,q;null==G?(U=B.head,q=U.next,null==(B.head=q)&&(B.pushmod=!0)):(U=G.next,q=U.next,G.next=q,null==q&&(B.pushmod=!0));var Y=U;Y.elt=null,Y.next=Vt.zpp_pool,Vt.zpp_pool=Y,B.modified=!0,B.length--,B.pushmod=!0,!0;break}G=Z,Z=Z.next}for(var K=R.b2.arbiters,W=null,J=K.head;null!=J;){if(J.elt==R){var X,H;null==W?(X=K.head,H=X.next,null==(K.head=H)&&(K.pushmod=!0)):(X=W.next,H=X.next,W.next=H,null==H&&(K.pushmod=!0));var Q=X;Q.elt=null,Q.next=Vt.zpp_pool,Vt.zpp_pool=Q,K.modified=!0,K.length--,K.pushmod=!0,!0;break}W=J,J=J.next}null!=R.pair&&(R.pair.arb=null,R.pair=null)}R.b1=R.b2=null,R.active=!1,R.intchange=!1;var $=R;$.next=je.zpp_pool,je.zpp_pool=$}for(;null!=this.f_arbiters.head;){var nn=this.f_arbiters.pop_unsafe();if(!nn.cleared){for(var en=nn.b1.arbiters,tn=null,ln=en.head;null!=ln;){if(ln.elt==nn){var pn,rn;null==tn?(pn=en.head,rn=pn.next,null==(en.head=rn)&&(en.pushmod=!0)):(pn=tn.next,rn=pn.next,tn.next=rn,null==rn&&(en.pushmod=!0));var an=pn;an.elt=null,an.next=Vt.zpp_pool,Vt.zpp_pool=an,en.modified=!0,en.length--,en.pushmod=!0,!0;break}tn=ln,ln=ln.next}for(var sn=nn.b2.arbiters,on=null,_n=sn.head;null!=_n;){if(_n.elt==nn){var hn,un;null==on?(hn=sn.head,un=hn.next,null==(sn.head=un)&&(sn.pushmod=!0)):(hn=on.next,un=hn.next,on.next=un,null==un&&(sn.pushmod=!0));var xn=hn;xn.elt=null,xn.next=Vt.zpp_pool,Vt.zpp_pool=xn,sn.modified=!0,sn.length--,sn.pushmod=!0,!0;break}on=_n,_n=_n.next}null!=nn.pair&&(nn.pair.arb=null,nn.pair=null)}nn.b1=nn.b2=null,nn.active=!1,nn.intchange=!1;var dn=nn;dn.next=De.zpp_pool,De.zpp_pool=dn,nn.pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var vn=this.bodies.pop_unsafe();if(null!=vn.component){var zn=vn.component.island;if(null!=zn){for(;null!=zn.comps.head;){var cn=zn.comps.pop_unsafe();cn.sleeping=!1,cn.island=null,cn.parent=cn,cn.rank=0}var mn=zn;mn.next=Bi.zpp_pool,Bi.zpp_pool=mn}}vn.removedFromSpace(),vn.space=null}for(;null!=this.constraints.head;){var yn=this.constraints.pop_unsafe();if(null!=yn.component){var fn=yn.component.island;if(null!=fn){for(;null!=fn.comps.head;){var bn=fn.comps.pop_unsafe();bn.sleeping=!1,bn.island=null,bn.parent=bn,bn.rank=0}var gn=fn;gn.next=Bi.zpp_pool,Bi.zpp_pool=gn}}yn.removedFromSpace(),yn.space=null}this.kinematics.clear();for(var wn=new it;null!=this.compounds.head;){wn.add(this.compounds.pop_unsafe())}for(;null!=wn.head;){var Mn=wn.pop_unsafe();Mn.removedFromSpace(),Mn.space=null;for(var Cn=Mn.bodies.head;null!=Cn;){var kn=Cn.elt;if(null!=kn.component){var On=kn.component.island;if(null!=On){for(;null!=On.comps.head;){var In=On.comps.pop_unsafe();In.sleeping=!1,In.island=null,In.parent=In,In.rank=0}var Sn=On;Sn.next=Bi.zpp_pool,Bi.zpp_pool=Sn}}kn.removedFromSpace(),kn.space=null,Cn=Cn.next}for(var Pn=Mn.constraints.head;null!=Pn;){var Tn=Pn.elt;if(null!=Tn.component){var An=Tn.component.island;if(null!=An){for(;null!=An.comps.head;){var En=An.comps.pop_unsafe();En.sleeping=!1,En.island=null,En.parent=En,En.rank=0}var Nn=An;Nn.next=Bi.zpp_pool,Bi.zpp_pool=Nn}}Tn.removedFromSpace(),Tn.space=null,Pn=Pn.next}for(var Ln=Mn.compounds.head;null!=Ln;){wn.add(Ln.elt),Ln=Ln.next}}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},bodies_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(n),this.addBody(n.zpp_inner),!0)},bodies_subber:function(n){this.remBody(n.zpp_inner)},bodies_modifiable:function(){},compounds_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),this.addCompound(n.zpp_inner),!0)},compounds_subber:function(n){this.remCompound(n.zpp_inner)},compounds_modifiable:function(){},constraints_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(n),this.addConstraint(n.zpp_inner),!0)},constraints_subber:function(n){this.remConstraint(n.zpp_inner)},constraints_modifiable:function(){},listeners_adder:function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(n),this.addListener(n.zpp_inner),!0)},listeners_subber:function(n){this.remListener(n.zpp_inner)},listeners_modifiable:function(){},revoke_listener:function(n){},unrevoke_listener:function(n){},addListener:function(n){if(n.space=this,n.addedToSpace(),null!=n.interaction);},remListener:function(n){if(null!=n.interaction);n.removedFromSpace(),n.space=null},add_callbackset:function(n){var e,i=n.int1.cbsets;null==Ot.zpp_pool?e=new Ot:(e=Ot.zpp_pool,Ot.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;t.next=i.head,i.head=t,i.modified=!0,i.length++;var l,p=n.int2.cbsets;null==Ot.zpp_pool?l=new Ot:(l=Ot.zpp_pool,Ot.zpp_pool=l.next,l.next=null),l.elt=n;var r=l;r.next=p.head,p.head=r,p.modified=!0,p.length++;var a=this.callbackset_list;n._inuse=!0;var s=n;s.next=a.next,a.next=s,a.modified=!0,a.length++},remove_callbackset:function(n){n.lazydel=!0;for(var e=n.int1.cbsets,i=null,t=e.head;null!=t;){if(t.elt==n){var l,p;null==i?(l=e.head,p=l.next,null==(e.head=p)&&(e.pushmod=!0)):(l=i.next,p=l.next,i.next=p,null==p&&(e.pushmod=!0));var r=l;r.elt=null,r.next=Ot.zpp_pool,Ot.zpp_pool=r,e.modified=!0,e.length--,e.pushmod=!0,!0;break}i=t,t=t.next}for(var a=n.int2.cbsets,s=null,o=a.head;null!=o;){if(o.elt==n){var _,h;null==s?(_=a.head,h=_.next,null==(a.head=h)&&(a.pushmod=!0)):(_=s.next,h=_.next,s.next=h,null==h&&(a.pushmod=!0));var u=_;u.elt=null,u.next=Ot.zpp_pool,Ot.zpp_pool=u,a.modified=!0,a.length--,a.pushmod=!0,!0;break}s=o,o=o.next}},transmitType:function(n,e){var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==me.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),n.type==me.id_BodyType_DYNAMIC?this.live.remove(n):n.type==me.id_BodyType_KINEMATIC?(this.kinematics.remove(n),this.staticsleep.remove(n)):n.type==me.id_BodyType_STATIC&&this.staticsleep.remove(n),n.type=e,n.type==me.id_BodyType_KINEMATIC&&this.kinematics.add(n),n.type==me.id_BodyType_STATIC&&this.static_validation(n),n.component.sleeping=!0;var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==me.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0))},added_shape:function(n,e){if(null==e&&(e=!1),!e){var i=n.body;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==me.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1))}this.bphase.insert(n),n.addedToSpace()},removed_shape:function(n,e){null==e&&(e=!1);var i=this,t=n.body;e||t.wake();for(var l=null,p=t.arbiters.head;null!=p;){var r=p.elt;if(r.ws1==n||r.ws2==n){if(0!=r.present){this.MRCA_chains(r.ws1,r.ws2);for(var a=this.mrca1.head;null!=a;){for(var s=a.elt,o=this.mrca2.head;null!=o;){var _=o.elt,h=s.cbSet,u=_.cbSet;h.validate(),u.validate();for(var x=null,d=u.cbpairs.length>h.cbpairs.length?h.cbpairs:u.cbpairs,v=d.head;null!=v;){var z=v.elt;if(z.a==h&&z.b==u||z.a==u&&z.b==h){x=z;break}v=v.next}if(null==x){var c;null==_e.zpp_pool?c=new _e:(c=_e.zpp_pool,_e.zpp_pool=c.next,c.next=null),c.zip_listeners=!0,oe.setlt(h,u)?(c.a=h,c.b=u):(c.a=u,c.b=h),x=c,h.cbpairs.add(x),u!=h&&u.cbpairs.add(x)}if(x.zip_listeners&&(x.zip_listeners=!1,x.__validate()),null!=x.listeners.head){var m=Oi.get(s,_);m.remove_arb(r),r.present--;for(var y=me.id_CbEvent_END,f=null,b=u.cbpairs.length>h.cbpairs.length?h.cbpairs:u.cbpairs,g=b.head;null!=g;){var w=g.elt;if(w.a==h&&w.b==u||w.a==u&&w.b==h){f=w;break}g=g.next}if(null==f){var M;null==_e.zpp_pool?M=new _e:(M=_e.zpp_pool,_e.zpp_pool=M.next,M.next=null),M.zip_listeners=!0,oe.setlt(h,u)?(M.a=h,M.b=u):(M.a=u,M.b=h),f=M,h.cbpairs.add(f),u!=h&&u.cbpairs.add(f)}f.zip_listeners&&(f.zip_listeners=!1,f.__validate());for(var C=f.listeners.head;null!=C;){var k=C.elt;if(k.event==y&&0!=(k.itype&r.type)&&m.empty_arb(k.itype)){var O=i.push_callback(k);O.event=me.id_CbEvent_END;var I,S=m.int1,P=m.int2,T=k.options1,A=S.cbTypes;if(T.nonemptyintersection(A,T.includes)&&!T.nonemptyintersection(A,T.excludes)){var E=k.options2,N=P.cbTypes;I=!!E.nonemptyintersection(N,E.includes)&&!E.nonemptyintersection(N,E.excludes)}else I=!1;I?(O.int1=S,O.int2=P):(O.int1=P,O.int2=S),O.set=m}C=C.next}null==m.arbiters.head&&this.remove_callbackset(m),o=o.next}else o=o.next}a=a.next}}if(r.b1!=t&&r.b1.type==me.id_BodyType_DYNAMIC){var L=r.b1;L.world||(L.component.waket=this.stamp+(this.midstep?0:1),L.type==me.id_BodyType_KINEMATIC&&(L.kinematicDelaySleep=!0),L.component.sleeping&&this.really_wake(L,!1))}if(r.b2!=t&&r.b2.type==me.id_BodyType_DYNAMIC){var V=r.b2;V.world||(V.component.waket=this.stamp+(this.midstep?0:1),V.type==me.id_BodyType_KINEMATIC&&(V.kinematicDelaySleep=!0),V.component.sleeping&&this.really_wake(V,!1))}if(r.cleared=!0,null==t||r.b2==t)for(var j=r.b1.arbiters,D=null,F=j.head;null!=F;){if(F.elt==r){var R,B;null==D?(R=j.head,B=R.next,null==(j.head=B)&&(j.pushmod=!0)):(R=D.next,B=R.next,D.next=B,null==B&&(j.pushmod=!0));var G=R;G.elt=null,G.next=Vt.zpp_pool,Vt.zpp_pool=G,j.modified=!0,j.length--,j.pushmod=!0,!0;break}D=F,F=F.next}if(null==t||r.b1==t)for(var Z=r.b2.arbiters,U=null,q=Z.head;null!=q;){if(q.elt==r){var Y,K;null==U?(Y=Z.head,K=Y.next,null==(Z.head=K)&&(Z.pushmod=!0)):(Y=U.next,K=Y.next,U.next=K,null==K&&(Z.pushmod=!0));var W=Y;W.elt=null,W.next=Vt.zpp_pool,Vt.zpp_pool=W,Z.modified=!0,Z.length--,Z.pushmod=!0,!0;break}U=q,q=q.next}null!=r.pair&&(r.pair.arb=null,r.pair=null),r.active=!1,this.f_arbiters.modified=!0,p=t.arbiters.erase(l)}else l=p,p=p.next}this.bphase.remove(n),n.removedFromSpace()},addConstraint:function(n){n.space=this,n.addedToSpace(),n.active&&(n.component.sleeping=!0,this.wake_constraint(n,!0))},remConstraint:function(n){n.active&&(this.wake_constraint(n,!0),this.live_constraints.remove(n)),n.removedFromSpace(),n.space=null},addCompound:function(n){n.space=this,n.addedToSpace();for(var e=n.bodies.head;null!=e;){this.addBody(e.elt),e=e.next}for(var i=n.constraints.head;null!=i;){this.addConstraint(i.elt),i=i.next}for(var t=n.compounds.head;null!=t;){this.addCompound(t.elt),t=t.next}},remCompound:function(n){for(var e=n.bodies.head;null!=e;){this.remBody(e.elt),e=e.next}for(var i=n.constraints.head;null!=i;){this.remConstraint(i.elt),i=i.next}for(var t=n.compounds.head;null!=t;){this.remCompound(t.elt),t=t.next}n.removedFromSpace(),n.space=null},addBody:function(n,e){null==e&&(e=-1),n.space=this,n.addedToSpace(),n.component.sleeping=!0;var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==me.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0));for(var t=n.shapes.head;null!=t;){var l=t.elt;this.bphase.insert(l),l.addedToSpace(),t=t.next}n.type==me.id_BodyType_STATIC?this.static_validation(n):n.type!=me.id_BodyType_DYNAMIC&&e!=me.id_BodyType_KINEMATIC&&this.kinematics.add(n)},remBody:function(n,e){if(null==e&&(e=-1),n.type==me.id_BodyType_STATIC){var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==me.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!0)),this.staticsleep.remove(n)}else if(n.type==me.id_BodyType_DYNAMIC){var t=n;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==me.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!0)),this.live.remove(n)}else{e!=me.id_BodyType_KINEMATIC&&this.kinematics.remove(n);var l=n;l.world||(l.component.waket=this.stamp+(this.midstep?0:1),l.type==me.id_BodyType_KINEMATIC&&(l.kinematicDelaySleep=!0),l.component.sleeping&&this.really_wake(l,!0)),this.staticsleep.remove(n)}for(var p=n.shapes.head;null!=p;){this.removed_shape(p.elt,!0),p=p.next}n.removedFromSpace(),n.space=null},shapesUnderPoint:function(n,e,i,t){return this.bphase.shapesUnderPoint(n,e,i,t)},bodiesUnderPoint:function(n,e,i,t){return this.bphase.bodiesUnderPoint(n,e,i,t)},shapesInAABB:function(n,e,i,t,l){return this.bphase.shapesInAABB(n.zpp_inner,e,i,t,l)},bodiesInAABB:function(n,e,i,t,l){return this.bphase.bodiesInAABB(n.zpp_inner,e,i,t,l)},shapesInCircle:function(n,e,i,t,l){var p=this.bphase,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x,s=n.zpp_inner;return null!=s._validate&&s._validate(),p.shapesInCircle(a,n.zpp_inner.y,e,i,t,l)},bodiesInCircle:function(n,e,i,t,l){var p=this.bphase,r=n.zpp_inner;null!=r._validate&&r._validate();var a=n.zpp_inner.x,s=n.zpp_inner;return null!=s._validate&&s._validate(),p.bodiesInCircle(a,n.zpp_inner.y,e,i,t,l)},shapesInShape:function(n,e,i,t){return this.bphase.shapesInShape(n,e,i,t)},bodiesInShape:function(n,e,i,t){return this.bphase.bodiesInShape(n,e,i,t)},rayCast:function(n,e,i){return this.bphase.rayCast(n.zpp_inner,e,null==i?null:i.zpp_inner)},rayMultiCast:function(n,e,i,t){return this.bphase.rayMultiCast(n.zpp_inner,e,null==i?null:i.zpp_inner,t)},convexShapeList:null,convexCast:function(n,e,i,t){var l;if(null==fi.zpp_pool?l=new fi:(l=fi.zpp_pool,fi.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,n.type==me.id_ShapeType_CIRCLE){var p=n.circle;if(p.zip_worldCOM&&null!=p.body){if(p.zip_worldCOM=!1,p.zip_localCOM){if(p.zip_localCOM=!1,p.type==me.id_ShapeType_POLYGON){var r=p.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next){r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;r.localCOMx+=1*r.lverts.next.next.x,r.localCOMy+=1*r.lverts.next.next.y;r.localCOMx*=.5,r.localCOMy*=.5}else{r.localCOMx=0,r.localCOMy=0;var a=0,s=r.lverts.next,o=s;s=s.next;var _=s;for(s=s.next;null!=s;){var h=s;a+=_.x*(h.y-o.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,o=_,_=h,s=s.next}s=r.lverts.next;var x=s;a+=_.x*(x.y-o.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,o=_,_=x,s=s.next;var v=s;a+=_.x*(v.y-o.y);var z=v.y*_.x-v.x*_.y;r.localCOMx+=(_.x+v.x)*z,r.localCOMy+=(_.y+v.y)*z,a=1/(3*a);var c=a;r.localCOMx*=c,r.localCOMy*=c}}null!=p.wrap_localCOM&&(p.wrap_localCOM.zpp_inner.x=p.localCOMx,p.wrap_localCOM.zpp_inner.y=p.localCOMy)}var m=p.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),p.worldCOMx=p.body.posx+(p.body.axisy*p.localCOMx-p.body.axisx*p.localCOMy),p.worldCOMy=p.body.posy+(p.localCOMx*p.body.axisx+p.localCOMy*p.body.axisy)}}else{var y=n.polygon;if(y.zip_gaxi&&null!=y.body){y.zip_gaxi=!1,y.validate_laxi();var f=y.body;if(f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var b=y.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot));for(var g=y.lverts.next,w=y.gverts.next;null!=w;){var M=w,C=g;g=g.next,M.x=y.body.posx+(y.body.axisy*C.x-y.body.axisx*C.y),M.y=y.body.posy+(C.x*y.body.axisx+C.y*y.body.axisy),w=w.next}}var k=y.edges.head,O=y.gverts.next,I=O;for(O=O.next;null!=O;){var S=O,P=k.elt;k=k.next,P.gp0=I,P.gp1=S,P.gnormx=y.body.axisy*P.lnormx-y.body.axisx*P.lnormy,P.gnormy=P.lnormx*y.body.axisx+P.lnormy*y.body.axisy,P.gprojection=y.body.posx*P.gnormx+y.body.posy*P.gnormy+P.lprojection,null!=P.wrap_gnorm&&(P.wrap_gnorm.zpp_inner.x=P.gnormx,P.wrap_gnorm.zpp_inner.y=P.gnormy),P.tp0=P.gp0.y*P.gnormx-P.gp0.x*P.gnormy,P.tp1=P.gp1.y*P.gnormx-P.gp1.x*P.gnormy,I=S,O=O.next}var T=y.gverts.next,A=k.elt;k=k.next,A.gp0=I,A.gp1=T,A.gnormx=y.body.axisy*A.lnormx-y.body.axisx*A.lnormy,A.gnormy=A.lnormx*y.body.axisx+A.lnormy*y.body.axisy,A.gprojection=y.body.posx*A.gnormx+y.body.posy*A.gnormy+A.lprojection,null!=A.wrap_gnorm&&(A.wrap_gnorm.zpp_inner.x=A.gnormx,A.wrap_gnorm.zpp_inner.y=A.gnormy),A.tp0=A.gp0.y*A.gnormx-A.gp0.x*A.gnormy,A.tp1=A.gp1.y*A.gnormx-A.gp1.x*A.gnormy}}var E=n.body,N=E.posx,L=E.posy;E.sweepTime=0,E.sweep_angvel=E.angvel;var V=e-E.sweepTime;if(0!=V){E.sweepTime=e;var j=V;if(E.posx+=E.velx*j,E.posy+=E.vely*j,0!=E.angvel){var D=E.sweep_angvel*V;if(E.rot+=D,D*D>1e-4)E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot);else{var F=D*D,R=1-.5*F,B=1-F*F/8,G=(R*E.axisx+D*E.axisy)*B;E.axisy=(R*E.axisy-D*E.axisx)*B,E.axisx=G}}}var Z=E.posx,U=E.posy;n.validate_sweepRadius();var q,Y=n.sweepRadius;null==qe.zpp_pool?q=new qe:(q=qe.zpp_pool,qe.zpp_pool=q.next,q.next=null);var K=N,W=Z;q.minx=(W>K?K:W)-Y;var J=N,X=Z;q.maxx=(J>X?J:X)+Y;var H=L,Q=U;q.miny=(Q>H?H:Q)-Y;var $=L,nn=U;q.maxy=($>nn?$:nn)+Y;var en=this.convexShapeList=this.bphase.shapesInAABB(q,!1,!1,null==i?null:i.zpp_inner,this.convexShapeList),tn=q;null!=tn.outer&&(tn.outer.zpp_inner=null,tn.outer=null),tn.wrap_min=tn.wrap_max=null,tn._invalidate=null,tn._validate=null,tn.next=qe.zpp_pool,qe.zpp_pool=tn;var ln=0,pn=0;ln=0,pn=0;var rn=0,an=0;rn=0,an=0;var sn=null,on=e+1;en.zpp_inner.valmod();for(var _n=$n.get(en);;){_n.zpp_inner.zpp_inner.valmod();var hn=_n.zpp_inner;hn.zpp_inner.valmod(),hn.zpp_inner.zip_length&&(hn.zpp_inner.zip_length=!1,hn.zpp_inner.user_length=hn.zpp_inner.inner.length);var un=hn.zpp_inner.user_length;_n.zpp_critical=!0;var xn;if(un>_n.zpp_i?xn=!0:(_n.zpp_next=$n.zpp_pool,$n.zpp_pool=_n,_n.zpp_inner=null,xn=!1),!xn)break;_n.zpp_critical=!1;var dn=_n.zpp_inner.at(_n.zpp_i++);if(dn!=n.outer&&(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null)!=E.outer){if(l.s1=n,l.s2=dn.zpp_inner,t){dn.zpp_inner.validate_sweepRadius(),(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,bi.dynamicSweep(l,e,0,0,!0);var vn=(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null).zpp_inner,zn=0-vn.sweepTime;if(0!=zn){vn.sweepTime=0;var cn=zn;if(vn.posx+=vn.velx*cn,vn.posy+=vn.vely*cn,0!=vn.angvel){var mn=vn.sweep_angvel*zn;if(vn.rot+=mn,mn*mn>1e-4)vn.axisx=Math.sin(vn.rot),vn.axisy=Math.cos(vn.rot);else{var yn=mn*mn,fn=1-.5*yn,bn=1-yn*yn/8,gn=(fn*vn.axisx+mn*vn.axisy)*bn;vn.axisy=(fn*vn.axisy-mn*vn.axisx)*bn,vn.axisx=gn}}}var wn=(null!=dn.zpp_inner.body?dn.zpp_inner.body.outer:null).zpp_inner,Mn=dn.zpp_inner;if(Mn.type==me.id_ShapeType_CIRCLE)Mn.worldCOMx=wn.posx+(wn.axisy*Mn.localCOMx-wn.axisx*Mn.localCOMy),Mn.worldCOMy=wn.posy+(Mn.localCOMx*wn.axisx+Mn.localCOMy*wn.axisy);else{for(var Cn=Mn.polygon,kn=Cn.lverts.next,In=Cn.gverts.next;null!=In;){var Sn=In,Pn=kn;kn=kn.next,Sn.x=wn.posx+(wn.axisy*Pn.x-wn.axisx*Pn.y),Sn.y=wn.posy+(Pn.x*wn.axisx+Pn.y*wn.axisy),In=In.next}var Tn=Cn.edges.head,An=Cn.gverts.next,En=An;for(An=An.next;null!=An;){var Nn=An,Ln=Tn.elt;Tn=Tn.next,Ln.gnormx=wn.axisy*Ln.lnormx-wn.axisx*Ln.lnormy,Ln.gnormy=Ln.lnormx*wn.axisx+Ln.lnormy*wn.axisy,Ln.gprojection=wn.posx*Ln.gnormx+wn.posy*Ln.gnormy+Ln.lprojection,Ln.tp0=En.y*Ln.gnormx-En.x*Ln.gnormy,Ln.tp1=Nn.y*Ln.gnormx-Nn.x*Ln.gnormy,En=Nn,An=An.next}var Vn=Cn.gverts.next,jn=Tn.elt;Tn=Tn.next,jn.gnormx=wn.axisy*jn.lnormx-wn.axisx*jn.lnormy,jn.gnormy=jn.lnormx*wn.axisx+jn.lnormy*wn.axisy,jn.gprojection=wn.posx*jn.gnormx+wn.posy*jn.gnormy+jn.lprojection,jn.tp0=En.y*jn.gnormx-En.x*jn.gnormy,jn.tp1=Vn.y*jn.gnormx-Vn.x*jn.gnormy}}else bi.staticSweep(l,e,0,0);l.toi*=e,l.toi>0&&on>l.toi&&(on=l.toi,ln=l.axis.x,pn=l.axis.y,rn=l.c2.x,an=l.c2.y,sn=dn)}}en.clear();var Dn=l;Dn.next=fi.zpp_pool,fi.zpp_pool=Dn;var Fn=0-E.sweepTime;if(0!=Fn){E.sweepTime=0;var Rn=Fn;if(E.posx+=E.velx*Rn,E.posy+=E.vely*Rn,0!=E.angvel){var Bn=E.sweep_angvel*Fn;if(E.rot+=Bn,Bn*Bn>1e-4)E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot);else{var Gn=Bn*Bn,Zn=1-.5*Gn,Un=1-Gn*Gn/8,qn=(Zn*E.axisx+Bn*E.axisy)*Un;E.axisy=(Zn*E.axisy-Bn*E.axisx)*Un,E.axisx=qn}}}if(n.type==me.id_ShapeType_CIRCLE)n.worldCOMx=E.posx+(E.axisy*n.localCOMx-E.axisx*n.localCOMy),n.worldCOMy=E.posy+(n.localCOMx*E.axisx+n.localCOMy*E.axisy);else{for(var Yn=n.polygon,Kn=Yn.lverts.next,Wn=Yn.gverts.next;null!=Wn;){var Jn=Wn,Xn=Kn;Kn=Kn.next,Jn.x=E.posx+(E.axisy*Xn.x-E.axisx*Xn.y),Jn.y=E.posy+(Xn.x*E.axisx+Xn.y*E.axisy),Wn=Wn.next}var Hn=Yn.edges.head,Qn=Yn.gverts.next,ne=Qn;for(Qn=Qn.next;null!=Qn;){var ee=Qn,ie=Hn.elt;Hn=Hn.next,ie.gnormx=E.axisy*ie.lnormx-E.axisx*ie.lnormy,ie.gnormy=ie.lnormx*E.axisx+ie.lnormy*E.axisy,ie.gprojection=E.posx*ie.gnormx+E.posy*ie.gnormy+ie.lprojection,ie.tp0=ne.y*ie.gnormx-ne.x*ie.gnormy,ie.tp1=ee.y*ie.gnormx-ee.x*ie.gnormy,ne=ee,Qn=Qn.next}var te=Yn.gverts.next,le=Hn.elt;Hn=Hn.next,le.gnormx=E.axisy*le.lnormx-E.axisx*le.lnormy,le.gnormy=le.lnormx*E.axisx+le.lnormy*E.axisy,le.gprojection=E.posx*le.gnormx+E.posy*le.gnormy+le.lprojection,le.tp0=ne.y*le.gnormx-ne.x*le.gnormy,le.tp1=te.y*le.gnormx-te.x*le.gnormy}if(on>e)return null;var pe,re=-ln,ae=-pn;if(null==Ml.poolVec2?pe=new On:(pe=Ml.poolVec2,Ml.poolVec2=pe.zpp_pool,pe.zpp_pool=null,pe.zpp_disp=!1,pe==Ml.nextVec2&&(Ml.nextVec2=null)),null==pe.zpp_inner){var se;null==Mi.zpp_pool?se=new Mi:(se=Mi.zpp_pool,Mi.zpp_pool=se.next,se.next=null),se.weak=!1,se._immutable=!1,se.x=re,se.y=ae,pe.zpp_inner=se,pe.zpp_inner.outer=pe}else{var oe=pe.zpp_inner;null!=oe._isimmutable&&oe._isimmutable();var _e,he=pe.zpp_inner;if(null!=he._validate&&he._validate(),pe.zpp_inner.x==re){var ue=pe.zpp_inner;null!=ue._validate&&ue._validate(),_e=pe.zpp_inner.y==ae}else _e=!1;if(!_e){pe.zpp_inner.x=re,pe.zpp_inner.y=ae;var xe=pe.zpp_inner;null!=xe._invalidate&&xe._invalidate(xe)}}pe.zpp_inner.weak=!1;var de;if(null==Ml.poolVec2?de=new On:(de=Ml.poolVec2,Ml.poolVec2=de.zpp_pool,de.zpp_pool=null,de.zpp_disp=!1,de==Ml.nextVec2&&(Ml.nextVec2=null)),null==de.zpp_inner){var ve;null==Mi.zpp_pool?ve=new Mi:(ve=Mi.zpp_pool,Mi.zpp_pool=ve.next,ve.next=null),ve.weak=!1,ve._immutable=!1,ve.x=rn,ve.y=an,de.zpp_inner=ve,de.zpp_inner.outer=de}else{var ze=de.zpp_inner;null!=ze._isimmutable&&ze._isimmutable();var ce,ye=de.zpp_inner;if(null!=ye._validate&&ye._validate(),de.zpp_inner.x==rn){var fe=de.zpp_inner;null!=fe._validate&&fe._validate(),ce=de.zpp_inner.y==an}else ce=!1;if(!ce){de.zpp_inner.x=rn,de.zpp_inner.y=an;var be=de.zpp_inner;null!=be._invalidate&&be._invalidate(be)}}return de.zpp_inner.weak=!1,Je.getConvex(pe,de,on,sn)},prepareCast:function(n){if(n.type==me.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==me.id_ShapeType_POLYGON){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var t=0,l=i.lverts.next,p=l;l=l.next;var r=l;for(l=l.next;null!=l;){var a=l;t+=r.x*(a.y-p.y);var s=a.y*r.x-a.x*r.y;i.localCOMx+=(r.x+a.x)*s,i.localCOMy+=(r.y+a.y)*s,p=r,r=a,l=l.next}l=i.lverts.next;var o=l;t+=r.x*(o.y-p.y);var _=o.y*r.x-o.x*r.y;i.localCOMx+=(r.x+o.x)*_,i.localCOMy+=(r.y+o.y)*_,p=r,r=o,l=l.next;var h=l;t+=r.x*(h.y-p.y);var u=h.y*r.x-h.x*r.y;i.localCOMx+=(r.x+h.x)*u,i.localCOMy+=(r.y+h.y)*u,t=1/(3*t);var x=t;i.localCOMx*=x,i.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}}else{var v=n.polygon;if(v.zip_gaxi&&null!=v.body){v.zip_gaxi=!1,v.validate_laxi();var z=v.body;if(z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var c=v.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var m=v.lverts.next,y=v.gverts.next;null!=y;){var f=y,b=m;m=m.next,f.x=v.body.posx+(v.body.axisy*b.x-v.body.axisx*b.y),f.y=v.body.posy+(b.x*v.body.axisx+b.y*v.body.axisy),y=y.next}}var g=v.edges.head,w=v.gverts.next,M=w;for(w=w.next;null!=w;){var C=w,k=g.elt;g=g.next,k.gp0=M,k.gp1=C,k.gnormx=v.body.axisy*k.lnormx-v.body.axisx*k.lnormy,k.gnormy=k.lnormx*v.body.axisx+k.lnormy*v.body.axisy,k.gprojection=v.body.posx*k.gnormx+v.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy,M=C,w=w.next}var O=v.gverts.next,I=g.elt;g=g.next,I.gp0=M,I.gp1=O,I.gnormx=v.body.axisy*I.lnormx-v.body.axisx*I.lnormy,I.gnormy=I.lnormx*v.body.axisx+I.lnormy*v.body.axisy,I.gprojection=v.body.posx*I.gnormx+v.body.posy*I.gnormy+I.lprojection,null!=I.wrap_gnorm&&(I.wrap_gnorm.zpp_inner.x=I.gnormx,I.wrap_gnorm.zpp_inner.y=I.gnormy),I.tp0=I.gp0.y*I.gnormx-I.gp0.x*I.gnormy,I.tp1=I.gp1.y*I.gnormx-I.gp1.x*I.gnormy}}},convexMultiCast:function(n,e,i,t,l){var p;if(null==fi.zpp_pool?p=new fi:(p=fi.zpp_pool,fi.zpp_pool=p.next,p.next=null),p.failed=!1,p.s1=p.s2=null,p.arbiter=null,n.type==me.id_ShapeType_CIRCLE){var r=n.circle;if(r.zip_worldCOM&&null!=r.body){if(r.zip_worldCOM=!1,r.zip_localCOM){if(r.zip_localCOM=!1,r.type==me.id_ShapeType_POLYGON){var a=r.polygon;if(null==a.lverts.next.next)a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;else if(null==a.lverts.next.next.next){a.localCOMx=a.lverts.next.x,a.localCOMy=a.lverts.next.y;a.localCOMx+=1*a.lverts.next.next.x,a.localCOMy+=1*a.lverts.next.next.y;a.localCOMx*=.5,a.localCOMy*=.5}else{a.localCOMx=0,a.localCOMy=0;var s=0,o=a.lverts.next,_=o;o=o.next;var h=o;for(o=o.next;null!=o;){var u=o;s+=h.x*(u.y-_.y);var x=u.y*h.x-u.x*h.y;a.localCOMx+=(h.x+u.x)*x,a.localCOMy+=(h.y+u.y)*x,_=h,h=u,o=o.next}o=a.lverts.next;var d=o;s+=h.x*(d.y-_.y);var v=d.y*h.x-d.x*h.y;a.localCOMx+=(h.x+d.x)*v,a.localCOMy+=(h.y+d.y)*v,_=h,h=d,o=o.next;var z=o;s+=h.x*(z.y-_.y);var c=z.y*h.x-z.x*h.y;a.localCOMx+=(h.x+z.x)*c,a.localCOMy+=(h.y+z.y)*c,s=1/(3*s);var m=s;a.localCOMx*=m,a.localCOMy*=m}}null!=r.wrap_localCOM&&(r.wrap_localCOM.zpp_inner.x=r.localCOMx,r.wrap_localCOM.zpp_inner.y=r.localCOMy)}var y=r.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),r.worldCOMx=r.body.posx+(r.body.axisy*r.localCOMx-r.body.axisx*r.localCOMy),r.worldCOMy=r.body.posy+(r.localCOMx*r.body.axisx+r.localCOMy*r.body.axisy)}}else{var f=n.polygon;if(f.zip_gaxi&&null!=f.body){f.zip_gaxi=!1,f.validate_laxi();var b=f.body;if(b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)),f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var g=f.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot));for(var w=f.lverts.next,M=f.gverts.next;null!=M;){var C=M,k=w;w=w.next,C.x=f.body.posx+(f.body.axisy*k.x-f.body.axisx*k.y),C.y=f.body.posy+(k.x*f.body.axisx+k.y*f.body.axisy),M=M.next}}var O=f.edges.head,I=f.gverts.next,S=I;for(I=I.next;null!=I;){var P=I,T=O.elt;O=O.next,T.gp0=S,T.gp1=P,T.gnormx=f.body.axisy*T.lnormx-f.body.axisx*T.lnormy,T.gnormy=T.lnormx*f.body.axisx+T.lnormy*f.body.axisy,T.gprojection=f.body.posx*T.gnormx+f.body.posy*T.gnormy+T.lprojection,null!=T.wrap_gnorm&&(T.wrap_gnorm.zpp_inner.x=T.gnormx,T.wrap_gnorm.zpp_inner.y=T.gnormy),T.tp0=T.gp0.y*T.gnormx-T.gp0.x*T.gnormy,T.tp1=T.gp1.y*T.gnormx-T.gp1.x*T.gnormy,S=P,I=I.next}var A=f.gverts.next,E=O.elt;O=O.next,E.gp0=S,E.gp1=A,E.gnormx=f.body.axisy*E.lnormx-f.body.axisx*E.lnormy,E.gnormy=E.lnormx*f.body.axisx+E.lnormy*f.body.axisy,E.gprojection=f.body.posx*E.gnormx+f.body.posy*E.gnormy+E.lprojection,null!=E.wrap_gnorm&&(E.wrap_gnorm.zpp_inner.x=E.gnormx,E.wrap_gnorm.zpp_inner.y=E.gnormy),E.tp0=E.gp0.y*E.gnormx-E.gp0.x*E.gnormy,E.tp1=E.gp1.y*E.gnormx-E.gp1.x*E.gnormy}}var N=n.body,L=N.posx,V=N.posy;N.sweepTime=0,N.sweep_angvel=N.angvel;var j=e-N.sweepTime;if(0!=j){N.sweepTime=e;var D=j;if(N.posx+=N.velx*D,N.posy+=N.vely*D,0!=N.angvel){var F=N.sweep_angvel*j;if(N.rot+=F,F*F>1e-4)N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot);else{var R=F*F,B=1-.5*R,G=1-R*R/8,Z=(B*N.axisx+F*N.axisy)*G;N.axisy=(B*N.axisy-F*N.axisx)*G,N.axisx=Z}}}var U=N.posx,q=N.posy;n.validate_sweepRadius();var Y,K=n.sweepRadius;null==qe.zpp_pool?Y=new qe:(Y=qe.zpp_pool,qe.zpp_pool=Y.next,Y.next=null);var W=L,J=U;Y.minx=(J>W?W:J)-K;var X=L,H=U;Y.maxx=(X>H?X:H)+K;var Q=V,$=q;Y.miny=($>Q?Q:$)-K;var nn=V,en=q;Y.maxy=(nn>en?nn:en)+K;var tn=this.convexShapeList=this.bphase.shapesInAABB(Y,!1,!1,null==i?null:i.zpp_inner,this.convexShapeList),ln=Y;null!=ln.outer&&(ln.outer.zpp_inner=null,ln.outer=null),ln.wrap_min=ln.wrap_max=null,ln._invalidate=null,ln._validate=null,ln.next=qe.zpp_pool,qe.zpp_pool=ln;var pn=null==l?new dn:l;tn.zpp_inner.valmod();for(var rn=$n.get(tn);;){rn.zpp_inner.zpp_inner.valmod();var an=rn.zpp_inner;an.zpp_inner.valmod(),an.zpp_inner.zip_length&&(an.zpp_inner.zip_length=!1,an.zpp_inner.user_length=an.zpp_inner.inner.length);var sn=an.zpp_inner.user_length;rn.zpp_critical=!0;var on;if(sn>rn.zpp_i?on=!0:(rn.zpp_next=$n.zpp_pool,$n.zpp_pool=rn,rn.zpp_inner=null,on=!1),!on)break;rn.zpp_critical=!1;var _n=rn.zpp_inner.at(rn.zpp_i++);if(_n!=n.outer&&(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null)!=N.outer){if(p.s1=n,p.s2=_n.zpp_inner,t){_n.zpp_inner.validate_sweepRadius(),(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,bi.dynamicSweep(p,e,0,0,!0);var hn=(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null).zpp_inner,un=0-hn.sweepTime;if(0!=un){hn.sweepTime=0;var xn=un;if(hn.posx+=hn.velx*xn,hn.posy+=hn.vely*xn,0!=hn.angvel){var vn=hn.sweep_angvel*un;if(hn.rot+=vn,vn*vn>1e-4)hn.axisx=Math.sin(hn.rot),hn.axisy=Math.cos(hn.rot);else{var zn=vn*vn,cn=1-.5*zn,mn=1-zn*zn/8,yn=(cn*hn.axisx+vn*hn.axisy)*mn;hn.axisy=(cn*hn.axisy-vn*hn.axisx)*mn,hn.axisx=yn}}}var fn=(null!=_n.zpp_inner.body?_n.zpp_inner.body.outer:null).zpp_inner,bn=_n.zpp_inner;if(bn.type==me.id_ShapeType_CIRCLE)bn.worldCOMx=fn.posx+(fn.axisy*bn.localCOMx-fn.axisx*bn.localCOMy),bn.worldCOMy=fn.posy+(bn.localCOMx*fn.axisx+bn.localCOMy*fn.axisy);else{for(var gn=bn.polygon,wn=gn.lverts.next,Mn=gn.gverts.next;null!=Mn;){var Cn=Mn,kn=wn;wn=wn.next,Cn.x=fn.posx+(fn.axisy*kn.x-fn.axisx*kn.y),Cn.y=fn.posy+(kn.x*fn.axisx+kn.y*fn.axisy),Mn=Mn.next}var In=gn.edges.head,Sn=gn.gverts.next,Pn=Sn;for(Sn=Sn.next;null!=Sn;){var Tn=Sn,An=In.elt;In=In.next,An.gnormx=fn.axisy*An.lnormx-fn.axisx*An.lnormy,An.gnormy=An.lnormx*fn.axisx+An.lnormy*fn.axisy,An.gprojection=fn.posx*An.gnormx+fn.posy*An.gnormy+An.lprojection,An.tp0=Pn.y*An.gnormx-Pn.x*An.gnormy,An.tp1=Tn.y*An.gnormx-Tn.x*An.gnormy,Pn=Tn,Sn=Sn.next}var En=gn.gverts.next,Nn=In.elt;In=In.next,Nn.gnormx=fn.axisy*Nn.lnormx-fn.axisx*Nn.lnormy,Nn.gnormy=Nn.lnormx*fn.axisx+Nn.lnormy*fn.axisy,Nn.gprojection=fn.posx*Nn.gnormx+fn.posy*Nn.gnormy+Nn.lprojection,Nn.tp0=Pn.y*Nn.gnormx-Pn.x*Nn.gnormy,Nn.tp1=En.y*Nn.gnormx-En.x*Nn.gnormy}}else bi.staticSweep(p,e,0,0);if((p.toi*=e)>0){var Ln,Vn=-p.axis.x,jn=-p.axis.y;if(null==Ml.poolVec2?Ln=new On:(Ln=Ml.poolVec2,Ml.poolVec2=Ln.zpp_pool,Ln.zpp_pool=null,Ln.zpp_disp=!1,Ln==Ml.nextVec2&&(Ml.nextVec2=null)),null==Ln.zpp_inner){var Dn;null==Mi.zpp_pool?Dn=new Mi:(Dn=Mi.zpp_pool,Mi.zpp_pool=Dn.next,Dn.next=null),Dn.weak=!1,Dn._immutable=!1,Dn.x=Vn,Dn.y=jn,Ln.zpp_inner=Dn,Ln.zpp_inner.outer=Ln}else{var Fn=Ln.zpp_inner;null!=Fn._isimmutable&&Fn._isimmutable();var Rn,Bn=Ln.zpp_inner;if(null!=Bn._validate&&Bn._validate(),Ln.zpp_inner.x==Vn){var Gn=Ln.zpp_inner;null!=Gn._validate&&Gn._validate(),Rn=Ln.zpp_inner.y==jn}else Rn=!1;if(!Rn){Ln.zpp_inner.x=Vn,Ln.zpp_inner.y=jn;var Zn=Ln.zpp_inner;null!=Zn._invalidate&&Zn._invalidate(Zn)}}Ln.zpp_inner.weak=!1;var Un,qn=p.c2.x,Yn=p.c2.y;if(null==Ml.poolVec2?Un=new On:(Un=Ml.poolVec2,Ml.poolVec2=Un.zpp_pool,Un.zpp_pool=null,Un.zpp_disp=!1,Un==Ml.nextVec2&&(Ml.nextVec2=null)),null==Un.zpp_inner){var Kn;null==Mi.zpp_pool?Kn=new Mi:(Kn=Mi.zpp_pool,Mi.zpp_pool=Kn.next,Kn.next=null),Kn.weak=!1,Kn._immutable=!1,Kn.x=qn,Kn.y=Yn,Un.zpp_inner=Kn,Un.zpp_inner.outer=Un}else{var Wn=Un.zpp_inner;null!=Wn._isimmutable&&Wn._isimmutable();var Jn,Xn=Un.zpp_inner;if(null!=Xn._validate&&Xn._validate(),Un.zpp_inner.x==qn){var Hn=Un.zpp_inner;null!=Hn._validate&&Hn._validate(),Jn=Un.zpp_inner.y==Yn}else Jn=!1;if(!Jn){Un.zpp_inner.x=qn,Un.zpp_inner.y=Yn;var Qn=Un.zpp_inner;null!=Qn._invalidate&&Qn._invalidate(Qn)}}Un.zpp_inner.weak=!1;for(var ne=Je.getConvex(Ln,Un,p.toi,_n),ee=null,ie=pn.zpp_inner.inner.head;null!=ie;){var te=ie.elt;if(te.zpp_inner.toiDistance>ne.zpp_inner.toiDistance)break;ee=ie,ie=ie.next}var le,pe=pn.zpp_inner.inner;null==ll.zpp_pool?le=new ll:(le=ll.zpp_pool,ll.zpp_pool=le.next,le.next=null),le.elt=ne;var re=le;null==ee?(re.next=pe.head,pe.head=re):(re.next=ee.next,ee.next=re),pe.pushmod=pe.modified=!0,pe.length++}}}tn.clear();var ae=p;ae.next=fi.zpp_pool,fi.zpp_pool=ae;var se=0-N.sweepTime;if(0!=se){N.sweepTime=0;var oe=se;if(N.posx+=N.velx*oe,N.posy+=N.vely*oe,0!=N.angvel){var _e=N.sweep_angvel*se;if(N.rot+=_e,_e*_e>1e-4)N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot);else{var he=_e*_e,ue=1-.5*he,xe=1-he*he/8,de=(ue*N.axisx+_e*N.axisy)*xe;N.axisy=(ue*N.axisy-_e*N.axisx)*xe,N.axisx=de}}}if(n.type==me.id_ShapeType_CIRCLE)n.worldCOMx=N.posx+(N.axisy*n.localCOMx-N.axisx*n.localCOMy),n.worldCOMy=N.posy+(n.localCOMx*N.axisx+n.localCOMy*N.axisy);else{for(var ve=n.polygon,ze=ve.lverts.next,ce=ve.gverts.next;null!=ce;){var ye=ce,fe=ze;ze=ze.next,ye.x=N.posx+(N.axisy*fe.x-N.axisx*fe.y),ye.y=N.posy+(fe.x*N.axisx+fe.y*N.axisy),ce=ce.next}var be=ve.edges.head,ge=ve.gverts.next,we=ge;for(ge=ge.next;null!=ge;){var Me=ge,Ce=be.elt;be=be.next,Ce.gnormx=N.axisy*Ce.lnormx-N.axisx*Ce.lnormy,Ce.gnormy=Ce.lnormx*N.axisx+Ce.lnormy*N.axisy,Ce.gprojection=N.posx*Ce.gnormx+N.posy*Ce.gnormy+Ce.lprojection,Ce.tp0=we.y*Ce.gnormx-we.x*Ce.gnormy,Ce.tp1=Me.y*Ce.gnormx-Me.x*Ce.gnormy,we=Me,ge=ge.next}var ke=ve.gverts.next,Oe=be.elt;be=be.next,Oe.gnormx=N.axisy*Oe.lnormx-N.axisx*Oe.lnormy,Oe.gnormy=Oe.lnormx*N.axisx+Oe.lnormy*N.axisy,Oe.gprojection=N.posx*Oe.gnormx+N.posy*Oe.gnormy+Oe.lprojection,Oe.tp0=we.y*Oe.gnormx-we.x*Oe.gnormy,Oe.tp1=ke.y*Oe.gnormx-ke.x*Oe.gnormy}return pn},push_callback:function(n){var e;return null==se.zpp_pool?e=new se:(e=se.zpp_pool,se.zpp_pool=e.next,e.next=null),this.callbacks.push(e),e.listener=n,e},pre_dt:null,step:function(n,e,i){var t=this;if(this.time+=n,this.pre_dt=n,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(n),this.sortcontacts){var l=this.c_arbiters_false;if(null!=l.head&&null!=l.head.next){for(var p,r,a,s=l.head,o=null,_=null,h=null,u=null,x=1;;){for(p=0,_=s,s=null,o=s;null!=_;){for(++p,h=_,r=0,a=x;null!=h&&x>r;)++r,h=h.next;for(;r>0||a>0&&null!=h;)0==r?(u=h,h=h.next,--a):0==a||null==h?(u=_,_=_.next,--r):_.elt.active&&h.elt.active&&_.elt.oc1.dist>=h.elt.oc1.dist?(u=h,h=h.next,--a):(u=_,_=_.next,--r),null!=o?o.next=u:s=u,o=u;_=h}if(o.next=null,x<<=1,p<=1)break}l.head=s,l.modified=!0,l.pushmod=!0}}this.updateVel(n),this.warmStart(),this.iterateVel(e);for(var d=this.kinematics.head;null!=d;){var v=d.elt;v.pre_posx=v.posx,v.pre_posy=v.posy,v.pre_rot=v.rot,d=d.next}for(var z=this.live.head;null!=z;){var c=z.elt;c.pre_posx=c.posx,c.pre_posy=c.posy,c.pre_rot=c.rot,z=z.next}this.updatePos(n),this.continuous=!0,this.continuousCollisions(n),this.continuous=!1,this.iteratePos(i);for(var m=this.kinematics.head;null!=m;){var y=m.elt,f=!(y.posx==y.pre_posx&&y.posy==y.pre_posy),b=y.pre_rot!=y.rot;if(f){for(var g=y.shapes.head;null!=g;){var w=g.elt;w.type==me.id_ShapeType_POLYGON&&(w.polygon.invalidate_gverts(),w.polygon.invalidate_gaxi()),w.invalidate_worldCOM(),g=g.next}y.zip_worldCOM=!0}if(b){y.zip_axis=!0;for(var M=y.shapes.head;null!=M;){var C=M.elt;C.type==me.id_ShapeType_POLYGON&&(C.polygon.invalidate_gverts(),C.polygon.invalidate_gaxi()),C.invalidate_worldCOM(),M=M.next}y.zip_worldCOM=!0}m=m.next}for(var k=this.live.head;null!=k;){var O=k.elt,I=!(O.posx==O.pre_posx&&O.posy==O.pre_posy),S=O.pre_rot!=O.rot;if(I){for(var P=O.shapes.head;null!=P;){var T=P.elt;T.type==me.id_ShapeType_POLYGON&&(T.polygon.invalidate_gverts(),T.polygon.invalidate_gaxi()),T.invalidate_worldCOM(),P=P.next}O.zip_worldCOM=!0}if(S){O.zip_axis=!0;for(var A=O.shapes.head;null!=A;){var E=A.elt;E.type==me.id_ShapeType_POLYGON&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),A=A.next}O.zip_worldCOM=!0}k=k.next}for(var N=null,L=this.staticsleep.head;null!=L;){var V=L.elt;if(V.type!=me.id_BodyType_KINEMATIC||0==V.velx&&0==V.vely&&0==V.angvel){if(V.kinematicDelaySleep){V.kinematicDelaySleep=!1,L=L.next;continue}V.component.sleeping=!0;var j,D,F=this.staticsleep;null==N?(j=F.head,D=j.next,null==(F.head=D)&&(F.pushmod=!0)):(j=N.next,D=j.next,N.next=D,null==D&&(F.pushmod=!0));var R=j;R.elt=null,R.next=St.zpp_pool,St.zpp_pool=R,F.modified=!0,F.length--,F.pushmod=!0,L=D}else N=L,L=L.next}this.doForests(n),this.sleepArbiters(),this.midstep=!1;for(var B=null,G=this.callbackset_list.next;null!=G;){var Z=G;if(null!=Z.arbiters.head){var U;U=!0;for(var q=Z.arbiters.head;null!=q;){{if(!q.elt.sleeping){U=!1;break}q=q.next}}for(var Y=U,K=Z.int1.cbSet,W=Z.int2.cbSet,J=me.id_CbEvent_ONGOING,X=null,H=W.cbpairs.length>K.cbpairs.length?K.cbpairs:W.cbpairs,Q=H.head;null!=Q;){var $=Q.elt;if($.a==K&&$.b==W||$.a==W&&$.b==K){X=$;break}Q=Q.next}if(null==X){var nn;null==_e.zpp_pool?nn=new _e:(nn=_e.zpp_pool,_e.zpp_pool=nn.next,nn.next=null),nn.zip_listeners=!0,oe.setlt(K,W)?(nn.a=K,nn.b=W):(nn.a=W,nn.b=K),X=nn,K.cbpairs.add(X),W!=K&&W.cbpairs.add(X)}X.zip_listeners&&(X.zip_listeners=!1,X.__validate());for(var en=X.listeners.head;null!=en;){var tn=en.elt;if(tn.event==J&&(!Y||tn.allowSleepingCallbacks)&&!Z.empty_arb(tn.itype)){var ln=t.push_callback(tn);ln.event=me.id_CbEvent_ONGOING;var pn,rn=Z.int1,an=Z.int2,sn=tn.options1,on=rn.cbTypes;if(sn.nonemptyintersection(on,sn.includes)&&!sn.nonemptyintersection(on,sn.excludes)){var _n=tn.options2,hn=an.cbTypes;pn=!!_n.nonemptyintersection(hn,_n.includes)&&!_n.nonemptyintersection(hn,_n.excludes)}else pn=!1;pn?(ln.int1=rn,ln.int2=an):(ln.int1=an,ln.int2=rn),ln.set=Z}en=en.next}B=G,G=G.next}else{var un,xn,dn=this.callbackset_list;null==B?(un=dn.next,xn=un.next,null==(dn.next=xn)&&(dn.pushmod=!0)):(un=B.next,xn=un.next,B.next=xn,null==xn&&(dn.pushmod=!0)),un._inuse=!1,dn.modified=!0,dn.length--,dn.pushmod=!0,G=xn;var vn=Z;vn.int1=vn.int2=null,vn.id=vn.di=-1,vn.freed=!0,vn.next=Zi.zpp_pool,Zi.zpp_pool=vn}}for(;!this.callbacks.empty();){var zn=this.callbacks.pop();if(zn.listener.type==me.id_ListenerType_BODY){zn.listener.body.handler(zn.wrapper_body())}else if(zn.listener.type==me.id_ListenerType_CONSTRAINT){var cn=zn.listener.constraint;cn.handler(zn.wrapper_con())}else if(zn.listener.type==me.id_ListenerType_INTERACTION){var mn=zn.listener.interaction;mn.handleri(zn.wrapper_int())}var yn=zn;yn.int1=yn.int2=null,yn.body=null,yn.constraint=null,yn.listener=null,null!=yn.wrap_arbiters&&(yn.wrap_arbiters.zpp_inner.inner=null),yn.set=null,yn.next=se.zpp_pool,se.zpp_pool=yn}},toiEvents:null,continuousCollisions:function(n){var e=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var i=0;1>i&&null!=this.toiEvents.head;){for(var t=null,l=2,p=!1,r=null,a=null,s=this.toiEvents.head;null!=s;){var o=s.elt,_=o.s1.body,h=o.s2.body;if(_.sweepFrozen&&h.sweepFrozen){if(0==o.toi||!Ke.testCollide_safe(o.s1,o.s2)){s=this.toiEvents.erase(a);var u=o;u.next=fi.zpp_pool,fi.zpp_pool=u;continue}o.toi=0}if(o.frozen1!=_.sweepFrozen||o.frozen2!=h.sweepFrozen){if(o.kinematic){s=this.toiEvents.erase(a);var x=o;x.next=fi.zpp_pool,fi.zpp_pool=x;continue}if(o.frozen1=_.sweepFrozen,o.frozen2=h.sweepFrozen,o.frozen1){var d=o.s1;o.s1=o.s2,o.s2=d,o.frozen1=!1,o.frozen2=!0}if(bi.staticSweep(o,n,0,y.collisionSlopCCD),0>o.toi){s=this.toiEvents.erase(a);var v=o;v.next=fi.zpp_pool,fi.zpp_pool=v;continue}}o.toi>=0&&(l>o.toi||!p&&o.kinematic)&&(t=o,l=o.toi,p=o.kinematic,r=a),a=s,s=s.next}if(null==t)break;this.toiEvents.erase(r),i=t.toi;var z=t.s1.body,c=t.s2.body;if(!z.sweepFrozen){var m=i*n,f=m-z.sweepTime;if(0!=f){z.sweepTime=m;var b=f;if(z.posx+=z.velx*b,z.posy+=z.vely*b,0!=z.angvel){var g=z.sweep_angvel*f;if(z.rot+=g,g*g>1e-4)z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot);else{var w=g*g,M=1-.5*w,C=1-w*w/8,k=(M*z.axisx+g*z.axisy)*C;z.axisy=(M*z.axisy-g*z.axisx)*C,z.axisx=k}}}var O=t.s1;if(O.type==me.id_ShapeType_CIRCLE)O.worldCOMx=z.posx+(z.axisy*O.localCOMx-z.axisx*O.localCOMy),O.worldCOMy=z.posy+(O.localCOMx*z.axisx+O.localCOMy*z.axisy);else{for(var I=O.polygon,S=I.lverts.next,P=I.gverts.next;null!=P;){var T=P,A=S;S=S.next,T.x=z.posx+(z.axisy*A.x-z.axisx*A.y),T.y=z.posy+(A.x*z.axisx+A.y*z.axisy),P=P.next}var E=I.edges.head,N=I.gverts.next,L=N;for(N=N.next;null!=N;){var V=N,j=E.elt;E=E.next,j.gnormx=z.axisy*j.lnormx-z.axisx*j.lnormy,j.gnormy=j.lnormx*z.axisx+j.lnormy*z.axisy,j.gprojection=z.posx*j.gnormx+z.posy*j.gnormy+j.lprojection,j.tp0=L.y*j.gnormx-L.x*j.gnormy,j.tp1=V.y*j.gnormx-V.x*j.gnormy,L=V,N=N.next}var D=I.gverts.next,F=E.elt;E=E.next,F.gnormx=z.axisy*F.lnormx-z.axisx*F.lnormy,F.gnormy=F.lnormx*z.axisx+F.lnormy*z.axisy,F.gprojection=z.posx*F.gnormx+z.posy*F.gnormy+F.lprojection,F.tp0=L.y*F.gnormx-L.x*F.gnormy,F.tp1=D.y*F.gnormx-D.x*F.gnormy}}if(!c.sweepFrozen){var R=i*n,B=R-c.sweepTime;if(0!=B){c.sweepTime=R;var G=B;if(c.posx+=c.velx*G,c.posy+=c.vely*G,0!=c.angvel){var Z=c.sweep_angvel*B;if(c.rot+=Z,Z*Z>1e-4)c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot);else{var U=Z*Z,q=1-.5*U,Y=1-U*U/8,K=(q*c.axisx+Z*c.axisy)*Y;c.axisy=(q*c.axisy-Z*c.axisx)*Y,c.axisx=K}}}var W=t.s2;if(W.type==me.id_ShapeType_CIRCLE)W.worldCOMx=c.posx+(c.axisy*W.localCOMx-c.axisx*W.localCOMy),W.worldCOMy=c.posy+(W.localCOMx*c.axisx+W.localCOMy*c.axisy);else{for(var J=W.polygon,X=J.lverts.next,H=J.gverts.next;null!=H;){var Q=H,$=X;X=X.next,Q.x=c.posx+(c.axisy*$.x-c.axisx*$.y),Q.y=c.posy+($.x*c.axisx+$.y*c.axisy),H=H.next}var nn=J.edges.head,en=J.gverts.next,tn=en;for(en=en.next;null!=en;){var ln=en,pn=nn.elt;nn=nn.next,pn.gnormx=c.axisy*pn.lnormx-c.axisx*pn.lnormy,pn.gnormy=pn.lnormx*c.axisx+pn.lnormy*c.axisy,pn.gprojection=c.posx*pn.gnormx+c.posy*pn.gnormy+pn.lprojection,pn.tp0=tn.y*pn.gnormx-tn.x*pn.gnormy,pn.tp1=ln.y*pn.gnormx-ln.x*pn.gnormy,tn=ln,en=en.next}var rn=J.gverts.next,an=nn.elt;nn=nn.next,an.gnormx=c.axisy*an.lnormx-c.axisx*an.lnormy,an.gnormy=an.lnormx*c.axisx+an.lnormy*c.axisy,an.gprojection=c.posx*an.gnormx+c.posy*an.gnormy+an.lprojection,an.tp0=tn.y*an.gnormx-tn.x*an.gnormy,an.tp1=rn.y*an.gnormx-rn.x*an.gnormy}}var sn=this.narrowPhase(t.s1,t.s2,!0,t.arbiter,!0);if(null==sn)null!=t.arbiter&&null!=t.arbiter.pair&&(t.arbiter.pair.arb=null,t.arbiter.pair=null);else if(!this.presteparb(sn,n,!0)&&sn.type==Ve.COL&&sn.active&&0!=(sn.immState&me.id_ImmState_ACCEPT)){var on=sn.colarb,_n=on.nx*on.c1.jnAcc-on.ny*on.c1.jtAcc,hn=on.ny*on.c1.jnAcc+on.nx*on.c1.jtAcc,un=on.b1.imass;on.b1.velx-=_n*un,on.b1.vely-=hn*un,on.b1.angvel-=on.b1.iinertia*(hn*on.c1.r1x-_n*on.c1.r1y);var xn=on.b2.imass;if(on.b2.velx+=_n*xn,on.b2.vely+=hn*xn,on.b2.angvel+=on.b2.iinertia*(hn*on.c1.r2x-_n*on.c1.r2y),on.hc2){var dn=on.nx*on.c2.jnAcc-on.ny*on.c2.jtAcc,vn=on.ny*on.c2.jnAcc+on.nx*on.c2.jtAcc,zn=on.b1.imass;on.b1.velx-=dn*zn,on.b1.vely-=vn*zn,on.b1.angvel-=on.b1.iinertia*(vn*on.c2.r1x-dn*on.c2.r1y);var cn=on.b2.imass;on.b2.velx+=dn*cn,on.b2.vely+=vn*cn,on.b2.angvel+=on.b2.iinertia*(vn*on.c2.r2x-dn*on.c2.r2y)}on.b2.angvel+=on.jrAcc*on.b2.iinertia,on.b1.angvel-=on.jrAcc*on.b1.iinertia;var mn,yn,fn,bn,gn,wn,Mn=sn.colarb,Cn=Mn.k1x+Mn.b2.velx-Mn.c1.r2y*Mn.b2.angvel-(Mn.b1.velx-Mn.c1.r1y*Mn.b1.angvel),kn=Mn.k1y+Mn.b2.vely+Mn.c1.r2x*Mn.b2.angvel-(Mn.b1.vely+Mn.c1.r1x*Mn.b1.angvel);if(fn=(kn*Mn.nx-Cn*Mn.ny+Mn.surfacex)*Mn.c1.tMass,bn=Mn.c1.friction*Mn.c1.jnAcc,gn=Mn.c1.jtAcc,wn=gn-fn,wn>bn?wn=bn:-bn>wn&&(wn=-bn),fn=wn-gn,Mn.c1.jtAcc=wn,mn=-Mn.ny*fn,yn=Mn.nx*fn,Mn.b2.velx+=mn*Mn.b2.imass,Mn.b2.vely+=yn*Mn.b2.imass,Mn.b1.velx-=mn*Mn.b1.imass,Mn.b1.vely-=yn*Mn.b1.imass,Mn.b2.angvel+=Mn.rt1b*fn*Mn.b2.iinertia,Mn.b1.angvel-=Mn.rt1a*fn*Mn.b1.iinertia,Mn.hc2){var On=Mn.k2x+Mn.b2.velx-Mn.c2.r2y*Mn.b2.angvel-(Mn.b1.velx-Mn.c2.r1y*Mn.b1.angvel),In=Mn.k2y+Mn.b2.vely+Mn.c2.r2x*Mn.b2.angvel-(Mn.b1.vely+Mn.c2.r1x*Mn.b1.angvel);fn=(In*Mn.nx-On*Mn.ny+Mn.surfacex)*Mn.c2.tMass,bn=Mn.c2.friction*Mn.c2.jnAcc,gn=Mn.c2.jtAcc,wn=gn-fn,wn>bn?wn=bn:-bn>wn&&(wn=-bn),fn=wn-gn,Mn.c2.jtAcc=wn,mn=-Mn.ny*fn,yn=Mn.nx*fn,Mn.b2.velx+=mn*Mn.b2.imass,Mn.b2.vely+=yn*Mn.b2.imass,Mn.b1.velx-=mn*Mn.b1.imass,Mn.b1.vely-=yn*Mn.b1.imass,Mn.b2.angvel+=Mn.rt2b*fn*Mn.b2.iinertia,Mn.b1.angvel-=Mn.rt2a*fn*Mn.b1.iinertia,Cn=Mn.k1x+Mn.b2.velx-Mn.c1.r2y*Mn.b2.angvel-(Mn.b1.velx-Mn.c1.r1y*Mn.b1.angvel),kn=Mn.k1y+Mn.b2.vely+Mn.c1.r2x*Mn.b2.angvel-(Mn.b1.vely+Mn.c1.r1x*Mn.b1.angvel),On=Mn.k2x+Mn.b2.velx-Mn.c2.r2y*Mn.b2.angvel-(Mn.b1.velx-Mn.c2.r1y*Mn.b1.angvel),In=Mn.k2y+Mn.b2.vely+Mn.c2.r2x*Mn.b2.angvel-(Mn.b1.vely+Mn.c2.r1x*Mn.b1.angvel);var Sn=Mn.c1.jnAcc,Pn=Mn.c2.jnAcc,Tn=Cn*Mn.nx+kn*Mn.ny+Mn.surfacey+Mn.c1.bounce-(Mn.Ka*Sn+Mn.Kb*Pn),An=On*Mn.nx+In*Mn.ny+Mn.surfacey+Mn.c2.bounce-(Mn.Kb*Sn+Mn.Kc*Pn),En=-(Mn.kMassa*Tn+Mn.kMassb*An),Nn=-(Mn.kMassb*Tn+Mn.kMassc*An);0>En||0>Nn?(En=-Mn.c1.nMass*Tn,0>En||0>Mn.Kb*En+An?(Nn=-Mn.c2.nMass*An,0>Nn||0>Mn.Kb*Nn+Tn?0>Tn||0>An?(Tn=0,An=0):(Tn=-Sn,An=-Pn,Mn.c1.jnAcc=Mn.c2.jnAcc=0):(Tn=-Sn,An=Nn-Pn,Mn.c1.jnAcc=0,Mn.c2.jnAcc=Nn)):(Tn=En-Sn,An=-Pn,Mn.c1.jnAcc=En,Mn.c2.jnAcc=0)):(Tn=En-Sn,An=Nn-Pn,Mn.c1.jnAcc=En,Mn.c2.jnAcc=Nn),fn=Tn+An,mn=Mn.nx*fn,yn=Mn.ny*fn,Mn.b2.velx+=mn*Mn.b2.imass,Mn.b2.vely+=yn*Mn.b2.imass,Mn.b1.velx-=mn*Mn.b1.imass,Mn.b1.vely-=yn*Mn.b1.imass,Mn.b2.angvel+=(Mn.rn1b*Tn+Mn.rn2b*An)*Mn.b2.iinertia,Mn.b1.angvel-=(Mn.rn1a*Tn+Mn.rn2a*An)*Mn.b1.iinertia}else{if(0!=Mn.radius){var Ln=Mn.b2.angvel-Mn.b1.angvel;fn=Ln*Mn.rMass,bn=Mn.rfric*Mn.c1.jnAcc,gn=Mn.jrAcc,Mn.jrAcc-=fn,Mn.jrAcc>bn?Mn.jrAcc=bn:-bn>Mn.jrAcc&&(Mn.jrAcc=-bn),fn=Mn.jrAcc-gn,Mn.b2.angvel+=fn*Mn.b2.iinertia,Mn.b1.angvel-=fn*Mn.b1.iinertia}Cn=Mn.k1x+Mn.b2.velx-Mn.c1.r2y*Mn.b2.angvel-(Mn.b1.velx-Mn.c1.r1y*Mn.b1.angvel),kn=Mn.k1y+Mn.b2.vely+Mn.c1.r2x*Mn.b2.angvel-(Mn.b1.vely+Mn.c1.r1x*Mn.b1.angvel),fn=(Mn.c1.bounce+(Mn.nx*Cn+Mn.ny*kn)+Mn.surfacey)*Mn.c1.nMass,gn=Mn.c1.jnAcc,wn=gn-fn,0>wn&&(wn=0),fn=wn-gn,Mn.c1.jnAcc=wn,mn=Mn.nx*fn,yn=Mn.ny*fn,Mn.b2.velx+=mn*Mn.b2.imass,Mn.b2.vely+=yn*Mn.b2.imass,Mn.b1.velx-=mn*Mn.b1.imass,Mn.b1.vely-=yn*Mn.b1.imass,Mn.b2.angvel+=Mn.rn1b*fn*Mn.b2.iinertia,Mn.b1.angvel-=Mn.rn1a*fn*Mn.b1.iinertia}var Vn,jn,Dn,Fn,Rn,Bn,Gn=sn.colarb,Zn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel);if(Dn=(Un*Gn.nx-Zn*Gn.ny+Gn.surfacex)*Gn.c1.tMass,Fn=Gn.c1.friction*Gn.c1.jnAcc,Rn=Gn.c1.jtAcc,Bn=Rn-Dn,Bn>Fn?Bn=Fn:-Fn>Bn&&(Bn=-Fn),Dn=Bn-Rn,Gn.c1.jtAcc=Bn,Vn=-Gn.ny*Dn,jn=Gn.nx*Dn,Gn.b2.velx+=Vn*Gn.b2.imass,Gn.b2.vely+=jn*Gn.b2.imass,Gn.b1.velx-=Vn*Gn.b1.imass,Gn.b1.vely-=jn*Gn.b1.imass,Gn.b2.angvel+=Gn.rt1b*Dn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rt1a*Dn*Gn.b1.iinertia,Gn.hc2){var qn=Gn.k2x+Gn.b2.velx-Gn.c2.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c2.r1y*Gn.b1.angvel),Yn=Gn.k2y+Gn.b2.vely+Gn.c2.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c2.r1x*Gn.b1.angvel);Dn=(Yn*Gn.nx-qn*Gn.ny+Gn.surfacex)*Gn.c2.tMass,Fn=Gn.c2.friction*Gn.c2.jnAcc,Rn=Gn.c2.jtAcc,Bn=Rn-Dn,Bn>Fn?Bn=Fn:-Fn>Bn&&(Bn=-Fn),Dn=Bn-Rn,Gn.c2.jtAcc=Bn,Vn=-Gn.ny*Dn,jn=Gn.nx*Dn,Gn.b2.velx+=Vn*Gn.b2.imass,Gn.b2.vely+=jn*Gn.b2.imass,Gn.b1.velx-=Vn*Gn.b1.imass,Gn.b1.vely-=jn*Gn.b1.imass,Gn.b2.angvel+=Gn.rt2b*Dn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rt2a*Dn*Gn.b1.iinertia,Zn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel),qn=Gn.k2x+Gn.b2.velx-Gn.c2.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c2.r1y*Gn.b1.angvel),Yn=Gn.k2y+Gn.b2.vely+Gn.c2.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c2.r1x*Gn.b1.angvel);var Kn=Gn.c1.jnAcc,Wn=Gn.c2.jnAcc,Jn=Zn*Gn.nx+Un*Gn.ny+Gn.surfacey+Gn.c1.bounce-(Gn.Ka*Kn+Gn.Kb*Wn),Xn=qn*Gn.nx+Yn*Gn.ny+Gn.surfacey+Gn.c2.bounce-(Gn.Kb*Kn+Gn.Kc*Wn),Hn=-(Gn.kMassa*Jn+Gn.kMassb*Xn),Qn=-(Gn.kMassb*Jn+Gn.kMassc*Xn);0>Hn||0>Qn?(Hn=-Gn.c1.nMass*Jn,0>Hn||0>Gn.Kb*Hn+Xn?(Qn=-Gn.c2.nMass*Xn,0>Qn||0>Gn.Kb*Qn+Jn?0>Jn||0>Xn?(Jn=0,Xn=0):(Jn=-Kn,Xn=-Wn,Gn.c1.jnAcc=Gn.c2.jnAcc=0):(Jn=-Kn,Xn=Qn-Wn,Gn.c1.jnAcc=0,Gn.c2.jnAcc=Qn)):(Jn=Hn-Kn,Xn=-Wn,Gn.c1.jnAcc=Hn,Gn.c2.jnAcc=0)):(Jn=Hn-Kn,Xn=Qn-Wn,Gn.c1.jnAcc=Hn,Gn.c2.jnAcc=Qn),Dn=Jn+Xn,Vn=Gn.nx*Dn,jn=Gn.ny*Dn,Gn.b2.velx+=Vn*Gn.b2.imass,Gn.b2.vely+=jn*Gn.b2.imass,Gn.b1.velx-=Vn*Gn.b1.imass,Gn.b1.vely-=jn*Gn.b1.imass,Gn.b2.angvel+=(Gn.rn1b*Jn+Gn.rn2b*Xn)*Gn.b2.iinertia,Gn.b1.angvel-=(Gn.rn1a*Jn+Gn.rn2a*Xn)*Gn.b1.iinertia}else{if(0!=Gn.radius){var $n=Gn.b2.angvel-Gn.b1.angvel;Dn=$n*Gn.rMass,Fn=Gn.rfric*Gn.c1.jnAcc,Rn=Gn.jrAcc,Gn.jrAcc-=Dn,Gn.jrAcc>Fn?Gn.jrAcc=Fn:-Fn>Gn.jrAcc&&(Gn.jrAcc=-Fn),Dn=Gn.jrAcc-Rn,Gn.b2.angvel+=Dn*Gn.b2.iinertia,Gn.b1.angvel-=Dn*Gn.b1.iinertia}Zn=Gn.k1x+Gn.b2.velx-Gn.c1.r2y*Gn.b2.angvel-(Gn.b1.velx-Gn.c1.r1y*Gn.b1.angvel),Un=Gn.k1y+Gn.b2.vely+Gn.c1.r2x*Gn.b2.angvel-(Gn.b1.vely+Gn.c1.r1x*Gn.b1.angvel),Dn=(Gn.c1.bounce+(Gn.nx*Zn+Gn.ny*Un)+Gn.surfacey)*Gn.c1.nMass,Rn=Gn.c1.jnAcc,Bn=Rn-Dn,0>Bn&&(Bn=0),Dn=Bn-Rn,Gn.c1.jnAcc=Bn,Vn=Gn.nx*Dn,jn=Gn.ny*Dn,Gn.b2.velx+=Vn*Gn.b2.imass,Gn.b2.vely+=jn*Gn.b2.imass,Gn.b1.velx-=Vn*Gn.b1.imass,Gn.b1.vely-=jn*Gn.b1.imass,Gn.b2.angvel+=Gn.rn1b*Dn*Gn.b2.iinertia,Gn.b1.angvel-=Gn.rn1a*Dn*Gn.b1.iinertia}var ne,ee,ie,te,le,pe,re=sn.colarb,ae=re.k1x+re.b2.velx-re.c1.r2y*re.b2.angvel-(re.b1.velx-re.c1.r1y*re.b1.angvel),se=re.k1y+re.b2.vely+re.c1.r2x*re.b2.angvel-(re.b1.vely+re.c1.r1x*re.b1.angvel);if(ie=(se*re.nx-ae*re.ny+re.surfacex)*re.c1.tMass,te=re.c1.friction*re.c1.jnAcc,le=re.c1.jtAcc,pe=le-ie,pe>te?pe=te:-te>pe&&(pe=-te),ie=pe-le,re.c1.jtAcc=pe,ne=-re.ny*ie,ee=re.nx*ie,re.b2.velx+=ne*re.b2.imass,re.b2.vely+=ee*re.b2.imass,re.b1.velx-=ne*re.b1.imass,re.b1.vely-=ee*re.b1.imass,re.b2.angvel+=re.rt1b*ie*re.b2.iinertia,re.b1.angvel-=re.rt1a*ie*re.b1.iinertia,re.hc2){var oe=re.k2x+re.b2.velx-re.c2.r2y*re.b2.angvel-(re.b1.velx-re.c2.r1y*re.b1.angvel),_e=re.k2y+re.b2.vely+re.c2.r2x*re.b2.angvel-(re.b1.vely+re.c2.r1x*re.b1.angvel);ie=(_e*re.nx-oe*re.ny+re.surfacex)*re.c2.tMass,te=re.c2.friction*re.c2.jnAcc,le=re.c2.jtAcc,pe=le-ie,pe>te?pe=te:-te>pe&&(pe=-te),ie=pe-le,re.c2.jtAcc=pe,ne=-re.ny*ie,ee=re.nx*ie,re.b2.velx+=ne*re.b2.imass,re.b2.vely+=ee*re.b2.imass,re.b1.velx-=ne*re.b1.imass,re.b1.vely-=ee*re.b1.imass,re.b2.angvel+=re.rt2b*ie*re.b2.iinertia,re.b1.angvel-=re.rt2a*ie*re.b1.iinertia,ae=re.k1x+re.b2.velx-re.c1.r2y*re.b2.angvel-(re.b1.velx-re.c1.r1y*re.b1.angvel),se=re.k1y+re.b2.vely+re.c1.r2x*re.b2.angvel-(re.b1.vely+re.c1.r1x*re.b1.angvel),oe=re.k2x+re.b2.velx-re.c2.r2y*re.b2.angvel-(re.b1.velx-re.c2.r1y*re.b1.angvel),_e=re.k2y+re.b2.vely+re.c2.r2x*re.b2.angvel-(re.b1.vely+re.c2.r1x*re.b1.angvel);var he=re.c1.jnAcc,ue=re.c2.jnAcc,xe=ae*re.nx+se*re.ny+re.surfacey+re.c1.bounce-(re.Ka*he+re.Kb*ue),de=oe*re.nx+_e*re.ny+re.surfacey+re.c2.bounce-(re.Kb*he+re.Kc*ue),ve=-(re.kMassa*xe+re.kMassb*de),ze=-(re.kMassb*xe+re.kMassc*de);0>ve||0>ze?(ve=-re.c1.nMass*xe,0>ve||0>re.Kb*ve+de?(ze=-re.c2.nMass*de,0>ze||0>re.Kb*ze+xe?0>xe||0>de?(xe=0,de=0):(xe=-he,de=-ue,re.c1.jnAcc=re.c2.jnAcc=0):(xe=-he,de=ze-ue,re.c1.jnAcc=0,re.c2.jnAcc=ze)):(xe=ve-he,de=-ue,re.c1.jnAcc=ve,re.c2.jnAcc=0)):(xe=ve-he,de=ze-ue,re.c1.jnAcc=ve,re.c2.jnAcc=ze),ie=xe+de,ne=re.nx*ie,ee=re.ny*ie,re.b2.velx+=ne*re.b2.imass,re.b2.vely+=ee*re.b2.imass,re.b1.velx-=ne*re.b1.imass,re.b1.vely-=ee*re.b1.imass,re.b2.angvel+=(re.rn1b*xe+re.rn2b*de)*re.b2.iinertia,re.b1.angvel-=(re.rn1a*xe+re.rn2a*de)*re.b1.iinertia}else{if(0!=re.radius){var ce=re.b2.angvel-re.b1.angvel;ie=ce*re.rMass,te=re.rfric*re.c1.jnAcc,le=re.jrAcc,re.jrAcc-=ie,re.jrAcc>te?re.jrAcc=te:-te>re.jrAcc&&(re.jrAcc=-te),ie=re.jrAcc-le,re.b2.angvel+=ie*re.b2.iinertia,re.b1.angvel-=ie*re.b1.iinertia}ae=re.k1x+re.b2.velx-re.c1.r2y*re.b2.angvel-(re.b1.velx-re.c1.r1y*re.b1.angvel),se=re.k1y+re.b2.vely+re.c1.r2x*re.b2.angvel-(re.b1.vely+re.c1.r1x*re.b1.angvel),ie=(re.c1.bounce+(re.nx*ae+re.ny*se)+re.surfacey)*re.c1.nMass,le=re.c1.jnAcc,pe=le-ie,0>pe&&(pe=0),ie=pe-le,re.c1.jnAcc=pe,ne=re.nx*ie,ee=re.ny*ie,re.b2.velx+=ne*re.b2.imass,re.b2.vely+=ee*re.b2.imass,re.b1.velx-=ne*re.b1.imass,re.b1.vely-=ee*re.b1.imass,re.b2.angvel+=re.rn1b*ie*re.b2.iinertia,re.b1.angvel-=re.rn1a*ie*re.b1.iinertia}var ye,fe,be,ge,we,Me,Ce=sn.colarb,ke=Ce.k1x+Ce.b2.velx-Ce.c1.r2y*Ce.b2.angvel-(Ce.b1.velx-Ce.c1.r1y*Ce.b1.angvel),Oe=Ce.k1y+Ce.b2.vely+Ce.c1.r2x*Ce.b2.angvel-(Ce.b1.vely+Ce.c1.r1x*Ce.b1.angvel);if(be=(Oe*Ce.nx-ke*Ce.ny+Ce.surfacex)*Ce.c1.tMass,ge=Ce.c1.friction*Ce.c1.jnAcc,we=Ce.c1.jtAcc,Me=we-be,Me>ge?Me=ge:-ge>Me&&(Me=-ge),be=Me-we,Ce.c1.jtAcc=Me,ye=-Ce.ny*be,fe=Ce.nx*be,Ce.b2.velx+=ye*Ce.b2.imass,Ce.b2.vely+=fe*Ce.b2.imass,Ce.b1.velx-=ye*Ce.b1.imass,Ce.b1.vely-=fe*Ce.b1.imass,Ce.b2.angvel+=Ce.rt1b*be*Ce.b2.iinertia,Ce.b1.angvel-=Ce.rt1a*be*Ce.b1.iinertia,Ce.hc2){var Ie=Ce.k2x+Ce.b2.velx-Ce.c2.r2y*Ce.b2.angvel-(Ce.b1.velx-Ce.c2.r1y*Ce.b1.angvel),Se=Ce.k2y+Ce.b2.vely+Ce.c2.r2x*Ce.b2.angvel-(Ce.b1.vely+Ce.c2.r1x*Ce.b1.angvel);be=(Se*Ce.nx-Ie*Ce.ny+Ce.surfacex)*Ce.c2.tMass,ge=Ce.c2.friction*Ce.c2.jnAcc,we=Ce.c2.jtAcc,Me=we-be,Me>ge?Me=ge:-ge>Me&&(Me=-ge),be=Me-we,Ce.c2.jtAcc=Me,ye=-Ce.ny*be,fe=Ce.nx*be,Ce.b2.velx+=ye*Ce.b2.imass,Ce.b2.vely+=fe*Ce.b2.imass,Ce.b1.velx-=ye*Ce.b1.imass,Ce.b1.vely-=fe*Ce.b1.imass,Ce.b2.angvel+=Ce.rt2b*be*Ce.b2.iinertia,Ce.b1.angvel-=Ce.rt2a*be*Ce.b1.iinertia,ke=Ce.k1x+Ce.b2.velx-Ce.c1.r2y*Ce.b2.angvel-(Ce.b1.velx-Ce.c1.r1y*Ce.b1.angvel),Oe=Ce.k1y+Ce.b2.vely+Ce.c1.r2x*Ce.b2.angvel-(Ce.b1.vely+Ce.c1.r1x*Ce.b1.angvel),Ie=Ce.k2x+Ce.b2.velx-Ce.c2.r2y*Ce.b2.angvel-(Ce.b1.velx-Ce.c2.r1y*Ce.b1.angvel),Se=Ce.k2y+Ce.b2.vely+Ce.c2.r2x*Ce.b2.angvel-(Ce.b1.vely+Ce.c2.r1x*Ce.b1.angvel);var Pe=Ce.c1.jnAcc,Te=Ce.c2.jnAcc,Ae=ke*Ce.nx+Oe*Ce.ny+Ce.surfacey+Ce.c1.bounce-(Ce.Ka*Pe+Ce.Kb*Te),Ee=Ie*Ce.nx+Se*Ce.ny+Ce.surfacey+Ce.c2.bounce-(Ce.Kb*Pe+Ce.Kc*Te),Ne=-(Ce.kMassa*Ae+Ce.kMassb*Ee),Le=-(Ce.kMassb*Ae+Ce.kMassc*Ee);0>Ne||0>Le?(Ne=-Ce.c1.nMass*Ae,0>Ne||0>Ce.Kb*Ne+Ee?(Le=-Ce.c2.nMass*Ee,0>Le||0>Ce.Kb*Le+Ae?0>Ae||0>Ee?(Ae=0,Ee=0):(Ae=-Pe,Ee=-Te,Ce.c1.jnAcc=Ce.c2.jnAcc=0):(Ae=-Pe,Ee=Le-Te,Ce.c1.jnAcc=0,Ce.c2.jnAcc=Le)):(Ae=Ne-Pe,Ee=-Te,Ce.c1.jnAcc=Ne,Ce.c2.jnAcc=0)):(Ae=Ne-Pe,Ee=Le-Te,Ce.c1.jnAcc=Ne,Ce.c2.jnAcc=Le),be=Ae+Ee,ye=Ce.nx*be,fe=Ce.ny*be,Ce.b2.velx+=ye*Ce.b2.imass,Ce.b2.vely+=fe*Ce.b2.imass,Ce.b1.velx-=ye*Ce.b1.imass,Ce.b1.vely-=fe*Ce.b1.imass,Ce.b2.angvel+=(Ce.rn1b*Ae+Ce.rn2b*Ee)*Ce.b2.iinertia,Ce.b1.angvel-=(Ce.rn1a*Ae+Ce.rn2a*Ee)*Ce.b1.iinertia}else{if(0!=Ce.radius){var je=Ce.b2.angvel-Ce.b1.angvel;be=je*Ce.rMass,ge=Ce.rfric*Ce.c1.jnAcc,we=Ce.jrAcc,Ce.jrAcc-=be,Ce.jrAcc>ge?Ce.jrAcc=ge:-ge>Ce.jrAcc&&(Ce.jrAcc=-ge),be=Ce.jrAcc-we,Ce.b2.angvel+=be*Ce.b2.iinertia,Ce.b1.angvel-=be*Ce.b1.iinertia}ke=Ce.k1x+Ce.b2.velx-Ce.c1.r2y*Ce.b2.angvel-(Ce.b1.velx-Ce.c1.r1y*Ce.b1.angvel),Oe=Ce.k1y+Ce.b2.vely+Ce.c1.r2x*Ce.b2.angvel-(Ce.b1.vely+Ce.c1.r1x*Ce.b1.angvel),be=(Ce.c1.bounce+(Ce.nx*ke+Ce.ny*Oe)+Ce.surfacey)*Ce.c1.nMass,we=Ce.c1.jnAcc,Me=we-be,0>Me&&(Me=0),be=Me-we,Ce.c1.jnAcc=Me,ye=Ce.nx*be,fe=Ce.ny*be,Ce.b2.velx+=ye*Ce.b2.imass,Ce.b2.vely+=fe*Ce.b2.imass,Ce.b1.velx-=ye*Ce.b1.imass,Ce.b1.vely-=fe*Ce.b1.imass,Ce.b2.angvel+=Ce.rn1b*be*Ce.b2.iinertia,Ce.b1.angvel-=Ce.rn1a*be*Ce.b1.iinertia}z.sweep_angvel=z.angvel%e,c.sweep_angvel=c.angvel%e}if(null!=sn&&sn.active&&0!=(sn.immState&me.id_ImmState_ACCEPT)&&sn.type==Ve.COL){if(!z.sweepFrozen&&z.type!=me.id_BodyType_KINEMATIC)if(z.sweepFrozen=!0,t.failed)z.angvel=z.sweep_angvel=0;else if(t.slipped){var De=z;De.sweep_angvel*=y.angularCCDSlipScale,z.angvel=De.sweep_angvel}else z.angvel=z.sweep_angvel;if(!c.sweepFrozen&&c.type!=me.id_BodyType_KINEMATIC)if(c.sweepFrozen=!0,t.failed)c.angvel=c.sweep_angvel=0;else if(t.slipped){var Fe=c;Fe.sweep_angvel*=y.angularCCDSlipScale,c.angvel=Fe.sweep_angvel}else c.angvel=c.sweep_angvel}var Re=t;Re.next=fi.zpp_pool,fi.zpp_pool=Re}for(;null!=this.toiEvents.head;){var Be=this.toiEvents.pop_unsafe(),Ge=Be;Ge.next=fi.zpp_pool,fi.zpp_pool=Ge}for(var Ze=this.kinematics.head;null!=Ze;){var Ue=Ze.elt,qe=n-Ue.sweepTime;if(0!=qe){Ue.sweepTime=n;var Ye=qe;if(Ue.posx+=Ue.velx*Ye,Ue.posy+=Ue.vely*Ye,0!=Ue.angvel){var We=Ue.sweep_angvel*qe;if(Ue.rot+=We,We*We>1e-4)Ue.axisx=Math.sin(Ue.rot),Ue.axisy=Math.cos(Ue.rot);else{var Je=We*We,Xe=1-.5*Je,He=1-Je*Je/8,Qe=(Xe*Ue.axisx+We*Ue.axisy)*He;Ue.axisy=(Xe*Ue.axisy-We*Ue.axisx)*He,Ue.axisx=Qe}}}Ue.sweepTime=0,Ze=Ze.next}for(var $e=this.live.head;null!=$e;){var ni=$e.elt;if(!ni.sweepFrozen){var ei=n-ni.sweepTime;if(0!=ei){ni.sweepTime=n;var ii=ei;if(ni.posx+=ni.velx*ii,ni.posy+=ni.vely*ii,0!=ni.angvel){var ti=ni.sweep_angvel*ei;if(ni.rot+=ti,ti*ti>1e-4)ni.axisx=Math.sin(ni.rot),ni.axisy=Math.cos(ni.rot);else{var li=ti*ti,pi=1-.5*li,ri=1-li*li/8,ai=(pi*ni.axisx+ti*ni.axisy)*ri;ni.axisy=(pi*ni.axisy-ti*ni.axisx)*ri,ni.axisx=ai}}}}ni.sweepTime=0,$e=$e.next}},continuousEvent:function(n,e,i,t,l){if(n.body.sweepFrozen&&e.body.sweepFrozen)return t;if(n.body.disableCCD||e.body.disableCCD)return t;var p;if(null==t||null!=t.colarb){var r,a=n.body,s=e.body;r=!1;for(var o=a.constraints.head;null!=o;){var _=o.elt;if(_.ignore&&_.pair_exists(a.id,s.id)){r=!0;break}o=o.next}var h,u;if(r)u=!1;else{for(var x=n;null!=x&&null==x.group;)x=null!=x.ishape?x.ishape.body:null!=x.icompound?x.icompound.compound:x.ibody.compound;var d,v=null==x?null:x.group;if(null==v)d=!1;else{for(var z=e;null!=z&&null==z.group;)z=null!=z.ishape?z.ishape.body:null!=z.icompound?z.icompound.compound:z.ibody.compound;var c=null==z?null:z.group;if(null==c)d=!1;else{for(var m=!1;null!=v&&null!=c;){if(v==c){m=v.ignore;break}c.depth>v.depth?c=c.group:v=v.group}d=m}}u=!d}if(u){var f;if(n.sensorEnabled||e.sensorEnabled){var b=n.filter,g=e.filter;f=0!=(b.sensorMask&g.sensorGroup)&&0!=(g.sensorMask&b.sensorGroup)}else f=!1;if(f)h=2;else{var w;if(n.fluidEnabled||e.fluidEnabled){var M=n.filter,C=e.filter;w=0!=(M.fluidMask&C.fluidGroup)&&0!=(C.fluidMask&M.fluidGroup)}else w=!1;if(!!w&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia))h=0;else{var k,O=n.filter,I=e.filter;k=0!=(O.collisionMask&I.collisionGroup)&&0!=(I.collisionMask&O.collisionGroup)&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia),h=k?1:-1}}}else h=-1;p=0>=h}else p=!0;if(p)return t;var S=n.body,P=e.body;if(i||S.bullet||P.bullet){var T;null==fi.zpp_pool?T=new fi:(T=fi.zpp_pool,fi.zpp_pool=T.next,T.next=null),T.failed=!1,T.s1=T.s2=null,T.arbiter=null;var A=S.type==me.id_BodyType_KINEMATIC||P.type==me.id_BodyType_KINEMATIC;if(i&&!A)n.body.type!=me.id_BodyType_DYNAMIC?(T.s2=n,T.s1=e):(T.s1=n,T.s2=e),T.kinematic=!1,bi.staticSweep(T,this.pre_dt,0,y.collisionSlopCCD);else if(T.s1=n,T.s2=e,T.kinematic=A,T.s1.body.sweepFrozen||T.s2.body.sweepFrozen){if(T.s1.body.sweepFrozen){var E=T.s1;T.s1=T.s2,T.s2=E,T.frozen1=!1,T.frozen2=!0}bi.staticSweep(T,this.pre_dt,0,y.collisionSlopCCD)}else bi.dynamicSweep(T,this.pre_dt,0,y.collisionSlopCCD);if(i&&0>T.toi||T.failed){var N=T;N.next=fi.zpp_pool,fi.zpp_pool=N}else this.toiEvents.add(T),T.frozen1=T.s1.body.sweepFrozen,T.frozen2=T.s2.body.sweepFrozen,T.arbiter=null!=t?t.colarb:null}return t},bodyCbWake:function(n){if(n.type==me.id_BodyType_DYNAMIC&&null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.bodylisteners.head;null!=e;){var i=e.elt;if(i.event==me.id_CbEvent_WAKE){var t=this.push_callback(i);t.event=me.id_CbEvent_WAKE,t.body=n,e=e.next}else e=e.next}else n.component.woken=!0},bodyCbSleep:function(n){if(n.type==me.id_BodyType_DYNAMIC&&null!=n.cbSet)for(var e=n.cbSet.bodylisteners.head;null!=e;){var i=e.elt;if(i.event==me.id_CbEvent_SLEEP){var t=this.push_callback(i);t.event=me.id_CbEvent_SLEEP,t.body=n,e=e.next}else e=e.next}},constraintCbWake:function(n){if(null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.conlisteners.head;null!=e;){var i=e.elt;if(i.event==me.id_CbEvent_WAKE){var t=this.push_callback(i);t.event=me.id_CbEvent_WAKE,t.constraint=n,e=e.next}else e=e.next}else n.component.woken=!0},constraintCbSleep:function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var i=e.elt;if(i.event==me.id_CbEvent_SLEEP){var t=this.push_callback(i);t.event=me.id_CbEvent_SLEEP,t.constraint=n,e=e.next}else e=e.next}},constraintCbBreak:function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var i=e.elt;if(i.event==me.id_CbEvent_BREAK){var t=this.push_callback(i);t.event=me.id_CbEvent_BREAK,t.constraint=n,e=e.next}else e=e.next}},nullListenerType:function(n,e){for(var i=new ve,t=n.interactors.head;null!=t;){i.add(t.elt),t=t.next}if(n!=e)for(var l=e.interactors.head;null!=l;){var p=l.elt;i.add(p),l=l.next}for(;null!=i.head;){var r=i.pop_unsafe();if(null!=r.icompound){for(var a=r.icompound,s=a.bodies.head;null!=s;){i.add(s.elt),s=s.next}for(var o=a.compounds.head;null!=o;){i.add(o.elt),o=o.next}}else for(var _=null!=r.ibody?r.ibody:r.ishape.body,h=null!=r.ishape?r.ishape:null,u=_.arbiters.head;null!=u;){var x=u.elt;if(0!=x.present)if(null==h||x.ws1==h||x.ws2==h){this.MRCA_chains(x.ws1,x.ws2);for(var d=this.mrca1.head;null!=d;){var v=d.elt;if(v.cbSet==n||v.cbSet==e){for(var z=this.mrca2.head;null!=z;){var c=z.elt;if(v.cbSet==n&&c.cbSet!=e||v.cbSet==e&&c.cbSet!=n)z=z.next;else{var m=Oi.get(v,c);if(null!=m){for(;null!=m.arbiters.head;){var y=m.arbiters.pop_unsafe();y.present--}this.remove_callbackset(m)}z=z.next}}d=d.next}else d=d.next}u=u.next}else u=u.next;else u=u.next}}},nullInteractorType:function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var i=n.icompound,t=i.bodies.head;null!=t;){this.nullInteractorType(t.elt,e),t=t.next}for(var l=i.compounds.head;null!=l;){this.nullInteractorType(l.elt,e),l=l.next}}else for(var p=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,a=p.arbiters.head;null!=a;){var s=a.elt;if(0!=s.present)if(null==r||s.ws1==r||s.ws2==r){this.MRCA_chains(s.ws1,s.ws2);for(var o=this.mrca1.head;null!=o;){for(var _=o.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(_==e||u==e){var x=Oi.get(_,u);null!=x&&(s.present--,x.remove_arb(s),null==x.arbiters.head&&this.remove_callbackset(x)),h=h.next}else h=h.next}o=o.next}a=a.next}else a=a.next;else a=a.next}},freshListenerType:function(n,e){for(var i=new ve,t=n.interactors.head;null!=t;){i.add(t.elt),t=t.next}if(n!=e)for(var l=e.interactors.head;null!=l;){var p=l.elt;i.add(p),l=l.next}for(;null!=i.head;){var r=i.pop_unsafe();if(null!=r.icompound){for(var a=r.icompound,s=a.bodies.head;null!=s;){i.add(s.elt),s=s.next}for(var o=a.compounds.head;null!=o;){i.add(o.elt),o=o.next}}else for(var _=null!=r.ibody?r.ibody:r.ishape.body,h=null!=r.ishape?r.ishape:null,u=_.arbiters.head;null!=u;){var x=u.elt;if(x.presentable)if(null==h||x.ws1==h||x.ws2==h){this.MRCA_chains(x.ws1,x.ws2);for(var d=this.mrca1.head;null!=d;){var v=d.elt;if(v.cbSet==n||v.cbSet==e){for(var z=this.mrca2.head;null!=z;){var c=z.elt;if(v.cbSet==n&&c.cbSet!=e||v.cbSet==e&&c.cbSet!=n)z=z.next;else{var m=Oi.get(v,c);null==m&&(m=Zi.get(v,c),this.add_callbackset(m));var y,f;f=!1;for(var b=m.arbiters.head;null!=b;){var g=b.elt;if(g==x){f=!0;break}b=b.next}if(f)y=!1;else{var w,M=m.arbiters;null==Vt.zpp_pool?w=new Vt:(w=Vt.zpp_pool,Vt.zpp_pool=w.next,w.next=null),w.elt=x;var C=w;C.next=M.head,M.head=C,M.modified=!0,M.length++,y=!0}y&&x.present++,z=z.next}}d=d.next}else d=d.next}u=u.next}else u=u.next;else u=u.next}}},freshInteractorType:function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var i=n.icompound,t=i.bodies.head;null!=t;){this.freshInteractorType(t.elt,e),t=t.next}for(var l=i.compounds.head;null!=l;){this.freshInteractorType(l.elt,e),l=l.next}}else for(var p=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,a=p.arbiters.head;null!=a;){var s=a.elt;if(s.presentable)if(null==r||s.ws1==r||s.ws2==r){this.MRCA_chains(s.ws1,s.ws2);for(var o=this.mrca1.head;null!=o;){for(var _=o.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(_==e||u==e){var x=_.cbSet,d=u.cbSet;x.validate(),d.validate();for(var v=null,z=d.cbpairs.length>x.cbpairs.length?x.cbpairs:d.cbpairs,c=z.head;null!=c;){var m=c.elt;if(m.a==x&&m.b==d||m.a==d&&m.b==x){v=m;break}c=c.next}if(null==v){var y;null==_e.zpp_pool?y=new _e:(y=_e.zpp_pool,_e.zpp_pool=y.next,y.next=null),y.zip_listeners=!0,oe.setlt(x,d)?(y.a=x,y.b=d):(y.a=d,y.b=x),v=y,x.cbpairs.add(v),d!=x&&d.cbpairs.add(v)}if(v.zip_listeners&&(v.zip_listeners=!1,v.__validate()),null!=v.listeners.head){var f=Oi.get(_,u);null==f&&(f=Zi.get(_,u),this.add_callbackset(f));var b,g;g=!1;for(var w=f.arbiters.head;null!=w;){var M=w.elt;if(M==s){g=!0;break}w=w.next}if(g)b=!1;else{var C,k=f.arbiters;null==Vt.zpp_pool?C=new Vt:(C=Vt.zpp_pool,Vt.zpp_pool=C.next,C.next=null),C.elt=s;var O=C;O.next=k.head,k.head=O,k.modified=!0,k.length++,b=!0}b&&s.present++}h=h.next}else h=h.next}o=o.next}a=a.next}else a=a.next;else a=a.next}},wakeCompound:function(n){for(var e=n.bodies.head;null!=e;){var i=e.elt,t=i;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),t.type==me.id_BodyType_KINEMATIC&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1)),e=e.next}for(var l=n.constraints.head;null!=l;){this.wake_constraint(l.elt),l=l.next}for(var p=n.compounds.head;null!=p;){this.wakeCompound(p.elt),p=p.next}},wakeIsland:function(n){for(;null!=n.comps.head;){var e=n.comps.pop_unsafe();if(e.waket=this.stamp+(this.midstep?0:1),e.isBody){var i=e.body;this.live.add(i);for(var t=i.arbiters.head;null!=t;){var l=t.elt;if(l.sleeping)if(l.sleeping=!1,l.up_stamp+=this.stamp-l.sleep_stamp,l.type==Ve.COL){var p=l.colarb;if(p.stat){var r,a=this.c_arbiters_true;null==el.zpp_pool?r=new el:(r=el.zpp_pool,el.zpp_pool=r.next,r.next=null),r.elt=p;var s=r;s.next=a.head,a.head=s,a.modified=!0,a.length++}else{var o,_=this.c_arbiters_false;null==el.zpp_pool?o=new el:(o=el.zpp_pool,el.zpp_pool=o.next,o.next=null),o.elt=p;var h=o;h.next=_.head,_.head=h,_.modified=!0,_.length++}}else if(l.type==Ve.FLUID){var u,x=this.f_arbiters,d=l.fluidarb;null==$t.zpp_pool?u=new $t:(u=$t.zpp_pool,$t.zpp_pool=u.next,u.next=null),u.elt=d;var v=u;v.next=x.head,x.head=v,x.modified=!0,x.length++}else{var z,c=this.s_arbiters,m=l.sensorarb;null==nl.zpp_pool?z=new nl:(z=nl.zpp_pool,nl.zpp_pool=z.next,z.next=null),z.elt=m;var y=z;y.next=c.head,c.head=y,c.modified=!0,c.length++}t=t.next}if(this.bodyCbWake(i),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0,i.type!=me.id_BodyType_STATIC)for(var f=i.shapes.head;null!=f;){var b=f.elt;null!=b.node&&this.bphase.sync(b),f=f.next}}else{var g,w=e.constraint,M=this.live_constraints;null==Pt.zpp_pool?g=new Pt:(g=Pt.zpp_pool,Pt.zpp_pool=g.next,g.next=null),g.elt=w;var C=g;C.next=M.head,M.head=C,M.modified=!0,M.length++,this.constraintCbWake(w),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0}}var k=n;k.next=Bi.zpp_pool,Bi.zpp_pool=k},non_inlined_wake:function(n,e){null==e&&(e=!1);var i=n;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==me.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,e))},really_wake:function(n,e){if(null==e&&(e=!1),null==n.component.island){if(n.component.sleeping=!1,n.type==me.id_BodyType_KINEMATIC||n.type==me.id_BodyType_STATIC){var i,t=this.staticsleep;null==St.zpp_pool?i=new St:(i=St.zpp_pool,St.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;l.next=t.head,t.head=l,t.modified=!0,t.length++}else{var p,r=this.live;null==St.zpp_pool?p=new St:(p=St.zpp_pool,St.zpp_pool=p.next,p.next=null),p.elt=n;var a=p;a.next=r.head,r.head=a,r.modified=!0,r.length++}for(var s=n.constraints.head;null!=s;){var o=s.elt;o.space==this&&this.wake_constraint(o),s=s.next}for(var _=n.arbiters.head;null!=_;){var h=_.elt;if(h.sleeping)if(h.sleeping=!1,h.up_stamp+=this.stamp+(this.midstep?0:1)-h.sleep_stamp,h.type==Ve.COL){var u=h.colarb;if(u.stat){var x,d=this.c_arbiters_true;null==el.zpp_pool?x=new el:(x=el.zpp_pool,el.zpp_pool=x.next,x.next=null),x.elt=u;var v=x;v.next=d.head,d.head=v,d.modified=!0,d.length++}else{var z,c=this.c_arbiters_false;null==el.zpp_pool?z=new el:(z=el.zpp_pool,el.zpp_pool=z.next,z.next=null),z.elt=u;var m=z;m.next=c.head,c.head=m,c.modified=!0,c.length++}}else if(h.type==Ve.FLUID){var y,f=this.f_arbiters,b=h.fluidarb;null==$t.zpp_pool?y=new $t:(y=$t.zpp_pool,$t.zpp_pool=y.next,y.next=null),y.elt=b;var g=y;g.next=f.head,f.head=g,f.modified=!0,f.length++}else{var w,M=this.s_arbiters,C=h.sensorarb;null==nl.zpp_pool?w=new nl:(w=nl.zpp_pool,nl.zpp_pool=w.next,w.next=null),w.elt=C;var k=w;k.next=M.head,M.head=k,M.modified=!0,M.length++}if(h.type!=Ve.SENSOR&&!h.cleared&&h.up_stamp>=this.stamp&&0!=(h.immState&me.id_ImmState_ACCEPT)){if(h.b1.type==me.id_BodyType_DYNAMIC&&h.b1.component.sleeping){var O=h.b1;O.world||(O.component.waket=this.stamp+(this.midstep?0:1),O.type==me.id_BodyType_KINEMATIC&&(O.kinematicDelaySleep=!0),O.component.sleeping&&this.really_wake(O,!1))}if(h.b2.type==me.id_BodyType_DYNAMIC&&h.b2.component.sleeping){var I=h.b2;I.world||(I.component.waket=this.stamp+(this.midstep?0:1),I.type==me.id_BodyType_KINEMATIC&&(I.kinematicDelaySleep=!0),I.component.sleeping&&this.really_wake(I,!1))}}_=_.next}if(e||n.type!=me.id_BodyType_DYNAMIC||this.bodyCbWake(n),!e&&!this.bphase.is_sweep&&n.type!=me.id_BodyType_STATIC)for(var S=n.shapes.head;null!=S;){var P=S.elt;null!=P.node&&this.bphase.sync(P),S=S.next}}else this.wakeIsland(n.component.island)},wake_constraint:function(n,e){if(null==e&&(e=!1),n.active){if(n.component.waket=this.stamp+(this.midstep?0:1),n.component.sleeping){if(null==n.component.island){n.component.sleeping=!1;var i,t=this.live_constraints;null==Pt.zpp_pool?i=new Pt:(i=Pt.zpp_pool,Pt.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;l.next=t.head,t.head=l,t.modified=!0,t.length++,n.wake_connected(),e||this.constraintCbWake(n)}else this.wakeIsland(n.component.island);return!0}return!1}return!1},doForests:function(n){for(var e=this.c_arbiters_false.head;null!=e;){var i=e.elt;if(!i.cleared&&i.up_stamp==this.stamp&&0!=(i.immState&me.id_ImmState_ACCEPT)&&i.b1.type==me.id_BodyType_DYNAMIC&&i.b2.type==me.id_BodyType_DYNAMIC){var t;if(i.b1.component==i.b1.component.parent)t=i.b1.component;else{for(var l=i.b1.component,p=null;l!=l.parent;){var r=l.parent;l.parent=p,p=l,l=r}for(;null!=p;){var a=p.parent;p.parent=l,p=a}t=l}var s;if(i.b2.component==i.b2.component.parent)s=i.b2.component;else{for(var o=i.b2.component,_=null;o!=o.parent;){var h=o.parent;o.parent=_,_=o,o=h}for(;null!=_;){var u=_.parent;_.parent=o,_=u}s=o}t!=s&&(s.rank>t.rank?t.parent=s:t.rank>s.rank?s.parent=t:(s.parent=t,t.rank++))}e=e.next}for(var x=this.f_arbiters.head;null!=x;){var d=x.elt;if(!d.cleared&&d.up_stamp==this.stamp&&0!=(d.immState&me.id_ImmState_ACCEPT)&&d.b1.type==me.id_BodyType_DYNAMIC&&d.b2.type==me.id_BodyType_DYNAMIC){var v;if(d.b1.component==d.b1.component.parent)v=d.b1.component;else{for(var z=d.b1.component,c=null;z!=z.parent;){var m=z.parent;z.parent=c,c=z,z=m}for(;null!=c;){var y=c.parent;c.parent=z,c=y}v=z}var f;if(d.b2.component==d.b2.component.parent)f=d.b2.component;else{for(var b=d.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var M=g.parent;g.parent=b,g=M}f=b}v!=f&&(f.rank>v.rank?v.parent=f:v.rank>f.rank?f.parent=v:(f.parent=v,v.rank++))}x=x.next}for(var C=this.live_constraints.head;null!=C;){C.elt.forest(),C=C.next}for(;null!=this.live.head;){var k=this.live,O=k.head.elt;k.pop();var I,S=O,P=S.component;if(P==P.parent)I=P;else{for(var T=P,A=null;T!=T.parent;){var E=T.parent;T.parent=A,A=T,T=E}for(;null!=A;){var N=A.parent;A.parent=T,A=N}I=T}if(null==I.island){null==Bi.zpp_pool?I.island=new Bi:(I.island=Bi.zpp_pool,Bi.zpp_pool=I.island.next,I.island.next=null),I.island.waket=0;var L=this.islands,V=I.island;V._inuse=!0;var j=V;j.next=L.next,L.next=j,L.modified=!0,L.length++,I.island.sleep=!0}P.island=I.island;var D,F=P.island.comps;null==Xt.zpp_pool?D=new Xt:(D=Xt.zpp_pool,Xt.zpp_pool=D.next,D.next=null),D.elt=P;var R=D;R.next=F.head,F.head=R,F.modified=!0,F.length++;var B=S.atRest(n);P.island.sleep=P.island.sleep&&B,P.waket>P.island.waket&&(P.island.waket=P.waket)}for(;null!=this.live_constraints.head;){var G=this.live_constraints,Z=G.head.elt;G.pop();var U,q=Z,Y=q.component;if(Y==Y.parent)U=Y;else{for(var K=Y,W=null;K!=K.parent;){var J=K.parent;K.parent=W,W=K,K=J}for(;null!=W;){var X=W.parent;W.parent=K,W=X}U=K}Y.island=U.island;var H,Q=Y.island.comps;null==Xt.zpp_pool?H=new Xt:(H=Xt.zpp_pool,Xt.zpp_pool=H.next,H.next=null),H.elt=Y;var $=H;$.next=Q.head,Q.head=$,Q.modified=!0,Q.length++,Y.waket>Y.island.waket&&(Y.island.waket=Y.waket)}for(;null!=this.islands.next;){var nn=this.islands,en=nn.next;nn.pop();var tn=en;if(tn.sleep)for(var ln=tn.comps.head;null!=ln;){var pn=ln.elt;if(pn.isBody){var rn=pn.body;rn.velx=0,rn.vely=0,rn.angvel=0,pn.sleeping=!0;for(var an=rn.shapes.head;null!=an;){var sn=an.elt;this.bphase.sync(sn),an=an.next}this.bodyCbSleep(rn)}else{var on=pn.constraint;this.constraintCbSleep(on),pn.sleeping=!0}ln=ln.next}else{for(;null!=tn.comps.head;){var _n=tn.comps,hn=_n.head.elt;_n.pop();var un=hn;if(un.waket=tn.waket,un.isBody){var xn,dn=this.live,vn=un.body;null==St.zpp_pool?xn=new St:(xn=St.zpp_pool,St.zpp_pool=xn.next,xn.next=null),xn.elt=vn;var zn=xn;zn.next=dn.head,dn.head=zn,dn.modified=!0,dn.length++}else{var cn,mn=this.live_constraints,yn=un.constraint;null==Pt.zpp_pool?cn=new Pt:(cn=Pt.zpp_pool,Pt.zpp_pool=cn.next,cn.next=null),cn.elt=yn;var fn=cn;fn.next=mn.head,mn.head=fn,mn.modified=!0,mn.length++}un.sleeping=!1,un.island=null,un.parent=un,un.rank=0}var bn=tn;bn.next=Bi.zpp_pool,Bi.zpp_pool=bn}}},sleepArbiters:function(){var n=null,e=this.c_arbiters_true,i=e.head,t=null!=this.c_arbiters_false;for(t&&null==i&&(t=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null);null!=i;){var l=i.elt;if(l.b1.component.sleeping&&l.b2.component.sleeping){l.sleep_stamp=this.stamp,l.sleeping=!0;var p,r;null==n?(p=e.head,r=p.next,null==(e.head=r)&&(e.pushmod=!0)):(p=n.next,r=p.next,n.next=r,null==r&&(e.pushmod=!0));var a=p;a.elt=null,a.next=el.zpp_pool,el.zpp_pool=a,e.modified=!0,e.length--,e.pushmod=!0,i=r,t&&null==i&&(t=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}else n=i,i=i.next,t&&null==i&&(t=!1,i=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}var s=null,o=this.f_arbiters,_=o.head,h=!1;for(h&&null==_&&(h=!1,o=null,s=null);null!=_;){var u=_.elt;if(u.b1.component.sleeping&&u.b2.component.sleeping){u.sleep_stamp=this.stamp,u.sleeping=!0;var x,d;null==s?(x=o.head,d=x.next,null==(o.head=d)&&(o.pushmod=!0)):(x=s.next,d=x.next,s.next=d,null==d&&(o.pushmod=!0));var v=x;v.elt=null,v.next=$t.zpp_pool,$t.zpp_pool=v,o.modified=!0,o.length--,o.pushmod=!0,_=d,h&&null==_&&(h=!1,o=null,s=null)}else s=_,_=_.next,h&&null==_&&(h=!1,o=null,s=null)}var z=null,c=this.s_arbiters,m=c.head,y=!1;for(y&&null==m&&(y=!1,c=null,z=null);null!=m;){var f=m.elt;if(f.b1.component.sleeping&&f.b2.component.sleeping){f.sleep_stamp=this.stamp,f.sleeping=!0;var b,g;null==z?(b=c.head,g=b.next,null==(c.head=g)&&(c.pushmod=!0)):(b=z.next,g=b.next,z.next=g,null==g&&(c.pushmod=!0));var w=b;w.elt=null,w.next=nl.zpp_pool,nl.zpp_pool=w,c.modified=!0,c.length--,c.pushmod=!0,m=g,y&&null==m&&(y=!1,c=null,z=null)}else z=m,m=m.next,y&&null==m&&(y=!1,c=null,z=null)}},static_validation:function(n){if(null!=n.shapes.head&&n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=Infinity,n.aabb.miny=Infinity,n.aabb.maxx=-Infinity,n.aabb.maxy=-Infinity;for(var e=n.shapes.head;null!=e;){var i=e.elt;if(i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,i.type==me.id_ShapeType_CIRCLE){var t=i.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,t.type==me.id_ShapeType_POLYGON){var l=t.polygon;if(null==l.lverts.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;else if(null==l.lverts.next.next.next){l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;l.localCOMx+=1*l.lverts.next.next.x,l.localCOMy+=1*l.lverts.next.next.y;l.localCOMx*=.5,l.localCOMy*=.5}else{l.localCOMx=0,l.localCOMy=0;var p=0,r=l.lverts.next,a=r;r=r.next;var s=r;for(r=r.next;null!=r;){var o=r;p+=s.x*(o.y-a.y);var _=o.y*s.x-o.x*s.y;l.localCOMx+=(s.x+o.x)*_,l.localCOMy+=(s.y+o.y)*_,a=s,s=o,r=r.next}r=l.lverts.next;var h=r;p+=s.x*(h.y-a.y);var u=h.y*s.x-h.x*s.y;l.localCOMx+=(s.x+h.x)*u,l.localCOMy+=(s.y+h.y)*u,a=s,s=h,r=r.next;var x=r;p+=s.x*(x.y-a.y);var d=x.y*s.x-x.x*s.y;l.localCOMx+=(s.x+x.x)*d,l.localCOMy+=(s.y+x.y)*d,p=1/(3*p);var v=p;l.localCOMx*=v,l.localCOMy*=v}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var z=t.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var c=t.radius,m=t.radius;t.aabb.minx=t.worldCOMx-c,t.aabb.miny=t.worldCOMy-m,t.aabb.maxx=t.worldCOMx+c,t.aabb.maxy=t.worldCOMy+m}else{var y=i.polygon;if(y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var f=y.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var b=y.lverts.next,g=y.gverts.next;null!=g;){var w=g,M=b;b=b.next,w.x=y.body.posx+(y.body.axisy*M.x-y.body.axisx*M.y),w.y=y.body.posy+(M.x*y.body.axisx+M.y*y.body.axisy),g=g.next}}var C=y.gverts.next;y.aabb.minx=C.x,y.aabb.miny=C.y,y.aabb.maxx=C.x,y.aabb.maxy=C.y;for(var k=y.gverts.next.next;null!=k;){var O=k;y.aabb.minx>O.x&&(y.aabb.minx=O.x),O.x>y.aabb.maxx&&(y.aabb.maxx=O.x),y.aabb.miny>O.y&&(y.aabb.miny=O.y),O.y>y.aabb.maxy&&(y.aabb.maxy=O.y),k=k.next}}var I=n.aabb,S=i.aabb;I.minx>S.minx&&(I.minx=S.minx),S.maxx>I.maxx&&(I.maxx=S.maxx),I.miny>S.miny&&(I.miny=S.miny),S.maxy>I.maxy&&(I.maxy=S.maxy),e=e.next}}n.validate_mass(),n.validate_inertia();for(var P=n.shapes.head;null!=P;){var T=P.elt;if(T.type==me.id_ShapeType_POLYGON){var A=T.polygon;A.zip_sanitation&&(A.zip_sanitation=!1,A.splice_collinear_real());T.polygon.valid();null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1);var E=T.polygon;if(E.zip_gaxi&&null!=E.body){E.zip_gaxi=!1,E.validate_laxi();var N=E.body;if(N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),E.zip_gverts&&null!=E.body){E.zip_gverts=!1,E.validate_lverts();var L=E.body;L.zip_axis&&(L.zip_axis=!1,L.axisx=Math.sin(L.rot),L.axisy=Math.cos(L.rot));for(var V=E.lverts.next,j=E.gverts.next;null!=j;){var D=j,F=V;V=V.next,D.x=E.body.posx+(E.body.axisy*F.x-E.body.axisx*F.y),D.y=E.body.posy+(F.x*E.body.axisx+F.y*E.body.axisy),j=j.next}}var R=E.edges.head,B=E.gverts.next,G=B;for(B=B.next;null!=B;){var Z=B,U=R.elt;R=R.next,U.gp0=G,U.gp1=Z,U.gnormx=E.body.axisy*U.lnormx-E.body.axisx*U.lnormy,U.gnormy=U.lnormx*E.body.axisx+U.lnormy*E.body.axisy,U.gprojection=E.body.posx*U.gnormx+E.body.posy*U.gnormy+U.lprojection,null!=U.wrap_gnorm&&(U.wrap_gnorm.zpp_inner.x=U.gnormx,U.wrap_gnorm.zpp_inner.y=U.gnormy),U.tp0=U.gp0.y*U.gnormx-U.gp0.x*U.gnormy,U.tp1=U.gp1.y*U.gnormx-U.gp1.x*U.gnormy,G=Z,B=B.next}var q=E.gverts.next,Y=R.elt;R=R.next,Y.gp0=G,Y.gp1=q,Y.gnormx=E.body.axisy*Y.lnormx-E.body.axisx*Y.lnormy,Y.gnormy=Y.lnormx*E.body.axisx+Y.lnormy*E.body.axisy,Y.gprojection=E.body.posx*Y.gnormx+E.body.posy*Y.gnormy+Y.lprojection,null!=Y.wrap_gnorm&&(Y.wrap_gnorm.zpp_inner.x=Y.gnormx,Y.wrap_gnorm.zpp_inner.y=Y.gnormy),Y.tp0=Y.gp0.y*Y.gnormx-Y.gp0.x*Y.gnormy,Y.tp1=Y.gp1.y*Y.gnormx-Y.gp1.x*Y.gnormy}}P=P.next}n.sweepFrozen=!0},validation:function(){var n=this.cbsets;if(!n.cbsets.empty()){for(var e=n.cbsets.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(e.data.validate(),null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}for(var i=this.live.head;null!=i;){var t=i.elt;t.sweepRadius=0;for(var l=t.shapes.head;null!=l;){var p=l.elt;if(p.type==me.id_ShapeType_POLYGON){var r=p.polygon;r.zip_sanitation&&(r.zip_sanitation=!1,r.splice_collinear_real());p.polygon.valid();null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1);var a=p.polygon;if(a.zip_gaxi&&null!=a.body){a.zip_gaxi=!1,a.validate_laxi();var s=a.body;if(s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot)),a.zip_gverts&&null!=a.body){a.zip_gverts=!1,a.validate_lverts();var o=a.body;o.zip_axis&&(o.zip_axis=!1,o.axisx=Math.sin(o.rot),o.axisy=Math.cos(o.rot));for(var _=a.lverts.next,h=a.gverts.next;null!=h;){var u=h,x=_;_=_.next,u.x=a.body.posx+(a.body.axisy*x.x-a.body.axisx*x.y),u.y=a.body.posy+(x.x*a.body.axisx+x.y*a.body.axisy),h=h.next}}var d=a.edges.head,v=a.gverts.next,z=v;for(v=v.next;null!=v;){var c=v,m=d.elt;d=d.next,m.gp0=z,m.gp1=c,m.gnormx=a.body.axisy*m.lnormx-a.body.axisx*m.lnormy,m.gnormy=m.lnormx*a.body.axisx+m.lnormy*a.body.axisy,m.gprojection=a.body.posx*m.gnormx+a.body.posy*m.gnormy+m.lprojection,null!=m.wrap_gnorm&&(m.wrap_gnorm.zpp_inner.x=m.gnormx,m.wrap_gnorm.zpp_inner.y=m.gnormy),m.tp0=m.gp0.y*m.gnormx-m.gp0.x*m.gnormy,m.tp1=m.gp1.y*m.gnormx-m.gp1.x*m.gnormy,z=c,v=v.next}var y=a.gverts.next,f=d.elt;d=d.next,f.gp0=z,f.gp1=y,f.gnormx=a.body.axisy*f.lnormx-a.body.axisx*f.lnormy,f.gnormy=f.lnormx*a.body.axisx+f.lnormy*a.body.axisy,f.gprojection=a.body.posx*f.gnormx+a.body.posy*f.gnormy+f.lprojection,null!=f.wrap_gnorm&&(f.wrap_gnorm.zpp_inner.x=f.gnormx,f.wrap_gnorm.zpp_inner.y=f.gnormy),f.tp0=f.gp0.y*f.gnormx-f.gp0.x*f.gnormy,f.tp1=f.gp1.y*f.gnormx-f.gp1.x*f.gnormy}}p.validate_sweepRadius(),p.sweepRadius>t.sweepRadius&&(t.sweepRadius=p.sweepRadius),l=l.next}if(t.validate_mass(),t.validate_inertia(),null!=t.shapes.head){if(t.zip_aabb){t.zip_aabb=!1,t.aabb.minx=Infinity,t.aabb.miny=Infinity,t.aabb.maxx=-Infinity,t.aabb.maxy=-Infinity;for(var b=t.shapes.head;null!=b;){var g=b.elt;if(g.zip_aabb&&null!=g.body)if(g.zip_aabb=!1,g.type==me.id_ShapeType_CIRCLE){var w=g.circle;if(w.zip_worldCOM&&null!=w.body){if(w.zip_worldCOM=!1,w.zip_localCOM){if(w.zip_localCOM=!1,w.type==me.id_ShapeType_POLYGON){var M=w.polygon;if(null==M.lverts.next.next)M.localCOMx=M.lverts.next.x,M.localCOMy=M.lverts.next.y;else if(null==M.lverts.next.next.next){M.localCOMx=M.lverts.next.x,M.localCOMy=M.lverts.next.y;M.localCOMx+=1*M.lverts.next.next.x,M.localCOMy+=1*M.lverts.next.next.y;M.localCOMx*=.5,M.localCOMy*=.5}else{M.localCOMx=0,M.localCOMy=0;var C=0,k=M.lverts.next,O=k;k=k.next;var I=k;for(k=k.next;null!=k;){var S=k;C+=I.x*(S.y-O.y);var P=S.y*I.x-S.x*I.y;M.localCOMx+=(I.x+S.x)*P,M.localCOMy+=(I.y+S.y)*P,O=I,I=S,k=k.next}k=M.lverts.next;var T=k;C+=I.x*(T.y-O.y);var A=T.y*I.x-T.x*I.y;M.localCOMx+=(I.x+T.x)*A,M.localCOMy+=(I.y+T.y)*A,O=I,I=T,k=k.next;var E=k;C+=I.x*(E.y-O.y);var N=E.y*I.x-E.x*I.y;M.localCOMx+=(I.x+E.x)*N,M.localCOMy+=(I.y+E.y)*N,C=1/(3*C);var L=C;M.localCOMx*=L,M.localCOMy*=L}}null!=w.wrap_localCOM&&(w.wrap_localCOM.zpp_inner.x=w.localCOMx,w.wrap_localCOM.zpp_inner.y=w.localCOMy)}var V=w.body;V.zip_axis&&(V.zip_axis=!1,V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot)),w.worldCOMx=w.body.posx+(w.body.axisy*w.localCOMx-w.body.axisx*w.localCOMy),w.worldCOMy=w.body.posy+(w.localCOMx*w.body.axisx+w.localCOMy*w.body.axisy)}var j=w.radius,D=w.radius;w.aabb.minx=w.worldCOMx-j,w.aabb.miny=w.worldCOMy-D,w.aabb.maxx=w.worldCOMx+j,w.aabb.maxy=w.worldCOMy+D}else{var F=g.polygon;if(F.zip_gverts&&null!=F.body){F.zip_gverts=!1,F.validate_lverts();var R=F.body;R.zip_axis&&(R.zip_axis=!1,R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot));for(var B=F.lverts.next,G=F.gverts.next;null!=G;){var Z=G,U=B;B=B.next,Z.x=F.body.posx+(F.body.axisy*U.x-F.body.axisx*U.y),Z.y=F.body.posy+(U.x*F.body.axisx+U.y*F.body.axisy),G=G.next}}var q=F.gverts.next;F.aabb.minx=q.x,F.aabb.miny=q.y,F.aabb.maxx=q.x,F.aabb.maxy=q.y;for(var Y=F.gverts.next.next;null!=Y;){var K=Y;F.aabb.minx>K.x&&(F.aabb.minx=K.x),K.x>F.aabb.maxx&&(F.aabb.maxx=K.x),F.aabb.miny>K.y&&(F.aabb.miny=K.y),K.y>F.aabb.maxy&&(F.aabb.maxy=K.y),Y=Y.next}}var W=t.aabb,J=g.aabb;W.minx>J.minx&&(W.minx=J.minx),J.maxx>W.maxx&&(W.maxx=J.maxx),W.miny>J.miny&&(W.miny=J.miny),J.maxy>W.maxy&&(W.maxy=J.maxy),b=b.next}}t.validate_worldCOM()}if(t.validate_gravMass(),t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),t.component.woken&&null!=t.cbSet)for(var X=t.cbSet.bodylisteners.head;null!=X;){var H=X.elt;if(H.event==me.id_CbEvent_WAKE){var Q=this.push_callback(H);Q.event=me.id_CbEvent_WAKE,Q.body=t,X=X.next}else X=X.next}t.component.woken=!1;for(var $=t.shapes.head;null!=$;){this.bphase.sync($.elt),$=$.next}i=i.next}for(var nn=this.kinematics.head;null!=nn;){var en=nn.elt;en.sweepRadius=0;for(var tn=en.shapes.head;null!=tn;){var ln=tn.elt;if(ln.type==me.id_ShapeType_POLYGON){var pn=ln.polygon;pn.zip_sanitation&&(pn.zip_sanitation=!1,pn.splice_collinear_real());ln.polygon.valid();null==me.ValidationResult_VALID&&(me.internal=!0,me.ValidationResult_VALID=new ie,me.internal=!1);var rn=ln.polygon;if(rn.zip_gaxi&&null!=rn.body){rn.zip_gaxi=!1,rn.validate_laxi();var an=rn.body;if(an.zip_axis&&(an.zip_axis=!1,an.axisx=Math.sin(an.rot),an.axisy=Math.cos(an.rot)),rn.zip_gverts&&null!=rn.body){rn.zip_gverts=!1,rn.validate_lverts();var sn=rn.body;sn.zip_axis&&(sn.zip_axis=!1,sn.axisx=Math.sin(sn.rot),sn.axisy=Math.cos(sn.rot));for(var on=rn.lverts.next,_n=rn.gverts.next;null!=_n;){var hn=_n,un=on;on=on.next,hn.x=rn.body.posx+(rn.body.axisy*un.x-rn.body.axisx*un.y),hn.y=rn.body.posy+(un.x*rn.body.axisx+un.y*rn.body.axisy),_n=_n.next}}var xn=rn.edges.head,dn=rn.gverts.next,vn=dn;for(dn=dn.next;null!=dn;){var zn=dn,cn=xn.elt;xn=xn.next,cn.gp0=vn,cn.gp1=zn,cn.gnormx=rn.body.axisy*cn.lnormx-rn.body.axisx*cn.lnormy,cn.gnormy=cn.lnormx*rn.body.axisx+cn.lnormy*rn.body.axisy,cn.gprojection=rn.body.posx*cn.gnormx+rn.body.posy*cn.gnormy+cn.lprojection,null!=cn.wrap_gnorm&&(cn.wrap_gnorm.zpp_inner.x=cn.gnormx,cn.wrap_gnorm.zpp_inner.y=cn.gnormy),cn.tp0=cn.gp0.y*cn.gnormx-cn.gp0.x*cn.gnormy,cn.tp1=cn.gp1.y*cn.gnormx-cn.gp1.x*cn.gnormy,vn=zn,dn=dn.next}var mn=rn.gverts.next,yn=xn.elt;xn=xn.next,yn.gp0=vn,yn.gp1=mn,yn.gnormx=rn.body.axisy*yn.lnormx-rn.body.axisx*yn.lnormy,yn.gnormy=yn.lnormx*rn.body.axisx+yn.lnormy*rn.body.axisy,yn.gprojection=rn.body.posx*yn.gnormx+rn.body.posy*yn.gnormy+yn.lprojection,null!=yn.wrap_gnorm&&(yn.wrap_gnorm.zpp_inner.x=yn.gnormx,yn.wrap_gnorm.zpp_inner.y=yn.gnormy),yn.tp0=yn.gp0.y*yn.gnormx-yn.gp0.x*yn.gnormy,yn.tp1=yn.gp1.y*yn.gnormx-yn.gp1.x*yn.gnormy}}ln.validate_sweepRadius(),ln.sweepRadius>en.sweepRadius&&(en.sweepRadius=ln.sweepRadius),tn=tn.next}if(en.validate_mass(),en.validate_inertia(),null!=en.shapes.head){if(en.zip_aabb){en.zip_aabb=!1,en.aabb.minx=Infinity,en.aabb.miny=Infinity,en.aabb.maxx=-Infinity,en.aabb.maxy=-Infinity;for(var fn=en.shapes.head;null!=fn;){var bn=fn.elt;if(bn.zip_aabb&&null!=bn.body)if(bn.zip_aabb=!1,bn.type==me.id_ShapeType_CIRCLE){var gn=bn.circle;if(gn.zip_worldCOM&&null!=gn.body){if(gn.zip_worldCOM=!1,gn.zip_localCOM){if(gn.zip_localCOM=!1,gn.type==me.id_ShapeType_POLYGON){var wn=gn.polygon;if(null==wn.lverts.next.next)wn.localCOMx=wn.lverts.next.x,wn.localCOMy=wn.lverts.next.y;else if(null==wn.lverts.next.next.next){wn.localCOMx=wn.lverts.next.x,wn.localCOMy=wn.lverts.next.y;wn.localCOMx+=1*wn.lverts.next.next.x,wn.localCOMy+=1*wn.lverts.next.next.y;wn.localCOMx*=.5,wn.localCOMy*=.5}else{wn.localCOMx=0,wn.localCOMy=0;var Mn=0,Cn=wn.lverts.next,kn=Cn;Cn=Cn.next;var On=Cn;for(Cn=Cn.next;null!=Cn;){var In=Cn;Mn+=On.x*(In.y-kn.y);var Sn=In.y*On.x-In.x*On.y;wn.localCOMx+=(On.x+In.x)*Sn,wn.localCOMy+=(On.y+In.y)*Sn,kn=On,On=In,Cn=Cn.next}Cn=wn.lverts.next;var Pn=Cn;Mn+=On.x*(Pn.y-kn.y);var Tn=Pn.y*On.x-Pn.x*On.y;wn.localCOMx+=(On.x+Pn.x)*Tn,wn.localCOMy+=(On.y+Pn.y)*Tn,kn=On,On=Pn,Cn=Cn.next;var An=Cn;Mn+=On.x*(An.y-kn.y);var En=An.y*On.x-An.x*On.y;wn.localCOMx+=(On.x+An.x)*En,wn.localCOMy+=(On.y+An.y)*En,Mn=1/(3*Mn);var Nn=Mn;wn.localCOMx*=Nn,wn.localCOMy*=Nn}}null!=gn.wrap_localCOM&&(gn.wrap_localCOM.zpp_inner.x=gn.localCOMx,gn.wrap_localCOM.zpp_inner.y=gn.localCOMy)}var Ln=gn.body;Ln.zip_axis&&(Ln.zip_axis=!1,Ln.axisx=Math.sin(Ln.rot),Ln.axisy=Math.cos(Ln.rot)),gn.worldCOMx=gn.body.posx+(gn.body.axisy*gn.localCOMx-gn.body.axisx*gn.localCOMy),gn.worldCOMy=gn.body.posy+(gn.localCOMx*gn.body.axisx+gn.localCOMy*gn.body.axisy)}var Vn=gn.radius,jn=gn.radius;gn.aabb.minx=gn.worldCOMx-Vn,gn.aabb.miny=gn.worldCOMy-jn,gn.aabb.maxx=gn.worldCOMx+Vn,gn.aabb.maxy=gn.worldCOMy+jn}else{var Dn=bn.polygon;if(Dn.zip_gverts&&null!=Dn.body){Dn.zip_gverts=!1,Dn.validate_lverts();var Fn=Dn.body;Fn.zip_axis&&(Fn.zip_axis=!1,Fn.axisx=Math.sin(Fn.rot),Fn.axisy=Math.cos(Fn.rot));for(var Rn=Dn.lverts.next,Bn=Dn.gverts.next;null!=Bn;){var Gn=Bn,Zn=Rn;Rn=Rn.next,Gn.x=Dn.body.posx+(Dn.body.axisy*Zn.x-Dn.body.axisx*Zn.y),Gn.y=Dn.body.posy+(Zn.x*Dn.body.axisx+Zn.y*Dn.body.axisy),Bn=Bn.next}}var Un=Dn.gverts.next;Dn.aabb.minx=Un.x,Dn.aabb.miny=Un.y,Dn.aabb.maxx=Un.x,Dn.aabb.maxy=Un.y;for(var qn=Dn.gverts.next.next;null!=qn;){var Yn=qn;Dn.aabb.minx>Yn.x&&(Dn.aabb.minx=Yn.x),Yn.x>Dn.aabb.maxx&&(Dn.aabb.maxx=Yn.x),Dn.aabb.miny>Yn.y&&(Dn.aabb.miny=Yn.y),Yn.y>Dn.aabb.maxy&&(Dn.aabb.maxy=Yn.y),qn=qn.next}}var Kn=en.aabb,Wn=bn.aabb;Kn.minx>Wn.minx&&(Kn.minx=Wn.minx),Wn.maxx>Kn.maxx&&(Kn.maxx=Wn.maxx),Kn.miny>Wn.miny&&(Kn.miny=Wn.miny),Wn.maxy>Kn.maxy&&(Kn.maxy=Wn.maxy),fn=fn.next}}en.validate_worldCOM()}en.validate_gravMass(),en.zip_axis&&(en.zip_axis=!1,en.axisx=Math.sin(en.rot),en.axisy=Math.cos(en.rot));for(var Jn=en.shapes.head;null!=Jn;){this.bphase.sync(Jn.elt),Jn=Jn.next}nn=nn.next}for(var Xn=this.live_constraints.head;null!=Xn;){var Hn=Xn.elt;if(Hn.active){if(Hn.validate(),Hn.component.woken&&null!=Hn.cbSet)for(var Qn=Hn.cbSet.conlisteners.head;null!=Qn;){var $n=Qn.elt;if($n.event==me.id_CbEvent_WAKE){var ne=this.push_callback($n);ne.event=me.id_CbEvent_WAKE,ne.constraint=Hn,Qn=Qn.next}else Qn=Qn.next}Hn.component.woken=!1}Xn=Xn.next}},updateVel:function(n){for(var e=1-n*this.global_lin_drag,i=1-n*this.global_ang_drag,t=this.live.head;null!=t;){var l=t.elt;if(0!=l.smass){var p=n*l.imass;l.velx=e*l.velx+(l.forcex+this.gravityx*l.gravMass)*p,l.vely=e*l.vely+(l.forcey+this.gravityy*l.gravMass)*p}if(0!=l.sinertia){var r=0,a=0;r=l.worldCOMx-l.posx,a=l.worldCOMy-l.posy;l.angvel=i*l.angvel+(l.torque+(this.gravityy*r-this.gravityx*a)*l.gravMass)*n*l.iinertia}t,t=t.next}},updatePos:function(n){for(var e=2*Math.PI/n,i=this.live.head;null!=i;){var t=i.elt;t.pre_posx=t.posx,t.pre_posy=t.posy,t.pre_rot=t.rot,t.sweepTime=0,t.sweep_angvel=t.angvel%e;var l=n-t.sweepTime;if(0!=l){t.sweepTime=n;var p=l;if(t.posx+=t.velx*p,t.posy+=t.vely*p,0!=t.angvel){var r=t.sweep_angvel*l;if(t.rot+=r,r*r>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var a=r*r,s=1-.5*a,o=1-a*a/8,_=(s*t.axisx+r*t.axisy)*o;t.axisy=(s*t.axisy-r*t.axisx)*o,t.axisx=_}}}if(t.disableCCD)t.sweepFrozen=!0,t.bullet=!1;else{var h=y.staticCCDLinearThreshold*t.sweepRadius,u=y.staticCCDAngularThreshold;if((t.velx*t.velx+t.vely*t.vely)*n*n>h*h||t.angvel*t.angvel*n*n>u*u||t.type==me.id_BodyType_KINEMATIC){var x=t.sweep_angvel;0>x&&(x=-x);for(var d=1/x,v=t.shapes.head;null!=v;){var z=v.elt,c=z.aabb,m=c.minx,f=c.miny,b=c.maxx,g=c.maxy,w=x*n*z.sweepCoef*.008333333333333333|0;w>8&&(w=8);var M=x*n/w,C=n-t.sweepTime;if(0!=C){t.sweepTime=n;var k=C;if(t.posx+=t.velx*k,t.posy+=t.vely*k,0!=t.angvel){var O=t.sweep_angvel*C;if(t.rot+=O,O*O>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var I=O*O,S=1-.5*I,P=1-I*I/8,T=(S*t.axisx+O*t.axisy)*P;t.axisy=(S*t.axisy-O*t.axisx)*P,t.axisx=T}}}if(z.type==me.id_ShapeType_CIRCLE){var A=z.circle;A.worldCOMx=A.body.posx+(A.body.axisy*A.localCOMx-A.body.axisx*A.localCOMy),A.worldCOMy=A.body.posy+(A.localCOMx*A.body.axisx+A.localCOMy*A.body.axisy),A.aabb.minx=A.worldCOMx-A.radius,A.aabb.miny=A.worldCOMy-A.radius,A.aabb.maxx=A.worldCOMx+A.radius,A.aabb.maxy=A.worldCOMy+A.radius}else{var E=z.polygon,N=E.lverts.next,L=E.gverts.next,V=N;N=N.next,L.x=E.body.posx+(E.body.axisy*V.x-E.body.axisx*V.y),L.y=E.body.posy+(V.x*E.body.axisx+V.y*E.body.axisy),E.aabb.minx=L.x,E.aabb.miny=L.y,E.aabb.maxx=L.x,E.aabb.maxy=L.y;for(var j=E.gverts.next.next;null!=j;){var D=j,F=N;N=N.next,D.x=E.body.posx+(E.body.axisy*F.x-E.body.axisx*F.y),D.y=E.body.posy+(F.x*E.body.axisx+F.y*E.body.axisy),E.aabb.minx>D.x&&(E.aabb.minx=D.x),D.x>E.aabb.maxx&&(E.aabb.maxx=D.x),E.aabb.miny>D.y&&(E.aabb.miny=D.y),D.y>E.aabb.maxy&&(E.aabb.maxy=D.y),j=j.next}}c.minx>m?c.minx=m:m=c.minx,c.miny>f?c.miny=f:f=c.miny,b>c.maxx?c.maxx=b:b=c.maxx,g>c.maxy?c.maxy=g:g=c.maxy;for(var R=1,B=w;B>R;){var G=R++,Z=M*G*d,U=Z-t.sweepTime;if(0!=U){t.sweepTime=Z;var q=U;if(t.posx+=t.velx*q,t.posy+=t.vely*q,0!=t.angvel){var Y=t.sweep_angvel*U;if(t.rot+=Y,Y*Y>1e-4)t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot);else{var K=Y*Y,W=1-.5*K,J=1-K*K/8,X=(W*t.axisx+Y*t.axisy)*J;t.axisy=(W*t.axisy-Y*t.axisx)*J,t.axisx=X}}}if(z.type==me.id_ShapeType_CIRCLE){var H=z.circle;H.worldCOMx=H.body.posx+(H.body.axisy*H.localCOMx-H.body.axisx*H.localCOMy),H.worldCOMy=H.body.posy+(H.localCOMx*H.body.axisx+H.localCOMy*H.body.axisy),H.aabb.minx=H.worldCOMx-H.radius,H.aabb.miny=H.worldCOMy-H.radius,H.aabb.maxx=H.worldCOMx+H.radius,H.aabb.maxy=H.worldCOMy+H.radius}else{var Q=z.polygon,$=Q.lverts.next,nn=Q.gverts.next,en=$;$=$.next,nn.x=Q.body.posx+(Q.body.axisy*en.x-Q.body.axisx*en.y),nn.y=Q.body.posy+(en.x*Q.body.axisx+en.y*Q.body.axisy),Q.aabb.minx=nn.x,Q.aabb.miny=nn.y,Q.aabb.maxx=nn.x,Q.aabb.maxy=nn.y;for(var tn=Q.gverts.next.next;null!=tn;){var ln=tn,pn=$;$=$.next,ln.x=Q.body.posx+(Q.body.axisy*pn.x-Q.body.axisx*pn.y),ln.y=Q.body.posy+(pn.x*Q.body.axisx+pn.y*Q.body.axisy),Q.aabb.minx>ln.x&&(Q.aabb.minx=ln.x),ln.x>Q.aabb.maxx&&(Q.aabb.maxx=ln.x),Q.aabb.miny>ln.y&&(Q.aabb.miny=ln.y),ln.y>Q.aabb.maxy&&(Q.aabb.maxy=ln.y),tn=tn.next}}c.minx>m?c.minx=m:m=c.minx,c.miny>f?c.miny=f:f=c.miny,b>c.maxx?c.maxx=b:b=c.maxx,g>c.maxy?c.maxy=g:g=c.maxy}this.bphase.sync(z),v=v.next}if(t.sweepFrozen=!1,t.type==me.id_BodyType_DYNAMIC&&t.bulletEnabled){var rn=y.bulletCCDLinearThreshold*t.sweepRadius,an=y.bulletCCDAngularThreshold;((t.velx*t.velx+t.vely*t.vely)*n*n>rn*rn||t.angvel*t.angvel*n*n>an*an)&&(t.bullet=!0)}}else t.sweepFrozen=!0,t.bullet=!1}i=i.next}for(var sn=this.kinematics.head;null!=sn;){var on=sn.elt;on.pre_posx=on.posx,on.pre_posy=on.posy,on.pre_rot=on.rot,on.sweepTime=0,on.sweep_angvel=on.angvel%e;var _n=n-on.sweepTime;if(0!=_n){on.sweepTime=n;var hn=_n;if(on.posx+=on.velx*hn,on.posy+=on.vely*hn,0!=on.angvel){var un=on.sweep_angvel*_n;if(on.rot+=un,un*un>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var xn=un*un,dn=1-.5*xn,vn=1-xn*xn/8,zn=(dn*on.axisx+un*on.axisy)*vn;on.axisy=(dn*on.axisy-un*on.axisx)*vn,on.axisx=zn}}}if(on.disableCCD)on.sweepFrozen=!0,on.bullet=!1;else{var cn=y.staticCCDLinearThreshold*on.sweepRadius,mn=y.staticCCDAngularThreshold;if((on.velx*on.velx+on.vely*on.vely)*n*n>cn*cn||on.angvel*on.angvel*n*n>mn*mn||on.type==me.id_BodyType_KINEMATIC){var yn=on.sweep_angvel;0>yn&&(yn=-yn);for(var fn=1/yn,bn=on.shapes.head;null!=bn;){var gn=bn.elt,wn=gn.aabb,Mn=wn.minx,Cn=wn.miny,kn=wn.maxx,On=wn.maxy,In=yn*n*gn.sweepCoef*.008333333333333333|0;In>8&&(In=8);var Sn=yn*n/In,Pn=n-on.sweepTime;if(0!=Pn){on.sweepTime=n;var Tn=Pn;if(on.posx+=on.velx*Tn,on.posy+=on.vely*Tn,0!=on.angvel){var An=on.sweep_angvel*Pn;if(on.rot+=An,An*An>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var En=An*An,Nn=1-.5*En,Ln=1-En*En/8,Vn=(Nn*on.axisx+An*on.axisy)*Ln;on.axisy=(Nn*on.axisy-An*on.axisx)*Ln,on.axisx=Vn}}}if(gn.type==me.id_ShapeType_CIRCLE){var jn=gn.circle;jn.worldCOMx=jn.body.posx+(jn.body.axisy*jn.localCOMx-jn.body.axisx*jn.localCOMy),jn.worldCOMy=jn.body.posy+(jn.localCOMx*jn.body.axisx+jn.localCOMy*jn.body.axisy),jn.aabb.minx=jn.worldCOMx-jn.radius,jn.aabb.miny=jn.worldCOMy-jn.radius,jn.aabb.maxx=jn.worldCOMx+jn.radius,jn.aabb.maxy=jn.worldCOMy+jn.radius}else{var Dn=gn.polygon,Fn=Dn.lverts.next,Rn=Dn.gverts.next,Bn=Fn;Fn=Fn.next,Rn.x=Dn.body.posx+(Dn.body.axisy*Bn.x-Dn.body.axisx*Bn.y),Rn.y=Dn.body.posy+(Bn.x*Dn.body.axisx+Bn.y*Dn.body.axisy),Dn.aabb.minx=Rn.x,Dn.aabb.miny=Rn.y,Dn.aabb.maxx=Rn.x,Dn.aabb.maxy=Rn.y;for(var Gn=Dn.gverts.next.next;null!=Gn;){var Zn=Gn,Un=Fn;Fn=Fn.next,Zn.x=Dn.body.posx+(Dn.body.axisy*Un.x-Dn.body.axisx*Un.y),Zn.y=Dn.body.posy+(Un.x*Dn.body.axisx+Un.y*Dn.body.axisy),Dn.aabb.minx>Zn.x&&(Dn.aabb.minx=Zn.x),Zn.x>Dn.aabb.maxx&&(Dn.aabb.maxx=Zn.x),Dn.aabb.miny>Zn.y&&(Dn.aabb.miny=Zn.y),Zn.y>Dn.aabb.maxy&&(Dn.aabb.maxy=Zn.y),Gn=Gn.next}}wn.minx>Mn?wn.minx=Mn:Mn=wn.minx,wn.miny>Cn?wn.miny=Cn:Cn=wn.miny,kn>wn.maxx?wn.maxx=kn:kn=wn.maxx,On>wn.maxy?wn.maxy=On:On=wn.maxy;for(var qn=1,Yn=In;Yn>qn;){var Kn=qn++,Wn=Sn*Kn*fn,Jn=Wn-on.sweepTime;if(0!=Jn){on.sweepTime=Wn;var Xn=Jn;if(on.posx+=on.velx*Xn,on.posy+=on.vely*Xn,0!=on.angvel){var Hn=on.sweep_angvel*Jn;if(on.rot+=Hn,Hn*Hn>1e-4)on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot);else{var Qn=Hn*Hn,$n=1-.5*Qn,ne=1-Qn*Qn/8,ee=($n*on.axisx+Hn*on.axisy)*ne;on.axisy=($n*on.axisy-Hn*on.axisx)*ne,on.axisx=ee}}}if(gn.type==me.id_ShapeType_CIRCLE){var ie=gn.circle;ie.worldCOMx=ie.body.posx+(ie.body.axisy*ie.localCOMx-ie.body.axisx*ie.localCOMy),ie.worldCOMy=ie.body.posy+(ie.localCOMx*ie.body.axisx+ie.localCOMy*ie.body.axisy),ie.aabb.minx=ie.worldCOMx-ie.radius,ie.aabb.miny=ie.worldCOMy-ie.radius,ie.aabb.maxx=ie.worldCOMx+ie.radius,ie.aabb.maxy=ie.worldCOMy+ie.radius}else{var te=gn.polygon,le=te.lverts.next,pe=te.gverts.next,re=le;le=le.next,pe.x=te.body.posx+(te.body.axisy*re.x-te.body.axisx*re.y),pe.y=te.body.posy+(re.x*te.body.axisx+re.y*te.body.axisy),te.aabb.minx=pe.x,te.aabb.miny=pe.y,te.aabb.maxx=pe.x,te.aabb.maxy=pe.y;for(var ae=te.gverts.next.next;null!=ae;){var se=ae,oe=le;le=le.next,se.x=te.body.posx+(te.body.axisy*oe.x-te.body.axisx*oe.y),se.y=te.body.posy+(oe.x*te.body.axisx+oe.y*te.body.axisy),te.aabb.minx>se.x&&(te.aabb.minx=se.x),se.x>te.aabb.maxx&&(te.aabb.maxx=se.x),te.aabb.miny>se.y&&(te.aabb.miny=se.y),se.y>te.aabb.maxy&&(te.aabb.maxy=se.y),ae=ae.next}}wn.minx>Mn?wn.minx=Mn:Mn=wn.minx,wn.miny>Cn?wn.miny=Cn:Cn=wn.miny,kn>wn.maxx?wn.maxx=kn:kn=wn.maxx,On>wn.maxy?wn.maxy=On:On=wn.maxy}this.bphase.sync(gn),bn=bn.next}if(on.sweepFrozen=!1,on.type==me.id_BodyType_DYNAMIC&&on.bulletEnabled){var _e=y.bulletCCDLinearThreshold*on.sweepRadius,he=y.bulletCCDAngularThreshold;((on.velx*on.velx+on.vely*on.vely)*n*n>_e*_e||on.angvel*on.angvel*n*n>he*he)&&(on.bullet=!0)}}else on.sweepFrozen=!0,on.bullet=!1}sn=sn.next}},continuous:null,presteparb:function(n,e,i){null==i&&(i=!1);var t=this;if(!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0,!0;if(!n.cleared||0!=n.present||n.intchange){var l=!i&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,p=n.fresh&&!n.cleared&&!n.intchange;if(l&&(n.endGenerated=this.stamp),p||l||n.cleared||n.intchange){for(var r=n.ws1,a=n.ws2,s=this.mrca1;null!=s.head;){var o=s.head;s.head=o.next;var _=o;_.elt=null,_.next=Nt.zpp_pool,Nt.zpp_pool=_,null==s.head&&(s.pushmod=!0),s.modified=!0,s.length--}s.pushmod=!0;for(var h=this.mrca2;null!=h.head;){var u=h.head;h.head=u.next;var x=u;x.elt=null,x.next=Nt.zpp_pool,Nt.zpp_pool=x,null==h.head&&(h.pushmod=!0),h.modified=!0,h.length--}if(h.pushmod=!0,null!=r.cbSet){var d,v=this.mrca1;null==Nt.zpp_pool?d=new Nt:(d=Nt.zpp_pool,Nt.zpp_pool=d.next,d.next=null),d.elt=r;var z=d;z.next=v.head,v.head=z,v.modified=!0,v.length++}if(null!=r.body.cbSet){var c,m=this.mrca1,f=r.body;null==Nt.zpp_pool?c=new Nt:(c=Nt.zpp_pool,Nt.zpp_pool=c.next,c.next=null),c.elt=f;var b=c;b.next=m.head,m.head=b,m.modified=!0,m.length++}if(null!=a.cbSet){var g,w=this.mrca2;null==Nt.zpp_pool?g=new Nt:(g=Nt.zpp_pool,Nt.zpp_pool=g.next,g.next=null),g.elt=a;var M=g;M.next=w.head,w.head=M,w.modified=!0,w.length++}if(null!=a.body.cbSet){var C,k=this.mrca2,O=a.body;null==Nt.zpp_pool?C=new Nt:(C=Nt.zpp_pool,Nt.zpp_pool=C.next,C.next=null),C.elt=O;var I=C;I.next=k.head,k.head=I,k.modified=!0,k.length++}for(var S=r.body.compound,P=a.body.compound;S!=P;){var T=null==S?0:S.depth;if((null==P?0:P.depth)>T){if(null!=P.cbSet){var A,E=this.mrca2;null==Nt.zpp_pool?A=new Nt:(A=Nt.zpp_pool,Nt.zpp_pool=A.next,A.next=null),A.elt=P;var N=A;N.next=E.head,E.head=N,E.modified=!0,E.length++}P=P.compound}else{if(null!=S.cbSet){var L,V=this.mrca1;null==Nt.zpp_pool?L=new Nt:(L=Nt.zpp_pool,Nt.zpp_pool=L.next,L.next=null),L.elt=S;var j=L;j.next=V.head,V.head=j,V.modified=!0,V.length++}S=S.compound}}for(var D=this.mrca1.head;null!=D;){for(var F=D.elt,R=this.mrca2.head;null!=R;){for(var B=R.elt,G=F.cbSet,Z=B.cbSet,U=null,q=Z.cbpairs.length>G.cbpairs.length?G.cbpairs:Z.cbpairs,Y=q.head;null!=Y;){var K=Y.elt;if(K.a==G&&K.b==Z||K.a==Z&&K.b==G){U=K;break}Y=Y.next}if(null==U){var W;null==_e.zpp_pool?W=new _e:(W=_e.zpp_pool,_e.zpp_pool=W.next,W.next=null),W.zip_listeners=!0,oe.setlt(G,Z)?(W.a=G,W.b=Z):(W.a=Z,W.b=G),U=W,G.cbpairs.add(U),Z!=G&&Z.cbpairs.add(U)}if(U.zip_listeners&&(U.zip_listeners=!1,U.__validate()),null!=U.listeners.head){var J=Oi.get(F,B);if(p||n.intchange){null==J&&(J=Zi.get(F,B),this.add_callbackset(J));for(var X=me.id_CbEvent_BEGIN,H=null,Q=Z.cbpairs.length>G.cbpairs.length?G.cbpairs:Z.cbpairs,$=Q.head;null!=$;){var nn=$.elt;if(nn.a==G&&nn.b==Z||nn.a==Z&&nn.b==G){H=nn;break}$=$.next}if(null==H){var en;null==_e.zpp_pool?en=new _e:(en=_e.zpp_pool,_e.zpp_pool=en.next,en.next=null),en.zip_listeners=!0,oe.setlt(G,Z)?(en.a=G,en.b=Z):(en.a=Z,en.b=G),H=en,G.cbpairs.add(H),Z!=G&&Z.cbpairs.add(H)}H.zip_listeners&&(H.zip_listeners=!1,H.__validate());for(var tn=H.listeners.head;null!=tn;){var ln=tn.elt;if(ln.event==X&&0!=(ln.itype&n.type)&&J.empty_arb(ln.itype)){var pn=t.push_callback(ln);pn.event=me.id_CbEvent_BEGIN;var rn,an=J.int1,sn=J.int2,on=ln.options1,_n=an.cbTypes;if(on.nonemptyintersection(_n,on.includes)&&!on.nonemptyintersection(_n,on.excludes)){var hn=ln.options2,un=sn.cbTypes;rn=!!hn.nonemptyintersection(un,hn.includes)&&!hn.nonemptyintersection(un,hn.excludes)}else rn=!1;rn?(pn.int1=an,pn.int2=sn):(pn.int1=sn,pn.int2=an),pn.set=J}tn=tn.next}var xn,dn;dn=!1;for(var vn=J.arbiters.head;null!=vn;){if(vn.elt==n){dn=!0;break}vn=vn.next}if(dn)xn=!1;else{var zn,cn=J.arbiters;null==Vt.zpp_pool?zn=new Vt:(zn=Vt.zpp_pool,Vt.zpp_pool=zn.next,zn.next=null),zn.elt=n;var mn=zn;mn.next=cn.head,cn.head=mn,cn.modified=!0,cn.length++,xn=!0}xn&&n.present++}else{n.present--,J.remove_arb(n);for(var yn=me.id_CbEvent_END,fn=null,bn=Z.cbpairs.length>G.cbpairs.length?G.cbpairs:Z.cbpairs,gn=bn.head;null!=gn;){var wn=gn.elt;if(wn.a==G&&wn.b==Z||wn.a==Z&&wn.b==G){fn=wn;break}gn=gn.next}if(null==fn){var Mn;null==_e.zpp_pool?Mn=new _e:(Mn=_e.zpp_pool,_e.zpp_pool=Mn.next,Mn.next=null),Mn.zip_listeners=!0,oe.setlt(G,Z)?(Mn.a=G,Mn.b=Z):(Mn.a=Z,Mn.b=G),fn=Mn,G.cbpairs.add(fn),Z!=G&&Z.cbpairs.add(fn)}fn.zip_listeners&&(fn.zip_listeners=!1,fn.__validate());for(var Cn=fn.listeners.head;null!=Cn;){var kn=Cn.elt;if(kn.event==yn&&0!=(kn.itype&n.type)&&J.empty_arb(kn.itype)){var On=t.push_callback(kn);On.event=me.id_CbEvent_END;var In,Sn=J.int1,Pn=J.int2,Tn=kn.options1,An=Sn.cbTypes;if(Tn.nonemptyintersection(An,Tn.includes)&&!Tn.nonemptyintersection(An,Tn.excludes)){var En=kn.options2,Nn=Pn.cbTypes;In=!!En.nonemptyintersection(Nn,En.includes)&&!En.nonemptyintersection(Nn,En.excludes)}else In=!1;In?(On.int1=Sn,On.int2=Pn):(On.int1=Pn,On.int2=Sn),On.set=J}Cn=Cn.next}null==J.arbiters.head&&this.remove_callbackset(J)}R=R.next}else R=R.next}D=D.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||this.stamp>n.up_stamp+(n.type==Ve.COL?y.arbiterExpirationDelay:0)){if(n.type==Ve.SENSOR){var Ln=n.sensorarb;if(!Ln.cleared){for(var Vn=Ln.b1.arbiters,jn=null,Dn=Vn.head;null!=Dn;){if(Dn.elt==Ln){var Fn,Rn;null==jn?(Fn=Vn.head,Rn=Fn.next,null==(Vn.head=Rn)&&(Vn.pushmod=!0)):(Fn=jn.next,Rn=Fn.next,jn.next=Rn,null==Rn&&(Vn.pushmod=!0));var Bn=Fn;Bn.elt=null,Bn.next=Vt.zpp_pool,Vt.zpp_pool=Bn,Vn.modified=!0,Vn.length--,Vn.pushmod=!0,!0;break}jn=Dn,Dn=Dn.next}for(var Gn=Ln.b2.arbiters,Zn=null,Un=Gn.head;null!=Un;){if(Un.elt==Ln){var qn,Yn;null==Zn?(qn=Gn.head,Yn=qn.next,null==(Gn.head=Yn)&&(Gn.pushmod=!0)):(qn=Zn.next,Yn=qn.next,Zn.next=Yn,null==Yn&&(Gn.pushmod=!0));var Kn=qn;Kn.elt=null,Kn.next=Vt.zpp_pool,Vt.zpp_pool=Kn,Gn.modified=!0,Gn.length--,Gn.pushmod=!0,!0;break}Zn=Un,Un=Un.next}null!=Ln.pair&&(Ln.pair.arb=null,Ln.pair=null)}Ln.b1=Ln.b2=null,Ln.active=!1,Ln.intchange=!1;var Wn=Ln;Wn.next=je.zpp_pool,je.zpp_pool=Wn}else if(n.type==Ve.FLUID){var Jn=n.fluidarb;if(!Jn.cleared){for(var Xn=Jn.b1.arbiters,Hn=null,Qn=Xn.head;null!=Qn;){if(Qn.elt==Jn){var $n,ne;null==Hn?($n=Xn.head,ne=$n.next,null==(Xn.head=ne)&&(Xn.pushmod=!0)):($n=Hn.next,ne=$n.next,Hn.next=ne,null==ne&&(Xn.pushmod=!0));var ee=$n;ee.elt=null,ee.next=Vt.zpp_pool,Vt.zpp_pool=ee,Xn.modified=!0,Xn.length--,Xn.pushmod=!0,!0;break}Hn=Qn,Qn=Qn.next}for(var ie=Jn.b2.arbiters,te=null,le=ie.head;null!=le;){if(le.elt==Jn){var pe,re;null==te?(pe=ie.head,re=pe.next,null==(ie.head=re)&&(ie.pushmod=!0)):(pe=te.next,re=pe.next,te.next=re,null==re&&(ie.pushmod=!0));var ae=pe;ae.elt=null,ae.next=Vt.zpp_pool,Vt.zpp_pool=ae,ie.modified=!0,ie.length--,ie.pushmod=!0,!0;break}te=le,le=le.next}null!=Jn.pair&&(Jn.pair.arb=null,Jn.pair=null)}Jn.b1=Jn.b2=null,Jn.active=!1,Jn.intchange=!1;var se=Jn;se.next=De.zpp_pool,De.zpp_pool=se,Jn.pre_dt=-1}else{var he=n.colarb;if(!he.cleared){for(var ue=he.b1.arbiters,xe=null,de=ue.head;null!=de;){if(de.elt==he){var ve,ze;null==xe?(ve=ue.head,ze=ve.next,null==(ue.head=ze)&&(ue.pushmod=!0)):(ve=xe.next,ze=ve.next,xe.next=ze,null==ze&&(ue.pushmod=!0));var ce=ve;ce.elt=null,ce.next=Vt.zpp_pool,Vt.zpp_pool=ce,ue.modified=!0,ue.length--,ue.pushmod=!0,!0;break}xe=de,de=de.next}for(var ye=he.b2.arbiters,fe=null,be=ye.head;null!=be;){if(be.elt==he){var ge,we;null==fe?(ge=ye.head,we=ge.next,null==(ye.head=we)&&(ye.pushmod=!0)):(ge=fe.next,we=ge.next,fe.next=we,null==we&&(ye.pushmod=!0));var Me=ge;Me.elt=null,Me.next=Vt.zpp_pool,Vt.zpp_pool=Me,ye.modified=!0,ye.length--,ye.pushmod=!0,!0;break}fe=be,be=be.next}null!=he.pair&&(he.pair.arb=null,he.pair=null)}for(he.b1=he.b2=null,he.active=!1,he.intchange=!1;null!=he.contacts.next;){var Ce=he.contacts,ke=Ce.next;Ce.pop();var Oe=ke;Oe.arbiter=null,Oe.next=Re.zpp_pool,Re.zpp_pool=Oe;var Ie=he.innards,Se=Ie.next;Ie.next=Se.next,Se._inuse=!1,null==Ie.next&&(Ie.pushmod=!0),Ie.modified=!0,Ie.length--}var Pe=he;Pe.userdef_dyn_fric=!1,Pe.userdef_stat_fric=!1,Pe.userdef_restitution=!1,Pe.userdef_rfric=!1,Pe.__ref_edge1=Pe.__ref_edge2=null,Pe.next=Fe.zpp_pool,Fe.zpp_pool=Pe,he.pre_dt=-1}return!0}var Te=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(n.immState&me.id_ImmState_ACCEPT)){if(n.active&&n.type!=Ve.SENSOR)if(null!=n.colarb){var Ae=n.colarb;Ae.invalidated&&(Ae.invalidated=!1,Ae.userdef_restitution||(Ae.restitution=Ae.s1.material.elasticity>-Infinity&&Ae.s2.material.elasticity>-Infinity?Ae.s1.material.elasticity<Infinity&&Ae.s2.material.elasticity<Infinity?(Ae.s1.material.elasticity+Ae.s2.material.elasticity)/2:1:0,0>Ae.restitution&&(Ae.restitution=0),Ae.restitution>1&&(Ae.restitution=1)),Ae.userdef_dyn_fric||(Ae.dyn_fric=Math.sqrt(Ae.s1.material.dynamicFriction*Ae.s2.material.dynamicFriction)),Ae.userdef_stat_fric||(Ae.stat_fric=Math.sqrt(Ae.s1.material.staticFriction*Ae.s2.material.staticFriction)),Ae.userdef_rfric||(Ae.rfric=Math.sqrt(Ae.s1.material.rollingFriction*Ae.s2.material.rollingFriction))),-1==Ae.pre_dt&&(Ae.pre_dt=e);var Ee=e/Ae.pre_dt;Ae.pre_dt=e;var Ne=Ae.b1.smass+Ae.b2.smass;Ae.hc2=!1;var Le=!0,Be=Ae.b1.type!=me.id_BodyType_DYNAMIC||Ae.b2.type!=me.id_BodyType_DYNAMIC,Ge=Be?Ae.continuous?y.contactContinuousStaticBiasCoef:y.contactStaticBiasCoef:Ae.continuous?y.contactContinuousBiasCoef:y.contactBiasCoef;Ae.biasCoef=Ge,Ae.continuous=!1;for(var Ze=null,Ue=null,qe=Ae.innards.next,Ye=Ae.contacts.next;null!=Ye;){var Ke=Ye;if(Ke.stamp+y.arbiterExpirationDelay<Ae.stamp){var We,Je,Xe=Ae.contacts;null==Ze?(We=Xe.next,Je=We.next,null==(Xe.next=Je)&&(Xe.pushmod=!0)):(We=Ze.next,Je=We.next,Ze.next=Je,null==Je&&(Xe.pushmod=!0)),We._inuse=!1,Xe.modified=!0,Xe.length--,Xe.pushmod=!0,Ye=Je;var He,Qe,$e=Ae.innards;null==Ue?(He=$e.next,Qe=He.next,null==($e.next=Qe)&&($e.pushmod=!0)):(He=Ue.next,Qe=He.next,Ue.next=Qe,null==Qe&&($e.pushmod=!0)),He._inuse=!1,$e.modified=!0,$e.length--,$e.pushmod=!0,qe=Qe;var ni=Ke;ni.arbiter=null,ni.next=Re.zpp_pool,Re.zpp_pool=ni}else{var ei=Ke.inner,ii=Ke.active;if(Ke.active=Ke.stamp==Ae.stamp){Le?(Le=!1,Ae.c1=ei,Ae.oc1=Ke):(Ae.hc2=!0,Ae.c2=ei,Ae.oc2=Ke),ei.r2x=Ke.px-Ae.b2.posx,ei.r2y=Ke.py-Ae.b2.posy,ei.r1x=Ke.px-Ae.b1.posx,ei.r1y=Ke.py-Ae.b1.posy;var ti=ei.r2x*Ae.nx+ei.r2y*Ae.ny,li=Ne+Ae.b2.sinertia*(ti*ti),pi=ei.r1x*Ae.nx+ei.r1y*Ae.ny;li+=Ae.b1.sinertia*(pi*pi),ei.tMass=y.epsilon*y.epsilon>li?0:1/li;var ri=Ae.ny*ei.r2x-Ae.nx*ei.r2y,ai=Ne+Ae.b2.sinertia*(ri*ri),si=Ae.ny*ei.r1x-Ae.nx*ei.r1y;ai+=Ae.b1.sinertia*(si*si),ei.nMass=y.epsilon*y.epsilon>ai?0:1/ai;var oi=0,_i=0,hi=Ae.b2.angvel+Ae.b2.kinangvel;oi=Ae.b2.velx+Ae.b2.kinvelx-ei.r2y*hi,_i=Ae.b2.vely+Ae.b2.kinvely+ei.r2x*hi,hi=Ae.b1.angvel+Ae.b1.kinangvel,oi-=Ae.b1.velx+Ae.b1.kinvelx-ei.r1y*hi,_i-=Ae.b1.vely+Ae.b1.kinvely+ei.r1x*hi;var ui=Ae.nx*oi+Ae.ny*_i;Ke.elasticity=Ae.restitution,ei.bounce=ui*Ke.elasticity,ei.bounce>-y.elasticThreshold&&(ei.bounce=0),ui=_i*Ae.nx-oi*Ae.ny;var xi=y.staticFrictionThreshold;ei.friction=ui*ui>xi*xi?Ae.dyn_fric:Ae.stat_fric,ei.jnAcc*=Ee,ei.jtAcc*=Ee}ii!=Ke.active&&(Ae.contacts.modified=!0),Ze=Ye,Ue=qe,qe=qe.next,Ye=Ye.next}}if(Ae.hc2){if(Ae.hpc2=!0,Ae.oc1.posOnly){var di=Ae.c1;Ae.c1=Ae.c2,Ae.c2=di;var vi=Ae.oc1;Ae.oc1=Ae.oc2,Ae.oc2=vi,Ae.hc2=!1}else Ae.oc2.posOnly&&(Ae.hc2=!1);Ae.oc1.posOnly&&(Le=!0)}else Ae.hpc2=!1;if(Ae.jrAcc*=Ee,Le||(Ae.rn1a=Ae.ny*Ae.c1.r1x-Ae.nx*Ae.c1.r1y,Ae.rt1a=Ae.c1.r1x*Ae.nx+Ae.c1.r1y*Ae.ny,Ae.rn1b=Ae.ny*Ae.c1.r2x-Ae.nx*Ae.c1.r2y,Ae.rt1b=Ae.c1.r2x*Ae.nx+Ae.c1.r2y*Ae.ny,Ae.k1x=Ae.b2.kinvelx-Ae.c1.r2y*Ae.b2.kinangvel-(Ae.b1.kinvelx-Ae.c1.r1y*Ae.b1.kinangvel),Ae.k1y=Ae.b2.kinvely+Ae.c1.r2x*Ae.b2.kinangvel-(Ae.b1.kinvely+Ae.c1.r1x*Ae.b1.kinangvel)),Ae.hc2){Ae.rn2a=Ae.ny*Ae.c2.r1x-Ae.nx*Ae.c2.r1y,Ae.rt2a=Ae.c2.r1x*Ae.nx+Ae.c2.r1y*Ae.ny,Ae.rn2b=Ae.ny*Ae.c2.r2x-Ae.nx*Ae.c2.r2y,Ae.rt2b=Ae.c2.r2x*Ae.nx+Ae.c2.r2y*Ae.ny,Ae.k2x=Ae.b2.kinvelx-Ae.c2.r2y*Ae.b2.kinangvel-(Ae.b1.kinvelx-Ae.c2.r1y*Ae.b1.kinangvel),Ae.k2y=Ae.b2.kinvely+Ae.c2.r2x*Ae.b2.kinangvel-(Ae.b1.kinvely+Ae.c2.r1x*Ae.b1.kinangvel),Ae.kMassa=Ne+Ae.b1.sinertia*Ae.rn1a*Ae.rn1a+Ae.b2.sinertia*Ae.rn1b*Ae.rn1b,Ae.kMassb=Ne+Ae.b1.sinertia*Ae.rn1a*Ae.rn2a+Ae.b2.sinertia*Ae.rn1b*Ae.rn2b,Ae.kMassc=Ne+Ae.b1.sinertia*Ae.rn2a*Ae.rn2a+Ae.b2.sinertia*Ae.rn2b*Ae.rn2b;var zi=Ae.kMassa*Ae.kMassa+2*Ae.kMassb*Ae.kMassb+Ae.kMassc*Ae.kMassc;if(y.illConditionedThreshold*(Ae.kMassa*Ae.kMassc-Ae.kMassb*Ae.kMassb)>zi){Ae.Ka=Ae.kMassa,Ae.Kb=Ae.kMassb,Ae.Kc=Ae.kMassc;var ci=Ae.kMassa*Ae.kMassc-Ae.kMassb*Ae.kMassb;if(ci!=ci)Ae.kMassa=Ae.kMassb=Ae.kMassc=0;else if(0==ci){var mi=0;0!=Ae.kMassa?Ae.kMassa=1/Ae.kMassa:(Ae.kMassa=0,mi|=1),0!=Ae.kMassc?Ae.kMassc=1/Ae.kMassc:(Ae.kMassc=0,mi|=2),Ae.kMassb=0}else{ci=1/ci;var yi=Ae.kMassc*ci;Ae.kMassc=Ae.kMassa*ci,Ae.kMassa=yi,Ae.kMassb*=-ci}}else{if(Ae.hc2=!1,Ae.oc1.dist>Ae.oc2.dist){var fi=Ae.c1;Ae.c1=Ae.c2,Ae.c2=fi}Ae.oc2.active=!1,Ae.contacts.modified=!0}}Ae.surfacex=Ae.b2.svelx,Ae.surfacey=Ae.b2.svely;Ae.surfacex+=1*Ae.b1.svelx,Ae.surfacey+=1*Ae.b1.svely,Ae.surfacex=-Ae.surfacex,Ae.surfacey=-Ae.surfacey,Ae.rMass=Ae.b1.sinertia+Ae.b2.sinertia,0!=Ae.rMass&&(Ae.rMass=1/Ae.rMass),Le&&(n.active=!1)}else{var bi=n.fluidarb;-1==bi.pre_dt&&(bi.pre_dt=e);var gi=e/bi.pre_dt;bi.pre_dt=e,bi.r1x=bi.centroidx-bi.b1.posx,bi.r1y=bi.centroidy-bi.b1.posy,bi.r2x=bi.centroidx-bi.b2.posx,bi.r2y=bi.centroidy-bi.b2.posy;var wi=0,Mi=0;bi.ws1.fluidEnabled&&null!=bi.ws1.fluidProperties.wrap_gravity?(wi=bi.ws1.fluidProperties.gravityx,Mi=bi.ws1.fluidProperties.gravityy):(wi=this.gravityx,Mi=this.gravityy);var Ci=0,ki=0;bi.ws2.fluidEnabled&&null!=bi.ws2.fluidProperties.wrap_gravity?(Ci=bi.ws2.fluidProperties.gravityx,ki=bi.ws2.fluidProperties.gravityy):(Ci=this.gravityx,ki=this.gravityy);var Ii=0,Si=0;if(bi.ws1.fluidEnabled&&bi.ws2.fluidEnabled){var Pi=bi.overlap*bi.ws1.fluidProperties.density,Ti=bi.overlap*bi.ws2.fluidProperties.density;if(Pi>Ti){var Ai=Pi+Ti;Ii-=wi*Ai,Si-=Mi*Ai}else if(Ti>Pi){var Ei=Pi+Ti;Ii+=Ci*Ei,Si+=ki*Ei}else{var Ni=0,Li=0;Ni=wi+Ci,Li=Mi+ki;if(Ni*=.5,Li*=.5,bi.ws1.worldCOMx*Ni+bi.ws1.worldCOMy*Li>bi.ws2.worldCOMx*Ni+bi.ws2.worldCOMy*Li){var Vi=Pi+Ti;Ii-=Ni*Vi,Si-=Li*Vi}else{var ji=Pi+Ti;Ii+=Ni*ji,Si+=Li*ji}}}else if(bi.ws1.fluidEnabled){var Di=bi.overlap*bi.ws1.fluidProperties.density,Fi=Di;Ii-=wi*Fi,Si-=Mi*Fi}else if(bi.ws2.fluidEnabled){var Ri=bi.overlap*bi.ws2.fluidProperties.density,Bi=Ri;Ii+=Ci*Bi,Si+=ki*Bi}var Gi=e;if(Ii*=Gi,Si*=Gi,bi.buoyx=Ii,bi.buoyy=Si,bi.b1.type==me.id_BodyType_DYNAMIC){var Ui=bi.b1.imass;bi.b1.velx-=Ii*Ui,bi.b1.vely-=Si*Ui,bi.b1.angvel-=(Si*bi.r1x-Ii*bi.r1y)*bi.b1.iinertia}if(bi.b2.type==me.id_BodyType_DYNAMIC){var qi=bi.b2.imass;bi.b2.velx+=Ii*qi,bi.b2.vely+=Si*qi,bi.b2.angvel+=(Si*bi.r2x-Ii*bi.r2y)*bi.b2.iinertia}if(bi.ws1.fluidEnabled&&0!=bi.ws1.fluidProperties.viscosity||bi.ws2.fluidEnabled&&0!=bi.ws2.fluidProperties.viscosity){bi.nodrag=!1;var Yi=0;if(bi.ws1.fluidEnabled&&(bi.ws2.validate_angDrag(),Yi+=bi.ws1.fluidProperties.viscosity*bi.ws2.angDrag*bi.overlap/bi.ws2.area),bi.ws2.fluidEnabled&&(bi.ws1.validate_angDrag(),Yi+=bi.ws2.fluidProperties.viscosity*bi.ws1.angDrag*bi.overlap/bi.ws1.area),0!=Yi){var Ki=bi.b1.sinertia+bi.b2.sinertia;bi.wMass=0!=Ki?1/Ki:0;Yi*=4e-4;var Wi=2*Math.PI*Yi;bi.agamma=1/(e*Wi*(2+Wi*e));var Ji=1/(1+bi.agamma);e*Wi*Wi*bi.agamma,bi.agamma*=Ji,bi.wMass*=Ji}else bi.wMass=0,bi.agamma=0;var Xi=bi.b2.velx+bi.b2.kinvelx-bi.r2y*(bi.b2.angvel+bi.b2.kinangvel)-(bi.b1.velx+bi.b1.kinvelx-bi.r1y*(bi.b2.angvel+bi.b2.kinangvel)),Hi=bi.b2.vely+bi.b2.kinvely+bi.r2x*(bi.b2.angvel+bi.b2.kinangvel)-(bi.b1.vely+bi.b1.kinvely+bi.r1x*(bi.b1.angvel+bi.b1.kinangvel));if(y.epsilon*y.epsilon<=Xi*Xi+Hi*Hi){var Qi=Xi*Xi+Hi*Hi,$i=1/Math.sqrt(Qi),nt=$i;Xi*=nt,Hi*=nt,bi.nx=Xi,bi.ny=Hi}var et=0;if(bi.ws1.fluidEnabled){var it=-bi.ws1.fluidProperties.viscosity*bi.overlap/bi.ws2.area;if(bi.ws2.type==me.id_ShapeType_CIRCLE)et-=it*bi.ws2.circle.radius*y.fluidLinearDrag/(2*bi.ws2.circle.radius*Math.PI);else{for(var tt=bi.ws2.polygon,lt=0,pt=0,rt=tt.edges.head;null!=rt;){var at=rt.elt;lt+=at.length;var st=it*at.length*(at.gnormx*bi.nx+at.gnormy*bi.ny);st>0&&(st*=-y.fluidVacuumDrag,st=st),pt-=.5*st*y.fluidLinearDrag,rt=rt.next}et+=pt/lt}}if(bi.ws2.fluidEnabled){var ot=-bi.ws2.fluidProperties.viscosity*bi.overlap/bi.ws1.area;if(bi.ws1.type==me.id_ShapeType_CIRCLE)et-=ot*bi.ws1.circle.radius*y.fluidLinearDrag/(2*bi.ws1.circle.radius*Math.PI);else{for(var _t=bi.ws1.polygon,ht=0,ut=0,xt=_t.edges.head;null!=xt;){var dt=xt.elt;ht+=dt.length;var vt=ot*dt.length*(dt.gnormx*bi.nx+dt.gnormy*bi.ny);vt>0&&(vt*=-y.fluidVacuumDrag,vt=vt),ut-=.5*vt*y.fluidLinearDrag,xt=xt.next}et+=ut/ht}}if(0!=et){var zt=bi.b1.smass+bi.b2.smass,ct=0,mt=0,yt=0;if(ct=zt,mt=0,yt=zt,0!=bi.b1.sinertia){var ft=bi.r1x*bi.b1.sinertia,bt=bi.r1y*bi.b1.sinertia;ct+=bt*bi.r1y,mt+=-bt*bi.r1x,yt+=ft*bi.r1x}if(0!=bi.b2.sinertia){var gt=bi.r2x*bi.b2.sinertia,wt=bi.r2y*bi.b2.sinertia;ct+=wt*bi.r2y,mt+=-wt*bi.r2x,yt+=gt*bi.r2x}var Mt=ct*yt-mt*mt;if(Mt!=Mt)yt=0,mt=yt,ct=mt;else if(0==Mt){var Ct=0;0!=ct?ct=1/ct:(ct=0,Ct|=1),0!=yt?yt=1/yt:(yt=0,Ct|=2),mt=0}else{Mt=1/Mt;var kt=yt*Mt;yt=ct*Mt,ct=kt,mt*=-Mt}bi.vMassa=ct,bi.vMassb=mt,bi.vMassc=yt;var Ot=2*Math.PI*et;bi.lgamma=1/(e*Ot*(2+Ot*e));var It=1/(1+bi.lgamma);e*Ot*Ot*bi.lgamma,bi.lgamma*=It;var St=It;bi.vMassa*=St,bi.vMassb*=St,bi.vMassc*=St}else bi.vMassa=0,bi.vMassb=0,bi.vMassc=0,bi.lgamma=0}else bi.nodrag=!0,bi.dampx=0,bi.dampy=0,bi.adamp=0;var Pt=gi;bi.dampx*=Pt,bi.dampy*=Pt,bi.adamp*=gi}}else if(null!=n.colarb){var Tt=n.colarb,At=!0,Et=null,Lt=null,jt=Tt.innards.next;Tt.hc2=!1;for(var Dt=Tt.contacts.next;null!=Dt;){var Ft=Dt;if(Ft.stamp+y.arbiterExpirationDelay<Tt.stamp){var Rt,Bt,Gt=Tt.contacts;null==Et?(Rt=Gt.next,Bt=Rt.next,null==(Gt.next=Bt)&&(Gt.pushmod=!0)):(Rt=Et.next,Bt=Rt.next,Et.next=Bt,null==Bt&&(Gt.pushmod=!0)),Rt._inuse=!1,Gt.modified=!0,Gt.length--,Gt.pushmod=!0,Dt=Bt;var Zt,Ut,qt=Tt.innards;null==Lt?(Zt=qt.next,Ut=Zt.next,null==(qt.next=Ut)&&(qt.pushmod=!0)):(Zt=Lt.next,Ut=Zt.next,Lt.next=Ut,null==Ut&&(qt.pushmod=!0)),Zt._inuse=!1,qt.modified=!0,qt.length--,qt.pushmod=!0,jt=Ut;var Yt=Ft;Yt.arbiter=null,Yt.next=Re.zpp_pool,Re.zpp_pool=Yt}else{var Kt=Ft.inner,Wt=Ft.active;Ft.active=Ft.stamp==Tt.stamp,Ft.active&&(At?(At=!1,Tt.c1=Kt,Tt.oc1=Ft):(Tt.hc2=!0,Tt.c2=Kt,Tt.oc2=Ft)),Wt!=Ft.active&&(Tt.contacts.modified=!0),Et=Dt,Lt=jt,jt=jt.next,Dt=Dt.next}}if(Tt.hc2){if(Tt.hpc2=!0,Tt.oc1.posOnly){var Jt=Tt.c1;Tt.c1=Tt.c2,Tt.c2=Jt;var Xt=Tt.oc1;Tt.oc1=Tt.oc2,Tt.oc2=Xt,Tt.hc2=!1}else Tt.oc2.posOnly&&(Tt.hc2=!1);Tt.oc1.posOnly&&(At=!0)}else Tt.hpc2=!1;At&&(n.active=!1)}return Te!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},prestep:function(n){for(var e=null,i=this.live_constraints.head;null!=i;){var t=i.elt;t.preStep(n)?(i=this.live_constraints.erase(e),t.broken(),this.constraintCbBreak(t),t.removeOnBreak?(t.component.sleeping=!0,this.midstep=!1,null!=t.compound?t.compound.wrap_constraints.remove(t.outer):this.wrap_constraints.remove(t.outer),this.midstep=!0):t.active=!1,t.clearcache()):(e=i,i=i.next)}var l=null,p=this.c_arbiters_true,r=p.head,a=null!=this.c_arbiters_false;for(a&&null==r&&(a=!1,r=this.c_arbiters_false.head,p=this.c_arbiters_false,l=null);null!=r;){if(this.presteparb(r.elt,n)){var s,o;null==l?(s=p.head,o=s.next,null==(p.head=o)&&(p.pushmod=!0)):(s=l.next,o=s.next,l.next=o,null==o&&(p.pushmod=!0));var _=s;_.elt=null,_.next=el.zpp_pool,el.zpp_pool=_,p.modified=!0,p.length--,p.pushmod=!0,r=o,a&&null==r&&(a=!1,r=this.c_arbiters_false.head,p=this.c_arbiters_false,l=null)}else l=r,r=r.next,a&&null==r&&(a=!1,r=this.c_arbiters_false.head,p=this.c_arbiters_false,l=null)}var h=null,u=this.f_arbiters,x=u.head,d=!1;for(d&&null==x&&(d=!1,u=null,h=null);null!=x;){if(this.presteparb(x.elt,n)){var v,z;null==h?(v=u.head,z=v.next,null==(u.head=z)&&(u.pushmod=!0)):(v=h.next,z=v.next,h.next=z,null==z&&(u.pushmod=!0));var c=v;c.elt=null,c.next=$t.zpp_pool,$t.zpp_pool=c,u.modified=!0,u.length--,u.pushmod=!0,x=z,d&&null==x&&(d=!1,u=null,h=null)}else h=x,x=x.next,d&&null==x&&(d=!1,u=null,h=null)}var m=null,y=this.s_arbiters,f=y.head,b=!1;for(b&&null==f&&(b=!1,y=null,m=null);null!=f;){if(this.presteparb(f.elt,n)){var g,w;null==m?(g=y.head,w=g.next,null==(y.head=w)&&(y.pushmod=!0)):(g=m.next,w=g.next,m.next=w,null==w&&(y.pushmod=!0));var M=g;M.elt=null,M.next=nl.zpp_pool,nl.zpp_pool=M,y.modified=!0,y.length--,y.pushmod=!0,f=w,b&&null==f&&(b=!1,y=null,m=null)}else m=f,f=f.next,b&&null==f&&(b=!1,y=null,m=null)}},warmStart:function(){for(var n=this.f_arbiters.head;null!=n;){var e=n.elt;if(e.active&&0!=(e.immState&me.id_ImmState_ACCEPT)){var i=e.b1.imass;e.b1.velx-=e.dampx*i,e.b1.vely-=e.dampy*i;var t=e.b2.imass;e.b2.velx+=e.dampx*t,e.b2.vely+=e.dampy*t,e.b1.angvel-=e.b1.iinertia*(e.dampy*e.r1x-e.dampx*e.r1y),e.b2.angvel+=e.b2.iinertia*(e.dampy*e.r2x-e.dampx*e.r2y),e.b1.angvel-=e.adamp*e.b1.iinertia,e.b2.angvel+=e.adamp*e.b2.iinertia}n=n.next}var l=this.c_arbiters_false.head,p=!0;for(null==l&&(l=this.c_arbiters_true.head,p=!1);null!=l;){var r=l.elt;if(r.active&&0!=(r.immState&me.id_ImmState_ACCEPT)){var a=r.nx*r.c1.jnAcc-r.ny*r.c1.jtAcc,s=r.ny*r.c1.jnAcc+r.nx*r.c1.jtAcc,o=r.b1.imass;r.b1.velx-=a*o,r.b1.vely-=s*o,r.b1.angvel-=r.b1.iinertia*(s*r.c1.r1x-a*r.c1.r1y);var _=r.b2.imass;if(r.b2.velx+=a*_,r.b2.vely+=s*_,r.b2.angvel+=r.b2.iinertia*(s*r.c1.r2x-a*r.c1.r2y),r.hc2){var h=r.nx*r.c2.jnAcc-r.ny*r.c2.jtAcc,u=r.ny*r.c2.jnAcc+r.nx*r.c2.jtAcc,x=r.b1.imass;r.b1.velx-=h*x,r.b1.vely-=u*x,r.b1.angvel-=r.b1.iinertia*(u*r.c2.r1x-h*r.c2.r1y);var d=r.b2.imass;r.b2.velx+=h*d,r.b2.vely+=u*d,r.b2.angvel+=r.b2.iinertia*(u*r.c2.r2x-h*r.c2.r2y)}r.b2.angvel+=r.jrAcc*r.b2.iinertia,r.b1.angvel-=r.jrAcc*r.b1.iinertia}l=l.next,p&&null==l&&(l=this.c_arbiters_true.head,p=!1)}for(var v=this.live_constraints.head;null!=v;){v.elt.warmStart(),v=v.next}},iterateVel:function(n){for(var e=0,i=n;i>e;){for(var t=(e++,this.f_arbiters.head);null!=t;){var l=t.elt;if(l.active&&0!=(l.immState&me.id_ImmState_ACCEPT)&&!l.nodrag){var p=l.b1.angvel+l.b1.kinangvel,r=l.b2.angvel+l.b2.kinangvel,a=l.b1.velx+l.b1.kinvelx-l.r1y*p-(l.b2.velx+l.b2.kinvelx-l.r2y*r),s=l.b1.vely+l.b1.kinvely+l.r1x*p-(l.b2.vely+l.b2.kinvely+l.r2x*r),o=l.vMassa*a+l.vMassb*s;s=l.vMassb*a+l.vMassc*s,a=o;var _=l.lgamma;a-=l.dampx*_,s-=l.dampy*_;l.dampx+=1*a,l.dampy+=1*s;var h=l.b1.imass;l.b1.velx-=a*h,l.b1.vely-=s*h;var u=l.b2.imass;l.b2.velx+=a*u,l.b2.vely+=s*u,l.b1.angvel-=l.b1.iinertia*(s*l.r1x-a*l.r1y),l.b2.angvel+=l.b2.iinertia*(s*l.r2x-a*l.r2y);var x=(p-r)*l.wMass-l.adamp*l.agamma;l.adamp+=x,l.b1.angvel-=x*l.b1.iinertia,l.b2.angvel+=x*l.b2.iinertia}t=t.next}for(var d=null,v=this.live_constraints.head;null!=v;){var z=v.elt;z.applyImpulseVel()?(v=this.live_constraints.erase(d),z.broken(),this.constraintCbBreak(z),z.removeOnBreak?(z.component.sleeping=!0,this.midstep=!1,null!=z.compound?z.compound.wrap_constraints.remove(z.outer):this.wrap_constraints.remove(z.outer),this.midstep=!0):z.active=!1,z.clearcache()):(d=v,v=v.next)}var c=this.c_arbiters_false.head,m=!0;for(null==c&&(c=this.c_arbiters_true.head,m=!1);null!=c;){var y=c.elt;if(y.active&&0!=(y.immState&me.id_ImmState_ACCEPT)){var f,b,g,w,M,C,k=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),O=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel);if(g=(O*y.nx-k*y.ny+y.surfacex)*y.c1.tMass,w=y.c1.friction*y.c1.jnAcc,M=y.c1.jtAcc,C=M-g,C>w?C=w:-w>C&&(C=-w),g=C-M,y.c1.jtAcc=C,f=-y.ny*g,b=y.nx*g,y.b2.velx+=f*y.b2.imass,y.b2.vely+=b*y.b2.imass,y.b1.velx-=f*y.b1.imass,y.b1.vely-=b*y.b1.imass,y.b2.angvel+=y.rt1b*g*y.b2.iinertia,y.b1.angvel-=y.rt1a*g*y.b1.iinertia,y.hc2){var I=y.k2x+y.b2.velx-y.c2.r2y*y.b2.angvel-(y.b1.velx-y.c2.r1y*y.b1.angvel),S=y.k2y+y.b2.vely+y.c2.r2x*y.b2.angvel-(y.b1.vely+y.c2.r1x*y.b1.angvel);g=(S*y.nx-I*y.ny+y.surfacex)*y.c2.tMass,w=y.c2.friction*y.c2.jnAcc,M=y.c2.jtAcc,C=M-g,C>w?C=w:-w>C&&(C=-w),g=C-M,y.c2.jtAcc=C,f=-y.ny*g,b=y.nx*g,y.b2.velx+=f*y.b2.imass,y.b2.vely+=b*y.b2.imass,y.b1.velx-=f*y.b1.imass,y.b1.vely-=b*y.b1.imass,y.b2.angvel+=y.rt2b*g*y.b2.iinertia,y.b1.angvel-=y.rt2a*g*y.b1.iinertia,k=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),O=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel),I=y.k2x+y.b2.velx-y.c2.r2y*y.b2.angvel-(y.b1.velx-y.c2.r1y*y.b1.angvel),S=y.k2y+y.b2.vely+y.c2.r2x*y.b2.angvel-(y.b1.vely+y.c2.r1x*y.b1.angvel);var P=y.c1.jnAcc,T=y.c2.jnAcc,A=k*y.nx+O*y.ny+y.surfacey+y.c1.bounce-(y.Ka*P+y.Kb*T),E=I*y.nx+S*y.ny+y.surfacey+y.c2.bounce-(y.Kb*P+y.Kc*T),N=-(y.kMassa*A+y.kMassb*E),L=-(y.kMassb*A+y.kMassc*E);0>N||0>L?(N=-y.c1.nMass*A,0>N||0>y.Kb*N+E?(L=-y.c2.nMass*E,0>L||0>y.Kb*L+A?0>A||0>E?(A=0,E=0):(A=-P,E=-T,y.c1.jnAcc=y.c2.jnAcc=0):(A=-P,E=L-T,y.c1.jnAcc=0,y.c2.jnAcc=L)):(A=N-P,E=-T,y.c1.jnAcc=N,y.c2.jnAcc=0)):(A=N-P,E=L-T,y.c1.jnAcc=N,y.c2.jnAcc=L),g=A+E,f=y.nx*g,b=y.ny*g,y.b2.velx+=f*y.b2.imass,y.b2.vely+=b*y.b2.imass,y.b1.velx-=f*y.b1.imass,y.b1.vely-=b*y.b1.imass,y.b2.angvel+=(y.rn1b*A+y.rn2b*E)*y.b2.iinertia,y.b1.angvel-=(y.rn1a*A+y.rn2a*E)*y.b1.iinertia}else{if(0!=y.radius){g=(y.b2.angvel-y.b1.angvel)*y.rMass,w=y.rfric*y.c1.jnAcc,M=y.jrAcc,y.jrAcc-=g,y.jrAcc>w?y.jrAcc=w:-w>y.jrAcc&&(y.jrAcc=-w),g=y.jrAcc-M,y.b2.angvel+=g*y.b2.iinertia,y.b1.angvel-=g*y.b1.iinertia}k=y.k1x+y.b2.velx-y.c1.r2y*y.b2.angvel-(y.b1.velx-y.c1.r1y*y.b1.angvel),O=y.k1y+y.b2.vely+y.c1.r2x*y.b2.angvel-(y.b1.vely+y.c1.r1x*y.b1.angvel),g=(y.c1.bounce+(y.nx*k+y.ny*O)+y.surfacey)*y.c1.nMass,M=y.c1.jnAcc,C=M-g,0>C&&(C=0),g=C-M,y.c1.jnAcc=C,f=y.nx*g,b=y.ny*g,y.b2.velx+=f*y.b2.imass,y.b2.vely+=b*y.b2.imass,y.b1.velx-=f*y.b1.imass,y.b1.vely-=b*y.b1.imass,y.b2.angvel+=y.rn1b*g*y.b2.iinertia,y.b1.angvel-=y.rn1a*g*y.b1.iinertia}}c=c.next,m&&null==c&&(c=this.c_arbiters_true.head,m=!1)}}},iteratePos:function(n){for(var e=0,i=n;i>e;){for(var t=(e++,null),l=this.live_constraints.head;null!=l;){var p=l.elt;!p.__velocity&&p.stiff&&p.applyImpulsePos()?(l=this.live_constraints.erase(t),p.broken(),this.constraintCbBreak(p),p.removeOnBreak?(p.component.sleeping=!0,this.midstep=!1,null!=p.compound?p.compound.wrap_constraints.remove(p.outer):this.wrap_constraints.remove(p.outer),this.midstep=!0):p.active=!1,p.clearcache()):(t=l,l=l.next)}var r=this.c_arbiters_false.head,a=!0;for(null==r&&(r=this.c_arbiters_true.head,a=!1);null!=r;){var s=r.elt;if(s.active&&0!=(s.immState&me.id_ImmState_ACCEPT))if(2==s.ptype){var o=s.c1,_=0,h=0;_=s.b2.axisy*o.lr2x-s.b2.axisx*o.lr2y,h=o.lr2x*s.b2.axisx+o.lr2y*s.b2.axisy;_+=1*s.b2.posx,h+=1*s.b2.posy;var u=0,x=0;u=s.b1.axisy*o.lr1x-s.b1.axisx*o.lr1y,x=o.lr1x*s.b1.axisx+o.lr1y*s.b1.axisy;u+=1*s.b1.posx,x+=1*s.b1.posy;var d=0,v=0;d=_-u,v=h-x;var z=Math.sqrt(d*d+v*v),c=s.radius-y.collisionSlop,m=z-c;if(0>d*s.nx+v*s.ny&&(d=-d,v=-v,m-=s.radius),0>m)if(y.epsilon>z)0!=s.b1.smass?s.b1.posx+=10*y.epsilon:s.b2.posx+=10*y.epsilon;else{var f=1/z;d*=f,v*=f;var b=.5*(u+_),g=.5*(x+h),w=z-c;u=b-s.b1.posx,x=g-s.b1.posy,_=b-s.b2.posx,h=g-s.b2.posy;var M=v*u-d*x,C=v*_-d*h,k=s.b2.smass+C*C*s.b2.sinertia+s.b1.smass+M*M*s.b1.sinertia;if(0!=k){var O=-s.biasCoef*w/k,I=0,S=0,P=O;I=d*P,S=v*P;var T=s.b1.imass;s.b1.posx-=I*T,s.b1.posy-=S*T;var A=s.b1,E=-M*s.b1.iinertia*O;if(A.rot+=E,E*E>1e-4)A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot);else{var N=E*E,L=1-.5*N,V=1-N*N/8,j=(L*A.axisx+E*A.axisy)*V;A.axisy=(L*A.axisy-E*A.axisx)*V,A.axisx=j}var D=s.b2.imass;s.b2.posx+=I*D,s.b2.posy+=S*D;var F=s.b2,R=C*s.b2.iinertia*O;if(F.rot+=R,R*R>1e-4)F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot);else{var B=R*R,G=1-.5*B,Z=1-B*B/8,U=(G*F.axisx+R*F.axisy)*Z;F.axisy=(G*F.axisy-R*F.axisx)*Z,F.axisx=U}}}}else{var q,Y=0,K=0,W=0,J=0,X=0,H=0;if(0==s.ptype){Y=s.b1.axisy*s.lnormx-s.b1.axisx*s.lnormy,K=s.lnormx*s.b1.axisx+s.lnormy*s.b1.axisy,q=s.lproj+(Y*s.b1.posx+K*s.b1.posy),W=s.b2.axisy*s.c1.lr1x-s.b2.axisx*s.c1.lr1y,J=s.c1.lr1x*s.b2.axisx+s.c1.lr1y*s.b2.axisy;if(W+=1*s.b2.posx,J+=1*s.b2.posy,s.hpc2){X=s.b2.axisy*s.c2.lr1x-s.b2.axisx*s.c2.lr1y,H=s.c2.lr1x*s.b2.axisx+s.c2.lr1y*s.b2.axisy;X+=1*s.b2.posx,H+=1*s.b2.posy}}else{Y=s.b2.axisy*s.lnormx-s.b2.axisx*s.lnormy,K=s.lnormx*s.b2.axisx+s.lnormy*s.b2.axisy,q=s.lproj+(Y*s.b2.posx+K*s.b2.posy),W=s.b1.axisy*s.c1.lr1x-s.b1.axisx*s.c1.lr1y,J=s.c1.lr1x*s.b1.axisx+s.c1.lr1y*s.b1.axisy;if(W+=1*s.b1.posx,J+=1*s.b1.posy,s.hpc2){X=s.b1.axisy*s.c2.lr1x-s.b1.axisx*s.c2.lr1y,H=s.c2.lr1x*s.b1.axisx+s.c2.lr1y*s.b1.axisy;X+=1*s.b1.posx,H+=1*s.b1.posy}}var Q=W*Y+J*K-q-s.radius;Q+=y.collisionSlop;var $=0;if(s.hpc2&&($=X*Y+H*K-q-s.radius,$+=y.collisionSlop),0>Q||0>$){s.rev&&(Y=-Y,K=-K);var nn=0,en=0;nn=W-s.b1.posx,en=J-s.b1.posy;var tn=0,ln=0;tn=W-s.b2.posx,ln=J-s.b2.posy;var pn=0,rn=0,an=0,sn=0;if(s.hpc2){pn=X-s.b1.posx,rn=H-s.b1.posy,an=X-s.b2.posx,sn=H-s.b2.posy;var on=K*nn-Y*en,_n=K*tn-Y*ln,hn=K*pn-Y*rn,un=K*an-Y*sn,xn=s.b1.smass+s.b2.smass;s.kMassa=xn+s.b1.sinertia*on*on+s.b2.sinertia*_n*_n,s.kMassb=xn+s.b1.sinertia*on*hn+s.b2.sinertia*_n*un,s.kMassc=xn+s.b1.sinertia*hn*hn+s.b2.sinertia*un*un;var dn=0,vn=0,zn=0;dn=s.kMassa,vn=s.kMassb,zn=s.kMassc;for(var cn=Q*s.biasCoef,mn=$*s.biasCoef;;){var yn=0,fn=0;yn=cn,fn=mn,yn=-yn,fn=-fn;var bn=s.kMassa*s.kMassc-s.kMassb*s.kMassb;if(bn!=bn)fn=0,yn=fn;else if(0==bn)0!=s.kMassa?yn/=s.kMassa:yn=0,0!=s.kMassc?fn/=s.kMassc:fn=0;else{bn=1/bn;var gn=bn*(s.kMassc*yn-s.kMassb*fn);fn=bn*(s.kMassa*fn-s.kMassb*yn),yn=gn}if(yn>=0&&fn>=0){var wn=(yn+fn)*s.b1.imass;s.b1.posx-=Y*wn,s.b1.posy-=K*wn;var Mn=s.b1,Cn=-s.b1.iinertia*(on*yn+hn*fn);if(Mn.rot+=Cn,Cn*Cn>1e-4)Mn.axisx=Math.sin(Mn.rot),Mn.axisy=Math.cos(Mn.rot);else{var kn=Cn*Cn,On=1-.5*kn,In=1-kn*kn/8,Sn=(On*Mn.axisx+Cn*Mn.axisy)*In;Mn.axisy=(On*Mn.axisy-Cn*Mn.axisx)*In,Mn.axisx=Sn}var Pn=(yn+fn)*s.b2.imass;s.b2.posx+=Y*Pn,s.b2.posy+=K*Pn;var Tn=s.b2,An=s.b2.iinertia*(_n*yn+un*fn);if(Tn.rot+=An,An*An>1e-4)Tn.axisx=Math.sin(Tn.rot),Tn.axisy=Math.cos(Tn.rot);else{var En=An*An,Nn=1-.5*En,Ln=1-En*En/8,Vn=(Nn*Tn.axisx+An*Tn.axisy)*Ln;Tn.axisy=(Nn*Tn.axisy-An*Tn.axisx)*Ln,Tn.axisx=Vn}break}yn=-cn/dn,fn=0;var jn=vn*yn+mn;if(yn>=0&&jn>=0){var Dn=(yn+fn)*s.b1.imass;s.b1.posx-=Y*Dn,s.b1.posy-=K*Dn;var Fn=s.b1,Rn=-s.b1.iinertia*(on*yn+hn*fn);if(Fn.rot+=Rn,Rn*Rn>1e-4)Fn.axisx=Math.sin(Fn.rot),Fn.axisy=Math.cos(Fn.rot);else{var Bn=Rn*Rn,Gn=1-.5*Bn,Zn=1-Bn*Bn/8,Un=(Gn*Fn.axisx+Rn*Fn.axisy)*Zn;Fn.axisy=(Gn*Fn.axisy-Rn*Fn.axisx)*Zn,Fn.axisx=Un}var qn=(yn+fn)*s.b2.imass;s.b2.posx+=Y*qn,s.b2.posy+=K*qn;var Yn=s.b2,Kn=s.b2.iinertia*(_n*yn+un*fn);if(Yn.rot+=Kn,Kn*Kn>1e-4)Yn.axisx=Math.sin(Yn.rot),Yn.axisy=Math.cos(Yn.rot);else{var Wn=Kn*Kn,Jn=1-.5*Wn,Xn=1-Wn*Wn/8,Hn=(Jn*Yn.axisx+Kn*Yn.axisy)*Xn;Yn.axisy=(Jn*Yn.axisy-Kn*Yn.axisx)*Xn,Yn.axisx=Hn}break}yn=0,fn=-mn/zn;var Qn=vn*fn+cn;if(fn>=0&&Qn>=0){var $n=(yn+fn)*s.b1.imass;s.b1.posx-=Y*$n,s.b1.posy-=K*$n;var ne=s.b1,ee=-s.b1.iinertia*(on*yn+hn*fn);if(ne.rot+=ee,ee*ee>1e-4)ne.axisx=Math.sin(ne.rot),ne.axisy=Math.cos(ne.rot);else{var ie=ee*ee,te=1-.5*ie,le=1-ie*ie/8,pe=(te*ne.axisx+ee*ne.axisy)*le;ne.axisy=(te*ne.axisy-ee*ne.axisx)*le,ne.axisx=pe}var re=(yn+fn)*s.b2.imass;s.b2.posx+=Y*re,s.b2.posy+=K*re;var ae=s.b2,se=s.b2.iinertia*(_n*yn+un*fn);if(ae.rot+=se,se*se>1e-4)ae.axisx=Math.sin(ae.rot),ae.axisy=Math.cos(ae.rot);else{var oe=se*se,_e=1-.5*oe,he=1-oe*oe/8,ue=(_e*ae.axisx+se*ae.axisy)*he;ae.axisy=(_e*ae.axisy-se*ae.axisx)*he,ae.axisx=ue}break}break}}else{var xe=K*nn-Y*en,de=K*tn-Y*ln,ve=s.b2.smass+de*de*s.b2.sinertia+s.b1.smass+xe*xe*s.b1.sinertia;if(0!=ve){var ze=-s.biasCoef*Q/ve,ce=0,ye=0,fe=ze;ce=Y*fe,ye=K*fe;var be=s.b1.imass;s.b1.posx-=ce*be,s.b1.posy-=ye*be;var ge=s.b1,we=-xe*s.b1.iinertia*ze;if(ge.rot+=we,we*we>1e-4)ge.axisx=Math.sin(ge.rot),ge.axisy=Math.cos(ge.rot);else{var Me=we*we,Ce=1-.5*Me,ke=1-Me*Me/8,Oe=(Ce*ge.axisx+we*ge.axisy)*ke;ge.axisy=(Ce*ge.axisy-we*ge.axisx)*ke,ge.axisx=Oe}var Ie=s.b2.imass;s.b2.posx+=ce*Ie,s.b2.posy+=ye*Ie;var Se=s.b2,Pe=de*s.b2.iinertia*ze;if(Se.rot+=Pe,Pe*Pe>1e-4)Se.axisx=Math.sin(Se.rot),Se.axisy=Math.cos(Se.rot);else{var Te=Pe*Pe,Ae=1-.5*Te,Ee=1-Te*Te/8,Ne=(Ae*Se.axisx+Pe*Se.axisy)*Ee;Se.axisy=(Ae*Se.axisy-Pe*Se.axisx)*Ee,Se.axisx=Ne}}}}}r=r.next,a&&null==r&&(r=this.c_arbiters_true.head,a=!1)}}},group_ignore:function(n,e){for(var i=n;null!=i&&null==i.group;)i=null!=i.ishape?i.ishape.body:null!=i.icompound?i.icompound.compound:i.ibody.compound;var t=null==i?null:i.group;if(null==t)return!1;for(var l=e;null!=l&&null==l.group;)l=null!=l.ishape?l.ishape.body:null!=l.icompound?l.icompound.compound:l.ibody.compound;var p=null==l?null:l.group;if(null==p)return!1;for(var r=!1;null!=t&&null!=p;){if(t==p){r=t.ignore;break}p.depth>t.depth?p=p.group:t=t.group}return r},interactionType:function(n,e,i,t){var l;l=!1;for(var p=i.constraints.head;null!=p;){var r=p.elt;if(r.ignore&&r.pair_exists(i.id,t.id)){l=!0;break}p=p.next}var a;if(l)a=!1;else{for(var s=n;null!=s&&null==s.group;)s=null!=s.ishape?s.ishape.body:null!=s.icompound?s.icompound.compound:s.ibody.compound;var o,_=null==s?null:s.group;if(null==_)o=!1;else{for(var h=e;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:null!=h.icompound?h.icompound.compound:h.ibody.compound;var u=null==h?null:h.group;if(null==u)o=!1;else{for(var x=!1;null!=_&&null!=u;){if(_==u){x=_.ignore;break}u.depth>_.depth?u=u.group:_=_.group}o=x}}a=!o}if(a){var d;if(n.sensorEnabled||e.sensorEnabled){var v=n.filter,z=e.filter;d=0!=(v.sensorMask&z.sensorGroup)&&0!=(z.sensorMask&v.sensorGroup)}else d=!1;if(d)return 2;var c;if(n.fluidEnabled||e.fluidEnabled){var m=n.filter,y=e.filter;c=0!=(m.fluidMask&y.fluidGroup)&&0!=(y.fluidMask&m.fluidGroup)}else c=!1;if(!!c&&!(0==i.imass&&0==t.imass&&0==i.iinertia&&0==t.iinertia))return 0;var f,b=n.filter,g=e.filter;return f=0!=(b.collisionMask&g.collisionGroup)&&0!=(g.collisionMask&b.collisionGroup)&&!(0==i.imass&&0==t.imass&&0==i.iinertia&&0==t.iinertia),f?1:-1}return-1},precb:null,prelisteners:null,narrowPhase:function(n,e,i,t,l){var p,r=this,a=null,s=n.body,o=e.body;p=!1;for(var _=s.constraints.head;null!=_;){var h=_.elt;if(h.ignore&&h.pair_exists(s.id,o.id)){p=!0;break}_=_.next}var u,x;if(p)x=!1;else{for(var d=n;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var v,z=null==d?null:d.group;if(null==z)v=!1;else{for(var c=e;null!=c&&null==c.group;)c=null!=c.ishape?c.ishape.body:null!=c.icompound?c.icompound.compound:c.ibody.compound;var m=null==c?null:c.group;if(null==m)v=!1;else{for(var f=!1;null!=z&&null!=m;){if(z==m){f=z.ignore;break}m.depth>z.depth?m=m.group:z=z.group}v=f}}x=!v}if(x){var b;if(n.sensorEnabled||e.sensorEnabled){var g=n.filter,w=e.filter;b=0!=(g.sensorMask&w.sensorGroup)&&0!=(w.sensorMask&g.sensorGroup)}else b=!1;if(b)u=2;else{var M;if(n.fluidEnabled||e.fluidEnabled){var C=n.filter,k=e.filter;M=0!=(C.fluidMask&k.fluidGroup)&&0!=(k.fluidMask&C.fluidGroup)}else M=!1;if(!!M&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia))u=0;else{var O,I=n.filter,S=e.filter;O=0!=(I.collisionMask&S.collisionGroup)&&0!=(S.collisionMask&I.collisionGroup)&&!(0==s.imass&&0==o.imass&&0==s.iinertia&&0==o.iinertia),u=O?1:-1}}}else u=-1;if(-1!=u){var P,T;n.type>e.type?(P=e,T=n):n.type==e.type?e.id>n.id?(P=n,T=e):(T=n,P=e):(P=n,T=e);var A=P==e;if(0==u){var E;if(null==t){for(var N=null,L=o.arbiters.length>s.arbiters.length?s:o,V=L.arbiters.head;null!=V;){var j=V.elt;if(j.id==P.id&&j.di==T.id){N=j;break}V=V.next}E=N}else E=t;var F,R=null==E,B=!1;if(R)null==De.zpp_pool?F=new De:(F=De.zpp_pool,De.zpp_pool=F.next,F.next=null);else if(null==E.fluidarb){E.cleared=!0;for(var G=E.b1.arbiters,Z=null,U=G.head;null!=U;){if(U.elt==E){var q,Y;null==Z?(q=G.head,Y=q.next,null==(G.head=Y)&&(G.pushmod=!0)):(q=Z.next,Y=q.next,Z.next=Y,null==Y&&(G.pushmod=!0));var K=q;K.elt=null,K.next=Vt.zpp_pool,Vt.zpp_pool=K,G.modified=!0,G.length--,G.pushmod=!0,!0;break}Z=U,U=U.next}for(var W=E.b2.arbiters,J=null,X=W.head;null!=X;){if(X.elt==E){var H,Q;null==J?(H=W.head,Q=H.next,null==(W.head=Q)&&(W.pushmod=!0)):(H=J.next,Q=H.next,J.next=Q,null==Q&&(W.pushmod=!0));var $=H;$.elt=null,$.next=Vt.zpp_pool,Vt.zpp_pool=$,W.modified=!0,W.length--,W.pushmod=!0,!0;break}J=X,X=X.next}null!=E.pair&&(E.pair.arb=null,E.pair=null),E.active=!1,this.f_arbiters.modified=!0,null==De.zpp_pool?F=new De:(F=De.zpp_pool,De.zpp_pool=F.next,F.next=null),F.intchange=!0,R=!0,B=!0}else F=E.fluidarb;var nn=me.id_InteractionType_FLUID;if(R||F.stamp!=this.stamp||l)if(F.stamp=this.stamp,Ke.flowCollide(P,T,F)){if(R){var en=T.id;F.b1=n.body,F.ws1=n,F.b2=e.body,F.ws2=e,F.id=P.id,F.di=en;var tn,ln=F.b1.arbiters;null==Vt.zpp_pool?tn=new Vt:(tn=Vt.zpp_pool,Vt.zpp_pool=tn.next,tn.next=null),tn.elt=F;var pn=tn;pn.next=ln.head,ln.head=pn,ln.modified=!0,ln.length++;var rn,an=F.b2.arbiters;null==Vt.zpp_pool?rn=new Vt:(rn=Vt.zpp_pool,Vt.zpp_pool=rn.next,rn.next=null),rn.elt=F;var sn=rn;sn.next=an.head,an.head=sn,an.modified=!0,an.length++,F.active=!0,F.present=0,F.cleared=!1,F.sleeping=!1,F.fresh=!1,F.presentable=!1,F.nx=0,F.ny=1,F.dampx=0,F.dampy=0,F.adamp=0;var on,_n=this.f_arbiters;null==$t.zpp_pool?on=new $t:(on=$t.zpp_pool,$t.zpp_pool=on.next,on.next=null),on.elt=F;var hn=on;hn.next=_n.head,_n.head=hn,_n.modified=!0,_n.length++,F.fresh=!B}else F.fresh=this.stamp-1>F.up_stamp||F.endGenerated==this.stamp&&l;if(F.up_stamp=F.stamp,F.fresh||0==(F.immState&me.id_ImmState_ALWAYS)){F.immState=me.id_ImmState_ACCEPT;for(var un=!1,xn=F.ws1.id>F.ws2.id?F.ws2:F.ws1,dn=F.ws1.id>F.ws2.id?F.ws1:F.ws2,vn=this.mrca1;null!=vn.head;){var zn=vn.head;vn.head=zn.next;var cn=zn;cn.elt=null,cn.next=Nt.zpp_pool,Nt.zpp_pool=cn,null==vn.head&&(vn.pushmod=!0),vn.modified=!0,vn.length--}vn.pushmod=!0;for(var mn=this.mrca2;null!=mn.head;){var yn=mn.head;mn.head=yn.next;var fn=yn;fn.elt=null,fn.next=Nt.zpp_pool,Nt.zpp_pool=fn,null==mn.head&&(mn.pushmod=!0),mn.modified=!0,mn.length--}if(mn.pushmod=!0,null!=xn.cbSet){var bn,gn=this.mrca1;null==Nt.zpp_pool?bn=new Nt:(bn=Nt.zpp_pool,Nt.zpp_pool=bn.next,bn.next=null),bn.elt=xn;var wn=bn;wn.next=gn.head,gn.head=wn,gn.modified=!0,gn.length++}if(null!=xn.body.cbSet){var Mn,Cn=this.mrca1,kn=xn.body;null==Nt.zpp_pool?Mn=new Nt:(Mn=Nt.zpp_pool,Nt.zpp_pool=Mn.next,Mn.next=null),Mn.elt=kn;var On=Mn;On.next=Cn.head,Cn.head=On,Cn.modified=!0,Cn.length++}if(null!=dn.cbSet){var In,Sn=this.mrca2;null==Nt.zpp_pool?In=new Nt:(In=Nt.zpp_pool,Nt.zpp_pool=In.next,In.next=null),In.elt=dn;var Pn=In;Pn.next=Sn.head,Sn.head=Pn,Sn.modified=!0,Sn.length++}if(null!=dn.body.cbSet){var Tn,An=this.mrca2,En=dn.body;null==Nt.zpp_pool?Tn=new Nt:(Tn=Nt.zpp_pool,Nt.zpp_pool=Tn.next,Tn.next=null),Tn.elt=En;var Nn=Tn;Nn.next=An.head,An.head=Nn,An.modified=!0,An.length++}for(var Ln=xn.body.compound,Vn=dn.body.compound;Ln!=Vn;){var jn=null==Ln?0:Ln.depth,Dn=null==Vn?0:Vn.depth;if(Dn>jn){if(null!=Vn.cbSet){var Fn,Rn=this.mrca2;null==Nt.zpp_pool?Fn=new Nt:(Fn=Nt.zpp_pool,Nt.zpp_pool=Fn.next,Fn.next=null),Fn.elt=Vn;var Bn=Fn;Bn.next=Rn.head,Rn.head=Bn,Rn.modified=!0,Rn.length++}Vn=Vn.compound}else{if(null!=Ln.cbSet){var Gn,Zn=this.mrca1;null==Nt.zpp_pool?Gn=new Nt:(Gn=Nt.zpp_pool,Nt.zpp_pool=Gn.next,Gn.next=null),Gn.elt=Ln;var Un=Gn;Un.next=Zn.head,Zn.head=Un,Zn.modified=!0,Zn.length++}Ln=Ln.compound}}for(var qn=this.mrca1.head;null!=qn;){for(var Yn=qn.elt,Kn=this.mrca2.head;null!=Kn;){for(var Wn=Kn.elt,Jn=Yn.cbSet,Xn=Wn.cbSet,Hn=null,Qn=Xn.cbpairs.length>Jn.cbpairs.length?Jn.cbpairs:Xn.cbpairs,$n=Qn.head;null!=$n;){var ne=$n.elt;if(ne.a==Jn&&ne.b==Xn||ne.a==Xn&&ne.b==Jn){Hn=ne;break}$n=$n.next}if(null==Hn){var ee;null==_e.zpp_pool?ee=new _e:(ee=_e.zpp_pool,_e.zpp_pool=ee.next,ee.next=null),ee.zip_listeners=!0,oe.setlt(Jn,Xn)?(ee.a=Jn,ee.b=Xn):(ee.a=Xn,ee.b=Jn),Hn=ee,Jn.cbpairs.add(Hn),Xn!=Jn&&Xn.cbpairs.add(Hn)}if(Hn.zip_listeners&&(Hn.zip_listeners=!1,Hn.__validate()),null!=Hn.listeners.head){for(var ie=null,te=null,le=this.prelisteners;null!=le.head;){var pe=le.head;le.head=pe.next;var re=pe;re.elt=null,re.next=At.zpp_pool,At.zpp_pool=re,null==le.head&&(le.pushmod=!0),le.modified=!0,le.length--}le.pushmod=!0;for(var ae=null,se=me.id_CbEvent_PRE,he=null,ue=Xn.cbpairs.length>Jn.cbpairs.length?Jn.cbpairs:Xn.cbpairs,xe=ue.head;null!=xe;){var de=xe.elt;if(de.a==Jn&&de.b==Xn||de.a==Xn&&de.b==Jn){he=de;break}xe=xe.next}if(null==he){var ve;null==_e.zpp_pool?ve=new _e:(ve=_e.zpp_pool,_e.zpp_pool=ve.next,ve.next=null),ve.zip_listeners=!0,oe.setlt(Jn,Xn)?(ve.a=Jn,ve.b=Xn):(ve.a=Xn,ve.b=Jn),he=ve,Jn.cbpairs.add(he),Xn!=Jn&&Xn.cbpairs.add(he)}he.zip_listeners&&(he.zip_listeners=!1,he.__validate());for(var ze=he.listeners.head;null!=ze;){var ce=ze.elt;if(ce.event==se&&0!=(ce.itype&nn)){var ye,fe=r.prelisteners;null==At.zpp_pool?ye=new At:(ye=At.zpp_pool,At.zpp_pool=ye.next,ye.next=null),ye.elt=ce;var be=ye;null==ae?(be.next=fe.head,fe.head=be):(be.next=ae.next,ae.next=be),fe.pushmod=fe.modified=!0,fe.length++,ae=be,un=!!un||!ce.pure}ze=ze.next}if(null!=this.prelisteners.head){if(ie=Oi.get(Yn,Wn),null==ie&&(te=Zi.get(Yn,Wn),this.add_callbackset(te)),null==ie||(ie.FLUIDstamp!=this.stamp||l)&&0==(ie.FLUIDstate&me.id_ImmState_ALWAYS)){if(null!=te&&(ie=te),null!=ie)for(var ge=this.prelisteners.head;null!=ge;){var we=ge.elt;we.itype==me.id_InteractionType_ANY?(ie.COLLISIONstamp=this.stamp,ie.SENSORstamp=this.stamp,ie.FLUIDstamp=this.stamp):ie.FLUIDstamp=this.stamp,ge=ge.next}F.mutable=!0,null!=F.wrap_position&&(F.wrap_position.zpp_inner._immutable=!1);var Me=F.active;F.active=!0;this.precb.zpp_inner.pre_arbiter=F,this.precb.zpp_inner.set=ie;for(var Ce=this.prelisteners.head;null!=Ce;){var ke=Ce.elt;this.precb.zpp_inner.listener=ke;var Oe,Ie=this.precb.zpp_inner,Se=ie.int1,Pe=ie.int2,Te=ke.options1,Ae=Se.cbTypes;if(Te.nonemptyintersection(Ae,Te.includes)&&!Te.nonemptyintersection(Ae,Te.excludes)){var Ee=ke.options2,Ne=Pe.cbTypes;Oe=!!Ee.nonemptyintersection(Ne,Ee.includes)&&!Ee.nonemptyintersection(Ne,Ee.excludes)}else Oe=!1;Oe?(Ie.int1=Se,Ie.int2=Pe):(Ie.int1=Pe,Ie.int2=Se),this.precb.zpp_inner.pre_swapped=Yn!=this.precb.zpp_inner.int1;var Le=ke.handlerp(this.precb);if(null!=Le){var Ve;null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),Le==me.PreFlag_ACCEPT?Ve=me.id_ImmState_ACCEPT|me.id_ImmState_ALWAYS:(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),Le==me.PreFlag_ACCEPT_ONCE?Ve=me.id_ImmState_ACCEPT:(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),Ve=Le==me.PreFlag_IGNORE?me.id_ImmState_IGNORE|me.id_ImmState_ALWAYS:me.id_ImmState_IGNORE)),F.immState=Ve}Ce=Ce.next}if(F.mutable=!1,null!=F.wrap_position&&(F.wrap_position.zpp_inner._immutable=!0),F.active=Me,null!=ie)for(var Be=this.prelisteners.head;null!=Be;){var Ge=Be.elt;Ge.itype==me.id_InteractionType_ANY?(ie.COLLISIONstate=F.immState,ie.SENSORstate=F.immState,ie.FLUIDstate=F.immState):ie.FLUIDstate=F.immState,Be=Be.next}}else null==ie?0==(F.immState&me.id_ImmState_ALWAYS)&&(F.immState=me.id_ImmState_ACCEPT):F.immState=ie.FLUIDstate;Kn=Kn.next}else Kn=Kn.next}else Kn=Kn.next}qn=qn.next}if(un&&0==(F.immState&me.id_ImmState_ALWAYS)){if(F.b1.type==me.id_BodyType_DYNAMIC){var Ze=F.b1;Ze.world||(Ze.component.waket=this.stamp+(this.midstep?0:1),Ze.type==me.id_BodyType_KINEMATIC&&(Ze.kinematicDelaySleep=!0),Ze.component.sleeping&&this.really_wake(Ze,!1))}if(F.b1.type==me.id_BodyType_DYNAMIC){var Ue=F.b2;Ue.world||(Ue.component.waket=this.stamp+(this.midstep?0:1),Ue.type==me.id_BodyType_KINEMATIC&&(Ue.kinematicDelaySleep=!0),Ue.component.sleeping&&this.really_wake(Ue,!1))}}}if(0!=(F.immState&me.id_ImmState_ACCEPT)){if(F.b1.type==me.id_BodyType_DYNAMIC&&F.b1.component.sleeping){var qe=F.b1;qe.world||(qe.component.waket=this.stamp+(this.midstep?0:1),qe.type==me.id_BodyType_KINEMATIC&&(qe.kinematicDelaySleep=!0),qe.component.sleeping&&this.really_wake(qe,!1))}if(F.b2.type==me.id_BodyType_DYNAMIC&&F.b2.component.sleeping){var Ye=F.b2;Ye.world||(Ye.component.waket=this.stamp+(this.midstep?0:1),Ye.type==me.id_BodyType_KINEMATIC&&(Ye.kinematicDelaySleep=!0),Ye.component.sleeping&&this.really_wake(Ye,!1))}}if(F.sleeping){F.sleeping=!1;var We,Je=this.f_arbiters;null==$t.zpp_pool?We=new $t:(We=$t.zpp_pool,$t.zpp_pool=We.next,We.next=null),We.elt=F;var Xe=We;Xe.next=Je.head,Je.head=Xe,Je.modified=!0,Je.length++}a=F}else if(R){var He=F;He.next=De.zpp_pool,De.zpp_pool=He,a=null}else a=F;else a=F}else if(1==u){var Qe,$e=i?this.c_arbiters_true:this.c_arbiters_false;if(null==t){for(var ni=null,ei=o.arbiters.length>s.arbiters.length?s:o,ii=ei.arbiters.head;null!=ii;){var ti=ii.elt;if(ti.id==P.id&&ti.di==T.id){ni=ti;break}ii=ii.next}Qe=ni}else Qe=t;var li,pi=null==Qe,ri=!1;if(pi)null==Fe.zpp_pool?li=new Fe:(li=Fe.zpp_pool,Fe.zpp_pool=li.next,li.next=null),li.stat=i;else if(null==Qe.colarb){Qe.cleared=!0;for(var ai=Qe.b1.arbiters,si=null,oi=ai.head;null!=oi;){if(oi.elt==Qe){var _i,hi;null==si?(_i=ai.head,hi=_i.next,null==(ai.head=hi)&&(ai.pushmod=!0)):(_i=si.next,hi=_i.next,si.next=hi,null==hi&&(ai.pushmod=!0));var ui=_i;ui.elt=null,ui.next=Vt.zpp_pool,Vt.zpp_pool=ui,ai.modified=!0,ai.length--,ai.pushmod=!0,!0;break}si=oi,oi=oi.next}for(var xi=Qe.b2.arbiters,di=null,vi=xi.head;null!=vi;){if(vi.elt==Qe){var zi,ci;null==di?(zi=xi.head,ci=zi.next,null==(xi.head=ci)&&(xi.pushmod=!0)):(zi=di.next,ci=zi.next,di.next=ci,null==ci&&(xi.pushmod=!0));var mi=zi;mi.elt=null,mi.next=Vt.zpp_pool,Vt.zpp_pool=mi,xi.modified=!0,xi.length--,xi.pushmod=!0,!0;break}di=vi,vi=vi.next}null!=Qe.pair&&(Qe.pair.arb=null,Qe.pair=null),Qe.active=!1,this.f_arbiters.modified=!0,null==Fe.zpp_pool?li=new Fe:(li=Fe.zpp_pool,Fe.zpp_pool=li.next,li.next=null),li.intchange=!0,li.stat=i,pi=!0,ri=!0}else li=Qe.colarb,A=P!=li.s1,li.stat!=i&&(li.stat=i,li.sleeping||((i?this.c_arbiters_false:this.c_arbiters_true).remove(li),$e.add(li)));var yi=me.id_InteractionType_COLLISION;if(pi||li.stamp!=this.stamp||l)if(li.stamp=this.stamp,Ke.contactCollide(P,T,li,A)){if(pi){var fi=T.id;li.b1=n.body,li.ws1=n,li.b2=e.body,li.ws2=e,li.id=P.id,li.di=fi;var bi,gi=li.b1.arbiters;null==Vt.zpp_pool?bi=new Vt:(bi=Vt.zpp_pool,Vt.zpp_pool=bi.next,bi.next=null),bi.elt=li;var wi=bi;wi.next=gi.head,gi.head=wi,gi.modified=!0,gi.length++;var Mi,Ci=li.b2.arbiters;null==Vt.zpp_pool?Mi=new Vt:(Mi=Vt.zpp_pool,Vt.zpp_pool=Mi.next,Mi.next=null),Mi.elt=li;var ki=Mi;ki.next=Ci.head,Ci.head=ki,Ci.modified=!0,Ci.length++,li.active=!0,li.present=0,li.cleared=!1,li.sleeping=!1,li.fresh=!1,li.presentable=!1,li.s1=n,li.s2=e,li.userdef_restitution||(li.restitution=li.s1.material.elasticity>-Infinity&&li.s2.material.elasticity>-Infinity?li.s1.material.elasticity<Infinity&&li.s2.material.elasticity<Infinity?(li.s1.material.elasticity+li.s2.material.elasticity)/2:1:0,0>li.restitution&&(li.restitution=0),li.restitution>1&&(li.restitution=1)),li.userdef_dyn_fric||(li.dyn_fric=Math.sqrt(li.s1.material.dynamicFriction*li.s2.material.dynamicFriction)),li.userdef_stat_fric||(li.stat_fric=Math.sqrt(li.s1.material.staticFriction*li.s2.material.staticFriction)),li.userdef_rfric||(li.rfric=Math.sqrt(li.s1.material.rollingFriction*li.s2.material.rollingFriction));var Ii;null==el.zpp_pool?Ii=new el:(Ii=el.zpp_pool,el.zpp_pool=Ii.next,Ii.next=null),Ii.elt=li;var Si=Ii;Si.next=$e.head,$e.head=Si,$e.modified=!0,$e.length++,li.fresh=!ri}else li.fresh=this.stamp-1>li.up_stamp||li.endGenerated==this.stamp&&l;if(li.up_stamp=li.stamp,li.fresh||0==(li.immState&me.id_ImmState_ALWAYS)){li.immState=me.id_ImmState_ACCEPT;for(var Pi=!1,Ti=li.ws1.id>li.ws2.id?li.ws2:li.ws1,Ai=li.ws1.id>li.ws2.id?li.ws1:li.ws2,Ei=this.mrca1;null!=Ei.head;){var Ni=Ei.head;Ei.head=Ni.next;var Li=Ni;Li.elt=null,Li.next=Nt.zpp_pool,Nt.zpp_pool=Li,null==Ei.head&&(Ei.pushmod=!0),Ei.modified=!0,Ei.length--}Ei.pushmod=!0;for(var Vi=this.mrca2;null!=Vi.head;){var ji=Vi.head;Vi.head=ji.next;var Di=ji;Di.elt=null,Di.next=Nt.zpp_pool,Nt.zpp_pool=Di,null==Vi.head&&(Vi.pushmod=!0),Vi.modified=!0,Vi.length--}if(Vi.pushmod=!0,null!=Ti.cbSet){var Fi,Ri=this.mrca1;null==Nt.zpp_pool?Fi=new Nt:(Fi=Nt.zpp_pool,Nt.zpp_pool=Fi.next,Fi.next=null),Fi.elt=Ti;var Bi=Fi;Bi.next=Ri.head,Ri.head=Bi,Ri.modified=!0,Ri.length++}if(null!=Ti.body.cbSet){var Gi,Ui=this.mrca1,qi=Ti.body;null==Nt.zpp_pool?Gi=new Nt:(Gi=Nt.zpp_pool,Nt.zpp_pool=Gi.next,Gi.next=null),Gi.elt=qi;var Yi=Gi;Yi.next=Ui.head,Ui.head=Yi,Ui.modified=!0,Ui.length++}if(null!=Ai.cbSet){var Ki,Wi=this.mrca2;null==Nt.zpp_pool?Ki=new Nt:(Ki=Nt.zpp_pool,Nt.zpp_pool=Ki.next,Ki.next=null),Ki.elt=Ai;var Ji=Ki;Ji.next=Wi.head,Wi.head=Ji,Wi.modified=!0,Wi.length++}if(null!=Ai.body.cbSet){var Xi,Hi=this.mrca2,Qi=Ai.body;null==Nt.zpp_pool?Xi=new Nt:(Xi=Nt.zpp_pool,Nt.zpp_pool=Xi.next,Xi.next=null),Xi.elt=Qi;var $i=Xi;$i.next=Hi.head,Hi.head=$i,Hi.modified=!0,Hi.length++}for(var nt=Ti.body.compound,et=Ai.body.compound;nt!=et;){var it=null==nt?0:nt.depth,tt=null==et?0:et.depth;if(tt>it){if(null!=et.cbSet){var lt,pt=this.mrca2;null==Nt.zpp_pool?lt=new Nt:(lt=Nt.zpp_pool,Nt.zpp_pool=lt.next,lt.next=null),lt.elt=et;var rt=lt;rt.next=pt.head,pt.head=rt,pt.modified=!0,pt.length++}et=et.compound}else{if(null!=nt.cbSet){var at,st=this.mrca1;null==Nt.zpp_pool?at=new Nt:(at=Nt.zpp_pool,Nt.zpp_pool=at.next,at.next=null),at.elt=nt;var ot=at;ot.next=st.head,st.head=ot,st.modified=!0,st.length++}nt=nt.compound}}for(var _t=this.mrca1.head;null!=_t;){for(var ht=_t.elt,ut=this.mrca2.head;null!=ut;){for(var xt=ut.elt,dt=ht.cbSet,vt=xt.cbSet,zt=null,ct=vt.cbpairs.length>dt.cbpairs.length?dt.cbpairs:vt.cbpairs,mt=ct.head;null!=mt;){var yt=mt.elt;if(yt.a==dt&&yt.b==vt||yt.a==vt&&yt.b==dt){zt=yt;break}mt=mt.next}if(null==zt){var ft;null==_e.zpp_pool?ft=new _e:(ft=_e.zpp_pool,_e.zpp_pool=ft.next,ft.next=null),ft.zip_listeners=!0,oe.setlt(dt,vt)?(ft.a=dt,ft.b=vt):(ft.a=vt,ft.b=dt),zt=ft,dt.cbpairs.add(zt),vt!=dt&&vt.cbpairs.add(zt)}if(zt.zip_listeners&&(zt.zip_listeners=!1,zt.__validate()),null!=zt.listeners.head){for(var bt=null,gt=null,wt=this.prelisteners;null!=wt.head;){var Mt=wt.head;wt.head=Mt.next;var Ct=Mt;Ct.elt=null,Ct.next=At.zpp_pool,At.zpp_pool=Ct,null==wt.head&&(wt.pushmod=!0),wt.modified=!0,wt.length--}wt.pushmod=!0;for(var kt=null,Ot=me.id_CbEvent_PRE,It=null,St=vt.cbpairs.length>dt.cbpairs.length?dt.cbpairs:vt.cbpairs,Pt=St.head;null!=Pt;){var Tt=Pt.elt;if(Tt.a==dt&&Tt.b==vt||Tt.a==vt&&Tt.b==dt){It=Tt;break}Pt=Pt.next}if(null==It){var Et;null==_e.zpp_pool?Et=new _e:(Et=_e.zpp_pool,_e.zpp_pool=Et.next,Et.next=null),Et.zip_listeners=!0,oe.setlt(dt,vt)?(Et.a=dt,Et.b=vt):(Et.a=vt,Et.b=dt),It=Et,dt.cbpairs.add(It),vt!=dt&&vt.cbpairs.add(It)}It.zip_listeners&&(It.zip_listeners=!1,It.__validate());for(var Lt=It.listeners.head;null!=Lt;){var jt=Lt.elt;if(jt.event==Ot&&0!=(jt.itype&yi)){var Dt,Ft=r.prelisteners;null==At.zpp_pool?Dt=new At:(Dt=At.zpp_pool,At.zpp_pool=Dt.next,Dt.next=null),Dt.elt=jt;var Rt=Dt;null==kt?(Rt.next=Ft.head,Ft.head=Rt):(Rt.next=kt.next,kt.next=Rt),Ft.pushmod=Ft.modified=!0,Ft.length++,kt=Rt,Pi=!!Pi||!jt.pure}Lt=Lt.next}if(null!=this.prelisteners.head){if(bt=Oi.get(ht,xt),null==bt&&(gt=Zi.get(ht,xt),this.add_callbackset(gt)),null==bt||(bt.COLLISIONstamp!=this.stamp||l)&&0==(bt.COLLISIONstate&me.id_ImmState_ALWAYS)){if(null!=gt&&(bt=gt),null!=bt)for(var Bt=this.prelisteners.head;null!=Bt;){var Gt=Bt.elt;Gt.itype==me.id_InteractionType_ANY?(bt.COLLISIONstamp=this.stamp,bt.SENSORstamp=this.stamp,bt.FLUIDstamp=this.stamp):bt.COLLISIONstamp=this.stamp,Bt=Bt.next}li.mutable=!0,null!=li.wrap_normal&&(li.wrap_normal.zpp_inner._immutable=!1),null!=li.wrap_contacts&&(li.wrap_contacts.zpp_inner.immutable=!1);var Zt=li.active;li.active=!0;var Ut=!0,qt=null,Yt=null,Kt=li.innards.next;li.hc2=!1;for(var Wt=li.contacts.next;null!=Wt;){var Jt=Wt;if(Jt.stamp+y.arbiterExpirationDelay<li.stamp){var Xt,Ht,Qt=li.contacts;null==qt?(Xt=Qt.next,Ht=Xt.next,null==(Qt.next=Ht)&&(Qt.pushmod=!0)):(Xt=qt.next,Ht=Xt.next,qt.next=Ht,null==Ht&&(Qt.pushmod=!0)),Xt._inuse=!1,Qt.modified=!0,Qt.length--,Qt.pushmod=!0,Wt=Ht;var il,tl,ll=li.innards;null==Yt?(il=ll.next,tl=il.next,null==(ll.next=tl)&&(ll.pushmod=!0)):(il=Yt.next,tl=il.next,Yt.next=tl,null==tl&&(ll.pushmod=!0)),il._inuse=!1,ll.modified=!0,ll.length--,ll.pushmod=!0,Kt=tl;var pl=Jt;pl.arbiter=null,pl.next=Re.zpp_pool,Re.zpp_pool=pl}else{var rl=Jt.inner,al=Jt.active;Jt.active=Jt.stamp==li.stamp,Jt.active&&(Ut?(Ut=!1,li.c1=rl,li.oc1=Jt):(li.hc2=!0,li.c2=rl,li.oc2=Jt)),al!=Jt.active&&(li.contacts.modified=!0),qt=Wt,Yt=Kt,Kt=Kt.next,Wt=Wt.next}}if(li.hc2){if(li.hpc2=!0,li.oc1.posOnly){var sl=li.c1;li.c1=li.c2,li.c2=sl;var ol=li.oc1;li.oc1=li.oc2,li.oc2=ol,li.hc2=!1}else li.oc2.posOnly&&(li.hc2=!1);li.oc1.posOnly&&(Ut=!0)}else li.hpc2=!1;this.precb.zpp_inner.pre_arbiter=li,this.precb.zpp_inner.set=bt;for(var _l=this.prelisteners.head;null!=_l;){var hl=_l.elt;this.precb.zpp_inner.listener=hl;var ul,xl=this.precb.zpp_inner,dl=bt.int1,vl=bt.int2,zl=hl.options1,cl=dl.cbTypes;if(zl.nonemptyintersection(cl,zl.includes)&&!zl.nonemptyintersection(cl,zl.excludes)){var ml=hl.options2,yl=vl.cbTypes;ul=!!ml.nonemptyintersection(yl,ml.includes)&&!ml.nonemptyintersection(yl,ml.excludes)}else ul=!1;ul?(xl.int1=dl,xl.int2=vl):(xl.int1=vl,xl.int2=dl),this.precb.zpp_inner.pre_swapped=ht!=this.precb.zpp_inner.int1;var fl=hl.handlerp(this.precb);if(null!=fl){var bl;null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),fl==me.PreFlag_ACCEPT?bl=me.id_ImmState_ACCEPT|me.id_ImmState_ALWAYS:(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),fl==me.PreFlag_ACCEPT_ONCE?bl=me.id_ImmState_ACCEPT:(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),bl=fl==me.PreFlag_IGNORE?me.id_ImmState_IGNORE|me.id_ImmState_ALWAYS:me.id_ImmState_IGNORE)),li.immState=bl}_l=_l.next}if(li.mutable=!1,null!=li.wrap_normal&&(li.wrap_normal.zpp_inner._immutable=!0),null!=li.wrap_contacts&&(li.wrap_contacts.zpp_inner.immutable=!0),li.active=Zt,null!=bt)for(var gl=this.prelisteners.head;null!=gl;){var wl=gl.elt;wl.itype==me.id_InteractionType_ANY?(bt.COLLISIONstate=li.immState,bt.SENSORstate=li.immState,bt.FLUIDstate=li.immState):bt.COLLISIONstate=li.immState,gl=gl.next}}else null==bt?0==(li.immState&me.id_ImmState_ALWAYS)&&(li.immState=me.id_ImmState_ACCEPT):li.immState=bt.COLLISIONstate;ut=ut.next}else ut=ut.next}else ut=ut.next}_t=_t.next}if(Pi&&0==(li.immState&me.id_ImmState_ALWAYS)){if(li.b1.type==me.id_BodyType_DYNAMIC){var Ml=li.b1;Ml.world||(Ml.component.waket=this.stamp+(this.midstep?0:1),Ml.type==me.id_BodyType_KINEMATIC&&(Ml.kinematicDelaySleep=!0),Ml.component.sleeping&&this.really_wake(Ml,!1))}if(li.b1.type==me.id_BodyType_DYNAMIC){var Cl=li.b2;Cl.world||(Cl.component.waket=this.stamp+(this.midstep?0:1),Cl.type==me.id_BodyType_KINEMATIC&&(Cl.kinematicDelaySleep=!0),Cl.component.sleeping&&this.really_wake(Cl,!1))}}}if(0!=(li.immState&me.id_ImmState_ACCEPT)){if(li.b1.type==me.id_BodyType_DYNAMIC&&li.b1.component.sleeping){var kl=li.b1;kl.world||(kl.component.waket=this.stamp+(this.midstep?0:1),kl.type==me.id_BodyType_KINEMATIC&&(kl.kinematicDelaySleep=!0),kl.component.sleeping&&this.really_wake(kl,!1))}if(li.b2.type==me.id_BodyType_DYNAMIC&&li.b2.component.sleeping){var Ol=li.b2;Ol.world||(Ol.component.waket=this.stamp+(this.midstep?0:1),Ol.type==me.id_BodyType_KINEMATIC&&(Ol.kinematicDelaySleep=!0),Ol.component.sleeping&&this.really_wake(Ol,!1))}}if(li.sleeping){li.sleeping=!1;var Il;null==el.zpp_pool?Il=new el:(Il=el.zpp_pool,el.zpp_pool=Il.next,Il.next=null),Il.elt=li;var Sl=Il;Sl.next=$e.head,$e.head=Sl,$e.modified=!0,$e.length++}a=li}else if(pi){var Pl=li;Pl.userdef_dyn_fric=!1,Pl.userdef_stat_fric=!1,Pl.userdef_restitution=!1,Pl.userdef_rfric=!1,Pl.__ref_edge1=Pl.__ref_edge2=null,Pl.next=Fe.zpp_pool,Fe.zpp_pool=Pl,a=null}else a=li;else a=li}else{var Tl;if(null==t){for(var Al=null,El=o.arbiters.length>s.arbiters.length?s:o,Nl=El.arbiters.head;null!=Nl;){var Ll=Nl.elt;if(Ll.id==P.id&&Ll.di==T.id){Al=Ll;break}Nl=Nl.next}Tl=Al}else Tl=t;var Vl,jl=null==Tl,Dl=!1;if(jl)null==je.zpp_pool?Vl=new je:(Vl=je.zpp_pool,je.zpp_pool=Vl.next,Vl.next=null);else if(null==Tl.sensorarb){Tl.cleared=!0;for(var Fl=Tl.b1.arbiters,Rl=null,Bl=Fl.head;null!=Bl;){if(Bl.elt==Tl){var Gl,Zl;null==Rl?(Gl=Fl.head,Zl=Gl.next,null==(Fl.head=Zl)&&(Fl.pushmod=!0)):(Gl=Rl.next,Zl=Gl.next,Rl.next=Zl,null==Zl&&(Fl.pushmod=!0));var Ul=Gl;Ul.elt=null,Ul.next=Vt.zpp_pool,Vt.zpp_pool=Ul,Fl.modified=!0,Fl.length--,Fl.pushmod=!0,!0;break}Rl=Bl,Bl=Bl.next}for(var ql=Tl.b2.arbiters,Yl=null,Kl=ql.head;null!=Kl;){if(Kl.elt==Tl){var Wl,Jl;null==Yl?(Wl=ql.head,Jl=Wl.next,null==(ql.head=Jl)&&(ql.pushmod=!0)):(Wl=Yl.next,Jl=Wl.next,Yl.next=Jl,null==Jl&&(ql.pushmod=!0));var Xl=Wl;Xl.elt=null,Xl.next=Vt.zpp_pool,Vt.zpp_pool=Xl,ql.modified=!0,ql.length--,ql.pushmod=!0,!0;break}Yl=Kl,Kl=Kl.next}null!=Tl.pair&&(Tl.pair.arb=null,Tl.pair=null),Tl.active=!1,this.f_arbiters.modified=!0,null==je.zpp_pool?Vl=new je:(Vl=je.zpp_pool,je.zpp_pool=Vl.next,Vl.next=null),Vl.intchange=!0,jl=!0,Dl=!0}else Vl=Tl.sensorarb;var Hl=me.id_InteractionType_SENSOR;if(jl||Vl.stamp!=this.stamp||l)if(Vl.stamp=this.stamp,Ke.testCollide(P,T)){if(jl){var Ql=T.id;Vl.b1=n.body,Vl.ws1=n,Vl.b2=e.body,Vl.ws2=e,Vl.id=P.id,Vl.di=Ql;var $l,np=Vl.b1.arbiters;null==Vt.zpp_pool?$l=new Vt:($l=Vt.zpp_pool,Vt.zpp_pool=$l.next,$l.next=null),$l.elt=Vl;var ep=$l;ep.next=np.head,np.head=ep,np.modified=!0,np.length++;var ip,tp=Vl.b2.arbiters;null==Vt.zpp_pool?ip=new Vt:(ip=Vt.zpp_pool,Vt.zpp_pool=ip.next,ip.next=null),ip.elt=Vl;var lp=ip;lp.next=tp.head,tp.head=lp,tp.modified=!0,tp.length++,Vl.active=!0,Vl.present=0,Vl.cleared=!1,Vl.sleeping=!1,Vl.fresh=!1,Vl.presentable=!1;var pp,rp=this.s_arbiters;null==nl.zpp_pool?pp=new nl:(pp=nl.zpp_pool,nl.zpp_pool=pp.next,pp.next=null),pp.elt=Vl;var ap=pp;ap.next=rp.head,rp.head=ap,rp.modified=!0,rp.length++,Vl.fresh=!Dl}else Vl.fresh=this.stamp-1>Vl.up_stamp||Vl.endGenerated==this.stamp&&l;if(Vl.up_stamp=Vl.stamp,Vl.fresh||0==(Vl.immState&me.id_ImmState_ALWAYS)){Vl.immState=me.id_ImmState_ACCEPT;for(var sp=!1,op=Vl.ws1.id>Vl.ws2.id?Vl.ws2:Vl.ws1,_p=Vl.ws1.id>Vl.ws2.id?Vl.ws1:Vl.ws2,hp=this.mrca1;null!=hp.head;){var up=hp.head;hp.head=up.next;var xp=up;xp.elt=null,xp.next=Nt.zpp_pool,Nt.zpp_pool=xp,null==hp.head&&(hp.pushmod=!0),hp.modified=!0,hp.length--}hp.pushmod=!0;for(var dp=this.mrca2;null!=dp.head;){var vp=dp.head;dp.head=vp.next;var zp=vp;zp.elt=null,zp.next=Nt.zpp_pool,Nt.zpp_pool=zp,null==dp.head&&(dp.pushmod=!0),dp.modified=!0,dp.length--}if(dp.pushmod=!0,null!=op.cbSet){var cp,mp=this.mrca1;null==Nt.zpp_pool?cp=new Nt:(cp=Nt.zpp_pool,Nt.zpp_pool=cp.next,cp.next=null),cp.elt=op;var yp=cp;yp.next=mp.head,mp.head=yp,mp.modified=!0,mp.length++}if(null!=op.body.cbSet){var fp,bp=this.mrca1,gp=op.body;null==Nt.zpp_pool?fp=new Nt:(fp=Nt.zpp_pool,Nt.zpp_pool=fp.next,fp.next=null),fp.elt=gp;var wp=fp;wp.next=bp.head,bp.head=wp,bp.modified=!0,bp.length++}if(null!=_p.cbSet){var Mp,Cp=this.mrca2;null==Nt.zpp_pool?Mp=new Nt:(Mp=Nt.zpp_pool,Nt.zpp_pool=Mp.next,Mp.next=null),Mp.elt=_p;var kp=Mp;kp.next=Cp.head,Cp.head=kp,Cp.modified=!0,Cp.length++}if(null!=_p.body.cbSet){var Op,Ip=this.mrca2,Sp=_p.body;null==Nt.zpp_pool?Op=new Nt:(Op=Nt.zpp_pool,Nt.zpp_pool=Op.next,Op.next=null),Op.elt=Sp;var Pp=Op;Pp.next=Ip.head,Ip.head=Pp,Ip.modified=!0,Ip.length++}for(var Tp=op.body.compound,Ap=_p.body.compound;Tp!=Ap;){var Ep=null==Tp?0:Tp.depth,Np=null==Ap?0:Ap.depth;if(Np>Ep){if(null!=Ap.cbSet){var Lp,Vp=this.mrca2;null==Nt.zpp_pool?Lp=new Nt:(Lp=Nt.zpp_pool,Nt.zpp_pool=Lp.next,Lp.next=null),Lp.elt=Ap;var jp=Lp;jp.next=Vp.head,Vp.head=jp,Vp.modified=!0,Vp.length++}Ap=Ap.compound}else{if(null!=Tp.cbSet){var Dp,Fp=this.mrca1;null==Nt.zpp_pool?Dp=new Nt:(Dp=Nt.zpp_pool,Nt.zpp_pool=Dp.next,Dp.next=null),Dp.elt=Tp;var Rp=Dp;Rp.next=Fp.head,Fp.head=Rp,Fp.modified=!0,Fp.length++}Tp=Tp.compound}}for(var Bp=this.mrca1.head;null!=Bp;){for(var Gp=Bp.elt,Zp=this.mrca2.head;null!=Zp;){for(var Up=Zp.elt,qp=Gp.cbSet,Yp=Up.cbSet,Kp=null,Wp=Yp.cbpairs.length>qp.cbpairs.length?qp.cbpairs:Yp.cbpairs,Jp=Wp.head;null!=Jp;){var Xp=Jp.elt;if(Xp.a==qp&&Xp.b==Yp||Xp.a==Yp&&Xp.b==qp){Kp=Xp;break}Jp=Jp.next}if(null==Kp){var Hp;null==_e.zpp_pool?Hp=new _e:(Hp=_e.zpp_pool,_e.zpp_pool=Hp.next,Hp.next=null),Hp.zip_listeners=!0,oe.setlt(qp,Yp)?(Hp.a=qp,Hp.b=Yp):(Hp.a=Yp,Hp.b=qp),Kp=Hp,qp.cbpairs.add(Kp),Yp!=qp&&Yp.cbpairs.add(Kp)}if(Kp.zip_listeners&&(Kp.zip_listeners=!1,Kp.__validate()),null!=Kp.listeners.head){for(var Qp=null,$p=null,nr=this.prelisteners;null!=nr.head;){var er=nr.head;nr.head=er.next;var ir=er;ir.elt=null,ir.next=At.zpp_pool,At.zpp_pool=ir,null==nr.head&&(nr.pushmod=!0),nr.modified=!0,nr.length--}nr.pushmod=!0;for(var tr=null,lr=me.id_CbEvent_PRE,pr=null,rr=Yp.cbpairs.length>qp.cbpairs.length?qp.cbpairs:Yp.cbpairs,ar=rr.head;null!=ar;){var sr=ar.elt;if(sr.a==qp&&sr.b==Yp||sr.a==Yp&&sr.b==qp){pr=sr;break}ar=ar.next}if(null==pr){var or;null==_e.zpp_pool?or=new _e:(or=_e.zpp_pool,_e.zpp_pool=or.next,or.next=null),or.zip_listeners=!0,oe.setlt(qp,Yp)?(or.a=qp,or.b=Yp):(or.a=Yp,or.b=qp),pr=or,qp.cbpairs.add(pr),Yp!=qp&&Yp.cbpairs.add(pr)}pr.zip_listeners&&(pr.zip_listeners=!1,pr.__validate());for(var _r=pr.listeners.head;null!=_r;){var hr=_r.elt;if(hr.event==lr&&0!=(hr.itype&Hl)){var ur,xr=r.prelisteners;null==At.zpp_pool?ur=new At:(ur=At.zpp_pool,At.zpp_pool=ur.next,ur.next=null),ur.elt=hr;var dr=ur;null==tr?(dr.next=xr.head,xr.head=dr):(dr.next=tr.next,tr.next=dr),xr.pushmod=xr.modified=!0,xr.length++,tr=dr,sp=!!sp||!hr.pure}_r=_r.next}if(null!=this.prelisteners.head){if(Qp=Oi.get(Gp,Up),null==Qp&&($p=Zi.get(Gp,Up),this.add_callbackset($p)),null==Qp||(Qp.SENSORstamp!=this.stamp||l)&&0==(Qp.SENSORstate&me.id_ImmState_ALWAYS)){if(null!=$p&&(Qp=$p),null!=Qp)for(var vr=this.prelisteners.head;null!=vr;){var zr=vr.elt;zr.itype==me.id_InteractionType_ANY?(Qp.COLLISIONstamp=this.stamp,Qp.SENSORstamp=this.stamp,Qp.FLUIDstamp=this.stamp):Qp.SENSORstamp=this.stamp,vr=vr.next}var cr=Vl.active;Vl.active=!0;this.precb.zpp_inner.pre_arbiter=Vl,this.precb.zpp_inner.set=Qp;for(var mr=this.prelisteners.head;null!=mr;){var yr=mr.elt;this.precb.zpp_inner.listener=yr;var fr,br=this.precb.zpp_inner,gr=Qp.int1,wr=Qp.int2,Mr=yr.options1,Cr=gr.cbTypes;if(Mr.nonemptyintersection(Cr,Mr.includes)&&!Mr.nonemptyintersection(Cr,Mr.excludes)){var kr=yr.options2,Or=wr.cbTypes;fr=!!kr.nonemptyintersection(Or,kr.includes)&&!kr.nonemptyintersection(Or,kr.excludes)}else fr=!1;fr?(br.int1=gr,br.int2=wr):(br.int1=wr,br.int2=gr),this.precb.zpp_inner.pre_swapped=Gp!=this.precb.zpp_inner.int1;var Ir=yr.handlerp(this.precb);if(null!=Ir){var Sr;null==me.PreFlag_ACCEPT&&(me.internal=!0,me.PreFlag_ACCEPT=new D,me.internal=!1),Ir==me.PreFlag_ACCEPT?Sr=me.id_ImmState_ACCEPT|me.id_ImmState_ALWAYS:(null==me.PreFlag_ACCEPT_ONCE&&(me.internal=!0,me.PreFlag_ACCEPT_ONCE=new D,me.internal=!1),Ir==me.PreFlag_ACCEPT_ONCE?Sr=me.id_ImmState_ACCEPT:(null==me.PreFlag_IGNORE&&(me.internal=!0,me.PreFlag_IGNORE=new D,me.internal=!1),Sr=Ir==me.PreFlag_IGNORE?me.id_ImmState_IGNORE|me.id_ImmState_ALWAYS:me.id_ImmState_IGNORE)),Vl.immState=Sr}mr=mr.next}if(Vl.active=cr,null!=Qp)for(var Pr=this.prelisteners.head;null!=Pr;){var Tr=Pr.elt;Tr.itype==me.id_InteractionType_ANY?(Qp.COLLISIONstate=Vl.immState,Qp.SENSORstate=Vl.immState,Qp.FLUIDstate=Vl.immState):Qp.SENSORstate=Vl.immState,Pr=Pr.next}}else null==Qp?0==(Vl.immState&me.id_ImmState_ALWAYS)&&(Vl.immState=me.id_ImmState_ACCEPT):Vl.immState=Qp.SENSORstate;Zp=Zp.next}else Zp=Zp.next}else Zp=Zp.next}Bp=Bp.next}if(sp&&0==(Vl.immState&me.id_ImmState_ALWAYS)){if(Vl.b1.type!=me.id_BodyType_STATIC){var Ar=Vl.b1;Ar.world||(Ar.component.waket=this.stamp+(this.midstep?0:1),Ar.type==me.id_BodyType_KINEMATIC&&(Ar.kinematicDelaySleep=!0),Ar.component.sleeping&&this.really_wake(Ar,!1))}if(Vl.b2.type!=me.id_BodyType_STATIC){var Er=Vl.b2;Er.world||(Er.component.waket=this.stamp+(this.midstep?0:1),Er.type==me.id_BodyType_KINEMATIC&&(Er.kinematicDelaySleep=!0),Er.component.sleeping&&this.really_wake(Er,!1))}}}if(Vl.sleeping){Vl.sleeping=!1;var Nr,Lr=this.s_arbiters;null==nl.zpp_pool?Nr=new nl:(Nr=nl.zpp_pool,nl.zpp_pool=Nr.next,Nr.next=null),Nr.elt=Vl;var Vr=Nr;Vr.next=Lr.head,Lr.head=Vr,Lr.modified=!0,Lr.length++}a=Vl}else if(jl){var jr=Vl;jr.next=je.zpp_pool,je.zpp_pool=jr,a=null}else a=Vl;else a=Vl}}return a},mrca1:null,mrca2:null,MRCA_chains:function(n,e){for(var i=this.mrca1;null!=i.head;){var t=i.head;i.head=t.next;var l=t;l.elt=null,l.next=Nt.zpp_pool,Nt.zpp_pool=l,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var p=this.mrca2;null!=p.head;){var r=p.head;p.head=r.next;var a=r;a.elt=null,a.next=Nt.zpp_pool,Nt.zpp_pool=a,null==p.head&&(p.pushmod=!0),p.modified=!0,p.length--}if(p.pushmod=!0,null!=n.cbSet){var s,o=this.mrca1;null==Nt.zpp_pool?s=new Nt:(s=Nt.zpp_pool,Nt.zpp_pool=s.next,s.next=null),s.elt=n;var _=s;_.next=o.head,o.head=_,o.modified=!0,o.length++}if(null!=n.body.cbSet){var h,u=this.mrca1,x=n.body;null==Nt.zpp_pool?h=new Nt:(h=Nt.zpp_pool,Nt.zpp_pool=h.next,h.next=null),h.elt=x;var d=h;d.next=u.head,u.head=d,u.modified=!0,u.length++}if(null!=e.cbSet){var v,z=this.mrca2;null==Nt.zpp_pool?v=new Nt:(v=Nt.zpp_pool,Nt.zpp_pool=v.next,v.next=null),v.elt=e;var c=v;c.next=z.head,z.head=c,z.modified=!0,z.length++}if(null!=e.body.cbSet){var m,y=this.mrca2,f=e.body;null==Nt.zpp_pool?m=new Nt:(m=Nt.zpp_pool,Nt.zpp_pool=m.next,m.next=null),m.elt=f;var b=m;b.next=y.head,y.head=b,y.modified=!0,y.length++}for(var g=n.body.compound,w=e.body.compound;g!=w;){var M=null==g?0:g.depth;if((null==w?0:w.depth)>M){if(null!=w.cbSet){var C,k=this.mrca2;null==Nt.zpp_pool?C=new Nt:(C=Nt.zpp_pool,Nt.zpp_pool=C.next,C.next=null),C.elt=w;var O=C;O.next=k.head,k.head=O,k.modified=!0,k.length++}w=w.compound}else{if(null!=g.cbSet){var I,S=this.mrca1;null==Nt.zpp_pool?I=new Nt:(I=Nt.zpp_pool,Nt.zpp_pool=I.next,I.next=null),I.elt=g;var P=I;P.next=S.head,S.head=P,S.modified=!0,S.length++}g=g.compound}}},inlined_MRCA_chains:function(n,e){for(var i=this.mrca1;null!=i.head;){var t=i.head;i.head=t.next;var l=t;l.elt=null,l.next=Nt.zpp_pool,Nt.zpp_pool=l,null==i.head&&(i.pushmod=!0),i.modified=!0,i.length--}i.pushmod=!0;for(var p=this.mrca2;null!=p.head;){var r=p.head;p.head=r.next;var a=r;a.elt=null,a.next=Nt.zpp_pool,Nt.zpp_pool=a,null==p.head&&(p.pushmod=!0),p.modified=!0,p.length--}if(p.pushmod=!0,null!=n.cbSet){var s,o=this.mrca1;null==Nt.zpp_pool?s=new Nt:(s=Nt.zpp_pool,Nt.zpp_pool=s.next,s.next=null),s.elt=n;var _=s;_.next=o.head,o.head=_,o.modified=!0,o.length++}if(null!=n.body.cbSet){var h,u=this.mrca1,x=n.body;null==Nt.zpp_pool?h=new Nt:(h=Nt.zpp_pool,Nt.zpp_pool=h.next,h.next=null),h.elt=x;var d=h;d.next=u.head,u.head=d,u.modified=!0,u.length++}if(null!=e.cbSet){var v,z=this.mrca2;null==Nt.zpp_pool?v=new Nt:(v=Nt.zpp_pool,Nt.zpp_pool=v.next,v.next=null),v.elt=e;var c=v;c.next=z.head,z.head=c,z.modified=!0,z.length++}if(null!=e.body.cbSet){var m,y=this.mrca2,f=e.body;null==Nt.zpp_pool?m=new Nt:(m=Nt.zpp_pool,Nt.zpp_pool=m.next,m.next=null),m.elt=f;var b=m;b.next=y.head,y.head=b,y.modified=!0,y.length++}for(var g=n.body.compound,w=e.body.compound;g!=w;){var M=null==g?0:g.depth;if((null==w?0:w.depth)>M){if(null!=w.cbSet){var C,k=this.mrca2;null==Nt.zpp_pool?C=new Nt:(C=Nt.zpp_pool,Nt.zpp_pool=C.next,C.next=null),C.elt=w;var O=C;O.next=k.head,k.head=O,k.modified=!0,k.length++}w=w.compound}else{if(null!=g.cbSet){var I,S=this.mrca1;null==Nt.zpp_pool?I=new Nt:(I=Nt.zpp_pool,Nt.zpp_pool=I.next,I.next=null),I.elt=g;var P=I;P.next=S.head,S.head=P,S.modified=!0,S.length++}g=g.compound}}},__class__:qi};var Yi=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};l["zpp_nape.space.ZPP_SweepData"]=Yi,Yi.__name__=["zpp_nape","space","ZPP_SweepData"],Yi.prototype={next:null,prev:null,shape:null,aabb:null,free:function(){this.prev=null,this.shape=null,this.aabb=null},alloc:function(){},gt:function(n){return this.aabb.minx>n.aabb.minx},__class__:Yi};var Ki=function(n){this.failed=null,this.list=null,Vi.call(this),this.space=n,this.is_sweep=!0,this.sweep=this};l["zpp_nape.space.ZPP_SweepPhase"]=Ki,Ki.__name__=["zpp_nape","space","ZPP_SweepPhase"],Ki.__super__=Vi,Ki.prototype=e(Vi.prototype,{list:null,__insert:function(n){var e;null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),n.sweep=e,e.shape=n,e.aabb=n.aabb,e.next=this.list,null!=this.list&&(this.list.prev=e),this.list=e},__remove:function(n){var e=n.sweep;null==e.prev?this.list=e.next:e.prev.next=e.next,null!=e.next&&(e.next.prev=e.prev),n.sweep=null;var i=e;i.prev=null,i.shape=null,i.aabb=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i},__sync:function(n){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,n.type==me.id_ShapeType_CIRCLE){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,e.type==me.id_ShapeType_POLYGON){var i=e.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next){i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;i.localCOMx+=1*i.lverts.next.next.x,i.localCOMy+=1*i.lverts.next.next.y;i.localCOMx*=.5,i.localCOMy*=.5}else{i.localCOMx=0,i.localCOMy=0;var t=0,l=i.lverts.next,p=l;l=l.next;var r=l;for(l=l.next;null!=l;){var a=l;t+=r.x*(a.y-p.y);var s=a.y*r.x-a.x*r.y;i.localCOMx+=(r.x+a.x)*s,i.localCOMy+=(r.y+a.y)*s,p=r,r=a,l=l.next}l=i.lverts.next;var o=l;t+=r.x*(o.y-p.y);var _=o.y*r.x-o.x*r.y;i.localCOMx+=(r.x+o.x)*_,i.localCOMy+=(r.y+o.y)*_,p=r,r=o,l=l.next;var h=l;t+=r.x*(h.y-p.y);var u=h.y*r.x-h.x*r.y;i.localCOMx+=(r.x+h.x)*u,i.localCOMy+=(r.y+h.y)*u,t=1/(3*t);var x=t;i.localCOMx*=x,i.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var v=e.radius,z=e.radius;e.aabb.minx=e.worldCOMx-v,e.aabb.miny=e.worldCOMy-z,e.aabb.maxx=e.worldCOMx+v,e.aabb.maxy=e.worldCOMy+z}else{var c=n.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var m=c.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var y=c.lverts.next,f=c.gverts.next;null!=f;){var b=f,g=y;y=y.next,b.x=c.body.posx+(c.body.axisy*g.x-c.body.axisx*g.y),b.y=c.body.posy+(g.x*c.body.axisx+g.y*c.body.axisy),f=f.next}}var w=c.gverts.next;c.aabb.minx=w.x,c.aabb.miny=w.y,c.aabb.maxx=w.x,c.aabb.maxy=w.y;for(var M=c.gverts.next.next;null!=M;){var C=M;c.aabb.minx>C.x&&(c.aabb.minx=C.x),C.x>c.aabb.maxx&&(c.aabb.maxx=C.x),c.aabb.miny>C.y&&(c.aabb.miny=C.y),C.y>c.aabb.maxy&&(c.aabb.maxy=C.y),M=M.next}}},sync_broadphase:function(){if(this.space.validation(),null!=this.list)for(var n=this.list.next;null!=n;){var e=n.next,i=n.prev;if(i.aabb.minx<n.aabb.minx)n=e;else{for(;null!=i.prev&&i.prev.aabb.minx>n.aabb.minx;)i=i.prev;var t=n.prev;t.next=n.next,null!=n.next&&(n.next.prev=t),null==i.prev?(n.prev=null,this.list=n,n.next=i,i.prev=n):(n.prev=i.prev,i.prev=n,n.prev.next=n,n.next=i),n=e}}},sync_broadphase_fast:function(){for(var n=this.list.next;null!=n;){var e=n.next,i=n.prev;if(i.aabb.minx<n.aabb.minx)n=e;else{for(;null!=i.prev&&i.prev.aabb.minx>n.aabb.minx;)i=i.prev;var t=n.prev;t.next=n.next,null!=n.next&&(n.next.prev=t),null==i.prev?(n.prev=null,this.list=n,n.next=i,i.prev=n):(n.prev=i.prev,i.prev=n,n.prev.next=n,n.next=i),n=e}}},broadphase:function(n,e){if(null!=this.list){for(var i=this.list.next;null!=i;){var t=i.next,l=i.prev;if(l.aabb.minx<i.aabb.minx)i=t;else{for(;null!=l.prev&&l.prev.aabb.minx>i.aabb.minx;)l=l.prev;var p=i.prev;p.next=i.next,null!=i.next&&(i.next.prev=p),null==l.prev?(i.prev=null,this.list=i,i.next=l,l.prev=i):(i.prev=l.prev,l.prev=i,i.prev.next=i,i.next=l),i=t}}for(var r=this.list;null!=r;){for(var a=r.next,s=r.shape,o=s.body,_=r.aabb.maxx;null!=a&&_>=a.aabb.minx;){var h=a.shape,u=h.body;if(u!=o)if(o.type!=me.id_BodyType_STATIC||u.type!=me.id_BodyType_STATIC)if(o.component.sleeping&&u.component.sleeping)a=a.next;else{var x=s.aabb,d=h.aabb;d.miny>x.maxy||x.miny>d.maxy||(e?n.narrowPhase(s,h,o.type!=me.id_BodyType_DYNAMIC||u.type!=me.id_BodyType_DYNAMIC,null,!1):n.continuousEvent(s,h,o.type!=me.id_BodyType_DYNAMIC||u.type!=me.id_BodyType_DYNAMIC,null,!1)),a=a.next}else a=a.next;else a=a.next}r=r.next}}},clear:function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},shapesUnderPoint:function(n,e,i,t){this.sync_broadphase();var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;for(var p=l,r=null==t?new ne:t,a=this.list;null!=a&&a.aabb.minx>n;)a=a.next;for(;null!=a&&n>=a.aabb.minx;){if(a.aabb.maxx>=n&&e>=a.aabb.miny&&a.aabb.maxy>=e){var s,o=a.shape;if(null!=i){var _=o.filter;s=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else s=!0;s&&(o.type==me.id_ShapeType_CIRCLE?Ke.circleContains(o.circle,p)&&r.push(o.outer):Ke.polyContains(o.polygon,p)&&r.push(o.outer))}a=a.next}var h=p;return null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=Mi.zpp_pool,Mi.zpp_pool=h,r},bodiesUnderPoint:function(n,e,i,t){this.sync_broadphase();var l;null==Mi.zpp_pool?l=new Mi:(l=Mi.zpp_pool,Mi.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e;for(var p=l,r=null==t?new Ln:t,a=this.list;null!=a&&a.aabb.minx>n;)a=a.next;for(;null!=a&&n>=a.aabb.minx;){if(a.aabb.maxx>=n&&e>=a.aabb.miny&&a.aabb.maxy>=e){var s=a.shape,o=s.body.outer;if(!r.has(o)){var _;if(null!=i){var h=s.filter;_=0!=(h.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup)}else _=!0;_&&(s.type==me.id_ShapeType_CIRCLE?Ke.circleContains(s.circle,p)&&r.push(o):Ke.polyContains(s.polygon,p)&&r.push(o))}}a=a.next}var u=p;return null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=Mi.zpp_pool,Mi.zpp_pool=u,r},shapesInAABB:function(n,e,i,t,l){this.sync_broadphase(),this.updateAABBShape(n);for(var p=this.aabbShape.zpp_inner.aabb,r=null==l?new ne:l,a=this.list;null!=a&&p.minx>a.aabb.maxx;)a=a.next;for(;null!=a&&p.maxx>=a.aabb.minx;){var s,o=a.shape;if(null!=t){var _=o.filter;s=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else s=!0;if(s)if(e)if(i)Ke.containTest(this.aabbShape.zpp_inner,o)&&r.push(o.outer);else{var h=a.aabb;if(p.minx>h.minx||p.miny>h.miny||h.maxx>p.maxx||h.maxy>p.maxy){var u=a.aabb;p.miny>u.maxy||u.miny>p.maxy||p.minx>u.maxx||u.minx>p.maxx||Ke.testCollide_safe(o,this.aabbShape.zpp_inner)&&r.push(o.outer)}else r.push(o.outer)}else{var x;if(i){var d=a.aabb;x=!(p.minx>d.minx||p.miny>d.miny||d.maxx>p.maxx)&&p.maxy>=d.maxy}else{var v=a.aabb;x=!(p.miny>v.maxy||v.miny>p.maxy||p.minx>v.maxx)&&p.maxx>=v.minx}x&&r.push(o.outer)}a=a.next}return r},failed:null,bodiesInAABB:function(n,e,i,t,l){this.sync_broadphase(),this.updateAABBShape(n);var p=this.aabbShape.zpp_inner.aabb,r=null==l?new Ln:l;null==this.failed&&(this.failed=new Ln);for(var a=this.list;null!=a&&p.minx>a.aabb.maxx;)a=a.next;for(;null!=a&&p.maxx>=a.aabb.minx;){var s=a.shape,o=s.body.outer,_=a.aabb;if(!(p.miny>_.maxy||_.miny>p.maxy||p.minx>_.maxx||_.minx>p.maxx)){var h;if(null!=t){var u=s.filter;h=0!=(u.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&u.collisionGroup)}else h=!0;if(h)if(e)if(i){if(!this.failed.has(o)){var x=Ke.containTest(this.aabbShape.zpp_inner,s);!r.has(o)&&x?r.push(o):x||(r.remove(o),this.failed.push(o))}}else!r.has(o)&&Ke.testCollide_safe(s,this.aabbShape.zpp_inner)&&r.push(o);else if(i){if(!this.failed.has(o)){var d=s.aabb,v=!(p.minx>d.minx||p.miny>d.miny||d.maxx>p.maxx||d.maxy>p.maxy);!r.has(o)&&v?r.push(o):v||(r.remove(o),this.failed.push(o))}}else{var z;if(r.has(o))z=!1;else{var c=s.aabb;z=!(p.minx>c.minx||p.miny>c.miny||c.maxx>p.maxx)&&p.maxy>=c.maxy}z&&r.push(o)}}a=a.next}return this.failed.clear(),r},shapesInCircle:function(n,e,i,t,l,p){this.sync_broadphase(),this.updateCircShape(n,e,i);for(var r=this.circShape.zpp_inner.aabb,a=null==p?new ne:p,s=this.list;null!=s&&r.minx>s.aabb.maxx;)s=s.next;for(;null!=s&&r.maxx>=s.aabb.minx;){var o=s.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx)){var _,h=s.shape;if(null!=l){var u=h.filter;_=0!=(u.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&u.collisionGroup)}else _=!0;_&&(t?Ke.containTest(this.circShape.zpp_inner,h)&&a.push(h.outer):Ke.testCollide_safe(h,this.circShape.zpp_inner)&&a.push(h.outer))}s=s.next}return a},bodiesInCircle:function(n,e,i,t,l,p){this.sync_broadphase(),this.updateCircShape(n,e,i);var r=this.circShape.zpp_inner.aabb,a=null==p?new Ln:p;null==this.failed&&(this.failed=new Ln);for(var s=this.list;null!=s&&r.minx>s.aabb.maxx;)s=s.next;for(;null!=s&&r.maxx>=s.aabb.minx;){var o=s.aabb;if(!(r.miny>o.maxy||o.miny>r.maxy||r.minx>o.maxx||o.minx>r.maxx)){var _,h=s.shape,u=h.body.outer;if(null!=l){var x=h.filter;_=0!=(x.collisionMask&l.collisionGroup)&&0!=(l.collisionMask&x.collisionGroup)}else _=!0;if(_)if(t){if(!this.failed.has(u)){var d=Ke.containTest(this.circShape.zpp_inner,h);!a.has(u)&&d?a.push(u):d||(a.remove(u),this.failed.push(u))}}else!a.has(u)&&Ke.testCollide_safe(h,this.circShape.zpp_inner)&&a.push(u)}s=s.next}return this.failed.clear(),a},shapesInShape:function(n,e,i,t){this.sync_broadphase(),this.validateShape(n);for(var l=n.aabb,p=null==t?new ne:t,r=this.list;null!=r&&l.minx>r.aabb.maxx;)r=r.next;for(;null!=r&&l.maxx>=r.aabb.minx;){var a=r.aabb;if(!(l.miny>a.maxy||a.miny>l.maxy||l.minx>a.maxx||a.minx>l.maxx)){var s,o=r.shape;if(null!=i){var _=o.filter;s=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else s=!0;s&&(e?Ke.containTest(n,o)&&p.push(o.outer):Ke.testCollide_safe(o,n)&&p.push(o.outer))}r=r.next}return p},bodiesInShape:function(n,e,i,t){this.sync_broadphase(),this.validateShape(n);var l=n.aabb,p=null==t?new Ln:t;null==this.failed&&(this.failed=new Ln);for(var r=this.list;null!=r&&l.minx>r.aabb.maxx;)r=r.next;for(;null!=r&&l.maxx>=r.aabb.minx;){var a=r.aabb;if(!(l.miny>a.maxy||a.miny>l.maxy||l.minx>a.maxx||a.minx>l.maxx)){var s,o=r.shape,_=o.body.outer;if(null!=i){var h=o.filter;s=0!=(h.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&h.collisionGroup)}else s=!0;if(s)if(e){if(!this.failed.has(_)){var u=Ke.containTest(n,o);!p.has(_)&&u?p.push(_):u||(p.remove(_),this.failed.push(_))}}else!p.has(_)&&Ke.testCollide_safe(n,o)&&p.push(_)}r=r.next}return this.failed.clear(),p},rayCast:function(n,e,i){this.sync_broadphase(),n.validate_dir();var t=n.rayAABB(),l=n.maxdist,p=null;if(0==n.dirx)for(var r=this.list;null!=r&&t.minx>=r.aabb.minx;){var a,s=r.aabb;if(t.miny>s.maxy||s.miny>t.maxy||t.minx>s.maxx||s.minx>t.maxx)a=!1;else if(null!=i){var o=r.shape.filter;a=0!=(o.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup)}else a=!0;if(a){var _=n.aabbsect(r.aabb);if(_>=0&&l>_){var h=r.shape.type==me.id_ShapeType_CIRCLE?n.circlesect(r.shape.circle,e,l):n.polysect(r.shape.polygon,e,l);null!=h&&(l=h.zpp_inner.toiDistance,null!=p&&p.zpp_inner.free(),p=h)}}r=r.next}else if(0>n.dirx){for(var u=this.list,x=null;null!=u&&t.maxx>=u.aabb.minx;)x=u,u=u.next;for(u=x;null!=u;){var d,v=u.aabb;if(t.miny>v.maxy||v.miny>t.maxy||t.minx>v.maxx||v.minx>t.maxx)d=!1;else if(null!=i){var z=u.shape.filter;d=0!=(z.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup)}else d=!0;if(d){var c=n.aabbsect(u.aabb);if(c>=0&&l>c){var m=u.shape.type==me.id_ShapeType_CIRCLE?n.circlesect(u.shape.circle,e,l):n.polysect(u.shape.polygon,e,l);null!=m&&(l=m.zpp_inner.toiDistance,null!=p&&p.zpp_inner.free(),p=m)}}u=u.prev}}else for(var y=this.list;null!=y&&t.maxx>=y.aabb.minx&&n.originx+n.dirx*l>y.aabb.minx;){var f,b=y.aabb;if(t.miny>b.maxy||b.miny>t.maxy||t.minx>b.maxx||b.minx>t.maxx)f=!1;else if(null!=i){var g=y.shape.filter;f=0!=(g.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&g.collisionGroup)}else f=!0;if(f){var w=n.aabbsect(y.aabb);if(w>=0&&l>w){var M=y.shape.type==me.id_ShapeType_CIRCLE?n.circlesect(y.shape.circle,e,l):n.polysect(y.shape.polygon,e,l);null!=M&&(l=M.zpp_inner.toiDistance,null!=p&&p.zpp_inner.free(),p=M)}}y=y.next}var C=t;return null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C.wrap_min=C.wrap_max=null,C._invalidate=null,C._validate=null,C.next=qe.zpp_pool,qe.zpp_pool=C,p},rayMultiCast:function(n,e,i,t){this.sync_broadphase(),n.validate_dir();var l=n.rayAABB(),p=null==t?new kn:t;if(0==n.dirx)for(var r=this.list;null!=r&&l.minx>=r.aabb.minx;){var a,s=r.aabb;if(l.miny>s.maxy||s.miny>l.maxy||l.minx>s.maxx||s.minx>l.maxx)a=!1;else if(null!=i){var o=r.shape.filter;a=0!=(o.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&o.collisionGroup)}else a=!0;if(a){var _=n.aabbsect(r.aabb);0>_||(r.shape.type==me.id_ShapeType_CIRCLE?n.circlesect2(r.shape.circle,e,p):n.polysect2(r.shape.polygon,e,p))}r=r.next}else if(0>n.dirx){for(var h=this.list,u=null;null!=h&&l.maxx>=h.aabb.minx;)u=h,h=h.next;for(h=u;null!=h;){var x,d=h.aabb;if(l.miny>d.maxy||d.miny>l.maxy||l.minx>d.maxx||d.minx>l.maxx)x=!1;else if(null!=i){var v=h.shape.filter;x=0!=(v.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&v.collisionGroup)}else x=!0;if(x){var z=n.aabbsect(h.aabb);0>z||(h.shape.type==me.id_ShapeType_CIRCLE?n.circlesect2(h.shape.circle,e,p):n.polysect2(h.shape.polygon,e,p))}h=h.prev}}else for(var c=this.list;null!=c&&l.maxx>=c.aabb.minx;){var m,y=c.aabb;if(l.miny>y.maxy||y.miny>l.maxy||l.minx>y.maxx||y.minx>l.maxx)m=!1;else if(null!=i){var f=c.shape.filter;m=0!=(f.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&f.collisionGroup)}else m=!0;if(m){var b=n.aabbsect(c.aabb);0>b||(c.shape.type==me.id_ShapeType_CIRCLE?n.circlesect2(c.shape.circle,e,p):n.polysect2(c.shape.polygon,e,p))}c=c.next}var g=l;return null!=g.outer&&(g.outer.zpp_inner=null,g.outer=null),g.wrap_min=g.wrap_max=null,g._invalidate=null,g._validate=null,g.next=qe.zpp_pool,qe.zpp_pool=g,p},__class__:Ki});var Wi=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_Float"]=Wi,Wi.__name__=["zpp_nape","util","ZNPArray2_Float"],Wi.prototype={list:null,width:null,resize:function(n,e,i){this.width=n;for(var t=0,l=n*e;l>t;){this.list[t++]=i}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,i){return this.list[e*this.width+n]=i},__class__:Wi};var Ji=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_ZPP_GeomVert"]=Ji,Ji.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],Ji.prototype={list:null,width:null,resize:function(n,e,i){this.width=n;for(var t=0,l=n*e;l>t;){this.list[t++]=i}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,i){return this.list[e*this.width+n]=i},__class__:Ji};var Xi=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};l["zpp_nape.util.ZNPArray2_ZPP_MarchPair"]=Xi,Xi.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],Xi.prototype={list:null,width:null,resize:function(n,e,i){this.width=n;for(var t=0,l=n*e;l>t;){this.list[t++]=i}},get:function(n,e){return this.list[e*this.width+n]},set:function(n,e,i){return this.list[e*this.width+n]=i},__class__:Xi};var Hi=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};l["zpp_nape.util.Hashable2_Boolfalse"]=Hi,Hi.__name__=["zpp_nape","util","Hashable2_Boolfalse"],Hi.get=function(n,e,i){var t;null==Hi.zpp_pool?t=new Hi:(t=Hi.zpp_pool,Hi.zpp_pool=t.next,t.next=null),t.id=n,t.di=e;var l=t;return l.value=i,l},Hi.getpersist=function(n,e){var i;return null==Hi.zpp_pool?i=new Hi:(i=Hi.zpp_pool,Hi.zpp_pool=i.next,i.next=null),i.id=n,i.di=e,i},Hi.ordered_get=function(n,e,i){if(n>e){var t;null==Hi.zpp_pool?t=new Hi:(t=Hi.zpp_pool,Hi.zpp_pool=t.next,t.next=null),t.id=e,t.di=n;var l=t;return l.value=i,l}var p;null==Hi.zpp_pool?p=new Hi:(p=Hi.zpp_pool,Hi.zpp_pool=p.next,p.next=null),p.id=n,p.di=e;var r=p;return r.value=i,r},Hi.ordered_get_persist=function(n,e){if(n>e){var i;return null==Hi.zpp_pool?i=new Hi:(i=Hi.zpp_pool,Hi.zpp_pool=i.next,i.next=null),i.id=e,i.di=n,i}var t;return null==Hi.zpp_pool?t=new Hi:(t=Hi.zpp_pool,Hi.zpp_pool=t.next,t.next=null),t.id=n,t.di=e,t},Hi.prototype={value:null,next:null,hnext:null,id:null,di:null,free:function(){},alloc:function(){},__class__:Hi};var Qi=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var n=0;1048576>n;){n++;this.table.push(null)}};l["zpp_nape.util.FastHash2_Hashable2_Boolfalse"]=Qi,Qi.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],Qi.prototype={table:null,cnt:null,empty:function(){return 0==this.cnt},clear:function(){for(var n=0,e=this.table.length;e>n;){var i=n++,t=this.table[i];if(null!=t){for(;null!=t;){var l=t.hnext;t.hnext=null,t=l}this.table[i]=null}}},get:function(n,e){var i=this.table[106039*n+e&1048575];if(null==i)return null;if(i.id==n&&i.di==e)return i;for(;;)if(null==(i=i.hnext)||i.id==n&&i.di==e)break;return i},ordered_get:function(n,e){if(n>e){var i=n;n=e,e=i}var t=this.table[106039*n+e&1048575];if(null==t)return null;if(t.id==n&&t.di==e)return t;for(;;)if(null==(t=t.hnext)||t.id==n&&t.di==e)break;return t},has:function(n,e){var i=this.table[106039*n+e&1048575];if(null==i)return!1;if(i.id==n&&i.di==e)return!0;for(;;)if(null==(i=i.hnext)||i.id==n&&i.di==e)break;return null!=i},maybeAdd:function(n){var e=106039*n.id+n.di&1048575,i=this.table[e];null==i?(this.table[e]=n,n.hnext=null):(n.hnext=i.hnext,i.hnext=n),this.cnt++},add:function(n){var e=106039*n.id+n.di&1048575,i=this.table[e];null==i?(this.table[e]=n,n.hnext=null):(n.hnext=i.hnext,i.hnext=n),this.cnt++},remove:function(n){var e=106039*n.id+n.di&1048575,i=this.table[e];if(i==n)this.table[e]=i.hnext;else if(null!=i){for(var t;;)if(t=i,null==(i=i.hnext)||i==n)break;t.hnext=i.hnext}n.hnext=null,this.cnt--},hash:function(n,e){return 106039*n+e&1048575},__class__:Qi};var $i=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CallbackSet"]=$i,$i.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],$i.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ot.zpp_pool?e=new Ot:(e=Ot.zpp_pool,Ot.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ot.zpp_pool?e=new Ot:(e=Ot.zpp_pool,Ot.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Ot.zpp_pool?i=new Ot:(i=Ot.zpp_pool,Ot.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Ot.zpp_pool?i=new Ot:(i=Ot.zpp_pool,Ot.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ot.zpp_pool,Ot.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ot.zpp_pool,Ot.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ot.zpp_pool,Ot.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ot.zpp_pool,Ot.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Ot.zpp_pool,Ot.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ot.zpp_pool,Ot.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ot.zpp_pool,Ot.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ot.zpp_pool,Ot.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ot.zpp_pool,Ot.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:$i};var nt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Shape"]=nt,nt.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],nt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==It.zpp_pool?e=new It:(e=It.zpp_pool,It.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==It.zpp_pool?e=new It:(e=It.zpp_pool,It.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==It.zpp_pool?i=new It:(i=It.zpp_pool,It.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==It.zpp_pool?i=new It:(i=It.zpp_pool,It.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=It.zpp_pool,It.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=It.zpp_pool,It.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=It.zpp_pool,It.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=It.zpp_pool,It.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=It.zpp_pool,It.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=It.zpp_pool,It.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=It.zpp_pool,It.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=It.zpp_pool,It.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=It.zpp_pool,It.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:nt};var et=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Body"]=et,et.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],et.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==St.zpp_pool?e=new St:(e=St.zpp_pool,St.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==St.zpp_pool?e=new St:(e=St.zpp_pool,St.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==St.zpp_pool?i=new St:(i=St.zpp_pool,St.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==St.zpp_pool?i=new St:(i=St.zpp_pool,St.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=St.zpp_pool,St.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=St.zpp_pool,St.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=St.zpp_pool,St.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=St.zpp_pool,St.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=St.zpp_pool,St.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=St.zpp_pool,St.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=St.zpp_pool,St.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=St.zpp_pool,St.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=St.zpp_pool,St.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:et};var it=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Compound"]=it,it.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],it.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Tt.zpp_pool?e=new Tt:(e=Tt.zpp_pool,Tt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Tt.zpp_pool?e=new Tt:(e=Tt.zpp_pool,Tt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Tt.zpp_pool?i=new Tt:(i=Tt.zpp_pool,Tt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Tt.zpp_pool?i=new Tt:(i=Tt.zpp_pool,Tt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Tt.zpp_pool,Tt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Tt.zpp_pool,Tt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Tt.zpp_pool,Tt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Tt.zpp_pool,Tt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Tt.zpp_pool,Tt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Tt.zpp_pool,Tt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Tt.zpp_pool,Tt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Tt.zpp_pool,Tt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Tt.zpp_pool,Tt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:it};var tt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Arbiter"]=tt,tt.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],tt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Vt.zpp_pool?e=new Vt:(e=Vt.zpp_pool,Vt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Vt.zpp_pool?e=new Vt:(e=Vt.zpp_pool,Vt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Vt.zpp_pool?i=new Vt:(i=Vt.zpp_pool,Vt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Vt.zpp_pool?i=new Vt:(i=Vt.zpp_pool,Vt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vt.zpp_pool,Vt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vt.zpp_pool,Vt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Vt.zpp_pool,Vt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Vt.zpp_pool,Vt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Vt.zpp_pool,Vt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Vt.zpp_pool,Vt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vt.zpp_pool,Vt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Vt.zpp_pool,Vt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:tt};var lt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CbSetPair"]=lt,lt.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],lt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Dt.zpp_pool?e=new Dt:(e=Dt.zpp_pool,Dt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Dt.zpp_pool?e=new Dt:(e=Dt.zpp_pool,Dt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Dt.zpp_pool?i=new Dt:(i=Dt.zpp_pool,Dt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Dt.zpp_pool?i=new Dt:(i=Dt.zpp_pool,Dt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Dt.zpp_pool,Dt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Dt.zpp_pool,Dt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Dt.zpp_pool,Dt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Dt.zpp_pool,Dt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Dt.zpp_pool,Dt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Dt.zpp_pool,Dt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Dt.zpp_pool,Dt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Dt.zpp_pool,Dt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Dt.zpp_pool,Dt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:lt};var pt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CutInt"]=pt,pt.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],pt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ft.zpp_pool?e=new Ft:(e=Ft.zpp_pool,Ft.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ft.zpp_pool?e=new Ft:(e=Ft.zpp_pool,Ft.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Ft.zpp_pool?i=new Ft:(i=Ft.zpp_pool,Ft.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Ft.zpp_pool?i=new Ft:(i=Ft.zpp_pool,Ft.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ft.zpp_pool,Ft.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ft.zpp_pool,Ft.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ft.zpp_pool,Ft.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ft.zpp_pool,Ft.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Ft.zpp_pool,Ft.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ft.zpp_pool,Ft.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ft.zpp_pool,Ft.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ft.zpp_pool,Ft.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ft.zpp_pool,Ft.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:pt};var rt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_CutVert"]=rt,rt.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],rt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Rt.zpp_pool?e=new Rt:(e=Rt.zpp_pool,Rt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Rt.zpp_pool?e=new Rt:(e=Rt.zpp_pool,Rt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Rt.zpp_pool?i=new Rt:(i=Rt.zpp_pool,Rt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Rt.zpp_pool?i=new Rt:(i=Rt.zpp_pool,Rt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Rt.zpp_pool,Rt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Rt.zpp_pool,Rt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Rt.zpp_pool,Rt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Rt.zpp_pool,Rt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Rt.zpp_pool,Rt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Rt.zpp_pool,Rt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Rt.zpp_pool,Rt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Rt.zpp_pool,Rt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Rt.zpp_pool,Rt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:rt};var at=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_PartitionVertex"]=at,at.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],at.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Bt.zpp_pool?e=new Bt:(e=Bt.zpp_pool,Bt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Bt.zpp_pool?e=new Bt:(e=Bt.zpp_pool,Bt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Bt.zpp_pool?i=new Bt:(i=Bt.zpp_pool,Bt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Bt.zpp_pool?i=new Bt:(i=Bt.zpp_pool,Bt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bt.zpp_pool,Bt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bt.zpp_pool,Bt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Bt.zpp_pool,Bt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Bt.zpp_pool,Bt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Bt.zpp_pool,Bt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Bt.zpp_pool,Bt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Bt.zpp_pool,Bt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bt.zpp_pool,Bt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Bt.zpp_pool,Bt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:at};var st=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_PartitionedPoly"]=st,st.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],st.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Gt.zpp_pool?e=new Gt:(e=Gt.zpp_pool,Gt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Gt.zpp_pool?e=new Gt:(e=Gt.zpp_pool,Gt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Gt.zpp_pool?i=new Gt:(i=Gt.zpp_pool,Gt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Gt.zpp_pool?i=new Gt:(i=Gt.zpp_pool,Gt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gt.zpp_pool,Gt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gt.zpp_pool,Gt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Gt.zpp_pool,Gt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Gt.zpp_pool,Gt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Gt.zpp_pool,Gt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Gt.zpp_pool,Gt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Gt.zpp_pool,Gt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gt.zpp_pool,Gt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Gt.zpp_pool,Gt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:st};var ot=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_GeomVert"]=ot,ot.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],ot.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Zt.zpp_pool?e=new Zt:(e=Zt.zpp_pool,Zt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Zt.zpp_pool?e=new Zt:(e=Zt.zpp_pool,Zt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Zt.zpp_pool?i=new Zt:(i=Zt.zpp_pool,Zt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Zt.zpp_pool?i=new Zt:(i=Zt.zpp_pool,Zt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zt.zpp_pool,Zt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zt.zpp_pool,Zt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Zt.zpp_pool,Zt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Zt.zpp_pool,Zt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Zt.zpp_pool,Zt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Zt.zpp_pool,Zt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Zt.zpp_pool,Zt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zt.zpp_pool,Zt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Zt.zpp_pool,Zt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ot};var _t=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimplifyP"]=_t,_t.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],_t.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ut.zpp_pool?e=new Ut:(e=Ut.zpp_pool,Ut.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ut.zpp_pool?e=new Ut:(e=Ut.zpp_pool,Ut.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Ut.zpp_pool?i=new Ut:(i=Ut.zpp_pool,Ut.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Ut.zpp_pool?i=new Ut:(i=Ut.zpp_pool,Ut.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ut.zpp_pool,Ut.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ut.zpp_pool,Ut.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ut.zpp_pool,Ut.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ut.zpp_pool,Ut.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Ut.zpp_pool,Ut.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ut.zpp_pool,Ut.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ut.zpp_pool,Ut.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ut.zpp_pool,Ut.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ut.zpp_pool,Ut.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:_t};var ht=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimpleVert"]=ht,ht.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],ht.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==qt.zpp_pool?e=new qt:(e=qt.zpp_pool,qt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==qt.zpp_pool?e=new qt:(e=qt.zpp_pool,qt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==qt.zpp_pool?i=new qt:(i=qt.zpp_pool,qt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==qt.zpp_pool?i=new qt:(i=qt.zpp_pool,qt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qt.zpp_pool,qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qt.zpp_pool,qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=qt.zpp_pool,qt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=qt.zpp_pool,qt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=qt.zpp_pool,qt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=qt.zpp_pool,qt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=qt.zpp_pool,qt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qt.zpp_pool,qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=qt.zpp_pool,qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ht};var ut=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SimpleEvent"]=ut,ut.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],ut.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Yt.zpp_pool?e=new Yt:(e=Yt.zpp_pool,Yt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Yt.zpp_pool?e=new Yt:(e=Yt.zpp_pool,Yt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Yt.zpp_pool?i=new Yt:(i=Yt.zpp_pool,Yt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Yt.zpp_pool?i=new Yt:(i=Yt.zpp_pool,Yt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yt.zpp_pool,Yt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yt.zpp_pool,Yt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Yt.zpp_pool,Yt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Yt.zpp_pool,Yt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Yt.zpp_pool,Yt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Yt.zpp_pool,Yt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Yt.zpp_pool,Yt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yt.zpp_pool,Yt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Yt.zpp_pool,Yt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ut};var xt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_AABBPair"]=xt,xt.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],xt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Kt.zpp_pool?e=new Kt:(e=Kt.zpp_pool,Kt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Kt.zpp_pool?e=new Kt:(e=Kt.zpp_pool,Kt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Kt.zpp_pool?i=new Kt:(i=Kt.zpp_pool,Kt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Kt.zpp_pool?i=new Kt:(i=Kt.zpp_pool,Kt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Kt.zpp_pool,Kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Kt.zpp_pool,Kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Kt.zpp_pool,Kt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Kt.zpp_pool,Kt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Kt.zpp_pool,Kt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Kt.zpp_pool,Kt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Kt.zpp_pool,Kt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Kt.zpp_pool,Kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Kt.zpp_pool,Kt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:xt};var dt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Edge"]=dt,dt.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],dt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Wt.zpp_pool?e=new Wt:(e=Wt.zpp_pool,Wt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Wt.zpp_pool?e=new Wt:(e=Wt.zpp_pool,Wt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Wt.zpp_pool?i=new Wt:(i=Wt.zpp_pool,Wt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Wt.zpp_pool?i=new Wt:(i=Wt.zpp_pool,Wt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wt.zpp_pool,Wt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wt.zpp_pool,Wt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Wt.zpp_pool,Wt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Wt.zpp_pool,Wt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Wt.zpp_pool,Wt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Wt.zpp_pool,Wt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Wt.zpp_pool,Wt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wt.zpp_pool,Wt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Wt.zpp_pool,Wt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:dt};var vt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Component"]=vt,vt.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],vt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Xt.zpp_pool?e=new Xt:(e=Xt.zpp_pool,Xt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Xt.zpp_pool?e=new Xt:(e=Xt.zpp_pool,Xt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Xt.zpp_pool?i=new Xt:(i=Xt.zpp_pool,Xt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Xt.zpp_pool?i=new Xt:(i=Xt.zpp_pool,Xt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xt.zpp_pool,Xt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xt.zpp_pool,Xt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Xt.zpp_pool,Xt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Xt.zpp_pool,Xt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Xt.zpp_pool,Xt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Xt.zpp_pool,Xt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Xt.zpp_pool,Xt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xt.zpp_pool,Xt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Xt.zpp_pool,Xt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:vt};var zt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_AABBNode"]=zt,zt.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],zt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Ht.zpp_pool?e=new Ht:(e=Ht.zpp_pool,Ht.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Ht.zpp_pool?e=new Ht:(e=Ht.zpp_pool,Ht.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Ht.zpp_pool?i=new Ht:(i=Ht.zpp_pool,Ht.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Ht.zpp_pool?i=new Ht:(i=Ht.zpp_pool,Ht.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ht.zpp_pool,Ht.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ht.zpp_pool,Ht.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ht.zpp_pool,Ht.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Ht.zpp_pool,Ht.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Ht.zpp_pool,Ht.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ht.zpp_pool,Ht.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Ht.zpp_pool,Ht.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ht.zpp_pool,Ht.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Ht.zpp_pool,Ht.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:zt};var ct=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_InteractionGroup"]=ct,ct.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],ct.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==Qt.zpp_pool?e=new Qt:(e=Qt.zpp_pool,Qt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==Qt.zpp_pool?e=new Qt:(e=Qt.zpp_pool,Qt.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==Qt.zpp_pool?i=new Qt:(i=Qt.zpp_pool,Qt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==Qt.zpp_pool?i=new Qt:(i=Qt.zpp_pool,Qt.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qt.zpp_pool,Qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qt.zpp_pool,Qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Qt.zpp_pool,Qt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=Qt.zpp_pool,Qt.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=Qt.zpp_pool,Qt.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Qt.zpp_pool,Qt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=Qt.zpp_pool,Qt.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qt.zpp_pool,Qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=Qt.zpp_pool,Qt.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ct};var mt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_FluidArbiter"]=mt,mt.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],mt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==$t.zpp_pool?e=new $t:(e=$t.zpp_pool,$t.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==$t.zpp_pool?e=new $t:(e=$t.zpp_pool,$t.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==$t.zpp_pool?i=new $t:(i=$t.zpp_pool,$t.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==$t.zpp_pool?i=new $t:(i=$t.zpp_pool,$t.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$t.zpp_pool,$t.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$t.zpp_pool,$t.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=$t.zpp_pool,$t.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=$t.zpp_pool,$t.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=$t.zpp_pool,$t.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=$t.zpp_pool,$t.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=$t.zpp_pool,$t.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$t.zpp_pool,$t.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=$t.zpp_pool,$t.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:mt};var yt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_SensorArbiter"]=yt,yt.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],yt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==nl.zpp_pool?e=new nl:(e=nl.zpp_pool,nl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==nl.zpp_pool?e=new nl:(e=nl.zpp_pool,nl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==nl.zpp_pool?i=new nl:(i=nl.zpp_pool,nl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==nl.zpp_pool?i=new nl:(i=nl.zpp_pool,nl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=nl.zpp_pool,nl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=nl.zpp_pool,nl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=nl.zpp_pool,nl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=nl.zpp_pool,nl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=nl.zpp_pool,nl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=nl.zpp_pool,nl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:yt};var ft=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ColArbiter"]=ft,ft.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],ft.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==el.zpp_pool?e=new el:(e=el.zpp_pool,el.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==el.zpp_pool?e=new el:(e=el.zpp_pool,el.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==el.zpp_pool?i=new el:(i=el.zpp_pool,el.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==el.zpp_pool?i=new el:(i=el.zpp_pool,el.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=el.zpp_pool,el.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=el.zpp_pool,el.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=el.zpp_pool,el.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=el.zpp_pool,el.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=el.zpp_pool,el.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=el.zpp_pool,el.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:ft};var bt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_Listener"]=bt,bt.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],bt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==il.zpp_pool?e=new il:(e=il.zpp_pool,il.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==il.zpp_pool?e=new il:(e=il.zpp_pool,il.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==il.zpp_pool?i=new il:(i=il.zpp_pool,il.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==il.zpp_pool?i=new il:(i=il.zpp_pool,il.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=il.zpp_pool,il.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=il.zpp_pool,il.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=il.zpp_pool,il.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=il.zpp_pool,il.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=il.zpp_pool,il.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=il.zpp_pool,il.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:bt};var gt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_ToiEvent"]=gt,gt.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],gt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==tl.zpp_pool?e=new tl:(e=tl.zpp_pool,tl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==tl.zpp_pool?e=new tl:(e=tl.zpp_pool,tl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==tl.zpp_pool?i=new tl:(i=tl.zpp_pool,tl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==tl.zpp_pool?i=new tl:(i=tl.zpp_pool,tl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=tl.zpp_pool,tl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=tl.zpp_pool,tl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=tl.zpp_pool,tl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=tl.zpp_pool,tl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=tl.zpp_pool,tl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=tl.zpp_pool,tl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:gt};var wt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ConvexResult"]=wt,wt.__name__=["zpp_nape","util","ZNPList_ConvexResult"],wt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==ll.zpp_pool?e=new ll:(e=ll.zpp_pool,ll.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==ll.zpp_pool?e=new ll:(e=ll.zpp_pool,ll.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==ll.zpp_pool?i=new ll:(i=ll.zpp_pool,ll.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==ll.zpp_pool?i=new ll:(i=ll.zpp_pool,ll.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=ll.zpp_pool,ll.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=ll.zpp_pool,ll.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=ll.zpp_pool,ll.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=ll.zpp_pool,ll.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=ll.zpp_pool,ll.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=ll.zpp_pool,ll.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:wt};var Mt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_ZPP_GeomPoly"]=Mt,Mt.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],Mt.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==pl.zpp_pool?e=new pl:(e=pl.zpp_pool,pl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==pl.zpp_pool?e=new pl:(e=pl.zpp_pool,pl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==pl.zpp_pool?i=new pl:(i=pl.zpp_pool,pl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==pl.zpp_pool?i=new pl:(i=pl.zpp_pool,pl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=pl.zpp_pool,pl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=pl.zpp_pool,pl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=pl.zpp_pool,pl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=pl.zpp_pool,pl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=pl.zpp_pool,pl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=pl.zpp_pool,pl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=pl.zpp_pool,pl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=pl.zpp_pool,pl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=pl.zpp_pool,pl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:Mt};var Ct=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};l["zpp_nape.util.ZNPList_RayResult"]=Ct,Ct.__name__=["zpp_nape","util","ZNPList_RayResult"],Ct.prototype={head:null,begin:function(){return this.head},modified:null,pushmod:null,length:null,setbegin:function(n){this.head=n,this.modified=!0,this.pushmod=!0},add:function(n){var e;null==rl.zpp_pool?e=new rl:(e=rl.zpp_pool,rl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},inlined_add:function(n){var e;null==rl.zpp_pool?e=new rl:(e=rl.zpp_pool,rl.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;return i.next=this.head,this.head=i,this.modified=!0,this.length++,n},addAll:function(n){for(var e=n.head;null!=e;){this.add(e.elt),e=e.next}},insert:function(n,e){var i;null==rl.zpp_pool?i=new rl:(i=rl.zpp_pool,rl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},inlined_insert:function(n,e){var i;null==rl.zpp_pool?i=new rl:(i=rl.zpp_pool,rl.zpp_pool=i.next,i.next=null),i.elt=e;var t=i;return null==n?(t.next=this.head,this.head=t):(t.next=n.next,n.next=t),this.pushmod=this.modified=!0,this.length++,t},pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},inlined_pop:function(){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},inlined_pop_unsafe:function(){var n=this.head.elt;return this.pop(),n},remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=rl.zpp_pool,rl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){this.erase(e),t=!0;break}e=i,i=i.next}return t},inlined_remove:function(n){for(var e=null,i=this.head;null!=i;){if(i.elt==n){var t,l;null==e?(t=this.head,l=t.next,null==(this.head=l)&&(this.pushmod=!0)):(t=e.next,l=t.next,e.next=l,null==l&&(this.pushmod=!0));var p=t;p.elt=null,p.next=rl.zpp_pool,rl.zpp_pool=p,this.modified=!0,this.length--,this.pushmod=!0,!0;break}e=i,i=i.next}},inlined_try_remove:function(n){for(var e=null,i=this.head,t=!1;null!=i;){if(i.elt==n){var l,p;null==e?(l=this.head,p=l.next,null==(this.head=p)&&(this.pushmod=!0)):(l=e.next,p=l.next,e.next=p,null==p&&(this.pushmod=!0));var r=l;r.elt=null,r.next=rl.zpp_pool,rl.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,t=!0;break}e=i,i=i.next}return t},erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=rl.zpp_pool,rl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},inlined_erase:function(n){var e,i;null==n?(e=this.head,i=e.next,null==(this.head=i)&&(this.pushmod=!0)):(e=n.next,i=e.next,n.next=i,null==i&&(this.pushmod=!0));var t=e;return t.elt=null,t.next=rl.zpp_pool,rl.zpp_pool=t,this.modified=!0,this.length--,this.pushmod=!0,i},splice:function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;){var n=this.head;this.head=n.next;var e=n;e.elt=null,e.next=rl.zpp_pool,rl.zpp_pool=e,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},reverse:function(){for(var n=this.head,e=null;null!=n;){var i=n.next;n.next=e,this.head=n,e=n,n=i}this.modified=!0,this.pushmod=!0},empty:function(){return null==this.head},size:function(){return this.length},has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},inlined_has:function(n){var e;e=!1;for(var i=this.head;null!=i;){if(i.elt==n){e=!0;break}i=i.next}return e},front:function(){return this.head.elt},back:function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},iterator_at:function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},at:function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},__class__:Ct};var kt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbType"]=kt,kt.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],kt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:kt};var Ot=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CallbackSet"]=Ot,Ot.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],Ot.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ot};var It=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Shape"]=It,It.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],It.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:It};var St=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Body"]=St,St.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],St.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:St};var Pt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Constraint"]=Pt,Pt.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],Pt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Pt};var Tt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Compound"]=Tt,Tt.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],Tt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Tt};var At=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_InteractionListener"]=At,At.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],At.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:At};var Et=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbSet"]=Et,Et.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],Et.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Et};var Nt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Interactor"]=Nt,Nt.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],Nt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Nt};var Lt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_BodyListener"]=Lt,Lt.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Lt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Lt};var Vt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Arbiter"]=Vt,Vt.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],Vt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Vt};var jt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ConstraintListener"]=jt,jt.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],jt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:jt};var Dt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CbSetPair"]=Dt,Dt.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],Dt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Dt};var Ft=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CutInt"]=Ft,Ft.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],Ft.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ft};var Rt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_CutVert"]=Rt,Rt.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],Rt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Rt};var Bt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_PartitionVertex"]=Bt,Bt.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],Bt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Bt};var Gt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_PartitionedPoly"]=Gt,Gt.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],Gt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Gt};var Zt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_GeomVert"]=Zt,Zt.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],Zt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Zt};var Ut=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimplifyP"]=Ut,Ut.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],Ut.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ut};var qt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimpleVert"]=qt,qt.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],qt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:qt};var Yt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SimpleEvent"]=Yt,Yt.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],Yt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Yt};var Kt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_AABBPair"]=Kt,Kt.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],Kt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Kt};var Wt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Edge"]=Wt,Wt.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],Wt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Wt};var Jt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Vec2"]=Jt,Jt.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],Jt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Jt};var Xt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Component"]=Xt,Xt.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],Xt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Xt};var Ht=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_AABBNode"]=Ht,Ht.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],Ht.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Ht};var Qt=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_InteractionGroup"]=Qt,Qt.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],Qt.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:Qt};var $t=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_FluidArbiter"]=$t,$t.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],$t.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:$t};var nl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_SensorArbiter"]=nl,nl.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],nl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:nl};var el=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ColArbiter"]=el,el.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],el.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:el};var il=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_Listener"]=il,il.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],il.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:il};var tl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_ToiEvent"]=tl,tl.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],tl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:tl};var ll=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ConvexResult"]=ll,ll.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],ll.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:ll};var pl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_ZPP_GeomPoly"]=pl,pl.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],pl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:pl};var rl=function(){this.elt=null,this.next=null};l["zpp_nape.util.ZNPNode_RayResult"]=rl,rl.__name__=["zpp_nape","util","ZNPNode_RayResult"],rl.prototype={next:null,alloc:function(){},free:function(){this.elt=null},elt:null,elem:function(){return this.elt},__class__:rl};var al=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,Sn.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};l["zpp_nape.util.ZPP_MixVec2List"]=al,al.__name__=["zpp_nape","util","ZPP_MixVec2List"],al.get=function(n,e){null==e&&(e=!1);var i=new al;return i.inner=n,i.zpp_inner.immutable=e,i},al.__super__=Sn,al.prototype=e(Sn.prototype,{inner:null,_length:null,zip_length:null,at_ite:null,at_index:null,zpp_gl:function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=this.inner.next;null!=n;){this._length++,n=n.next}this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(n){if(this.zpp_vm(),0>n||this.zpp_gl(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),this.at_index>n||null==this.at_ite)for(this.at_index=0,this.at_ite=this.inner.next;;){break}for(;this.at_index!=n;)for(this.at_index++,this.at_ite=this.at_ite.next;;){break}var e=this.at_ite;if(null==e.outer){e.outer=new On;var i=e.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,e.outer.zpp_inner=e}return e.outer},push:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.inner.add(n.zpp_inner);else{this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},unshift:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner)}else this.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},pop:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(n=this.inner.next,null==n.outer){n.outer=new On;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=Mi.zpp_pool,Mi.zpp_pool=e,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.inner.pop()}else{null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var t=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(n=null==t?this.inner.next:t.next,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,n.outer.zpp_inner=n}var p=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.inner.erase(t)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},shift:function(){this.zpp_inner.modify_test(),this.empty(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var e=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(n=null==e?this.inner.next:e.next,null==n.outer){n.outer=new On;var i=n.outer.zpp_inner;null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.erase(e)}else{if(n=this.inner.next,null==n.outer){n.outer=new On;var l=n.outer.zpp_inner;null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,n.outer.zpp_inner=n}var p=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(p),this.zpp_inner.dontremove||this.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new On;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},remove:function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e;e=!1;for(var i=this.inner.next;null!=i;){if(n.zpp_inner==i){e=!0;break}i=i.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},clear:function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},__class__:al});var sl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new de,this._invalidated=!0};l["zpp_nape.util.ZPP_ConstraintList"]=sl,sl.__name__=["zpp_nape","util","ZPP_ConstraintList"],sl.get=function(n,e){null==e&&(e=!1);var i=new Z;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},sl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:sl};var ol=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new et,this._invalidated=!0};l["zpp_nape.util.ZPP_BodyList"]=ol,ol.__name__=["zpp_nape","util","ZPP_BodyList"],ol.get=function(n,e){null==e&&(e=!1);var i=new Ln;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},ol.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ol};var _l=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ve,this._invalidated=!0};l["zpp_nape.util.ZPP_InteractorList"]=_l,_l.__name__=["zpp_nape","util","ZPP_InteractorList"],_l.get=function(n,e){null==e&&(e=!1);var i=new Un;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},_l.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:_l};var hl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new it,this._invalidated=!0};l["zpp_nape.util.ZPP_CompoundList"]=hl,hl.__name__=["zpp_nape","util","ZPP_CompoundList"],hl.get=function(n,e){null==e&&(e=!1);var i=new Fn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},hl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:hl};var ul=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new bt,this._invalidated=!0};l["zpp_nape.util.ZPP_ListenerList"]=ul,ul.__name__=["zpp_nape","util","ZPP_ListenerList"],ul.get=function(n,e){null==e&&(e=!1);var i=new N;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},ul.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ul};var xl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ge,this._invalidated=!0};l["zpp_nape.util.ZPP_CbTypeList"]=xl,xl.__name__=["zpp_nape","util","ZPP_CbTypeList"],xl.get=function(n,e){null==e&&(e=!1);var i=new O;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},xl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:xl};var dl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ye,this._invalidated=!0};l["zpp_nape.util.ZPP_Vec2List"]=dl,dl.__name__=["zpp_nape","util","ZPP_Vec2List"],dl.get=function(n,e){null==e&&(e=!1);var i=new Sn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},dl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:dl};var vl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Mt,this._invalidated=!0};l["zpp_nape.util.ZPP_GeomPolyList"]=vl,vl.__name__=["zpp_nape","util","ZPP_GeomPolyList"],vl.get=function(n,e){null==e&&(e=!1);var i=new mn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},vl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:vl};var zl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ct,this._invalidated=!0};l["zpp_nape.util.ZPP_RayResultList"]=zl,zl.__name__=["zpp_nape","util","ZPP_RayResultList"],zl.get=function(n,e){null==e&&(e=!1);var i=new kn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},zl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:zl};var cl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new wt,this._invalidated=!0};l["zpp_nape.util.ZPP_ConvexResultList"]=cl,cl.__name__=["zpp_nape","util","ZPP_ConvexResultList"],cl.get=function(n,e){null==e&&(e=!1);var i=new dn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},cl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:cl};var ml=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new dt,this._invalidated=!0};l["zpp_nape.util.ZPP_EdgeList"]=ml,ml.__name__=["zpp_nape","util","ZPP_EdgeList"],ml.get=function(n,e){null==e&&(e=!1);var i=new Hn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},ml.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:ml};var yl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new nt,this._invalidated=!0};l["zpp_nape.util.ZPP_ShapeList"]=yl,yl.__name__=["zpp_nape","util","ZPP_ShapeList"],yl.get=function(n,e){null==e&&(e=!1);var i=new ne;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},yl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:yl};var fl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ct,this._invalidated=!0};l["zpp_nape.util.ZPP_InteractionGroupList"]=fl,fl.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],fl.get=function(n,e){null==e&&(e=!1);var i=new _n;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},fl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:fl};var bl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new tt,this._invalidated=!0};l["zpp_nape.util.ZPP_ArbiterList"]=bl,bl.__name__=["zpp_nape","util","ZPP_ArbiterList"],bl.get=function(n,e){null==e&&(e=!1);var i=new $;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},bl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:bl};var gl=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Re,this._invalidated=!0};l["zpp_nape.util.ZPP_ContactList"]=gl,gl.__name__=["zpp_nape","util","ZPP_ContactList"],gl.get=function(n,e){null==e&&(e=!1);var i=new pn;return i.zpp_inner.inner=n,e&&(i.zpp_inner.immutable=!0),i.zpp_inner.zip_length=!0,i},gl.prototype={outer:null,inner:null,immutable:null,_invalidated:null,_invalidate:null,_validate:null,_modifiable:null,adder:null,post_adder:null,subber:null,dontremove:null,reverse_flag:null,valmod:function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modified:function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},modify_test:function(){null!=this._modifiable&&this._modifiable()},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},at_index:null,at_ite:null,push_ite:null,zip_length:null,user_length:null,__class__:gl};var wl=function(){};l["zpp_nape.util.ZPP_Math"]=wl,wl.__name__=["zpp_nape","util","ZPP_Math"],wl.sqrt=function(n){return Math.sqrt(n)},wl.invsqrt=function(n){return 1/Math.sqrt(n)},wl.sqr=function(n){return n*n},wl.clamp2=function(n,e){var i=-e;return i>n?i:n>e?e:n},wl.clamp=function(n,e,i){return e>n?e:n>i?i:n};var Ml=function(){};l["zpp_nape.util.ZPP_PubPool"]=Ml,Ml.__name__=["zpp_nape","util","ZPP_PubPool"];var Cl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_Body"]=Cl,Cl.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],Cl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Cl.zpp_pool,Cl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Cl.zpp_pool,Cl.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Cl.zpp_pool,Cl.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Cl.zpp_pool,Cl.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Cl.zpp_pool?e=new Cl:(e=Cl.zpp_pool,Cl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Cl};var kl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_CbSetPair"]=kl,kl.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],kl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=kl.zpp_pool,kl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=kl.zpp_pool,kl.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=kl.zpp_pool,kl.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=kl.zpp_pool,kl.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==kl.zpp_pool?e=new kl:(e=kl.zpp_pool,kl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:kl};var Ol=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_PartitionVertex"]=Ol,Ol.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],Ol.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Ol.zpp_pool,Ol.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Ol.zpp_pool,Ol.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Ol.zpp_pool,Ol.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Ol.zpp_pool,Ol.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Ol.zpp_pool?e=new Ol:(e=Ol.zpp_pool,Ol.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Ol};var Il=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_PartitionPair"]=Il,Il.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],Il.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Il.zpp_pool,Il.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Il.zpp_pool,Il.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Il.zpp_pool,Il.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Il.zpp_pool,Il.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Il.zpp_pool?e=new Il:(e=Il.zpp_pool,Il.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Il};var Sl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleVert"]=Sl,Sl.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],Sl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Sl.zpp_pool,Sl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Sl.zpp_pool,Sl.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Sl.zpp_pool,Sl.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Sl.zpp_pool,Sl.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Sl.zpp_pool?e=new Sl:(e=Sl.zpp_pool,Sl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Sl};var Pl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleSeg"]=Pl,Pl.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],Pl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Pl.zpp_pool,Pl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Pl.zpp_pool,Pl.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Pl.zpp_pool,Pl.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Pl.zpp_pool,Pl.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Pl.zpp_pool?e=new Pl:(e=Pl.zpp_pool,Pl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Pl};var Tl=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_SimpleEvent"]=Tl,Tl.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],Tl.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Tl.zpp_pool,Tl.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Tl.zpp_pool,Tl.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Tl.zpp_pool,Tl.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Tl.zpp_pool,Tl.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Tl.zpp_pool?e=new Tl:(e=Tl.zpp_pool,Tl.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Tl};var Al=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};l["zpp_nape.util.ZPP_Set_ZPP_CbSet"]=Al,Al.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],Al.prototype={free:function(){this.data=null,this.lt=null,this.swapped=null},alloc:function(){},lt:null,swapped:null,data:null,prev:null,next:null,parent:null,colour:null,verify:function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,i=!0;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var l=t.data;if(i){if(e==l)i=!1;else if(!this.lt(l,e)&&this.lt(e,l))return!1}else if(!this.lt(e,l)&&this.lt(l,e))return!1;if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},empty:function(){return null==this.parent},singular:function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},size:function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;){if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}}return n},has:function(n){return null!=this.find(n)},find:function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},has_weak:function(n){return null!=this.find_weak(n)},find_weak:function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},lower_bound:function(n){var e=null;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var t=i.data;if(!this.lt(t,n)){e=t;break}if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}return e},first:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},pop_front:function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},remove:function(n){this.remove_node(this.find(n))},successor_node:function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},predecessor_node:function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},successor:function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},predecessor:function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},remove_node:function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var i=n.data;n.data=e.data,e.data=i,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var t=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)t.colour=1;else if(null!=n.parent)for(var l=n.parent;;){l.colour++,l.prev.colour--,l.next.colour--;var p=l.prev;if(-1==p.colour){this.__fix_neg_red(p);break}if(0==p.colour){if(null!=p.prev&&0==p.prev.colour){this.__fix_dbl_red(p.prev);break}if(null!=p.next&&0==p.next.colour){this.__fix_dbl_red(p.next);break}}var r=l.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==l.colour){if(null!=l.parent){l=l.parent;continue}l.colour=1}break}var a=n.parent;null==a?this.parent=t:a.prev==n?a.prev=t:a.next=t,null!=t&&(t.parent=a),n.parent=n.prev=n.next=null;var s=n;s.data=null,s.lt=null,s.swapped=null,s.next=Al.zpp_pool,Al.zpp_pool=s},clear:function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var i=n;i.data=null,i.lt=null,i.swapped=null,i.next=Al.zpp_pool,Al.zpp_pool=i,n=e}this.parent=null}},clear_with:function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var i=e.parent;null!=i&&(e==i.prev?i.prev=null:i.next=null,e.parent=null);var t=e;t.data=null,t.lt=null,t.swapped=null,t.next=Al.zpp_pool,Al.zpp_pool=t,e=i}this.parent=null}},clear_node:function(n,e){e(n.data);var i=n.parent;null!=i&&(n==i.prev?i.prev=null:i.next=null,n.parent=null);var t=n;return t.data=null,t.lt=null,t.swapped=null,t.next=Al.zpp_pool,Al.zpp_pool=t,i},__fix_neg_red:function(n){var e,i=n.parent;if(i.prev==n){var t=n.prev,l=n.next,p=l.prev,r=l.next;t.colour=0,n.colour=i.colour=1,n.next=p,null!=p&&(p.parent=n);var a=i.data;i.data=l.data,l.data=a,null!=this.swapped&&this.swapped(i.data,l.data),l.prev=r,null!=r&&(r.parent=l),l.next=i.next,null!=i.next&&(i.next.parent=l),i.next=l,null!=l&&(l.parent=i),e=t}else{var s=n.next,o=n.prev,_=o.next,h=o.prev;s.colour=0,n.colour=i.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=i.data;i.data=o.data,o.data=u,null!=this.swapped&&this.swapped(i.data,o.data),o.next=h,null!=h&&(h.parent=o),o.prev=i.prev,null!=i.prev&&(i.prev.parent=o),i.prev=o,null!=o&&(o.parent=i),e=s}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},__fix_dbl_red:function(n){for(;;){var e=n.parent,i=e.parent;if(null==i){e.colour=1;break}var t,l,p,r,a,s,o;e==i.prev?(p=i,o=i.next,n==e.prev?(t=n,l=e,r=n.prev,a=n.next,s=e.next):(t=e,l=n,r=e.prev,a=n.prev,s=n.next)):(t=i,r=i.prev,n==e.prev?(l=n,p=e,a=n.prev,s=n.next,o=e.next):(l=e,p=n,a=e.prev,s=n.prev,o=n.next));var _=i.parent;if(null==_?this.parent=l:_.prev==i?_.prev=l:_.next=l,null!=l&&(l.parent=_),t.prev=r,null!=r&&(r.parent=t),t.next=a,null!=a&&(a.parent=t),l.prev=t,null!=t&&(t.parent=l),l.next=p,null!=p&&(p.parent=l),p.prev=s,null!=s&&(s.parent=p),p.next=o,null!=o&&(o.parent=p),l.colour=i.colour-1,t.colour=1,p.colour=1,l==this.parent)this.parent.colour=1;else if(0==l.colour&&0==l.parent.colour){n=l;continue}break}},try_insert_bool:function(n){var e=null,i=null;if(null==this.parent)null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},try_insert:function(n){var e=null,i=null;if(null==this.parent)null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(i=this.parent;;)if(this.lt(n,i.data)){if(null==i.prev){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,i.prev=e,e.parent=i;break}i=i.prev}else{if(!this.lt(i.data,n))break;if(null==i.next){null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,i.next=e,e.parent=i;break}i=i.next}return null==e?i:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},insert:function(n){var e;if(null==Al.zpp_pool?e=new Al:(e=Al.zpp_pool,Al.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var i=this.parent;;)if(this.lt(e.data,i.data)){if(null==i.prev){i.prev=e,e.parent=i;break}i=i.prev}else{if(null==i.next){i.next=e,e.parent=i;break}i=i.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},__class__:Al};var El,Nl=0;l.Math=Math,String.prototype.__class__=l.String=String,String.__name__=["String"],l.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=l.Date=Date,Date.__name__=["Date"];var Ll=l.Int={__name__:["Int"]},Vl=l.Dynamic={__name__:["Dynamic"]},jl=l.Float=Number;jl.__name__=["Float"];var Dl=l.Bool=Boolean;Dl.__ename__=["Bool"];var Fl=l.Class={__name__:["Class"]},Rl={};l.Void={__ename__:["Void"]};s.cellWcnt=3,s.cellHcnt=3,s.cellWidth=266.6666666666667,s.cellHeight=200,s.size=22,m.__toStr={}.toString,y.epsilon=1e-8,y.fluidAngularDragFriction=2.5,y.fluidAngularDrag=100,y.fluidVacuumDrag=.5,y.fluidLinearDrag=.5,y.collisionSlop=.2,y.collisionSlopCCD=.5,y.distanceThresholdCCD=.05,y.staticCCDLinearThreshold=.05,y.staticCCDAngularThreshold=.005,y.bulletCCDLinearThreshold=.125,y.bulletCCDAngularThreshold=.0125,y.dynamicSweepLinearThreshold=17,y.dynamicSweepAngularThreshold=.6,y.angularCCDSlipScale=.75,y.arbiterExpirationDelay=6,y.staticFrictionThreshold=2,y.elasticThreshold=20,y.sleepDelay=60,y.linearSleepThreshold=.2,y.angularSleepThreshold=.4,y.contactBiasCoef=.3,y.contactStaticBiasCoef=.6,y.contactContinuousBiasCoef=.4,y.contactContinuousStaticBiasCoef=.5,y.constraintLinearSlop=.1,y.constraintAngularSlop=.001,y.illConditionedThreshold=2e8,k.zpp_pool=null,E.zpp_pool=null,R.zpp_internalAlloc=!1,G.zpp_pool=null,Q.zpp_pool=null,ln.zpp_pool=null,on.zpp_pool=null,xn.zpp_pool=null,cn.zpp_pool=null,Cn.zpp_pool=null,In.zpp_pool=null,An.zpp_internalAlloc=!1,Nn.zpp_pool=null,Dn.zpp_pool=null,Zn.zpp_pool=null,Kn.zpp_internalAlloc=!1,Xn.zpp_pool=null,$n.zpp_pool=null,re.FMAX=1e100,ae._Constraint=0,ae._Interactor=0,ae._CbType=0,ae._CbSet=0,ae._Listener=0,ae._ZPP_SimpleVert=0,ae._ZPP_SimpleSeg=0,ae._Space=0,ae._InteractionGroup=0,se.internal=!1,se.zpp_pool=null,oe.zpp_pool=null,_e.zpp_pool=null,ce.ANY_SHAPE=new C,ce.ANY_BODY=new C,ce.ANY_COMPOUND=new C,ce.ANY_CONSTRAINT=new C,me.internal=!1,me.id_ImmState_ACCEPT=1,me.id_ImmState_IGNORE=2,me.id_ImmState_ALWAYS=4,me.id_GravMassMode_DEFAULT=0,me.id_GravMassMode_FIXED=1,me.id_GravMassMode_SCALED=2,me.id_InertiaMode_DEFAULT=0,me.id_InertiaMode_FIXED=1,me.id_MassMode_DEFAULT=0,me.id_MassMode_FIXED=1,me.id_BodyType_STATIC=1,me.id_BodyType_DYNAMIC=2,me.id_BodyType_KINEMATIC=3,me.id_ListenerType_BODY=0,me.id_ListenerType_CONSTRAINT=1,me.id_PreFlag_ACCEPT=1,me.id_ListenerType_INTERACTION=2,me.id_PreFlag_IGNORE=2,me.id_ListenerType_PRE=3,me.id_PreFlag_ACCEPT_ONCE=3,me.id_PreFlag_IGNORE_ONCE=4,me.id_CbEvent_BEGIN=0,me.id_CbEvent_ONGOING=6,me.id_InteractionType_COLLISION=1,me.id_CbEvent_END=1,me.id_InteractionType_SENSOR=2,me.id_CbEvent_WAKE=2,me.id_InteractionType_FLUID=4,me.id_CbEvent_SLEEP=3,me.id_InteractionType_ANY=7,me.id_CbEvent_BREAK=4,me.id_CbEvent_PRE=5,me.id_Winding_UNDEFINED=0,me.id_Winding_CLOCKWISE=1,me.id_Winding_ANTICLOCKWISE=2,me.id_ValidationResult_VALID=0,me.id_ValidationResult_DEGENERATE=1,me.id_ValidationResult_CONCAVE=2,me.id_ValidationResult_SELF_INTERSECTING=3,me.id_ShapeType_CIRCLE=0,me.id_ShapeType_POLYGON=1,me.id_Broadphase_DYNAMIC_AABB_TREE=0,me.id_Broadphase_SWEEP_AND_PRUNE=1,me.id_ArbiterType_COLLISION=1,me.id_ArbiterType_SENSOR=2,me.id_ArbiterType_FLUID=4,ye.internal=!1,ye.types=function(n){null==me.ListenerType_BODY&&(me.internal=!0,me.ListenerType_BODY=new L,me.internal=!1);var e=me.ListenerType_BODY;null==me.ListenerType_CONSTRAINT&&(me.internal=!0,me.ListenerType_CONSTRAINT=new L,me.internal=!1);var i=me.ListenerType_CONSTRAINT;null==me.ListenerType_INTERACTION&&(me.internal=!0,me.ListenerType_INTERACTION=new L,me.internal=!1);var t=me.ListenerType_INTERACTION;return null==me.ListenerType_PRE&&(me.internal=!0,me.ListenerType_PRE=new L,me.internal=!1),[e,i,t,me.ListenerType_PRE]}(),ye.events=function(n){null==me.CbEvent_BEGIN&&(me.internal=!0,me.CbEvent_BEGIN=new M,me.internal=!1);var e=me.CbEvent_BEGIN;null==me.CbEvent_END&&(me.internal=!0,me.CbEvent_END=new M,me.internal=!1);var i=me.CbEvent_END;null==me.CbEvent_WAKE&&(me.internal=!0,me.CbEvent_WAKE=new M,me.internal=!1);var t=me.CbEvent_WAKE;null==me.CbEvent_SLEEP&&(me.internal=!0,me.CbEvent_SLEEP=new M,me.internal=!1);var l=me.CbEvent_SLEEP;null==me.CbEvent_BREAK&&(me.internal=!0,me.CbEvent_BREAK=new M,me.internal=!1);var p=me.CbEvent_BREAK;null==me.CbEvent_PRE&&(me.internal=!0,me.CbEvent_PRE=new M,me.internal=!1);var r=me.CbEvent_PRE;return null==me.CbEvent_ONGOING&&(me.internal=!0,me.CbEvent_ONGOING=new M,me.internal=!1),[e,i,t,l,p,r,me.CbEvent_ONGOING]}(),we.UCbSet=new ze,we.VCbSet=new ze,we.WCbSet=new ze,we.UCbType=new ge,we.VCbType=new ge,we.WCbType=new ge,Ve.internal=!1,Ve.COL=1,Ve.FLUID=4,Ve.SENSOR=2,Ve.types=function(n){null==me.ArbiterType_COLLISION&&(me.internal=!0,me.ArbiterType_COLLISION=new nn,me.internal=!1);var e=me.ArbiterType_COLLISION;null==me.ArbiterType_SENSOR&&(me.internal=!0,me.ArbiterType_SENSOR=new nn,me.internal=!1);var i=me.ArbiterType_SENSOR;return null==me.ArbiterType_FLUID&&(me.internal=!0,me.ArbiterType_FLUID=new nn,me.internal=!1),[null,e,i,null,me.ArbiterType_FLUID]}(),je.zpp_pool=null,De.zpp_pool=null,Fe.FACE1=0,Fe.FACE2=1,Fe.CIRCLE=2,Fe.zpp_pool=null,Re.internal=!1,Re.zpp_pool=null,Ge.zpp_pool=null,Ze.SHAPE=1,Ze.BODY=2,qe.zpp_pool=null,Ke.flowpoly=new Ye,Ke.flowsegs=new Ye,Je.convexPool=null,Je.rayPool=null,Je.internal=!1,Xe.zpp_pool=null,He.zpp_pool=null,Qe.ints=null,Qe.paths=null,ni.zpp_pool=null,ii.zpp_pool=null,ii.internal=!1,ti.zpp_pool=null,li.zpp_pool=null,pi.me=new pi,pi.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],ri.zpp_pool=null,si.queue=null,si.edges=null,oi.nextId=0,oi.zpp_pool=null,_i.zpp_pool=null,hi.internal=!1,ui.zpp_pool=null,xi.zpp_pool=null,di.zpp_pool=null,zi.sweep=null,zi.inthash=null,zi.vertices=null,zi.queue=null,zi.ints=null,zi.list_vertices=null,zi.list_queue=null,ci.zpp_pool=null,mi.zpp_pool=null,yi.stack=null,fi.zpp_pool=null,gi.zpp_pool=null,wi.queue=null,wi.stack=null,wi.edgeSet=null,Mi.zpp_pool=null,Ii.types=function(n){null==me.BodyType_STATIC&&(me.internal=!0,me.BodyType_STATIC=new Vn,me.internal=!1);var e=me.BodyType_STATIC;null==me.BodyType_DYNAMIC&&(me.internal=!0,me.BodyType_DYNAMIC=new Vn,me.internal=!1);var i=me.BodyType_DYNAMIC;return null==me.BodyType_KINEMATIC&&(me.internal=!0,me.BodyType_KINEMATIC=new Vn,me.internal=!1),[null,e,i,me.BodyType_KINEMATIC]}(),Ii.bodystack=null,Ii.bodyset=null,Ii.cur_graph_depth=0,Pi.zpp_pool=null,Ti.zpp_pool=null,Ti.WAKE=1,Ti.PROPS=2,Ti.ANGDRAG=4,Ti.ARBITERS=8,Ai.types=function(n){null==me.ShapeType_CIRCLE&&(me.internal=!0,me.ShapeType_CIRCLE=new ee,me.internal=!1);var e=me.ShapeType_CIRCLE;return null==me.ShapeType_POLYGON&&(me.internal=!0,me.ShapeType_POLYGON=new ee,me.internal=!1),[e,me.ShapeType_POLYGON]}(),Ni.zpp_pool=null,Ni.internal=!1,ji.zpp_pool=null,Di.zpp_pool=null;Fi.tmpaabb=new qe,Ri.FATTEN=3,Ri.VEL_STEPS=2,Bi.zpp_pool=null,Gi.zpp_pool=null,Zi.zpp_pool=null,Yi.zpp_pool=null,Hi.zpp_pool=null,kt.zpp_pool=null,Ot.zpp_pool=null,It.zpp_pool=null,St.zpp_pool=null,Pt.zpp_pool=null,Tt.zpp_pool=null,At.zpp_pool=null,Et.zpp_pool=null,Nt.zpp_pool=null,Lt.zpp_pool=null,Vt.zpp_pool=null,jt.zpp_pool=null,Dt.zpp_pool=null,Ft.zpp_pool=null,Rt.zpp_pool=null,Bt.zpp_pool=null,Gt.zpp_pool=null,Zt.zpp_pool=null,Ut.zpp_pool=null,qt.zpp_pool=null,Yt.zpp_pool=null,Kt.zpp_pool=null,Wt.zpp_pool=null,Jt.zpp_pool=null,Xt.zpp_pool=null,Ht.zpp_pool=null,Qt.zpp_pool=null,$t.zpp_pool=null,nl.zpp_pool=null,el.zpp_pool=null,il.zpp_pool=null,tl.zpp_pool=null,ll.zpp_pool=null,pl.zpp_pool=null,rl.zpp_pool=null,sl.internal=!1,ol.internal=!1,_l.internal=!1,hl.internal=!1,ul.internal=!1,xl.internal=!1,dl.internal=!1,vl.internal=!1,zl.internal=!1,cl.internal=!1,ml.internal=!1,yl.internal=!1,fl.internal=!1,bl.internal=!1,gl.internal=!1,Ml.poolGeomPoly=null,Ml.nextGeomPoly=null,Ml.poolVec2=null,Ml.nextVec2=null,Ml.poolVec3=null,Ml.nextVec3=null,Cl.zpp_pool=null,kl.zpp_pool=null,Ol.zpp_pool=null,Il.zpp_pool=null,Sl.zpp_pool=null,Pl.zpp_pool=null,Tl.zpp_pool=null,Al.zpp_pool=null;for(var Bl=Object.keys(l),Gl={},Zl=0;Bl.length>Zl;Zl++){var Ul=Bl[Zl];if("nape."==Ul.slice(0,5)){var ql=Ul.split(".");2==ql.length?Gl[ql[1]]=l[Ul]:3==ql.length&&(Gl[ql[1]]||(Gl[ql[1]]={}),Gl[ql[1]][ql[2]]=l[Ul])}}return Gl}()},769:function(n,e,i){"use strict";function t(n,e,i){var t=function(n){for(var e=Math.PI/180,i=0,t=[],l=0;360>l;l++){var r=Math.cos(i)*n,a=Math.sin(i)*n;t.push(p.get(r,a)),i+=e}return t}(n);l.shape.Polygon.call(this,t,e,i),this.radius=n}var l=i(467).nape,p=l.geom.Vec2;t.constructor=t,t.prototype=Object.create(l.shape.Polygon.prototype),n.exports=t},770:function(n,e,i){"use strict";function t(n,e){l.space.Space.call(this,n,e),Object.defineProperty(this,"bodies",{get:function(){return this.get_bodies()}}),Object.defineProperty(this,"world",{get:function(){return this.get_world()}}),Object.defineProperty(this,"constraints",{get:function(){return this.get_constraints()}}),Object.defineProperty(this,"listeners",{get:function(){return this.get_listeners()}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.space.Space.prototype),t.prototype.add=function(n){this.bodies.add(n)},t.prototype.remove=function(n){this.bodies.remove(n)},n.exports=t},771:function(n,e,i){"use strict";function t(n,e,i,t,p){l.constraint.AngleJoint.call(this,n,e,i,t,p),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.constraint.AngleJoint.prototype),n.exports=t},772:function(n,e,i){"use strict";function t(n,e,i,t,p,r){l.constraint.DistanceJoint.call(this,n,e,i,t,p,r),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"jointMax",{get:function(){return this.get_jointMax()},set:function(n){this.set_jointMax(n)}}),Object.defineProperty(this,"jointMin",{get:function(){return this.get_jointMin()},set:function(n){this.set_jointMin(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.constraint.DistanceJoint.prototype),n.exports=t},773:function(n,e,i){"use strict";function t(n,e,i,t,p,r,a){l.constraint.LineJoint.call(this,n,e,i,t,p,r,a),this.body1=n,this.body2=e,this.userData={},Object.defineProperty(this,"body1",{get:function(){this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.constraint.LineJoint.prototype),n.exports=t},774:function(n,e,i){"use strict";function t(n,e,i,t){p.call(this,n,e,i,t),this.userData={},this.coerceAB=!1,this.aTob=!0,Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=i(467).nape,p=l.constraint.PivotJoint;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.updateStep=function(){if(this.coerceAB)if(this.aTob){var n=this.anchor2;this.get_body2()!=this.get_space().get_world()&&(n=this.body2.localPointToWorld(n));var e=this.anchor1;this.body1.set_position(n.sub(e))}else{var n=this.anchor1;this.get_body1()!=this.get_space().get_world()&&(n=this.body1.localPointToWorld(n));var i=this.anchor2;this.body2.set_position(n.sub(i))}},n.exports=t},775:function(n,e,i){"use strict";function t(n,e,i,t,p,r,a,s,o,_,h){l.constraint.PulleyJoint.call(this,n,e,i,t,p,r,a,s,o,_,h),this.userData={},Object.defineProperty(this,"body1",{get:function(){this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"body3",{get:function(){this.get_body3()},set:function(n){this.set_body3(n)}}),Object.defineProperty(this,"body4",{get:function(){this.get_body4()},set:function(n){this.set_body4(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.get_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"anchor3",{get:function(){this.get_anchor3()},set:function(n){this.set_anchor3(n)}}),Object.defineProperty(this,"anchor4",{get:function(){return this.get_anchor4()},set:function(n){this.set_anchor4(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.constraint.PulleyJoint.prototype),n.exports=t},776:function(n,e,i){"use strict";function t(n,e,i,t,l){p.call(this,n,e,i,t,0,1e4),this.anchor1=this.zpp_inner.wrap_a1,this.anchor2=this.zpp_inner.wrap_a2,this.body1=n,this.body2=e,this.frequency=this.zpp_inner.frequency,this.userData={},this.DAMPING_K=.14,this.springLength=l,this.SPRING_FORCE_SCALE=108.156,this.DEFAULT_LEN=100,this.DEFAULT_DAMPING=.2,this.damping=this.DEFAULT_DAMPING,this.zpp_inner.validate=this.validate,this.currentDis=0}var l=i(467).nape,p=l.constraint.DistanceJoint;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.validate=function(){var n=this.outer,e=n.get_body1(),i=n.get_body2();if(null==e||null==i)throw"Error : joint cannot be simulated with null bodies ! ";if(0>this.damping||this.damping>2)throw"Error : The value of damping must be between 0 and 2";var t=e.localPointToWorld(n.get_anchor1()),l=i.localPointToWorld(n.get_anchor2()),p=n.frequency,r=n.springLength,a=t.sub(l),s=a.get_length(),o=s-r,_=n.damping;if(o>0){var h=p*o*n.SPRING_FORCE_SCALE*(1-_);if(e!=e.get_space().get_world()){var u=l.sub(t).unit();u.set_length(h),e.applyImpulse(u,t)}if(i!=i.get_space().get_world()){var x=a.unit();x.set_length(h),i.applyImpulse(x,l)}}},n.exports=t},777:function(n,e,i){"use strict";function t(n,e,i,t,p){l.constraint.DistanceJoint.call(this,n,e,i,t,0,1e4),this.frequency=this.zpp_inner.frequency,Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),this.userData={},this.DAMPING_K=.14,this.springLength=p,this.SPRING_FORCE_SCALE=108.156,this.DEFAULT_LEN=100,this.DEFAULT_DAMPING=.2,this.damping=this.DEFAULT_DAMPING,Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=i(467).nape,p=i(641),r=l.geom.Vec2;t.constructor=t,t.prototype=Object.create(l.constraint.DistanceJoint.prototype),t.prototype.update=function(){var n=this;if(null==n.body1||null==n.body2)throw"Error : joint cannot be simulated with null bodies ! ";if(0>this.damping||this.damping>2)throw"Error : The value of damping must be between 0 and 2";var e=n.body1.localPointToWorld(n.anchor1),i=n.body2.localPointToWorld(n.anchor2),t=n.frequency,l=n.springLength,a=e.sub(i),s=a.get_length(),o=l-s;if(0!=a.get_length()){var _,h=a.mul(1/a.get_length()),u=[n.body1,n.body2];for(_=0;u.length>_;_++){var x=u[_];if(x!=x.space.world){var d=new r;if(x==n.body1)var v=n.body1.velocity.sub(n.body2.velocity);else v=n.body2.velocity.sub(n.body1.velocity);var z=e.sub(i).get_length();if(v.get_length()>z&&(v=v.mul(z/v.get_length())),0!=v.get_length()&&0!=h.get_length())var c=(v.dot(h),p.project(v,h));else c=new r;var m=c.get_x()*n.damping*n.DAMPING_K,y=c.get_y()*n.damping*n.DAMPING_K;x==n.body1?(d.set_x(h.get_x()*o*t),d.set_y(h.get_y()*o*t),e):x==n.body2&&(d.set_x(h.get_x()*o*-1*t),d.set_y(h.get_y()*o*-1*t),i),d.set_x(d.get_x()-m),d.set_y(d.get_y()-y),n.body1!=x.space.world&&n.body2!=x.space.world?(n.body1.applyImpulse(d.mul(n.SPRING_FORCE_SCALE),e),n.body2.applyImpulse(d.mul(-1*n.SPRING_FORCE_SCALE),i)):n.body1==x.space.world?n.body2.applyImpulse(d.mul(n.SPRING_FORCE_SCALE),i):n.body2==x.space.world&&n.body1.applyImpulse(d.mul(n.SPRING_FORCE_SCALE),e);break}}}},n.exports=t},778:function(n,e,i){"use strict";function t(n,e,i,t,p){l.constraint.WeldJoint.call(this,n,e,i,t,p),this.userData={},Object.defineProperty(this,"body1",{get:function(){return this.get_body1()},set:function(n){this.set_body1(n)}}),Object.defineProperty(this,"body2",{get:function(){return this.get_body2()},set:function(n){this.set_body2(n)}}),Object.defineProperty(this,"anchor1",{get:function(){return this.get_anchor1()},set:function(n){this.set_anchor1(n)}}),Object.defineProperty(this,"anchor2",{get:function(){return this.get_anchor2()},set:function(n){this.set_anchor2(n)}}),Object.defineProperty(this,"frequency",{get:function(){return this.get_frequency()},set:function(n){this.set_frequency(n)}}),Object.defineProperty(this,"stiff",{get:function(){return this.get_stiff()},set:function(n){this.set_stiff(n)}}),Object.defineProperty(this,"damping",{get:function(){return this.get_damping()},set:function(n){this.set_damping(n)}}),Object.defineProperty(this,"ignore",{get:function(){return this.get_ignore()},set:function(n){this.set_ignore(n)}}),Object.defineProperty(this,"phase",{get:function(){return this.get_phase()},set:function(n){this.set_phase(n)}}),Object.defineProperty(this,"active",{get:function(){return this.get_active()},set:function(n){this.set_active(n)}})}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.constraint.WeldJoint.prototype),n.exports=t},779:function(n,e,i){"use strict";function t(n,e,i){o.call(this,n,e),this.CbTypeStr=i,this._data=null,Object.defineProperty(this,"data",{set:function(n){this._data=n}}),Object.defineProperty(this,"listeners",{get:function(){var n=this.get_space();if(n){return n.get_listeners()}return null}})}var l=i(467).nape,p=l.callbacks.CbType,r=l.callbacks.CbEvent,a=l.callbacks.InteractionListener,s=l.callbacks.InteractionType,o=i(639);t.constructor=t,t.prototype=Object.create(o.prototype),t.prototype.addHit=function(){this.set_isBullet(!0);var n=this.get_shapes().at(0),e=new p;n.get_cbTypes().add(e);var i=[this.CbTypeStr.LIQUID_SHAPE,this.CbTypeStr.CONTAINER_BOTTOM],t=this;this.hitlisten=new a(r.get_BEGIN(),s.get_SENSOR(),e,i,function(n){var e=n.get_int2().get_body(),i=e.userData.view;i.canPour&&(i.waterFlooding(t._data.ml),t.removeFromSpace())}),this.hitlisten2=new a(r.get_BEGIN(),s.get_SENSOR(),e,this.CbTypeStr.GLOBAL_WALL,function(n){t.removeFromSpace()}),this.listeners.add(this.hitlisten),this.listeners.add(this.hitlisten2)},t.prototype.removeFromSpace=function(){var n=this.userData.view;n&&n.parent&&n.parent.removeChild(n),this.listeners&&(this.listeners.remove(this.hitlisten),this.listeners.remove(this.hitlisten2)),this.set_space(null),this.CbTypeStr=null},n.exports=t},780:function(n,e,i){"use strict";function t(n,e,i,t){p.call(this,n,e,i,t),this.isDraging=!1,this.useing=!1,this.leaveing=!1,this.bind=null}var l=i(467).nape,p=i(521),r=l.callbacks.CbEvent,a=l.callbacks.InteractionType,s=l.callbacks.InteractionListener;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.draging=function(n){this.isDraging=n},t.prototype.setFirstDrag=function(n){this.get_userData().firstDrag=n},t.prototype.createListener=function(n,e,i){if(this.get_body()&&this.space){var t=this;this.interactListener=new s(r.get_ONGOING(),a.get_ANY(),n,e,function(n){var e=n.get_int1(),l=n.get_int2();t.leaveing||e.isDraging||l.isDraging||!i||i(n)}),this.interactListener2=new s(r.get_END(),a.get_ANY(),n,e,function(n){t.removeInterListeners(t.interactListener2),t.leaveing=!1,t.setFirstDrag(!1),t.bind&&(t.bind.useing=!1,t.bind=null),t.useing=!1}),this.addInterListeners([this.interactListener])}},t.prototype.addEndListener=function(){this.addInterListeners([this.interactListener2])},t.prototype.dispose=function(){this.removeInterListeners(this.interactListener),this.removeInterListeners(this.interactListener2)},t.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},n.exports=t},781:function(n,e,i){"use strict";function t(n,e,i,t){p.call(this,n,e,i,t),this.main=null,this.hitEndFlag=!1,this.connectCallback=null,this.breakClickCallback=null,this.intShape1=null,this.intShape2=null,this.connectFail=!1,this.connectPoint=null,this.CbTypeStr=null,this.JointUtil=null,this.BodyUtil=null,this.firsthit=!1,this.circleShape=null,this.dragingConnect=!1,this.createdistanceJoint=!1,Object.defineProperty(this,"connectVec",{get:function(){return this.connectPoint},set:function(n){this.connectPoint=n}})}var l=i(467).nape,p=i(521),r=l.callbacks.CbEvent,a=l.callbacks.InteractionType,s=l.callbacks.InteractionListener;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.registerClass=function(n){n&&(this.CbTypeStr=n.CbTypeStr,this.JointUtil=n.JointUtil,this.BodyUtil=n.BodyUtil,this.InteractionFilterManager=n.InteractionFilterManager,n.InteractionFilterManager&&this.set_filter(this.InteractionFilterManager.LIQUID_IGNORE_GROUP))},t.prototype.dispose=function(){this.removeInterListeners(this.interactListener),this.removeInterListeners(this.interactListener2),this.interactListener&&this.interactListener.set_handler(function(){}),this.interactListener2&&this.interactListener2.set_handler(function(){}),this.intShape1=null,this.intShape2=null,this.connectCallback=null,this.breakClickCallback=null,this.CbTypeStr=null,this.JointUtil=null,this.BodyUtil=null,this.InteractionFilterManager=null,this.zpp_inner.userData=null,this.main=null,this.circleShape=null,this.showHitCircle=null,this.hideHitCircle=null,this.get_cbTypes().clear()},t.prototype.createListener=function(n,e,i){if(this.get_body()&&this.space){var t=this;this.interactListener=new s(r.get_ONGOING(),a.get_ANY(),n,e,function(n){try{var e=n.get_int1().get_body(),i=n.get_int2().get_body();if(!t.dragingConnect&&e.userData.dragManager)return void(t.firsthit||(t.firsthit=!0,t.circleShape=n.get_int2(),n.get_int2().showHitCircle&&n.get_int2().showHitCircle()));if(!t.dragingConnect&&i.userData.dragManager)return void(t.firsthit||(t.firsthit=!0,t.circleShape=n.get_int1(),n.get_int1().showHitCircle&&n.get_int1().showHitCircle()))}catch(l){}t.beginHiting(n)},i),this.interactListener2=new s(r.get_END(),a.get_ANY(),n,e,function(n){t.firsthit=!1,t.circleShape&&t.circleShape.hideHitCircle&&t.circleShape.hideHitCircle(),t.circleShape=null,t.hitEnd(n)},i),this.addInterListeners([this.interactListener,this.interactListener2])}},t.prototype.addCbtype=function(n,e){this.get_cbTypes().add(n),e&&this.createListener(n,this.CbTypeStr.ALL_HOOK_ARY)},t.prototype.beginHiting=function(n){if(!this.var_isbreaking){var e=n.get_int1(),i=n.get_int2();if(!(e!=this&&i!=this||e.get_userData().useing||i.get_userData().useing)){e.get_userData().useing=!0,i.get_userData().useing=!0,e.get_userData().bind=i,i.get_userData().bind=e;var t=this.getIntBodys(e,i);t.push(e,i),this.bindJoint.apply(this,t)}}},t.prototype.getIntBodys=function(n,e){var i,p,r,a;return n instanceof t?(i=n.get_body(),r=n.get_worldCOM()):n instanceof l.phys.Body&&(i=n,r=n.get_position()),e instanceof t?(p=e.get_body(),a=e.get_worldCOM()):e instanceof l.phys.Body&&(p=e,a=e.get_position()),[i,p,r,a]},t.prototype.hitEnd=function(n){this.var_isbreaking=!1},t.prototype.bindJoint=function(n,e,i,t,l,p){this.intShape1=l,this.intShape2=p;if(l.connectCallback){if(l.connectCallback(e,t))return;this.connectFail=!0}if(p.connectCallback){if(p.connectCallback(n,i))return;this.connectFail=!0}var r=l.connectVec?i.add(l.connectVec):i,a=p.connectVec?t.add(p.connectVec):t;if(this.createdistanceJoint?(this.pivjoint=this.JointUtil.createDistanceJoint(n,e,r,a,0,15),this.pivjoint.set_stiff(!0),this.pivjoint.set_frequency(10)):this.pivjoint=this.JointUtil.createPivotJoint(n,e,r,a),this.space){this.space.get_userData().napeEngine.hockCtrol.addJointShape(this.pivjoint,this)}try{var s=n.userData.view.main;s&&s.dispatchEvent(s.constructor.HOCK_CHANGE,{bind:!0})}catch(o){}},t.prototype.dragToolClick=function(n){if(null==this.intShape1&&null==this.intShape2)return void(this.get_userData().bind&&this.get_userData().bind.dragToolClick());this.intShape1.breakClickCallback&&this.intShape1.breakClickCallback(this.connectFail),this.intShape2.breakClickCallback&&this.intShape2.breakClickCallback(this.connectFail),this.connectFail=!1,n||(this.get_userData().bind.var_isbreaking=!0,this.var_isbreaking=!0);var e;try{e=this.intShape1.get_body().userData.view.main}catch(i){}this.intShape1.get_userData().useing=!1,this.intShape2.get_userData().useing=!1,this.intShape1.get_userData().bind=null,this.intShape2.get_userData().bind=null,this.intShape1=null,this.intShape2=null,this.pivjoint&&(this.BodyUtil.destoryJoint(this.pivjoint),this.pivjoint=null),e&&e.dispatchEvent(e.constructor.HOCK_CHANGE,{bind:!1})},n.exports=t},782:function(n,e,i){"use strict";function t(n,e,i){l.shape.Polygon.call(this,n,e,i),Object.defineProperty(this,"density",{get:function(){return this.get_fluidProperties().get_density()},set:function(n){this.get_fluidProperties().set_density(n)}}),Object.defineProperty(this,"viscosity",{get:function(){return this.get_fluidProperties().get_viscosity()},set:function(n){this.get_fluidProperties().set_viscosity(n)}}),Object.defineProperty(this,"gravity",{get:function(){return this.get_fluidProperties().get_gravity()},set:function(n){this.get_fluidProperties().set_gravity(n)}}),this.initParams()}var l=i(467).nape;t.constructor=t,t.prototype=Object.create(l.shape.Polygon.prototype),t.prototype.initParams=function(){this.set_fluidEnabled(!0)},t.prototype.addCbtype=function(n){this.get_cbTypes().add(n)},n.exports=t},783:function(n,e,i){"use strict";function t(n,e,i,t){p.call(this,n,e,i,t),this.cbtype=new s,this.pourJoint=null,this.stime=0,this.pourToBody=null}var l=i(467).nape,p=i(521),r=i(640),a=i(784),s=l.callbacks.CbType,o=l.phys.BodyType,_=l.constraint.PivotJoint;t.constructor=t,t.prototype=Object.create(p.prototype),t.prototype.initInfo=function(n){},t.prototype.getPourToView=function(){return this.pourToBody?this.pourToBody.userData.view:null},t.prototype.adhesive=function(n){if(this.pourJoint)return!1;for(var e=this.get_worldCOM(),i=this.space.shapesInCircle(e,this.get_radius(),!1),t=null,l=0;l<i.get_length();l++){var p=i.at(l);if(p instanceof r){t=p;break}}if(t){var s=this.get_body();if(s.get_type()!=o.get_DYNAMIC())return!1;this.pourToBody=t.get_body();var h=t.get_worldCOM(),u=this.get_worldCOM(),x=h.sub(u),d=s.get_position(),v=d.add(x);return a.BodyTweenTo(s,.5,{x:v.get_x(),y:v.get_y(),onComplete:function(){var n=new _(s,this.space.get_world(),s.worldPointToLocal(h),h);n.set_ignore(!0),n.set_stiff(!0),n.set_damping(0),n.set_frequency(1e5),n.set_space(this.space),this.pourJoint=n}.bind(this)}),!0}return!1},t.prototype.disadhesive=function(){this.pourJoint&&(this.pourJoint.set_space(null),this.pourJoint=null),clearTimeout(this.stime),this.pourToBody=null},n.exports=t},784:function(n,e,i){"use strict";function t(){}var l=i(467).nape,p=l.geom.Vec2;t.BodyTweenTo=function(n,e,i){if(TweenMax){var t=n.get_position(),l={x:t.get_x(),y:t.get_y()};i.onUpdate=function(){n.set_position(p.get(l.x,l.y))},TweenMax.to(l,e,i)}},n.exports=t}});