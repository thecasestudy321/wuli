import{r as t,c as i,h as s,g as h}from"./p-05c16912.js";import{D as e}from"./p-e34c4f58.js";import"./p-ba1f185e.js";import{N as n}from"./p-d9f729d6.js";import"./p-e0dd32b5.js";import{g as o}from"./p-c07cb541.js";import"./p-69a83435.js";import"./p-a370223b.js";import{c as a,a as l,k as r}from"./p-ed44f497.js";function c(t,i){t.onload=function(){this.onerror=this.onload=null,i(null,t)},t.onerror=function(){this.onerror=this.onload=null,i(new Error("Failed to load "+this.src),t)}}function d(t,i){t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,i(null,t))}}var u=a((function(t,i){l(i,r(i),t)}));class p{constructor(t,i){this.pasteHandleProxy=this.pasteHandle.bind(this),this.dropHandleProxy=this.dropHandle.bind(this),this.editor=t,this.callBack=i}registListener(){window.FileReader?(this.editor.document.on("paste",this.pasteHandleProxy),this.editor.document.on("drop",this.dropHandleProxy)):console.warn("~~~ FileReader Not supported by your browser!")}unregistListener(){this.editor.document.removeListener("paste",this.pasteHandleProxy)}pasteHandle(t){const i=this.callBack,s=t.data.$.clipboardData.items;for(let h=0;h<s.length;++h){let t=s[h];if("file"==t.kind&&"image/png"==t.type){let s=t.getAsFile();if(!s)return!0;this.addBase64FromDataURL(s).success||i&&i({name:"IMG_SIZE_OUT_3M"})}}}dropHandle(t){const i=o(t,"data.$.dataTransfer.files[0]"),s=this.callBack;if(i)return this.checkIsImg(i.type)?void(this.addBase64FromDataURL(i).success||s&&s({name:"IMG_SIZE_OUT_3M"})):{success:!1,name:"NOT_IMG"}}addBase64FromDataURL(t){if(t.size>3145728)return{success:!1,name:"IMG_SIZE_OUT_3M"};if(!this.checkIsImg(t.type))return{success:!1,name:"NOT_IMG"};const i=this,s=new window.FileReader;return s.readAsDataURL(t),s.onload=function(){i.editor.insertHtml(`<img src="${this.result}"/>`)},{success:!0}}checkIsImg(t){return["image/png","image/jpeg","image/gif","image/bmp"].includes(t)}}const b=class{constructor(s){t(this,s),this.autohide=!0,this.isHide=!0,this.ckpath="ckeditor",this.mode=1,this.canResize=!0,this.canDrag=!0,this.closeVisible=!0,this.panelStyle={},this.hasInited=!1,this.tabMaxWidth=80,this.tabMinWidth=50,this.tabWidth=80,this.panelData={list:[],width:600,height:400},this.tabIndex=0,this.isOnScroll=!1,this.delayToMove=!1,this.temp_click_flag=-1,this.showInput=!1,this.isStartMovePanel=!1,this.CKEDITOR_NAME="CKEDITOR_"+n.M.getUniqueID(),this.showTimeid=null,this.inited=i(this,"inited",7),this.msgEvent=i(this,"msgEvent",7)}async moveToCenter(){const t=e.domQuerySelector(this.ele,"nb-panel"),i=document.body.clientWidth,s=document.body.clientHeight;t.moveToXY((i-this.panelData.width)/2,(s-this.panelData.height)/2)}async setData(t){if(!this.hasInited)return void console.warn("~~~还未初始化完成，setData() 调用失败！");const i=document.body.clientWidth,s=document.body.clientHeight;this.panelData=u({list:[{title:"目的",data:""},{title:"原理",data:""},{title:"器材",data:""},{title:"步骤",data:""},{title:"结论",data:""}],x:(i-600)/2,y:(s-400)/2,width:600,height:400},t),this.getPanelDom().setRect(this.panelData),this.restoreCurData(),setTimeout(()=>{this.freshView()},10)}async getData(){return this.saveCurData(),this.panelData}async switchMode(t){this.hasInited?this.mode!==t&&(1===this.mode&&this.saveCurData(),this.mode=t,this.init(),this.restoreCurData()):console.warn("~~~还未初始化完成，switchMode() 调用失败！")}async show(t=!1){t?this.panelStyle={display:"block",visibility:"hidden"}:(this.panelStyle={display:"block"},this.isHide=!1),this.showTimeid&&(clearTimeout(this.showTimeid),this.showTimeid=null),this.showTimeid=setTimeout(()=>{this.freshCKEditorRect(),t&&(this.moveToCenter(),this.panelStyle={display:"block"},this.isHide=!1)},10)}async hide(t=!0){this.showTimeid&&(clearTimeout(this.showTimeid),this.showTimeid=null),this.panelStyle={display:"none"},this.isHide=!0}detectChanges(){this.state=Math.random()}async freshView(){this.freshTabWidth(),this.freshCKEditorRect(),this.detectChanges()}saveCurData(){this.editor&&(this.panelData.list[this.tabIndex].data=this.editor.getData())}restoreCurData(){const t=this.panelData.list[this.tabIndex].data||"";if(1===this.mode){this.imageTool.unregistListener();const i=()=>{this.editor.resetUndo(),this.editor.removeListener("change",i)};this.editor.on("change",i),this.editor.setData(t),this.imageTool.registListener()}else $(this.getPlayerBoxDom()).empty(),$(this.getPlayerBoxDom()).append(t)}componentWillLoad(){this.autohide&&(this.panelStyle={display:"none"})}componentDidLoad(){this.init()}async init(){if(1===this.mode){if(!this.editor){await this.loadCKEditorFiles();try{if(this.editor=window.CKEDITOR.replace(this.CKEDITOR_NAME),!this.editor)return;window.editor=this.editor,this.imageTool=new p(this.editor,t=>{this.msgEvent.emit({target:this,name:t.name})}),this.editor.on("instanceReady",()=>{e.domQuerySelector(this.ele,".cke_toolbox_collapser").addEventListener("click",()=>{this.freshCKEditorRect()}),this.sendInited()})}catch(t){this.editor=null}}}else this.sendInited()}sendInited(){this.hasInited||(this.hasInited=!0,this.inited.emit({target:this}))}componentDidUnload(){this.editor&&(this.editor.destroy(),this.editor=null)}componentDidRender(){const t=this.isOnScroll?0:24,i=this.tabBoxWidth()<this.getULDom().clientWidth-t;this.isOnScroll!==i&&(this.isOnScroll=i,this.detectChanges()),this.delayToMove&&(this.delayToMove=!1,this.tabMove(3))}loadCKEditorFiles(){if(!window.__ckeditorjs_loaded)return new Promise(t=>{!function(t,i,s){var h=document.head||document.getElementsByTagName("head")[0],e=document.createElement("script");"function"==typeof i&&(s=i,i={}),s=s||function(){},e.type=(i=i||{}).type||"text/javascript",e.charset=i.charset||"utf8",e.async=!("async"in i&&!i.async),e.src=t,i.attrs&&function(t,i){for(var s in i)t.setAttribute(s,i[s])}(e,i.attrs),i.text&&(e.text=""+i.text),("onload"in e?c:d)(e,s),e.onload||c(e,s),h.appendChild(e)}(`${this.ckpath}/ckeditor.js`,()=>{window.__ckeditorjs_loaded=!0,t()})})}freshTabWidth(){let t=(this.panelData.width-40)/this.panelData.list.length;t=Math.min(this.tabMaxWidth,t),t=Math.max(this.tabMinWidth,t),this.tabWidth=t}freshCKEditorRect(){1===this.mode?this.editor&&this.editor.resize(this.panelData.width,this.panelData.height-40):$(this.getPlayerBoxDom()).css({width:`${this.panelData.width}px`,height:`${this.panelData.height-40}px`})}tabSeInd(t){null!==t&&this.tabIndex!==t&&(1===this.mode&&this.saveCurData(),this.tabIndex=t,this.detectChanges(),this.restoreCurData())}tabClickHandle(t){if(this.isStartMovePanel)return void(this.isStartMovePanel=!1);const i=o(t,"target.parentNode.value",null);if(null!==i&&this.tabIndex!==i)clearTimeout(this.temp_click_flag),this.temp_click_flag=-1,this.showInput=!1,this.tabSeInd(i);else{if(1!==this.mode)return;if(-1!==this.temp_click_flag)clearTimeout(this.temp_click_flag),this.temp_click_flag=-1,this.showInput=!0,window.$(".tab-text-input",this.getPanelDom())[this.tabIndex].value=this.panelData.list[this.tabIndex].title,setTimeout(()=>{window.$(".tab-text-input",this.getPanelDom())[this.tabIndex].focus()},10),this.detectChanges();else{const t=setTimeout(()=>{this.temp_click_flag=-1},300);this.temp_click_flag=t}}}tabDelHandle(t){const i=o(t,"target.parentNode.value",null);if(null!==i){if(1===this.panelData.list.length)return void console.log("~error: 至少保留一项");this.panelData.list.splice(i,1),this.tabIndex===this.panelData.list.length&&this.tabIndex--,this.freshView(),this.restoreCurData()}}sizeChangeHandle(t){this.panelData.width=t.detail.width,this.panelData.height=t.detail.height,this.freshView()}moveChangeHandle(t){this.isStartMovePanel=!0}dragEndHandler(t){this.isStartMovePanel=!1}tabAddHandle(t){this.panelData.list.push({title:"未命名"}),this.tabSeInd(this.panelData.list.length-1),this.freshView(),this.delayToMove=!0}getULBoxDom(){return e.domQuerySelector(this.ele,".editor-tabtool-ul-box")}getULDom(){return e.domQuerySelector(this.ele,".editor-tabtool-ul")}getPanelDom(){return e.domQuerySelector(this.ele,"nb-panel")}getPlayerBoxDom(){return e.domQuerySelector(this.ele,".ckplayer-box")}tabLeftHandle(t){this.tabMove(2)}tabRightHandle(t){this.tabMove(1)}tabMove(t){const i=this.getULBoxDom(),s=this.getULDom().clientWidth-i.clientWidth;let h;if(1===t)h=s-i.scrollLeft>this.tabWidth?i.scrollLeft+this.tabWidth:s;else if(2===t){const t=i.scrollLeft;h=0===t?0:t>this.tabWidth?i.scrollLeft-this.tabWidth:0}else h=s;h!==i.scrollLeft&&window.TweenMax.to(i,.3,{scrollLeft:h})}tabBoxWidth(){return this.panelData.width-50}getScrollShowCSS(t){return t?{display:1===this.mode&&this.isOnScroll?"block":"none"}:{display:1!==this.mode||this.isOnScroll?"none":"block"}}tabInputBlur(t){this.panelData.list[this.tabIndex].title=t.target.value,this.showInput=!1,this.detectChanges()}tabDown(t){this.canDrag&&(o(t,"target.parentNode.value",null)===this.tabIndex||this.getPanelDom().startDrag(t))}tabtoolOthersDownHandle(t){this.canDrag&&this.getPanelDom().startDrag(t)}addTabs(){return this.panelData?this.panelData.list.map((t,i)=>{const h=this.showInput&&this.tabIndex===i;return s("li",{class:"tab-li",style:{width:`${this.tabWidth}px`,"background-color":this.tabIndex===i?"#525963":"transparent",color:this.tabIndex===i?"#DFDFE0":"#C5CAD2"},value:i},s("input",{class:"tab-text-input",style:{display:h?"block":"none"},onBlur:t=>this.tabInputBlur(t)}),s("div",{class:"tab-text",style:{display:h?"none":"block"},onClick:t=>this.tabClickHandle(t)},t.title),s("div",{class:"tab-close-btn",style:{display:1!==this.mode||h||this.tabIndex!==i?"none":"block"},onClick:t=>this.tabDelHandle(t)}))}):""}addCkeditorDiv(){const t=1==this.mode;return s("div",{class:"editor-player-box"},s("div",{class:"ckeditor-box",style:{display:t?"block":"none"}},s("textarea",{name:this.CKEDITOR_NAME})),s("div",{class:"ckplayer-box",style:{display:t?"none":"block"}}))}render(){return s("nb-panel",{style:this.panelStyle,width:this.panelData.width,height:this.panelData.height,enableEdge:!0,canResize:this.canResize,closeVisible:this.closeVisible,onSizeChange:t=>this.sizeChangeHandle(t),onMoveChange:t=>this.moveChangeHandle(t),onMoveEnd:t=>this.dragEndHandler(t)},s("div",{slot:"panel-body"},s("div",{class:"editor-tabtool"},s("div",{class:"editor-se-tab-box",style:{width:`${this.tabBoxWidth()}px`}},s("div",{class:"tab-left-btn",style:this.getScrollShowCSS(!0),onClick:t=>this.tabLeftHandle(t)}),s("div",{class:"editor-tabtool-ul-box"},s("ul",{class:"editor-tabtool-ul"},this.addTabs(),s("li",{style:this.getScrollShowCSS(!1),onClick:t=>this.tabAddHandle(t)})),s("nb-touch-cell",{class:"editor-tabtool-others",onNbMouseDown:t=>this.tabtoolOthersDownHandle(t.detail)})),s("div",{class:"tab-right-btn",style:this.getScrollShowCSS(!0),onClick:t=>this.tabRightHandle(t)}),s("div",{class:"tab-add-btn",style:this.getScrollShowCSS(!0),onClick:t=>this.tabAddHandle(t)}))),this.addCkeditorDiv()))}get ele(){return h(this)}static get style(){return".add_def,nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li:last-child,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-add-btn,nb-text-panel .tab-add-btn-bg{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -179px;width:24px;height:24px}.add_hov{background-position:0 -324px}.add_hov,.add_pre{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:24px;height:24px}.add_pre{background-position:0 -208px}.close_hov,nb-text-panel .editor-tabtool .panel-close-btn:hover{background-position:0 -66px}.close_hov,.close_pre,nb-text-panel .editor-tabtool .panel-close-btn:active,nb-text-panel .editor-tabtool .panel-close-btn:hover{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:30px;height:23px}.close_pre,nb-text-panel .editor-tabtool .panel-close-btn:active{background-position:0 -94px}.colse_def,nb-text-panel .editor-tabtool .panel-close-btn{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -122px;width:30px;height:23px}.meau1_def{background-position:0 -481px}.meau1_def,.meau1_hov{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:50px;height:30px}.meau1_hov{background-position:0 -446px}.meau1_pre{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -411px;width:50px;height:30px}.nevigation_left_def,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-left-btn{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -237px;width:24px;height:24px}.nevigation_left_hov,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-left-btn:hover{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -266px;width:24px;height:24px}.nevigation_left_pre,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-left-btn:active{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -295px;width:24px;height:24px}.nevigation_right_def,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-right-btn{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -150px;width:24px;height:24px}.nevigation_right_hov,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-right-btn:hover{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -353px;width:24px;height:24px}.nevigation_right_pre,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-right-btn:active{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 -382px;width:24px;height:24px}.small_close_def,nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li .tab-close-btn{background-position:0 -44px}.small_close_def,.small_close_hov,nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li .tab-close-btn{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:17px;height:17px}.small_close_hov{background-position:0 -22px}.small_close_pre{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;background-position:0 0;width:17px;height:17px}.toolbar_left_def{background-position:0 -516px}.toolbar_left_def,.toolbar_left_hov{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:29px;height:32px}.toolbar_left_hov{background-position:0 -553px}.toolbar_left_pre{background-position:0 -590px}.toolbar_left_pre,.toolbar_right_def{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:29px;height:32px}.toolbar_right_def{background-position:0 -627px}.toolbar_right_hov{background-position:0 -664px}.toolbar_right_hov,.toolbar_right_pre{background-image:url(assets/imgs/nbk/nbk_nb-text-panel_sprite.png);background-size:50px 733px;background-repeat:no-repeat;width:29px;height:32px}.toolbar_right_pre{background-position:0 -701px}.setting-item-box-base{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;line-height:26px}.setting-item-right{width:120px;height:26px}.hover-blue-border,.hover-blue-input:focus,.hover-blue-input:hover{background-color:rgba(0,0,0,.1);border:1px solid rgba(35,133,233,.7)}.hover-blue-Btn{cursor:pointer;-webkit-transition:background .25s,color .25s;transition:background .25s,color .25s;background:hsla(0,0%,100%,.1);outline:0;border:none;border-radius:4px;color:#a5a5a5;font-size:12px;white-space:nowrap}.hover-blue-Btn:hover{background-color:rgba(35,133,233,.7);color:#fff}.hover-blue-Btn:active{background-color:#2385e9;color:#fff}.hover-blue-input{color:#f1f1f1;background-color:rgba(0,0,0,.1);border-radius:4px;text-align:center;outline:0;-webkit-transition:border-color .25s,background-color .25s;transition:border-color .25s,background-color .25s;border:1px solid hsla(0,0%,100%,.1);width:100%;height:100%;padding:0}.mac-scroll::-webkit-scrollbar,nb-text-panel .editor-player-box .ckplayer-box::-webkit-scrollbar{width:5px;height:5px}.mac-scroll::-webkit-scrollbar-thumb,nb-text-panel .editor-player-box .ckplayer-box::-webkit-scrollbar-thumb{border-radius:1em;background-color:rgba(50,50,50,.3)}.mac-scroll::-webkit-scrollbar-track,nb-text-panel .editor-player-box .ckplayer-box::-webkit-scrollbar-track{border-radius:1em;background-color:rgba(50,50,50,.1)}nb-text-panel .editor-alpha{position:absolute;width:100%;height:100%;opacity:0}nb-text-panel .editor-tabtool{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}nb-text-panel .editor-tabtool .editor-se-tab-box{display:-ms-inline-flexbox;display:inline-flex}nb-text-panel .editor-tabtool .editor-se-tab-box .tab-left-btn,nb-text-panel .editor-tabtool .editor-se-tab-box .tab-right-btn{margin-top:6px}nb-text-panel .editor-tabtool .editor-se-tab-box .tab-add-btn{margin-top:8px}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box{display:-ms-inline-flexbox;display:inline-flex;overflow:hidden;width:100%}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul{display:-ms-inline-flexbox;display:inline-flex;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0;-webkit-padding-start:0;padding-inline-start:0}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li{list-style:none;height:40px;cursor:pointer;display:-ms-inline-flexbox;display:inline-flex}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li:first-child{border-top-left-radius:8px}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li:last-child{margin-top:8px}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li .tab-text-input{font-size:12px;width:100%;height:80%;margin-top:1px;display:none;background:transparent;border:none;height:40px;outline:none}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li .tab-text{text-align:center;line-height:38px;font-size:12px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:70%;height:100%;overflow:hidden}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-ul li .tab-close-btn{margin-top:11.5px}nb-text-panel .editor-tabtool .editor-se-tab-box .editor-tabtool-ul-box .editor-tabtool-others{height:40px;width:100%}nb-text-panel .editor-tabtool .panel-close-btn{margin-top:8.5px;margin-left:auto;margin-right:10px}nb-text-panel .editor-player-box .ckeditor-box{display:block;width:100%;background-color:#bc8f8f;border-bottom-left-radius:8px;border-bottom-right-radius:8px;overflow:hidden}nb-text-panel .editor-player-box .ckeditor-box .cke_1{border:none}nb-text-panel .editor-player-box .ckeditor-box .cke_top{background:#525963;border:none;box-shadow:none;-webkit-box-shadow:none}nb-text-panel .editor-player-box .ckeditor-box .cke_combo_button,nb-text-panel .editor-player-box .ckeditor-box .cke_toolgroup{border:none;box-shadow:none;-webkit-box-shadow:none;background:transparent}nb-text-panel .editor-player-box .ckplayer-box{display:block;width:100%;overflow:scroll;background-color:#fff}nb-text-panel .ckeditor_file_select{display:none}.cke_combo_text{width:auto!important}"}};export{b as nb_text_panel};