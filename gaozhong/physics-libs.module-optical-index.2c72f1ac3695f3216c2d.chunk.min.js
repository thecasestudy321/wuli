/*!
 * Copyright (c) 2017 Nobook inc.
 * 
 * (TBD)
 * 
 * Version: 0.6.57
 * Date: Mon Apr 27 2020 08:22:33 GMT+0800 (CST)
 */
webpackJsonpPhysicsCanvas([2],{1107:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){var i=[],n=!0,o=!1,r=undefined;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(h){o=!0,r=h}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function L(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:L(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},u=i(1),c=i(76),d=i(458),f=n(d),p=i(542),y=n(p),g=i(558),v=n(g),_=i(557),b=n(_),m=i(227),w=n(m),O=i(540),x=n(O),P=i(573),S=n(P),k=i(574),T=n(k),M=i(516),C=n(M),E=i(575),I=n(E),D=i(577),B=n(D),j=i(622),R=n(j);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.napeEngine=null,i.moduleType=2,i.isactive=!0,i}return a(e,t),h(e,[{key:"init",value:function(){var t=this;return this.hasInit?Promise.resolve():(l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),new Promise(function(e,i){t.injectClass();var n=new v["default"](t.config,t);t.napeEngine=n,n.init(),t.config.UploadSkinTool.load(t.main,["mechanics/mechSkin"],function(){e()})}))}},{key:"requestAnimationLoop",value:function(){this.napeEngine&&this.napeEngine.viewSync.update()}},{key:"unInjectClass",value:function(){this.BodyUtil.dispose(),this.JointUtil.dispose(),this.RayUtil.dispose(),this.OpticalUtil.dispose()}},{key:"injectClass",value:function(){this.NapeConst=new b["default"],this.ToolStatusStr=new w["default"],this.CbTypeStr=new x["default"](this.config.main.phy.nape),this.BodyUtil=new S["default"](this.config),this.Vec2Util=new C["default"](this.config.main.phy.nape),this.JointUtil=new T["default"](this.config.main.phy.nape),this.InteractionFilterManager=new y["default"](this.BodyUtil),this.NBOpticsStr=new B["default"](this.InteractionFilterManager),this.RayUtil=new I["default"](this.config),this.OpticalUtil=new R["default"](this)}},{key:"onRemoveEquipment",value:function(){}},{key:"hideFloor",value:function(t){}},{key:"setActive",value:function(t,i){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),i&&t&&this.moveGlobalView(),this.napeEngine.setActive(t),this.hideFloor(!0)}},{key:"moveGlobalView",value:function(){var t=arguments.length>0&&arguments[0]!==undefined&&arguments[0],e=this.main.view,i=this.main.W/u.M.getNumStr(this.globalConfig.canvasWidth),n=.5*i;e.x=0,e.y=0,e.scale.x=n,e.scale.y=n;var o=this.main.getWindowDoorSize(),r=s(o,2),a=r[0],h=r[1];a*=.5,e.x=a*i;var l=s(this.napeEngine.floorDat,2),c=l[0],d=this.main.H/u.M.getNumStr(this.globalConfig.canvasHeight),f=h-50;f*=d,e.y=t?-c*n/2:-(c*n-f)}},{key:"enterModule",value:function(t){return this.napeEngine.floor.setVisible(!!t),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"enterModule",this).call(this,t)}},{key:"destroy",value:function(){this.napeEngine.dispose(),this.unInjectClass(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}}],[{key:"MODULE_TYPE",get:function(){return c.Modules.OPTICAL}}]),e}(f["default"])},1108:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0,g=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,g=p.geom.Vec2,i.vo=new f["default"](!0,!1,1),i.openNei=!1,i.fivo=null,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.rootData&&(this.elecLable=this.rootData.name),this.createShape(),this.body.userData.nolight=!0,this.addOneRoteShape(0,-160,35),this.addOneRoteShape(0,160,35)}},{key:"createShape",value:function(){for(var t=this,e=31.31*Math.cos(Math.PI/4),i=[],n=Math.floor(7.5),o=0;15>o;o++)i.push(o%2==0?{x:-14,y:(o-n)*e}:{x:-14+e,y:(o-n)*e});i.push({x:-14+e+5,y:(15-n-1)*e}),i.push({x:-14+e+5,y:(0-n)*e});var r=this.BodyUtil.createIrregularShape(i);r.get_length()>0&&(this.body.get_shapes().clear(),r.foreach(function(e){var i=new y(e);i.set_filter(t.NBOpticsStr.NO_HIT_FILTERS),i.get_userData().vo=t.vo,i.get_userData().lightStop=!0,t.body.add(i)}));var a=new y(y.box(36,338));this.body.add(a),a.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS);var s=new y(y.box(20,338));this.body.add(s),s.set_sensorEnabled(!0),s.translate(g.get(20,0)),this.createfilterShape()}},{key:"createfilterShape",value:function(){var t={};t.r=750,t.rh=335,t.leftTop=[-13,-164],t.precision=100;var e=t.r,i=t.rh,n=new l.Point(t.leftTop[0],t.leftTop[1]),o=Math.asin(.5*i/e),r=Math.cos(o)*e,a=new l.Point(n.x+r,n.y+.5*i),s=Math.PI-o,h=t.precision,u=2*o/h,c=s;this.vo.n=t.n;var d=[],y=0;for(y=0;h>y;y++){var v=a.x+Math.cos(c)*e,_=a.y+Math.sin(c)*e;d.push(new g(v,_)),c+=u}var b=new p.shape.Polygon(d);this.body.add(b),b.set_filter(this.NBOpticsStr.NO_HIT_FILTERS);var m=new f["default"](!1,!0,1);m.sensor=!0,m.sensorObj.hideLight=!0,m.sensorObj.checkfilter=!0,m.var_open_angle=!1,m.var_show_reflect=!1,m.var_show_direction=!1,b.get_userData().vo=m,b.get_userData().lightStop=!0,this.fivo=m}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.opennei=this.openNei,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.opennei&&this.change_nei({checked:t.opennei})}},{key:"change_nei",value:function(t){this.openNei=t.checked,this.openNei?(this.bg.gotoAndStop(1),this.fivo.sensorObj.hideLight=!1):(this.bg.gotoAndStop(0),this.fivo.sensorObj.hideLight=!0)}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(this.ComponentProperty.getSwitch(this.language.getLocaleStr("internal_structure"),this.openNei,this.change_nei,this)),t}}]),e}(c["default"])},1109:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function m(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:m(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0,_=void 0,b=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,g=p.geom.Vec2,v=p.NbBody,_=p.phys.BodyType,b=p.geom.Ray,i.canRotate=!1,i.lamdas={1.513:660,1.537:580,1.549:550,1.579:410},i.rect=new l.Rectangle(-185,-10,370,100),i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.bg.x=.5*-this.bg.width,this.bg.y=.5*-this.bg.height,this.body.shapes.clear(),this.initShape()}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this)}},{key:"removed",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"initShape",value:function(){var t=new y(y.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height));this.body.add(t),t.get_userData().vo=this.createVo(),this.shap=t;var e=new y(y.box(370,200));e.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.body.add(e),this.movedShape=new y(y.box(10,2)),this.voArr=[this.createVo(),this.createVo()],this.voArr[0].n+=.01,this.voArr[1].n+=.02,this.voId=0,this.shapeFrom=new y(y.box(10,2)),this.shapeFrom.get_userData().vo=this.createVo()}},{key:"createVo",value:function(){var t=new f["default"](!1,!0,this.getNByP(0,0));return t.var_open_angle=!1,t.var_show_reflect=!1,t.var_show_direction=!1,t}},{key:"getMovedVo",value:function(){return this.voId=(this.voId+1)%2,this.voArr[this.voId]}},{key:"getNByP",value:function(t,e){return 1.5*(1.5-.002*(100-e))}},{key:"handleLight",value:function(t,e,i,n){if(t.zsNbRay){var o=t.zsNbRay.startP;if(o=this.toLocal(o,this.main.view),this.rect.contains(o.x,o.y)){for(var r=[],a=t.zsNbRay.dir,s=o,h=new l.Point(s.x-a.x,s.y-a.y),u=this.getNByP(s.x,s.y),c=a.x/a.length,d=u*c,f=new l.Point(0,1),p=0,y=!1;;){r.push(this.toGlobalView(s,this));var v=this.getNByP(s.x,s.y),_=d/v;f.y=s.y>h.y?1:-1;var m=void 0,w=void 0,O=void 0;if(1<Math.abs(_)){w=s.x-h.x,O=-(s.y-h.y);d=v*w/new l.Point(w,O).length}else m=f.y*Math.sqrt(1-_*_),w=5*_,O=5*m;if(h.x=s.x,h.y=s.y,s.x+=w,s.y+=O,!this.rect.contains(s.x,s.y)){y&&r.push(this.toGlobalView(s,this));break}if(y=!0,++p>1e3)break}if(y){var x=this.toGlobalView(s,this),P=this.toGlobalView(h,this);t.zsNbRay.setRay(new b(g.get(x.x,x.y),g.get(x.x-P.x,x.y-P.y))),t.zsNbRay.path=r,t.zsNbRay.from=this.shapeFrom;var S=this.getMovedVo();S.n=this.getNByP(0,h.y),this.shapeFrom.get_userData().vo=S}}}}},{key:"getDynN",value:function(t,e,i){var n=t.n;n=1.3+.3*this.body.worldPointToLocal(e).get_y()/100;var o=n,r=this.lamdas[i]/1e3;if(.66!==r){var a=1/r,s=a*a;o=n+.0712*(1/.66*(1/.66)-s)+-.0064*(s*s-5.270165550656409)}return o}},{key:"getDir",value:function(){var t=new g(0,0),e=new g(0,1);return this.body.localPointToWorld(t).sub(this.body.localPointToWorld(e))}}]),e}(c["default"])},1110:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.shape.Polygon,y=f.geom.Vec2,i.NBOpticsStr=t.moduleMain.NBOpticsStr,i.vo=new d["default"](!0,!0,1.5),i.vo.var_whiteNotReflect=!0,i.canRotate=!1,i.unitd=8.5,i.depth=15,i.shap=null,i.water=new PIXI.Graphics,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear(),this.shap=new p(p.rect(.5*-this.bg.width+8,-15,370,this.depth*this.unitd)),this.shap.get_userData().vo=this.vo,this.body.add(this.shap),this.shap.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),this.addChildAt(this.water,0);var t=new p(p.box(370,206));t.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.body.add(t),this.refreshPolygon()}},{key:"refreshPolygon",value:function(){var t=this.shap.get_localCOM(),e=this.shap.get_bounds(),i=e.get_height(),n=this.depth*this.unitd;this.shap.scale(1,n/i);var o=87-n/2;this.shap.set_localCOM(y.get(t.get_x(),o)),this.water.clear(),this.water.beginFill(0,.2),this.water.drawRect(-e.get_width()/2,87-n,e.get_width(),n),this.water.endFill()}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.depth=this.depth,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),isNaN(t.depth)||this.changeSp({showValue:t.depth})}},{key:"getSp",value:function(){return this.depth}},{key:"changeSp",value:function(t){var e=t.showValue-0;0===e&&(e=.001),this.depth=e,this.refreshPolygon()}},{key:"getConf",value:function(){var t={};t.confArr=[];var e=this.getSp();return.01>e&&(e=0),t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("water_level"),!0,"cm",20,0,e,1,this.changeSp,this)),t}}]),e}(u["default"])},1111:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(226),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.maxNum=20,i.num=1,i.color=4278190080,i.waterGra=new PIXI.Graphics,i}return r(e,t),a(e,[{key:"added",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this),this.arr=[{dropper:this.dropperRed,color:4294902015,num:this.maxNum,num2:this.maxNum,texture:PIXI.Texture.fromFrame("ColorPalette/dropRed.png")},{dropper:this.dropperYellow,color:4294967040,num:this.maxNum,num2:this.maxNum,texture:PIXI.Texture.fromFrame("ColorPalette/dropYellow.png")},{dropper:this.dropperBlue,color:4278255615,num:this.maxNum,num2:this.maxNum,texture:PIXI.Texture.fromFrame("ColorPalette/dropBlue.png")}];for(var t=0;this.arr.length>t;t++){this.initDropper(this.arr[t].dropper,t)}this.water.removeChildren(),this.water.addChild(this.waterGra),this.updateColor(4293848814);var i=new PIXI.filters.BlurFilter;i.blur=15,this.water.x-=10,this.water.filters=[i],this.resetBtn.fontColor="#ffffff",this.resetBtn.text=this.language.getLocaleStr("reset"),this.resetBtn.tab=this.resetClick,this.resetBtn["this"]=this,this.addCursor(this.resetBtn,"hand")}},{key:"removed",value:function(){this.removedCursor(this.resetBtn,"hand"),this.resetBtn.destroy();for(var t=0;this.arr.length>t;t++){var i=this.arr[t].dropper;this.addCursor(i.head,"hand"),h.M.removeTouch(i.head,i.head.touchId)}s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"updateMask",value:function(t,e){var i=160*e/this.maxNum;t.clear(),t.beginFill(0,.5),t.drawRect(0,200-i,40,i),t.endFill()}},{key:"updateColor",value:function(t){this.waterGra.clear(),this.waterGra.beginFill(t,1),this.waterGra.drawEllipse(0,0,70,30),this.waterGra.endFill()}},{key:"initDropper",value:function(t,e){var i=this;this.addCursor(t.head,"hand");var n=new PIXI.Graphics;t.addChild(n),t.liquid.mask=n,this.updateMask(n,this.maxNum),t.liquid.gotoAndStop(e),t.drop.gotoAndStop(0),t.drop.visible=!1,t.head.touchId=h.M.addTouch(t.head,{begin:function(n){t.head.gotoAndStop(1),i.addColor(e)},end:function(e){t.head.gotoAndStop(0)}},this)}},{key:"addColor",value:function(t){var e=this,i=this.arr[t];if(i.num>0){i.num--;this.updateMask(i.dropper.liquid.mask,i.num);var n=new PIXI.Sprite(i.texture);i.dropper.addChild(n),n.y=200,n.x=16,TweenLite.to(n,1,{ease:Power2.easeIn,y:270,onComplete:function(){n.parent.removeChild(n),i.num2--,e.addC(i.color),e.updateColor(e.color)}})}}},{key:"addC",value:function(t){this.num++;for(var e=255,i=255,n=255,o=0;this.arr.length>o;o++){var r=this.arr[o],a=r.color,s=this.maxNum-r.num2;if(s>0){var h=a>>16&255,l=a>>8&255,u=255&a,c=s/this.maxNum;c=.1+.9*c,h=255*(1-c)+h*c,l=255*(1-c)+l*c,u=255*(1-c)+u*c,e=e*h/255,i=i*l/255,n=n*u/255}}this.color=e<<16|i<<8|n}},{key:"resetClick",value:function(){this.num=1;for(var t=0;this.arr.length>t;t++){var e=this.arr[t];e.num=this.maxNum,e.num2=this.maxNum,this.updateMask(e.dropper.liquid.mask,this.maxNum)}this.color=0,this.updateColor(4293848814)}}]),e}(u["default"])},1112:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(226),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.r=150,i.redSp=new PIXI.Graphics,i.greenSp=new PIXI.Graphics,i.blueSp=new PIXI.Graphics,i.isDown=!1,i.noRenderSelected=!0,i}return r(e,t),a(e,[{key:"added",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this),this.removeChild(this.componentBox),this.removeChild(this.bg),this.cannotSystemDrag=!0,this.addChild(this.redSp),this.addChild(this.greenSp),this.addChild(this.blueSp),this.initShape(this.redSp,16711680),this.initShape(this.greenSp,65280),this.initShape(this.blueSp,255);var t=.6*Math.cos(Math.PI/6)*this.r,i=.6*Math.sin(Math.PI/6)*this.r;this.redSp.y=.6*-this.r,this.greenSp.x=-t,this.greenSp.y=i,this.blueSp.x=t,this.blueSp.y=i}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.data={},t.data.red={x:this.redSp.x,y:this.redSp.y},t.data.green={x:this.greenSp.x,y:this.greenSp.y},t.data.blue={x:this.blueSp.x,y:this.blueSp.y},t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.data&&(this.redSp.x=t.data.red.x,this.redSp.y=t.data.red.y,this.greenSp.x=t.data.green.x,this.greenSp.y=t.data.green.y,this.blueSp.x=t.data.blue.x,this.blueSp.y=t.data.blue.y)}},{key:"initShape",value:function(t,e){t.beginFill(e,1),t.drawCircle(0,0,this.r),t.endFill(),t.blendMode=PIXI.BLEND_MODES.SCREEN,t._this=this,t.addEventListener(TouchEvent.TOUCH_BEGIN,this.touchManager)}},{key:"touchManager",value:function(t){var e=t.target,i=this._this;if(e==i.redSp||e==i.greenSp||e==i.blueSp)if(h.M.touchIsType(t.type,TouchEvent.TOUCH_BEGIN))i.addChild(e),i.isDown=!0,i.oldP=i.getMouseXY(t),e.addEventListener(TouchEvent.TOUCH_MOVE,i.touchManager),e.addEventListener(TouchEvent.TOUCH_END,i.touchManager),e.addEventListener(TouchEvent.TOUCH_END_OUTSIDE,i.touchManager);else if(h.M.touchIsType(t.type,TouchEvent.TOUCH_MOVE)){if(!i.isDown)return;var n=i.getMouseXY(t);e.x+=n.x-i.oldP.x,e.y+=n.y-i.oldP.y,i.oldP=n}else(h.M.touchIsType(t.type,TouchEvent.TOUCH_END)||h.M.touchIsType(t.type,TouchEvent.TOUCH_END_OUTSIDE))&&(i.isDown=!1,e.removeEventListener(TouchEvent.TOUCH_MOVE,i.touchManager),e.removeEventListener(TouchEvent.TOUCH_END,i.touchManager),e.removeEventListener(TouchEvent.TOUCH_END_OUTSIDE,i.touchManager))}}]),e}(u["default"])},1113:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(493),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.openZgz=!1,i.centerP=new PIXI.Graphics,i.centerZhou=new PIXI.Graphics,i.translateRect={width:80,height:236},i.concavePolygon=!0,i.vo.bodyIsMultiShape=!0,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addChild(this.centerZhou),this.addChild(this.centerP),this.drawLine(),this.change_zgz({checked:this.openZgz})}},{key:"drawSkinFun",value:function(){var t=(arguments.length>0&&undefined,Math.PI/90),e=0,i=this.translateRect.width/2,n=this.translateRect.height/2,o=[],r=null;this.currImg.clear(),this.currImg.lineStyle(0,16777215,0),this.currImg.beginFill(16777215,.3);var a={x:-i,y:0},s={x:i,y:0},h=void 0,l=.7*i,u=n;for(e=-Math.PI/2+10*t,h=0;70>=h;h++){var c=a.x+Math.cos(e)*l,d=Math.sin(e)*u;o.push({x:c,y:d}),e+=t,r?this.currImg.lineTo(c,d):(r={x:c,y:d},this.currImg.moveTo(c,d))}for(e=Math.PI/2+10*t,h=0;70>=h;h++){var f=s.x+Math.cos(e)*l,p=Math.sin(e)*u;o.push({x:f,y:p}),e+=t,this.currImg.lineTo(f,p)}return this.points=o,o}},{key:"drawLine",value:function(){this.centerP.beginFill(16711680),this.centerP.drawCircle(0,0,5),this.centerP.endFill();this.centerZhou.lineStyle(3,16777215),h.M.drawDashed(this.centerZhou,new h.Point(-600,0),new h.Point(600,0),10,10),this.centerZhou.y=1.5,this.centerP.y=1.5}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.zgz=this.openZgz,t}},{key:"setData",value:function(t){this.openZgz=t.zgz,this.change_zgz({checked:this.openZgz}),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t)}},{key:"change_zgz",value:function(t){this.openZgz=t.checked,this.centerZhou.visible=this.openZgz,this.centerP.visible=this.openZgz,this.openZgz&&(this.centerZhou.rotation=this.translateRect.width>this.translateRect.height?Math.PI/2:0)}},{key:"getConf",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(this.ComponentProperty.getSwitch(this.language.getLocaleStr("main_beam_axis"),this.openZgz,this.change_zgz,this)),t}}]),e}(u["default"])},1114:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.geom.Vec2,y=f.shape.Polygon,i.vo=new d["default"](!0,!1),i}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addCbType(this.CbTypeStr.ONEPART_GLASS),this.bg.x=.5*-this.bg.width,this.bg.y=.5*-this.bg.height,this.body.shapes.clear(),this.func_createGlass(null,280,15,150,15),this.func_createGlass(this.vo,280,5,150,10);var t=new y(y.rect(.5*-this.bg.width,-50,this.bg.width,100));this.body.add(t),this.setShapeInterFliter(t),t.set_sensorEnabled(!0),this.addOneRoteShape(-160,-30,35),this.addOneRoteShape(160,-30,35)}},{key:"func_createGlass",value:function(t,e,i,n,o){var r=this,a=[],s=e,h=void 0,l=void 0,u=0;for(u=-n;n>=u;u+=2)h=Math.acos(u/s),l=Math.sin(h)*s,a.push(new p(u,l-s+o));for(u=n;u>=-n;u-=2)h=Math.acos(u/s),l=Math.sin(h)*s,a.push(new p(u,l-s+i+o));a.push(p.get(a[0].get_x(),a[0].get_y())),new f.geom.GeomPoly(a).convexDecomposition().foreach(function(e){var i=new y(e);i.get_userData().vo=t,r.body.add(i),i.set_filter(r.NBOpticsStr.NO_HIT_FILTERS)})}}]),e}(u["default"])},1115:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(493),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.openZgz=!1,i.centerP=new PIXI.Graphics,i.centerZhou=new PIXI.Graphics,i.translateRect={width:66,height:236,rot:0},i.openxz=!1,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addChild(this.centerZhou),this.addChild(this.centerP),this.drawLine(),this.changeZgz({checked:this.openZgz})}},{key:"drawSkinFun",value:function(){var t=(arguments.length>0&&undefined,Math.PI/180),e=0,i=this.translateRect.width/2,n=this.translateRect.height/2,o=[],r=null;this.currImg.clear(),this.currImg.lineStyle(0,16777215,0),this.currImg.beginFill(16777215,.3);for(var a=0;360>a;a++){var s=Math.cos(e)*i,h=Math.sin(e)*n;o.push({x:s,y:h}),e+=t,r?this.currImg.lineTo(s,h):(r={x:s,y:h},this.currImg.moveTo(s,h))}return this.currImg.lineTo(r.x,r.y),this.points=o,o}},{key:"drawLine",value:function(){this.centerP.beginFill(16711680),this.centerP.drawCircle(0,0,5),this.centerP.endFill();this.centerZhou.lineStyle(3,16777215),h.M.drawDashed(this.centerZhou,new h.Point(-600,0),new h.Point(600,0),10,10),this.centerZhou.y=2,this.centerP.y=2}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.zgz=this.openZgz,t}},{key:"setData",value:function(t){this.openZgz=t.zgz,this.changeZgz({checked:this.openZgz}),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t)}},{key:"changeZgz",value:function(t){this.openZgz=t.checked,this.centerZhou.visible=this.openZgz,this.centerP.visible=this.openZgz,this.openZgz&&(this.centerZhou.rotation=this.translateRect.width>this.translateRect.height?Math.PI/2:0)}},{key:"showXz",value:function(t){this.showScaleTool(t.checked)}},{key:"getConf",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(this.getSwitch([this.getLocaleStr("main_beam_axis","主光轴"),this.openZgz,this.changeZgz,this])),t}}]),e}(u["default"])},1116:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.geom.Vec2,y=f.shape.Polygon,i.vo=new d["default"](!0,!1),i}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addCbType(this.CbTypeStr.ONEPART_GLASS),this.bg.x=.5*-this.bg.width,this.bg.y=.5*-this.bg.height,this.body.shapesAt(0).get_userData().vo=this.vo,this.body.shapes.clear(),this.func_createGlass(this.vo,350,5,160,15),this.func_createGlass(null,350,15,160,0);var t=new y(y.rect(.5*-this.bg.width,-50,this.bg.width,100));this.body.add(t),this.setShapeInterFliter(t),t.set_sensorEnabled(!0),this.addOneRoteShape(-160,30,35),this.addOneRoteShape(160,30,35)}},{key:"func_createGlass",value:function(t,e,i,n,o){var r=this,a=[],s=e,h=void 0,l=void 0,u=0;for(u=-n;n>=u;u+=2)h=Math.acos(u/s),l=Math.sin(h)*s,a.push(new p(u,-(l-s+o)));for(u=n;u>=-n;u-=2)h=Math.acos(u/s),l=Math.sin(h)*s,a.push(new p(u,-(l-s+i+o)));a.push(p.get(a[0].get_x(),a[0].get_y())),new f.geom.GeomPoly(a).convexDecomposition().foreach(function(e){var i=new y(e);i.get_userData().vo=t,r.body.add(i),i.set_filter(r.NBOpticsStr.NO_HIT_FILTERS)})}}]),e}(u["default"])},1117:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:d(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(680),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=i.ComponentProperty,i.className="DiffractionGrating",i.type=e.TRANSMISSION,i.m=100,i.n=100,i.d=1/i.n*.001,i.a=i.d/2,i.L=1,i.xScale=6,i.startAngle=0,i.cache=[],i.WIDTH=2600,i.HEIGHT=1,i.IMG_DATA_LEN=i.WIDTH*i.HEIGHT*4,i.delay=0,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.sceen.difImageCon.addChild(this.difImg),this.difImg.x=0,this.difImg.y=0,this.difImg.scale.y=260,this.selfRender()}},{key:"getI0",value:function(t,e,i,n){i*=1e-9;var o=this.px2m(t-this.WIDTH/2)*this.xScale,r=Math.atan2(o,this.L);r=this.startAngle*Math.PI/180+r;var a=Math.sin(r),s=Math.PI*this.a/i*a,h=Math.PI*this.d/i*a,l=void 0;l=0===s?1:Math.sin(s)/s;var u=Math.sin(h),c=Math.sin(this.m*h),d=void 0;d=0===u&&0===c?this.m:c/u;var f=l*l*d*d;return f*=f}},{key:"changeStartAngle",value:function(t){this.startAngle=t.showValue,this.dataChangFlag=!0,this.delayRender()}},{key:"changeN",value:function(t){this.n=t.showValue,this.d=1/this.n*.001,this.dataChangFlag=!0,this.delayRender()}},{key:"changeM",value:function(t){this.m=t.showValue,this.dataChangFlag=!0,this.delayRender()}},{key:"getConf",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(u.getScrollBar("旋转望远镜",!1,"度",-90,90,this.toFixed(this.startAngle,2),1,this.changeStartAngle,this),u.getScrollBar("每毫米狭缝数",!0,"",200,1,this.n,1,this.changeN,this),u.getScrollBar("狭缝数",!0,"",1e4,1,this.m,1,this.changeM,this)),t}}]),e}(l["default"]);c.REFLECTION=1,c.TRANSMISSION=2,e["default"]=c},1118:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0,g=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.shape.Polygon,y=f.shape.Circle,g=f.geom.Vec2,i.vo=new d["default"](!0,!1,1),i.glass=null,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.createShape()}},{key:"createShape",value:function(){var t=this;this.body.get_shapes().clear(),this.glass=new p(p.box(300,25)),this.body.add(this.glass),this.glass.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),this.glass.translate(g.get(0,9));var e='[{"type":"box","rot":5.142560491773927,"transx":-150},{"type":"box","rot":3.4696640178391247,"transx":-136},{"type":"circle","rot":5.321930768952742,"transx":-122},{"type":"box","rot":2.387724679189843,"transx":-108},{"type":"box","rot":1.6085781098376928,"transx":-94},{"type":"box","rot":4.723677807944025,"transx":-80},{"type":"circle","rot":1.4580321334942499,"transx":-66},{"type":"box","rot":6.174577899584561,"transx":-52},{"type":"box","rot":5.9704520212974455,"transx":-38},{"type":"box","rot":1.147153498282471,"transx":-24},{"type":"box","rot":1.6882803778029987,"transx":-10},{"type":"box","rot":4.119634312622484,"transx":4},{"type":"box","rot":3.9538776111845326,"transx":18},{"type":"box","rot":4.941876346693581,"transx":32},{"type":"box","rot":3.855956110986525,"transx":46},{"type":"box","rot":1.1515205523882037,"transx":60},{"type":"circle","rot":3.3790390003341195,"transx":74},{"type":"box","rot":1.3689915921349287,"transx":88},{"type":"circle","rot":2.984706830937713,"transx":102},{"type":"circle","rot":5.147506798873448,"transx":116},{"type":"box","rot":4.047111316240266,"transx":130},{"type":"box","rot":5.263776709865726,"transx":144},{"type":"circle","rot":5.635213716567414,"transx":158}]';e=JSON.parse(e),e.map(function(e){var i=void 0;"box"==e.type?i=new p(p.box(16,16)):"circle"==e.type&&(i=new y(8)),t.body.add(i),i.set_filter(t.NBOpticsStr.NO_HIT_FILTERS),i.get_userData().vo=t.vo,i.get_userData().isdiffuse=!0,i.rotate(e.rot),i.translate(g.get(e.transx,0))});var i=new p(p.box(300,50));this.body.add(i),i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addOneRoteShape(-150,0,35),this.addOneRoteShape(150,0,35)}}]),e}(u["default"])},1119:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(1130),f=n(d),p=i(1128),y=n(p);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.canRotate=!1,i.micro=null,i._sf=null,i._lv=null,i.wenCon=new PIXI.Sprite,i.var_wen=new PIXI.Sprite,i.var_wenArr=[],i.d=.8,i.l=.5,i.λ=700,i.sc=10,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;this._width=this.bg.width,this._height=200,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.createTip(),this.body.set_sensorEnabled_at(0,!0),this.initLvSp(),this.initSf(),this.initWen();var i=this.body.get_shapes().at(0);this.setShapeInterFliter(i),i.set_sensorEnabled(!0),this.micro.addEventListener("rollChange",function(){t.upWendata()}),this.componentBox.visible=!1,this.addCursor(this._lv,"hand"),this.addCursor(this._sf,"hand"),this.addCursor(this.micro.roller,"shangxia")}},{key:"wenFrames",value:function(){var t=[],e=void 0;for(e=1;6>e;e++){var i="DoubleSlitExp/line"+e+".png";t.push(PIXI.Texture.fromFrame(i))}return t}},{key:"initWen",value:function(){this.removeChild(this.wen),this.addChild(this.wenCon),this.wenCon.x=this.wenhou.x,this.wenCon.y=this.wenhou.y,this.wenCon.addChild(this.wenhou),this.wenCon.addChild(this.var_wen),this.wenCon.addChild(this.wenq),this.wenhou.x=this.wenhou.y=this.wenq.x=this.wenq.y=0;var t=0;for(t=0;31>t;t++){var e=new PIXI.extras.MovieClip(this.wenFrames());e.pivot=new l.Point(6,67),this.var_wenArr.push(e),this.var_wen.addChild(e),t>15&&(e.scale.x=-1)}var i=new PIXI.Graphics;i.beginFill(0),i.drawCircle(0,0,58),i.endFill(),this.wenCon.addChild(i),this.var_wen.mask=i,this.micro=new f["default"](this.paramObj),this.addChild(this.micro),this.micro.$target=this,this.micro.initView(this.luodi,this.luos,this.luor,this.luor2,this.zhexiao,this.scale1,this.scale2),this.micro.x=744,this.micro.y=-248,this.upWendata()}},{key:"upWendata",value:function(){var t=this.d/this.l*this.λ*.001,e=this.micro.func_getNum(),i=0;for(i=0;this.var_wenArr.length>i;i++){var n=this.var_wenArr[i];n.gotoAndStop(this._lv.selftype),n.x=(t*(i-15)-e)*this.sc,3==this._lv.selftype?15==i&&n.gotoAndStop(4):n.blendMode=PIXI.BLEND_MODES.NORMAL}}},{key:"initLvSp",value:function(){var t=this;this.removeChild(this.lv);var e=[],i=[],n=[],o=0;for(o=1;5>o;o++){var r="DoubleSlitExp/c"+o+".png";n.push(PIXI.Texture.fromFrame(r)),i.push(n)}for(o=0;4>o;o++){e.push(new PIXI.extras.MovieClip(i[o]))}this._lv=new y["default"](this.paramObj,e),this._lv.initlv(),this._lv.x=-420,this._lv.y=-232,this.addChild(this._lv),this._lv.addEventListener("buttonChange",function(){t.rollChangeFunc()})}},{key:"initSf",value:function(){var t=this;this.removeChild(this.shuangf);var e=[],i=[],n=[],o=0;for(o=0;5>o;o++)n.push(PIXI.Texture.fromFrame("DoubleSlitExp/Bitmap "+(o+1))),i.push(n);for(o=0;5>o;o++){e.push(new PIXI.extras.MovieClip(i[o]))}this._sf=new y["default"](this.paramObj,e),this._sf.initlv(),this._sf.x=-220,this._sf.y=-232,this.addChild(this._sf),this._sf.addEventListener("buttonChange",function(){t.sfChange()}),this._sf.selftype=4}},{key:"sfChange",value:function(){this.l=(1+this._sf.selftype)/10,this.upWendata()}},{key:"rollChangeFunc",value:function(){0==this._lv.selftype?this.λ=700:1==this._lv.selftype?this.λ=600:2==this._lv.selftype?this.λ=500:3==this._lv.selftype&&(this.λ=700),this.upWendata()}},{key:"createTip",value:function(){this.tip.x=this.lv.x,this.tip.y=this.lv.y,this.tip.rotation=-.4,this.tip2=PIXI.Sprite.fromFrame("DoubleSlitExp/tip.png"),this.addChild(this.tip2),this.tip2.pivot.x=-this.tip.getChildAt(0).position.x,this.tip2.pivot.y=-this.tip.getChildAt(0).position.y,this.tip2.x=this.danf.x,this.tip2.y=this.danf.y,this.tip2.rotation=.4,this.tip3=PIXI.Sprite.fromFrame("DoubleSlitExp/tip.png"),this.addChild(this.tip3),this.tip3.pivot.x=-this.tip.getChildAt(0).position.x,this.tip3.pivot.y=-this.tip.getChildAt(0).position.y,this.tip3.x=this.shuangf.x,this.tip3.y=this.shuangf.y;var t=this.createTxt({text:this.language.getLocaleStr("optical_filtering"),style:{font:"25px Arial",fill:0}});this.tip.addChild(t),t.rotation=-this.tip.rotation,t.x=-50,t.y=10;var e=this.createTxt({text:this.language.getLocaleStr("single_slit"),style:{font:"25px Arial",fill:0}});this.tip2.addChild(e),e.rotation=-this.tip2.rotation,e.x=35,e.y=83;var i=this.createTxt({text:this.language.getLocaleStr("double_slit"),style:{font:"25px Arial",fill:0}});this.tip3.addChild(i),i.rotation=-this.tip3.rotation,i.x=27,i.y=75}},{key:"createTxt",value:function(t){var e=new PIXI.Text("");for(var i in t)e[i]=t[i];return e}},{key:"removed",value:function(){this.removedCursor(this._lv),this.removedCursor(this._sf),this.removedCursor(this.micro.roller),this.micro.disposeAll(),this._sf.disposeAll(),this._lv.disposeAll(),this.removeAllListeners(),this.micro.$target=null,this._sf.$target=null,this._lv.$target=null,this.micro.destroy(),this._sf.destroy(),this._lv.destroy(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.lvtype=this._lv.selftype,t.sftype=this._sf.selftype,t.micro=this.micro.r1Number,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this._lv.selftype=t.lvtype,this._sf.selftype=t.sftype,this.micro.r1Number=t.micro,this.rollChangeFunc(),this.sfChange(),this.upWendata(),this.micro.refresh()}},{key:"selectRenderChild",value:function(){return this.bg.getBounds()}}]),e}(c["default"])},1120:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(679),u=n(l),c=i(77),d=n(c),f=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.canReset=!0,i.className="EqualThicknessInterference",f=i.ComponentProperty,i.xScale=i.zScale=10,i.WIDTH=260,i.HEIGHT=260,i.IMG_DATA_LEN=i.WIDTH*i.HEIGHT*4,i.filmTypes=[d["default"].getLocaleStr("newton_ring"),d["default"].getLocaleStr("wedge")],i.currentFilmId=0,i.filmsData=[],i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.screen.difImageCon.addChild(this.difImg),this.difImg.x=0,this.difImg.y=0,this.difImg.blendMode=PIXI.BLEND_MODES.SCREEN,this.screen.difImageCon.sceneBg.blendMode=PIXI.BLEND_MODES.SCREEN,this.glassBottom=this.newtonBubble.glassBottom,this.glassTop=this.newtonBubble.glassTop,this.glassWidth=this.glassBottom.width,this.glassHeight=this.glassWidth,this.startX=this.glassWidth/2,this.startZ=this.glassHeight/2,this.lightSource.gotoAndStop(this.curLightId),this.lights.gotoAndStop(this.curLightId),this.newtonFilm=new g(this.newtonBubble,this),this.newtonFilm.hide(),this.wedgeFilm=new y(this.filmBubble,this),this.wedgeFilm.hide(),this.films=[this.newtonFilm,this.wedgeFilm],this.changeFilmType({checked:0}),this.initFilmsData(),this.selfRender()}},{key:"getDl",value:function(t,e,i,n){var o=this.startX+(t-this.WIDTH/2)/this.xScale,r=this.startZ+(e-this.HEIGHT/2)/this.zScale;return 0>o||o>this.glassWidth?i/2:0>r||r>this.glassHeight?i/2:this.currentFilm.getDl(o,r,i,n)}},{key:"selfRender",value:function(){this.saveFilmsDataByIndex(this.currentFilmId),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this)}},{key:"delayRender",value:function(){16777215!==this.curColor?(this.dataChangFlag=!1,this.selfRender()):h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"delayRender",this).call(this)}},{key:"changeStartX",value:function(t){this.startX=this.mm2px(t.showValue),this.dataChangFlag=!0,this.delayRender()}},{key:"changeStartZ",value:function(t){this.startZ=this.mm2px(t.showValue),this.dataChangFlag=!0,this.delayRender()}},{key:"changeLight",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"changeLight",this).call(this,t),this.lightSource.gotoAndStop(this.curLightId),this.lights.gotoAndStop(this.curLightId)}},{key:"reset",value:function(){this.startX=this.glassWidth/2,this.startZ=this.glassHeight/2,this.currentFilm.resetParam(),this.selfRender(),this.freshLibPan()}},{key:"changeFilmType",value:function(t){this.currentFilmId=t.checked,this.currentFilm&&this.currentFilm.hide(),this.currentFilm=this.films[this.currentFilmId],this.currentFilm.show(),this.selfRender(),this.freshLibPan()}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.currentFilmId=this.currentFilmId,t.curLightId=this.curLightId,t.lightGain=this.lightGain,t.startX=this.startX,t.startZ=this.startZ,this.saveFilmsDataByIndex(this.currentFilmId),t.filmsData=this.filmsData,t}},{key:"initFilmsData",value:function(){this.filmsData=[];for(var t=0;this.films.length>t;t++)this.saveFilmsDataByIndex(t)}},{key:"saveFilmsDataByIndex",value:function(t){this.filmsData[t]=this.films[t].getData()}},{key:"setData",value:function(t){if(t.filmsData){for(var i=0;t.filmsData.length>i;i++){this.films[i].setData(t.filmsData[i])}this.initFilmsData()}t.currentFilmId&&this.changeFilmType({checked:t.currentFilmId}),t.curLightId&&this.setCurLightId(t.curLightId),t.lightGain&&(this.lightGain=t.lightGain),t.startX&&(this.startX=t.startX),t.startZ&&(this.startZ=t.startZ),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.dataChangFlag=!0,this.delayRender()}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(f.getRadio(this.language.getLocaleStr("film_type"),this.currentFilmId,this.filmTypes,this.changeFilmType.bind(this)),f.getScrollBar(d["default"].getLocaleStr("lr_eyepiece"),!1,"mm",this.toFixed(this.px2mm(this.glassWidth),2),0,this.toFixed(this.px2mm(this.startX),2),.1,this.changeStartX,this),f.getScrollBar(d["default"].getLocaleStr("tb_eyepiece"),!1,"mm",this.toFixed(this.px2mm(this.glassHeight),2),0,this.toFixed(this.px2mm(this.startZ),2),.1,this.changeStartZ,this)),t.confArr=t.confArr.concat(this.currentFilm.getConf()),t}},{key:"selectRenderChild",value:function(){return this.updateTransform(),this.getBounds()}}]),e}(u["default"]);var p=function(){function t(e,i){o(this,t),this.bubble=e,this.glassBottom=e.glassBottom,this.glassTop=e.glassTop,this.view=i,this.glassWidth=this.glassBottom.width,this.glassHeight=this.glassWidth,this.toFixed=i.toFixed.bind(i),this.m2px=i.m2px.bind(i),this.mm2px=i.mm2px.bind(i),this.px2m=i.px2m.bind(i),this.px2mm=i.px2mm.bind(i)}return s(t,[{key:"hide",value:function(){this.bubble.visible=!1}},{key:"show",value:function(){this.bubble.visible=!0}},{key:"delayRender",value:function(){this.view.dataChangFlag=!0,this.view.delayRender()}},{key:"getData",value:function(){return{}}},{key:"setData",value:function(t){}}]),t}(),y=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.papersSp=n.bubble.papersSp,n.className="WedgeFilm",n.r1=.1,n.h1=.1,n.cr=n.glassWidth/2,n.paperN=5,n.paperH=.01,n.paperHpx=3,n.paperD=n.paperN*n.paperH,n.paperDpx=n.paperN*n.paperHpx,n.papersSp.removeChildren(),n.paperArr=[];for(var a=0;15>a;a++){var s=PIXI.Texture.fromFrame("EqualThicknessInterference/paper.png"),h=new PIXI.Sprite(s);n.papersSp.addChild(h),h.y=-3*(a+1),n.paperArr[a]=h}return n.resetParam(),n}return a(e,t),s(e,[{key:"updateBottomGlass",value:function(){var t=this.paperDpx*this.r1/this.paperD,e=this.paperDpx*this.h1*.001/this.paperD;e*=15;var i=e>0?t-e:-t-e,n=Math.sqrt(t*t-i*i),o=this.cr-n,r=this.cr+n;if(0===e)this.glassBottom.mask=null;else if(e>0)this.glassBottom.mask=null,this.graBottom&&(this.graBottom.visible=!1),this.graLine&&(this.graLine.visible=!1),this.bubble.tuqi.visible=!0,this.bubble.tuqi.width=2*n,this.bubble.tuqi.height=e,this.bubble.tuqi.x=this.glassBottom.x+this.cr,this.bubble.tuqi.y=this.glassBottom.y-14;else{this.bubble.tuqi.visible=!1,this.graBottom||(this.graBottom=new PIXI.Graphics),this.bubble.addChild(this.graBottom),this.graBottom.visible=!0,this.graBottom.x=this.glassBottom.x,this.graBottom.y=this.glassBottom.y-14,this.glassBottom.mask=this.graBottom,this.graLine||(this.graLine=new PIXI.Graphics),this.bubble.addChild(this.graLine),this.graLine.x=this.graBottom.x,this.graLine.y=this.graBottom.y+.5,this.graLine.visible=!0;var a=Math.asin(n/t),s=2*a/100;this.graBottom.clear(),this.graBottom.lineStyle(1,11056083,1),this.graBottom.beginFill(8094090),this.graBottom.moveTo(0,0),this.graBottom.lineTo(o,0);for(var h=0;100>=h;h++){var l=s*h-a,u=this.cr+t*Math.sin(l),c=void 0;c=e>0?i-t*Math.cos(l):i+t*Math.cos(l),this.graBottom.lineTo(u,c)}this.graBottom.lineTo(r,0),this.graBottom.lineTo(this.glassWidth,0),this.graBottom.lineTo(this.glassWidth,14),this.graBottom.lineTo(0,14),this.graBottom.moveTo(0,0),this.graBottom.endFill(),this.graLine.clear(),this.graLine.lineStyle(1,13029091,1),this.graLine.moveTo(o,0);for(var d=0;100>=d;d++){var f=s*d-a,p=this.cr+t*Math.sin(f),y=void 0;y=e>0?i-t*Math.cos(f):i+t*Math.cos(f),this.graLine.lineTo(p,y)}this.graLine.lineTo(r,0)}}},{key:"getDl",value:function(t,e,i,n){var o=t/this.glassWidth,r=this.paperDpx*this.r1/this.paperD,a=this.paperDpx*this.h1*.001/this.paperD,s=a>0?r-a:-r-a,h=Math.sqrt(r*r-s*s),l=t-this.cr,u=e-this.glassHeight/2;if(h>Math.sqrt(l*l+u*u)){var c=Math.sqrt(r*r-l*l-u*u),d=void 0;d=a>0?-(a-(r-c)):-(a+(r-c)),o+=d/this.paperDpx}return 2*this.paperD*o*.001}},{key:"updateWireLine",value:function(){for(var t=0;this.paperArr.length>t;t++){this.paperArr[t].visible=this.paperN>t}this.glassTop.rotation=-Math.atan2(this.paperDpx,this.glassWidth-35)}},{key:"changePaperN",value:function(t){this.paperN=t.showValue,this.paperD=this.paperN*this.paperH,this.paperDpx=this.paperN*this.paperHpx,this.updateWireLine(),this.delayRender()}},{key:"changeH1",value:function(t){this.h1=t.showValue,this.updateBottomGlass(),this.delayRender()}},{key:"changeR1",value:function(t){this.r1=t.showValue,this.updateBottomGlass(),this.delayRender()}},{key:"resetParam",value:function(){this.r1=.1,this.h1=.1,this.cr=this.glassWidth/2,this.paperN=5,this.updatePaperD(),this.updateWireLine(),this.updateBottomGlass()}},{key:"updatePaperD",value:function(){this.paperD=this.paperN*this.paperH,this.paperDpx=this.paperN*this.paperHpx}},{key:"getData",value:function(){return{r1:this.r1,h1:this.h1,paperN:this.paperN}}},{key:"setData",value:function(t){t.r1&&(this.r1=t.r1),t.h1&&(this.h1=t.h1),t.paperN&&(this.paperN=t.paperN),this.updatePaperD(),this.updateWireLine(),this.updateBottomGlass()}},{key:"getConf",value:function(){var t=[];return t.push(f.getScrollBar(d["default"].getLocaleStr("paper_num"),!1,"张",10,1,this.paperN,1,this.changePaperN.bind(this),this),f.getScrollBar(d["default"].getLocaleStr("cave_vex_radius"),!1,"mm",.2,.02,this.toFixed(this.r1,2),.01,this.changeR1.bind(this),this),f.getScrollBar(d["default"].getLocaleStr("cave_vex_height"),!1,"μm",this.toFixed(10*this.paperD,2),-this.toFixed(10*this.paperD,2),this.toFixed(this.h1,2),.05,this.changeH1.bind(this),this)),t}}]),e}(p),g=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.className="NewtonFilm",n.yScale=20,n.offsetY=0,n.R=.2,n.updateNewtonGlass(),n}return a(e,t),s(e,[{key:"updateNewtonGlass",value:function(){var t=this.m2px(this.R);t/=this.yScale;var e=this.glassWidth/2;this.glassTop.height=t-Math.sqrt(t*t-e*e)}},{key:"changeR",value:function(t){this.R=t.showValue,this.updateNewtonGlass(),this.delayRender()}},{key:"changeOffsetY",value:function(t){this.offsetY=t.showValue,this.delayRender()}},{key:"resetParam",value:function(){this.offsetY=0,this.R=.2,this.updateNewtonGlass()}},{key:"getData",value:function(){return{offsetY:this.offsetY,R:this.R}}},{key:"setData",value:function(t){t.offsetY&&(this.offsetY=t.offsetY),t.R&&(this.R=t.R),this.updateNewtonGlass()}},{key:"getDl",value:function(t,e,i,n){var o=t-this.glassWidth/2,r=e-this.glassHeight/2,a=Math.sqrt(o*o+r*r);a=this.px2m(a);var s=this.R,h=s-Math.sqrt(s*s-a*a);h+=1e-6*this.offsetY;var l=2*h*n;return i/2>l&&(l=i/2),l}},{key:"getConf",value:function(){var t=[];return t.push(f.getScrollBar(d["default"].getLocaleStr("curvature_lens_r"),!1,"m",1,.2,this.toFixed(this.R,2),.01,this.changeR.bind(this),this),f.getScrollBar(d["default"].getLocaleStr("press_lens"),!1,"μm",0,-1,this.toFixed(this.offsetY,2),.1,this.changeOffsetY.bind(this),this)),t}}]),e}(p);!function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.clear(),t.beginFill(7711918,1),t.drawRect(-1,-15,2,30),t.endFill(),t.beginFill(7711918,1),t.drawRect(-15,-1,30,2),t.endFill(),t}a(e,t)}(PIXI.Graphics)},1121:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(493),u=n(l),c=i(449),d=n(c),f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.shape.Polygon,y=f.geom.Vec2,i.dang=null,i.viewY=null,i.canRotate=!1,i.touchid=null,i.translateRect={width:250,height:250},i.glassShape=null,i.scaleRe=!0,i.fixpos=y.get(-50,-105),i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.vo.var_canReflection=!1,this.vo.var_copyReflection=!1,this.vo.n=this.vo.rate=-1,this.glassShape=this.body.get_shapes().at(0),this.drawBody(),this.componentBox.visible=!1,this.addCursor(this,"hand"),this.boardClick=function(e){t.clickFunc(e)},this.boardEndDrag=function(e){t.body.get_arbiters().foreach(function(e){var i=e.get_body1(),n=e.get_body2(),o=i==t.body?n:i,r=o.userData.view;if(r&&"PlaneMirror"==r.classname){var a=o.get_position();t.body.set_position(a.add(t.fixpos))}})},this.addEventListener(d["default"].CLICK,this.boardClick),this.addEventListener(d["default"].END,this.boardEndDrag),this.bgmc.x+=18,this.bgmc.y+=22}},{key:"removed",value:function(){this.removedCursor(this),this.removeEventListener(d["default"].CLICK,this.boardClick),this.removeEventListener(d["default"].END,this.boardEndDrag),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"clickFunc",value:function(t){var e=this.bgmc.currentFrame;e++,3==e&&(e=0),0==e?this.body.add(this.dang):this.body.remove(this.dang),1==e?(this.glassShape.scale(1.9,1),this.glassShape.get_localCOM().set_x(58),this.scaleRe=!1):this.scaleRe||(this.glassShape.scale(1/1.9,1),this.glassShape.get_localCOM().set_x(0),this.scaleRe=!0),this.bgmc.currentFrame=e}},{key:"drawSkinFun",value:function(t){var e={x:0,y:51},i={x:136,y:51},n={x:136,y:250},o={x:0,y:250};return this.currImg.clear(),this.points=[e,i,n,o]}},{key:"drawBody",value:function(){this.shapeline.alpha=0,this.currImg.alpha=0;var t=[y.get(68,-104.95),y.get(70,94.05),y.get(101,139.05),y.get(104,-54.95)];this.dang=new p(t),this.body.add(this.dang),this.body.set_shape_sensorEnabled(this.dang,!0)}},{key:"selectRenderChild",value:function(){return this.bgmc.getBounds()}},{key:"showScaleTool",value:function(){}}]),e}(u["default"])},1122:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function p(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:p(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(681),c=n(u),d=i(620),f=n(d);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.className="FraunhoferDiffraction",i.slitTypes=[i.language.getLocaleStr("single_slit"),i.language.getLocaleStr("double_slit"),i.language.getLocaleStr("circular_hole"),i.language.getLocaleStr("rectangular_hole"),i.language.getLocaleStr("library.ele.metal_wire"),i.language.getLocaleStr("triangle_hole"),i.language.getLocaleStr("star_screen"),i.language.getLocaleStr("circular_screen")],i.slits=[new f["default"].SingleSlit(10,200,!1),new f["default"].DoubleSlit(4,200,30,!1),new f["default"].CircleSlit(3,!1),new f["default"].RectSlit(10,20,!1),new f["default"].SingleSlit(2,200,!0),new f["default"].TriangleSlit(20,17.3,0,!1),new f["default"].StarSlit(20,0,!1),new f["default"].CircleSlit(20,!0),new f["default"].RingSlit(20,10,!1)],i.slitsShow=[new f["default"].SingleSlit(10,200,!1,263172),new f["default"].DoubleSlit(4,200,30,!1,263172),new f["default"].CircleSlit(3,!1,263172),new f["default"].RectSlit(10,20,!1,263172),new f["default"].WireLineSlit("FraunhoferDiffraction/wireLine.png",2,200,!0),new f["default"].TriangleSlit(20,17.3,0,!1,263172),new f["default"].StarSlit(20,0,!1,263172),new f["default"].CircleSlit(20,!0,263172),new f["default"].RingSlit(20,10,!0)],i}return a(e,t),s(e,[{key:"removed",value:function(){this.slits.length=0,this.slitsShow.length=0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this)}},{key:"getLightPoints",value:function(){var t=this.lightSource.y-128;return[[{x:this.lightSource.x-40,y:t},{x:this.beamExpander.x-15,y:t}],[{x:this.beamExpander.x+10,y:t},{x:this.collimatingMirror.x-20,y:t}],[{x:this.collimatingMirror.x+8,y:t},{x:this.slitSeat.x-20,y:t}],[{x:this.slitSeat.x+8,y:t},{x:this.convexLens.x-18,y:t}],[{x:this.convexLens.x+8,y:t},{x:this.videoCamera.x+2,y:t}]]}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);switch(this.curSlitId){case 0:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_width"),!1,"mm",2.5,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_height"),!1,"mm",10,1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this));break;case 1:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_width"),!1,"mm",2.5,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_height"),!1,"mm",10,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_space"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.d),2),.1,this.changeD,this));break;case 2:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.1,this.changeR,this));break;case 3:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("width"),!1,"mm",10,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("height"),!1,"mm",10,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this));break;case 4:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("thickness"),!1,"mm",1,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this));break;case 5:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("width"),!1,"mm",9,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("height"),!1,"mm",9,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this),this.ComponentProperty.getAngle(this.language.getLocaleStr("angle"),l.M.toAngle(this.curSlit.rot),this.changeRot,this));break;case 6:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.1,this.changeR,this),this.ComponentProperty.getAngle(this.language.getLocaleStr("angle"),l.M.toAngle(this.curSlit.rot),this.changeRot,this));break;case 7:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.05,this.changeR,this));break;case 8:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("outer_radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.ro),2),.05,this.changeRo,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("inner_radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.ri),2),.05,this.changeRi,this))}return t}}]),e}(c["default"])},1123:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function w(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:w(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(681),u=n(l),c=i(621),d=n(c),f=i(517),p=n(f),y=i(1156),g=n(y),v=i(494),_=(n(v),i(620)),b=n(_),m=i(1);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.className="FresnelDiffraction",i.z=5,i.MAX_Z=10,i.MIN_Z=1,i.CAMERA_RANGE=300,i.slitTypes=[i.language.getLocaleStr("single_slit"),i.language.getLocaleStr("double_slit"),i.language.getLocaleStr("circular_hole"),i.language.getLocaleStr("rectangular_hole"),i.language.getLocaleStr("library.ele.metal_wire"),i.language.getLocaleStr("triangle_hole"),i.language.getLocaleStr("star_screen"),i.language.getLocaleStr("circular_screen")],i.type=2,i.slits=[new b["default"].SingleSlit(30,256,!1),new b["default"].DoubleSlit(4,256,30,!1),new b["default"].CircleSlit(10,!1),new b["default"].RectSlit(30,30,!1),new b["default"].SingleSlit(10,256,!0),new b["default"].TriangleSlit(20,17.3,0,!1),new b["default"].StarSlit(30,0,!1),new b["default"].CircleSlit(30,!0),new b["default"].RingSlit(30,10,!1)],i.slitsShow=[new b["default"].SingleSlit(30,256,!1,263172),new b["default"].DoubleSlit(4,256,30,!1,263172),new b["default"].CircleSlit(10,!1,263172),new b["default"].RectSlit(30,30,!1,263172),new b["default"].WireLineSlit("FresnelDiffraction/wireLine.png",10,256,!0),new b["default"].TriangleSlit(20,17.3,0,!1,263172),new b["default"].StarSlit(30,0,!1,263172),new b["default"].CircleSlit(30,!0,263172),new b["default"].RingSlit(30,10,!0)],i}return a(e,t),s(e,[{key:"init",value:function(){this.cameraOx=this.videoCamera.x,this.updateCameraByZ(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addCursor(this.videoCamera,"zuoyou"),this.cameraTouchid=m.M.addTouch(this.videoCamera,{begin:this.cameraTouchBegin,move:this.cameraTouchMove,end:this.cameraTouchEnd},this)}},{key:"removed",value:function(){this.removedCursor(this.videoCamera,"zuoyou"),m.M.removeTouch(this.videoCamera,this.cameraTouchid),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"cameraTouchBegin",value:function(t){this.touchEnabled=!1,this.oldP=this.getMouseXY(t)}},{key:"cameraTouchMove",value:function(t){var e=this.getMouseXY(t);this.videoCamera.x+=e.x-this.oldP.x,this.oldP=e,this.updateZbyCamera(),this.dataChangFlag=!0,this.delayRender(),this.panelChangFlag=!0,this.delayShowPanel()}},{key:"cameraTouchEnd",value:function(t){this.touchEnabled=!0}},{key:"singleLightresnelFft2",value:function(t,e,i,n){i*=1e-9;var o=this.getH(e,i),r=d["default"].FFT2(t.re,t.im,this.FOURIER_N,this.FOURIER_N,1,1);r=p["default"].fftshift(r,this.FOURIER_SIZE,this.FOURIER_SIZE);var a=d["default"].FFT2(o.re,o.im,this.FOURIER_N,this.FOURIER_N,1,1);a=p["default"].fftshift(a,this.FOURIER_SIZE,this.FOURIER_SIZE);var s=p["default"].complexMul(r,a,this.FOURIER_LEN),h=d["default"].IFFT2(s.re,s.im,this.FOURIER_N,this.FOURIER_N,1,1);h=p["default"].fftshift(h,this.FOURIER_SIZE,this.FOURIER_SIZE);var l=p["default"].abs(h.re,h.im,this.FOURIER_LEN),u=p["default"].maxData(l,this.FOURIER_LEN);return l=p["default"].mul(l,255/u,this.FOURIER_LEN),l=p["default"].color(l,this.IMG_DATA_LEN,n)}},{key:"whiteLightresnelFft2",value:function(t){for(var e=d["default"].FFT2(t,this.data0,this.FOURIER_N,this.FOURIER_N,1,1),i=[],n=0;this.whiteLight.length>n;n++){var o=this.whiteLight[n],r=1e-9*o.lamda,a=this.getH(this.z,r),s=d["default"].FFT2(a.re,a.im,this.FOURIER_N,this.FOURIER_N,1,1),h=p["default"].complexMul(e,s,this.FOURIER_LEN),l=d["default"].IFFT2(h.re,h.im,this.FOURIER_N,this.FOURIER_N,1,1);l=p["default"].fftshift(l,this.FOURIER_SIZE,this.FOURIER_SIZE);var u=p["default"].abs(l.re,l.im,this.FOURIER_LEN),c=p["default"].maxData(u,this.FOURIER_LEN);u=p["default"].mul(u,255/c,this.FOURIER_LEN),u=p["default"].color(u,this.IMG_DATA_LEN,o.color),0===n?i=u:p["default"].blend(i,u,this.IMG_DATA_LEN)}return i}},{key:"showData",value:function(t,e,i,n){var o=p["default"].abs(e.re,e.im,this.FOURIER_LEN);if(n){var r=p["default"].maxData(o,this.FOURIER_LEN);o=p["default"].mul(o,255/r,this.FOURIER_LEN)}o=p["default"].color(o,this.IMG_DATA_LEN,i);var a=t.context.getImageData(0,0,this.FOURIER_SIZE,this.FOURIER_SIZE);p["default"].setArr(a.data,o,this.IMG_DATA_LEN),t.context.putImageData(a,0,0),t.updateTexture()}},{key:"diffraction",value:function(t){return this.curLamda>0?this.singleLightresnelFft2({re:t,im:this.data0},this.z,this.curLamda,this.curColor):this.whiteLightresnelFft2(t)}},{key:"getH",value:function(t,e){for(var i=[],n=[],o=0,r=2*Math.PI/e,a=this.FOURIER_SIZE,s=a/2,h=this.pxm,l=0;a>l;l++)for(var u=0;a>u;u++){var c=(l-s)*h,d=(u-s)*h,f=r*(c*c+d*d)/(2*t),p=new g["default"](Math.cos(f),Math.sin(f)),y=p;i[o]=y.re,n[o]=y.im,o++}return{re:i,im:n}}},{key:"getC",value:function(t,e){for(var i=[],n=[],o=0,r=2*Math.PI/e,a=this.FOURIER_SIZE,s=a/2,h=this.pxm,l=0;a>l;l++)for(var u=0;a>u;u++){var c=r*t,d=new g["default"](Math.cos(c),Math.sin(c)),f=(l-s)*h,p=(u-s)*h,y=r*(f*f+p*p)/(2*t),v=new g["default"](Math.cos(y),Math.sin(y)),_=new g["default"](0,e*t),b=d.mul(v).div(_);i[o]=b.re,n[o]=b.im,o++}return{re:i,im:n}}},{key:"getLightPoints",value:function(){var t=this.lightSource.y-128;return[[{x:this.lightSource.x-40,y:t},{x:this.beamExpander.x-15,y:t}],[{x:this.beamExpander.x+10,y:t},{x:this.collimatingMirror.x-20,y:t}],[{x:this.collimatingMirror.x+8,y:t},{x:this.slitSeat.x-20,y:t}],[{x:this.slitSeat.x+8,y:t},{x:this.videoCamera.x+2,y:t}]]}},{key:"changeZ",value:function(t){this.z=this.toFixed(t.showValue,1),this.updateCameraByZ(),this.dataChangFlag=!0,this.delayRender()}},{key:"updateCameraByZ",value:function(){this.videoCamera.x=this.CAMERA_RANGE*(this.z-this.MAX_Z)/(this.MAX_Z-this.MIN_Z)+this.cameraOx}},{key:"updateZbyCamera",value:function(){this.videoCamera.x>this.cameraOx&&(this.videoCamera.x=this.cameraOx),this.cameraOx-this.CAMERA_RANGE>this.videoCamera.x&&(this.videoCamera.x=this.cameraOx-this.CAMERA_RANGE),this.z=(this.MAX_Z-this.MIN_Z)*(this.videoCamera.x-this.cameraOx)/this.CAMERA_RANGE+this.MAX_Z}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.z=this.z,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.z&&(this.z=t.z),this.updateCameraByZ(),this.updateLightLine()}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);switch(t.confArr.splice(2,0,this.ComponentProperty.getScrollBar(this.language.getLocaleStr("dis_camera_slit"),!1,"m",this.MAX_Z,this.MIN_Z,this.toFixed(this.z,1),.1,this.changeZ,this)),this.curSlitId){case 0:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_width"),!1,"mm",2.5,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_height"),!1,"mm",15,1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this));break;case 1:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_width"),!1,"mm",2.5,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_height"),!1,"mm",15,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("seam_space"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.d),2),.1,this.changeD,this));break;case 2:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.1,this.changeR,this));break;case 3:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("width"),!1,"mm",10,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("height"),!1,"mm",10,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this));break;case 4:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("thickness"),!1,"mm",1,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this));break;case 5:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("width"),!1,"mm",9,.1,this.toFixed(this.px2mm(this.curSlit.w),2),.1,this.changeW,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("height"),!1,"mm",9,.1,this.toFixed(this.px2mm(this.curSlit.h),2),.1,this.changeH,this),this.ComponentProperty.getAngle(this.language.getLocaleStr("angle"),m.M.toAngle(this.curSlit.rot),this.changeRot,this));break;case 6:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.1,this.changeR,this),this.ComponentProperty.getAngle(this.language.getLocaleStr("angle"),m.M.toAngle(this.curSlit.rot),this.changeRot,this));break;case 7:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.r),2),.05,this.changeR,this));break;case 8:t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("outer_radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.ro),2),.05,this.changeRo,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("inner_radius"),!1,"mm",5,.1,this.toFixed(this.px2mm(this.curSlit.ri),2),.05,this.changeRi,this))}return t}}]),e}(u["default"])},1124:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(493),h=function(t){return t&&t.__esModule?t:{"default":t}}(s);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.translateRect={width:250,height:250},i}return r(e,t),a(e,[{key:"drawSkinFun",value:function(t){var e=this.translateRect.width/2,i=this.translateRect.height/2,n={x:-e,y:-i},o={x:e,y:-i},r={x:e,y:i},a={x:-e,y:i};return this.currImg.clear(),this.currImg.beginFill(16777215,.3),this.currImg.moveTo(n.x,n.y),this.currImg.lineTo(o.x,o.y),this.currImg.lineTo(r.x,r.y),this.currImg.lineTo(a.x,a.y),this.points=[n,o,r,a]}}]),e}(h["default"])},1125:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(493),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=void 0,d=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=i.phy.nape,c=u.geom.Vec2,d=u.geom.Ray,i.translateRect={width:350,height:175},i.roteVec2=c.get(0,i.translateRect.height),i.centerSp=new PIXI.Graphics,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.align(),this.edgedraw(),this.centerSp.beginFill(16711680),this.centerSp.drawCircle(0,0,4),this.centerSp.endFill(),this.addChild(this.centerSp)}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.flushCenter()}},{key:"edgedraw",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"edgedraw",this).call(this),this.flushCenter()}},{key:"flushCenter",value:function(){var t=c.get(0,1);t.set_angle(this.body.get_rotation()+Math.PI/2);var e=new d(this.body.get_position(),t),i=this.space.rayCast(e,!0),n=e.at(i.get_distance());n=this.body.worldPointToLocal(n),this.centerSp.x=n.get_x(),this.centerSp.y=n.get_y(),this.roteVec2.set_y(n.get_y())}},{key:"drawSkinFun",value:function(){for(var t=(arguments.length>0&&undefined,Math.PI/180),e=-Math.PI,i=this.translateRect.width/2,n=this.translateRect.height,o=[],r=0;180>=r;r++){o.push({x:Math.cos(e)*i,y:Math.sin(e)*n}),e+=t}return this.points=o,o}}]),e}(l["default"])},1126:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function m(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:m(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(576),c=n(u),d=i(449),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0,_=void 0,b=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));p=i.phy.nape,y=p.phys.BodyType,g=p.NbBody,v=p.shape.Polygon,_=p.geom.Vec2,b=p.shape.Circle,i.canRotate=!1,i.level=1,i.rayDat=[{co:16711680,n:1.513},{co:16711680,n:1.513},{co:16711680,n:1.513}],i.selectIndex=-1,i.ysIndex=0,i.currbg=null,i.dotAry=[],i.minSpace=10,i.maxSpace=6,i.dotSpace=10,i.dotCon=new PIXI.Sprite,i.turnBody=null,i.weldJoint=null,i.oldP=null,i.welist=[],i.btnid=null,i.blackid=null;var n=i.getLocaleStr("laser","激光");return i.laser1Str=n+1,i.laser2Str=n+2,i.laser3Str=n+3,i.jointList=[],i}return a(e,t),s(e,[{key:"init",value:function(){this.removeChildAt(4),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.bg.x=this.bg.y=0,this.bg2.x=this.bg2.y=0,this.black.visible=!1,this.btn.currentFrame=1,this.currbg=this.bg,this.btn.visible=!1,this.oneline=new PIXI.Graphics,this.oneline.x=-178,this.oneline.y=-30,this.oneline.lineStyle(5,16711680),this.bg2.addChild(this.oneline),this.oneline.moveTo(0,0),this.oneline.lineTo(364,0),this.body.userData.dragLevel=-2,this.bg2.visible=!1,this.black.y=-30,this.black.addChild(this.dotCon),this.dotCon.rotation=37*Math.PI/180,this.dotCon.y=-25;for(var t=0;7>t;t++){var i=PIXI.Sprite.fromFrame("LaserDemonstrator/DotPng");i.rotation=-this.dotCon.rotation,this.dotCon.addChild(i),this.dotAry.push(i)}this.btnid=l.M.addTouch(this.btn,{tab:this.powerClick},this,{time:1e3,dis:20}),this.blackid=l.M.addTouch(this.black,{begin:this.blackBegin,move:this.blackMove,end:this.blackEnd},this),this.componentBox.visible=!1,this.initTurntable(),this.changeStatus(0),this.selfDragListener()}},{key:"selfDragListener",value:function(){var t=this;this.bgDragBegin=function(){if(0==t.selectIndex){t.space.bodiesInCircle(t.body.get_position(),220).foreach(function(e){if(e!=t.body){e.set_type(y.get_DYNAMIC());var i=e.get_position(),n=t.JointUtil.createWeldJoint(t.body,e,i,i);t.jointList.push({body:e,joint:n})}})}},this.bgDragEnd=function(){for(var e=0;t.jointList.length>e;e++){var i=t.jointList[e].body;t.BodyUtil.destoryJoint(t.jointList[e].joint),i.set_type(y.get_KINEMATIC())}t.jointList.length=0},this.addEventListener(f["default"].BEGIN,this.bgDragBegin),this.addEventListener(f["default"].END,this.bgDragEnd)}},{key:"initTurntable",value:function(){var t=this;this.turnBody=new g;var e=new v(v.box(155,65));this.turnBody.add(e),this.addBodyToSpace(this.turnBody,this.parent);var i=_.get(this.x+this.bg.x+this.bg.guang.x,this.y+this.bg.y+this.bg.guang.y);this.turnBody.set_position(i),this.turnBody.userData.view=this.bg.guang,this.turnBody.mass=50,this.turnBody.set_allowRotation(!1),this.turnBody.userData.dragLevel=-1,this.turnBody.sensorEnabled(!0),this.setShapeInterFliter(e),this.parent.addChild(this.bg.guang),this.bg.guang.x=i.get_x(),this.bg.guang.y=i.get_y(),this.weldJoint=this.JointUtil.createWeldJoint(this.body,this.turnBody,i,i);var n=0,o=[-50,0,50],r=[_.get(-50,0),_.get(0,0),_.get(50,0)];for(n=0;this.vectorRay.length>n;n++)this.vectorRay[n].isShowValue=!1,this.vectorRay[n].lineStart=[o[n],30],this.vectorRay[n].lineThin=5,this.vectorRay[n].lightStartOffset=r[n],this.vectorRay[n].body=this.turnBody,this.bg.guang.addChild(this.vectorRay[n]);var a=0,s=0;this.guangBegin=function(e){var i=t.turnBody.get_position().sub(t.body.get_position());a=i.get_angle();var n=l.M.getMouseXY(e),o=_.get(n.x,n.y).sub(t.body.get_position());s=o.get_angle()},this.guangMove=function(e){var i=l.M.getMouseXY(e),n=_.get(i.x,i.y).sub(t.body.get_position()),o=n.get_angle();t.setLightPosition(o-s+a)},this.bg.guang.addEventListener(f["default"].BEGIN,this.guangBegin),this.bg.guang.addEventListener(f["default"].MOVE,this.guangMove)}},{key:"setLightPosition",value:function(t){this.turnBody.set_rotation(t+Math.PI/2);var e=280*Math.cos(t),i=280*Math.sin(t);this.weldJoint.set_anchor1(_.get(e,i))}},{key:"blackEnd",value:function(t){this.touchEnabled=!0}},{key:"blackMove",value:function(t){var e=new l.Point(t.data.global.x,t.data.global.y),i=this.black.x+e.x-this.oldP.x;350>i&&(i=350),i>1e3&&(i=1e3),this.black.x=i,this.oldP=e,this.freshDot()}},{key:"freshDot",value:function(){0==this.ysIndex?(this.minSpace=7,this.maxSpace=4):(this.minSpace=10,this.maxSpace=6),this.dotSpace=this.minSpace+this.maxSpace*(this.black.x-350)/1e3;var t=0;for(t=0;this.dotAry.length>t;t++){var e=this.dotAry[t];e.x=(t-3)*this.dotSpace,e.alpha=1-Math.abs(t-3)/3*.7}}},{key:"blackBegin",value:function(t){this.touchEnabled=!1,this.oldP=new l.Point(t.data.global.x,t.data.global.y)}},{key:"changeStatus",value:function(t){if(this.selectIndex!=t){this.selectIndex=t,this.body.shapes.clear();var e=void 0;0==this.selectIndex?(this.turnBody.userData.noDrag=!1,this.bg.guang.visible=!0,this.bg.visible=!0,this.bg2.visible=!1,this.black.visible=!1,this.btn.x=393,this.btn.visible=!1,this.btn.y=388,this.currbg=this.bg,this.openAndCloseLight(!1),e=new v(v.box(900,800)),this.turnBody.set_space(this.space),this.weldJoint.set_active(!0)):(this.turnBody.userData.noDrag=!0,this.bg.visible=!1,this.bg.guang.visible=!1,this.bg2.visible=!0,this.black.visible=!0,this.openAndCloseLight(!0),this.btn.scale.x=this.btn.scale.y=.5,this.btn.x=133,this.btn.y=140,this.currbg=this.bg2,this.freshDot(),this.weldJoint.set_active(!1),this.turnBody.set_space(null),e=new v(v.box(400,300))),this.body.add(e),this.setShapeInterFliter(e),this.body.set_shape_sensorEnabled(e,!0)}}},{key:"powerClick",value:function(t){0==this.btn.currentFrame?(this.btn.currentFrame=1,this.oneline.visible=!1,this.hideDot(!0)):(this.btn.currentFrame=0,this.hideDot(!1),this.oneline.visible=!0)}},{key:"hideDot",value:function(t){var e=void 0;for(e=0;this.dotAry.length>e;e++)this.dotAry[e].visible=!t}},{key:"openAndCloseLight",value:function(t){var e=0;for(e=0;this.vectorRay.length>e;e++)this.vectorRay[e].closeLight=t}},{key:"createRays",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createRays",this).call(this);var t=0,i=[-20,0,20];for(t=0;this.vectorRay.length>t;t++)this.vectorRay[t].isShowValue=!1,this.vectorRay[t].lineStart=[i[t],15],this.vectorRay[t].lineThin=5,this.vectorRay[t].body=this.turnBody,this.bg.guang.addChild(this.vectorRay[t])}},{key:"getDragRect",value:function(){if(null==this.currbg&&(this.currbg=this.bg),null!=this.currbg){return{x:.5*-this.currbg.width,y:.5*-this.currbg.height,width:this.currbg.width,height:this.currbg.height}}}},{key:"closeLightFunc",value:function(t){if(0==this.selectIndex){if(t.index==undefined){t.index=["",this.laser1Str,this.laser2Str,this.laser3Str].indexOf(t.name)}this.vectorRay[t.index-1].closeLight=!t.checked}}},{key:"modelChange",value:function(t){var e=1>=arguments.length||arguments[1]===undefined||arguments[1];this.selectIndex!=t.checked&&(this.changeStatus(t.checked),e&&this.freshLibPan())}},{key:"ysIndexChange",value:function(t){this.ysIndex=t.checked,this.freshDot()}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.selectIndex=this.selectIndex,t.ysIndex=this.ysIndex,t.light0=this.vectorRay[0].closeLight,t.light1=this.vectorRay[1].closeLight,t.light2=this.vectorRay[2].closeLight,t.tbrot=this.turnBody.get_rotation()-Math.PI/2,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),1==t.selectIndex?(this.modelChange({checked:1},!1),this.ysIndexChange({checked:t.ysIndex})):(this.vectorRay[0].closeLight=t.light0,this.vectorRay[1].closeLight=t.light1,this.vectorRay[2].closeLight=t.light2),isNaN(t.tbrot)||this.setLightPosition(t.tbrot)}},{key:"removed",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this),this.BodyUtil.destoryBody(this.turnBody),this.bg.guang.removeEventListener(f["default"].BEGIN,this.guangBegin),this.bg.guang.removeEventListener(f["default"].MOVE,this.guangMove),this.removeEventListener(f["default"].BEGIN,this.bgDragBegin),this.removeEventListener(f["default"].END,this.bgDragEnd),l.M.removeTouch(this.btn,this.btnid),l.M.removeTouch(this.black,this.blackid)}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this)}},{key:"getConf",value:function(){var t={};t.confArr=[];var e=[this.getLocaleStr("opt_path_exper","光路实验"),this.getLocaleStr("volati_exper","波动性实验")];if(t.confArr.push(this.getRadio([this.getLocaleStr("model","模型 "),this.selectIndex,e,this.modelChange,this])),0===this.selectIndex)t.confArr.push(this.getSwitch([this.laser1Str,!this.vectorRay[0].closeLight,this.closeLightFunc,this]),this.getSwitch([this.laser2Str,!this.vectorRay[1].closeLight,this.closeLightFunc,this]),this.getSwitch([this.laser3Str,!this.vectorRay[2].closeLight,this.closeLightFunc,this]));else{var i=[this.getLocaleStr("sing_slit_diffraction","单缝衍射"),this.getLocaleStr("dou_slit_interference","双缝干涉")];t.confArr.push(this.getRadio([this.getLocaleStr("volatility","波动性"),this.ysIndex,i,this.ysIndexChange,this]))}return t}},{key:"selectRenderChild",value:function(){return this.updateTransform(),0===this.selectIndex?this.bg.getBounds():this.bg2.getBounds()}}]),e}(c["default"])},1127:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function b(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:b(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,g=p.shape.Circle,v=p.geom.Vec2,i.head=null,i.bo=null,i.n1=null,i.n2=null,i.n3=null,i.n4=null,i.n5=null,i.dot=null,i.vo=new f["default"](!1,!1,i.rate),i.vo.sensor=!0,i.vo.sensorObj.handleLight=function(t,e,n,o){i.handleLight(t,e,n,o)},i.value=0,i.lineGra=null,i.router=new _,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear();var i=new y(y.rect(-100,0,200,420));this.body.add(i),i.set_sensorEnabled(!0),i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addCursor(this,"hand"),this.headMec=new c["default"](this.paramObj),this.headMec.init(),this.addCursor(this.headMec,"hand"),this.headMec.body.set_position(v.get(this.body.posx+this.head.x,this.body.posy+this.head.y)),this.head.x=0,this.head.y=0,this.headMec.body.shapes.clear(),this.mirrorSp=new g(20,v.get(0,0)),this.mirrorSp.name="mirrorSp",this.headMec.body.add(this.mirrorSp),this.mirrorSp.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),this.mirrorSp.get_userData().vo=this.vo,this.headMec.handleLight=function(e,i,n,o){var r=e.I;t.value+=100*r*r};var n=new y(y.box(180,180));this.headMec.body.add(n),n.set_sensorEnabled(!0),n.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.lineGra=new PIXI.Graphics,this.addChild(this.lineGra),this.addChild(this.head),this.n1=this.bo.n1,this.n2=this.bo.n2,this.n3=this.bo.n3,this.n4=this.bo.n4,this.n5=this.bo.n5,this.dot=this.bo.dot,this.nums=[this.n1,this.n2,this.n3,this.n4,this.n5]}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.head.x=this.headMec.body.posx-this.body.posx,this.head.y=this.headMec.body.posy-this.body.posy,this.updateLine()}},{key:"setDotPosition",value:function(t){this.dot.x=30-20*t}},{key:"updateEnd",value:function(){this.showValue(this.value),this.value=0}},{key:"showValue",value:function(t){1e3>t?(t=Math.round(100*t),this.setDotPosition(1)):(t=Math.round(10*t),this.setDotPosition(0));for(var e=0;this.nums.length>e;e++){this.nums[e].gotoAndStop(t%10),t=t/10>>0}}},{key:"removed",value:function(){this.removedCursor(this,"hand"),this.removedCursor(this.headMec,"hand"),this.vo.sensorObj.handleLight=null,this.vo.sensorObj=null,this.router=null,this.headMec.removeBodyFromSpace(this.headMec.body),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"getMScale",value:function(){return this.main.view.scale}},{key:"updateLine",value:function(){var t=new PIXI.Point(this.head.x,this.head.y+70),e=new PIXI.Point(this.bo.x,this.bo.y-224);this.router.startP=new l.Point(t.x,t.y),this.router.endP=new l.Point(e.x,e.y),this.router.calculatePath(),this.lineGra.clear(),this.lineGra.lineStyle(10,2698286,1);for(var i=this.router.vertices,n=0;i.length>n;n++){var o=i[n];0===n?this.lineGra.moveTo(o.x,o.y):this.lineGra.lineTo(o.x,o.y)}}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.headP={x:this.head.x,y:this.head.y},t}},{key:"setData",value:function(t){t.boP&&this.body.set_position(v.get(this.body.posx+t.boP.x-this.bo.x,this.body.posy+t.boP.y-this.bo.y)),t.headP&&(this.head.x=t.headP.x,this.head.y=t.headP.y),this.headMec.body.set_position(v.get(this.body.posx+this.head.x,this.body.posy+this.head.y)),this.updateLine()}}]),e}(c["default"]);var _=function(){function t(){o(this,t),this.TOLxTOL=.01,this.TOL=.1,this.MINDIST=20,this.TOGGLE_DIST=20,this.direction={UP:0,RIGHT:1,DOWN:2,LEFT:3},this.RoutTypes={LINE:0,CURVE:1,POLY:2},this.vertices=[],this.startP=new l.Point(0,0),this.endP=new l.Point(0,0),this.startDir=this.direction.DOWN,this.endDir=this.direction.UP,this.routType=this.RoutTypes.CURVE}return s(t,[{key:"calculatePath",value:function(){var t=this;switch(t.routType){case this.RoutTypes.POLY:t.manhattanRouter();break;case this.RoutTypes.CURVE:t.curveRouter();break;case this.RoutTypes.LINE:default:t.directRouter()}}},{key:"directRouter",value:function(){var t=this;t.vertices=[t.startP,t.endP]}},{key:"curveRouter",value:function(){var t=this;t.vertices=[],t._manhattanRouter(t.vertices,t.startP,t.startDir,t.endP,t.endDir),3>t.vertices.length||(t.vertices=t._generateBezierSpline(t.vertices,8))}},{key:"_generateBezierSpline",value:function(t,e){var i=t.length,n=[];n.push(t[0]);for(var o=void 0,r=void 0,a=void 0,s=void 0,h=void 0,u=void 0,c=0;i-2>c;c++){s=t[c],h=t[c+1],u=t[c+2],o=0===c?s:this.middle(s,h),r=h,a=c===i-3?u:this.middle(h,u);for(var d=1;e>=d;d++){var f=d/e;n.push(new l.Point((1-f)*(1-f)*o.x+2*f*(1-f)*r.x+f*f*a.x,(1-f)*(1-f)*o.y+2*f*(1-f)*r.y+f*f*a.y))}}return n}},{key:"middle",value:function(t,e){return new l.Point((t.x+e.x)/2,(t.y+e.y)/2)}},{key:"manhattanRouter",value:function(){var t=this;t.vertices=[],t._manhattanRouter(t.vertices,t.startP,t.startDir,t.endP,t.endDir)}},{key:"_manhattanRouter",value:function(t,e,i,n,o){var r=this,a=e.x-n.x,s=e.y-n.y,h=void 0,u=void 0;if(r.vertices.push(e),r.TOLxTOL>a*a&&r.TOLxTOL>s*s)return void r.vertices.push(r.endP);if(i===r.direction.LEFT)if(a>0&&r.TOL>s*s&&o===r.direction.RIGHT)h=n,u=o;else{if(0>a)h=new l.Point(e.x-r.MINDIST,e.y);else if(s>0&&o===r.direction.DOWN||0>s&&o===r.direction.UP)h=new l.Point(n.x,e.y);else if(i===o){var c=Math.min(e.x,n.x)-r.MINDIST;h=new l.Point(c,e.y)}else h=new l.Point(e.x-a/2,e.y);u=s>0?r.direction.UP:r.direction.DOWN}else if(i===r.direction.RIGHT)if(0>a&&r.TOL>s*s&&o===r.direction.LEFT)h=n,u=o;else{if(a>0)h=(0,l.Point)(e.x+r.MINDIST,e.y);else if(s>0&&o===r.direction.DOWN||0>s&&o===r.direction.UP)h=new l.Point(n.x,e.y);else if(i===o){var d=Math.max(e.x,n.x)+r.MINDIST;h=new l.Point(d,e.y)}else h=new l.Point(e.x-a/2,e.y);u=s>0?r.direction.UP:r.direction.DOWN}else if(i===r.direction.DOWN)if(r.TOL>a*a&&0>s&&o===r.direction.UP)h=n,u=o;else{if(s>0)h=new l.Point(e.x,e.y+r.MINDIST);else if(a>0&&o===r.direction.RIGHT||0>a&&o===r.direction.LEFT)h=new l.Point(e.x,n.y);else if(i===o){var f=Math.max(e.y,n.y)+r.MINDIST;h=new l.Point(e.x,f)}else h=new l.Point(e.x,e.y-s/2);u=a>0?r.direction.LEFT:r.direction.RIGHT}else if(i===r.direction.UP)if(r.TOL>a*a&&s>0&&o===r.direction.DOWN)h=n,u=o;else{if(0>s)h=new l.Point(e.x,e.y-r.MINDIST);else if(a>0&&o===r.direction.RIGHT||0>a&&o===r.direction.LEFT)h=new l.Point(e.x,n.y);else if(i===o){var p=Math.min(e.y,n.y)-r.MINDIST;h=new l.Point(e.x,p)}else h=new l.Point(e.x,e.y-s/2);u=a>0?r.direction.LEFT:r.direction.RIGHT}r._manhattanRouter(t,h,u,n,o)}}]),t}()},1128:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r._arr=i,r._showBl=!1,r}return r(e,t),a(e,[{key:"initlv",value:function(){var t=0;for(t=this._arr.length-1;t>=0;t--){var e=this._arr[t];this.addChild(e),e.gotoAndStop(t),e.tid=s.M.addTouch(e,{tab:this.onTouch},this)}this.current=this._arr[0]}},{key:"disposeAll",value:function(){var t=0;for(t=this._arr.length-1;t>=0;t--){var e=this._arr[t];s.M.removeTouch(e,e.tid),e.tid=null}this.current=null,this.removeAllListeners()}},{key:"onTouch",value:function(t){this._showBl?this.hide(t.target):this.show()}},{key:"hide",value:function(t){if(this._showBl=!1,this.current!=t){var e=this.current.currentFrame;this.current.gotoAndStop(t.currentFrame),t.gotoAndStop(e),this.dispatchEvent("buttonChange")}var i=0;for(i=0;this._arr.length>i;i++){var n=this._arr[i];TweenMax.to(n,.3,{y:0})}}},{key:"show",value:function(){this._showBl=!0;var t=0;for(t=0;this._arr.length>t;t++){var e=this._arr[t];TweenMax.to(e,.3,{y:80*-t})}}},{key:"selftype",get:function(){return this.current.currentFrame},set:function(t){if(this.selftype!=t){this._arr[t].gotoAndStop(this.selftype),this.current.gotoAndStop(t)}}}]),e}(l["default"])},1129:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i.classname="Magnifier",i.r=199,i.level=20,i.renderTexture=new PIXI.RenderTexture(i.main.renderer,2*i.r,2*i.r);var r=new PIXI.Sprite(i.renderTexture);r.x=-i.r,r.y=-i.r,i.addChild(r);var a=new PIXI.Graphics;return a.beginFill(16711680,1),a.drawCircle(0,0,i.r),a.endFill(),i.addChild(a),r.mask=a,trace(i),i}return r(e,t),a(e,[{key:"added",value:function(){this.updateSkin()}},{key:"moveEnd",value:function(t){this.updateSkin()}},{key:"updateSkin",value:function(){var t=new s.Point(this.parent.x,this.parent.y),e=this.getGlobalScale(),i=4/e,n=4/e,o=new PIXI.Matrix;o.translate(-t.x,-t.y),o.scale(i,n),o.translate(this.r,this.r),this.visible=!1,this.renderTexture.render(this.main.view,o,!0),this.visible=!0}}]),e}(l["default"])},1130:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(226),l=n(h),u=i(611),c=n(u),d=i(613),f=n(d),p=i(612),y=n(p),g=(i(1),PIXI.Sprite);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.NapeConst=t.moduleMain.NapeConst,i.right=new g,i.isLocked=!1,i.r1Number=0,i._sv0=new f["default"](i.paramObj),i._sh0=new y["default"](i.paramObj),i._svcon=new g,i._svh=new g,i.txt=new PIXI.Text("0.000 mm",{font:"20px Arial",fill:0}),i}return a(e,t),s(e,[{key:"initView",value:function(t,e,i,n,o,r,a){var s=this;this.addChild(t),t.x=e.x=0,t.y=e.y=0,this._sh=new y["default"](this.paramObj),this.addChild(this._sh),this._sh.added(),this._sh.x=5,this.right.addChild(e),this.addChild(this.right),this.roller=new c["default"](i,n,o,this.paramObj),this.roller.x=20,this.roller.$target=this.$target,this.right.addChild(this.roller),this.roller.init(),this.right.x=55,this._sv=new f["default"](this.paramObj),this.right.addChild(this._sv),this._sv.added(),this._sv.x=e.x-.5*e.width,this._sv.updata(0);var h=new PIXI.Graphics;h.beginFill(0),h.drawRect(-53,-37,36,73),h.endFill(),e.addChild(h),this._sv.mask=h,this.maxV=7500,this.maxH=30*this.NapeConst.SCALE_SPACE,this.right.addChild(this._svh),this._svh.addChild(r),this._svcon.addChild(this._sh0),this._svcon.addChild(this._sv0),this._svh.addChild(this._svcon),this._svh.addChild(a),this._sv0.added(),this._sh0.added(),this._sv0.updata(0),this._sv0.reScaleTxt(.5),this._sh0.reScaleTxt(.5),this._svh.scale.x=this._svh.scale.y=3,this._svh.y=-200,this._sh0.x=0,r.x=-55,a.x=-54,r.y=-40,a.y=-38,r.scale.x=r.scale.y=a.scale.x=a.scale.y=1/3,this._sh0.mask=r.getChildAt(1);var l=new PIXI.Graphics;l.beginFill(0),l.drawRect(85,18,80,182),l.endFill(),a.addChild(l),this._sv0.mask=l,this.roller.addEventListener("rolling",function(t){s.r1Rolling(t)}),this.addChild(this.txt),this.txt.y=50,this.txt.visible=!1,this.upScaleN()}},{key:"r1Rolling",value:function(t){if(!this.isLocked){var e=t.upordown;if(e){if(this.r1Number>this.maxV+200)return;this.r1Number+=4}else{if(0>this.r1Number-4)return;this.r1Number-=4}this.roller.updata(e),this.refresh(),this.dispatchEvent("rollChange")}}},{key:"refresh",value:function(){this._sv.updata(this.r1Number),this.upScaleN(),this.txt.text=(this.r1Number/500).toFixed(3)+" mm"}},{key:"disposeAll",value:function(){this.removeAllListeners(),this.roller.removeAllListeners(),this.roller.$target=null,this.roller=null}},{key:"upScaleN",value:function(){var t=this.r1Number/this.maxV*this.maxH/2;this.right.x=55+t,this._sv0.updata(this.r1Number),this._sv0.x=t,this._svcon.x=-t-24}},{key:"func_getNum",value:function(){return this.r1Number/500}}]),e}(l["default"])},1131:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function m(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:m(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=i(449),y=n(p),g=void 0,v=void 0,_=void 0,b=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return g=i.phy.nape,v=g.shape.Polygon,_=g.geom.Vec2,b=g.geom.Geom,i.NBOpticsStr=t.moduleMain.NBOpticsStr,i.vo=new f["default"](!1,!0,2),i.vo.var_open_angle=!1,i.vo.var_show_reflect=!1,i.vo.var_show_direction=!1,i.vo.bodyIsMultiShape=!0,i.center={x:-1.55,y:-167.85},i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear();for(var i=this.createOpticalshape(234.5,this.center.x,this.center.y,.322,.82),n=this.createOpticalshape(178,this.center.x,this.center.y,.322,.82),o=1;100>o;o++){var r=i[o-1],a=i[o],s=n[o-1],l=n[o],u=new g.geom.Vec2List;u.push(new _(r.x,r.y)),u.push(new _(a.x,a.y)),u.push(new _(l.x,l.y)),u.push(new _(s.x,s.y));var c=new v(u);""+c.validity()=="VALID"&&this.body.add(c)}this.body.get_shapes().foreach(function(e){e.get_userData().vo=t.vo,e.set_filter(t.NBOpticsStr.NO_HIT_FILTERS)}),this.spleft=this.addOneRoteShape(-170,-45,35),this.spright=this.addOneRoteShape(170,-45,35),this.spleft.get_userData().type="left",this.spright.get_userData().type="right",this.spleft.get_userData().useing=!1,this.spright.get_userData().useing=!1,this.createListener()}},{key:"createListener",value:function(){var t=this;this.addEventListener(y["default"].BEGIN,function(){t.spleft.get_userData().useing=!1,t.spright.get_userData().useing=!1}),this.addEventListener(y["default"].END,function(){t.hitTestShape(t.spleft)||t.hitTestShape(t.spright)})}},{key:"hitTestShape",value:function(t){function i(t,e){var i=e.sub(t);n.body.set_position(n.body.get_position().add(i))}for(var n=this,o=this.body.get_space(),r=t.get_userData(),a=o.bodiesInShape(t),s=0;s<a.get_length();s++){var h=a.at(s);if(h!==this.body){var l=h.userData.view;if(l&&l instanceof e){if(!l.spleft.get_userData().useing&&b.intersects(l.spleft,t)){if("left"===r.type){this.body.set_rotation(l.body.get_rotation()+Math.PI);i(this.body.localPointToWorld(_.get(this.left.x,this.left.y)),l.body.localPointToWorld(_.get(l.left.x,l.left.y)))}else{this.body.set_rotation(l.body.get_rotation()+this.arcAng);i(this.body.localPointToWorld(_.get(this.right.x,this.right.y)),l.body.localPointToWorld(_.get(l.left.x,l.left.y)))}return!0}if(!l.spright.get_userData().useing&&b.intersects(l.spright,t)){if("left"==r.type){this.body.set_rotation(l.body.get_rotation()-this.arcAng);i(this.body.localPointToWorld(_.get(this.left.x,this.left.y)),l.body.localPointToWorld(_.get(l.right.x,l.right.y)))}else{this.body.set_rotation(l.body.get_rotation()-Math.PI);i(this.body.localPointToWorld(_.get(this.right.x,this.right.y)),l.body.localPointToWorld(_.get(l.right.x,l.right.y)))}return!0}}}}return!1}},{key:"createOpticalshape",value:function(t,e,i,n,o,r){var a=[],s=new l.Point(e,i),h=t*Math.sin(Math.PI*n)*2,u=Math.PI*o,c=Math.asin(.5*h/t),d=2*c/100;this.arcAng=2*c;var f=0;for(f=0;100>f;f++){var p=s.x+Math.cos(u)*t,y=s.y+Math.sin(u)*t;u-=d,a.push({x:p,y:y})}return a}},{key:"getLocalBoundsElecs",value:function(){return[this.bg]}}]),e}(c["default"])},1132:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function O(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:O(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(1150),f=n(d),p=i(1152),y=n(p),g=i(1151),v=n(g),_=i(1149),b=n(_),m=i(1153),w=n(m);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.canRotate=!1,i.FOCUS_SCALE=1247.9/100,i.lightTopP=new l.Point(0,0),i.lightBotP=new l.Point,i.magnTopP=new l.Point,i.magnCenter=new l.Point,i.f=new l.Point,i.i_p1=new l.Point,i.screenP=new l.Point,i.multiple=0,i.var_fuzzy=0,i.valalpha=0,i.candleStr=i.getLocaleStr("candle"),i.lightType=i.candleStr,i.opticF=i.getLocaleStr("light_source")+"F",i.lightTypes=[i.candleStr,i.opticF,i.getLocaleStr("smiling_face")],i.yuanliStr=i.getLocaleStr("opticBench_yuanli"),i.shangStr=i.getLocaleStr("opticBench_shang"),i.zhongStr=i.getLocaleStr("opticBench_zhong"),i.xiaStr=i.getLocaleStr("opticBench_xia"),i.zgzStr=i.getLocaleStr("opticBench_zhugz"),i.dxStr=i.getLocaleStr("opticBench_bjgz"),i.lightModel=i.yuanliStr,i.pathTypes=[i.zgzStr,i.yuanliStr,i.dxStr],i.graphic=new PIXI.Graphics,i.blurfirs=new PIXI.filters.BlurFilter,i.autofocus=!1,i.lineGroup={line1:new PIXI.Graphics,line2:new PIXI.Graphics,line3:new PIXI.Graphics},i.crossline=new PIXI.Graphics,i.blur=0,i.setImg=0,i.focus=10,i.con=new PIXI.Container,i.maskCon=new PIXI.Container,i.shixiangP=new l.Point,i.currentlight=null,i.ledlight=null,i.facelight=null,i.candle=null,i.screen=null,i.magnifier=null,i.focusTxt=null,i.uTxt=null,i.vTxt=null,i.showzgz=!0,i.showUVdi=!0,i.laScreenMask=new PIXI.Graphics,i.imagery=new PIXI.Container,i.needAutofocus=!1,i.lensBorder=!0,i.ylStates={shang:!0,zhong:!0,xia:!0},i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.set_sensorEnabled_at(0,!0),this.removeChild(this.imgface),this.removeChild(this.imgF),this.removeChild(this.img),this.img.x=this.imgface.x=this.imgF.x=0,this.imgface.y=this.imgF.y=10,this.img.y=40;var i=this.body.get_shapes().at(0);this.setShapeInterFliter(i),i.set_sensorEnabled(!0),this.glass.jing.border2.visible=!1,this.candle=new f["default"](this.paramObj,this.fire,this.la,this.candleZuo),this.addChild(this.candle),this.candle.x=this.candleZuo.x,this.candle.y=this.candleZuo.y,this.candle.initView(),this.candle.$parent=this,this.currentlight=this.candle,this.fire.animationSpeed=.1,this.fire.play(),this.facelight=new v["default"](this.paramObj,this.facel,this.facezuo),this.addChild(this.facelight),this.facelight.$parent=this,this.facelight.initView(),this.facelight.visible=!1,this.ledlight=new y["default"](this.paramObj,this.ledf,this.ledzuo),this.addChild(this.ledlight),this.ledlight.$parent=this,this.ledlight.initView(),this.ledlight.visible=!1,this.screen=new b["default"](this.paramObj,this.sceen,this.scaleSceen),this.addChild(this.screen),this.screen.x=this.sceen.x,this.screen.y=this.sceen.y,this.screen.initView(),this.screen.$parent=this,this.magnifier=new w["default"](this.paramObj,this.dang,this.glass),this.addChild(this.magnifier),this.magnifier.x=this.glass.x,this.magnifier.y=this.glass.y,this.magnifier.initView(),this.magnifier.$parent=this,this.ledlight.limit=this.facelight.limit=this.candle.limit=[-615,this.magnifier],this.magnifier.limit=[this.currentlight,this.screen],this.screen.limit=[this.magnifier,635],this.addChild(this.con),this.removeChild(this.img),this.updateTransform(),this.picturetem(),this.addChild(this.graphic),this.laScreenMask.beginFill(0,0),this.laScreenMask.drawRect(0,0,165,169),this.laScreenMask.endFill(),this.scaleSceen.addChild(this.laScreenMask),this.laScreenMask.x=45,this.laScreenMask.y=-180,this.componentBox.visible=!1,this.addChild(this.imagery),this.imagery.filters=[this.blurfirs],this.addCursor(this.candleZuo,"zuoyou"),this.addCursor(this.glass.zuo,"zuoyou"),this.addCursor(this.sceen.zuo,"zuoyou"),this.addCursor(this.la,"shangxia"),this.addCursor(this.glass.jing,"shangxia"),this.addCursor(this.sceen.ping,"shangxia"),this.addEventListener("autoFocusMove",function(e){t.gotoAutoFocus(e)}),this.changOrigin({showValue:this.lightType}),this.addChild(this.zgzline),this.addChild(this.lineGroup.line1),this.addChild(this.lineGroup.line2),this.addChild(this.lineGroup.line3),this.addChild(this.crossline),this.crossline.visible=!1}},{key:"stopDragManager",value:function(){var t=this.body.userData.dragManager;t&&t.func_touchEnd()}},{key:"gotoAutoFocus",value:function(t){if(this.autofocus)if(t.tar!=this.screen)this.screen.x=this.i_p1.x,this.screen.checkposition();else{var e=this.getlineab(this.f,this.magnTopP,this.screen.x),i=this.getlineab(this.magnCenter,new l.Point(this.screen.x,e),null,this.lightTopP.y);this.currentlight.x=i-this.currentlight.p1.x,this.currentlight.checkposition()}else if(t.screenEnd){var n=Math.abs(this.screen.x-this.i_p1.x);n>10||(this.screen.x=this.i_p1.x,this.screen.checkposition())}}},{key:"getlineab",value:function(t,e,i,n){var o=(t.y-e.y)/(t.x-e.x),r=t.y-o*t.x;return i?i*o+r:n?(n-r)/o:void 0}},{key:"removed",value:function(){this.removedCursor(this.candleZuo),this.removedCursor(this.glass.zuo),this.removedCursor(this.sceen.zuo),this.removedCursor(this.la),this.removedCursor(this.glass.jing),this.removedCursor(this.sceen.ping),this.fire.stop(),this.candle.disposeAll(),this.ledlight.disposeAll(),this.facelight.disposeAll(),this.screen.disposeAll(),this.magnifier.disposeAll(),this.currentlight=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.img.currentFrame=this.fire.currentFrame,this.picturetem(),this.drawLine(),this.displayPic(),this.needAutofocus&&(this.needAutofocus=!1,this.dispatchEvent("autoFocusMove",{tar:this.currentlight}))}},{key:"setFocusPoint",value:function(){var t=this.focus*this.FOCUS_SCALE;this.zgzline.center_zp.x=0,this.zgzline.center_zp.y=0,this.zgzline.left_zp.x=-t,this.zgzline.left_zp.y=0,this.zgzline.right_zp.x=t,this.zgzline.right_zp.y=0,this.zgzline.left_zp2.x=-2*t,this.zgzline.left_zp2.y=0,this.zgzline.right_zp2.x=2*t,this.zgzline.right_zp2.y=0}},{key:"drawLine",value:function(){this.graphic.clear(),null!=this.focusTxt&&null!=this.uTxt.text&&this.vTxt.text&&(this.focusTxt.text="",this.uTxt.text="",this.vTxt.text=""),this.zgzline.x=this.magnCenter.x,this.zgzline.y=this.magnCenter.y;var t=this.focus*this.FOCUS_SCALE;this.setFocusPoint();var e=l.M.getJiaoP(this.magnTopP,this.f,this.lightTopP,this.magnCenter),i=e.x,n=e.y,o=l.M.getJiaoP(this.lightTopP,new l.Point(this.magnifier.x-t,this.magnCenter.y),this.magnCenter,new l.Point(this.magnCenter.x,this.magnCenter.y+50)),r=this.focus*this.FOCUS_SCALE>this.magnCenter.x-this.currentlight.x?.1:1;if(this.graphic.lineStyle(3,16777215,r),1==r)this.lineGroup.line1.clear(),this.lineGroup.line1.lineStyle(3,16777215),this.lineGroup.line1.moveTo(this.lightTopP.x,this.lightTopP.y),this.lineGroup.line1.lineTo(this.magnTopP.x,this.magnTopP.y),this.lineGroup.line1.lineTo(i,n),this.createArrow(this.lineGroup.line1,this.lightTopP,this.magnTopP),this.createArrow(this.lineGroup.line1,this.magnTopP,new l.Point(i,n)),this.lineGroup.line2.clear(),this.lineGroup.line2.lineStyle(3,16777215),this.lineGroup.line2.moveTo(this.lightTopP.x,this.lightTopP.y),this.lineGroup.line2.lineTo(i,n),this.createArrow(this.lineGroup.line2,this.lightTopP,this.magnCenter),this.createArrow(this.lineGroup.line2,this.magnCenter,new l.Point(i,n)),this.lineGroup.line3.clear(),this.lineGroup.line3.lineStyle(3,16777215),this.lineGroup.line3.moveTo(this.lightTopP.x,this.lightTopP.y),this.lineGroup.line3.lineTo(o.x,o.y),o.y>this.magnCenter.y+75||(this.lineGroup.line3.lineTo(i,n),this.createArrow(this.lineGroup.line3,o,new l.Point(i,n))),this.createArrow(this.lineGroup.line3,this.lightTopP,o);else{this.lineGroup.line1.clear(),this.lineGroup.line1.lineStyle(3,16777215),this.lineGroup.line1.moveTo(this.lightTopP.x,this.lightTopP.y),this.lineGroup.line1.lineTo(this.magnTopP.x,this.magnTopP.y);var a=l.M.getXianDianByDis(150,!1,new l.Point(this.magnCenter.x+t,this.magnCenter.y),this.magnTopP);this.lineGroup.line1.lineTo(a.x,a.y),l.M.drawDashed(this.lineGroup.line1,this.magnTopP,new l.Point(i,n),10,10),this.createArrow(this.lineGroup.line1,this.lightTopP,this.magnTopP),this.createArrow(this.lineGroup.line1,this.magnTopP,new l.Point(a.x,a.y)),this.lineGroup.line2.clear(),this.lineGroup.line2.lineStyle(3,16777215),this.lineGroup.line2.moveTo(this.lightTopP.x,this.lightTopP.y);var s=l.M.getXianDianByDis(150,!1,this.magnCenter,this.lightTopP);this.lineGroup.line2.lineTo(s.x,s.y),l.M.drawDashed(this.lineGroup.line2,this.lightTopP,new l.Point(i,n),10,10),this.createArrow(this.lineGroup.line2,this.lightTopP,new l.Point(s.x,s.y)),this.lineGroup.line3.clear()}this.graphic.lineStyle(3,16777215,1);if(this.graphic.moveTo(this.magnTopP.x,160),this.graphic.lineTo(this.magnTopP.x,150),this.graphic.moveTo(this.magnTopP.x,155),this.graphic.lineTo(this.screen.x,155),this.graphic.moveTo(this.screen.x,150),this.graphic.lineTo(this.screen.x,160),null==this.focusTxt&&(this.focusTxt=this.getText(),this.addChild(this.focusTxt)),this.focusTxt.text="v = "+Math.round((this.screen.x-this.magnTopP.x)/this.FOCUS_SCALE*10)/10,this.focusTxt.x=this.magnTopP.x+this.screen.x-this.focusTxt.width>>1,this.focusTxt.y=160,null===this.uTxt&&(this.uTxt=this.getText(),this.addChild(this.uTxt)),null===this.vTxt&&(this.vTxt=this.getText(),this.addChild(this.vTxt)),this.graphic.moveTo(this.magnTopP.x,155),this.graphic.lineTo(this.lightTopP.x,155),this.graphic.moveTo(this.lightTopP.x,150),this.graphic.lineTo(this.lightTopP.x,160),this.uTxt.text="u = "+Math.round((this.magnTopP.x-this.lightTopP.x)/this.FOCUS_SCALE*10)/10,this.uTxt.x=this.magnTopP.x+this.lightTopP.x-this.uTxt.width>>1,this.uTxt.y=160,1==r){this.crossline.clear(),this.crossline.lineStyle(3,16777215),this.crossline.moveTo(this.lightTopP.x,this.lightTopP.y),this.crossline.lineTo(this.magnTopP.x,this.magnTopP.y),this.crossline.lineTo(this.i_p1.x,this.i_p1.y),this.crossline.moveTo(this.lightTopP.x,this.lightTopP.y),this.crossline.lineTo(this.i_p1.x,this.i_p1.y);var h=l.M.getJiaoP(this.lightBotP,this.magnCenter,this.i_p1,new l.Point(this.i_p1.x,this.i_p1.y-50));this.crossline.moveTo(this.lightBotP.x,this.lightBotP.y),this.crossline.lineTo(h.x,h.y),this.crossline.lineTo(this.magnCenter.x,this.lightBotP.y),this.crossline.lineTo(this.lightBotP.x,this.lightBotP.y),this.crossline.moveTo(this.i_p1.x,this.i_p1.y),this.crossline.lineTo(h.x,h.y)}else this.crossline.clear()}},{key:"createArrow",value:function(t,e,i){var n=l.M.getCenP(e,i),o=l.M.getXianDianByDis(15,!1,n,i),r=l.M.rotaPointFromP(o,n,Math.PI/6),a=l.M.getDuiDianP(r,e,i);t.moveTo(r.x,r.y),t.lineTo(n.x,n.y),t.lineTo(a.x,a.y)}},{key:"getText",value:function(){return new PIXI.Text("",{font:"18px Arial",fill:16777215})}},{key:"picturetem",value:function(){this.lightTopP=new l.Point(this.currentlight.x+this.currentlight.p1.x,this.currentlight.y+this.currentlight.p1.y),this.lightBotP=new l.Point(this.currentlight.x+this.currentlight.p2.x,this.currentlight.y+this.currentlight.p2.y),this.magnTopP=new l.Point(this.magnifier.x,this.lightTopP.y),this.magnCenter=new l.Point(this.magnifier.x,this.magnifier.y+this.magnifier.center.y),this.f=new l.Point(this.magnifier.x+this.focus*this.FOCUS_SCALE,this.magnCenter.y),this.screenP=new l.Point(this.screen.x+this.screen.topPoint.x,this.screen.y+this.screen.topPoint.y),this.i_p1=l.M.getJiaoP(this.magnTopP,this.f,this.lightTopP,this.magnCenter),this.multiple=Math.abs(this.i_p1.y-this.magnCenter.y)/Math.abs(this.lightTopP.y-this.magnCenter.y)*(Math.abs(this.screenP.x-this.f.x)/Math.abs(this.i_p1.x-this.f.x));var t=Math.abs(this.screen.x-this.i_p1.x);t>300&&(t=300),1>t&&(t=0);this.valalpha=-1*t/300+1,this.blur>1&&(this.blur=1/this.blur),this.blur=10,1===this.valalpha&&(this.blur=0),this.magnifier.dangBool&&(this.valalpha=.5),this.f.x>this.screenP.x&&(this.valalpha=.1),this.setImg=this.magnTopP.x-this.focus*this.FOCUS_SCALE>this.lightTopP.x?0:this.lightTopP.x>this.magnTopP.x-this.focus*this.FOCUS_SCALE?1:2}},{key:"displayPic",value:function(){if(0==this.setImg){for(this.lightType==this.opticF&&1!==this.imgF.currentFrame&&this.imgF.gotoAndStop(1);this.con.children.length>0;)this.con.removeChildAt(0);this.maskCon.addChild(this.imagery),this.con.addChild(this.maskCon),this.imagery.scale=new l.Point(this.multiple,this.multiple),this.imagery.rotation=Math.PI,this.blurfirs.blur=this.blur,this.imagery.alpha=this.valalpha,this.maskCon.x=this.screen.x+this.scaleSceen.x+132,this.maskCon.y=this.screen.y+this.scaleSceen.y-75-this.currentlight.laOffsetY+this.magnifier.glassOfy,this.maskCon.y-=2*this.screen.pingOfy,this.laScreenMask&&(this.maskCon.mask=this.laScreenMask)}else if(1===this.setImg){for(this.lightType===this.opticF&&0!==this.imgF.currentFrame&&this.imgF.gotoAndStop(0);this.con.children.length>0;)this.con.removeChildAt(0);this.maskCon.addChild(this.imagery),this.maskCon.mask=null,this.imagery.rotation=0,this.con.addChild(this.maskCon),this.imagery.scale.x=this.imagery.scale.y=Math.abs(this.i_p1.y-this.magnCenter.y)/Math.abs(this.lightTopP.y-this.magnCenter.y)*.8,this.imagery.alpha=.4,this.lightType==this.candleStr?this.maskCon.y=this.i_p1.y+40*this.imagery.scale.x:this.lightType===this.opticF?this.maskCon.y=this.i_p1.y+10*this.imagery.scale.x:(this.imagery.scale.x*=-1,this.maskCon.y=this.i_p1.y+10*this.imagery.scale.x),this.maskCon.x=this.i_p1.x,this.blurfirs.blur=8}else if(2==this.setImg)for(;this.con.children.length>0;)this.con.removeChildAt(0)}},{key:"getDragRect",value:function(){return null==this.bg?{x:0,y:0,width:100,height:100}:{x:-this.bg.width/2,y:-this.bg.height/2,width:this.bg.width,height:this.bg.height}}},{key:"changeDang",value:function(t){this.magnifier.dangBool=t.checked}},{key:"setFocus",value:function(t){this.focus=l.M.getNumStr(t.showValue),this.autofocus&&(this.needAutofocus=!0),this.changeLensW()}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.candle={x:this.candle.x,y:this.candle.y,lay:this.candle.la.y},t.currentxy={x:this.currentlight.x,y:this.currentlight.y},t.magn={x:this.magnifier.x,y:this.magnifier.y,ofy:this.magnifier.glassOfy},t.sceen={x:this.screen.x,y:this.screen.y,ofy:this.screen.pingOfy},t.focus=this.focus,t.autofocus=this.autofocus,t.lightType=this.lightType,t.lightModel=this.lightModel,t.ylStates=this.ylStates,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.candle&&(this.candle.x=t.candle.x,this.candle.y=t.candle.y,this.candle.la.y=t.candle.lay,this.candle.changeLa(),this.magnifier.x=t.magn.x,this.magnifier.y=t.magn.y,this.magnifier.changeJing(t.magn.ofy),this.screen.x=t.sceen.x,this.screen.y=t.sceen.y,this.screen.changeJing(t.sceen.ofy)),t.focus&&this.setFocus({showValue:t.focus+""}),t.lightType&&this.changOrigin({showValue:t.lightType}),t.currentxy&&(this.currentlight.x=t.currentxy.x,this.currentlight.y=t.currentxy.y),t.autofocus&&this.changeAutoFocus({checked:t.autofocus}),t.ylStates&&(this.lightModel=t.lightModel,this.ylStates=t.ylStates,this.lineGroup.line1.visible=this.ylStates.shang,this.lineGroup.line2.visible=this.ylStates.zhong,this.lineGroup.line3.visible=this.ylStates.xia,this.changPathType({showValue:this.lightModel}))}},{key:"changOrigin",value:function(t){var e=t.showValue||this.lightTypes[t.checked];this.lightType=e;var i=null;this.imagery.removeChildren(),e===this.candleStr?(this.candle.visible=!0,this.ledlight.visible=!1,this.facelight.visible=!1,i=this.candle,this.imagery.addChild(this.img)):e===this.opticF?(this.candle.visible=!1,this.ledlight.visible=!0,this.facelight.visible=!1,i=this.ledlight,this.imagery.addChild(this.imgF)):(this.candle.visible=!1,this.ledlight.visible=!1,this.facelight.visible=!0,i=this.facelight,this.imagery.addChild(this.imgface)),i.x=this.currentlight.x,i.y=this.currentlight.y,this.currentlight=i}},{key:"changPathType",value:function(t){this.lightModel=t.showValue||this.pathTypes[t.checked],this.lightModel==this.zgzStr?(this.crossline.visible=!1,this.lineGroup.line1.visible=!1,this.lineGroup.line2.visible=!1,this.lineGroup.line3.visible=!1):this.lightModel==this.yuanliStr?(this.crossline.visible=!1,this.lineGroup.line1.visible=this.ylStates.shang,this.lineGroup.line2.visible=this.ylStates.zhong,this.lineGroup.line3.visible=this.ylStates.xia):this.lightModel==this.dxStr&&(this.crossline.visible=!0,this.lineGroup.line1.visible=!1,this.lineGroup.line2.visible=!1,this.lineGroup.line3.visible=!1),this.freshLibPan()}},{key:"changeLensBorder",value:function(t){this.lensBorder=t.checked,this.lensBorder?(this.glass.jing.border1.visible=!0,this.glass.jing.border2.visible=!1):(this.glass.jing.border1.visible=!1,this.glass.jing.border2.visible=!0,this.changeLensW())}},{key:"changeLensW",value:function(){this.glass.jing.border2.glass.scale.x=15/this.focus}},{key:"changeAutoFocus",value:function(t){(this.autofocus=t.checked)&&(this.needAutofocus=!0)}},{key:"getLocalBoundsElecs",value:function(){return[this.bg]}},{key:"changeShowzgz",value:function(t){var e=t.checked;this.showzgz=e,this.zgzline.visible=e}},{key:"changeShowUVdi",value:function(t){var e=t.checked;this.showUVdi=e,this.focusTxt.visible=e,this.graphic.visible=e,this.uTxt.visible=e}},{key:"getTipMess",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getTipMess",this).call(this);return t+="\n    "+this.getLocaleStr("focus")+" f="+this.focus+"cm\n    "}},{key:"getConf",value:function(){var t=this,e={};if(e.confArr=[],e.confArr.push(this.getRadio([this.getLocaleStr("light_source"),l.ArrayUtil.getIndexFromValue(this.lightTypes,this.lightType),this.lightTypes,this.changOrigin.bind(this)]),this.getRadio([this.getLocaleStr("opticBench_glxianshi"),l.ArrayUtil.getIndexFromValue(this.pathTypes,this.lightModel),this.pathTypes,this.changPathType.bind(this)]),this.getSwitch([this.getLocaleStr("cover_half_lens"),this.magnifier.dangBool,this.changeDang,this]),this.getSwitch([this.getLocaleStr("convex_lens_border"),this.lensBorder,this.changeLensBorder,this]),this.getScrollBar([this.getLocaleStr("focus"),!0,"",20,4,this.focus+"",1,this.setFocus,this]),this.getSwitch(["显示主光轴",this.showzgz,this.changeShowzgz,this]),this.getSwitch(["物、像距",this.showUVdi,this.changeShowUVdi,this]),this.getSwitch([this.getLocaleStr("autofocus"),this.autofocus,this.changeAutoFocus,this])),this.lightModel==this.yuanliStr){e.confArr.splice(2,0,this.getSwitch([this.getLocaleStr("opticBench_shang"),this.ylStates.shang,function(e){t.lineGroup.line1.visible=e.checked,t.ylStates.shang=e.checked},this]),this.getSwitch([this.getLocaleStr("opticBench_zhong"),this.ylStates.zhong,function(e){t.lineGroup.line2.visible=e.checked,t.ylStates.zhong=e.checked},this]),this.getSwitch([this.getLocaleStr("opticBench_xia"),this.ylStates.xia,function(e){t.lineGroup.line3.visible=e.checked,t.ylStates.xia=e.checked},this]))}return e}}]),e}(c["default"])},1133:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function _(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:_(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=(i(1),i(457)),u=n(l),c=i(463),d=n(c),f=i(451),p=(n(f),void 0),y=void 0,g=void 0,v=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,g=p.shape.Circle,v=p.geom.Vec2,i.sp1=null,i.sp2=null,i.sp3=null,i.sp4=null,i.vo=new d["default"](!0,!0,i.rate),i.isTu=!0,i.f=100,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear(),trace(this);var i=new y(y.rect(-10,-100,20,200));this.body.add(i),i.set_sensorEnabled(!0),i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS);var n=new y(y.rect(-2,-100,4,200));this.body.add(n),n.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),n.get_userData().vo=this.vo,this.vo.sensor=!0,this.vo.sensorObj.handleLight=function(e,i,n,o){t.handleLight(e,i,n,o)}}},{key:"removed",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this)}},{key:"handleLight",value:function(t,e,i,n){}},{key:"getData",value:function(){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this)}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t)}},{key:"aotoChanged",value:function(t){this.isTu=t.checked}},{key:"fChanged",value:function(t){this.f=t.showValue}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this),i=t.confArr;return i.push(this.ComponentProperty.getSwitch("凸/凹",this.isTu,this.aotoChanged,this),this.ComponentProperty.getScrollBar("焦距",!0,"cm",1e3,1,this.f,1,this.fChanged,this)),i}}]),e}(u["default"])},1134:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=(i(1),i(457)),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0,g=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.shape.Polygon,y=f.shape.Circle,g=f.geom.Vec2,i.zoom=null,i.thermometer=null,i.bg=null,i.front=null,i.line=null,i.roomT=20,i.curTx=i.roomT,i.toTx=i.curTx,i.level=16,i.lightE=0,i.showZoomFlag=!1,i.vo=new d["default"](!1,!1,i.rate),i.vo.sensor=!0,i}return a(e,t),s(e,[{key:"freshTx",value:function(){this.thermometer.y=690*(this.curTx-18)/17-907,this.line.height=46+358*(this.curTx-18)/17}},{key:"showZoom",value:function(t){this.thermometer.mask.visible=t,this.thermometer.visible=t,this.zoom.visible=t,this.showZoomFlag=t}},{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear();var t=new p(p.rect(-6,218,11,31));this.body.add(t),t.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),t.get_userData().vo=this.vo,this.photosensitiveSp=t;var i=new p(p.box(20,503));i.set_sensorEnabled(!0),i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.body.add(i);var n=new PIXI.Graphics;n.beginFill(16711680,.5),n.drawCircle(178,-122,123),n.endFill(),this.addChild(n),this.thermometer.mask=n,this.freshTx(),this.showZoom(!0)}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.toTx=this.getTbyE(this.lightE),this.toTx>37.5&&(this.toTx=37.5),this.lightE=0,this.curTx!==this.toTx){var t=this.toTx-this.curTx;.01>Math.abs(t)?this.curTx=this.toTx:this.curTx+=.005*t,this.freshTx()}}},{key:"removed",value:function(){this.vo.sensorObj.handleLight=null,this.vo.sensorObj=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"getTbyE",value:function(t){return t*=.01,this.roomT+20*(1-1/(t/19+1))}},{key:"handleLight",value:function(t,e,i,n){var o=t.I,r=n.lineN;this.lightE+=1e4*o*o*(1/(1e3*Math.abs(r-1.495)+1))}},{key:"getData",value:function(){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this)}},{key:"setDataOver",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setDataOver",this).call(this,t)}},{key:"changeShowZoomFlag",value:function(t){this.showZoomFlag=t.checked,this.showZoom(this.showZoomFlag)}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(this.ComponentProperty.getSwitch(this.language.getLocaleStr("bubble"),this.showZoomFlag,this.changeShowZoomFlag,this)),t}},{key:"selectRenderChild",value:function(){return this.bg.getBounds()}}]),e}(u["default"])},1135:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=(i(1),i(457)),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return r(e,t),a(e,[{key:"init",value:function(){this._width=this.bg.width,this._height=this.bg.height,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.get_shapes().at(0).set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addOneRoteShape(-this.bg.width/2+20,0,50),this.addOneRoteShape(this.bg.width/2-20,0,50)}},{key:"getDragRect",value:function(){return{x:.5*-this.width,y:.5*-this.height,width:this.bg.width,height:this.bg.height}}},{key:"rotateChange",value:function(t,e){this.showToolDatas()}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.rotation=this.componentBox.rotation,t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.componentBox.rotation=t.rotation}}]),e}(l["default"])},1136:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function O(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:O(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=i(449),y=n(p),g=void 0,v=void 0,_=void 0,b=void 0,m=void 0,w=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.classname="Periscope",g=i.phy.nape,v=g.shape.Polygon,_=g.geom.Vec2,b=g.geom.Ray,m=g.phys.BodyType,w=g.geom.Mat23,i.isremove=!1,i.vo=new f["default"](!0,!1,1),i.canRotate=!1,i.horiStr=i.language.getLocaleStr("horizontal"),i.vertStr=i.language.getLocaleStr("vertical"),i.bottomSp=null,i.topSp=null,i.topglass=null,i.botglass=null,i.tophit=null,i.bothit=null,i.topDir=0,i.botDir=1,i.glassW=115,i.glassH=697,i.borderW=10,i.angflag=1,i.openNei=!1,i.filtervo=new f["default"](!1,!0,1),i.filtervo.var_show_reflect=!1,i.filtervo.var_show_direction=!1,i.draging=!1,i.useTop=!0,i.hitAble=!1,i.shapeA={type:"A",view:i,shape:null,dir:0},i.shapeB={type:"B",view:i,shape:null,dir:1},i.shapeA.innerConnected=i.shapeB,i.shapeA.outterConnected=null,i.shapeB.innerConnected=i.shapeA,i.shapeB.outterConnected=null,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addCursor(this.bottomSp.botskin,"hand"),this.addCursor(this.bottomSp.topskin,"hand"),this.topskinId=l.M.addTouch(this.bottomSp.topskin,{tab:this.topclick},this),this.botskinId=l.M.addTouch(this.bottomSp.botskin,{tab:this.botclick},this),this.dragBegin=function(e){t.draging=!0,t.lastVec=t.body.get_position().copy()},this.dragEnd=function(i){t.draging=!1;var n=e.getShapeConnectedEnd(t.shapeA),o=e.getShapeConnectedEnd(t.shapeB);n&&e.hitConnected(n),o&&e.hitConnected(o)},this.addEventListener(y["default"].BEGIN,this.dragBegin),this.addEventListener(y["default"].END,this.dragEnd),this.topCon.addChild(this.topSp),this.setTopDir(1),this.setBottomDir(0),this.createPerShape(),this.topSp.body.scale.y=1.1}},{key:"removed",value:function(){this.removedCursor(this.bottomSp.botskin,"hand"),this.removedCursor(this.bottomSp.topskin,"hand"),l.M.removeTouch(this.bottomSp.topskin,this.topskinId),l.M.removeTouch(this.bottomSp.botskin,this.botskinId),this.removeEventListener(y["default"].BEGIN,this.dragBegin),this.removeEventListener(y["default"].END,this.dragEnd),e.forEachConnected(this.shapeA,function(t){t.shapeA=null,t.shapeB=null,t.removeFromFramework(t)}),this.shapeA=null,this.shapeB=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.draging){var t=this.body.get_position(),i=t.sub(this.lastVec);e.forEachConnected(this.shapeA,function(t){e.translateBody(t.body,i)}),this.lastVec=t.copy()}}},{key:"setTopDir",value:function(t){this.topDir=t,this.shapeA.dir=t,this.topSp.topskin.gotoAndStop(t),this.bottomSp.topskin.gotoAndStop(t)}},{key:"setBottomDir",value:function(t){this.botDir=t,this.shapeB.dir=t,this.topSp.botskin.gotoAndStop(t),this.bottomSp.botskin.gotoAndStop(t)}},{key:"setOpenNei",value:function(t){this.setSelfOpenNei(t),e.forEachConnected(this.shapeA,function(e){e.setSelfOpenNei(t)})}},{key:"setSelfOpenNei",value:function(t){this.topSp.visible=!t}},{key:"topclick",value:function(t){this.shapeA.outterConnected||(this.setTopDir(0===this.topDir?1:0),this.createPerShape(),this.freshGlow())}},{key:"botclick",value:function(t){this.shapeB.outterConnected||(this.setBottomDir(0===this.botDir?1:0),this.createPerShape(),this.freshGlow())}},{key:"addNapeRectShape",value:function(t,e,i,n,o,r){var a=new v(v.box(i,n));return this.body.add(a),a.rotate(o),a.translate(_.get(t,e)),r&&a.set_filter(r),a}},{key:"createPerShape",value:function(){var t=this,e=this.glassW,i=this.glassH,n=this.borderW,o=(e+70)/2,r=i/2+e,a=i/2,s=(i+e)/2,h=this.body.get_shapes();h.filter(function(e){return e===t.tophit||e===t.bothit}),this.addNapeRectShape(-e/2,0,n,i,0,this.NBOpticsStr.PERISCOPE),this.addNapeRectShape(e/2,0,n,i,0,this.NBOpticsStr.PERISCOPE),this.addNapeRectShape(0,0,e,i,0,this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addNapeRectShape(0,-s,e,e,0,this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addNapeRectShape(0,s,e,e,0,this.NBOpticsStr.LIGHT_AND_HITFILTERS);var l=0===this.topDir?-1:1,u=-l*Math.PI/4;2>this.shapeA.dir?(this.addNapeRectShape(-10*l,-s-10,1.4*(e+10),n,u,this.NBOpticsStr.PERISCOPE),this.topglass=this.addNapeRectShape(0,-s,1.4*e,n,u,this.NBOpticsStr.PERISCOPE_MIRROR),this.topglass.get_userData().vo=this.vo):2===this.shapeA.dir&&(this.addNapeRectShape(-e/2,-s,n,e,0,this.NBOpticsStr.PERISCOPE),this.addNapeRectShape(e/2,-s,n,e,0,this.NBOpticsStr.PERISCOPE)),this.shapeA.outterConnected?h.filter(function(e){return e!==t.tophit}):(this.addNapeRectShape(l*o,-s,70,e,0,this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.addNapeRectShape(l*o,-r,70,n,0,this.NBOpticsStr.PERISCOPE),this.addNapeRectShape(l*o,-a,70,n,0,this.NBOpticsStr.PERISCOPE),this.tophit=this.addNapeRectShape(0,-s,e,e,0,this.NBOpticsStr.PERISCOPE_HIT),this.tophit.set_sensorEnabled(!0),this.tophit.get_userData().isPeriscope=!0,this.tophit.get_userData().isHead=!0,this.tophit.get_userData().connectObj=this.shapeA,this.shapeA.shape=this.tophit),l=0===this.botDir?-1:1,u=l*Math.PI/4,2>this.shapeB.dir?(this.addNapeRectShape(-10*l,s+10,1.4*(e+10),n,u,this.NBOpticsStr.PERISCOPE),this.botglass=this.addNapeRectShape(0,s,1.4*e,n,u,this.NBOpticsStr.PERISCOPE_MIRROR),this.botglass.get_userData().vo=this.vo):2===this.shapeB.dir&&(this.addNapeRectShape(-e/2,s,n,e,0,this.NBOpticsStr.PERISCOPE),this.addNapeRectShape(e/2,s,n,e,0,this.NBOpticsStr.PERISCOPE)),this.shapeB.outterConnected?h.filter(function(e){return e!==t.bothit}):(this.addNapeRectShape(l*o,s,70,e,0,this.NBOpticsStr.LIGHT_AND_HITFILTERS),this.botborder1=this.addNapeRectShape(l*o,r,70,n,0,this.NBOpticsStr.PERISCOPE),this.botborder2=this.addNapeRectShape(l*o,a,70,n,0,this.NBOpticsStr.PERISCOPE),this.bothit=this.addNapeRectShape(0,s,e,e,0,this.NBOpticsStr.PERISCOPE_HIT),this.bothit.set_sensorEnabled(!0),this.bothit.get_userData().isPeriscope=!0,this.bothit.get_userData().isHead=!1,this.bothit.get_userData().connectObj=this.shapeB,this.shapeB.shape=this.bothit),this.setSelfHitAble(this.hitAble)}},{key:"setHitAble",value:function(t){var i=this;this.setSelfHitAble(t),e.forEachConnected(this.shapeA,function(t){t.setSelfHitAble(i.hitAble)})}},{key:"setSelfHitAble",value:function(t){this.hitAble=t;var e=void 0,i=void 0;t?(e=this.NBOpticsStr.NO_HIT_FILTERS,i=this.NBOpticsStr.PERISCOPE):(e=this.NBOpticsStr.PERISCOPE,i=this.NBOpticsStr.NO_HIT_FILTERS);for(var n=this.body.get_shapes(),o=0;o<n.get_length();o++){var r=n.at(o);r.get_filter()===e&&r.set_filter(i)}}},{key:"handleLight",value:function(t,e,i,n){}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.dir={top:this.topDir,bot:this.botDir},t.angflag=this.angflag,t.openNei=this.openNei,t.hitAble=this.hitAble,t}},{key:"setData",value:function(t){var i=this;t.rotation=0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.dir&&(2>t.dir.top&&this.setTopDir(t.dir.top),2>t.dir.bot&&this.setBottomDir(t.dir.bot)),this.angflag=t.angflag||0,this.openNei=t.openNei,this.hitAble=t.hitAble||!1,this.changeNei({checked:this.openNei}),this.changeDir({checked:this.angflag}),this.setSelfHitAble(this.hitAble),this.createPerShape(),setTimeout(function(){e.hitConnected(i.shapeA),e.hitConnected(i.shapeB)},100)}},{key:"changeHitAble",value:function(t){this.setHitAble(t.checked)}},{key:"changeDir",value:function(t){this.angflag=t.checked,this.body.set_rotation(0===this.angflag?Math.PI/2:0)}},{key:"changeNei",value:function(t){this.openNei=t.checked,this.setOpenNei(this.openNei)}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this),i=t.confArr,n=0==this.angflag?this.horiStr:this.vertStr,o=[this.horiStr,this.vertStr];return i.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("angle"),!1,"",n,o,this,this.changeDir,0,0),this.ComponentProperty.getSwitch(this.language.getLocaleStr("internal_structure"),this.openNei,this.changeNei,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("collision"),this.hitAble,this.changeHitAble,this)),(this.shapeA.outterConnected||this.shapeB.outterConnected)&&i.shift(),t}},{key:"selectRenderChild",value:function(){return this.updateTransform(),this.getBounds()}},{key:"showGlowSP",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"showGlowSP",this).call(this,t),this.glowSPArr&&t&&(this.glowSPArr[0][0].visible=0!==this.topDir,this.glowSPArr[0][1].visible=!this.glowSPArr[0][0].visible,this.glowSPArr[0][2].visible=0!==this.botDir,this.glowSPArr[0][3].visible=!this.glowSPArr[0][2].visible)}}],[{key:"removeConnected",value:function(t){t.outterConnected&&(t.outterConnected.outterConnected=null,t.outterConnected=null)}},{key:"getShapeConnectedEnd",value:function(t){for(var e=t;e.outterConnected;)if((e=e.outterConnected.innerConnected)===t)return null;return e}},{key:"hitConnected",value:function(t){for(var i=t.view.body.get_arbiters(),n=0;n<i.get_length();n++){var o=i.at(n),r=o.get_shape1(),a=o.get_shape2(),s=r.get_userData(),h=a.get_userData();if(s.isPeriscope&&h.isPeriscope){var l=s.connectObj,u=h.connectObj;l.view.angflag===u.view.angflag&&l.type===u.type||(e.isInChain(l,u)||(l===t?(e.alignView(u,l),l.view.setHitAble(u.view.hitAble),l.view.setOpenNei(u.view.openNei)):(e.alignView(l,u),u.view.setHitAble(l.view.hitAble),u.view.setOpenNei(l.view.openNei))),e.connect2Shape(l,u),l.view.createPerShape(),u.view.createPerShape())}}}},{key:"isInChain",value:function(t,e){for(;e;){var i=e.innerConnected,n=e.innerConnected.outterConnected;if(i===t||n===t)return!0;e=n}return!1}},{key:"connect2Shape",value:function(t,i){t.outterConnected=i,i.outterConnected=t,t.view.angflag===i.view.angflag?(e.setConnectedDir(t,2),e.setConnectedDir(i,2)):0===t.view.angflag?(e.setConnectedDir(t,3),t.view.x>i.view.x?e.setConnectedDir(i,1):e.setConnectedDir(i,0)):(e.setConnectedDir(i,3),t.view.x>i.view.x?e.setConnectedDir(t,0):e.setConnectedDir(t,1))}},{key:"setConnectedDir",value:function(t,e){"A"==t.type?t.view.setTopDir(e):t.view.setBottomDir(e)}},{key:"alignView",value:function(t,i){var n=t.shape.get_worldCOM(),o=i.shape.get_worldCOM(),r=n.sub(o);e.translateBody(i.view.body,r),e.forEachConnected(i,function(t){e.translateBody(t.body,r)})}},{key:"vec2ToPoint",value:function(t){return new l.Point(t.get_x(),t.get_y())}},{key:"translateBody",value:function(t,e){t.set_position(t.get_position().add(e))}},{key:"forEachConnected",value:function(t,e){if(t){for(var i=t.outterConnected;i;)if(e(i.view),(i=i.innerConnected.outterConnected)&&i.view===t.view)return;for(i=t.innerConnected.outterConnected;i;)e(i.view),i=i.innerConnected.outterConnected}}}]),e}(c["default"])},1137:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return f=i.phy.nape,p=f.shape.Polygon,y=f.geom.Vec2,i.vo=new d["default"](!0,!1),i}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.bg.width-13,this._height=this.bg.height-5,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.addCbType(this.CbTypeStr.ONEPART_GLASS),this.bg.x=.5*-this.bg.width,this.bg.y=.5*-this.bg.height;var t=this.body.shapesAt(0);t.set_localCOM(y.get(0,5)),t.get_userData().vo=this.vo,t.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),this.func_createBeimian();var i=new PIXI.Graphics;i.beginFill(0,0),i.drawRect(.5*-this._width,.5*-this._height-30,this._width,this._height+60),i.endFill(),this.addChild(i),i.cacheAsBitmap=!0;var n=new p(p.rect(.5*-this.bg.width,-50,this.bg.width,100));this.body.add(n),this.setShapeInterFliter(n),n.set_sensorEnabled(!0),this.addOneRoteShape(-170,0,35),this.addOneRoteShape(170,0,35)}},{key:"func_createBeimian",value:function(){var t=this.bg.width-12,e=new p(p.rect(.5*-t,.5*-this.bg.height+10,t,this.bg.height-5));this.body.add(e),e.set_filter(this.NBOpticsStr.NO_HIT_FILTERS)}},{key:"getLocalBoundsElecs",value:function(){return[this.bg]}}]),e}(u["default"])},1138:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(226),c=n(u),d=i(1155),f=n(d),p=i(1154),y=n(p);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.view01=null,i.view02=null,i.sideView=null,i.planView=null,i.viewType=1,i.canReset=!0,i.showwg=!1,i}return a(e,t),s(e,[{key:"added",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this),this.sideView=new f["default"](this.view01,this),this.planView=new y["default"](this.view02,this),this.changeViewType({showValue:this.viewType}),this.tickerId=l.M.addTicker(function(){t.update()},this,!0)}},{key:"update",value:function(){this.sideView.update(),this.planView.update()}},{key:"removed",value:function(){l.M.removeTicker(this.tickerId),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"reset",value:function(){this.sideView.reset(),this.planView.reset()}},{key:"changeViewType",value:function(t){if(3==t.showValue){this.showwg=!this.showwg;var e=this.showwg?1:0,i="";i=this.language.getLocaleStr(0==e?"grid_pmirror":"white_paper"),this.view02.bg.currentFrame=e,this.view01.bg.currentFrame=e,this.sideView.changeBtnLabel(this.sideView.wgbtn,i),this.planView.changeBtnLabel(this.planView.wgbtn,i)}else this.viewType=t.showValue-0,this.planView.hasLine=this.sideView.hasLine,this.planView.pointArr=this.sideView.pointArr,this.sideView.setVisible(1===this.viewType),this.planView.setVisible(1!==this.viewType)}},{key:"getData",value:function(){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this)}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t)}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(),t}}]),e}(c["default"])},1139:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,i.mirrorSp=null,i.sp=new PIXI.Sprite,i.line=new PIXI.Graphics,i.vo=new f["default"](!1,!0,1),i.spMask=new PIXI.Graphics,i.posit=0,i.space=5,i.tscla=360,i.total=i.space*i.tscla,i.textObject={},i.poro=0,i._ro=0,i.canRotate=!1,i}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear(),this.mirrorSp=new y(y.rect(-2.5,-170,5,240)),this.body.add(this.mirrorSp),this.mirrorSp.get_userData().vo=this.vo,this.mirrorSp.set_filter(this.NBOpticsStr.NO_HIT_FILTERS),this.addChild(this.spMask),this.spMask.beginFill(0),this.spMask.drawRect(-8,-166,40,235),this.spMask.endFill(),this.sp.mask=this.spMask,this.createSp();var t=new y(y.box(this.bg.width,this.bg.height));this.body.add(t),this.setShapeInterFliter(t),t.set_sensorEnabled(!0),this.maskTouchid=l.M.addTouch(this.spMask,{begin:this.spBegin,move:this.spMove,end:this.spEnd},this),this.addCursor(this.spMask,"shangxia")}},{key:"removed",value:function(){this.removedCursor(this.spMask),l.M.removeTouch(this.spMask,this.maskTouchid),this.sp.mask=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"spBegin",value:function(t){this.touchEnabled=!1,this.oldP=new l.Point(t.data.global.x,t.data.global.y)}},{key:"spMove",value:function(t){if(this.oldP){var e=new l.Point(t.data.global.x,t.data.global.y);e.y>this.oldP.y&&(this._ro+=this.space),this.oldP.y>e.y&&(this._ro-=this.space),this.updata(this._ro),this.oldP=e,this.poro=this.posit/this.total*360}}},{key:"spEnd",value:function(t){this.touchEnabled=!0}},{key:"createSp",value:function(){this.addChild(this.sp),this.sp.y=-50,this.sp.addChild(this.line);var t=0;for(t=0;this.tscla/this.space>t;t++){var e=new PIXI.Text(t*this.space+"",{font:"18px Arial",fill:0});this.sp.addChild(e),e.pivotY=4,e.x=10,this.textObject["t"+t*this.space]=e}this.reScaleTxt(.5),this.updata(0)}},{key:"reScaleTxt",value:function(t){for(var e in this.textObject){var i=this.textObject[e];i.scale.x=i.scale.y=t}}},{key:"updata",value:function(t){this.posit=-t%this.total,this.drawLine()}},{key:"handleLight",value:function(t,e,i,n){t.zsNbRay&&t.zsNbRay.setPolar(this.poro*Math.PI/180)}},{key:"drawLine",value:function(){this.line.clear(),this.line.lineStyle(2,0,.5);var t=0;for(t=0;this.tscla>t;t++){var e=-(t*this.space+this.posit);-this.total/2>e&&(e+=this.total),e>this.total/2&&(e-=this.total),-this.total/2>e&&(e+=this.total);var i=void 0;if(t%this.space==0){i=10;var n=this.textObject["t"+t];n.y=e}else i=0;if(t%30!=0){var n=this.textObject["t"+t];n&&(n.visible=!1)}this.line.moveTo(0,e),this.line.lineTo(i,e)}}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.poro=this.poro,t.ro=this._ro,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this._ro=t.ro||0,this.updata(this._ro),this.poro=this.posit/this.total*360}},{key:"selectRenderChild",value:function(){return this.bg.getBounds()}}]),e}(c["default"])},1140:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(449),c=n(u),d=i(576),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.geom.Vec2,i.level=20,i.rayDat=[{co:16711680,lambda:i.opticalUtil,n:1.513}],i.greenDat=[{co:65280,n:1.549}],i.yellowDat=[{co:16776960,n:1.537}],i.ziDat=[{co:13369599,n:1.579}],i.ray=null,i.redStr=i.language.getLocaleStr("red"),i.greenStr=i.language.getLocaleStr("green"),i.yelStr=i.language.getLocaleStr("yellow"),i.violetStr=i.language.getLocaleStr("violet"),i.colorArr=[i.redStr,i.greenStr,i.yelStr,i.violetStr],i.colname=i.redStr,i.ruRot=!1,i.firstRuVec2=null,i.lightStart=[117,0],i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.ray=this.vectorRay[0],this.body.mass=10,this.setColor({showValue:this.colname}),this.beginfunc=function(e){t.beginTouch(e)},this.addEventListener(c["default"].BEGIN,this.beginfunc),this.addOneRoteShape(95,0,30)}},{key:"beginTouch",value:function(t){if(this.endTouch(t),this.ruRot){var e=this.findEndP(this.ray.rootRay);this.firstRuVec2=y.get(e.x,e.y),this.addEventListener(c["default"].END,this.endTouch)}}},{key:"findEndP",value:function(t){return t.owner&&"FoldPaperboard"==t.owner.classname&&t.zsNbRay?this.findEndP(t.zsNbRay):t.endP}},{key:"moveTouch",value:function(t){var e=this.firstRuVec2,i=this.body.get_position();this.body.set_rotation(Math.atan2(e.get_y()-i.get_y(),e.get_x()-i.get_x())),this.updateTransform()}},{key:"endTouch",value:function(t){this.firstRuVec2=null,this.removeEventListener(c["default"].END,this.endTouch)}},{key:"update",value:function(){this.ruRot&&this.firstRuVec2&&this.moveTouch(null),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this)}},{key:"setColor",value:function(t){var e=t.showValue;this.colname=e,e===this.redStr?(this.bg.gotoAndStop(0),this.ray.col=this.rayDat[0].co,this.ray.lineN=this.rayDat[0].n):e===this.greenStr?(this.bg.gotoAndStop(1),this.ray.col=this.greenDat[0].co,this.ray.lineN=this.greenDat[0].n):e===this.yelStr?(this.bg.gotoAndStop(2),this.ray.col=this.yellowDat[0].co,this.ray.lineN=this.yellowDat[0].n):e===this.violetStr&&(this.bg.gotoAndStop(3),this.ray.col=this.ziDat[0].co,this.ray.lineN=this.ziDat[0].n)}},{key:"openChange",value:function(t){this.ray.closeLight=!t.checked}},{key:"func_rotaAngle",value:function(t){this._rotateHandleFunc("menuChange",l.M.getNumStr(t.showValue)*Math.PI/180)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.color=this.colorArr.indexOf(this.colname),t.power=this.ray.closeLight,t.ruRot=this.ruRot,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),isNaN(t.color)||this.setColor({showValue:this.colorArr[t.color]}),this.openChange({checked:!t.power}),t.ruRot&&this.changeRuRot({checked:!0})}},{key:"changeRuRot",value:function(t){this.ruRot=t.checked}},{key:"removed",value:function(){this.removeEventListener(c["default"].BEGIN,this.beginfunc),this.ray=null,this.removeAllListeners(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"getConf",value:function(){var t={};return t.confArr=[],t.confArr.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("color"),!1,"",this.colname,this.colorArr,this,this.setColor,10,1),this.ComponentProperty.getSwitch(this.language.getLocaleStr("switch"),!this.ray.closeLight,this.openChange,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("incidentPRotat"),this.ruRot,this.changeRuRot,this)),t}}]),e}(f["default"])},1141:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.shape.Polygon,i.var_maxDr=Math.PI/8.5,i.canRotate=!1,i.var_voArr=[],i.touchid=null,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.createBodyShape(),this.kuai.x=this.kuai2.x=-44,this.kuai.y=this.kuai2.y=92,this.kuai.rotation=this.var_maxDr,this.kuai.mask=this.createMask(-80,-345,200,278.5),this.kuai2.mask=this.createMask(-80,-66.5,200,162),this.freashKuai2(),this.touchid=l.M.addTouch(this.kuai.mask,{begin:this.kuaiBegin,move:this.func_kuaiMove,end:this.func_kuaiEnd},this),this.openAngleFunc(this.globalConfig.OPEN_ANGLE),this.showDirectionFunc(this.globalConfig.SHOW_DIRECTION),this.showReflectFunc(this.globalConfig.SHOW_REFLECT),this.addCursor(this.kuai.mask,"zuoyou")}},{key:"removed",value:function(){this.removedCursor(this.kuai.mask),l.M.removeTouch(this.kuai,this.touchid),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"openAngleFunc",value:function(t){var e=void 0;for(e=0;this.var_voArr.length>e;e++)this.var_voArr[e].open_angle=t}},{key:"showReflectFunc",value:function(t){var e=void 0;for(e=0;this.var_voArr.length>e;e++)this.var_voArr[e].var_canReflection=t?this.var_voArr[e].var_copyReflection:t}},{key:"showDirectionFunc",value:function(t){var e=void 0;for(e=0;this.var_voArr.length>e;e++)this.var_voArr[e].var_show_direction=t}},{key:"kuaiBegin",value:function(t){this.touchEnabled=!1}},{key:"func_kuaiMove",value:function(t){var e=(this.getMain(),this.getMouseXY(t)),i=this.toGlobalView(new l.Point(this.kuai.x,this.kuai.y),this),n=Math.atan2(i.y-e.y,i.x-e.x)-.5*Math.PI;n=0>n?0:n,n=n>this.var_maxDr?this.var_maxDr:n,this.kuai.rotation=n,this.freashKuai2()}},{key:"func_kuaiEnd",value:function(t){this.touchEnabled=!0}},{key:"createMask",value:function(t,e,i,n){var o=new PIXI.Graphics;return o.beginFill(0),o.drawRect(t,e,i,n),o.endFill(),this.addChild(o),o}},{key:"freashKuai2",value:function(){this.kuai2.rotation=this.kuai.rotation+this.kuai.rotation/this.var_maxDr*3*Math.PI/180}},{key:"createBodyShape",value:function(){this.body.shapes.clear();var t=new y(y.rect(-62.5,-66.5,125,166.5)),e=new f["default"](!0,!0,1.2);e.var_open_angle=!1,e.var_show_reflect=!1,e.var_show_direction=!1,t.get_userData().vo=e,this.body.add(t),this.body.set_shape_sensorEnabled(t,!0);var i=new f["default"](!0,!0,1.4);i.var_open_angle=!1,i.var_show_reflect=!1,i.var_show_direction=!1;var n=new y(y.rect(-62.5,100,125,40));n.get_userData().vo=i,this.body.set_shape_sensorEnabled(n,!0),this.body.add(n),this.var_voArr.push(e,i)}},{key:"getDragRect",value:function(){var t=this.getBounds();return{x:-80,y:-310,width:t.width+50,height:t.height+50}}}]),e}(c["default"])},1142:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(493),h=function(t){return t&&t.__esModule?t:{"default":t}}(s);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.translateRect={width:255,height:255},i}return r(e,t),a(e,[{key:"drawSkinFun",value:function(t){var e=(Math,this.translateRect.width/2),i=this.translateRect.height/2,n={x:e,y:-i},o={x:-e,y:i},r={x:e,y:i};return this.currImg.clear(),this.currImg.lineStyle(0,16777215,0),this.currImg.beginFill(16777215,.3),this.currImg.moveTo(n.x,n.y),this.currImg.lineTo(o.x,o.y),this.currImg.lineTo(r.x,r.y),this.points=[n,o,r]}}]),e}(h["default"])},1143:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:d(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=(i(1),i(457)),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=i.phy.nape,c=u.geom.Vec2,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.shapes.clear(),this.func_setMirror()}},{key:"func_setMirror",value:function(){var t=this,e=[],i=260,n=void 0,o=void 0,r=0;for(r=-i;i>=r;r++)n=Math.acos(r/i),o=Math.sin(n)*i,e.push(new c(r,-o));new u.geom.GeomPoly(e).convexDecomposition().foreach(function(e){var i=new u.shape.Polygon(e);i.get_userData().vo=t.vo,t.body.add(i),i.set_filter(t.NBOpticsStr.LIGHT_AND_HITFILTERS)}),this.addOneRoteShape(-i,0,40),this.addOneRoteShape(i,0,40)}},{key:"getDragRect",value:function(){return{x:.5*-this.width,y:20-this.height,width:this.bg.width,height:this.bg.height}}},{key:"rotateChange",value:function(t,e){this.showToolDatas()}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.rotation=this.componentBox.rotation,t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.componentBox.rotation=t.rotation}}]),e}(l["default"])},1144:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(457),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.canRotate=!1,i.points=[{x:-4,y:137},{x:80,y:207},{x:80,y:-122},{x:-4,y:-214}],i.selectIndex=0,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.white.visible=!1,this.changeIndex(this.selectIndex),this.body.shapesAt(0).set_filter(this.NBOpticsStr.NO_HIT_FILTERS)}},{key:"changeIndex",value:function(t){t!=this.selectIndex&&(this.selectIndex=t,0==this.selectIndex?(this.black.visible=!0,this.white.visible=!1):(this.black.visible=!1,this.white.visible=!0))}},{key:"changeColor",value:function(t){this.changeIndex(t.checked)}},{key:"getConf",value:function(){var t={};t.confArr=[];var e=[this.language.getLocaleStr("black"),this.language.getLocaleStr("white")];return t.confArr.push(this.ComponentProperty.getRadio(this.language.getLocaleStr("screen_color"),this.selectIndex,e,this.changeColor.bind(this))),t}}]),e}(l["default"])},1145:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(493),h=function(t){return t&&t.__esModule?t:{"default":t}}(s);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.translateRect={width:255,height:255},i}return r(e,t),a(e,[{key:"drawSkinFun",value:function(t){var e=this.translateRect.width/2,i=this.translateRect.height/2,n={x:0,y:-i},o={x:-e,y:i},r={x:e,y:i};return this.currImg.clear(),this.currImg.lineStyle(0,16777215,0),this.currImg.beginFill(16777215,.3),this.currImg.moveTo(n.x,n.y),this.currImg.lineTo(o.x,o.y),this.currImg.lineTo(r.x,r.y),this.points=[n,o,r]}}]),e}(h["default"])},1146:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(457),c=n(u),d=i(463),f=n(d),p=void 0,y=void 0,g=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,g=p.shape.Polygon,y=p.geom.Vec2,i.isOpendefRot=!0,i.canReset=!0,i.rate=1.3,i.liquid=null,i.bottle=null,i.plug=null,i.waterFlow=null,i.liquidMask=null,i.plugAlphaSp=null,i.waterFlowSp=null,i.liquidShape=null,i.holeShape=null,i.plugShape=null,i.waterFlowShapeArr=[],i.waterFlowVec2Arr=[],i.waterFlowFlag=!1,i.isHoleOpen=!1,i.surfaceH=-120,i.scaleLiquidY=1,i.holeP=new PIXI.Point(74,113),i.flowScale=.8,i.surfaceDownScale=1,i.WIDTH=159,i.HEIGHT=483,i.vo=i.getVo(!0,!0,i.rate),i.waterFlowVo=i.getVo(!0,!0,i.rate),i.waterFlowVo.bodyIsMultiShape=!0,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.bg=this.bottle,this.waterFlow.visible=!1,this.liquidMask=new PIXI.Graphics,this.drawRect(this.liquidMask,-this.WIDTH/2,-this.HEIGHT/2,this.WIDTH,this.HEIGHT,0,.5),this.addChild(this.liquidMask),this.liquid.mask=this.liquidMask,this.addChildAt(this.plug,0),this.plugAlphaSp=new PIXI.Graphics,this.drawRect(this.plugAlphaSp,-10,-10,20,20,0,0),this.addChild(this.plugAlphaSp),this.plugAlphaSp.x=this.plug.x,this.plugAlphaSp.y=this.plug.y,this.waterFlowSp=new PIXI.Graphics,this.addChildAt(this.waterFlowSp,0),this.body.shapes.clear(),this.liquidShape=new g(g.box(this.WIDTH,this.HEIGHT)),this.body.add(this.liquidShape),this.liquidShape.get_userData().vo=this.vo,this.plugShape=new g(g.box(20,20)),this.body.add(this.plugShape),this.plugShape.set_localCOM(y.get(this.plug.x,this.plug.y)),this.addWaterFlowShape(g.rect(this.holeP.x-5,this.holeP.y-10,10,20));var i=new g(g.box(this.WIDTH,this.HEIGHT));this.body.add(i),i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),i.set_sensorEnabled(!0),this.body.set_isBullet(!0),this.body.noallowRotation=!0,this.body.userData.cannotToolRot=!0,this.body.userData.dragLevel=-1,this.updateSurfaceShape(),this.addCbType(this.CbTypeStr.OPTICA_LGLASS),this.plugDragID=l.M.addDrag(this.plugAlphaSp,null,{begin:this.dragBeginPlug,move:this.dragMovePlug,end:this.dragEndPlug},this),this.plugAlphaSp.getMScale=function(){return t.getMScale()},this.addCursor(this.plugAlphaSp,"hand")}},{key:"reset",value:function(){this.surfaceH=-120,this.plugAlphaSp.x=this.plug.x=this.holeP.x,this.plugAlphaSp.y=this.plug.y=this.holeP.y,this.plugShape.set_localCOM(y.get(this.plug.x,this.plug.y)),this.isHoleOpen=!1,this.updateSurfaceShape()}},{key:"addWaterFlowShape",value:function(t,e){var i=new g(t);return"VALID"==""+i.validity()?(e||i.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS),i.get_userData().vo=this.waterFlowVo,this.waterFlowShapeArr.push(i),this.body.add(i),i):null}},{key:"drawRect",value:function(t,e,i,n,o,r,a){t.clear(),t.beginFill(r,a),t.drawRect(e,i,n,o),t.endFill()}},{key:"dragBeginPlug",value:function(t){this.touchEnabled=!1,this.body.userData.dragManager&&this.body.userData.dragManager.func_touchEnd(null)}},{key:"dragMovePlug",value:function(t){this.plug.x=this.plugAlphaSp.x,this.plug.y=this.plugAlphaSp.y,this.plugShape.set_localCOM(y.get(this.plug.x,this.plug.y))}},{key:"dragEndPlug",value:function(t){this.touchEnabled=!0;var e=new PIXI.Point(this.plug.x,this.plug.y);20>l.M.getPointLen(e,this.holeP)?(this.plugAlphaSp.x=this.plug.x=this.holeP.x,this.plugAlphaSp.y=this.plug.y=this.holeP.y,this.plugShape.set_localCOM(y.get(this.plug.x,this.plug.y)),this.isHoleOpen=!1):this.isHoleOpen=!0}},{key:"getMScale",value:function(){return this.main.view.scale}},{key:"getVo",value:function(t,e,i){var n=new f["default"](t,e,i);return n.var_whiteNotReflect=!0,n.var_open_angle=!1,n.var_show_reflect=!1,n.var_show_direction=!1,n}},{key:"removed",value:function(){this.removedCursor(this.plugAlphaSp),l.M.removeDrag(this.plugAlphaSp,this.plugDragID),this.plugDragID=null,this.plugAlphaSp.getMScale=null,this.removedCursor(this.plug),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.waterFlowFlag=this.isHoleOpen&&this.holeP.y+6>this.surfaceH,this.waterFlowVo.var_open_angle=this.vo.var_open_angle,this.waterFlowVo.var_canReflection=this.vo.var_canReflection,this.waterFlowVo.var_show_direction=this.vo.var_show_direction,this.waterFlowFlag){this.flowWater(),this.updateSurfaceShape(),this.waterFlowSp.visible=!0;for(var t=0;this.waterFlowShapeArr.length>t;t++){this.body.remove(this.waterFlowShapeArr[t])}this.waterFlowShapeArr.length=0;for(var i=0;this.waterFlowVec2Arr.length>i;i++){this.addWaterFlowShape(this.waterFlowVec2Arr[i],i!==this.waterFlowVec2Arr.length-1)}}else if(this.waterFlowSp.visible){this.waterFlowSp.visible=!1;for(var n=0;this.waterFlowShapeArr.length>n;n++){var o=this.waterFlowShapeArr[n];this.body.remove(o)}this.waterFlowShapeArr.length=0,this.addWaterFlowShape(g.rect(this.holeP.x-5,this.holeP.y-10,10,20))}}},{key:"flowWater",value:function(){var t=this.holeP.y+6-this.surfaceH,e=this.paramObj.moduleMain.napeEngine.getGravity(),i=Math.sqrt(2*e*t);10>i&&(i=10),this.surfaceH+=10*i/(60*this.WIDTH)*this.surfaceDownScale,i*=this.flowScale;for(var n=Math.min(6,t/2),o=this.holeP.x,r=Math.max(this.holeP.y,this.surfaceH+n),a=0,s=5/i,h=void 0,l=void 0,u=[],c=0,d=this.HEIGHT/2;;){if(h=o+i*a,(l=r+e*a*a*.5)>=d){l=d,a=Math.sqrt((l-r)/(.5*e)),h=o+i*a,u.push(h,l);break}if(u.push(h,l),a+=s,++c>200)break;s=Math.min(s,20/(e*a))}this.waterFlowSp.clear();var f=void 0,p=void 0,g=void 0,v=void 0,_=void 0,b=void 0,m=void 0,w=void 0,O=void 0,x=void 0,P=u.length;this.waterFlowVec2Arr=[];for(var S=.2/P,k=0;P>k;k+=2){f=0===k?{x:1,y:0}:k===u.length-2?{x:0,y:1}:{x:u[k]-u[k-2],y:u[k+1]-u[k-1]};var T=u[k],M=u[k+1],C=Math.sqrt(f.x*f.x+f.y*f.y);f.x=n*f.x/C,f.y=n*f.y/C,p={x:-f.y,y:f.x},m=T+p.x,w=M+p.y,O=T-p.x,x=M-p.y,w>d&&(w=d),x>d&&(x=d),0!==k&&(this.waterFlowSp.beginFill(16777215,.5-S*k-.05*Math.random()),this.waterFlowSp.moveTo(g,v),this.waterFlowSp.lineTo(m,w),this.waterFlowSp.lineTo(O,x),this.waterFlowSp.lineTo(_,b),this.waterFlowSp.endFill(),this.waterFlowVec2Arr.push([y.get(g,v),y.get(m,w),y.get(O,x),y.get(_,b)])),g=m,v=w,_=O,b=x,n+=.1}}},{key:"selectRenderChild",value:function(){return this.bg.getBounds()}},{key:"updateSurfaceShape",value:function(){var t=this.HEIGHT/2-this.surfaceH;this.liquidMask.y=this.surfaceH+this.HEIGHT/2;var e=t/this.HEIGHT;this.liquidShape.scale(1,e/this.scaleLiquidY),this.liquidShape.set_localCOM(y.get(0,(this.HEIGHT-t)/2)),this.scaleLiquidY=e}}]),e}(c["default"])},1147:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(576),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.rayDat=[{co:0,n:1.495},{co:16711765,n:1.511},{co:16711680,n:1.513},{co:16733440,n:1.516},{co:16755200,n:1.52},{co:16776960,n:1.528},{co:11206400,n:1.533},{co:5635840,n:1.537},{co:65280,n:1.541},{co:65365,n:1.545},{co:65450,n:1.549},{co:65535,n:1.554},{co:43775,n:1.559},{co:22015,n:1.563},{co:255,n:1.566},{co:5570815,n:1.569},{co:11141375,n:1.572},{co:16711935,n:1.574},{co:16711850,n:1.577}],i.di=new PIXI.Graphics,i.btnTouchid=null,i.isPolar=!1,i.isWhiteLight=!0,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.removeChild(this.tst),this.tst=null,this.addOneRoteShape(120,0,50),this.addCursor(this.bg.openBtn,"hand")}},{key:"createRays",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"createRays",this).call(this);for(var t=0;this.vectorRay.length>t;t++){var i=this.vectorRay[t];i.isWhiteLight=!0,i.isShowValue=!1,i.lineStart=[142,0],i.lineThin=30,i.whiteSkin=t+1,i.I=1/3}this.btnTouchid=h.M.addTouch(this.bg.openBtn,{tab:this.powerClick},this,{time:300,dis:10}),this.setLineThin(10)}},{key:"removed",value:function(){this.removedCursor(this.bg.openBtn),h.M.removeTouch(this.bg.openBtn,this.btnTouchid),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"mapPoint",value:function(t){this.WIDTH=this.globalConfig.main.canvas.width,this.HEIGHT=this.globalConfig.main.canvas.height;var e=this.globalConfig.main.getViewRect(this.globalConfig.main.viewStack),i=Math.max(e.width/this.WIDTH,e.height/this.HEIGHT);this.rect=new PIXI.Rectangle(e.x,e.y,this.WIDTH*i,this.HEIGHT*i);var n=this.WIDTH,o=this.HEIGHT,r=n*(t.x-this.rect.x)/this.rect.width,a=o-o*(t.y-this.rect.y)/this.rect.height;return new PIXI.Point(r,a)}},{key:"update",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this)}},{key:"powerClick",value:function(t){this.vectorRay[0].closeLight?(this.closeAll(!1),this.bg.openBtn.gotoAndStop(0)):(this.closeAll(!0),this.bg.openBtn.gotoAndStop(1)),this.showToolDatas()}},{key:"closeAll",value:function(t){var e=void 0;for(e=0;this.vectorRay.length>e;e++)this.vectorRay[e].closeLight=t;this.di.visible=!t}},{key:"getLineThin",value:function(){return this.vectorRay[0].lineThin+""}},{key:"setLineThin",value:function(t){var e=void 0;for(this.di.height=t,e=0;this.vectorRay.length>e;e++)this.vectorRay[e].lineThin=t}},{key:"menuPowerClick",value:function(t){t.checked?(this.closeAll(!1),this.bg.openBtn.gotoAndStop(0)):(this.closeAll(!0),this.bg.openBtn.gotoAndStop(1))}},{key:"func_menuRotaChange",value:function(t){this._rotateHandleFunc("menuChange",h.M.getNumStr(t.showValue)*Math.PI/180)}},{key:"changeThin",value:function(t){this.setLineThin(h.M.getNumStr(t.showValue))}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.thin=this.getLineThin(),t.power=this.vectorRay[0].closeLight,t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.changeThin({showValue:t.thin}),this.menuPowerClick({checked:!t.power})}},{key:"getConf",value:function(){var t={};return t.confArr=[],t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("ray"),!0,"",30,10,this.getLineThin(),1,this.changeThin,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("switch"),!this.vectorRay[0].closeLight,this.menuPowerClick,this)),t}},{key:"selectRenderChild",value:function(){return this.bg.getBounds()}}]),e}(u["default"])},1148:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function p(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:p(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(226),c=n(u),d=i(794),f=n(d);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.canRotate=!1,i.shadow=null,i.canTouchId=null,i.scrTouchId=null,i.showLine=!0,i.line1=new PIXI.Graphics,i.line2=new PIXI.Graphics,i.menu=new f["default"](t),i}return a(e,t),s(e,[{key:"added",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this);var i={equparent:this,touchtar:this.glass.touchbg,defselect:2,gap:50,itemW:this.glass.rect.width,list:[this.glass.circle,this.glass.rect,this.glass.star,this.glass.polygon,this.glass.angle]};this.glass.touchbg.interactive=!1,this.glass.touchbg.interactiveChildren=!1,this.menuChange=function(){t.xiaokong.kong.gotoAndStop(t.menu.select)},this.menu.addEventListener("change",this.menuChange),this.menu.configInit(i),this.glass.addChildAt(this.menu,0),this.menu.hide(),this.shaMask=new PIXI.Graphics,this.screen.addChild(this.shaMask),this.shaMask.lineStyle(1,16711680),this.shaMask.beginFill(16711680),this.shaMask.moveTo(-58,-229),this.shaMask.lineTo(61,-111),this.shaMask.lineTo(63,222),this.shaMask.lineTo(-62,98),this.shaMask.lineTo(-58,-229),this.shadow=new PIXI.Sprite,this.addChild(this.shadow),this.shadow.mask=this.shaMask,this.shadow.addChild(this.fire2),this.fire2.interactive=!1,this.fire2.interactiveChildren=!1,this.fire2.rotation=Math.PI,this.candle.addChild(this.fire),this.fire.x=0,this.fire.y=35,this.fire.scale=this.fire2.scale=new l.Point(1.5,1.5),this.fire2.x=0,this.fire2.y=0,this.refreshFirePoint(),this.fire.animationSpeed=.1,this.fire.play(),this.addTouchQu(),this.updateShadow(),this.componentBox.visible=!1,this.addChild(this.line1),this.addChildAt(this.line2,1),this.menuClick=function(){t.menu.toggle()},this.menuid=l.M.addTouch(this.xiaokong.kong,{tab:this.menuClick})}},{key:"refreshFirePoint",value:function(){this.topPo=this.toLocal(new l.Point(this.fire.x,this.fire.y-this.fire.height),this.candle),this.botPo=this.toLocal(new l.Point(this.fire.x,this.fire.y),this.candle)}},{key:"removed",value:function(){this.menu.destory(),this.menu.removeEventListener("change",this.menuChange),this.glass.removeChild(this.menu),this.menu=null,l.M.removeTouch(this.xiaokong.kong,this.menuid),l.M.removeTouch(this.candle,this.canTouchId),l.M.removeTouch(this.screen,this.scrTouchId),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){this.fire2.gotoAndStop(this.fire.currentFrame)}},{key:"addTouchQu",value:function(){var t=this,e=void 0;this.canTouchId=l.M.addTouch(this.candle,{begin:function(i){e=t.getMouseXY(i),t.cannotSystemDrag=!0},move:function(i){var n=t.getMouseXY(i);t.candle.x+=n.x-e.x,t.candle.y+=n.y-e.y,e=n,t.candle.x>t.xiaokong.x-.5*t.xiaokong.width-70&&(t.candle.x=t.xiaokong.x-.5*t.xiaokong.width-70),t.refreshFirePoint(),t.updateShadow()},end:function(e){t.cannotSystemDrag=!1,t.candle.x>t.xiaokong.x-.5*t.xiaokong.width-70&&(t.candle.x=t.xiaokong.x-.5*t.xiaokong.width-70)}},this);var i=void 0,n=this.xiaokong.x+.5*this.xiaokong.width;this.scrTouchId=l.M.addTouch(this.screen,{begin:function(e){t.cannotSystemDrag=!0,i=t.getMouseXY(e)},move:function(e){var o=t.getMouseXY(e);t.screen.x+=o.x-i.x,t.screen.y+=o.y-i.y,i=o,n+170>t.screen.x&&(t.screen.x=n+170),t.screen.x>n+670&&(t.screen.x=n+670),t.updateShadow()},end:function(e){t.cannotSystemDrag=!1,n+170>t.screen.x&&(t.screen.x=n+170),t.screen.x>n+670&&(t.screen.x=n+670)}},this)}},{key:"updateShadow",value:function(){this.shadow.x=this.screen.x;var t=new l.Point(this.xiaokong.x,this.xiaokong.y),e=this.getPointY(this.topPo,t,this.screen.x),i=this.getPointY(this.botPo,t,this.screen.x);if(this.shadow.scale.x=this.shadow.scale.y=this.candle.scale.x/((this.xiaokong.x-this.candle.x)/(this.screen.x-this.xiaokong.x)),this.shadow.y=i,this.shadow.alpha=.25+112.5/(this.screen.x-this.candle.x),this.showLine){this.line1.clear(),this.line1.lineStyle(2,16750848),this.line1.moveTo(this.topPo.x,this.topPo.y),this.line1.lineTo(t.x,t.y),this.line1.moveTo(this.botPo.x,this.botPo.y),this.line1.lineTo(t.x,t.y),this.line2.clear(),this.line2.lineStyle(2,16750848),this.line2.moveTo(t.x,t.y),this.line2.lineTo(this.screen.x,e),this.line2.moveTo(t.x,t.y),this.line2.lineTo(this.screen.x,i);var n=this.screen.y-172.5,o=this.screen.y+172.5;n>i&&e>n?(l.M.drawDashed(this.line2,new l.Point(this.screen.x,i),new l.Point(this.screen.x,n)),e>o&&l.M.drawDashed(this.line2,new l.Point(this.screen.x,e),new l.Point(this.screen.x,o))):o>i&&e>o?l.M.drawDashed(this.line2,new l.Point(this.screen.x,e),new l.Point(this.screen.x,o)):i>n&&o>e||l.M.drawDashed(this.line2,new l.Point(this.screen.x,e),new l.Point(this.screen.x,i))}}},{key:"getPointY",value:function(t,e,i){return(i-t.x)*(e.y-t.y)/(e.x-t.x)+t.y}},{key:"getEffectiveRange",value:function(){return[this.candle.getBounds(),this.screen.getBounds(),this.candle.getBounds()]}},{key:"selectRenderChild",value:function(){this.updateTransform();var t=this.getBounds(),e=l.M.getBoundsFromArray([this.candle.bg.getBounds(),this.screen.bg.getBounds(),this.xiaokong.getBounds()]);return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}},{key:"changeGuanLu",value:function(t){this.showLine=t.checked,this.showLine?this.updateShadow():(this.line1.clear(),this.line2.clear())}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);return t.confArr.push(this.ComponentProperty.getSwitch(this.language.getLocaleStr("show_optical_path"),this.showLine,this.changeGuanLu,this)),t}}]),e}(c["default"])},1149:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.zoomIn=i,a.zoomScreen=r,a._topPoint=new s.Point(15,-275),a.oldP=null,a.zuo=i.zuo,a.ping=i.ping,a.laminY=null,a.lamaxY=null,a.$parent=null,a.limit=null,a.pingOfy=0,a.originpingY=null,a.zuoTouchid=null,a.pingTouchid=null,a}return r(e,t),a(e,[{key:"initView",value:function(){this.addChild(this.zoomIn),this.addChild(this.zoomScreen),this.zoomScreen.x-=this.zoomIn.x,this.zoomScreen.y-=this.zoomIn.y,this.zoomIn.x=this.zoomIn.y=0,this.zuoTouchid=s.M.addTouch(this.zuo,{begin:this.maBegin,move:this.maMove,end:this.maEnd},this),this.pingTouchid=s.M.addTouch(this.ping,{begin:this.pingBegin,move:this.pingMove,end:this.pingEnd},this),this.originpingY=this.zoomScreen.y,this.laminY=this.ping.y-50,this.lamaxY=this.ping.y+10}},{key:"disposeAll",value:function(){this.$parent=null,s.M.removeTouch(this.zuo,this.zuoTouchid),s.M.removeTouch(this.ping,this.pingTouchid),this.zuo=null,this.ping=null,this.zoomIn=null,this.zoomScreen=null,this.destroy()}},{key:"pingBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"pingMove",value:function(t){var e=this.getMouseXY(t);this.changeJing(e.y-this.oldP.y),this.oldP=e}},{key:"changeJing",value:function(t){this.ping.y+=t,this.pingOfy+=t,this.laminY>this.ping.y&&(this.ping.y=this.laminY,this.pingOfy=-50),this.ping.y>this.lamaxY&&(this.ping.y=this.lamaxY,this.pingOfy=10),this.zoomScreen.y=this.originpingY+this.pingOfy}},{key:"pingEnd",value:function(){this.$parent.touchEnabled=!0}},{key:"maBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"checkposition",value:function(){this.x=this.limit[0].x+54>this.x?this.limit[0].x+54:this.x,this.x=this.x>this.limit[1]?this.limit[1]:this.x}},{key:"maMove",value:function(t){var e=this.getMouseXY(t);this.x+=e.x-this.oldP.x,this.checkposition(),this.oldP=e,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"maEnd",value:function(t){this.$parent.touchEnabled=!0,this.$parent.dispatchEvent("autoFocusMove",{tar:this,screenEnd:!0})}},{key:"topPoint",get:function(){return this._topPoint.x=0,this._topPoint.y=-275+this.pingOfy,this._topPoint}}]),e}(l["default"])},1150:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return s.limit=null,s._p1=null,s._p2=null,s.$parent=null,s.zo=a,s.fire=i,s.la=r,s.oldP=null,s.laminY=null,s.lamaxY=null,s.fireOffset_y=null,s.laOrigony=null,s.laOffsetY=0,s.laTouchid=null,s.zoTouchid=null,s}return r(e,t),a(e,[{key:"initView",value:function(){this.addChild(this.zo),this.addChild(this.la),this.addChild(this.fire),this.la.x-=this.zo.x,this.la.y-=this.zo.y,this.fire.x-=this.zo.x,this.fire.y-=this.zo.y,this.zo.x=this.zo.y=0,this.laOrigony=this.la.y,this.fireOffset_y=this.la.y-this.fire.y,this.laminY=-this.zo.height,this.lamaxY=70-this.zo.height,this._p1=new s.Point(0,this.fire.y-this.fire.height),this._p2=new s.Point(0,this.fire.y),this.laTouchid=s.M.addTouch(this.la,{begin:this.laBegin,move:this.laMove,end:this.laEnd},this),this.zoTouchid=s.M.addTouch(this.zo,{begin:this.zuoBegin,move:this.zuoMove,end:this.zuoEnd},this)}},{key:"disposeAll",value:function(){this.$parent=null,s.M.removeTouch(this.la,this.laTouchid),s.M.removeTouch(this.zo,this.zoTouchid),this.la=null,this.zo=null,this.fire=null,this.destroy()}},{key:"zuoBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"checkposition",value:function(){this.x=this.limit[0]>this.x?this.limit[0]:this.x,this.x=this.x>this.limit[1].x-54?this.limit[1].x-54:this.x}},{key:"zuoMove",value:function(t){var e=this.getMouseXY(t);this.x+=e.x-this.oldP.x,this.checkposition(),this.oldP=e,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"zuoEnd",value:function(t){this.$parent.touchEnabled=!0,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"laBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"laMove",value:function(t){var e=this.getMouseXY(t);this.la.y+=e.y-this.oldP.y,this.laminY>this.la.y&&(this.la.y=this.laminY),this.la.y>this.lamaxY&&(this.la.y=this.lamaxY),this.changeLa(),this.oldP=e}},{key:"changeLa",value:function(){this.laOffsetY=this.la.y-this.laOrigony,this.fire.y=this.la.y-this.fireOffset_y,this._p1.y=this.fire.y-this.fire.height,this._p2.y=this.fire.y}},{key:"laEnd",value:function(t){this.$parent.touchEnabled=!0}},{key:"p1",get:function(){return this._p1}},{key:"p2",get:function(){return this._p2}}]),e}(l["default"])},1151:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(682),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);t.exports=function(t){function e(t,i,r){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r))}return r(e,t),a(e,[{key:"setP12",value:function(){(0>=arguments.length||arguments[0]===undefined||arguments[0])&&(this.light.y=25-this.zuo.height),this._p1=new s.Point(0,this.light.y-this.light.height+50),this._p2=new s.Point(0,this.light.y)}},{key:"setlimitxy",value:function(){this.laminY=-this.zuo.height-35,this.lamaxY=55-this.zuo.height}}]),e}(l["default"])},1152:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(682),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);t.exports=function(t){function e(t,i,r){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r))}return r(e,t),a(e,[{key:"setP12",value:function(){(0>=arguments.length||arguments[0]===undefined||arguments[0])&&(this.light.y=20-this.zuo.height),this._p1=new s.Point(0,this.light.y-90),this._p2=new s.Point(0,this.light.y)}},{key:"setlimitxy",value:function(){this.laminY=-this.zuo.height-30,this.lamaxY=50-this.zuo.height}}]),e}(l["default"])},1153:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a._center=new s.Point,a.dang=i,a.glass=r,a._dangBool=!1,a.laminY=null,a.lamaxY=null,a.$parent=null,a.limit=null,a.oldP=null,a.glassOfy=0,a.originDangY=null,a.zuoTouchid=null,a.jingTouchid=null,a}return r(e,t),a(e,[{key:"initView",value:function(){this.addChild(this.glass),this.addChild(this.dang),this.dang.x-=this.glass.x,this.dang.y-=this.glass.y,this.glass.x=this.glass.y=0,this.dang.visible=this._dangBool,this.zuoTouchid=s.M.addTouch(this.glass.zuo,{begin:this.maBegin,move:this.maMove,end:this.maEnd},this),this.jingTouchid=s.M.addTouch(this.glass.jing,{begin:this.jingBegin,move:this.jingMove,end:this.jingEnd},this),this.originDangY=this.dang.y,this.laminY=this.glass.jing.y-50,this.lamaxY=this.glass.jing.y+30}},{key:"disposeAll",value:function(){this.$parent=null,s.M.removeTouch(this.glass.zuo,this.zuoTouchid),s.M.removeTouch(this.glass.jing,this.jingTouchid),this.dang=null,this.glass=null,this.destroy()}},{key:"jingBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"jingMove",value:function(t){var e=this.getMouseXY(t);this.changeJing(e.y-this.oldP.y),this.oldP=e}},{key:"changeJing",value:function(t){this.glass.jing.y+=t,this.glassOfy+=t,this.laminY>this.glass.jing.y&&(this.glass.jing.y=this.laminY,this.glassOfy=-50),this.glass.jing.y>this.lamaxY&&(this.glass.jing.y=this.lamaxY,this.glassOfy=30),this.dang.y=this.originDangY+this.glassOfy}},{key:"jingEnd",value:function(t){this.$parent.touchEnabled=!0}},{key:"maBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"checkposition",value:function(){this.limit[0]=this.$parent.currentlight,this.x=this.limit[0].x+54>this.x?this.limit[0].x+54:this.x,this.x=this.x>this.limit[1].x-54?this.limit[1].x-54:this.x}},{key:"maMove",value:function(t){var e=this.getMouseXY(t);this.x+=e.x-this.oldP.x,this.checkposition(),this.oldP=e,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"maEnd",value:function(t){this.$parent.touchEnabled=!0,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"center",get:function(){return this._center.x=0,this._center.y=-210+this.glassOfy,this._center}},{key:"dangBool",get:function(){return this._dangBool},set:function(t){this._dangBool=t,this.dang&&(this.dang.visible=t)}}]),e}(l["default"])},1154:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=(i(1),i(683)),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.btn=r.view.btn,r.bg=r.view.bg,r.ruler=r.view.ruler,r.wgbtn=r.view.wgbtn,r.initBtn(r.btn,"lateral_view",1),r.initBtn(r.wgbtn,"grid_pmirror",3),r.drag(r.ruler,null,r.rulerMove,r.rulerMoveEnd),r}return r(e,t),a(e,[{key:"rulerMove",value:function(t){}},{key:"rulerMoveEnd",value:function(t){}},{key:"removed",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"setVisible",value:function(t){this.view.visible=t,t&&this.refresh()}},{key:"refresh",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"refresh",this).call(this),this.gra.clear(),this.gra.lineStyle(5,12597011,1),this.hasLine&&(this.gra.moveTo(0,-620),this.gra.lineTo(0,620)),this.gra.lineStyle(5,12597011,1);for(var t=0;this.pointArr.length>t;t++){var i=this.pointArr[t],n=i.p2;this.gra.drawCircle(n.x,n.y,15)}}},{key:"reset",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this)}}]),e}(l["default"])},1155:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(683),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.candleWu=r.view.candleWu,r.candleXiang=r.view.candleXiang,r.candleMie=r.view.candleMie,r.mirror=r.view.mirror,r.pen=r.view.pen,r.btn=r.view.btn,r.bg=r.view.bg,r.wgbtn=r.view.wgbtn,r.penDragMc=r.view.penDragMc,r.candleDragMc=r.view.candleDragMc,r.mirrorMask=r.mirror.mirrorMask,r.pen.rotation=r.penDragMc.rotation=Math.PI/6,r.candleXiang.mask=r.mirrorMask.getChildAt(0),r.candleXiang.interactive=r.candleXiang.interactiveChildren=!1,r.pen.interactive=r.pen.interactiveChildren=!1,r.candleMie.interactive=r.candleMie.interactiveChildren=!1,r.initBtn(r.btn,"plan_view",2),r.initBtn(r.wgbtn,"grid_pmirror",3),r.drag(r.penDragMc,r.penBegin,r.penMove,r.penMoveEnd),r.drag(r.mirror,r.mirrorBegin,r.mirrorMove,r.mirrorMoveEnd),r.drag(r.candleWu,null,r.candleWuMove,r.candleWuMoveEnd),r.drag(r.candleDragMc,null,r.candleMieMove,r.candleMieMoveEnd),r.penOriP={x:r.penDragMc.x,y:r.penDragMc.y},r.mirror.x=-200,r.mirror.y=-100,r.mirrorArea=[{x:23,y:0},{x:1023,y:158},{x:1023,y:515},{x:23,y:306}],r.frontArea=[{x:-350,y:504},{x:-10,y:314},{x:972,y:516},{x:776,y:810}],r.backArea=[{x:21,y:285},{x:257,y:159},{x:1112,y:309},{x:992,y:478}],r.penInFront=!0,r.mirrorOnPapper=!1,r.candleWuOnPapper=!1,r.candleMieOnPapper=!1,r.candleChonghe=!1,r.PID=0,r.startPos(),r.middleLine=[{x:-14,y:302},{x:996,y:516}],r.maxdistance=515,r}return r(e,t),a(e,[{key:"startPos",value:function(){for(var t=[this.penDragMc,this.mirror,this.candleWu,this.candleDragMc],e=0;t.length>e;e++){var i=t[e];i.stp?(i.x=i.stp.x,i.y=i.stp.y):i.stp={x:i.x,y:i.y}}}},{key:"update",value:function(){this.candleMie.x=this.candleDragMc.x,this.candleMie.y=this.candleDragMc.y,this.pen.x=this.penDragMc.x,this.pen.y=this.penDragMc.y,this.moved&&(this.updateXiang(),this.moved=!1);var t=[{x:253,y:148},{x:1139,y:301}];this.setScaleMc(this.candleWu,t,!0),this.setScaleMc(this.candleMie,t,!0),this.setScaleMc(this.candleXiang,t)}},{key:"setScaleMc",value:function(t,e){var i=arguments.length>2&&arguments[2]!==undefined&&arguments[2],n={x:t.x,y:t.y},o=h.M.getDisFrom3Dian(n,e[0],e[1]),r=o/this.maxdistance;if(r>1?r=1:0>r&&(r=0),i){0>h.M.checkPointOnLineLeftOrRight(n,e[0],e[1])&&(r=0)}t.scale.y=t.scale.x=.4*r+.6}},{key:"reset",value:function(){this.startPos(),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this)}},{key:"updateXiang",value:function(){var t=this.getPosition(this.candleWu),e=this.side2plan(t),i={x:1e3-e.x,y:e.y},n=this.plan2side(i);this.candleXiang.x=n.x,this.candleXiang.y=n.y}},{key:"penBegin",value:function(t){this.penOriP.x=this.penDragMc.x,this.penOriP.y=this.penDragMc.y}},{key:"penMove",value:function(t){}},{key:"penMoveEnd",value:function(t){if(this.candleWuOnPapper&&this.penHitCandle(this.candleWu)){var e=this.getPosition(this.candleWu),i=this.playAnimationDrawCircle(e);this.addPoint(1,e,i)}else if(this.candleMieOnPapper&&this.penHitCandle(this.candleMie)){var n=this.getPosition(this.candleMie),o=this.playAnimationDrawCircle(n);this.addPoint(2,n,o)}else this.mirrorOnPapper&&this.penHitMirror()&&(this.hasLine=!0,this.playAnimationDrawLine())}},{key:"mirrorBegin",value:function(t){this.inArea(this.eqView.getLocalMouseXY(t,this.mirror),this.mirrorArea)||(this.mirror[this.mirror.dragId+"_dragData"].isDown=!1,this.eqView.cannotSystemDrag=!1,this.isNotMoveMirror=!0)}},{key:"mirrorMove",value:function(t){}},{key:"mirrorMoveEnd",value:function(t){if(this.isNotMoveMirror)return void(this.isNotMoveMirror=null);var e=!1;this.mirror.x>-400&&this.mirror.y>-200&&400>this.mirror.x&&300>this.mirror.y&&(this.mirror.x=-26,this.mirror.y=0,e=!0),this.mirrorOnPapper!==e&&(this.mirrorOnPapper=e)}},{key:"candleWuMove",value:function(t){}},{key:"candleWuMoveEnd",value:function(t){var e=this.getPosition(this.candleWu),i=this.side2plan(e),n=i.x>0&&1e3>i.x&&i.y>0&&1e3>i.y;this.candleWuOnPapper!==n&&(this.candleWuOnPapper=n)}},{key:"candleMieMove",value:function(t){}},{key:"candleMieMoveEnd",value:function(t){var e=this.getPosition(this.candleMie),i=this.side2plan(e),n=i.x>0&&1e3>i.x&&i.y>0&&1e3>i.y;this.candleMieOnPapper!==n&&(this.candleMieOnPapper=n),this.checkChonghe()}},{key:"removed",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"checkChonghe",value:function(){if(this.candleWuOnPapper&&this.mirrorOnPapper){this.candleChonghe=this.getChonghe()}}},{key:"inArea",value:function(t,e){return 1===h.M.checkPolygonPointArr(t,e)}},{key:"getChonghe",value:function(){var t=this.candleMie.x-this.candleXiang.x,e=this.candleMie.y-this.candleXiang.y;return 100>t*t+e*e}},{key:"getPosition",value:function(t){return{x:t.x,y:t.y}}},{key:"penHitCandle",value:function(t){return this.pen.hitTest(t)}},{key:"penHitMirror",value:function(){var t=this.getPosition(this.pen);return t.x+=26,t.y-=20,this.inArea(t,this.mirrorArea)}},{key:"playAnimationDrawLine",value:function(){var t=this;this.penDragMc.x=0,this.penDragMc.y=300,this.gra.lineStyle(5,12597011,1),this.gra.moveTo(this.penDragMc.x,this.penDragMc.y),TweenLite.to(this.penDragMc,.8,{x:973,y:507,onUpdate:function(){t.gra.lineStyle(5,12597011,1),t.gra.lineTo(t.penDragMc.x,t.penDragMc.y)},onComplete:function(){t.penMoveBack()}})}},{key:"penMoveBack",value:function(){TweenLite.to(this.penDragMc,.2,{x:this.penOriP.x,y:this.penOriP.y})}},{key:"playAnimationDrawCircle",value:function(t){var e=this,i={angle:0};this.gra.lineStyle(5,12597011,1);return this.penDragMc.x=t.x-1+15*Math.cos(i.angle),this.penDragMc.y=t.y-1+8*Math.sin(i.angle),this.gra.moveTo(this.penDragMc.x,this.penDragMc.y),TweenLite.to(i,.5,{angle:2.5*Math.PI,onUpdate:function(){e.penDragMc.x=t.x-1+15*Math.cos(i.angle),e.penDragMc.y=t.y-1+8*Math.sin(i.angle),e.gra.lineStyle(5,12597011,1),e.gra.lineTo(e.penDragMc.x,e.penDragMc.y)},onComplete:function(){e.penMoveBack()}}),++this.PID}},{key:"refresh",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"refresh",this).call(this),this.gra.clear(),this.gra.lineStyle(5,12597011,1),this.hasLine&&(this.gra.moveTo(5,305),this.gra.lineTo(973,507));for(var t=0;this.pointArr.length>t;t++){var i=this.pointArr[t],n=i.p1;this.gra.drawCircle(n.x,n.y,15)}}},{key:"addPoint",value:function(t,e,i){var n=this.side2plan(e),o={x:1220*n.x/1e3-610,y:1220*n.y/1e3-610},r={type:t,p1:e,p2:o,id:i};return this.pointArr.push(r),r}},{key:"getPointArr",value:function(){return this.pointArr}}]),e}(u["default"])},1156:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e,i){n(this,t),this.re=e,this.im=i}return o(t,[{key:"clone",value:function(){return new t(this.re,this.im)}},{key:"normalize",value:function(){var e=this.mod;return new t(this.re/e,this.im/e)}},{key:"add",value:function(e){return new t(this.re+e.re,this.im+e.im)}},{key:"reduce",value:function(e){return new t(this.re-e.re,this.im-e.im)}},{key:"conjugate",value:function(){return new t(this.re,-this.im)}},{key:"mul0",value:function(e){return new t(this.re*e,this.im*e)}},{key:"mul",value:function(e){return new t(this.re*e.re-this.im*e.im,this.re*e.im+this.im*e.re)}},{key:"div",value:function(t){return this.mul(t.conjugate()).mul0(1/(t.re*t.re+t.im*t.im))}},{key:"div1",value:function(e){return e=1/e,new t(this.re*e,this.im*e)}},{key:"inverse",value:function(){var e=this.mod2;return new t(this.re/e,-this.im/e)}},{key:"negative",value:function(){return new t(-this.re,-this.im)}},{key:"pow",value:function(e){var i=this.re,n=this.im,o=e.re,r=e.im,a=Math.atan2(n,i),s=t.logHypot(i,n);return i=Math.exp(o*s-r*a),n=r*s+o*a,new t(i*Math.cos(n),i*Math.sin(n))}},{key:"pow0",value:function(e){var i=this.mod,n=Math.atan2(this.im,this.re);return n*=e,new t(i*Math.cos(n),i*Math.sin(n))}},{key:"sqrt",value:function(){var e=this.re,i=this.im,n=this.mod,o=void 0,r=void 0;if(e<0)o=Math.abs(i)/Math.sqrt(2*(n-e));else{if(0===i)return new t(Math.sqrt(e),0);o=.5*Math.sqrt(2*(n+e))}return r=e>0?Math.abs(i)/Math.sqrt(2*(n+e)):.5*Math.sqrt(2*(n-e)),new t(o,0>i?-r:r)}},{key:"exp",value:function(){var e=Math.exp(this.re);return 0===this.im?new t(e,0):new t(e*Math.cos(this.im),e*Math.sin(this.im))}},{key:"expm1",value:function(){var e=this.re,i=this.im;return new t(Math.expm1(e)*Math.cos(i)+t.cosm1(i),Math.exp(e)*Math.sin(i))}},{key:"log",value:function(){var e=this.re,i=this.im;return 0===i&&e>0?new t(Math.log(e),0):new t(t.logHypot(e,i),Math.atan2(i,e))}},{key:"arg",value:function(){return Math.atan2(this.im,this.re)}},{key:"sin",value:function(){var e=this.re,i=this.im;return new t(Math.sin(e)*Math.cosh(i),Math.cos(e)*Math.sinh(i))}},{key:"cos",value:function(){var e=this.re,i=this.im;return new t(Math.cos(e)*Math.cosh(i),-Math.sin(e)*Math.sinh(i))}},{key:"tan",value:function(){var e=2*this.re,i=2*this.im,n=Math.cos(e)+Math.cosh(i);return new t(Math.sin(e)/n,Math.sinh(i)/n)}},{key:"cot",value:function(){var e=2*this.re,i=2*this.im,n=Math.cos(e)-Math.cosh(i);return new t(-Math.sin(e)/n,Math.sinh(i)/n)}},{key:"sec",value:function(){var e=this.re,i=this.im,n=.5*Math.cosh(2*i)+.5*Math.cos(2*e);return new t(Math.cos(e)*Math.cosh(i)/n,Math.sin(e)*Math.sinh(i)/n)}},{key:"csc",value:function(){var e=this.re,i=this.im,n=.5*Math.cosh(2*i)-.5*Math.cos(2*e);return new t(Math.sin(e)*Math.cosh(i)/n,-Math.cos(e)*Math.sinh(i)/n)}},{key:"asin",value:function(){var e=this.re,i=this.im,n=new t(i*i-e*e+1,-2*e*i).sqrt(),o=new t(n.re-i,n.im+e).log();return new t(o.im,-o.re)}},{key:"acos",value:function(){var e=this.re,i=this.im,n=new t(i*i-e*e+1,-2*e*i).sqrt(),o=new t(n.re-i,n.im+e).log();return new t(Math.PI/2-o.im,o.re)}},{key:"atan",value:function(){var e=this.re,i=this.im;if(0===e){if(1===i)return new t(0,Infinity);if(-1===i)return new t(0,-Infinity)}var n=e*e+(1-i)*(1-i),o=new t((1-i*i-e*e)/n,-2*e/n).log();return new t(-.5*o.im,.5*o.re)}},{key:"acot",value:function(){var e=this.re,i=this.im;if(0===i)return new t(Math.atan2(1,e),0);var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).atan():new t(0!==e?e/0:0,0!==i?-i/0:0).atan()}},{key:"asec",value:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new t(0,Infinity);var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).acos():new t(0!==e?e/0:0,0!==i?-i/0:0).acos()}},{key:"acsc",value:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new t(Math.PI/2,Infinity);var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).asin():new t(0!==e?e/0:0,0!==i?-i/0:0).asin()}},{key:"sinh",value:function(){var e=this.re,i=this.im;return new t(Math.sinh(e)*Math.cos(i),Math.cosh(e)*Math.sin(i))}},{key:"cosh",value:function(){var e=this.re,i=this.im;return new t(Math.cosh(e)*Math.cos(i),Math.sinh(e)*Math.sin(i))}},{key:"tanh",value:function(){var e=2*this.re,i=2*this.im,n=Math.cosh(e)+Math.cos(i);return new t(Math.sinh(e)/n,Math.sin(i)/n)}},{key:"coth",value:function(){var e=2*this.re,i=2*this.im,n=Math.cosh(e)-Math.cos(i);return new t(Math.sinh(e)/n,-Math.sin(i)/n)}},{key:"csch",value:function(){var e=this.re,i=this.im,n=Math.cos(2*i)-Math.cosh(2*e);return new t(-2*Math.sinh(e)*Math.cos(i)/n,2*Math.cosh(e)*Math.sin(i)/n)}},{key:"sech",value:function(){var e=this.re,i=this.im,n=Math.cos(2*i)+Math.cosh(2*e);return new t(2*Math.cosh(e)*Math.cos(i)/n,-2*Math.sinh(e)*Math.sin(i)/n)}},{key:"asinh",value:function(){var t=this.im;this.im=-this.re,this.re=t;var e=this.asin();return this.re=-this.im,this.im=t,t=e.re,e.re=-e.im,e.im=t,e}},{key:"acosh",value:function(){var t=this.acos();if(0<t.im){var e=t.im;t.im=-t.re,t.re=e}else{var i=t.re;t.re=-t.im,t.im=i}return t}},{key:"atanh",value:function(){var e=this.re,i=this.im,n=e>1&&0===i,o=1-e,r=1+e,a=o*o+i*i,s=0!==a?new t((r*o-i*i)/a,(i*o+r*i)/a):new t(-1!==e?e/0:0,0!==i?i/0:0),h=s.re;return s.re=t.logHypot(s.re,s.im)/2,s.im=Math.atan2(s.im,h)/2,n&&(s.im=-s.im),s}},{key:"acoth",value:function(){var e=this.re,i=this.im;if(0===e&&0===i)return new t(0,Math.PI/2);var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).atanh():new t(0!==e?e/0:0,0!==i?-i/0:0).atanh()}},{key:"acsch",value:function(){var e=this.re,i=this.im;if(0===i)return new t(0!==e?Math.log(e+Math.sqrt(e*e+1)):Infinity,0);var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).asinh():new t(0!==e?e/0:0,0!==i?-i/0:0).asinh()}},{key:"asech",value:function(){var e=this.re,i=this.im;if(this.isZero())return t.INFINITY;var n=e*e+i*i;return 0!==n?new t(e/n,-i/n).acosh():new t(0!==e?e/0:0,0!==i?-i/0:0).acosh()}},{key:"mod",get:function(){return Math.sqrt(this.re*this.re+this.im*this.im)}},{key:"mod2",get:function(){return this.re*this.re+this.im*this.im}}],[{key:"cosm1",value:function(){var t=Math.PI/4;if(x<-t||x>t)return Math.cos(x)-1;var e=x*x;return e*(e*(1/24+e*(-1/720+e*(1/40320+e*(-1/3628800+e*(1/4790014600+e*(-1/87178291200+e*(1/20922789888e3)))))))-.5)}},{key:"hypot",value:function(t,e){var i=Math.abs(t),n=Math.abs(e);return 3e3>i&&3e3>n?Math.sqrt(i*i+n*n):(n>i?(i=n,n=t/e):n=e/t,i*Math.sqrt(1+n*n))}},{key:"logHypot",value:function(t,e){var i=Math.abs(t),n=Math.abs(e);return 0===t?Math.log(n):0===e?Math.log(i):3e3>i&&3e3>n?.5*Math.log(t*t+e*e):Math.log(t/Math.cos(Math.atan2(e,t)))}},{key:"expm1",value:function(t){return Math.exp(t)-1}}]),t}();r.ZERO=new r(0,0),r.ONE=new r(1,0),r.I=new r(0,1),r.PI=new r(Math.PI,0),r.E=new r(Math.E,0),r.INFINITY=new r(Infinity,Infinity),r.NAN=new r(NaN,NaN),r.EPSILON=1e-16,e["default"]=r},1157:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(621),s=n(a),h=i(517),l=n(h),u=i(77),c=n(u);e["default"]=function(){function t(){o(this,t),this.supportWorker=this.supportWebWorker()&&this.supportArrayBuffer(),this.supportWorker&&this.createWorker(),this.taskId=0,this.taskMap={},this.isRunning=!1,this.taskCache=null}return r(t,[{key:"destroy",value:function(){this.worker.terminate()}},{key:"diffraction",value:function(t,e,i,n,o){this.isRunning?this.taskCache=[t,e,i,n,o]:(this.isRunning=!0,this.taskId++,this.taskMap[this.taskId]=o,this.worker.postMessage([this.taskId,e,i,n,t]))}},{key:"onmessage",value:function(t){var e=t.data[0],i=t.data[1],n=new Float32Array(i),o=this.taskMap[e];o&&o(n),this.isRunning=!1,this.taskCache&&(this.diffraction.apply(this,this.taskCache),this.taskCache=null)}},{key:"supportWebWorker",value:function(){return!!window.Worker}},{key:"supportArrayBuffer",value:function(){try{return new ArrayBuffer(1),!0}catch(t){return!1}}},{key:"createWorker",value:function(){var t='data:text/javascript;charset=utf-8,\n      onmessage=function(evt){\n         var taskId=evt.data[0];\n         var type=evt.data[1];\n         var index=evt.data[2];\n         var z=evt.data[3];\n         var buffer=evt.data[4];\n         var uInt8Array=new Uint8Array(buffer);\n         var arr=DiffractionUtil.getArr2(uInt8Array);\n          var diff=new Diff();\n          diff.setCurLightId(index);\n          diff.z=z;\n          var fftData;\n          if(type===1){\n              fftData=diff.diffraction(arr);\n          }\n          else if(type===2){\n              fftData=diff.diffraction2(arr);\n          }\n          else{\n              fftData=arrayBuffer;\n          }\n          var float32Array=toFloat32Array(fftData);\n         postMessage([taskId,float32Array.buffer]);\n      };\n      function toFloat32Array(arr){\n          var len=arr.length;\n          var float32Array=new Float32Array(len);\n          for(var i=0;i<len;i++){\n              float32Array[i]=arr[i];\n          }\n          return float32Array;\n      };\n      class DiffractionUtil{constructor(){console.log("DiffractionUtil:静态类，不可以new");}static getArr(data){let arr=[];let len=data.length;let m=0;for(let n=0;n<len;n+=4){let color=data[n]*0.299+data[n+1]*0.587+data[n+2]*0.114;arr[m]=color;m++;}return arr;}static getArr2(data){let arr=[];let len=data.length;let m=0;for(let n=0;n<len;n+=4){let hsv=DiffractionUtil.rgb2hsv(data[n],data[n+1],data[n+2]);arr[m]=hsv.v*255;m++;}return arr;}static abs(re,im,len){let arr=[];for(let i=0;i<len;i++){let v1=re[i];let v2=im[i];arr[i]=Math.sqrt(v1*v1+v2*v2);}return arr;}static center(arr,w,h){let a=[];let hw=w>>1;let hh=h>>1;for(let i=0;i<w;i++){for(let j=0;j<h;j++){let ii=i;let jj=j;if(i<hw)ii=i+hw;else ii=i-hw;if(j<hh)jj=j+hh;else jj=j-hh;a[i*w+j]=arr[ii*w+jj];}}return a;}static setArr(data,arr,len){for(let n=0;n<len;n++){data[n]=arr[n];}}static setArr1(data,arr,len){let m=0;for(let n=0;n<len;n+=4){let color=arr[m];data[n]=color;data[n+1]=color;data[n+2]=color;data[n+3]=255;m++;}}static setArr2(data,arr,len,co){let m=0;let orgb=DiffractionUtil.getRGB(co);let hsv=DiffractionUtil.rgb2hsv(orgb.r,orgb.g,orgb.b);for(let n=0;n<len;n+=4){let color=arr[m];hsv.v=Math.min(color/255,1.0);let rgb=DiffractionUtil.hsv2rgb(hsv.h,hsv.s,hsv.v);data[n]=rgb.r;data[n+1]=rgb.g;data[n+2]=rgb.b;data[n+3]=255;m++;}}static setArr3(data,arr){let len=data.length;let m=0;for(let n=0;n<len;n+=4){let color=arr[m];data[n]=color>>16&0xff;data[n+1]=color>>8&0xff;data[n+2]=color&0xff;data[n+3]=255;m++;}}static scale(arr,w,h,sca){let hw=(w/2)<<0;let hh=(h/2)<<0;let result=[];for(let i=0;i<w;i++){for(let j=0;j<h;j++){let ii=(i-hw)/sca+hw;let jj=(j-hh)/sca+hh;ii=Math.floor(ii);jj=Math.floor(jj);if(ii>=w||jj>=h){result[i*w+j]=0;}else{result[i*w+j]=arr[ii*w+jj];}}}return result;}static color(arr,len,co){let data=[];let m=0;let orgb=DiffractionUtil.getRGB(co);let hsv=DiffractionUtil.rgb2hsv(orgb.r,orgb.g,orgb.b);for(let n=0;n<len;n+=4){let color=arr[m];hsv.v=Math.min(color/255,1.0);let rgb=DiffractionUtil.hsv2rgb(hsv.h,hsv.s,hsv.v);data[n]=rgb.r;data[n+1]=rgb.g;data[n+2]=rgb.b;data[n+3]=255;m++;}return data;}static blend(data,arr,len){for(let i=0;i<len;i++){let a=data[i];let b=arr[i];data[i]=a+b;}}static rgb2color(r,g,b){if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;r=r&0xff;g=g&0xff;b=b&0xff;return(r<<16)&(g<<8)&b;}static getRGB(color){let R=color>>16&0xff;let G=color>>8&0xff;let B=color&0xff;return{r:R,g:G,b:B};}static getData0(w,h){let len=w*h;let arr=[];for(let i=0;i<len;i++){arr[i]=0;}return arr;}static rgb2hsv(r,g,b){let h,s,v;let max=Math.max(r,g,b);let min=Math.min(r,g,b);if(r==max)h=(g-b)/(max-min);if(g==max)h=2+(b-r)/(max-min);if(b==max)h=4+(r-g)/(max-min);h=h*60;if(h<0)h+=360;v=Math.max(r,g,b)/255;s=(max-min)/max;return{h:h,s:s,v:v};}static hsv2rgb(h,s,v){let R,G,B;if(s==0){R=G=B=(v*255)<<0;}else{h/=60;let i=h<<0;let f=h-i;let a=v*(1-s);let b=v*(1-s*f);let c=v*(1-s*(1-f));switch(i){case 0:R=v;G=c;B=a;break;case 1:R=b;G=v;B=a;break;case 2:R=a;G=v;B=c;break;case 3:R=a;G=b;B=v;break;case 4:R=c;G=a;B=v;break;case 5:R=v;G=a;B=b;break;}R=(R*255)<<0;G=(G*255)<<0;B=(B*255)<<0;}return{r:R,g:G,b:B};}static convV(data,w,h,oplen){let result=[];let hl=Math.floor(oplen/2);let len=w*h;for(let i=0;i<w;i++){for(let j=0;j<h;j++){let sum=0;let count=0;for(let k=0;k<oplen;k++){let m=i+k-hl;if(m<0)continue;if(m>=w)continue;let n=m*w+j;sum+=data[n];count++;}result[i*w+j]=sum/count;}}return result;}static fftshift(fftData,w,h){const re=[];const im=[];const fftRe=fftData.re;const fftIm=fftData.im;const hw=w>>1;const hh=h>>1;for(let i=0;i<w;i++){for(let j=0;j<h;j++){let ii=i;let jj=j;if(i<hw)ii=i+hw;else ii=i-hw;if(j<hh)jj=j+hh;else jj=j-hh;const m=i*w+j;const n=ii*w+jj;re[m]=fftRe[n];im[m]=fftIm[n];}}return{re:re,im:im};}static setColor(imgData,index,co){const n=index*4;imgData.data[n]=co;imgData.data[n+1]=co;imgData.data[n+2]=co;imgData.data[n+3]=255;}static complexMul(a,b,len){const re=[];const im=[];const are=a.re;const aim=a.im;const bre=b.re;const bim=b.im;for(let i=0;i<len;i++){var a=are[i];var b=aim[i];const c=bre[i];const d=bim[i];re[i]=a*c-b*d;im[i]=a*d+b*c;}return{re:re,im:im};}static complexMul0(a,com,len){const re=[];const im=[];const are=a.re;const aim=a.im;const c=com.re;const d=com.im;for(let i=0;i<len;i++){var a=are[i];const b=aim[i];re[i]=a*c-b*d;im[i]=a*d+b*c;}return{re:re,im:im};}static mul(arr,n,len){const result=[];for(let i=0;i<len;i++){const di=arr[i];result[i]=di*n;}return result;}static maxData(arr,len){let max=-Infinity;for(let i=0;i<len;i++){const di=arr[i];if(di>max){max=di;}}return max;}};\n      class Diff{constructor(){this.lightLamdas=[660,580,550,493,450,410,0];this.lightColors=[0xff0000,0xffff00,0x00ff00,0x00ffff,0x0000ff,0xff00ff,0xffffff];this.whiteLight=[{name:"红光",lamda:660,color:0xff0000},{name:"黄光",lamda:580,color:0xffff00},{name:"绿光",lamda:550,color:0x00ff00},{name:"浅蓝光",lamda:493,color:0x00ffff},{name:"蓝光",lamda:450,color:0x0000ff},{name:"紫光",lamda:410,color:0xff00ff}];this.BASE_LAMDA=410;this.setFourierSize(8);this.data0=DiffractionUtil.getData0(this.FOURIER_SIZE,this.FOURIER_SIZE);this.z=0;}setFourierSize(n){this.FOURIER_N=n;this.FOURIER_SIZE=1<<this.FOURIER_N;this.FOURIER_LEN=this.FOURIER_SIZE*this.FOURIER_SIZE;this.IMG_DATA_LEN=this.FOURIER_LEN*4;}setCurLightId(id){if(id>=this.lightLamdas.length)id=0;this.curLightId=id;this.curLamda=this.lightLamdas[this.curLightId];this.curColor=this.lightColors[this.curLightId];}diffraction(arr){var obj=Fourier.FFT2(arr,this.data0,this.FOURIER_N,this.FOURIER_N,1,1);var fftData=DiffractionUtil.abs(obj.re,obj.im,this.FOURIER_LEN);fftData=DiffractionUtil.center(fftData,this.FOURIER_SIZE,this.FOURIER_SIZE);if(this.curLamda>0){var sca=this.curLamda/this.BASE_LAMDA;fftData=DiffractionUtil.scale(fftData,this.FOURIER_SIZE,this.FOURIER_SIZE,sca);fftData=DiffractionUtil.color(fftData,this.IMG_DATA_LEN,this.curColor);}else{var result=[];for(var i=0;i<this.whiteLight.length;i++){var o=this.whiteLight[i];var sca=o.lamda/this.BASE_LAMDA;var arr=DiffractionUtil.scale(fftData,this.FOURIER_SIZE,this.FOURIER_SIZE,sca);arr=DiffractionUtil.color(arr,this.IMG_DATA_LEN,o.color);if(i===0){result=arr;}else{DiffractionUtil.blend(result,arr,this.IMG_DATA_LEN);}}fftData=result;}return fftData;}singleLightresnelFft2(data,z,lamda,color){lamda=lamda*1e-9;var h=this.getH(z,lamda);var B=Fourier.FFT2(data.re,data.im,this.FOURIER_N,this.FOURIER_N,1,1);B=DiffractionUtil.fftshift(B,this.FOURIER_SIZE,this.FOURIER_SIZE);var H=Fourier.FFT2(h.re,h.im,this.FOURIER_N,this.FOURIER_N,1,1);H=DiffractionUtil.fftshift(H,this.FOURIER_SIZE,this.FOURIER_SIZE);var G=DiffractionUtil.complexMul(B,H,this.FOURIER_LEN);var U=Fourier.IFFT2(G.re,G.im,this.FOURIER_N,this.FOURIER_N,1,1);U=DiffractionUtil.fftshift(U,this.FOURIER_SIZE,this.FOURIER_SIZE);var fftData=DiffractionUtil.abs(U.re,U.im,this.FOURIER_LEN);var max=DiffractionUtil.maxData(fftData,this.FOURIER_LEN);fftData=DiffractionUtil.mul(fftData,255/max,this.FOURIER_LEN);fftData=DiffractionUtil.color(fftData,this.IMG_DATA_LEN,color);return fftData;}whiteLightresnelFft2(data){var B=Fourier.FFT2(data,this.data0,this.FOURIER_N,this.FOURIER_N,1,1);var fftData=[];for(var i=0;i<this.whiteLight.length;i++){var o=this.whiteLight[i];var lamda=o.lamda*1e-9;var h=this.getH(this.z,lamda);var H=Fourier.FFT2(h.re,h.im,this.FOURIER_N,this.FOURIER_N,1,1);var G=DiffractionUtil.complexMul(B,H,this.FOURIER_LEN);var U=Fourier.IFFT2(G.re,G.im,this.FOURIER_N,this.FOURIER_N,1,1);U=DiffractionUtil.fftshift(U,this.FOURIER_SIZE,this.FOURIER_SIZE);var arr=DiffractionUtil.abs(U.re,U.im,this.FOURIER_LEN);var max=DiffractionUtil.maxData(arr,this.FOURIER_LEN);arr=DiffractionUtil.mul(arr,255/max,this.FOURIER_LEN);arr=DiffractionUtil.color(arr,this.IMG_DATA_LEN,o.color);if(i===0){fftData=arr;}else{DiffractionUtil.blend(fftData,arr,this.IMG_DATA_LEN);}}return fftData;}diffraction2(data){var fftData;if(this.curLamda>0){fftData=this.singleLightresnelFft2({re:data,im:this.data0},this.z,this.curLamda,this.curColor);}else{fftData=this.whiteLightresnelFft2(data);}return fftData;}getH(z,lamda){var re=[];var im=[];var m=0;var k=2*Math.PI/lamda;var SIZE=this.FOURIER_SIZE;var HALF_SIZE=SIZE/2;var pxm=5e-5;for(var i=0;i<SIZE;i++){for(var j=0;j<SIZE;j++){var dx=(i-HALF_SIZE)*pxm;var dy=(j-HALF_SIZE)*pxm;var a2=k*(dx*dx+dy*dy)/(2*z);re[m]=Math.cos(a2);im[m]=Math.sin(a2);m++;}}return{re:re,im:im};}getN(lamd){lamd=lamd/1000;var a=1.3831;var b=0.0712;var c=-0.0064;var lamd1=1/lamd;var lamd2=lamd1*lamd1;var lamd4=lamd2*lamd2;var rn=a+b*lamd2+c*lamd4;return rn;}}\n      class Fourier{constructor(){console.log("Fourier:静态类，不可以new");}static DFT(fre,fim,dir,k){const n=fre.length;const gre=[];const gim=[];for(var i=0;i<n;i++){gre[i]=0;gim[i]=0;const arg=-dir*2*Math.PI*i*k/n;for(var j=0;j<n;j++){const cos=Math.cos(j*arg);const sin=Math.sin(j*arg);gre[i]+=fre[j]*cos-fim[j]*sin;gim[i]+=fre[j]*sin+fim[j]*cos;}if(dir==1){}else{gre[i]=gre[i]/n;gim[i]=gim[i]/n;}}return{re:gre,im:gim};}static FFT(fre,fim,r,k){const n=1<<r;const wre=[];const wim=[];const hn=n>>1;var gre=[];var gim=[];var lre=[];var lim=[];for(var i=0;i<hn;i++){const angle=-2*Math.PI*i*k/n;wre[i]=Math.cos(angle);wim[i]=Math.sin(angle);}for(var k=0;k<r;k++){for(var j=0;j<(1<<k);j++){const bfsize=1<<(r-k);const hbfsize=bfsize>>1;for(var i=0;i<hbfsize;i++){var p=j*bfsize;const i1=i+p;const i2=i+p+hbfsize;gre[i1]=fre[i1]+fre[i2];gim[i1]=fim[i1]+fim[i2];const kk=i<<k;const xre=fre[i1]-fre[i2];const xim=fim[i1]-fim[i2];gre[i2]=xre*wre[kk]-xim*wim[kk];gim[i2]=xre*wim[kk]+xim*wre[kk];}}lre=fre;lim=fim;fre=gre;fim=gim;gre=lre;gim=lim;}for(var j=0;j<n;j++){var p=0;for(var i=0;i<r;i++){if(j&(1<<i)){p+=1<<(r-i-1);}}gre[j]=fre[p];gim[j]=fim[p];}const sqrN=Math.sqrt(n);for(var i=0;i<n;i++){gre[i]=gre[i]/sqrN;gim[i]=-gim[i]/sqrN;}return{re:gre,im:gim};}static IFFT(fre,fim,r,k){const n=1<<r;for(var i=0;i<n;i++){fim[i]=-fim[i];}const g=Fourier.FFT(fre,fim,r,k);return g;}static FFT2(fre,fim,wr,hr,wk,hk){const n=1<<wr;const m=1<<hr;const gre=[];const gim=[];for(var i=0;i<m;i++){var lre=[];var lim=[];var index;for(var j=0;j<n;j++){index=i*n+j;lre[j]=fre[index];lim[j]=fim[index];}var g=Fourier.FFT(lre,lim,wr,wk);for(j=0;j<n;j++){index=i*n+j;gre[index]=g.re[j];gim[index]=g.im[j];}}for(var j=0;j<n;j++){var lre=[];var lim=[];var index;for(var i=0;i<m;i++){index=i*n+j;lre[i]=gre[index];lim[i]=gim[index];}var g=Fourier.FFT(lre,lim,hr,hk);for(i=0;i<m;i++){index=i*n+j;gre[index]=g.re[i];gim[index]=g.im[i];}}return{re:gre,im:gim};}static IFFT2(fre,fim,wr,hr,wk,hk){const n=1<<wr;const m=1<<hr;var g;var index;for(var i=0;i<m;i++){for(var j=0;j<n;j++){index=i*n+j;fim[index]=-fim[index];}}var g=Fourier.FFT2(fre,fim,wr,hr,wk,hk);return g;}};\n      ';if(t.indexOf("//")){t=t.replace(RegExp("//[^\n]*","g"),"")}this.worker=new Worker(t),this.worker.onmessage=this.onmessage.bind(this)}}]),t}();!function(){function t(){o(this,t),this.lightLamdas=[660,580,550,493,450,410,0],this.lightColors=[16711680,16776960,65280,65535,255,16711935,16777215],this.whiteLight=[{name:c["default"].getLocaleStr("red_light"),lamda:660,color:16711680},{name:c["default"].getLocaleStr("yellow_light"),lamda:580,color:16776960},{name:c["default"].getLocaleStr("green_light"),lamda:550,color:65280},{name:c["default"].getLocaleStr("less_blue_light"),lamda:493,color:65535},{name:c["default"].getLocaleStr("blue_light"),lamda:450,color:255},{name:c["default"].getLocaleStr("violet_light"),lamda:410,color:16711935}],this.BASE_LAMDA=410,this.setFourierSize(8),this.data0=l["default"].getData0(this.FOURIER_SIZE,this.FOURIER_SIZE),this.z=0}r(t,[{key:"setFourierSize",value:function(t){this.FOURIER_N=t,this.FOURIER_SIZE=1<<this.FOURIER_N,this.FOURIER_LEN=this.FOURIER_SIZE*this.FOURIER_SIZE,this.IMG_DATA_LEN=4*this.FOURIER_LEN}},{key:"setCurLightId",value:function(t){this.lightLamdas.length>t||(t=0),this.curLightId=t,this.curLamda=this.lightLamdas[this.curLightId],this.curColor=this.lightColors[this.curLightId]}},{key:"diffraction",value:function(t){var e=s["default"].FFT2(t,this.data0,this.FOURIER_N,this.FOURIER_N,1,1),i=l["default"].abs(e.re,e.im,this.FOURIER_LEN);if(i=l["default"].center(i,this.FOURIER_SIZE,this.FOURIER_SIZE),this.curLamda>0){var n=this.curLamda/this.BASE_LAMDA;i=l["default"].scale(i,this.FOURIER_SIZE,this.FOURIER_SIZE,n),i=l["default"].color(i,this.IMG_DATA_LEN,this.curColor)}else{for(var o=[],r=0;this.whiteLight.length>r;r++){var a=this.whiteLight[r],n=a.lamda/this.BASE_LAMDA,t=l["default"].scale(i,this.FOURIER_SIZE,this.FOURIER_SIZE,n);t=l["default"].color(t,this.IMG_DATA_LEN,a.color),0===r?o=t:l["default"].blend(o,t,this.IMG_DATA_LEN)}i=o}return i}},{key:"singleLightresnelFft2",value:function(t,e,i,n){i*=1e-9;var o=this.getH(e,i),r=s["default"].FFT2(t.re,t.im,this.FOURIER_N,this.FOURIER_N,1,1);r=l["default"].fftshift(r,this.FOURIER_SIZE,this.FOURIER_SIZE);var a=s["default"].FFT2(o.re,o.im,this.FOURIER_N,this.FOURIER_N,1,1);a=l["default"].fftshift(a,this.FOURIER_SIZE,this.FOURIER_SIZE);var h=l["default"].complexMul(r,a,this.FOURIER_LEN),u=s["default"].IFFT2(h.re,h.im,this.FOURIER_N,this.FOURIER_N,1,1);u=l["default"].fftshift(u,this.FOURIER_SIZE,this.FOURIER_SIZE);var c=l["default"].abs(u.re,u.im,this.FOURIER_LEN),d=l["default"].maxData(c,this.FOURIER_LEN);return c=l["default"].mul(c,255/d,this.FOURIER_LEN),c=l["default"].color(c,this.IMG_DATA_LEN,n)}},{key:"whiteLightresnelFft2",value:function(t){for(var e=s["default"].FFT2(t,this.data0,this.FOURIER_N,this.FOURIER_N,1,1),i=[],n=0;this.whiteLight.length>n;n++){var o=this.whiteLight[n],r=1e-9*o.lamda,a=this.getH(this.z,r),h=s["default"].FFT2(a.re,a.im,this.FOURIER_N,this.FOURIER_N,1,1),u=l["default"].complexMul(e,h,this.FOURIER_LEN),c=s["default"].IFFT2(u.re,u.im,this.FOURIER_N,this.FOURIER_N,1,1);c=l["default"].fftshift(c,this.FOURIER_SIZE,this.FOURIER_SIZE);var d=l["default"].abs(c.re,c.im,this.FOURIER_LEN),f=l["default"].maxData(d,this.FOURIER_LEN);d=l["default"].mul(d,255/f,this.FOURIER_LEN),d=l["default"].color(d,this.IMG_DATA_LEN,o.color),0===n?i=d:l["default"].blend(i,d,this.IMG_DATA_LEN)}return i}},{key:"diffraction2",value:function(t){return this.curLamda>0?this.singleLightresnelFft2({re:t,im:this.data0},this.z,this.curLamda,this.curColor):this.whiteLightresnelFft2(t)}},{key:"getH",value:function(t,e){for(var i=[],n=[],o=0,r=2*Math.PI/e,a=this.FOURIER_SIZE,s=a/2,h=0;a>h;h++)for(var l=0;a>l;l++){var u=5e-5*(h-s),c=5e-5*(l-s),d=r*(u*u+c*c)/(2*t);i[o]=Math.cos(d),n[o]=Math.sin(d),o++}return{re:i,im:n}}},{key:"getN",value:function(t){t/=1e3;var e=1/t,i=e*e;return 1.3831+.0712*i+i*i*-.0064}}])}()},444:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var o=i(457),r=(n(o),i(577)),a=(n(r),i(576)),s=(n(a),i(492)),h=(n(s),i(463)),l=(n(h),i(493)),u=(n(l),i(619)),c=(n(u),i(679)),d=(n(c),i(1107)),f=n(d);f["default"].classList={ConvexGlass:n(i(1115))["default"],GlassBlock:n(i(1124))["default"],RedRayPen:n(i(1140))["default"],Cistern:n(i(1110))["default"],ConcaveMirror:n(i(1114))["default"],ConvexMirror:n(i(1116))["default"],HalfRoundGlass:n(i(1125))["default"],PlaneMirror:n(i(1137))["default"],RightTriplePrism:n(i(1142))["default"],TriplePrism:n(i(1145))["default"],ConcaveGlass:n(i(1113))["default"],WhiteRayPen:n(i(1147))["default"],Optical:n(i(1131))["default"],ColorPanel:n(i(1112))["default"],OpticsRuler:n(i(1135))["default"],Rule:n(i(1143))["default"],FoldPaperboard:n(i(1121))["default"],RefractionChopsticks:n(i(1141))["default"],XiaokongExp:n(i(1148))["default"],LaserDemonstrator:n(i(1126))["default"],Polaroid:n(i(1139))["default"],DoubleSlitExp:n(i(1119))["default"],OpticalBench:n(i(1132))["default"],Screen:n(i(1144))["default"],Periscope:n(i(1136))["default"],BicyceLeamp:n(i(1108))["default"],DiffuseMirror:n(i(1118))["default"],BrineCistern:n(i(1109))["default"],FraunhoferDiffraction:n(i(1122))["default"],FresnelDiffraction:n(i(1123))["default"],EqualThicknessInterference:n(i(1120))["default"],DiffractionGrating:n(i(1117))["default"],ColorPalette:n(i(1111))["default"],LightIntensityMeter:n(i(1127))["default"],WaterOpticalFiber:n(i(1146))["default"],OpticalThermometer:n(i(1134))["default"],PlaneMirrorImaging:n(i(1138))["default"],OpticalLens:n(i(1133))["default"],Magnifier:n(i(1129))["default"]},e["default"]=f["default"]},446:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(451),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.iscomponent=!1,i}return r(e,t),a(e,[{key:"setComponent",value:function(t){}},{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.userData.isnbequ=!0}}]),e}(l["default"])},449:function(t,e,i){"use strict";e.__esModule=!0;var n={};n.BEGIN="bodyDragBegin",n.MOVE="bodyDragMove",n.END="bodyDragEnd",n.CLICK="bodyClick",e["default"]=n},451:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function x(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:x(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(560),c=n(u),d=i(487),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0,_=void 0,b=void 0,m=void 0,w=void 0,O=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.main?t.main.phy.nape:i.phy.nape,w=p.phys.BodyType,O=p.geom.Mat23,g=p.NbBody,y=p.NbCircle,v=p.geom.Vec2,_=p.shape.Polygon,b=p.shape.Circle,m=p.geom.GeomPoly,(i.napeEngine=t.moduleMain.napeEngine)?(i.CbTypeStr=t.moduleMain.CbTypeStr,i.BodyUtil=t.moduleMain.BodyUtil,i.Vec2Util=t.moduleMain.Vec2Util,i.JointUtil=t.moduleMain.JointUtil,i.NapeConst=t.moduleMain.NapeConst,i.ToolStatusStr=t.moduleMain.ToolStatusStr,i.InteractionFilterManager=t.moduleMain.InteractionFilterManager,i.RayUtil=t.moduleMain.RayUtil,i.NBOpticsStr=t.moduleMain.NBOpticsStr,i.cateid=5,i.level=15,i.isFreeMec=!1,i.isMechanics=!0,i.classType="MechanicsBase",i.material=new p.phys.Material(.3,.5,.6,2.7,.001),i.body=null,i.geomPoly=null,i.points=null,i._shape=null,i.radius=0,i._width=30,i._height=30,i.roteVec2=null,i.verticesArr=[],i._bodyType=w.get_DYNAMIC(),i.rotaAng=null,i.touchEnabled=!0,i.linstenerArr=[],i.space=i.napeEngine.space,i.openF_analysis=!1,i.istoolMove=!1,i.istool=!1,i.ismecJoint=!1,i.isOpendefRot=!0,i.limitForceDrag=!1,i.maxDragForce=1e5,i.dragFAry=[],i.nosetbodyxy=!1,i.useDragSetCurElec=!1,i.culprit=!1,i.translateRect=null,i.currentScale=new l.Point(1,1),i.lastScale=new l.Point(1,1),i.skinCon=new PIXI.Container,i.addChild(i.skinCon),i._selected=!1,i.transformN=new O,i.equlock=!1,i.updatecallback=null,i.alignAfterScale=!1,i.transformManager=null,i.selfDragManager=!1,i):r(i)}return a(e,t),s(e,[{key:"init",value:function(){this.createBody(),this.createShape(),this.napeEngine.space.add(this.body),this.rotaSP&&(this.rotaAng=new c["default"](this.paramObj,this,this._rotateHandleFunc)),this.setScale(this.currentScale.x,this.currentScale.y),this.setRotation(this.rotation)}},{key:"getGlobalScale",value:function(){return this.globalConfig.main.view.scale.x}},{key:"changeSelfSize",value:function(){}},{key:"addCbType",value:function(t){this.body.cbTypes.add(t)}},{key:"getSelected",value:function(){return this._selected}},{key:"setSelected",value:function(t){this._selected=t}},{key:"setScale",value:function(t,e){if(this.body){this.lastScale.x=this.currentScale.x,this.lastScale.y=this.currentScale.y,this.currentScale.x=t,this.currentScale.y=e;var i=this.getTransform();this.body.transformShapes(i),this.transformN=this.transformN.concat(i),this.alignAfterScale&&this.body.align(),this.BodyUtil.setMaterial(this.material,"density",this.material.get_density())}else this.currentScale.x=t,this.currentScale.y=e}},{key:"setLocalScale",value:function(t,e){var i=O.scale(t,e),n=i;this.body.transformShapes(n),this.transformN=this.transformN.concat(n),n=this.transformN,this.lastScale.x=this.currentScale.x,this.lastScale.y=this.currentScale.y,this.currentScale.x=Math.sqrt(n.get_a()*n.get_a()+n.get_b()*n.get_b()),this.currentScale.y=Math.sqrt(n.get_c()*n.get_c()+n.get_d()*n.get_d()),this.BodyUtil.setMaterial(this.material,"density",this.material.get_density())}},{key:"getTransform",value:function(){var t=O.rotation(-this.body.rotation);return O.rotation(this.body.rotation).concat(O.scale(this.currentScale.x/this.lastScale.x,this.currentScale.y/this.lastScale.y).concat(t))}},{key:"setRotation",value:function(t){if(this.roteVec2){var e=t-this.body.rotation;this.body.rotate(this.body.localPointToWorld(this.roteVec2),e)}else this.rotation=t,this.body&&(this.body.rotation=t)}},{key:"getRotation",value:function(){return this.body.rotation}},{key:"resetUserView",value:function(t,e,i,n){this.body.userData.view=t,n&&(this.body.userData.classType=n),e&&(this.body.userData.coordinateField=e),!0===i&&(this.body.userData.bindupdate={func:this.update,field:this})}},{key:"addBodyToSpace",value:function(t,e,i){e&&(t.userData.coordinateField=e),i&&t.userData.view&&(t.userData.bindupdate={func:t.userData.view.update,field:t.userData.view}),t.set_space(this.napeEngine.space)}},{key:"removeBodyFromSpace",value:function(t){t&&t.set_space(null)}},{key:"added",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this),this.cannotSystemDrag=!0,this.init(),this.parent.addChild(this.componentBox)}},{key:"_this_stopDrag",value:function(t){}},{key:"_addRotateControl",value:function(){}},{key:"findRotaShape",value:function(t){var e=this.body.get_shapes(),i=e.get_length(),n=void 0;for(n=0;i>n;n++){var o=e.at(n);if(o.get_userData().isRotation&&o.contains(v.weak(t.x,t.y)))return!0}return!1}},{key:"addOneRoteShape",value:function(t,e,i){var n=new y(i);return this.body.add(n),n.get_userData().isRotation=!0,n.translate(v.weak(t,e)),n.set_sensorEnabled(!0),n}},{key:"_rotateHandleFunc",value:function(t,e,i){if(this.componentBox.rotation=e,this.body.rotation=e,null===t&&this.rotaChange(),this.canShowAngleShape&&i){var n=this.toGlobalView(new l.Point(0,0),this),o=this.componentBox.rotation,r=this.globalConfig.main.arcShape;r.clear(),r.lineStyle(2,this.globalConfig.DEFAULT_TXT_COLOR,.5),r.drawCircle(n.x,n.y,150),r.beginFill(16711935,.2),r.lineStyle(1,16777215,0);var a=i,s=l.M.getPointLen(a,this._cenP);o%=2*Math.PI;var h=o;r.moveTo(n.x,n.y),r.arc(n.x,n.y,s,0,h,!0),r.endFill(),this.freshAngleTxt(),this._oriA=h}}},{key:"rotateA",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"rotateA",this).call(this,t),this.body.rotation=this.componentBox.rotation}},{key:"freshAngleTxt",value:function(){var t=l.M.toAngle(this.componentBox.rotation);t%=360,t*=-1,0>t&&(t+=360),this.globalConfig.main.arcTxt.text=l.M.getNumJie(t,1)+"°",this.globalConfig.main.arcTxt.style.fill=l.M.getDomColor(this.globalConfig.DEFAULT_TXT_COLOR),this.globalConfig.main.arcTxt.updateText()}},{key:"startDragRect",value:function(t,i){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"startDragRect",this).call(this),!t&&this.canShowAngleShape){this._cenP=this.toGlobalView(new l.Point(0,0),this),this._startDragAngle=this.componentBox.rotation+Math.PI/2,this._addAngle=0,this._oriA=this._startDragAngle,this.globalConfig.main.arcTxt.visible=!0,this.freshAngleTxt(),l.M.setSPPoint(this.globalConfig.main.arcTxt,this._cenP)}else if(t&&this.canShowAngleShape){var n=new l.Point(this.body.posx,this.body.posy);this._cenP=n,this._startDragAngle=this.body.get_rotation(),this._addAngle=0,this.globalConfig.main.arcTxt.visible=!0,this.freshAngleTxt(),l.M.setSPPoint(this.globalConfig.main.arcTxt,this._cenP)}}},{key:"endDragRect",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"endDragRect",this).call(this),this.globalConfig.main.arcShape.clear(),this.globalConfig.main.arcTxt.visible=!1}},{key:"rotaChange",value:function(){}},{key:"removed",value:function(){this.getSelected()&&this.setSelected(!1),this.transformManager=null,this.removeForceAnalysis(),this.deleteMapeUid(this.UID),this.rotaAng&&(this.rotaAng.dispose(),this.rotaAng=null);var t=void 0;for(t=0;this.linstenerArr.length>t;t++)this.removeNapeListeners(this.linstenerArr[t]);this.linstenerArr.length=0,this.componentBox&&this.componentBox.parent&&this.componentBox.parent.removeChild(this.componentBox),this.componentBox=null,this.body&&(this.body.cbTypes.clear(),this.BodyUtil.destoryBody(this.body),this.body=null),delete this.cateid,this.material=null,this._shape=null,this.napeEngine=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){this.openF_analysis&&this.drawForceAnalysis(),this.updatecallback&&this.updatecallback(),this.updatePosition()}},{key:"getTopGrc",value:function(){return this.napeEngine?this.napeEngine.grC:null}},{key:"removeForceAnalysis",value:function(){var t=this.getTopGrc();t&&t.dispatchEvent("Dispose_Graphics",this.UID)}},{key:"drawForceAnalysis",value:function(t){var e=[];t||(t=this.body),e.push({option:"Force",target:t}),this.getTopGrc().dispatchEvent("Start_Graphic",e,this.UID)}},{key:"drawForceArrow",value:function(t){var e=[{option:"ForceArrow",data:t}];this.getTopGrc().dispatchEvent("Start_Graphic",e,this.UID)}},{key:"touchManager",value:function(t){this.touchEnabled&&t&&t.target.UID===this.UID&&this.refreshDragRectXY()}},{key:"refreshDragRectXY",value:function(){this.componentBox.x=this.x,this.componentBox.y=this.y}},{key:"createBody",value:function(){this.body=new g(w.get_DYNAMIC()),this.body.userData.view=this,this.body.userData.classType=this.classType,this.body.posx=this.x,this.body.posy=this.y,this.bindUidToBody(this.body,this.UID)}},{key:"removeFromFramework",value:function(t){this.body.isdestory=!0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removeFromFramework",this).call(this,t)}},{key:"bodyErrCallBack",value:function(){this instanceof nb.mec.base.FluidBase?this.parent.removeFromFramework(this):this.removeFromFramework(this)}},{key:"inWaterUpdate",value:function(t,e){this.BodyUtil.dampingBodyVelocity(this.body,1,e.getCoefficientViscosity())}},{key:"createShape",value:function(){var t=this;if(this.verticesArr&&0<this.verticesArr.length)for(var e=0;this.verticesArr.length>e;e++){var i=this.verticesArr[e];t.body.add(new _(new m(i),t.material))}else{if(null!==this.geomPoly)return void this.body.add(new _(this.geomPoly,this.material));if(this.points&&this.points.length>1){for(var n=new p.geom.Vec2List,o=0;this.points.length>o;o++){var r=this.points[o];n.push(v.get(r.x,r.y))}var a=new _(n,this.material),s=""+a.validity();if("VALID"!==s){if("DEGENERATE"===s)return;var h=new m(n);if(h.isDegenerate())return;var l=null;try{l=h.simpleDecomposition()}catch(c){return}var u=new p.geom.GeomPolyList;l.foreach(function(t){u.merge(t.convexDecomposition())});return void u.foreach(function(e){t.body.add(new _(e,t.material))})}this._shape=a}else this._shape=0!==this.radius?new b(this.radius,null,this.material):new _(p.shape.Polygon.box(this._width,this._height),this.material);this.body.add(this._shape)}}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.ismecJoint=this.ismecJoint,t.isMechanics=this.isMechanics,t.thisX=this.x,t.thisY=this.y,t.fromEquTools=this.fromEquTools,t.uid=this.UID,t.material=this.getMaterialData(),t.transform={a:this.transformN.get_a(),b:this.transformN.get_b(),c:this.transformN.get_c(),d:this.transformN.get_d(),tx:this.transformN.get_tx(),ty:this.transformN.get_ty()},t.currentScale=this.currentScale,this.body&&(t.posx=this.body.posx,t.posy=this.body.posy,t.rotation=l.M.getValidHu(this.body.rotation)),t}},{key:"getMaterialData",value:function(){var t={};return this.material&&(t.density=this.material.get_density(),t.elasticity=this.material.get_elasticity(),t.dynamicFriction=this.material.get_dynamicFriction(),t.staticFriction=this.material.get_staticFriction(),t.rollingFriction=this.material.get_rollingFriction()),t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.uid&&(this.bindUidToBody(this.body,this.UID,t.uid),this.UID=t.uid),this.body&&t.hasOwnProperty("posx")&&!this.nosetbodyxy&&(this.body.posx=t.posx,this.body.posy=t.posy),this.body.rotation=t.rotation,this.material&&t.material&&this.BodyUtil.setMaterialFromObject(this.material,t.material),t.currentScale&&(this.currentScale.x=t.currentScale.x,this.currentScale.y=t.currentScale.y),t.transform&&(this.transformN=new O(t.transform.a,t.transform.b,t.transform.c,t.transform.d,t.transform.tx,t.transform.ty))}},{key:"getScaleDragRect",value:function(){var t=this.body.get_bounds(),e=this.body.get_position();return new PIXI.Rectangle(t.get_x()-e.get_x(),t.get_y()-e.get_y(),t.get_width(),t.get_height())}},{key:"getDragRect",value:function(){return{x:.5*-this.bg.width,y:.5*-this.bg.height,width:this.bg.width,height:this.bg.height}}},{key:"addNapeListeners",value:function(t){return this.linstenerArr.push(t),this.napeEngine.space.listeners.add(t)}},{key:"removeNapeListeners",value:function(t,e){if(t){var i=this.linstenerArr.indexOf(t);return i>-1&&this.linstenerArr.splice(i,1),this.napeEngine.space.listeners.remove(t)}}},{key:"getWorldBody",value:function(){return this.napeEngine.space.world}},{key:"getEngineTouchManager",value:function(){return this.napeEngine.getTouchManager()}},{key:"groupManager",value:function(){return this.napeEngine.groupManager()}},{key:"getGravity",value:function(){return this.napeEngine.getGravity()}},{key:"getForce",value:function(t){return t/this.NapeConst.FORCE_RATIO}},{key:"getBodyElasticity",value:function(){return this.material.zpp_inner.elasticity}},{key:"getBodyDensity",value:function(){return 1e3*this.material.zpp_inner.density}},{key:"getDynamicFriction",value:function(){return this.material.zpp_inner.dynamicFriction}},{key:"func_testDraw",value:function(t,e){this.getTopGrc().testDraw(t,e)}},{key:"getBodyFromUid",value:function(t){return this.napeEngine.uidMap[t]}},{key:"deleteMapeUid",value:function(t){this.napeEngine&&this.napeEngine.uidMap&&delete this.napeEngine.uidMap[t]}},{key:"bindUidToBody",value:function(t,e,i){this.napeEngine&&(this.napeEngine.uidMap[e]&&delete this.napeEngine.uidMap[e],i?this.napeEngine.uidMap[i]=t:this.napeEngine.uidMap[e]=t)}},{key:"systemPlayStatus",value:function(){return this.napeEngine.play}},{key:"changeLock",value:function(t){this.equlock=t.checked,this.equlock?(this.body.set_type(w.get_KINEMATIC()),this.BodyUtil.frezzBody(this.body)):this.body.set_type(w.get_DYNAMIC())}},{key:"removeDragManager",value:function(){var t=void 0;this.body&&this.body.userData&&(t=this.body.userData.dragManager),t&&t.func_touchEnd(new PIXI.Point)}},{key:"getLocalBoundsElecs",value:function(){return[this]}},{key:"addTweenQuan",value:function(t){var e=this.main;t.showHitCircle=function(){e.view.tipTopLayer.mec_showHitCircle.call(e.view.tipTopLayer,this)}.bind(t),t.hideHitCircle=function(){e.view.tipTopLayer.mec_hideHitCircle.call(e.view.tipTopLayer,this)}.bind(t)}},{key:"dragToolBegin",value:function(t){}},{key:"dragToolMove",value:function(t){}},{key:"dragToolEnd",value:function(t){}},{key:"checkDrag",value:function(t){return!0}}]),e}(f["default"])},452:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1),a=void 0,s=void 0;e["default"]=function(){function t(e){n(this,t),this.config=e,this.globalConfig=e.globalConfig,this.BodyUtil=e.moduleMain.BodyUtil,this.Vec2Util=e.moduleMain.Vec2Util,this.JointUtil=e.moduleMain.JointUtil,this.NapeConst=e.moduleMain.NapeConst,this.napeEngine=e.moduleMain.napeEngine,this.NBCommand=e.NBCommand,a=e.moduleMain.phy.nape,s=a.geom.Vec2,this.space=null,this.UID=null,this.touchUid=null,this.main=e.moduleMain.main,this.canvas=e.moduleMain.main.canvas,this.stage=e.moduleMain.main.stage,this.view=e.moduleMain.main.view,this.var_vo={},this.superObj={},this.active=!1}return o(t,[{key:"setActive",value:function(t){this.active=t}},{key:"adsorbToCom",value:function(t,e,i){var n=this.getGlobalScale(),o=t.get_worldCOM(),a=r.Point.vec2ToPoint(o);i/n>r.Point.distance(a,e)&&(e.x=a.x,e.y=a.y)}},{key:"dispose",value:function(){this.main=null,this.stage=null,this.config=null,this.space=null,this.canvas=null,this.globalConfig=null,this.BodyUtil=null,this.Vec2Util=null,this.JointUtil=null,this.NapeConst=null,this.napeEngine=null,this.NBCommand=null}},{key:"init",value:function(t,e){this.space=e,this.canvas=t}},{key:"setBodyStatus",value:function(t,e){t.statusMap||(t.statusMap=[]),t.statusMap.push(this.BodyUtil.getBodyStatus(t)),this.BodyUtil.setBodyStatus(t,e)}},{key:"restoreBodyStatus",value:function(t){if(t&&t.statusMap&&0!==t.statusMap.length)for(;t.statusMap.length;){var e=t.statusMap.pop();this.BodyUtil.setBodyStatus(t,e)}}},{key:"func_getP",value:function(t){var e=new r.Point(0,0);return this.globalConfig.main.mapPositionToPoint(e,t.clientX,t.clientY),e=this.view.toLocal(e,this.stage)}},{key:"onDomClick",value:function(t){}},{key:"stateChange",value:function(){}},{key:"initScale",value:function(t){var e=2/this.getGlobalScale();t.setScale(e,e)}},{key:"func_touchBegin",value:function(t){var e=t,i=this.space.bodiesUnderPoint(new s(e.x,e.y));i.filter(function(t){return!t.userData||!t.userData.isnbequ});var n=this.BodyUtil.getTopBodyFormBodyList(i);this.var_vo={},this.var_vo.beginBody=n,this.var_vo.beginVec2=this.Vec2Util.pointToVec2(e)}},{key:"func_touchMove",value:function(t){}},{key:"func_touchEnd",value:function(t,e){}},{key:"touchTab",value:function(t){}},{key:"doubleTab",value:function(t){}},{key:"getTopBodyUnderPoint",value:function(t){return this.BodyUtil.getTopBodyFormBodyList(this.space.bodiesUnderPoint(this.Vec2Util.pointToVec2(t)))}},{key:"getGlobalScale",value:function(){return this.globalConfig.main.view.scale.x}},{key:"addEquipmentChild",value:function(t,e){this.globalConfig.main.addEquipmentChild(t,e)}},{key:"func_dispose",value:function(){this.napeEngine.grC.dispatchEvent("Dispose_Graphics",this.UID),this.UID=null}},{key:"func_dispatchGraphic",value:function(t){null===this.UID&&(this.UID=r.M.getUniqueID()),this.napeEngine.grC.dispatchEvent("Start_Graphic",t,this.UID)}},{key:"cancelMecSelected",value:function(t){var e=this.BodyUtil.getSelectBodyUnderPoint(this.space,t);if(e){e.userData.view.setSelected(!1)}}}]),t}()},454:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function r(){n(this,r)};o.OVERFLOW_WATER="overflow_water",o.NEI_BU_LINEJOINT_BREAK="neiBuLineJointBreak",o.WORLD_TIME_CHANGE="worldTimeChange",o.WORLD_UPDATE="world_update",o.TICKER_PAPER_MENU_CHANGE="ticker_paper_menu_change",o.TICKER_PAPER_AUTOMATIC_BREAK="ticker_paper_automatic_Break",o.TICKER_POWER_CHANGE="ticker_power_change",o.SCALE_BIG_PAPER="scale_big_paper",o.CAN_GET_SPEEDDATA="can_get_speedData",o.SET_BODY_STATE="set_body_state",e["default"]=o},457:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(451),c=n(u),d=i(492),f=n(d),p=void 0,y=void 0,g=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=i.phy.nape,y=p.phys.BodyType,i.isOpticsEqu=!0,i.vo=null,i.isOpendefRot=!1,i.rate=1.5,i.var_cansetRate=!1,i.rotlist=[],i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.set_type(y.get_KINEMATIC()),this.getDragRect(),this.openAngleFunc(this.globalConfig.OPEN_ANGLE),this.showDirectionFunc(this.globalConfig.SHOW_DIRECTION),this.showReflectFunc(this.globalConfig.SHOW_REFLECT)}},{key:"removed",value:function(){this.vo=null;for(var t=0;this.rotlist.length>t;t++){var i=this.rotlist[t];this.globalConfig.main.cachePool.pushGraphic(i),this.removedCursor(i)}this.rotlist.length=0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"handleLight",value:function(t,e,i,n){}},{key:"preHandleLight",value:function(t,e,i,n){}},{key:"setShapeInterFliter",value:function(t){t.set_filter(this.NBOpticsStr.filters)}},{key:"getDragRect",value:function(){return{x:0,y:0,width:200,height:200}}},{key:"addOneRoteShape",value:function(t,i,n){var o=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"addOneRoteShape",this).call(this,t,i,n);o.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS);var r=this.globalConfig.main.cachePool.popGraphic();return r.beginFill(16711680,0),r.drawCircle(0,0,n),r.endFill(),this.addChild(r),r.x=t,r.y=i,this.rotlist.push(r),this.addCursor(r,"xuanzhuan"),o}},{key:"rotaChange",value:function(){this.showToolDatas()}},{key:"confType",value:function(t,i){e.OPEN_ANGLE==t?this.openAngleFunc(i):e.SHOW_REFLECT==t?this.showReflectFunc(i):e.SHOW_DIRECTION==t&&(this.showDirectionFunc(i),f["default"].OPEN_LIGHT_DIRECTION=i)}},{key:"openAngleFunc",value:function(t){this.vo&&(this.vo.var_open_angle=t)}},{key:"showReflectFunc",value:function(t){this.vo&&this.vo.var_canRefraction&&(this.vo.var_canReflection=t?this.vo.var_copyReflection:t)}},{key:"showDirectionFunc",value:function(t){this.vo&&(this.vo.var_show_direction=t)}},{key:"func_rotaThis",value:function(t){this._rotateHandleFunc("menuChange",l.M.getNumStr(t.showValue)*Math.PI/180)}},{key:"func_getRate",value:function(){return l.M.getNumJie(this.vo.n,1)}},{key:"func_changeRate",value:function(t){this.vo.n=l.M.getNumStr(t.showValue)-0}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return this.var_cansetRate&&(t.cansetRate=this.func_getRate()),t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),null!==t.cansetRate&&t.cansetRate!==undefined&&this.func_changeRate({showValue:t.cansetRate})}},{key:"showScaleTool",value:function(t){this.napeEngine.transformManager&&(t?this.napeEngine.transformManager.show(this,this.scaleChangeCallBack):this.napeEngine.transformManager.hide())}},{key:"scaleChangeCallBack",value:function(t){}},{key:"getConf",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this);if(t.confArr=[],this.var_cansetRate){t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("par_refractivity"),!0,"",2,1,this.func_getRate(),.1,this.func_changeRate,this))}return t}}]),e}(c["default"]);g.OPEN_ANGLE=1,g.SHOW_REFLECT=2,g.SHOW_DIRECTION=3,e["default"]=g},458:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(50),s=n(a),h=i(472),l=n(h),u=void 0,c=function(){function t(e){o(this,t),this.config=Object.assign({},e),this.config.moduleMain=this,u=this,this.moduleType=-1,this.active=!1,this.hasInit=!1,this.cachePool=new l["default"],this.looplist=[]}return r(t,[{key:"getModuleType",value:function(){return this.constructor.MODULE_TYPE}},{key:"init",value:function(){this.hasInit=!0}},{key:"addPhysicsCanvasListeners",value:function(){var t=this.config.main;this.onRemoveEquipmentProx||(this.onRemoveEquipmentProx=this.onRemoveEquipment.bind(this),this.onCanvasDomClickProx=this.onCanvasDomClick.bind(this),this.onSetDataCompleteProx=this.onSetDataComplete.bind(this)),t.addEventListener(s["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),t.addEventListener(s["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),t.addEventListener(s["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"removePhysicsCanvasListeners",value:function(){var t=this.config.main;t.removeEventListener(s["default"].REMOVE_EQUIPMENT,this.onRemoveEquipmentProx),t.removeEventListener(s["default"].CANVAS_DOM_CLICK,this.onCanvasDomClickProx),t.removeEventListener(s["default"].SET_DATA_COMPLETE,this.onSetDataCompleteProx)}},{key:"canvasLock",value:function(t){}},{key:"onRemoveEquipment",value:function(){}},{key:"onCanvasDomClick",value:function(t){}},{key:"onSetDataComplete",value:function(){}},{key:"onShowAllEquip",value:function(){}},{key:"setActive",value:function(t){this.active=t,8===this.moduleType?t?(PIXI.settings.RESOLUTION=1,this.forceAndMotion.resize()):PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION:PIXI.settings.RESOLUTION!==this.globalConfig.RESOLUTION&&(PIXI.settings.RESOLUTION=this.globalConfig.RESOLUTION),t?this.addPhysicsCanvasListeners():this.removePhysicsCanvasListeners()}},{key:"enterModule",value:function(t){return Promise.resolve()}},{key:"destroy",value:function(){this.removePhysicsCanvasListeners(),this.config.moduleMain=null,this.config=null,this.onRemoveEquipmentProx=null,this.onCanvasDomClickProx=null,this.onSetDataCompleteProx=null,this.hasInit=null,this.active=null}},{key:"updateEqu",value:function(){for(var t=this.main.getEquipmentArr(!0),e=0;t.length>e;e++){var i=t[e];if(i.update)try{i.update()}catch(n){}}}},{key:"getData",value:function(){return{}}},{key:"setData",value:function(t){}},{key:"startRecoverEqu",value:function(){}},{key:"completeRecoverEqu",value:function(){}},{key:"setDataBefore",value:function(){return Promise.resolve()}},{key:"requestAnimationLoop",value:function(){this.updateEqu(),this.main&&this.main.disComp&&this.main.disComp.update(),this.foreachLooplist()}},{key:"foreachLooplist",value:function(){for(var t=0;this.looplist.length>t;t++){var e=this.looplist[t];e.update&&e.update()}}},{key:"main",get:function(){return this.config?this.config.main:null}},{key:"equipmentUtil",get:function(){return this.main.equipmentUtil}},{key:"globalConfig",get:function(){return this.main.globalConfig}},{key:"language",get:function(){return this.main.language}},{key:"SoundTool",get:function(){return this.main.globalConfig.SoundTool}},{key:"phy",get:function(){return this.main.phy}},{key:"ParticleUtil",get:function(){return this.config.ParticleUtil}},{key:"SoundStr",get:function(){return this.config.SoundStr}},{key:"Button",get:function(){return this.config.Button}},{key:"HoverButton",get:function(){return this.config.HoverButton}},{key:"ComponentProperty",get:function(){return this.config.ComponentProperty}},{key:"NBCommand",get:function(){return this.config.NBCommand}},{key:"MouseManager",get:function(){return this.config.MouseManager}},{key:"NBDrag",get:function(){return this.config.NBDrag}},{key:"UploadSkinTool",get:function(){return this.config.UploadSkinTool}},{key:"NBEvent",get:function(){return this.config.NBEvent}}],[{key:"getInstance",value:function(){return u}}]),t}();window.each=function(t,e,i){var n=void 0;for(n=0;t&&t.length>n;n++){if(!1===(i?e.call(i,n,t[n]):e.call(t[n],n,t[n])))break}},e["default"]=c},463:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(){function t(e,i,o){n(this,t),this.var_canReflection=null==e||e,this.var_canRefraction=null==i||i,this.n=null==o?1:o,this.rate=o,this.var_whiteNotReflect=!1,this.var_constantLight=!1,this.var_copyReflection=this.var_canReflection,this.var_guangdao=!1,this.var_gdtopbton="top",this.var_open_angle=!0,this.var_show_reflect=!0,this.var_show_direction=!0,this.sensor=!1,this.sensorObj={},this.bodyIsMultiShape=!1,this.multiN=!1,this.view=null,this.id=-1}return o(t,[{key:"clone",value:function(){var e=new t;for(var i in this)e[i]=this[i];return e}}]),t}()},471:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(541),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0,d=void 0;e["default"]=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return c=t.moduleMain.phy.nape,d=c.geom.Vec2,a.classname="PolygonView",a.verticesArr=i||[],r&&(a.skinColor=r),a.bg=a,a.skinGra=null,a.drawTest=new PIXI.Graphics,a.alignAfterScale=!0,a}return r(e,t),a(e,[{key:"fixReset",value:function(t){var e={x:this.body.posx,y:this.body.posy};this.body.align();var i=this.body.position;t?t():(this.bg.x-=i.get_x()-e.x,this.bg.y-=i.get_y()-e.y)}},{key:"setScale",value:function(t,i){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScale",this).call(this,t,i),this.skinCon.scale.x=1,this.skinCon.scale.y=1,this.changeSkin()}},{key:"setLocalScale",value:function(t,i){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setLocalScale",this).call(this,t,i),this.skinCon.scale.x=1,this.skinCon.scale.y=1,this.changeSkin()}},{key:"offsetXY",value:function(){return{x:this.bg.x,y:this.bg.y}}},{key:"getFillSkin",value:function(){var t=new PIXI.Graphics;this.skinGra=t;for(var e=this.body.shapes,i=e.get_length(),n=0;i>n;n++){var o=e.at(n),r=o.get_localVerts();t.lineStyle(1,this.skinColor,1),t.beginFill(this.skinColor,1);for(var a=r.get_length(),s=0;a>s;s++){var h=r.at(s),l=h.get_x(),u=h.get_y();0===s?t.moveTo(l,u):t.lineTo(l,u)}t.endFill()}return t}},{key:"getTextureSkin",value:function(t){var e=new PIXI.Container;return this.body.shapes.foreach(function(i){var n=[];i.get_localVerts().foreach(function(t){var e=t.get_x(),i=t.get_y();n.push(new h.Point(e,i))});var o=new h.GraphicsTexture(t,h.GraphicsTexture.POLYGON,{points:n,notlight:!0});e.addChild(o)}),e}},{key:"getEdge",value:function(){var t=this.Vec2Util.getBodyEdge(this.body),i=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getEdge",this).call(this);if(i.lineStyle(this.lineThin,this.lineColor,1),t.compound)for(var n=t.list,o=0;n.length>o;o++){var r=n[o],a=r.v1,h=r.v2;a=this.body.worldPointToLocal(a),h=this.body.worldPointToLocal(h),i.moveTo(a.get_x(),a.get_y()),i.lineTo(h.get_x(),h.get_y())}else for(var l=void 0,u=void 0,c=t.get_length(),d=0;c>d;d++){var f=t.at(d);f=this.body.worldPointToLocal(f),0===d?(l=f.get_x(),u=f.get_y(),i.moveTo(l,u)):i.lineTo(f.get_x(),f.get_y()),d===c-1&&i.lineTo(l,u)}return i}},{key:"drawFunc",value:function(t,e,i){this.drawTest.beginFill(i),this.drawTest.drawCircle(t,e,5),this.drawTest.endFill(),this.addChild(this.drawTest)}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.verticesArr=this.Vec2Util.vec2ArrArrToPointArrArr(this.verticesArr),t.bgxy={x:this.bg.x,y:this.bg.y},t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.verticesArr&&(this.verticesArr=this.Vec2Util.pointArrArrToVec2ArrArr(t.verticesArr)),this.body.shapes.clear(),this.createShape(),this.body.align(),this.body.transformShapes(this.transformN),this.changeSkin()}},{key:"sliceSetData",value:function(t){var e=this;t.material&&this.BodyUtil.setMaterialFromObject(this.material,t.material),this.skinIndex=t.skinIndex,this.skinColor=t.skinColor,this.skinType=t.skinType,isNaN(t.skinIndex)||(this.skinName=this.originlist[this.skinIndex]),this.groupIndex=t.groupIndex,this.body.align();for(var i=this.verticesArr.length,n=0;i>n;n++)for(var o=this.verticesArr[n],r=o.length,a=0;r>a;a++){var s=o[a];o[a]=this.body.worldPointToLocal(s)}this.changeSkin(),t.lightprototype&&setTimeout(function(){e.hadDestory||(e.vo.n=t.rateN,e.lightprototype=t.lightprototype,e.gotoOpticsMc())},10),setTimeout(function(){e.hadDestory||e.changeGroup({showValue:e.groupMap[e.groupIndex]})},0)}},{key:"selectRenderChild",value:function(){this.updateTransform();var t=this.body.get_bounds(),e=this.getMain().view.toGlobal({x:t.get_x(),y:t.get_y()}),i=this.getBounds();i.x=e.x,i.y=e.y;var n=this.getGlobalScale();return i.width=t.get_width()*n,i.height=t.get_height()*n,i}}]),e}(u["default"])},472:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(){function t(){n(this,t),this.graphicsList=[],this.textList=[],this.elecWiredots=[],this.threeList={}}return o(t,[{key:"disposeAll",value:function(){this.graphicsList.length=0,this.textList.length=0,this.elecWiredots.length=0;for(var t=Object.keys(this.threeList),e=0;t.length>e;e++)for(var i=this.threeList[t[e]],n=0;i.length>n;n++)try{var o=i[n];o.removed&&o.removed()}catch(r){}this.threeList={}}},{key:"resetAll",value:function(t){t.x=0,t.y=0,t.pivot.x=0,t.pivot.y=0,t.scale.x=1,t.scale.y=1,t.rotation=0}},{key:"pushGraphic",value:function(t){t.clear(),this.resetAll(t),this.graphicsList.push(t)}},{key:"popGraphic",value:function(){var t=this.graphicsList.pop();return t&&t.transform||(t=new PIXI.Graphics),t}},{key:"pushText",value:function(t){t.text="",this.resetAll(t),this.textList.push(t)}},{key:"popText",value:function(t,e){var i=this.textList.pop();return i||(t=t||"",e=e||"",i=new PIXI.Text(t,e)),i}},{key:"pushElecDot",value:function(t){this.elecWiredots.push(t)}},{key:"popElecDot",value:function(){return this.elecWiredots.pop()}},{key:"pushThreeClass",value:function(t,e){var i=this.threeList[t];i||(i=[],this.threeList[t]=i),this.resetAll(e),i.push(e)}},{key:"popThreeClass",value:function(t,e,i){var n=this.threeList[t],o=null;return n&&(o=n.pop()),o||(o=new e(i)),o}}]),t}()},474:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=new(function(){function t(){n(this,t),this.index=0,this.colorArr=[15684432,15753874,12144851,8280002,5467646,240116,5227511,1960374,7697781,12531212,16088855,16758605,16771899,11730777,6610199,4431943],this.totalColors=this.colorArr.length}return o(t,[{key:"getColor",value:function(){return this.index+=1,this.totalColors>this.index||(this.index-=this.totalColors),this.colorArr[this.index]}}]),t}())},487:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.useBottom=!1,i.useTop=!1,i.bottomCon=null,i.topCon=null,i.pinP={x:0,y:0},i}return r(e,t),a(e,[{key:"added",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this),this.useBottom&&(this.bottomCon=this._addCon(this.main.view.viewBottomStack)),this.useTop&&(this.topCon=this._addCon(this.main.view.viewTopStack)),this.updatePosition()}},{key:"removed",value:function(){this._removeCon(this.bottomCon),this._removeCon(this.topCon),this.bottomCon=null,this.topCon=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"updatePosition",value:function(){this.getPinView();var t=this.pinP,e=this.getRotInView();this.bottomCon&&(this.bottomCon.x=t.x,this.bottomCon.y=t.y,this.bottomCon.rotation=e),this.topCon&&(this.topCon.x=t.x,this.topCon.y=t.y,this.topCon.rotation=e)}},{key:"getRotInView",value:function(){return this.rotation}},{key:"getPinView",value:function(){this.pinP.x=this.x,this.pinP.y=this.y}},{key:"moveEnd",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"moveEnd",this).call(this,t),this.updatePosition()}},{key:"_addCon",value:function(t){var e=new PIXI.Container;return t.addChild(e),e.interactive=!1,e.interactiveChildren=!1,e}},{key:"_removeCon",value:function(t){t&&t.parent&&t.parent.removeChild(t)}}]),e}(l["default"])},489:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function x(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:x(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(49),u=i(1),c=i(226),d=n(c),f=i(452),p=n(f),y=i(228),g=n(y),v=void 0,_=void 0,b=void 0,m=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.SCALE_NORMAL=e.SCALE_NORMAL,i.SCALE_ONLY_X=e.SCALE_ONLY_X,i.SCALE_ONLY_Y=e.SCALE_ONLY_Y,i.SCALE_UNIFORM=e.SCALE_UNIFORM,i.MouseManager=t.MouseManager,v=t.main.phy.nape,_=v.geom.Vec2,b=v.phys.GravMassMode,i.globalConfig=t.globalConfig,i.freeMec=null,i.body=null,i.handleBox=new w(t),i.active=!1,i}return a(e,t),s(e,[{key:"dispose",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}},{key:"setRotateEnabled",value:function(t){this.handleBox&&this.handleBox.setRotateEnabled(t)}},{key:"setScaleMode",value:function(t){if(this.handleBox)switch(t){case e.SCALE_NORMAL:this.handleBox.showHandles(),this.handleBox.uniform=!1;break;case e.SCALE_ONLY_X:this.handleBox.hideHandles(),this.handleBox.showHandlesX();break;case e.SCALE_ONLY_Y:this.handleBox.hideHandles(),this.handleBox.showHandlesY();break;case e.SCALE_UNIFORM:this.handleBox.hideHandles(),this.handleBox.showHandlesCorner(),this.handleBox.uniform=!0}}},{key:"show",value:function(t,i){var n=this;this.freeMec&&this.freeMec!==t&&this.freeMec.setSelected(!1),this.freeMec=t,this.body=t.body,this.callback=i,t&&(t.updatecallback=function(){n.render()}),t.transformManager=this,this.handleBox.setRotation(this.body.rotation);var o=this.freeMec.getDragRect();this.handleBox.initBoundBox(o.x,o.y,o.width,o.height),this.lastScaleX=1,this.lastScaleY=1,this.handleBox.x=this.freeMec.x,this.handleBox.y=this.freeMec.y,this.handleBox.displayScale=2/this.getGlobalScale(),this.originScale=new u.Point(this.freeMec.currentScale.x,this.freeMec.currentScale.y),this.handleBox.listen(!0),this.handleBox.callBackObj=this,this.BodyUtil.frezzBody(this.body),!t||t.isOpticsEqu||t.isMechaTool||this.setBodyStatus(this.body,0);var r=[];r.push({option:"addElement",target:this.handleBox,params:{x:0,y:0}}),this.func_dispatchGraphic(r),this.handleBox.parent=this.globalConfig.main.viewStack,this.setScaleMode(e.SCALE_NORMAL),this.setRotateEnabled(!0),this.freeMec.body.set_gravMass(0),this.handleBox.scaleing=!1,this.active=!0,this.handleBox.setRotation(this.body.rotation)}},{key:"render",value:function(){if(this.active&&!this.handleBox.scaleing){if(this.freeMec.hadDestory)return void this.hide();var t=this.freeMec.getDragRect();this.handleBox.initBoundBox(t.x,t.y,t.width,t.height),this.lastScaleX=1,this.lastScaleY=1,this.handleBox.x=this.freeMec.x,this.handleBox.y=this.freeMec.y,this.originScale=new u.Point(this.freeMec.currentScale.x,this.freeMec.currentScale.y),this.handleBox.displayScale=2/this.getGlobalScale()}}},{key:"hide",value:function(){if(this.body&&this.body.set_gravMassMode(b.get_DEFAULT()),this.handleBox){if(this.active=!1,this.handleBox.listen(!1),this.func_dispose(),this.handleBox.parent&&this.handleBox.parent.removeChild(this.handleBox),this.freeMec){this.body&&!this.freeMec.isOpticsEqu&&this.restoreBodyStatus(this.body);var t=this.freeMec;this.freeMec=null,t.updatecallback=null,t.transformManager=null,t.setSelected(!1)}this.boStatus=null,this.body=null,this.handleBox.callBackObj=null}}},{key:"changeCallBack",value:function(t){if(t.end){this.globalConfig.main.execute(this.NBCommand.interactive.MOUSE_CURSOR_ENABLED,{code:0,obj:null});for(var e=this.body.constraints,i=0;i<e.get_length();i++){var n=e.at(i),o=n.userData.toolView;o&&(o.bodyChanged?o.bodyChanged(this.body):this.body.contains(_.get(o.x,o.y))||o.removeFromFramework(o))}}else{if(t.scale){this.freeMec.setLocalScale(t.scale.x/this.lastScaleX,t.scale.y/this.lastScaleY),this.lastScaleX=t.scale.x,this.lastScaleY=t.scale.y;var r=this.handleBox.getGlobalCentroidP();this.freeMec.body.set_position(_.get(r.x,r.y)),this.BodyUtil.frezzBody(this.freeMec.body)}t.rotation&&this.freeMec.setRotation(t.rotation),this.callback&&this.callback.call(this.freeMec,{bounds:this.getSkinBounds(),rot:t.rotation})}}},{key:"getSkinBounds",value:function(){var t=this.freeMec.skinCon.getLocalBounds();return t.x*=this.freeMec.skinCon.scale.x,t.width*=this.freeMec.skinCon.scale.x,t.y*=this.freeMec.skinCon.scale.y,t.height*=this.freeMec.skinCon.scale.y,t}}]),e}(p["default"]);m.SCALE_NORMAL=1,m.SCALE_ONLY_X=2,m.SCALE_ONLY_Y=3,m.SCALE_UNIFORM=4,e["default"]=m;var w=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));i.scaleing=!1,i.globalConfig=t.globalConfig,i.container=new PIXI.Container,i.addChild(i.container),i.lineColor=5198164,i.lineThin=2,i.hh=50,i.minW=10,i.maxW=1e5,i.minH=10,i.maxH=1e5,i.lockCenter=!0,i.graphics=new PIXI.Graphics,i.container.addChild(i.graphics),i.handle=g["default"].createBtn(["skin/operate_icon_turn_default","skin/operate_icon_turn_pre"]),i.handle.name="rot",i.handle.cursorType="rotate",i.handle.cursorRotation=0,i.handle.flipRotation=0,i.handle.oppositeName="",i.p0=new O("t","shangxia",90,0,"b"),i.p1=new O("r","zuoyou",0,0,"l"),i.p2=new O("b","shangxia",-90,0,"t"),i.p3=new O("l","zuoyou",180,0,"r"),i.p4=new O("tl","qingxie",-135,-90,"br"),i.p5=new O("tr","qingxie",-45,90,"bl"),i.p6=new O("br","qingxie",45,-90,"tl"),i.p7=new O("bl","qingxie",135,90,"tr"),i._handles=[i.handle,i.p0,i.p1,i.p2,i.p3,i.p4,i.p5,i.p6,i.p7],i._rect=new u.Rectangle,i._originRect=new u.Rectangle,i._curHandle=null,i._originP=new u.Point,i._displayScale=1,i._rotation=0,i._cRotation=0,i.stage=i.globalConfig.main,i.uniform=!1,i.p8=new O("c","center",0,0,""),i.container.addChild(i.p8),i.p8.visible=!1,i.centroidP=new u.Point(0,0),i.c=0,i.p9=new PIXI.Graphics,i.container.addChild(i.p9),i.p9.lineStyle(2,16711935,1),i.p9.drawCircle(0,0,10),i.p9.visible=!1,i.bg=new PIXI.Graphics,i.bg.name="bg",i.bg.interactive=!1,i.container.addChild(i.bg);for(var n=0;9>n;n++){var a=i._handles[n];i.container.addChild(a),a.oppositeHandle=i.getChildByName(a.oppositeName)}i.dotG=new PIXI.Graphics,i.addChild(i.dotG),i.PointStyle={dark:{color:5723995,alpha:.8,size:2},light:{color:16777215,alpha:.8,size:3}},i.rotateAngleArr=[],i.rotateNum=60;for(var s=0;i.rotateNum>s;s++)i.rotateAngleArr.push(2*Math.PI*s/60);i.rotateText=new PIXI.Text(""),i.rotateBox=new PIXI.Sprite,i.bgH=40,i.bgW=80;var h=new PIXI.Graphics;return h.beginFill(0,.6),h.drawRoundedRect(0,0,i.bgW,i.bgH,10),h.endFill(),i.rotateBox.addChild(h),i.rotateBox.addChild(i.rotateText),i.addChild(i.rotateBox),i.rotateBox.pivot.y=i.bgH,i.rotateBox.pivot.x=i.bgW/2,i.rotateBox.visible=!1,i}return a(e,t),s(e,[{key:"drawDotCir",value:function(){var t=u.M.getSPPoint(this.p8);u.M.getCenP(this.p0,this.handle);this.rotateText.text=Math.round(u.M.toAngle(this.container.rotation))+"°";var e=u.M.getPointLen(t,this.handle);this.rotateBox.scale.x=2/this.main.view.scale.x,this.rotateBox.scale.y=2/this.main.view.scale.y,this.rotateBox.x=this.p8.x,this.rotateBox.y=this.p8.y-e-120/this.main.view.scale.x,this.rotateText.x=(this.bgW-this.rotateText.width)/2,this.rotateText.y=(this.bgH-this.rotateText.height)/2}},{key:"showDotCir",value:function(t){this.dotG.visible=t,this.rotateBox.visible=t,t&&this.rotateText.setStyle({font:'28px "Microsoft Yahei"',align:"left",fill:16777215})}},{key:"hideHandles",value:function(t){t=t||["p0","p1","p2","p3","p4","p5","p6","p7"];for(var e=0;t.length>e;e++){var i=this[t[e]];i&&(i.visible=!1)}}},{key:"showHandles",value:function(t){t=t||["p0","p1","p2","p3","p4","p5","p6","p7"];for(var e=0;t.length>e;e++){var i=this[t[e]];i&&(i.visible=!0)}}},{key:"showHandlesX",value:function(){this.showHandles(["p1","p3"])}},{key:"showHandlesY",value:function(){this.showHandles(["p0","p2"])}},{key:"showHandlesCorner",value:function(){this.showHandles(["p4","p5","p6","p7"])}},{key:"setRotateEnabled",value:function(t){this.handle.visible=t,this.__updateLine()}},{key:"initBoundBox",value:function(t,e,i,n){this._originRect=new u.Rectangle(t,e,i,n),this.__setBoundBox(t,e,i,n),this.centroidP=new u.Point(0,0),this.c=new u.Point((this.p3.x-this.centroidP.x)/(this.p3.x-this.p1.x),(this.p0.y-this.centroidP.y)/(this.p0.y-this.p2.y))}},{key:"setRotation",value:function(t){this.container.rotation=t,this._rotation=t}},{key:"__setBoundBox",value:function(t,e,i,n){this.p0.x=t+i/2,this.p0.y=e,this.p1.x=t+i,this.p1.y=e+n/2,this.p2.x=t+i/2,this.p2.y=e+n,this.p3.x=t,this.p3.y=e+n/2,this.p4.x=t,this.p4.y=e,this.p5.x=t+i,this.p5.y=e,this.p6.x=t+i,this.p6.y=e+n,this.p7.x=t,this.p7.y=e+n,this.handle.x=this.p0.x,this.handle.y=this.p0.y-this.hh*this._displayScale,this.p8.x=t+i/2,this.p8.y=e+n/2,this._rect.x=t,this._rect.y=e,this._rect.width=i,this._rect.height=n,this.__updateLine(),this.__updateBg()}},{key:"getBoundBox",value:function(){return this._rect.clone()}},{key:"__updateLine",value:function(){this.graphics.clear(),this.graphics.lineStyle(this.lineThin*this._displayScale,this.lineColor),this.graphics.drawRect(this._rect.x,this._rect.y,this._rect.width,this._rect.height),this.graphics.moveTo(this.p0.x,this.p0.y),this.handle.visible&&this.graphics.lineTo(this.handle.x,this.handle.y)}},{key:"__updateBg",value:function(){this.bg.clear(),this.bg.beginFill(16777215,.1),this.bg.drawRect(this._rect.x,this._rect.y,this._rect.width,this._rect.height),this.bg.endFill()}},{key:"listen",value:function(t){for(var e=0;9>e;e++){var i=this._handles[e];t?(i.touchBeginUid||(i.touchBeginUid=u.M.addTouch(i,{begin:this.__mouseDownHandler,isAddDB:!1},this)),this.addCursor(i,i.cursorType)):(i.touchBeginUid&&u.M.removeTouch(i,i.touchBeginUid),i.touchBeginUid=null,this.removedCursor(i))}}},{key:"__mouseDownHandler",value:function(t){this.paramObj.moduleMain.napeEngine.touchManager.enAbled=!1,this._cRotation=0;var e=this._curHandle=t.target;this._originP=this.container.toLocal(this.getMouseXY(t).clone(),this.globalConfig.main.view),"rotate"===e.cursorType&&(this.drawDotCir(),this.showDotCir(!0)),e.touchMoveUid||(e.touchMoveUid=u.M.addTouch(e,{move:this.__mouseMoveHandler,isAddDB:!1},this)),e.touchUpUid||(e.touchUpUid=u.M.addTouch(e,{end:this.__mouseUpHandler,isAddDB:!1},this))}},{key:"__mouseUpHandler",value:function(t){var e=this._curHandle;e.touchMoveUid&&u.M.removeTouch(e,e.touchMoveUid),e.touchUpUid&&u.M.removeTouch(e,e.touchUpUid),e.touchMoveUid=e.touchUpUid=null,this.callBackObj&&this.callBackObj.changeCallBack&&this.callBackObj.changeCallBack({end:1}),this.scaleing=!1,"rotate"===e.cursorType&&this.showDotCir(!1),t.stopImmediatePropagation()}},{key:"__mouseMoveHandler",value:function(t){function e(t){switch(t){case"t":s.y+=a,s.height-=a;break;case"b":s.height+=a;break;case"l":s.x+=r,s.width-=r;break;case"r":s.width+=r;break;case"tl":s.y+=a,s.height-=a,s.x+=r,s.width-=r;break;case"br":s.height+=a,s.width+=r;break;case"tr":s.y+=a,s.height-=a,s.width+=r;break;case"bl":s.height+=a,s.x+=r,s.width-=r;break;case"rot":var e=i.toLocal(i._originP,i.container),o=i.callBackObj.freeMec,h={x:0,y:0};o.roteVec2&&(h=new u.Point(o.roteVec2.get_x(),o.roteVec2.get_y()),h=i.toLocal(h,o));var l=Math.atan2(e.y-h.y,e.x-h.x)+Math.PI/2;i._rotation=i._rotation+l-i._cRotation,i._cRotation=l,i.container.rotation=l,i._originP=i.container.toLocal(n,i.globalConfig.main.view),i.callBackObj&&i.callBackObj.changeCallBack&&i.callBackObj.changeCallBack({rotation:i.container.rotation}),i.drawDotCir.call(i)}}var i=this,n=this.getMouseXY(t).clone(),o=this.container.toLocal(n,this.globalConfig.main.view),r=o.x-this._originP.x,a=o.y-this._originP.y;this._originP=o;var s=this._rect.clone(),h={tl:1,br:1,tr:-1,bl:-1},c=(0,l.get)(t,"data.originalEvent.shiftKey");(0,l.get)(t,"data.originalEvent.altKey"),(0,l.get)(t,"data.originalEvent.ctrlKey");if(this.uniform||c){var d=h[this._curHandle.name];if(d){var f=s.width/s.height;Math.abs(r/a)>f?a=d*r/f:r=d*a*f}}e(this._curHandle.name),this.lockCenter&&this._curHandle.oppositeName&&""!=this._curHandle.oppositeName&&(r*=-1,a*=-1,e(this._curHandle.oppositeName)),(this.minW>s.width||s.width>this.maxW)&&(s.width=this._rect.width,s.x=this._rect.x),(this.minH>s.height||s.height>this.maxH)&&(s.height=this._rect.height,s.y=this._rect.y),this.__setBoundBox(s.x,s.y,s.width,s.height),this.__updateCentroidP();var p=s.width/this._originRect.width,y=s.height/this._originRect.height;1==p&&1==y||(this.scaleing=!0,this.callBackObj&&this.callBackObj.changeCallBack&&this.callBackObj.changeCallBack({scale:{x:p,y:y}}))}},{key:"__updateCentroidP",value:function(){this.centroidP.x=this.p3.x-this.c.x*(this.p3.x-this.p1.x),this.centroidP.y=this.p0.y-this.c.y*(this.p0.y-this.p2.y),this.p9.x=this.centroidP.x,this.p9.y=this.centroidP.y}},{key:"getGlobalCentroidP",value:function(){return this.globalConfig.main.view.toLocal(this.centroidP,this.container)}},{key:"displayScale",set:function(t){this._displayScale=t;for(var e=0;9>e;e++){var i=this._handles[e];i.scale.x=i.scale.y=this._displayScale}this.__updateLine()}}]),e}(d["default"]),O=function(t){function e(t,i,n,a,s){o(this,e);var h=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return h.name=t,h.cursorType=i,h.cursorRotation=n,h.flipRotation=a,h.oppositeName=s,h.oppositeHandle=null,h._displayScale=1,h.lineColor=5198164,h.fillColor=2369322,h.hitSp=new PIXI.Graphics,h.addChild(h.hitSp),h.freshScale(),h.refresh(),h}return a(e,t),s(e,[{key:"freshScale",value:function(){var t=this._displayScale;this.sideLen=9*t,this.dragRadius=20*t,this.lineThin=2*t,this.roundRadius=3*t}},{key:"refresh",value:function(){this.clear(),this.lineStyle(this.lineThin,this.lineColor),this.beginFill(this.fillColor),this.drawRoundedRect(-this.sideLen/2,-this.sideLen/2,this.sideLen,this.sideLen,this.roundRadius),this.endFill(),this.lineStyle(null),this.beginFill(16711680,0),this.drawCircle(0,0,this.dragRadius),this.endFill()}},{key:"displayScale",set:function(t){this._displayScale=t,this.freshScale(),this.refresh()}}]),e}(PIXI.Graphics)},492:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function b(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:b(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(226),c=n(u),d=i(618),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0,_=function(t){function e(t,i,n,a){o(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a));return p=s.phy.nape,v=p.geom.LDMath,y=p.geom.Vec2,g=p.geom.Ray,s.RayUtil=a.moduleMain.RayUtil,s.NBOpticsStr=a.moduleMain.NBOpticsStr,s.body=t,s.space=a.moduleMain.napeEngine.space,s.lineThin=5,s.col=null===n?16777215:n,s.threshold=.1,s.lineStart=[117,0],s.lightStartOffset=y.get(),s.closeLight=!1,s.var_offsetY=0,s.var_offsetX=0,s.lineN=null===i?1:i,s.isWhiteLight=!1,s.autoUpdate=!0,s.tt=0,s.rootRay=null,s.maxLevel=20,s.I=1,s.rayView=new PIXI.Graphics,s.anlgeView=new PIXI.Graphics,s.lineView=new PIXI.Graphics,s.tfView=new PIXI.Container,s.rayView.addChild(s.lineView),s.rayView.addChild(s.anlgeView),s.rayView.addChild(s.tfView),s.isPolar=!1,s.polarAngle=0,s.tfArr=[],s.lineArr=[],s}return a(e,t),s(e,[{key:"init",value:function(){var t=[];t.push({option:"addElement",target:this.rayView,params:{x:0,y:0}}),this.paramObj.moduleMain.napeEngine.grC.dispatchEvent("Start_Graphic",t,this.UID)}},{key:"removed",value:function(){this.body=null,this.space=null,this.RayUtil=null,this.NBOpticsStr=null,this.paramObj.moduleMain.napeEngine.grC.dispatchEvent("Dispose_Graphics",this.UID),this.paramObj=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(t){if(this.clearLines(),(this.autoUpdate||t)&&!this.closeLight){var e=void 0,i=void 0,n=void 0;this.parent.updateTransform(),e=this.body.localPointToWorld(y.get(this.lineStart[0],this.lineStart[1]));for(var o=this.space.shapesUnderPoint(e),r=null,a=0;a<o.get_length();a++){var s=o.at(a);if(s.get_body().userData.nolight)return;!r&&this.RayUtil.underFilter(s)&&(r=s)}i=e.sub(this.body.localPointToWorld(this.lightStartOffset)),i.set_x(i.get_x()-this.var_offsetX),i.set_y(i.get_y()-this.var_offsetY),n=new g(e,i),this.rootRay=new f["default"](n),this.rootRay.from=r,this.rootRay.level=0,this.rootRay.isPolar=this.isPolar,this.rootRay.color=this.col,this.rootRay.I=this.I,this.RayUtil.space=this.space,this.isPolar&&(this.rootRay.setPolar(this.polarAngle),this.rootRay.I=this.I),this.rayScanning(this.rootRay),this.updateRaySkin3()}}},{key:"clearLines",value:function(){for(;this.tfView.children.length;)this.tfArr.push(this.tfView.removeChildAt(0));this.lineView.clear(),this.anlgeView.clear()}},{key:"updateRaySkin3",value:function(){if(this.isVisibleLight()){var t=this.rootRay,e=[];for(this.isWhiteLight&&(this.lineView.blendMode=PIXI.BLEND_MODES.SCREEN);t;){if(t.updateEndP(),t.path){var i=t.path.length;this.lineView.lineStyle(this.lineThin,this.col,t.I);for(var n=0;i>n;n++){var o=t.path[n];0===n?this.lineView.moveTo(o.x,o.y):this.lineView.lineTo(o.x,o.y)}this.lineView.lineTo(t.endP.x,t.endP.y)}else this.isWhiteLight?this.drawWhiteLight(t):(t.inAir&&!this.globalConfig.OPEN_LIGHTALPHA?this.lineView.lineStyle(this.lineThin,this.col,.1):this.lineView.lineStyle(this.lineThin,this.col,t.I),this.lineView.moveTo(t.startP.x,t.startP.y),this.lineView.lineTo(t.endP.x,t.endP.y));this.anlgeView.lineStyle(this.lineThin,this.col,t.I),this.isWhiteLight||t.nofline||((this.globalConfig.OPEN_NORMAL||this.globalConfig.OPEN_ANGLE)&&t.showGuideLine&&this.drawNormal(t),this.globalConfig.OPEN_ANGLE&&t.showGuideLine&&this.drawAngle(t),this.globalConfig.SHOW_DIRECTION&&t.showGuideLine&&this.drawLightDirection(t)),t.fsNbRay&&e.push(t.fsNbRay),t.zsNbRay&&e.push(t.zsNbRay),t=e.pop()}}}},{key:"updateRaySkin2",value:function(){if(this.isVisibleLight())for(var t=this.rootRay,e=[];t;)t.updateEndP(),this.isWhiteLight?(this.lineView.blendMode=PIXI.BLEND_MODES.SCREEN,this.drawWhiteLight(t)):(this.lineView.lineStyle(this.lineThin,this.col,t.I),this.lineView.moveTo(t.startP.x,t.startP.y),this.lineView.lineTo(t.endP.x,t.endP.y),this.anlgeView.lineStyle(this.lineThin,this.col,t.I),this.globalConfig.OPEN_ANGLE&&this.drawAngle(t),this.globalConfig.SHOW_DIRECTION&&this.drawLightDirection(t)),t.fsNbRay&&e.push(t.fsNbRay),t.zsNbRay&&e.push(t.zsNbRay),t=e.pop()}},{key:"updateRaySkin",value:function(){this.drawRay(this.rootRay)}},{key:"drawRay",value:function(t){t&&this.isVisibleLight()&&(t.updateEndP(),this.isWhiteLight?(this.lineView.blendMode=PIXI.BLEND_MODES.SCREEN,this.drawWhiteLight(t)):(this.lineView.lineStyle(this.lineThin,this.col,t.I),this.lineView.moveTo(t.startP.x,t.startP.y),this.lineView.lineTo(t.endP.x,t.endP.y),this.anlgeView.lineStyle(this.lineThin,this.col,t.I),this.globalConfig.OPEN_ANGLE&&t.showGuideLine&&this.drawAngle(t),this.globalConfig.SHOW_DIRECTION&&t.showGuideLine&&this.drawLightDirection(t)),this.drawRay(t.fsNbRay),this.drawRay(t.zsNbRay))}},{key:"drawWhiteLight",value:function(t){var e=new l.Point(t.dir.x,t.dir.y);t.rsNbRay&&(e=t.rsNbRay.normal);var i=t.normal;i||(i=new l.Point(t.dir.x,t.dir.y));var n=t.startP,o=t.endP,r=new l.Point(-e.y,e.x),a=new l.Point(-i.y,i.x);r.normalize(.5*this.lineThin),a.normalize(.5*this.lineThin);var s=new l.Point(-t.dir.y,t.dir.x);0>this.dot(r,s)*this.dot(a,s)&&(r=new l.Point(-r.x,-r.y));var h=n.add(r),u=n.sub(r),c=o.sub(a),d=o.add(a);t.inAir&&!this.globalConfig.OPEN_LIGHTALPHA?(this.lineView.lineStyle(1,this.col,.1),this.lineView.beginFill(this.col,.1)):(this.lineView.lineStyle(1,this.col,t.I),this.lineView.beginFill(this.col,t.I)),this.lineView.moveTo(h.x,h.y),this.lineView.lineTo(u.x,u.y),this.lineView.lineTo(c.x,c.y),this.lineView.lineTo(d.x,d.y),this.lineView.endFill()}},{key:"vec2point",value:function(t){return new l.Point(t.get_x(),t.get_y())}},{key:"rayScanning",value:function(t){if(t&&t.I>=.05&&this.maxLevel>=t.level){var e=this.RayUtil.rayFindBodyResult(t,this.NBOpticsStr.filters,this.lineN);t.dis=e.get_distance();var i=t.from?t.from.get_body():null,n=e.get_shape().get_body();t.inAir=!i||i!=n;try{var o=i?i.userData.view||null:null,r=n?n.userData.view||null:null;o&&"FoldPaperboard"==o.classname&&(t.nofline=!0,t.owner=o),r&&"FoldPaperboard"==r.classname&&(t.nofline=!0,t.owner=r)}catch(l){}var a=e.get_shape(),s=this.getVo(a);if(s){var h=this.RayUtil.getViewByShape(a);h&&h.preHandleLight(t,e,s,this),this.rayReflect(t,e,s),this.rayRefraction(t,e,s),h&&h.handleLight(t,e,s,this),this.rayScanning(t.fsNbRay),this.rayScanning(t.zsNbRay)}}}},{key:"rayRefraction",value:function(t,e,i){if(i.var_canRefraction){var n=t.ray.get_direction().unit(),o=e.get_normal(),r=e.rate,a=-o.dot(n),s=Math.sqrt(1-1/(r*r)*(1-a*a)),h=t.ray.at(e.get_distance()),l=isNaN(s),u=void 0;if(l)u=v.symmetric(n,o);else{u=n.add(o.mul(a)).mul(1/r).add(o.mul(-s))}var c=this.getNewNbRay(h,u);c.level=t.level+1,c.isPolar=t.isPolar,t.normal=this.vec2point(o),f["default"].cloneI(c,t),l?(c.from=e.from,t.fsNbRay=c,c.rsNbRay=t,c.isQfs=!0):(c.from=e.to,c.I*=this.getTsI(a,s),t.zsNbRay=c,c.rsNbRay=t)}}},{key:"getNewNbRay",value:function(t,e){var i=new g(t,e);i.set_origin(i.at(this.threshold));var n=new f["default"](i);return n.color=this.col,n}},{key:"rayReflect",value:function(t,e,i){if(i.var_canReflection&&(!this.isWhiteLight||!i.var_whiteNotReflect)){var n=t.ray.get_direction().unit(),o=e.get_normal(),r=t.ray.at(e.get_distance()),a=n.sub(o.mul(2*o.dot(n))),s=this.getNewNbRay(r,a);if(s.level=t.level+1,s.from=e.from,s.isPolar=t.isPolar,t.normal=this.vec2point(o),f["default"].cloneI(s,t),i.var_canRefraction){var h=Math.acos(n.dot(o));h=h>.5*Math.PI?Math.PI-h:h;s.I*=this.getRsI(h,e.rate)}else;t.fsNbRay=s,s.rsNbRay=t}}},{key:"getVo",value:function(t){var e=t.get_userData();return e?e.vo:null}},{key:"getTsI",value:function(t,e){return 1===Math.abs(t)?1:this.getTs(Math.acos(t),Math.acos(e))}},{key:"getRsI",value:function(t,e){var i=t;if(0===i)return 0;var n=Math.sin(i)/e;return 1>Math.abs(n)?this.getRs(i,Math.asin(n)):0}},{key:"getRs",value:function(t,e){var i=Math.sin(e-t)/Math.sin(e+t),n=i*i;return i=Math.sqrt(n)}},{key:"getTs",value:function(t,e){var i=2*Math.sin(e)*Math.cos(t)/Math.sin(e+t),n=Math.sin(t)/Math.sin(e)*(Math.cos(e)/Math.cos(t))*i*i;return i=Math.sqrt(n)}},{key:"drawLightDirection",value:function(t){var e=t.startP,i=t.endP,n=t.dir,o=l.Point.distance(e,i),r=.5*o;r>300&&(r=300);var a=new l.Point(e.x+n.x*r,e.y+n.y*r),s=new l.Point(n.y,-n.x),h=new l.Point(10*(1.732*-n.x+s.x),10*(1.732*-n.y+s.y)),u=new l.Point(10*(1.732*-n.x-s.x),10*(1.732*-n.y-s.y));this.lineView.moveTo(a.x+h.x,a.y+h.y),this.lineView.lineTo(a.x,a.y),this.lineView.lineTo(a.x+u.x,a.y+u.y)}},{key:"drawNormal",value:function(t){if(t.normal){var e=t.endP,i=t.normal,n=new l.Point(120*i.x,120*i.y),o=e.add(n),r=e.sub(n);this.anlgeView.lineWidth=.5*this.lineThin,l.M.drawDashed(this.anlgeView,o,r,10,10)}}},{key:"drawAngle",value:function(t){if(t.normal){var e=t.endP,i=t.normal;this.drawAngleByVec(this.normalize(t.dir,-1),i,e,t.I),t.fsNbRay&&t.fsNbRay.I>0&&this.drawAngleByVec(t.fsNbRay.dir,i,e,t.fsNbRay.I),t.zsNbRay&&t.zsNbRay.I&&this.drawAngleByVec(t.zsNbRay.dir,this.normalize(i,-1),e,t.zsNbRay.I)}}},{key:"normalize",value:function(t,e){var i=t.clone();return i.normalize(e),i}},{key:"drawAngleByVec",value:function(t,e,i,n){var o=this.getAngle(t,e),r=t.add(e);r.normalize(50),r=r.add(i),this.drawText(r.x,r.y,o+"°",n);var a=20,s=new l.Point(i.x+t.x*a,i.y+t.y*a),h=new l.Point(i.x+e.x*a,i.y+e.y*a),u=new l.Point((t.x+e.x)*a*.8+i.x,(t.y+e.y)*a*.8+i.y);this.anlgeView.moveTo(s.x,s.y),this.anlgeView.quadraticCurveTo(u.x,u.y,h.x,h.y)}},{key:"getAngle",value:function(t,e){var i=this.dot(t,e)/(t.length*e.length),n=180*Math.acos(i)/Math.PI;return n=Math.round(n)}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"drawText",value:function(t,e,i,n){var o=this.getTf();o.style={font:"20px Arial",fill:this.col,alpha:n},o.text=i,this.tfView.addChild(o),o.x=t-o.width/2,o.y=e-o.height/2}},{key:"getTf",value:function(){var t=this.tfArr.pop();return t||(t=new PIXI.Text("",{font:"20px Arial",fill:this.col})),t}},{key:"isVisibleLight",value:function(){return!!this.globalConfig.DEBUG||this.lineN>1.508&&1.58>this.lineN}},{key:"getRectPoint",value:function(t,e,i,n){return l.M.checkJPIsInABCD(t,e,i,n)?[t,i,e,n]:l.M.checkJPIsInABCD(t,i,e,n)?[t,e,i,n]:l.M.checkJPIsInABCD(t,n,e,i)?[t,e,n,i]:[t,e,i,n]}}]),e}(c["default"]);_.OPEN_LIGHT_DIRECTION=!1,e["default"]=_},493:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(463),d=n(c),f=i(449),p=n(f),y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return y=i.phy.nape,i.currImg=new PIXI.Graphics,i.shapeline=new PIXI.Graphics,i.vo=new d["default"](!0,!0,i.rate),i.vo.var_whiteNotReflect=!0,i.var_cansetRate=!0,i.translateRect={width:255,height:255},i.concavePolygon=!1,i.alignAfterScale=!0,i.noRenderSelected=!0,i.canShowRotateDot=!1,i}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.skinCon.addChild(this.currImg),this.addChild(this.shapeline),this.bg=this.currImg,this.changeSelfSize(),this.addCbType(this.CbTypeStr.OPTICA_LGLASS),this.body.userData.isnbequ=!0,this.dragEndHandler=function(){var e=t.body.get_position();t.space.bodiesUnderPoint(e).foreach(function(i){if(i!=t.body){var n=i.userData.view;if(n&&"LaserDemonstrator"==n.classname&&0==n.selectIndex){var o=n.body.get_position();50>y.geom.Vec2.distance(e,o)&&t.body.set_position(o)}}})},this.addEventListener(p["default"].END,this.dragEndHandler)}},{key:"removed",value:function(){this.removeEventListener(p["default"].END,this.dragEndHandler),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"changeSelfSize",value:function(){var t=this.drawSkinFun();if(this.concavePolygon){var e=this.BodyUtil.createIrregularShape(t),i=e.get_length();i>0&&this.body.get_shapes().clear();for(var n=0;i>n;n++){var o=e.at(n),r=new y.shape.Polygon(o);this.body.add(r),r.get_userData().vo=this.vo,r.set_filter(this.NBOpticsStr.NO_HIT_FILTERS)}}else{var a=void 0;a=this.BodyUtil.createPolygonShape(t),a&&(this.body.get_shapes().clear(),this.body.get_shapes().add(a),a.get_userData().vo=this.vo,a.set_filter(this.NBOpticsStr.NO_HIT_FILTERS))}this.body.align(),this.parent.updateTransform(),this.edgedraw()}},{key:"drawSkinFun",value:function(t){}},{key:"scaleChangeCallBack",value:function(t){this.translateRect.width=t.bounds.width,this.translateRect.height=t.bounds.height}},{key:"setScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScale",this).call(this,t,i),this.edgedraw()}},{key:"setLocalScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setLocalScale",this).call(this,t,i),this.drawSkinFun(),this.edgedraw()}},{key:"getDragRect",value:function(){var t=this.currImg.getLocalBounds();return{x:t.x*this.skinCon.scale.x,y:t.y*this.skinCon.scale.y,width:t.width*this.skinCon.scale.x,height:t.height*this.skinCon.scale.y}}},{key:"getFillSkin",value:function(){for(var t=this.currImg,e=this.body.get_shapes(),i=e.get_length(),n=0;i>n;n++){var o=e.at(n),r=o.get_localVerts();t.lineStyle(0,0,0),t.beginFill(16777215,.5);for(var a=r.get_length(),s=0;a>s;s++){var h=r.at(s),l=h.get_x(),u=h.get_y();0==s?t.moveTo(l,u):t.lineTo(l,u)}t.endFill()}return t}},{key:"edgedraw",value:function(){this.shapeline.clear(),this.shapeline.lineStyle(3,11184810),this.currImg.clear(),this.currImg.lineStyle(1,255,0),this.currImg.beginFill(16777215,.5);var t=this.Vec2Util.getBodyEdge(this.body),e=this.currImg,i=this.shapeline;if(t.compound){this.getFillSkin();for(var n=t.list,o=0;n.length>o;o++){var r=n[o],a=r.v1,s=r.v2;a=this.body.worldPointToLocal(a),s=this.body.worldPointToLocal(s);var h={x:a.get_x(),y:a.get_y()},l={x:s.get_x(),y:s.get_y()};i.moveTo(h.x,h.y),i.lineTo(l.x,l.y)}}else for(var u=void 0,c=void 0,d=t.get_length(),f=0;d>f;f++){var p=t.at(f);p=this.body.worldPointToLocal(p),0===f?(u=p.get_x(),c=p.get_y(),e.moveTo(u,c),i.moveTo(u,c)):(e.lineTo(p.get_x(),p.get_y()),i.lineTo(p.get_x(),p.get_y())),f===d-1&&(e.lineTo(u,c),i.lineTo(u,c))}}},{key:"getData",value:function(){return h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this)}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.body.transformShapes(this.transformN),this.edgedraw()}},{key:"setSelected",value:function(t){this._selected=t,t?this.showScaleTool(!0):this.showScaleTool()}},{key:"selectRenderChild",value:function(){var t=this.body.get_bounds(),e=this.getMain().view.toGlobal({x:t.get_x(),y:t.get_y()}),i=this.getBounds();i.x=e.x,i.y=e.y;var n=this.getGlobalScale();return i.width=t.get_width()*n,i.height=t.get_height()*n,i}}]),e}(u["default"])},494:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),a=r.__createCanvas(t,i),s=a.getContext("2d"),h=PIXI.Texture.fromCanvas(a,PIXI.SCALE_MODES.DEFAULT);return r.texture=h,r.context=s,r.canvas=a,r.W=t,r.H=i,r.defaulColor="black",h.baseTexture.resolution=1,h.baseTexture.mipmap=!1,r}return r(e,t),a(e,[{key:"setFrame",value:function(t,e,i){var n=PIXI.Texture.fromFrame(e),o=new PIXI.Sprite(n),r=t.extract.canvas(o,1);i&&this.clearCanvas(),this.context.drawImage(r,0,0,r.width,r.height,0,0,this.W,this.H),this.updateTexture()}},{key:"clearCanvas",value:function(){this.context.fillStyle=this.defaulColor,this.context.fillRect(0,0,this.W,this.H)}},{key:"setImg",value:function(t,e){e&&this.clearCanvas(),this.context.drawImage(t,0,0,t.width,t.height,0,0,this.W,this.H),this.updateTexture()}},{key:"destroy",value:function(){}},{key:"updateTexture",value:function(){this.texture.update()}},{key:"__createCanvas",value:function(t,e){var i=document.createElement("div");return i.innerHTML="<canvas width='"+t+"px' height='"+e+"px' style='width:"+t+"px;height:"+e+"px;background:#cc0000;'></canvas>",i.childNodes[0]}}]),e}(PIXI.Sprite)},499:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function p(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:p(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(446),u=n(l),c=i(489),d=n(c),f=i(1);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.isMechaTool=!0,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.istoolMove=!0,this.body.userData.dragLevel=3,this.hasAddCompComplete=!0}},{key:"setScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScale",this).call(this,t,i),this.skinCon.scale.x=this.currentScale.x,this.skinCon.scale.y=this.currentScale.y}},{key:"setLocalScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setLocalScale",this).call(this,t,i),this.skinCon.scale.x=this.currentScale.x,this.skinCon.scale.y=this.currentScale.y}},{key:"getDragRect",value:function(){var t=this.bg.width*this.skinCon.scale.x,e=this.bg.height*this.skinCon.scale.y;return{x:.5*-t,y:.5*-e,width:t,height:e}}},{key:"addSelectTrigger",value:function(){this.tigid=f.M.addTouch(this,{tab:function(){this.getMain().view.selectionLayer.selectOneToReadyMove(this.parent)}},this)}},{key:"setSelected",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setSelected",this).call(this,t),t?(this.paramObj.moduleMain.napeEngine.transformManager.show(this),this.paramObj.moduleMain.napeEngine.transformManager.setRotateEnabled(!1),this.paramObj.moduleMain.napeEngine.transformManager.setScaleMode(d["default"].SCALE_UNIFORM)):this.paramObj.moduleMain.napeEngine.transformManager.hide()}}]),e}(u["default"])},500:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(499),c=n(u),d=i(454),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t,i,n){o(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=a.phy.nape,y=p.geom.Vec2,a.classname="BearingJointView",a.level=20,a.body01=i,a.body02=n,a.dirBg=new PIXI.Graphics,a.skinCon.addChild(a.dirBg),a.dirBg.visible=!1,l.M.alignPivot(a.dirBg,"center","center"),a.bg=PIXI.Sprite.fromFrame("mechSkin/bear"),a.skinCon.addChild(a.bg),l.M.alignPivot(a.bg,"center","center"),a.ismecJoint=!0,a.var_joint=null,a.var_openMotor=!1,a.istool=!0,a.var_isreverse=1,a.var_speed=15,a.var_torque=1,a.var_isBind=!1,a.owner=a,a.isFreeMec=!0,a}return a(e,t),s(e,[{key:"init",value:function(){this.radius=this.width/2,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.userData.dragLevel=3,this.body.sensorEnabled(!0),this.body.noallowRotation=!0;var t=this;this.addEventListener(f["default"].SET_BODY_STATE,function(e){t.func_setBodyStateHandler.call(t,e)}),this.body01&&this.body02&&this.fixedBodies(this.body01,this.body02)}},{key:"bodyContainsConstraint",value:function(t,e){return!!t.contains(new y(this.x,this.y))}},{key:"changeBody",value:function(t,e){if(t==this.body01)this.body01=e;else{if(t!=this.body02)return;this.body02=e}this.fixedBodies(this.body01,this.body02)}},{key:"fixedBodies",value:function(t,e){if(this.var_joint&&this.var_joint.get_space()){var i=t.worldPointToLocal(this.body.position),n=e.worldPointToLocal(this.body.position);this.var_joint.set_body1(t),this.var_joint.set_body2(e),this.var_joint.anchor1=i,this.var_joint.anchor2=n}else this.var_joint=this.JointUtil.createPivotJoint(t,e,this.body.position,this.body.position),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this;this.body01=this.var_joint.body1=t,this.body02=this.var_joint.body2=e,this.var_joint.set_active(!0)}},{key:"updateAfterMove",value:function(){var t=this.var_joint.body1,e=this.var_joint.body2,i=t.worldPointToLocal(this.body.position),n=e.worldPointToLocal(this.body.position);this.var_joint.anchor1=i,this.var_joint.anchor2=n}},{key:"fixed",value:function(){var t=new y(this.x,this.y),e=this.space.bodiesUnderPoint(t);e.filter(function(t){return!t.userData||!t.userData.isnbequ});var i=this.BodyUtil.getTopBodyFormBodyList(e,[this.body]);if(!i)return void this.removeFromFramework(this);var n=this.BodyUtil.getTopBodyFormBodyList(e,[this.body,i]);n||(n=this.getWorldBody()),this.fixedBodies(i,n)}},{key:"func_setBodyStateHandler",value:function(t){this.var_isMove=!1,t&this.BodyUtil.ALLOW_MOVE?(this.var_joint.userData.bindBody=this.body,this.fixed()):(this.var_isMove=!0,this.var_joint.userData.bindBody=null)}},{key:"func_bindVo",value:function(t){var e=void 0;if(null==t.beginBody){if(!t.endBody.isDynamic())return void this.removeFromFramework(this);e=this.getWorldBody()}else e=t.beginBody;var i=void 0;if(null==t.endBody){if(!t.beginBody.isDynamic())return void this.removeFromFramework(this);i=this.getWorldBody()}else i=t.endBody;var n=e.userData.view;if(n instanceof nb.mec.Box||n instanceof nb.mec.Circle){20>y.distance(t.beginVec2,e.position)&&(t.beginVec2=y.get(e.posx,e.posy),t.endVec2=y.get(e.posx,e.posy))}this.var_joint=t.beginBody?this.JointUtil.createPivotJoint(e,i,t.beginVec2,t.endVec2):this.JointUtil.createPivotJoint(i,e,t.endVec2,t.beginVec2),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this}},{key:"removed",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this),this.var_joint&&this.BodyUtil.destoryJoint(this.var_joint)}},{key:"func_refresh",value:function(){if(this.var_openMotor&&0!=this.var_speed&&0!=this.var_torque){var t=new y(0,this.NapeConst.NB_WORLD_GRAVITY_PER_N*this.var_torque),e=this.var_joint.anchor1.add(y.get(1e3*this.NapeConst.SCALE_SPACE,0)),i=this.var_speed/60,n=this.var_joint.body1,o=this.var_joint.body2,r=0;if(o!=this.getWorldBody()){r=o.angularVel/Math.PI/2;var a=(-i*this.var_isreverse-r)/i;Math.abs(a)>1&&(a/=Math.abs(a)),o.applyImpulse(t.mul(a),e)}r=n.angularVel/Math.PI/2,a=(i*this.var_isreverse-r)/i,Math.abs(a)>1&&(a/=Math.abs(a)),n.applyImpulse(t.mul(a),e)}}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.var_joint&&!this.var_isMove&&this.var_joint.body1){this.body.set_position(this.var_joint.body1.localPointToWorld(this.var_joint.anchor1)),this.body.rotation=this.var_joint.body1.rotation,this.BodyUtil.frezzBody(this.body),this.func_refresh()}this.dirBg.visible=this.var_openMotor,this.dirBg.scale.x=this.var_isreverse}},{key:"func_openMotorPower",value:function(t){this.var_openMotor=t.checked,this.owner&&this.owner.showToolDatas()}},{key:"func_changeSpeed",value:function(t){this.var_speed=l.M.getNumStr(t.showValue)-0}},{key:"func_changeTorque",value:function(t){this.var_torque=l.M.getNumStr(t.showValue)-0}},{key:"func_changeReverse",value:function(t){this.var_isreverse=t.checked?1:-1}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this),i=this.var_joint.body1.userData.view,n=this.var_joint.body2.userData?this.var_joint.body2.userData.view:{};return t.body1={uid:i.UID,anchorX:this.var_joint.anchor1.get_x(),anchorY:this.var_joint.anchor1.get_y()},t.body2={uid:n.UID,anchorX:this.var_joint.anchor2.get_x(),anchorY:this.var_joint.anchor2.get_y()},t.openMotor=this.var_openMotor,t.speed=this.var_speed,t.torque=this.var_torque,t.isreverse=1==this.var_isreverse,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.body.transformShapes(this.transformN),this.setScale(this.currentScale.x,this.currentScale.y);var i=void 0,n=void 0,o=void 0,r=void 0;t.body1&&(i=this.getBodyFromUid(t.body1.uid),o=i.localPointToWorld(y.get(t.body1.anchorX,t.body1.anchorY)),t.body2.uid?(n=this.getBodyFromUid(t.body2.uid),r=n.localPointToWorld(y.get(t.body2.anchorX,t.body2.anchorY))):(n=this.getWorldBody(),r=y.get(t.body2.anchorX,t.body2.anchorY)),this.var_joint||(this.var_joint=this.JointUtil.createPivotJoint(i,n,o,r),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this),1==(this.var_openMotor=t.openMotor)&&(this.func_changeSpeed({showValue:t.speed}),this.func_changeTorque({showValue:t.torque}),this.func_changeReverse({checked:t.isreverse})))}},{key:"getConf",value:function(){var t={};return this.elecLable=this.language.getLocaleStr("bearing"),t.confArr=[],this.ComponentProperty&&t.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("ratio"),!0,"",300,0,this.var_speed,1,this.func_changeSpeed,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("coefficient"),!0,"",20,0,this.var_torque,.1,this.func_changeTorque,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("reverse_roll"),1==this.var_isreverse,this.func_changeReverse,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("open_motor"),this.var_openMotor,this.func_openMotorPower,this)),t}},{key:"getTipMess",value:function(){var t='    <font class="pre-tipmess-title">'+this.elecLable+"</font>";return t+="\n    "+this.language.getLocaleStr("ratio")+": "+this.var_speed+"\n    "+this.language.getLocaleStr("coefficient")+": "+this.var_torque+"\n    "}}]),e}(c["default"])},507:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(226),h=function(t){return t&&t.__esModule?t:{"default":t}}(s);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.NapeConst=t.moduleMain.NapeConst,i.graphics=new PIXI.Graphics,i.curtLength=0,i.division="1mm",i}return r(e,t),a(e,[{key:"added",value:function(){this.addChild(this.graphics)}},{key:"changeLongBoardDivision",value:function(t){this.division=t,this.initLongBoard(this.curtLength)}},{key:"initLongBoard",value:function(t){this.curtLength=t,this.removeChildren(),this.addChild(this.graphics),this.graphics.clear(),this.graphics.lineStyle(1.3,0);var e=t*this.NapeConst.SCALE_SPACE*10,i=void 0;t*=10;var n=e/t;for(i=0;t>=i;i++){var o=i*n;if(this.graphics.moveTo(o,0),i%10==0){this.graphics.lineTo(o,8);var r=new PIXI.Text(i/10+"",{font:"12px Arial",fill:0});this.addChild(r),r.x=o-r.width/2,r.y=6}else i%5==0?"5mm"!==this.division&&"1mm"!==this.division||this.graphics.lineTo(o,6):"1mm"===this.division&&this.graphics.lineTo(o,4)}}},{key:"initRuler",value:function(t){this.curtLength=t,this.graphics.clear(),this.graphics.lineStyle(1);var e=0;for(e=0;t>=e;e++)if(this.graphics.moveTo(e*this.NapeConst.SCALE_SPACE,0),e%10==0){this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,15);var i=new PIXI.Text(e/10+"",{font:"25px Arial",fill:0});i.touchable=!1,i.x=e*this.NapeConst.SCALE_SPACE-25,i.y=10,e%50==0&&(this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,20),i.y=15),this.addChild(i)}else e%5==0?this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,10):this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,5)}},{key:"initWaterBeaker2",value:function(t,e,i){this.graphics.clear(),this.graphics.lineStyle(2);var n=0;for(n=0;t>=n;n++)if(this.graphics.moveTo(0,-n*e),n%10==0){this.graphics.lineTo(15,-n*e);var o=new PIXI.Text(n+"",{font:"25px Arial",fill:0});o.touchable=!1,o.y=-n*e-17,o.x=10,i&&(o.x=15),n%50==0&&(this.graphics.lineTo(20,-n*e),o.x=15),this.addChild(o)}else n%5==0?this.graphics.lineTo(10,-n*e):i&&this.graphics.lineTo(5,-n*e);this.graphics.moveTo(0,-n*e),this.graphics.lineTo(0,0)}},{key:"initWaterBeaker",value:function(t){this.curtLength=t,this.graphics.clear(),this.graphics.lineStyle(1);var e=void 0,i=0;for(i=0;t>=i;i++)this.graphics.moveTo(0,-i*this.NapeConst.SCALE_SPACE),i%10==0?(this.graphics.lineTo(40,-i*this.NapeConst.SCALE_SPACE),e=new PIXI.Text(Math.round(.065*(10*i+100))+"",{font:"15px Arial",fill:0}),this.addChild(e),e.x=-45,e.y=-i*this.NapeConst.SCALE_SPACE-10):i%5==0?(this.graphics.lineTo(20,-i*this.NapeConst.SCALE_SPACE),e=new PIXI.Text(Math.round(.065*(10*i+100))+"",{font:"10px Arial",fill:0}),this.addChild(e),e.x=-40,e.y=-i*this.NapeConst.SCALE_SPACE-10):this.graphics.lineTo(10,-i*this.NapeConst.SCALE_SPACE);this.graphics.moveTo(0,-(i-1)*this.NapeConst.SCALE_SPACE),this.graphics.lineTo(0,0)}},{key:"init_woodSlopesPlane",value:function(t){this.curtLength=t,this.graphics.clear(),this.graphics.lineStyle(1);var e=0;for(e=0;t>=e;e++)if(this.graphics.moveTo(e*this.NapeConst.SCALE_SPACE,0),e%10==0){this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,10);var i=new PIXI.Text(e/10+"",{font:"25px Arial",fill:0});i.touchable=!1,i.x=e*this.NapeConst.SCALE_SPACE-25,i.y=0,this.addChild(i)}else e%5==0?this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,8):this.graphics.lineTo(e*this.NapeConst.SCALE_SPACE,5)}},{key:"initMicrometerH",value:function(){this.graphics.clear(),this.graphics.lineStyle(1,0);for(var t=0,t=0;41>t;t++){var e=void 0;if(e=t%2==0?10:-5,t%20==0){e=15;var i=new PIXI.Text(5*t/10+"",{font:"15px Arial",fill:0});this.addChild(i),i.x=t*this.NapeConst.SCALE_SPACE/2-i.width/2,i.y=15,"20"==i.text&&(i.x-=3)}this.graphics.moveTo(t*this.NapeConst.SCALE_SPACE/2,0),this.graphics.lineTo(t*this.NapeConst.SCALE_SPACE/2,e)}this.graphics.moveTo(0,0),this.graphics.lineTo(t*this.NapeConst.SCALE_SPACE/2,0)}}]),e}(h["default"])},508:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(452),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0,d=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return c=t.moduleMain.phy.nape,d=c.geom.Vec2,i.touchID=-1,i.vo=null,i.selectBodyList=null,i.jointList=null,i.bodyTypeMap={},i.addList=new c.phys.BodyList,i.drawUID=null,i.startP=null,i.oldP=null,i.isstart=!1,i.isTool=!1,i}return r(e,t),a(e,[{key:"setActive",value:function(t){if(s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=h.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=h.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=h.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&h.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&h.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&h.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"moveBody",value:function(t,e){var i=this;this.oldP=e;var n=t;if((!n.userData||!n.userData.iswall)&&n){this.config.moduleMain.napeEngine.transformManager.body!==n&&this.config.moduleMain.napeEngine.transformManager.hide(),this.isstart=!0,this.selectBodyList=new c.phys.BodyList;var o=this.BodyUtil.getView(n);this.config.moduleMain.napeEngine.transformManager.body===n?"Gear"==o.classname&&this.selectBodyList.add(o.bear.body):o&&o.isMechaTool?(this.isTool=!0,o.var_isBind&&(n=o.owner.body,n.connectedBodies(-1,this.addList),this.isTool=!1)):(this.isTool=!1,this.getConnectedBodies(n,this.addList)),this.selectBodyList.merge(this.addList),this.selectBodyList.has(n)||this.selectBodyList.add(n);var r=this.func_getJointBody(!0);this.jointList=this.func_getJointBody(!1),this.selectBodyList.merge(r),this.filterCompoundBody(),this.selectBodyList.filter(function(t){return!t.isStatic()&&!(t.userData&&!t.userData.allowMove)}),this.selectBodyList.foreach(function(t){var e=i.BodyUtil.getView(t);if("Gear"==e.classname){var n=e.bear.body;i.selectBodyList.has(n)||i.selectBodyList.add(n)}}),this.saveStatus(this.selectBodyList),this.saveStatus(this.jointList)}}},{key:"saveStatus",value:function(t){for(var e=0;e<t.get_length();e++){var i=t.at(e);i.userData&&i.userData.moveCompo||(this.BodyUtil.frezzBody(i),this.setBodyStatus(i,0))}}},{key:"filterBodies",value:function(t,e){for(var i=new c.phys.BodyList,n=this.BodyUtil.getDisplayIndex(t),o=e.get_length(),r=0;o>r;r++){var a=e.at(r);n>this.BodyUtil.getDisplayIndex(a)||i.add(a)}return i}},{key:"getConnectedBodies",value:function(t,e){var i=this,n=this.BodyUtil.getDisplayIndex(t);if(-1!==n){var o=this.BodyUtil.getView(t);"Gear"==o.classname&&e.add(o.bear.body);for(var r=t.get_constraints(),a=0;a<r.get_length();a++){var s=r.at(a);s.userData&&s.userData.toolView&&"ToolSpring"==s.userData.toolView.classname||s.visitBodies(function(o){if(t!==o&&!e.has(o)&&o!==i.space){var r=i.BodyUtil.getDisplayIndex(o);-1!==r&&(n>r||(e.add(o),i.getConnectedBodies(o,e)))}})}}}},{key:"filterCompoundBody",value:function(){this.selectBodyList.filter(function(t){return!t.userData||1!=t.userData.nomoveTool})}},{key:"func_touchBegin",value:function(t){this.oldP=t;var e=this.Vec2Util.pointToVec2(t),i=this.space.bodiesUnderPoint(e),n=this.BodyUtil.getTopBodyFormBodyList(i);if(n){var o=this.globalConfig.main.view.selectionLayer.selectedObj;if(o&&n.userData){var r=n.userData.view;if(r&&o.indexOf(r)>=0)return;if(r&&r.parent&&o.indexOf(r.parent)>=0)return}}n&&n.userData&&n.userData.allowMove&&this.moveBody(n,t)}},{key:"func_touchMove",value:function(t){if(this.isstart){for(var e=this.selectBodyList.get_length(),i=0;e>i;i++){var n=this.selectBodyList.at(i),o=t.x-this.oldP.x,r=t.y-this.oldP.y;if(!Math.abs(r>1e3)){if(!n)return;if(n.userData&&n.userData.moveCompo){n.userData.view.translateMove(o,r)}else{var a=d.get(n.posx+o,n.posy+r);if(n.set_position(a),this.isTool){var s=this.space.bodiesUnderPoint(a),h=this.BodyUtil.getView(n);h&&(h.alpha=s.get_length()>1?1:.5)}}}}this.oldP=t}}},{key:"func_touchEnd",value:function(t,e){this.isstart&&(this.isstart=!1,e||(this.func_restoreBodyType(this.selectBodyList),this.func_restoreBodyType(this.jointList),this.bodyTypeMap={},this.addList.clear(),this.selectBodyList.clear()))}},{key:"func_getJointBody",value:function(t){var e=[],i=new c.phys.BodyList,n=this.space.world,o=0,r=0,a=this.selectBodyList.get_length();for(o=0;a>o;o++){var s=this.selectBodyList.at(o);if(s==n)return;var h=s.constraints,l=h.get_length();for(r=0;l>r;r++){var u=h.at(r);if(u.userData){if(t){if(!this.isTopBodyOfConstraint(s,u))continue}var d=u.userData.bindBody;d&&-1==e.indexOf(d)&&(e.push(d),i.add(d))}}}return i}},{key:"isTopBodyOfConstraint",value:function(t,e){var i=this,n=!0;if(!this.isSpringConstr(e)){var o=this.BodyUtil.getDisplayIndex(t);e.visitBodies(function(e){if(t!==e&&e!==i.space){var r=i.BodyUtil.getDisplayIndex(e);-1!==r&&(o>r||(n=!1))}})}return n}},{key:"isSpringConstr",value:function(t){return!(!t.userData||!t.userData.toolView||"ToolSpring"!=t.userData.toolView.classname)}},{key:"updateAfterMove",value:function(){for(var t=this.selectBodyList.get_length(),e=0;t>e;e++){var i=this.selectBodyList.at(e),n=i.userData.view;n&&n.updateAfterMove&&n.updateAfterMove()}}},{key:"func_restoreBodyType",value:function(t){if(null!=t){var e=void 0;for(e=0;e<t.get_length();e++){this.restoreBodyStatus(t.at(e))}}}}]),e}(u["default"])},509:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(452),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0,d=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return c=t.main.phy.nape,d=c.geom.Vec2,i.rotMc=null,i.var_bodystatus=null,i.downRota=0,i.downAng=0,i.curBody=null,i}return r(e,t),a(e,[{key:"setActive",value:function(t){if(s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=h.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=h.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=h.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&h.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&h.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&h.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.isstart=!0;var e=this.space.bodiesUnderPoint(new d(t.x,t.y));e.filter(function(t){return!!t.userData&&!!t.userData.view});var i=this.BodyUtil.getTopBodyFormBodyList(e);i&&(i.userData.cannotToolRot||this.bindStartBody(i,t))}},{key:"bindStartBody",value:function(t,e){if(this.isstart=!0,this.rotMc=t.userData.view){if(!this.rotMc.startDragRect)return void(this.rotMc=null);this.curBody=t;var i=t.get_position();this.downRota=t.get_rotation(),this.downAng=Math.atan2(e.y-i.get_y(),e.x-i.get_x()),this.var_bodystatus=this.BodyUtil.getBodyStatus(t),this.BodyUtil.frezzBody(t),this.BodyUtil.setBodyStatus(t,0),this.rotMc.startDragRect(!0,e)}}},{key:"func_touchMove",value:function(t){if(this.isstart&&this.rotMc){var e=this.curBody.get_position(),i=Math.atan2(t.y-e.get_y(),t.x-e.get_x()),n=i-this.downAng+this.downRota,o=180*n/Math.PI;o=Math.round(o),n=o*Math.PI/180,this.rotMc._rotateHandleFunc(this.rotMc,n,t),this.curBody.set_rotation(n)}}},{key:"func_touchEnd",value:function(t,e){this.isstart&&(this.isstart=!1,this.rotMc&&(this.rotMc.endDragRect(),this.BodyUtil.setBodyStatus(this.rotMc.body,this.var_bodystatus),this.rotMc=null),this.curBody=null,this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"rota"}))}}]),e}(u["default"])},510:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:d(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(471),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=void 0;e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=r.phy.nape,c=u.geom.Vec2,r.classname="Box",i&&(r._width=i[0],r._height=i[1],r.skinColor=i[2],r.verticesArr=r.getVerticesArr()),r}return r(e,t),a(e,[{key:"getVerticesArr",value:function(){var t=[],e=this._width/2,i=this._height/2;return t.push(new c(-e,-i)),t.push(new c(e,-i)),t.push(new c(e,i)),t.push(new c(-e,i)),[t]}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.width=this._width,t.height=this._height,t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.skin&&(this._width=t.width,this._height=t.height,this.verticesArr=this.getVerticesArr(),this.body.shapes.clear(),this.createShape(),this.body.align(),this.body.transformShapes(this.transformN),this.changeSkin(),t.groupName&&this.changeGroup({showValue:t.groupName}))}},{key:"getConf",value:function(){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this)}}]),e}(l["default"])},511:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:d(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(471),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=void 0;e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=r.phy.nape,c=u.geom.Vec2,r.classname="Circle",r.lineColor=11184810,r.var_arcColor=4605510,r.var_edgeColor=11184810,r.lineThin=2,i&&(r.radius=i[0],r.verticesArr=r.getVerticesArr(r.radius),r.skinColor=i[1],r.angle=i[2]),r}return r(e,t),a(e,[{key:"getVerticesArr",value:function(t){for(var e=[],i=0;360>i;i+=1){var n=Math.PI*i/180;e.push(new c(t*Math.cos(n),t*Math.sin(n)))}return[e]}},{key:"func_getLineShape",value:function(){var t=new PIXI.Graphics;return t.lineStyle(this.lineThin,this.var_edgeColor,1),t.drawCircle(0,0,this.radius),this.currentScale.x==this.currentScale.y&&(t.lineStyle(this.lineThin,this.var_edgeColor,1),t.beginFill(this.var_arcColor,.6),t.moveTo(0,0),t.arc(0,0,this.radius*this.currentScale.x,this.angle-.1,this.angle+.1),t.endFill()),t}},{key:"getEdge",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getEdge",this).call(this);return 1==this.currentScale.x&&1==this.currentScale.y&&(t.lineStyle(this.lineThin,this.var_edgeColor,1),t.beginFill(this.var_arcColor,.6),t.moveTo(0,0),t.arc(0,0,this.radius,this.angle-.1,this.angle+.1),t.endFill()),t}},{key:"getData",value:function(){var t=s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.radius=this.radius,t.angle=this.angle,t}},{key:"setData",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),t.skin&&(this.radius=t.radius,this.verticesArr=this.getVerticesArr(this.radius),this.angle=t.angle,this.body.shapes.clear(),this.createShape(),this.body.align(),this.body.transformShapes(this.transformN),this.changeSkin(),t.groupName&&this.changeGroup({showValue:t.groupName}))}},{key:"getConf",value:function(){return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConf",this).call(this)}}]),e}(l["default"])},512:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function m(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:m(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(500),c=n(u),d=i(454),f=n(d),p=i(489),y=n(p),g=i(471),v=n(g),_=void 0,b=void 0;e["default"]=function(t){function e(t,i,n,a,s){o(this,e);var h=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));_=h.phy.nape,b=_.geom.Vec2,h.elecLable="齿轮",h.classname="Gear",h.level=19,h.ismecJoint=!0,h.bg=h,h.r=i||0,h.angle=n||0,h.num=a||0,h.verticesArr=h.func_getVerticesArr(h.r,h.angle,h.num),s&&(h.skinColor=s),h.lineColor=16777215,h.var_edgeColor=11184810,h.lineThin=2,h.bear=null,h.var_isMove=!1,h.edgeArr=[];var l=2/h.getGlobalScale();return h.bearInitScale={x:l,y:l},h}return a(e,t),s(e,[{key:"init",value:function(){var t=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.userData.stopFindConnectBodies=!0;var i=this.body,n=this.func_getFixedBody();this.bear=new c["default"](this.paramObj,i,n),this.bear.x=this.x,this.bear.y=this.y,this.main.addEquipmentChild(this.bear,new l.Point(this.x,this.y)),this.bear.allowSave=!1,this.bear.var_isBind=!0,this.bear.body.userData.allowMove=!1,this.bear.owner=this,this.bear.setScale(this.bearInitScale.x*this.currentScale.x,this.bearInitScale.y*this.currentScale.y),this.addEventListener(f["default"].SET_BODY_STATE,function(e){t.func_setBodyStateHandler(e)})}},{key:"setScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScale",this).call(this,t,i),this.bear&&this.bear.setScale(this.bearInitScale.x*this.currentScale.x,this.bearInitScale.y*this.currentScale.y)}},{key:"func_getFixedBody",value:function(){var t=l.Point.vec2ToPoint(this.body.position),e=new b(t.x,t.y),i=this.space.bodiesUnderPoint(e);i.filter(function(t){return(!t.userData||!t.userData.isnbequ)&&!t.userData.view.isMechaTool});var n=this.BodyUtil.getTopBodyFormBodyList(i,[this.body]);return n||(n=this.getWorldBody()),n}},{key:"func_createInit",value:function(){var t=this.getTextureFromName(this.skinMap[this.skinName],this.func_createInit,this);t&&(this.bg=new l.GraphicsTexture(t,l.GraphicsTexture.POLYGON,{points:this.points}),this.addChildAt(this.bg,0))}},{key:"func_setBodyStateHandler",value:function(t){if(this.var_isMove=!1,t&this.BodyUtil.ALLOW_MOVE){this.bear.fixedBodies(this.body,this.func_getFixedBody()),this.var_isMove=!1}else this.var_isMove=!0}},{key:"reFixed",value:function(){if(this.main){this.bear.fixedBodies(this.body,this.func_getFixedBody())}}},{key:"func_create",value:function(){var t={};t.beginBody=this.body,t.beginVec2=this.body.position,t.endBody=this.BodyUtil.getTopBodyFormBodyList(this.napeEngine.space.bodiesUnderPoint(this.body.position),[this.body,this.bear.body]),t.endVec2=this.body.position,this.bear.func_bindVo(t)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.r=this.r,t.angle=this.angle,t.num=this.num,t.bear=this.bear.getData(),t}},{key:"setData",value:function(t){this.r=t.r,this.angle=t.angle,this.num=t.num,this.verticesArr=this.func_getVerticesArr(this.r,this.angle,this.num),t.verticesArr=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.bear.setData(t.bear)}},{key:"getConf",value:function(){var t=this.bear.getConf();return t.elecLable=this.language.getLocaleStr("gear"),t.confArr.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("custom_graphics"),!1,"",this.namelist[this.skinIndex],this.namelist,this,this.changeMatrialSkin,1,0),this.ComponentProperty.getDropMenu(this.language.getLocaleStr("grouping"),!1,"",this.groupMap[this.groupIndex],this.groupMap,this,this.changeGroup,1,0),this.ComponentProperty.getSwitch(this.language.getLocaleStr("force_analysis"),this.openF_analysis,this.changeForceAnalysis,this)),t}},{key:"func_getVerticesArr",value:function(t,e,i){var n=[];if(5>t)return n;var o=void 0;3>(o=i&&i>=3?i:this.func_getNum(t))&&(o=3);var r=5*o,a=18;o>6||(a=11+o);var s=r+a,h=[{f:1/8,rad:r},{f:.4,rad:s},{f:.6,rad:s},{f:7/8,rad:r}],l=[];this.edgeArr=[],n.push(l);for(var u=0;o>u;u++){var c=2*Math.PI/o,d=e+c*u,f=new b(Math.cos(d)*r,Math.sin(d)*r);l.push(f),this.edgeArr.push(f);for(var p=[],y=0;h.length>y;y++){var g=d+c*h[y].f,v=h[y].rad,_=new b(Math.cos(g)*v,Math.sin(g)*v);p.push(_),this.edgeArr.push(_)}n.push(p)}return n}},{key:"func_getNum",value:function(t){return Math.ceil((t-5)/5)+2}},{key:"getEdge",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getEdge",this).call(this);t.lineStyle(this.lineThin,this.lineColor,1);for(var i=0;this.edgeArr.length>i;i++){var n=this.edgeArr[i];0===i?t.moveTo(n.get_x()*this.currentScale.x,n.get_y()*this.currentScale.y):t.lineTo(n.get_x()*this.currentScale.x,n.get_y()*this.currentScale.y)}return t}},{key:"selfShowSelect",value:function(){this.paramObj.moduleMain.napeEngine.transformManager.show(this),this.paramObj.moduleMain.napeEngine.transformManager.setRotateEnabled(!1),this.paramObj.moduleMain.napeEngine.transformManager.setScaleMode(y["default"].SCALE_UNIFORM)}},{key:"getTipMess",value:function(){var t='    <font class="pre-tipmess-title">'+this.elecLable+"</font>";return t+="\n    "+this.language.getLocaleStr("ratio")+": "+this.bear.var_speed+"\n    "+this.language.getLocaleStr("coefficient")+": "+this.bear.var_torque+"\n    "}}]),e}(v["default"])},514:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function P(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:P(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(550),c=n(u),d=i(454),f=n(d),p=i(446),y=n(p),g=i(226),v=n(g),_=void 0,b=void 0,m=void 0,w=void 0,O=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return _=i.phy.nape,b=_.geom.Vec2,i.JointUtil=t.moduleMain.JointUtil,i.BodyUtil=t.moduleMain.BodyUtil,m=_.dynamics.InteractionGroup,w=_.phys.Material,O=_.phys.Compound,i.cateid=5,i.classname="RopeView",i.elecLable="绳子",i.bg=i,i.compound=new O,i.level=20,i.onelen=45,i.trueLen=50,i.firstBox=null,i.firstJoint=null,i.firstBody=null,i.secBox=null,i.secJoint=null,i.secBody=null,i.spring=null,i.spring_view=null,i.flagP=null,i.nodeCon=[],i.last=null,i.ismecJoint=!0,i.isMechanics=!0,i.fromEquTools=!1,i.ropeGroup=new m(!0),i.noRenderSelected=!0,i}return a(e,t),s(e,[{key:"added",value:function(){this.hasAddCompComplete=!0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"added",this).call(this)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);if(!this.firstBox||!this.secBox)return t;t.thisX=this.x,t.thisY=this.y,t.uid=this.UID,t.ismecJoint=this.ismecJoint,t.fromEquTools=this.fromEquTools,t.firstBox={x:this.firstBox.body.posx,y:this.firstBox.body.posy},t.secBox={x:this.secBox.body.posx,y:this.secBox.body.posy},t.b1={uid:(this.firstBody.userData?this.firstBody.userData.view:{}).UID},t.b2={uid:(this.secBody.userData?this.secBody.userData.view:{}).UID},t.nodes=[];var i=0;for(i=0;this.nodeCon.length>i;i++){t.nodes.push(this.nodeCon[i].getData())}return t}},{key:"setData",value:function(t){var i=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t);var n=new c["default"](this.paramObj),o=void 0,r=void 0;o=n.getBodyFromUid(t.b1.uid),this.fixFirstBox(o,b.get(t.firstBox.x,t.firstBox.y));var a=t.nodes,s=void 0;for(s=0;a.length>s;s++){var l=new x(this.paramObj,this.trueLen);l.var_gap=(this.trueLen-this.onelen)/2,this.addChild(l),l.init(),l.resetUserView(l,this,!0),l.body.setGroup(this.ropeGroup),l.setData(a[s]),this.nodeCon.push(l);var u=void 0,d=void 0;this.last.getrightVec2?u=this.last.getrightVec2():(this.firstBox.node=l.body,u=this.last.body.position),d=l.getleftVec2(),this.JointUtil.createPivotJoint(this.last.body,l.body,u,d),this.last=l}r=n.getBodyFromUid(t.b2.uid),r?r.setGroup(this.ropeGroup):r=n.getWorldBody(),this.secBox=new c["default"](this.paramObj),this.addChild(this.secBox),this.secBox.init(),this.secBox.addBodyToSpace(this.secBox.body,this),this.secBox.addEventListener(f["default"].SET_BODY_STATE,function(t){i.setBodyStateHandler(t,i.secBox)}),this.secBody=r;var p=b.get(t.secBox.x,t.secBox.y);this.secBox.body.set_position(p),this.secJoint=this.JointUtil.createWeldJoint(this.secBox.body,r,p,p),this.secJoint.userData.toolView=this;var y=this.last.getrightVec2();this.secBox.node=this.last.body,this.JointUtil.createPivotJoint(this.last.body,this.secBox.body,y,y)}},{key:"bodyContainsConstraint",value:function(t,e){return!!t.contains(this.firstBody.localPointToWorld(this.firstJoint.anchor2))||!!t.contains(this.secBody.localPointToWorld(this.secJoint.anchor2))}},{key:"changeBody",value:function(t,e){t==this.firstBody?(this.__changeJointSecondBody(this.firstJoint,t,e),this.firstBody=e):t==this.secBody&&(this.__changeJointSecondBody(this.secJoint,t,e),this.secBody=e)}},{key:"__changeJointSecondBody",value:function(t,e,i){var n=e.localPointToWorld(this.firstJoint.anchor2),o=i.worldPointToLocal(n),r=t.get_body1().rotation-i.rotation;t.anchor2=o,t.set_body2(i),t.set_phase(r)}},{key:"bodyChanged",value:function(t){this.firstBody===t?t.contains(b.weak(this.firstBox.x,this.firstBox.y))||(this.firstBody=this.getWorld()):this.secBody===t&&(t.contains(b.weak(this.secBox.x,this.secBox.y))||(this.secBody=this.getWorld()))}},{key:"getWorld",value:function(){return this.firstBox.getWorldBody()}},{key:"checkRemove",value:function(){this.firstBody===this.getWorld()&&this.secBody===this.getWorld()&&setTimeout(this.removeFromFramework.bind(this),0,this)}},{key:"fixFirstBox",value:function(t,e){var i=this;this.flagP=l.Point.vec2ToPoint(e),this.firstBox=new c["default"](this.paramObj),this.addChild(this.firstBox),this.firstBox.init(),this.firstBox.addBodyToSpace(this.firstBox.body,this),this.firstBox.body.set_position(e),this.compound.set_space(this.firstBox.body.get_space()),this.firstBox.body.set_compound(this.compound),null==t?t=this.firstBox.getWorldBody():t.setGroup(this.ropeGroup),this.last=this.firstBox,this.firstBody=t,this.firstJoint=this.JointUtil.createWeldJoint(this.firstBox.body,this.firstBody,e,e),this.firstJoint.userData.toolView=this,this.firstBox.addEventListener(f["default"].SET_BODY_STATE,function(t){i.setBodyStateHandler(t,i.firstBox)})}},{key:"drawRope",value:function(t){var e=l.Point.distance(this.flagP,t);if(e>this.onelen){this.createNode(e/Math.floor(this.onelen),t)}}},{key:"createNode",value:function(t,e,i){var n=0,o=Math.atan2(e.y-this.flagP.y,e.x-this.flagP.x);for(n=0;t>n;n++){var r=this.onelen*Math.cos(o),a=this.onelen*Math.sin(o),s=new x(this.paramObj,this.trueLen);s.var_gap=(this.trueLen-this.onelen)/2,this.addChildAt(s,0),s.init(),s.resetUserView(s,this,!0),s.body.set_position(b.get(this.flagP.x+r/2,this.flagP.y+a/2)),s.body.rotation=o,s.body.setGroup(this.ropeGroup),s.body.set_compound(this.compound),this.flagP.x+=r,this.flagP.y+=a,this.nodeCon.push(s);var h=void 0,l=void 0;this.last.getrightVec2?h=this.last.getrightVec2():(this.firstBox.node=s.body,h=this.last.body.position),l=s.getleftVec2();this.JointUtil.createPivotJoint(this.last.body,s.body,h,l).set_compound(this.compound),this.last=s,this.BodyUtil.setBodyStatus(s.body,0),s.body.sensorEnabled(!0),i&&(h=s.getrightVec2(),l=b.get(this.flagP.x,this.flagP.y),this.secBox.node=s.body,this.secBox.body.set_position(l),this.JointUtil.createPivotJoint(s.body,this.secBox.body,h,l))}}},{key:"ropeNodeSensor",value:function(t){var e=0;for(e=0;this.nodeCon.length>e;e++)this.nodeCon[e].body.sensorEnabled(t)}},{key:"setBodyStateHandler",value:function(t,e){if(t&this.BodyUtil.ALLOW_MOVE){var i=e.napeEngine.space.bodiesUnderPoint(e.body.position);i.filter(function(t){return!t.userData||!t.userData.isnbequ});var n=this.BodyUtil.getTopBodyFormBodyList(i,[e.body,e.node]),o=void 0;n?(o=n.worldPointToLocal(e.body.position),n.setGroup(this.ropeGroup)):(n=e.getWorldBody(),o=e.body.position),e==this.firstBox?(this.firstBody!=n&&(this.firstBody!=this.secBox.getWorldBody()&&this.firstBody.setGroup(null),this.firstBody=n),this.firstJoint.anchor2=o,this.firstJoint.set_body2(n)):(this.secBody!=n&&(this.secBody!=this.secBox.getWorldBody()&&this.secBody.setGroup(null),this.secBody=n),this.secJoint.anchor2=o,this.secJoint.set_body2(n)),this.secJoint.active=!0,this.firstJoint.active=!0,this.ropeNodeSensor(!1)}else e==this.firstBox?this.firstJoint.active=!1:this.secJoint.active=!1,this.ropeNodeSensor(!0)}},{key:"ropeCreateComplete",value:function(t,e){var i=this;this.secBox=new c["default"](this.paramObj),this.addChild(this.secBox),this.secBox.init(),this.secBox.addBodyToSpace(this.secBox.body,this),this.secBox.body.set_compound(this.compound),this.secBox.addEventListener(f["default"].SET_BODY_STATE,function(t){i.setBodyStateHandler(t,i.secBox)}),this.createNode(1,l.Point.vec2ToPoint(e),!0),null==t?t=this.secBox.getWorldBody():t.setGroup(this.ropeGroup),this.secBody=t,this.secJoint=this.JointUtil.createWeldJoint(this.secBox.body,t,e,e),this.secJoint.userData.toolView=this;var n=0;for(n=0;this.nodeCon.length>n;n++)this.BodyUtil.setBodyStatus(this.nodeCon[n].body,3);this.addChild(this.firstBox),this.ropeNodeSensor(!1)}},{key:"removed",value:function(){this.firstJoint.userData.toolView=null,this.secJoint&&(this.secJoint.userData.toolView=null),this.compound&&this.compound.breakApart();var t=0;for(t=0;this.nodeCon.length>t;t++)this.nodeCon[t].removed();this.firstBox.removed(),this.firstBox=null,this.firstJoint=null,this.firstBody=null,this.secBox&&(this.secBox.removed(),this.secBox=null,this.secJoint=null,this.secBody=null),this.bg=null,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}}]),e}(v["default"]);var x=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.material=new w(0,.1,.2,10,.02),n.gap=2,n.bg=PIXI.Sprite.fromFrame("mechSkin/rope"),n.addChild(n.bg),l.M.alignPivot(n.bg,"center","center"),n.sw=i||50,n.sh=n.sw/n.bg.width*n.bg.height,n.bg.width=n.sw,n.bg.height=n.sh,n}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.sw,this._height=this.sh,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.userData.classType="ropeNode"}},{key:"getleftVec2",value:function(){return this.body.localPointToWorld(b.weak(-this.sw/2+this.gap,0))}},{key:"getrightVec2",value:function(){return this.body.localPointToWorld(b.weak(this.sw/2-this.gap,0))}}]),e}(y["default"])},515:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(608),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.leftV=null,i.rightV=null,i.qianBanArr=[],i.qianArr=[],i.banIndex=0,i.qianIndex=0,i.p4Arr=[new h.Point(0,0),new h.Point(0,0),new h.Point(0,0),new h.Point],i.con=new PIXI.Container,i.addChild(i.con),i.var_g_=new PIXI.Graphics,i.addChild(i.var_g_),i.ss=new PIXI.Graphics,i.addChild(i.ss),i.selected=!1,i}return r(e,t),a(e,[{key:"overrideFunc",value:function(){this.removeChild(this.var_line),this.var_line=null}},{key:"removed",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"update",value:function(){if(this.parent&&this.joint){var t=this.getMain(),e=h.Point.vec2ToPoint(this.joint.body1.localPointToWorld(this.joint.anchor1)),i=h.Point.vec2ToPoint(this.joint.body2.localPointToWorld(this.joint.anchor2));e=this.toLocal(e,t.view),i=this.toLocal(i,t.view),this.drawSJ(e,i)}}},{key:"drawSJ",value:function(t,e){if(0!=this.count){this.banIndex=0,this.qianIndex=0;var i=new h.Point(t.x,t.y),n=new h.Point(e.x,e.y);this.leftV=i.clone(),this.rightV=n.clone();var o=h.M.getPointLen(i,n),r=o/this.count,a=[],s=void 0;s=56>r?Math.sqrt(h.M.sq(28)-h.M.sq(r/2)):0;var l=h.M.getXianDuanGaoXianDian(i,n,s,!0),u=h.M.getXianDuanGaoXianDian(i,n,s,!1),c=h.M.getXianDuanGaoXianDian(n,i,s,!0),d=h.M.getXianDuanGaoXianDian(n,i,s,!1);this.p4Arr[0]=new h.Point(l.x,l.y),this.p4Arr[1]=new h.Point(u.x,u.y),this.p4Arr[2]=new h.Point(c.x,c.y),this.p4Arr[3]=new h.Point(d.x,d.y);var f=void 0;for(f=0;this.count>=f;f++){var p=h.M.getXianDianByDis(r*f-r/2,!0,i,n);a.push(h.M.getXianDuanGaoXianDian(p,i,s-6,f%2!=0))}if(this.var_g_.clear(),26>s){var y=0;for(y=15>s?.8:.8*(1-(s-15)/11),this.var_g_.lineStyle(10,16711680,y),this.var_g_.moveTo(i.x,i.y),v=1;a.length>v;v++){var g=a[v];this.var_g_.lineTo(g.x,g.y)}this.var_g_.lineTo(n.x,n.y)}this.var_g_.lineStyle(2,16777215,this.selected?.3:0),this.var_g_.beginFill(16777215,0),this.var_g_.moveTo(l.x,l.y),this.var_g_.lineTo(u.x,u.y),this.var_g_.lineTo(c.x,c.y),this.var_g_.lineTo(d.x,d.y),this.var_g_.endFill();var v=void 0,_=void 0,b=void 0;for(v=2;a.length-1>v;v+=2)_=a[v],b=a[v+1],this.add_quadBatch_data("qian",b,_);for(this.add_quadBatch_data("qianban",i,a[1]),this.add_quadBatch_data("qianban",n,a[a.length-1]),v=1;a.length-1>v;v+=2){for(_=a[v],b=a[v+1],this.add_quadBatch_data("qian",b,_),this.ss.clear(),this.ss.beginFill(16711697,0),this.ss.drawRect(-25,20,50,e.y-40),this.ss.endFill(),f=this.qianIndex;this.qianBanArr.length>f;f++)this.qianBanArr[f].parent&&this.con.removeChild(this.qianBanArr[f]);for(f=this.banIndex;this.qianArr.length>f;f++)this.qianArr[f].parent&&this.con.removeChild(this.qianArr[f])}}}},{key:"add_quadBatch_data",value:function(t,e,i){var n=void 0;"qianban"==t?this.qianBanArr.length>this.qianIndex?(n=this.qianBanArr[this.qianIndex],this.qianIndex++):(n=PIXI.Sprite.fromFrame("mechSkin/"+t),this.qianBanArr.push(n)):"qian"==t&&(this.qianArr.length>this.banIndex?(n=this.qianArr[this.banIndex],this.banIndex++):(n=PIXI.Sprite.fromFrame("mechSkin/"+t),this.qianArr.push(n))),n.pivot.x=n.width/2,n.pivot.y=n.height/2,n.x=(e.x+i.x)/2,n.y=(e.y+i.y)/2;var o=h.M.getAngleP(i,e)-90;n.rotation=h.M.toHu(o),this.con.addChild(n)}}]),e}(u["default"])},516:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1),a=void 0,s=void 0,h=void 0,l=void 0;e["default"]=function(){function t(e){n(this,t),a=e.geom.AABB,s=e.geom.Vec2,h=e.geom.Vec2List,l=e.shape.EdgeList}return o(t,[{key:"angle",value:function(t,e){var i=t.get_length(),n=e.get_length(),o=t.cross(e),r=o/(i*n);return Math.acos(r)}},{key:"vec3ToVec2",value:function(t){return t&&t.get_x&&t.get_y?s.get(t.get_x(),t.get_y()):s.get(0,0)}},{key:"vec2ToPoint",value:function(t){return t&&t.get_x&&t.get_y?new r.Point(t.get_x(),t.get_y()):new r.Point(0,0)}},{key:"pointToVec2",value:function(t){return new s(t.x,t.y)}},{key:"getAABBFromVec",value:function(t,e){var i=new a(Math.min(t.get_x(),e.get_x()),Math.min(t.get_y(),e.get_y()),Math.abs(t.get_x()-e.get_x()),Math.abs(t.get_y()-e.get_y()));return 0==i.zpp_inner.width()&&(i.zpp_inner.minx=1,i.zpp_inner.validate()),0==i.zpp_inner.height()&&(i.zpp_inner.miny=1,i.zpp_inner.validate()),i}},{key:"getWorldVec2ListFromCircle",value:function(t,e){var i=6/180*Math.PI,n=t.get_radius();20>n&&(i=30/180*Math.PI);for(var o=[],r=e.get_x?e.get_x():e.x,a=e.get_y?e.get_y():e.y,l=0;l<=2*Math.PI;l+=i)o.push(s.get(r+Math.cos(l)*n,a+Math.sin(l)*n));return h.fromArray(o)}},{key:"getPointsFromGeomPoly",value:function(t,e,i){var n=t.zpp_inner.vertices;e||(e=0),i||(i=0);for(var o=n,r=[];n;)r.push({x:n.x-e,y:n.y-i}),n=n.next==o?null:n.next;return r}},{key:"getBodyEdge",value:function(t){var e=t.get_shapes();if(1!=e.get_length()){var i=(new l,[]);return e.foreach(function(t){t.get_edges().foreach(function(t){var e=t.get_worldVertex1(),n=t.get_worldVertex2(),o=void 0,r=!1;for(o=0;i.length>o;o++){var a=i[o],s=a.v1.get_x()==e.get_x()&&a.v1.get_y()==e.get_y()&&a.v2.get_x()==n.get_x()&&a.v2.get_y()==n.get_y(),h=a.v1.get_x()==n.get_x()&&a.v1.get_y()==n.get_y()&&a.v2.get_x()==e.get_x()&&a.v2.get_y()==e.get_y();if(s||h){i.splice(o,1),r=!0;break}}r||i.push({v1:e,v2:n})})}),{compound:!0,list:i}}var n=e.at(0);return n.isPolygon()?n.get_worldVerts():n.isCircle()?{radius:n.get_radius(),pos:n.get_worldCOM()}:void 0}},{key:"vec2ArrArrToPointArrArr",value:function(t){for(var e=t.length,i=[],n=0;e>n;n++){i.push(this.vec2ArrToPointArr(t[n]))}return i}},{key:"vec2ArrToPointArr",value:function(t){for(var e=[],i=t.length,n=0;i>n;n++){e.push(this.vec2ToPoint(t[n]))}return e}},{key:"pointArrArrToVec2ArrArr",value:function(t){for(var e=t.length,i=[],n=0;e>n;n++){i.push(this.pointArrToVec2Arr(t[n]))}return i}},{key:"pointArrToVec2Arr",value:function(t){for(var e=[],i=t.length,n=0;i>n;n++){e.push(this.pointToVec2(t[n]))}return e}}]),t}()},517:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(){function t(){n(this,t)}return o(t,null,[{key:"getArr",value:function(t){for(var e=[],i=t.length,n=0,o=0;i>o;o+=4){e[n]=.299*t[o]+.587*t[o+1]+.114*t[o+2],n++}return e}},{key:"getArr2",value:function(e){for(var i=[],n=e.length,o=0,r=0;n>r;r+=4){i[o]=255*t.rgb2hsv(e[r],e[r+1],e[r+2]).v,o++}return i}},{key:"abs",value:function(t,e,i){for(var n=[],o=0;i>o;o++){var r=t[o],a=e[o];n[o]=Math.sqrt(r*r+a*a)}return n}},{key:"center",value:function(t,e,i){for(var n=[],o=e>>1,r=i>>1,a=0;e>a;a++)for(var s=0;i>s;s++){var h=a,l=s;h=o>a?a+o:a-o,l=r>s?s+r:s-r,n[a*e+s]=t[h*e+l]}return n}},{key:"setArr",value:function(t,e,i){for(var n=0;i>n;n++)t[n]=e[n]}},{key:"setArr1",value:function(t,e,i){for(var n=0,o=0;i>o;o+=4){var r=e[n];t[o]=r,t[o+1]=r,t[o+2]=r,t[o+3]=255,n++}}},{key:"setArr2",value:function(e,i,n,o){for(var r=0,a=t.getRGB(o),s=t.rgb2hsv(a.r,a.g,a.b),h=0;n>h;h+=4){var l=i[r];s.v=Math.min(l/255,1);var u=t.hsv2rgb(s.h,s.s,s.v);e[h]=u.r,e[h+1]=u.g,e[h+2]=u.b,e[h+3]=255,r++}}},{key:"setArr3",value:function(t,e){for(var i=t.length,n=0,o=0;i>o;o+=4){var r=e[n];t[o]=r>>16&255,t[o+1]=r>>8&255,t[o+2]=255&r,t[o+3]=255,n++}}},{key:"scale",value:function(t,e,i,n){for(var o=e/2<<0,r=i/2<<0,a=[],s=0;e>s;s++)for(var h=0;i>h;h++){var l=(s-o)/n+o,u=(h-r)/n+r;l=Math.floor(l),u=Math.floor(u),a[s*e+h]=e>l&&i>u?t[l*e+u]:0}return a}},{key:"color",value:function(e,i,n){for(var o=[],r=0,a=t.getRGB(n),s=t.rgb2hsv(a.r,a.g,a.b),h=0;i>h;h+=4){var l=e[r];s.v=Math.min(l/255,1);var u=t.hsv2rgb(s.h,s.s,s.v);o[h]=u.r,o[h+1]=u.g,o[h+2]=u.b,o[h+3]=255,r++}return o}},{key:"blend",value:function(t,e,i){for(var n=0;i>n;n++){t[n]=t[n]+e[n]}}},{key:"rgb2color",value:function(t,e,i){return t>255&&(t=255),e>255&&(e=255),i>255&&(i=255),0>t&&(t=0),0>e&&(e=0),0>i&&(i=0),t&=255,e&=255,i&=255,t<<16|e<<8|i}},{key:"getRGB",value:function(t){return{r:t>>16&255,g:t>>8&255,b:255&t}}},{key:"getData0",value:function(t,e){for(var i=t*e,n=[],o=0;i>o;o++)n[o]=0;return n}},{key:"rgb2hsv",value:function(t,e,i){var n=void 0,o=void 0,r=void 0,a=Math.max(t,e,i),s=Math.min(t,e,i);return t==a&&(n=(e-i)/(a-s)),e==a&&(n=2+(i-t)/(a-s)),i==a&&(n=4+(t-e)/(a-s)),n*=60,0>n&&(n+=360),r=Math.max(t,e,i)/255,o=(a-s)/a,{h:n,s:o,v:r}}},{key:"hsv2rgb",value:function(t,e,i){var n=void 0,o=void 0,r=void 0;if(0==e)n=o=r=255*i<<0;else{t/=60;var a=t<<0,s=t-a,h=i*(1-e),l=i*(1-e*s),u=i*(1-e*(1-s));switch(a){case 0:n=i,o=u,r=h;break;case 1:n=l,o=i,r=h;break;case 2:n=h,o=i,r=u;break;case 3:n=h,o=l,r=i;break;case 4:n=u,o=h,r=i;break;case 5:n=i,o=h,r=l}n=255*n<<0,o=255*o<<0,r=255*r<<0}return{r:n,g:o,b:r}}},{key:"convV",value:function(t,e,i,n){for(var o=[],r=Math.floor(n/2),a=0;e>a;a++)for(var s=0;i>s;s++){for(var h=0,l=0,u=0;n>u;u++){var c=a+u-r;if(c>=0&&e>c){var d=c*e+s;h+=t[d],l++}}o[a*e+s]=h/l}return o}},{key:"fftshift",value:function(t,e,i){for(var n=[],o=[],r=t.re,a=t.im,s=e>>1,h=i>>1,l=0;e>l;l++)for(var u=0;i>u;u++){var c=l,d=u;c=s>l?l+s:l-s,d=h>u?u+h:u-h;var f=l*e+u,p=c*e+d;n[f]=r[p],o[f]=a[p]}return{re:n,im:o}}},{key:"setColor",value:function(t,e,i){var n=4*e;t.data[n]=i,t.data[n+1]=i,t.data[n+2]=i,t.data[n+3]=255}},{key:"complexMul",value:function(t,e,i){for(var n=[],o=[],r=t.re,a=t.im,s=e.re,h=e.im,l=0;i>l;l++){var t=r[l],e=a[l],u=s[l],c=h[l];n[l]=t*u-e*c,o[l]=t*c+e*u}return{re:n,im:o}}},{key:"complexMul0",value:function(t,e,i){for(var n=[],o=[],r=t.re,a=t.im,s=e.re,h=e.im,l=0;i>l;l++){var t=r[l],u=a[l];n[l]=t*s-u*h,o[l]=t*h+u*s}return{re:n,im:o}}},{key:"mul",value:function(t,e,i){for(var n=[],o=0;i>o;o++){n[o]=t[o]*e}return n}},{key:"maxData",value:function(t,e){for(var i=-Infinity,n=0;e>n;n++){var o=t[n];o>i&&(i=o)}return i}}]),t}()},539:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(){n(this,t)}return o(t,null,[{key:"injectionClass",value:function(e){t.nape=e.phy.nape,t.MouseManager=e.MouseManager,t.NBCommand=e.NBCommand,t.MechanicsPopTool=e.MechanicsPopTool}}]),t}();r.napeEngine=null,e["default"]=r},540:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0,e["default"]=function o(t){n(this,o);var e=t.callbacks.CbType;this.CEIL_HOOK=new e,this.PLASTICPLATE_HOOK=new e,this.HOOK_TOP_GOU=new e,this.HOOK_BOTTOM_GOU=new e,this.SPRING_HOCK=new e,this.FIXED_PULLEY_UP_HOCK=new e,this.FIXED_PULLEY_BOTTOM_HOCK=new e,this.FIXED_PULLEY_LEFT_HOCK=new e,this.FIXED_PULLEY_RIGHT_HOCK=new e,this.SUBMARINE=new e,this.WATER_BEAKER=new e,this.LEVER_HOOK_GOU=new e,this.LITTLE_PAIL=new e,this.OVERFLOW_CUP=new e,this.HOOKWOOD_HOCK=new e,this.FIXED_PULLEY_HOCK=new e,this.PULL_LA_HOCK=new e,this.PULL_WU_HOCK=new e,this.PARALL_R_HOCK=new e,this.SPRINGSPRING_HOCK=new e,this.H_PAPER_TICKER=new e,this.V_PAPER_HOCK=new e,this.TICKER_CARBON=new e,this.PULLEY_BOARD_HOCK=new e,this.PULLEY_TICK_CAR=new e,this.ALUMINUM_BLOCK=new e,this.NB_CAR=new e,this.PULL_LONG_BOARD=new e,this.PULL_LONG_DANG=new e,this.BOARD_CAR=new e,this.LONG_BOARD_TM=new e,this.GALLOON_HOCK=new e,this.STONE_HOCK=new e,this.WAX_BLOCK_HOCK=new e,this.SPRING_HEAD_HOCK=new e,this.LEVER_DIAO_HOCK=new e,this.OPTICA_LGLASS=new e,this.ONEPART_GLASS=new e,this.LASER_DEMONSTRATOR=new e,this.FLUIDBASE=new e,this.GLOBAL_WALL=new e,this.PERISCOPE=new e,this.AIR_TRACK=new e,this.AIR_SLIDEBLOCK=new e,this.AIR_SLIDEBLOCK_HOCK=new e,this.AIR_SLIDEBLOCK_LEFT_HOCK=new e,this.AIR_SLIDEBLOCK_SHADE=new e,this.POUR_POS_SHAPE=new e,this.LIQUID_SHAPE=new e,this.CONTAINER_BOTTOM=new e,this.BALANCE_PAN=new e,this.SHELTER_LIGHT=new e,this.LITTLEPAIL_HPCK=new e,this.SENSOR_CAR=new e,this.SENSOR_BOARD_DANG=new e,this.ALL_HOOK_ARY=[this.SPRING_HOCK,this.HOOK_TOP_GOU,this.CEIL_HOOK,this.SPRINGSPRING_HOCK],this.SENSOR_ALL=[this.HOOK_TOP_GOU]}},541:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function b(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:b(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(451),c=n(u),d=i(474),f=n(d),p=i(463),y=n(p),g=i(492),v=n(g),_=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.useDragSetCurElec=!0,i.skinType=1,i.lineColor=11184810,i.lineThin=2,i.skinColor=i.randomColor(),i.skinIndex=0,i.namelist=[i.language.getLocaleStr("default"),i.language.getLocaleStr("mat_aluminum"),i.language.getLocaleStr("wood"),i.language.getLocaleStr("glass"),i.language.getLocaleStr("ice_block")],i.originlist=["默认","铝","木材","玻璃","冰块"],i.skinName=i.originlist[i.skinIndex],i.skinProto={"默认":[1.5,.7,.4],"铝":[2.7,.7,.4],"大理石":[3.6,.5,.3],"木材":[.5,.4,.2],"玻璃":[2.5,.2,.5],"冰块":[.9,.1,.1]},i.isFreeMec=!0,i.selectEdge=!1,i.skinP=new l.Point(0,0),i.vo=new y["default"](!0,!0,1.5),i.lightprototype=!1,i.groupIndex=0,i.groupMap=[i.language.getLocaleStr("default"),"A","B","C","D"],i.meltFlag=!1,i.inWater=!1,i.edgeLine=null,i}return a(e,t),s(e,[{key:"removed",value:function(){this.cacheLine(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.userData.freeMec=!0,this.componentBox.visible=!1,this.body.align(),this.changeSkin(),this.openAngleFunc(this.globalConfig.OPEN_ANGLE),this.showDirectionFunc(this.globalConfig.SHOW_DIRECTION),this.showReflectFunc(this.globalConfig.SHOW_REFLECT),this.body.userData.dragLevel=3,this.hasAddCompComplete=!0}},{key:"getDragRect",value:function(){var t=this.bg.getLocalBounds();return{x:t.x*this.skinCon.scale.x,y:t.y*this.skinCon.scale.y,width:t.width*this.skinCon.scale.x,height:t.height*this.skinCon.scale.y}}},{key:"confType",value:function(t,i){e.OPEN_ANGLE==t?this.openAngleFunc(i):e.SHOW_REFLECT==t?this.showReflectFunc(i):e.SHOW_DIRECTION==t&&(this.showDirectionFunc(i),v["default"].OPEN_LIGHT_DIRECTION=i)}},{key:"openAngleFunc",value:function(t){this.vo&&(this.vo.var_open_angle=t)}},{key:"showReflectFunc",value:function(t){this.vo&&this.vo.var_canRefraction&&(this.vo.var_canReflection=t?this.vo.var_copyReflection:t)}},{key:"showDirectionFunc",value:function(t){this.vo&&(this.vo.var_show_direction=t)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.freeMechanics=!0,t.analysis=this.openF_analysis,t.skinIndex=this.skinIndex,t.skinType=this.skinType,t.skinColor=this.skinColor,t.lightprototype=this.lightprototype,t.rateN=this.vo.n,t.groupIndex=this.groupIndex,t.meltFlag=this.meltFlag,t}},{key:"setData",value:function(t){var i=this;this.disposeEdge(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.skinIndex=t.skinIndex||0,this.skinName=this.originlist[this.skinIndex],this.skinType=t.skinType||1,this.skinColor=t.skinColor||this.randomColor(),this.groupIndex=t.groupIndex||0,this.changeGroup({showValue:this.groupMap[this.groupIndex]}),t.analysis&&1==t.analysis&&this.changeForceAnalysis({checked:!0}),t.lightprototype&&setTimeout(function(){i.hadDestory||(i.vo.n=t.rateN,i.lightprototype=t.lightprototype,i.gotoOpticsMc())},10),this.meltFlag=t.meltFlag}},{key:"copyFunc",value:function(){var t=this.globalConfig.main.curElec.getData();t.uid=null,this.globalConfig.main.copyEqu(t)}},{key:"randomColor",value:function(){return f["default"].getColor()}},{key:"gotoOpticsMc",value:function(){var t=this;this.body.get_shapes().foreach(function(e){e.get_userData().vo=t.lightprototype?t.vo:null})}},{key:"changeMatrialSkin",value:function(t){if(t){var e=this.namelist.indexOf(t.showValue);0>e&&(e=0),this.skinIndex=e,this.skinName=this.originlist[e],this.skinType="默认"==this.skinName?1:2;var i=this.skinProto[this.skinName];this.BodyUtil.setMaterialFromObject(this.material,{density:i[0],dynamicFriction:i[1],elasticity:i[2]});var n=this.body.get_shapes(),o=this.material.get_density();n.foreach(function(t){t.set_density(o)}),"玻璃"==this.skinName||"冰块"==this.skinName?(this.vo.n=this.vo.rate="玻璃"==this.skinName?1.5:1.3,this.lightprototype?this.showToolDatas():(this.lightprototype=!0,this.gotoOpticsMc(),this.showToolDatas())):this.lightprototype?(this.lightprototype=!1,this.gotoOpticsMc(),this.showToolDatas()):this.showToolDatas(),this.freshLibPan()}this.bg&&this.changeSkin()}},{key:"changeSkin",value:function(){if(this.lineThin=2/this.getGlobalScale(),this.cacheLine(),1==this.skinType)this.replaceBg(this.bg,this.getFillSkin());else{var t=this.getTextureFromName(this.skinMap[this.skinName],this.changeSkin,this);t&&(0===t.width&&(t.width=512),0===t.height&&(t.height=512),this.replaceBg(this.bg,this.getTextureSkin(t)))}}},{key:"replaceBg",value:function(t,e){this.bg=e,this.skinCon.removeChild(t),this.updateSkinP(),this.skinCon.addChild(this.bg),this.bg.x=this.skinP.x,this.bg.y=this.skinP.y,this.edgeLine=this.getEdge(),this.bg.addChild(this.edgeLine);var i=this.body.get_position();this.x=i.get_x(),this.y=i.get_y()}},{key:"cacheLine",value:function(){this.edgeLine&&(this.globalConfig.main.cachePool.pushGraphic(this.edgeLine),this.bg.removeChild(this.edgeLine),this.edgeLine=null)}},{key:"getGlobalScale",value:function(){return this.globalConfig.main.view.scale.x}},{key:"updateSkinP",value:function(){this.skinP.x=0,this.skinP.y=0}},{key:"getTextureSkin",value:function(t){return new PIXI.Sprite}},{key:"getFillSkin",value:function(){return new PIXI.Container}},{key:"getEdge",value:function(){return this.globalConfig.main.cachePool.popGraphic()}},{key:"changeForceAnalysis",value:function(t){(this.openF_analysis=t.checked)||this.removeForceAnalysis()}},{key:"changeDensity",value:function(t){this.BodyUtil.setMaterial(this.material,"density",l.M.getNumStr(t.showValue)-0)}},{key:"changeMass",value:function(t){this.BodyUtil.setMaterial(this.material,"density",(l.M.getNumStr(t.showValue)-0)/this.BodyUtil.getBodyArea(this.body)*1e3)}},{key:"changeDfriction",value:function(t){var e=l.M.getNumStr(t.showValue)-0;this.BodyUtil.setMaterial(this.material,"dynamicFriction",e),this.BodyUtil.setMaterial(this.material,"staticFriction",e)}},{key:"showEdge",value:function(){var t=Ver2Util.getBodyEdge(this.body),e=[];e.push({option:"BodyEdges"}),e.push({color:16777215,alpha:1,thin:3,data:t}),this.getTopGrc().dispatchEvent("Start_Graphic",e,this.UID),this.selectEdge=!0}},{key:"setSelected",value:function(t){var i=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setSelected",this).call(this,t),this.interval&&(clearTimeout(this.interval),this.interval=null),t?this.interval=setTimeout(function(){i.hadDestory||(i.interval=null,i.paramObj.moduleMain.napeEngine.transformManager.show(i),i.selfShowSelect())},0):this.paramObj.moduleMain.napeEngine.transformManager.hide()}},{key:"selfShowSelect",value:function(){}},{key:"disposeEdge",value:function(){this.getTopGrc().dispatchEvent("Dispose_Graphics",this.UID),this.selectEdge=!1}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.selectEdge&&this.showEdge()}},{key:"updateEnd",value:function(){this.iceMelt2()}},{key:"iceMelt2",value:function(){if(this.inWater)return void(this.inWater=!1);if(this.meltFlag&&this.isIce()&&this.body){var t=this.body.getArea();if(.1>this.currentScale.x&&400>t)this.removeEquipment(this);else{var e=1;e=1-(t>3e3?.001:.001*(3200-t)/200)*e*.25,this.setScale(this.currentScale.x*e,this.currentScale.y*e)}}}},{key:"inWaterUpdate",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"inWaterUpdate",this).call(this,t,i),this.iceMelt(t,i)}},{key:"iceMelt",value:function(t,e){if(this.meltFlag&&this.isIce()){var i=t.get_overlap(),n=this.body.getArea(),o=0;if(.1>this.currentScale.x&&400>n)o=n,this.removeEquipment(this);else{var r=i/n;r=1-(n>3e3?.001:.001*(3200-n)/200)*r*.25-25e-5,this.setScale(this.currentScale.x*r,this.currentScale.y*r),o=n-this.body.getArea()}var a=e.liquid.density;e.liquidArea+=this.material.get_density()*o/a,this.inWater=!0}}},{key:"getWaterContainerByLiquidShape",value:function(t){if(!t)return null;var e=t.get_body();return e&&e.userData?e.userData.view:null}},{key:"isIce",value:function(){return"冰块"===this.skinName}},{key:"removeEquipment",value:function(t){t.body&&t.body.userData&&(t.body.userData.dragManager&&t.body.userData.dragManager.func_touchEnd(new l.Point),this.main.removeEquipment(t))}},{key:"changeElec",value:function(t){this.BodyUtil.setMaterial(this.material,"elasticity",l.M.getNumStr(t.showValue)-0)}},{key:"getMaxMass",value:function(){var t=this.body.getArea();return l.M.getNumJie(13.6*t*.001,1)}},{key:"getMinMass",value:function(){var t=this.body.getArea();return l.M.getNumJie(.7*t*.001,1)}},{key:"changeRate",value:function(t){this.vo.n=l.M.getNumStr(t.showValue)-0}},{key:"changeGroup",value:function(t){if(this.body)if(0==(this.groupIndex=this.groupMap.indexOf(t.showValue)))this.BodyUtil.setBodyFilter(this.body,this.InteractionFilterManager.GROUP_DEFAULT);else{var e=["default","A","B","C","D"];this.BodyUtil.setBodyFilter(this.body,this.InteractionFilterManager["GROUP_"+e[this.groupIndex]])}}},{key:"changeMelt",value:function(t){this.meltFlag=t.checked}},{key:"getConf",value:function(){this.elecLable=this.language.getLocaleStr("body");var t={};t.confArr=[];var e=this;return t.confArr.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("custom_graphics"),!1,"",this.namelist[this.skinIndex],this.namelist,this,this.changeMatrialSkin,1,0),this.ComponentProperty.getDropMenu(this.language.getLocaleStr("grouping"),!1,"",this.groupMap[this.groupIndex],this.groupMap,this,this.changeGroup,1,0),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("density"),!0,"g/cm³",13.6,.7,{get value(){return e.body?l.M.getNumJie(e.getBodyDensity(),1):null},set value(t){e.material.set_density(t),e.showToolDatas()}},.1,this.changeDensity,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("mass"),!0,"g",this.getMaxMass(),this.getMinMass(),{get value(){return e.body?l.M.getNumJie(e.body.mass,1):null},set value(t){e.body.mass=t,e.showToolDatas()}},.1,this.changeMass,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("roughness"),!0,"",1,0,this.getDynamicFriction(),.1,this.changeDfriction,this),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("elastic_coefficient"),!0,"",1,0,this.getBodyElasticity(),.1,this.changeElec,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("force_analysis"),this.openF_analysis,this.changeForceAnalysis,this)),this.isIce()&&t.confArr.push(this.ComponentProperty.getSwitch(this.language.getLocaleStr("melt"),this.meltFlag,this.changeMelt,this)),t}},{key:"getTipMess",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getTipMess",this).call(this);return t+="\n    "+this.language.getLocaleStr("density")+": "+l.M.getNumJie(this.getBodyDensity(),1)+"g/cm³\n    "+this.language.getLocaleStr("mass")+": "+l.M.getNumJie(this.body.mass,1)+"g\n    "+this.language.getLocaleStr("roughness")+": "+this.getDynamicFriction()+"\n    "+this.language.getLocaleStr("elastic_coefficient")+": "+this.getBodyElasticity()+"\n    "}},{key:"skinMap",get:function(){var t=this.globalConfig.cdn_static;return{"默认":t+"mechanics/diydefault.jpg","铝":t+"mechanics/diyaluminium.jpg","大理石":t+"mechanics/diydls.jpg","木材":t+"mechanics/diywood.jpg","玻璃":t+"mechanics/diyglass.jpg","冰块":t+"mechanics/diyice.jpg"}}},{key:"rootData",get:function(){return this._rootData||(this._rootData={isLock:!1}),this._rootData}}]),e}(c["default"]);_.OPEN_ANGLE=1,_.SHOW_REFLECT=2,_.SHOW_DIRECTION=3,e["default"]=_},542:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0,e["default"]=function o(t){n(this,o),this.MEC_FLOOR_FILTER=t.getShapeGroup([0],[0,1,2,3,4,10,13]),this.GROUP_DEFAULT=t.getShapeGroup([0],[-1]),this.GROUP_A=t.getShapeGroup([1],[0,10,13]),this.GROUP_B=t.getShapeGroup([2],[0,10,13]),this.GROUP_C=t.getShapeGroup([3],[0,10,13]),this.GROUP_D=t.getShapeGroup([4],[0,10,13]),this.LIGHT_SELF_FILTER=t.getShapeGroup([10],[0,1,2,3,4,11,16,17]),this.OPTICS_LENS_FILTER=t.getShapeGroup([11],[10,16]),this.DRAG_FIELD_FILTER=t.getShapeGroup([12],[15]),this.PERISCOPE=t.getShapeGroup([16],[11,10]),this.PERISCOPE_MIRROR=t.getShapeGroup([17],[10]),this.PERISCOPE_HIT=t.getShapeGroup([18],[18]),this.MEC_COMPONENT_FILTER=t.getLiquidGroup([13],[0,1,2,3,4],[2],[2]),this.LIQUID_ONLY_GROUP=t.getShapeGroup([14],[13]),this.LIQUID_GROUP=t.getLiquidGroup([13],[14,15],[1],[0]),this.LIQUID_IGNORE_GROUP=t.getLiquidGroup([0],[-1],[2],[3])}},544:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function b(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:b(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(471),f=n(d),p=i(474),y=n(p),g=void 0,v=void 0,_=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return g=t.main.phy.nape,v=g.geom.Vec2,i.var_r=10,i.lineColor=16777215,i.lineThin=2,i.body=null,i.skinColor=null,i.lineColor=null,i.singlePoint=!0,i.func_dispose(),i.func_init(),i.completefunc=null,i.lastPoint=null,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchTabUid||(this.touchTabUid=l.M.addTouch(this.var_dis,{tab:i.touchTab,isAddDB:!0},this,{canTab:!0}))}else this.touchTabUid&&(l.M.removeTouch(this.var_dis,this.touchTabUid),this.touchTabUid=null,this.func_dispose(),this.func_init())}},{key:"func_init",value:function(){this.var_startP=null,this.var_points=[],this.n=-1,this.lastPoint=null}},{key:"onDomClick",value:function(t){this.func_dispose(),this.func_init()}},{key:"getMaxDis",value:function(){for(var t=0,e=this.var_points.length,i=1;e>i;i++)for(var n=0;i>n;n++){var o=this.var_points[i],r=this.var_points[n],a=l.Point.distance(o,r);a>t&&(t=a)}return t}},{key:"touchTab",value:function(t){if(0>this.n){var e=this.globalConfig.main.view.scale.x;this.lineThin=4/e,this.var_r=15/e,this.skinColor=y["default"].getColor()}this.func_checkEnd(t)||this.func_addPoint(t)}},{key:"func_touchTab",value:function(t){this.touchTab(t)}},{key:"func_addPoint",value:function(t){this.n++;var e=new l.Point(t.x,t.y);if(0==this.n)this.var_startP=e;else{if(1>l.Point.distance(e,this.lastPoint))return void this.n--}this.lastPoint=e,this.var_points[this.n]=e,this.func_refreshGrc()}},{key:"func_checkEnd",value:function(t){return this.n>=2&&l.Point.distance(t,this.var_startP)<2*this.var_r&&(this.func_dispose(),this.createBody(),this.func_init(),this.completefunc&&this.completefunc(),this.globalConfig.main.dispatchEvent("phy.addEquipment"),!0)}},{key:"createBody",value:function(){for(var t=[],e=this.body.shapes,i=e.get_length(),n=0;i>n;n++)!function(i){var n=e.at(i),o=n.get_localVerts(),r=[];o.foreach(function(t){r.push(t)}),t.push(r)}(n);var o=new f["default"](this.config,t,this.skinColor);this.addEquipmentChild(o,this.var_startP),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"penTool"}),this.globalConfig.main.isPlay||o.setSelected(!0)}},{key:"func_refreshGrc",value:function(){this.func_dispose();var t=[],e=this.var_points[0];this.var_points.forEach(function(i){t.push(new l.Point(i.x-e.x,i.y-e.y))},this);var i=this.BodyUtil.BodyFromArray(t,null,null);this.body=i;var n=new PIXI.Graphics;if(i){n.addChild(this.func_getFillShape(i))}(n.addChild(this.func_getLineShape()),this.var_r>0)&&n.addChild(this.func_getPointsShape());var o=[];o.push({option:"addElement",target:n,params:{x:0,y:0}}),this.func_dispatchGraphic(o)}},{key:"func_getPointsShape",value:function(){for(var t=new PIXI.Graphics,e=this.var_points.length,i=0;e>i;i++){var n=this.var_points[i];0===i?(t.lineStyle(this.lineThin,16777215,0),t.beginFill(16777215,.5),t.drawCircle(n.x,n.y,3*this.var_r),t.endFill(),t.beginFill(16777215,1),t.drawCircle(n.x,n.y,1.5*this.var_r),t.endFill()):(t.lineStyle(this.lineThin,16777215,2),t.beginFill(16721687,1),t.drawCircle(n.x,n.y,this.var_r),t.endFill())}return t}},{key:"func_getLineShape",value:function(){var t=new PIXI.Graphics;t.lineStyle(this.lineThin,16777215,1);for(var e=this.var_points.length,i=0;e>i;i++){var n=this.var_points[i];0==i?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y)}return t}},{key:"func_getFillShape",value:function(t){for(var e=this.var_points[0],i=new PIXI.Graphics,n=t.shapes,o=n.get_length(),r=0;o>r;r++){var a=n.at(r);if(a.isPolygon()){var s=a.get_localVerts();i.lineStyle(0,16777215,0),i.beginFill(this.skinColor,1);for(var h=s.get_length(),l=0;h>l;l++){var u=s.at(l),c=e.x+u.get_x(),d=e.y+u.get_y();0==l?i.moveTo(c,d):i.lineTo(c,d)}i.endFill()}}return i}}]),e}(c["default"]);_.preventDraw=!0,e["default"]=_},547:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function m(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:m(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(454),c=n(u),d=i(499),f=n(d),p=i(581),y=n(p),g=void 0,v=void 0,_=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return g=t.moduleMain.phy.nape,v=g.geom.Vec2,n.classname="ThrusterToolView",n.level=20,n.skinCon=new PIXI.Container,n.addChild(n.skinCon),n.drawForce=new b,n.addChild(n.drawForce),n.drawForce.visible=!1,n.bg=PIXI.Sprite.fromFrame("mechSkin/thurF"),n.skinCon.addChild(n.bg),l.M.alignPivot(n.bg,"center","center"),n.ismecJoint=!0,n.bindbody=i,n.forcejoint=null,n.force=.5,n.vec2Force=null,n.offRo=null,n.dirfollow=!1,n.forceisMove=!1,n.forceT=null,n.active=!0,n.minForce=.1,n.maxForce=10,n}return a(e,t),s(e,[{key:"init",value:function(){var t=this;this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.cannotSystemDrag=!0,this.body.userData.dragLevel=3,this.body.userData.stopFindConnectBodies=!0,this.body.mass=.001,this.body.sensorEnabled(!0),this.body.noallowRotation=!0,this.addEventListener(c["default"].SET_BODY_STATE,function(e){t.func_setBodyStateHandler(e)}),this.bindbody&&this.fixedBody(this.bindbody)}},{key:"setActive",value:function(t){this.active=t}},{key:"setSelected",value:function(t){var i=this;h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setSelected",this).call(this,t),this.drawForce.visible=t,this.updateDraw(t),this.drawForce.dragId&&(l.M.removeTouch(this.drawForce.dragArea,this.drawForce.dragId),this.drawForce.dragId=null,this.removedCursor(this.drawForce.dragArea)),t&&(this.addCursor(this.drawForce.dragArea,"hand"),this.drawForce.dragId=l.M.addTouch(this.drawForce.dragArea,{begin:function(t){i.drawForce.op=i.getMain().view.toLocal(new l.Point(0,0),i),i.paramObj.moduleMain.napeEngine.touchManager.enAbled=!1},move:function(t){var n=i.getMouseXY(t),o=new l.Point(n.x-i.drawForce.op.x,n.y-i.drawForce.op.y);o.x/=e.pxPerN,o.y/=e.pxPerN,i.setForce(o),i.updateDraw(),i.showToolDatas()},end:function(t){i.drawForce.op=null},isAddDB:!0},this))}},{key:"bodyContainsConstraint",value:function(t,e){return!!t.contains(new v(this.x,this.y))}},{key:"changeBody",value:function(t,e){this.fixedBody(e)}},{key:"fixedBody",value:function(t){this.bindbody=t,this.forcejoint?(this.forcejoint.set_body2(this.bindbody),this.forcejoint.set_anchor2(this.bindbody.worldPointToLocal(this.body.position))):this.forcejoint=this.JointUtil.createPivotJoint(this.body,this.bindbody,this.body.position,this.body.position),this.offRo=this.bindbody.rotation-this.body.rotation,this.forcejoint.userData.isThruster=!0,this.forcejoint.userData.view=this,this.forcejoint.userData.toolView=this,this.forcejoint.userData.bindBody=this.body}},{key:"func_setBodyStateHandler",value:function(t){var e=this;this.forceisMove=!1,t&this.BodyUtil.ALLOW_MOVE?(this.forceT&&clearTimeout(this.forceT),this.forceT=setTimeout(function(){if(!e.hadDestory){e.body.zpp_inner.invalidate_pos(),e.body.zpp_inner.validate_aabb();var t=e.napeEngine.space.bodiesUnderPoint(e.body.position);t.filter(function(t){return!t.userData||!t.userData.isnbequ});var i=e.BodyUtil.getTopBodyFormBodyList(t,[e.body]),n=!1;i&&(e.forcejoint.set_body2(i),e.forcejoint.anchor2=i.worldPointToLocal(e.body.position),e.forcejoint.body2=i,e.bindbody=i,n=!0,e.forcejoint.set_active(!0)),n||e.removeFromFramework(e)}},0)):(this.forceisMove=!0,this.forcejoint.set_active(!1))}},{key:"func_bindVo",value:function(t){this.bindbody=t.beginBody?t.beginBody:this.getWorldBody(),this.forcejoint=this.JointUtil.createPivotJoint(this.body,this.bindbody,this.body.position,this.body.position),this.offRo=this.bindbody.rotation-this.body.rotation,this.forcejoint.userData.isThruster=!0,this.forcejoint.userData.view=this,this.forcejoint.userData.toolView=this,this.forcejoint.userData.bindBody=this.body}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.active&&this.systemPlayStatus()&&(this.forceisMove||(this.bindbody&&this.bindbody.applyImpulse(this.forceValue(),this.body.position),this.dirfollow&&(this.body.rotation=this.bindbody.rotation-this.offRo)))}},{key:"removed",value:function(){this.forcejoint.userData&&this.forcejoint.userData.view&&(this.forcejoint.userData.view=null,this.forcejoint.userData.toolView=null,this.forcejoint.userData.bindBody=null),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"updateDraw",value:function(t){if(this.drawForce.visible=t,this.drawForce.clear(),t){var i=4/this.getGlobalScale(),n=this.force*e.pxPerN;if(this.drawForce.sca=i,2>this.force){var o=15*Math.PI/180;this.body.rotation=Math.round(this.body.rotation/o)*o}this.drawForce.draw(n,this.body.rotation,this.force)}}},{key:"setForce",value:function(t){this.body.rotation=Math.atan2(t.y,t.x),this.force=Math.sqrt(t.x*t.x+t.y*t.y),this.force=parseFloat(this.force.toFixed(2)),this.minForce>this.force&&(this.force=this.minForce),this.force>this.maxForce&&(this.force=this.maxForce)}},{key:"forceValue",value:function(){var t=this.getForce(this.force*e.kf);return this.vec2Force=new v(Math.cos(this.body.rotation)*t,Math.sin(this.body.rotation)*t)}},{key:"origForceValue",value:function(){var t=this.getForce(this.force);return this.vec2Force=new v(Math.cos(this.body.rotation)*t,Math.sin(this.body.rotation)*t)}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.body2={uid:(this.forcejoint.body2.userData?this.forcejoint.body2.userData.view:{}).UID,anchorX:this.forcejoint.anchor2.get_x(),anchorY:this.forcejoint.anchor2.get_y()},t.offRo=this.offRo,t.force=this.force+"N",t.follow=this.dirfollow,t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.body.transformShapes(this.transformN),this.setScale(this.currentScale.x,this.currentScale.y);var i=void 0,n=void 0;t.body2&&(i=this.getBodyFromUid(t.body2.uid),n=i.localPointToWorld(v.get(t.body2.anchorX,t.body2.anchorY)),this.forcejoint=this.JointUtil.createPivotJoint(this.body,i,n,n),this.offRo=t.offRo,this.bindbody=i,this.forcejoint.userData.isThruster=!0,this.forcejoint.userData.view=this,this.forcejoint.userData.bindBody=this.body,this.changeForce({showValue:t.force}),this.func_changeFollow({checked:t.follow}))}},{key:"changeForce",value:function(t){this.force=l.M.getNumStr(t.showValue)-0,this.drawForce.visible&&this.updateDraw(!0)}},{key:"func_changeFollow",value:function(t){this.dirfollow=t.checked}},{key:"rotatedConf",value:function(t){this.body.rotation=l.M.toHu(-t.value),this.updateDraw(!0)}},{key:"getConf",value:function(){var t=l.M.toAngle(this.body.rotation);t=t||0,t=l.M.getValidAngle(-t);var e={};return this.elecLable=this.language.getLocaleStr("thrust"),e.confArr=[],e.confArr.push(this.ComponentProperty.getScrollBar(this.language.getLocaleStr("thrust_size"),!0,"N",10,.1,this.force+"N",.1,this.changeForce,this),this.ComponentProperty.getAngle(this.language.getLocaleStr("angle"),t,this.rotatedConf,this),this.ComponentProperty.getSwitch(this.language.getLocaleStr("follow"),this.dirfollow,this.func_changeFollow,this)),e}}]),e}(f["default"]);_.kf=.495,_.pxPerN=200,e["default"]=_;var b=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.thin=2,t.sca=2,t.text01=new y["default"]("",{font:"16px Microsoft YaHei",fill:16777215}),t.text02=new y["default"]("",{font:"16px Microsoft YaHei",fill:16777215}),t.addChild(t.text01),t.addChild(t.text02),t.fontSize=16,t.dragArea=new PIXI.Graphics,t.addChild(t.dragArea),t}return a(e,t),s(e,[{key:"draw",value:function(t,e,i){for(e=-e;0>e;)e+=2*Math.PI;e=(e+Math.PI)%(2*Math.PI)-Math.PI,80*this.sca>t&&(t=80*this.sca),t>200*this.sca&&(t=200*this.sca),this.clear(),this.lineStyle(this.thin*this.sca,16777215,1),this.moveTo(0,0),this.lineTo(t,0);var n=5*this.sca;this.beginFill(16777215,1),this.moveTo(t+n,0),this.lineTo(t,-n),this.lineTo(t,n),this.endFill();var o=.6*t;this.beginFill(16777215,.6),this.moveTo(0,0),e>0?this.arc(0,0,o,0,e,!1):this.arc(0,0,o,0,e,!0),this.endFill();new l.Point(Math.cos(-e),Math.sin(-e));this.text01.scale.x=this.text01.scale.y=this.sca,this.text01.text=Math.round(180*e/Math.PI)+"°",this.text01.x=30*this.sca,this.text01.y=-(e>0?this.fontSize*this.sca*1.5:0),this.text02.scale.x=this.text02.scale.y=this.sca,this.text02.text=i.toFixed(2)+"N",this.text02.x=t+30,this.text02.y=-this.fontSize*this.sca/2,this.dragArea.clear(),this.dragArea.beginFill(0,0),this.dragArea.drawCircle(t,0,30*this.sca),this.dragArea.endFill()}}]),e}(PIXI.Graphics)},548:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(539),l=n(h),u=i(541),c=(n(u),i(1),i(516)),d=(n(c),i(471)),f=n(d),p=void 0,y=void 0,g=void 0,v=void 0;e["default"]=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return p=n.ComponentProperty,e.injectionClass(),n.classname="Triangle",n.verticesArr=t||[],n.skinColor=i||0,n.bg=n,n}return a(e,t),s(e,null,[{key:"injectionClass",value:function(){e.injected||(e.injected=!0,y=l["default"].nape,g=y.shape.Polygon,v=y.geom.Vec2)}}]),e}(f["default"])},549:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function _(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:_(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(499),c=n(u),d=i(454),f=n(d),p=i(489),y=n(p),g=void 0,v=void 0;e["default"]=function(t){function e(t,i,n){o(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return g=a.phy.nape,v=g.geom.Vec2,a.classname="WeldJointView",a.level=20,a.body01=i,a.body02=n,a.ismecJoint=!0,a.bg=PIXI.Sprite.fromFrame("mechSkin/fix"),a.skinCon=new PIXI.Container,a.skinCon.addChild(a.bg),a.addChild(a.skinCon),l.M.alignPivot(a.bg,"center","center"),a.var_joint=null,a.var_isMove=!1,a}return a(e,t),s(e,[{key:"init",value:function(){var t=this;this.radius=this.bg.width/2,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.elecLable="钉子",this.body.userData.dragLevel=3,this.body.sensorEnabled(!0),this.body.noallowRotation=!0,this.addEventListener(f["default"].SET_BODY_STATE,function(e){t.func_setBodyStateHandler(e)}),this.body01&&this.body02&&this.fixedBodies(this.body01,this.body02)}},{key:"setScale",value:function(t,i){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScale",this).call(this,t,i),this.skinCon.scale.x=this.currentScale.x,this.skinCon.scale.y=this.currentScale.y}},{key:"setSelected",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setSelected",this).call(this,t),t?(this.paramObj.moduleMain.napeEngine.transformManager.show(this),this.paramObj.moduleMain.napeEngine.transformManager.setRotateEnabled(!1),this.paramObj.moduleMain.napeEngine.transformManager.setScaleMode(y["default"].SCALE_UNIFORM)):this.paramObj.moduleMain.napeEngine.transformManager.hide()}},{key:"bodyContainsConstraint",value:function(t,e){return!!t.contains(new v(this.x,this.y))}},{key:"changeBody",value:function(t,e){if(t===this.body01)this.body01=e;else{if(t!==this.body02)return;this.body02=e}this.fixedBodies(this.body01,this.body02)}},{key:"fixedBodies",value:function(t,e){if(t.userData&&t.userData.view){var i=t.userData.view;i.weldFix&&i.weldFix()}var n=e.rotation-t.rotation||0;if(this.var_joint){var o=t.worldPointToLocal(this.body.position),r=e.worldPointToLocal(this.body.position);this.var_joint.set_body1(t),this.var_joint.set_body2(e),this.var_joint.anchor1=o,this.var_joint.anchor2=r}else this.var_joint=this.JointUtil.createWeldJoint(t,e,this.body.position,this.body.position,n),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this;this.body01=this.var_joint.body1=t,this.body02=this.var_joint.body2=e,this.var_joint.set_phase(n),this.var_joint.set_active(!0)}},{key:"updateAfterMove",value:function(){var t=this.var_joint.body1,e=this.var_joint.body2,i=t.worldPointToLocal(this.body.position),n=e.worldPointToLocal(this.body.position);this.var_joint.anchor1=i,this.var_joint.anchor2=n}},{key:"fixed",value:function(){var t=new v(this.x,this.y),e=this.space.bodiesUnderPoint(t);e.filter(function(t){return!!t.userData.canfixtool||(!t.userData||!t.userData.isnbequ)});var i=this.BodyUtil.getTopBodyFormBodyList(e,[this.body]);if(!i)return void this.removeFromFramework(this);var n=this.BodyUtil.getTopBodyFormBodyList(e,[this.body,i]);n||(n=this.getWorldBody()),this.fixedBodies(i,n)}},{key:"removed",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this),this.var_joint&&(this.var_joint.userData.bindBody=null,this.var_joint.userData.toolView=null,this.BodyUtil.destoryJoint(this.var_joint))}},{key:"func_setBodyStateHandler",value:function(t){this.var_isMove=!1,t&this.BodyUtil.ALLOW_MOVE?(this.var_joint.userData.bindBody=this.body,this.fixed()):(this.var_isMove=!0,this.var_joint.userData.bindBody=null)}},{key:"func_bindVo",value:function(t){var e=void 0;if(null==t.beginBody){if(!t.endBody.isDynamic())return void this.removeFromFramework(this);e=this.getWorldBody()}else e=t.beginBody;var i=void 0;if(null==t.endBody){if(!t.beginBody.isDynamic())return void this.removeFromFramework(this);i=this.getWorldBody()}else i=t.endBody;var n=e.userData.view;if(n instanceof nb.mec.Box||n instanceof nb.mec.Circle){20>v.distance(t.beginVec2,e.position)&&(t.beginVec2=v.get(e.posx,e.posy),t.endVec2=v.get(e.posx,e.posy))}this.var_joint=t.beginBody?this.JointUtil.createWeldJoint(e,i,t.beginVec2,t.endVec2):this.JointUtil.createWeldJoint(i,e,t.endVec2,t.beginVec2),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this}},{key:"update",value:function(){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.var_joint)try{if(this.var_isMove)return;this.body.set_position(this.var_joint.body1.localPointToWorld(this.var_joint.anchor1)),this.body.rotation=this.var_joint.body1.rotation,this.BodyUtil.frezzBody(this.body)}catch(t){this.removeFromFramework(this)}}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);if(!this.var_joint)return null;t.phase=this.var_joint.get_phase();var i=this.var_joint.body1.userData.view,n=this.var_joint.body2.userData?this.var_joint.body2.userData.view:{};return t.body1={uid:i.UID,anchorX:this.var_joint.anchor1.get_x(),anchorY:this.var_joint.anchor1.get_y()},t.body2={uid:n.UID,anchorX:this.var_joint.anchor2.get_x(),anchorY:this.var_joint.anchor2.get_y()},t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.body.transformShapes(this.transformN),this.setScale(this.currentScale.x,this.currentScale.y),this.revert(t)}},{key:"revert",value:function(t){var e=this,i=void 0,n=void 0,o=void 0,r=void 0;if(this.body.set_type(g.phys.BodyType.get_DYNAMIC()),t.body1){if(!(i=this.getBodyFromUid(t.body1.uid)))return clearTimeout(this.tt),this.tt=setTimeout(function(){e.hadDestory||e.revert(t)},10),void this.body.set_type(g.phys.BodyType.get_KINEMATIC());o=i.localPointToWorld(v.get(t.body1.anchorX,t.body1.anchorY)),t.body2.uid?(n=this.getBodyFromUid(t.body2.uid),r=n.localPointToWorld(v.get(t.body2.anchorX,t.body2.anchorY))):(n=this.getWorldBody(),r=v.get(t.body2.anchorX,t.body2.anchorY)),this.var_joint=this.JointUtil.createWeldJoint(i,n,o,r,t.phase),this.var_joint.userData.bindBody=this.body,this.var_joint.userData.toolView=this}}}]),e}(c["default"])},550:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function d(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:d(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(446),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return c=i.phy.nape,i.material=new c.phys.Material(0,.1,.2,2,.02),i.bg=new PIXI.Graphics,i.bg.beginFill(16711680,0),i.bg.drawRect(-25,-25,50,50),i.bg.endFill(),i.addChild(i.bg),i}return r(e,t),a(e,[{key:"init",value:function(){this._width=50,this._height=50,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.body.sensorEnabled(!0),this.body.userData.dragLevel=3,this.body.userData.classType="DragBox",this.addSelectTrigger(),this.hasAddCompComplete=!0}},{key:"removed",value:function(){this.removeChild(this.bg),this.tigid&&h.M.removeTouch(this,this.tigid),this.bg=null,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"addSelectTrigger",value:function(){var t=this;this.tigid=h.M.addTouch(this,{end:function(){t.getMain().view.selectionLayer.selectOneBodyToReadyMove(t,{bodylist:[t.body]})}},this)}}]),e}(u["default"])},551:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function O(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:O(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(515),c=n(u),d=i(550),f=n(d),p=i(454),y=n(p),g=i(226),v=n(g),_=void 0,b=void 0,m=void 0,w=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return _=i.phy.nape,b=_.geom.Vec2,m=_.NbBody,w=_.phys.BodyType,i.JointUtil=t.moduleMain.JointUtil,i.BodyUtil=t.moduleMain.BodyUtil,i.ToolStatusStr=t.moduleMain.ToolStatusStr,i.cateid=5,i.classname="ToolSpring",i.ismecJoint=!0,i.isMechanics=!0,i.fromEquTools=!1,i.isMechaTool=!0,i.istool=!0,i.bg=i,i.level=20,i.onelen=10,i.firstBox=null,i.firstJoint=null,i.firstBody=null,i.secBox=null,i.secJoint=null,i.secBody=null,i.spring=null,i.spring_view=null,i.k=1,i.springLen=0,i.noRenderSelected=!0,i.elecLable="弹簧",i.hasAddCompComplete=!0,i}return a(e,t),s(e,[{key:"fixFirstBox",value:function(t,e){var i=this;this.firstBox=new f["default"](this.paramObj),this.addChild(this.firstBox),this.firstBox.init(),this.firstBox.addBodyToSpace(this.firstBox.body,this),this.firstBox.body.set_position(e),null==t&&(t=this.firstBox.getWorldBody()),this.firstBody=t,this.firstJoint=this.JointUtil.createWeldJoint(this.firstBox.body,this.firstBody,e,e),this.firstJoint.userData.toolView=this,this.firstJoint.userData.bindBody=this.firstBox.body,this.firstBox.addEventListener(y["default"].SET_BODY_STATE,function(t){i.setBodyStateHandler(t,i.firstBox)})}},{key:"initDrag",value:function(){var t=this,e=void 0;this.touchid=l.M.addTouch(this.spring_view,{begin:function(i){var n=t.firstBox.getEngineTouchManager();if(n.getCurrentToolStatus()==t.ToolStatusStr.MOVE){e=new n.currentTool(t.paramObj),e.cannotStart=!0,e.init(n.dis,n.space);var o=t.getMouseXY(i);e.moveBody(t.firstBox.body,o)}},move:function(i){if(e){var n=t.getMouseXY(i);e.func_touchMove(n)}},end:function(i){if(e){var n=t.getMouseXY(i);e.func_touchEnd(n),e.dispose()}}},this)}},{key:"setSelected",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setSelected",this).call(this,t),this.spring_view.selected=t}},{key:"setBodyStateHandler",value:function(t,e){if(t&this.BodyUtil.ALLOW_MOVE){var i=e.napeEngine.space.bodiesUnderPoint(e.body.position);i.filter(function(t){return!t.userData||!t.userData.isnbequ});var n=this.BodyUtil.getTopBodyFormBodyList(i,[e.body]),o=void 0;!n||n&&n.userData&&n.userData.view instanceof f["default"]?(n=e.getWorldBody(),o=e.body.position):o=n.worldPointToLocal(e.body.position),e==this.firstBox?(this.firstBody=n,this.firstJoint.anchor2=o,this.firstJoint.set_body2(n)):(this.secBody=n,this.secJoint.anchor2=o,this.secJoint.set_body2(n)),this.secJoint.active=!0,this.firstJoint.active=!0}else e==this.firstBox?this.firstJoint.active=!1:this.secJoint.active=!1}},{key:"initSecondBox",value:function(t){var e=this;this.secBox=new f["default"](this.paramObj),this.addChild(this.secBox),this.secBox.init(),this.secBox.addBodyToSpace(this.secBox.body,this),this.secBox.body.set_position(t),this.secBox.body.set_type(w.get_KINEMATIC()),this.secBox.addEventListener(y["default"].SET_BODY_STATE,function(t){e.setBodyStateHandler(t,e.secBox)});var i=l.M.vec2Length(this.secBox.body.position.sub(this.firstBox.body.position));this.springLen=i,this.spring=this.JointUtil.createSpringJoint(this.firstBox.body,this.secBox.body,this.firstBox.body.position,this.secBox.body.position,i),this.spring.damping=.15,this.spring.frequency=this.k,this.spring_view=new c["default"](this.paramObj),this.spring_view.joint=this.spring,this.spring_view.count=0,this.spring.userData.view=this.spring_view,this.addChildAt(this.spring_view,0),this.spring.active=!1,this.initDrag(),this.firstBox.on("moveEnd",function(t){e.checkRemove()}),this.secBox.on("moveEnd",function(t){e.checkRemove()})}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.spring&&this.spring.update()}},{key:"bodyContainsConstraint",value:function(t,e){return!!t.contains(this.firstBody.localPointToWorld(this.firstJoint.anchor2))||!!t.contains(this.secBody.localPointToWorld(this.secJoint.anchor2))}},{key:"changeBody",value:function(t,e){t==this.firstBody?(this.__changeJointSecondBody(this.firstJoint,t,e),this.firstBody=e):t==this.secBody&&(this.__changeJointSecondBody(this.secJoint,t,e),this.secBody=e)}},{key:"__changeJointSecondBody",value:function(t,e,i){var n=e.localPointToWorld(this.firstJoint.anchor2),o=i.worldPointToLocal(n),r=t.get_body1().rotation-i.rotation;t.anchor2=o,t.set_body2(i),t.set_phase(r)}},{key:"bodyChanged",value:function(t){this.firstBody===t?t.contains(new b(this.firstBox.x,this.firstBox.y))||(this.firstBody=this.getWorld()):this.secBody===t&&(t.contains(new b(this.secBox.x,this.secBox.y))||(this.secBody=this.getWorld())),this.checkRemove()}},{key:"getWorld",value:function(){return this.firstBox.getWorldBody()}},{key:"checkRemove",value:function(){this.firstBody===this.getWorld()&&this.secBody===this.getWorld()&&setTimeout(this.removeFromFramework.bind(this),0,this)}},{key:"upateSpring",value:function(t){this.secBox||this.initSecondBox(t),this.secBox.body.set_position(t);var e=l.M.vec2Length(this.secBox.body.position.sub(this.firstBox.body.position));this.springLen=e,this.spring.springLength=e,this.spring_view.count=Math.floor(e/this.onelen)}},{key:"setSpringLen",value:function(t){this.springLen=t,this.spring.springLength=t,this.spring_view.count=Math.floor(t/this.onelen)}},{key:"fixSecondBox",value:function(t,e){if(null===t&&(t=this.secBox.getWorldBody(),this.firstBody===t))return void this.removeFromFramework(this);this.secBody=t,this.secJoint=this.JointUtil.createWeldJoint(this.secBox.body,this.secBody,e,e),this.secJoint.userData.toolView=this,this.secJoint.userData.bindBody=this.secBox.body,this.secBox.body.set_type(w.get_DYNAMIC()),this.spring.active=!0}},{key:"removed",value:function(){this.firstJoint.userData.toolView=null,this.secJoint&&(this.secJoint.userData.toolView=null),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this),this.touchid&&(l.M.removeTouch(this.spring_view,this.touchid),this.touchid=null),this.firstBox&&(this.firstBox.removed(),this.firstBox=null,this.firstJoint=null,this.firstBody=null),this.secBox&&(this.secBox.removed(),this.secBox=null,this.secJoint=null,this.secBody=null,this.BodyUtil.destoryJoint(this.spring))}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);if(t.thisX=this.x,t.thisY=this.y,t.uid=this.UID,t.fromEquTools=this.fromEquTools,t.ismecJoint=this.ismecJoint,t.springLen=this.springLen,this.secJoint){if(t.firstBox={x:this.firstBox.body.posx,y:this.firstBox.body.posy},t.secBox={x:this.secBox.body.posx,y:this.secBox.body.posy},this.firstJoint.body2){t.b1={uid:(this.firstJoint.body2.userData?this.firstJoint.body2.userData.view:{}).UID}}if(this.secJoint.body2){t.b2={uid:(this.secJoint.body2.userData?this.secJoint.body2.userData.view:{}).UID}}}return t}},{key:"setData",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t);var i=new f["default"](this.paramObj);if(t.firstBox){var n=void 0,o=void 0;n=i.getBodyFromUid(t.b1.uid),n||(n=i.getWorldBody()),this.fixFirstBox(n,b.get(t.firstBox.x,t.firstBox.y)),this.upateSpring(b.get(t.secBox.x,t.secBox.y)),o=i.getBodyFromUid(t.b2.uid),o||(o=i.getWorldBody()),this.fixSecondBox(o,b.get(t.secBox.x,t.secBox.y)),t.springLen&&this.setSpringLen(t.springLen)}}},{key:"getElecGlobalBounds",value:function(){var t=this.firstBox.toGlobal({x:0,y:0}),e=this.secBox.toGlobal({x:0,y:0});return l.M.getPArrRect([t,e])}}]),e}(v["default"])},556:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(49),l=i(602),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0,d=void 0;e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.globalConfig=t.globalConfig,c=t.main.phy.nape,d=c.geom.Vec2,r.NapeConst=i.NapeConst,r.Vec2Util=i.Vec2Util,r.config=t,r.map={},r.initListener(),r}return r(e,t),a(e,[{key:"initListener",value:function(){this.addEventListener("Start_Graphic",this.startGraphicHandler),this.addEventListener("Dispose_Graphics",this.disposeGraphicsHandler)}},{key:"clearLine",value:function(t){var e=this,i=1>=arguments.length||arguments[1]===undefined||arguments[1];t.clear(),t.children.map(function(t){t instanceof PIXI.Text&&e.config.main.cachePool.pushText(t)}),i&&t.removeChildren()}},{key:"disposeGraphicsHandler",value:function(t){var e=this.map[t];e&&(this.clearLine(e,!0),this.config.main.cachePool.pushGraphic(e),this.removeChild(e),this.map[t]=null)}},{key:"startGraphicHandler",value:function(t,e){var i=this.map[e];switch(i||(i=this.config.main.cachePool.popGraphic(),this.map[e]=i,this.addChild(i)),t[0].option){case"line":this.graphicsLine(i,t);break;case"whitePenLight":this.graphicsWhitePenLight(i,t);break;case"Circle":this.graphicsCircle(i,t);break;case"Rect":this.graphicsRect(i,t);break;case"text":this.addText(i,t);break;case"Force":this.graphicsForceAnalysis(i,t[0].target);break;case"ForceArrow":this.graphicsForceArrow(i,t[0].data);break;case"addElement":this.addElement(i,t);break;case"BodyEdges":this.drawEdges(i,t[1])}}},{key:"drawEdges",value:function(t,e){t.clear(),t.lineStyle(e.thin,e.color,e.alpha);var i=e.data;if(e.data.radius){var n=e.data.pos.get_x(),o=e.data.pos.get_y();return void t.drawCircle(n,o,e.data.radius)}if(e.data.compound){return void e.data.list.map(function(e){var i=e.v1,n=e.v2;t.moveTo(i.get_x(),i.get_y()),t.lineTo(n.get_x(),n.get_y())})}var r=0,a=void 0,s=void 0,h=i.get_length();i.foreach(function(e){0===r?(a=e.get_x(),s=e.get_y(),t.moveTo(a,s)):t.lineTo(e.get_x(),e.get_y()),++r===h&&t.lineTo(a,s)})}},{key:"addElement",value:function(t,e){t.removeChildren();var i=0;for(i=0;e.length>i;i++)!function(){var n=e[i].target;t.addChild(n),e[i].params&&(0,h.forEach)(e[i].params,function(t,e){n[t]=e})}()}},{key:"graphicsForceArrow",value:function(t,e){for(;t.children.length>0;){var i=t.removeChildAt(0);i.classType&&"ForceArrow"===i.classType&&(i.disposed(),this.config.main.cachePool.pushThreeClass("ForceArrow",i))}if(e){var n=1,o=null,r=0;for(r=0;e.length>r;r++){if(1==e[r].xu){o=e[r];break}var a=this.getArrowView();a.var_txt.style.fontSize="30px",t.addChild(a);var h=e[r],l="";h.symbol?l=h.symbol:(l="F"+n,n++),a.draw(h.force,h.pos,h.angle,l,e.color)}if(o)try{var u=o.list,c=new PIXI.Graphics;for(c.lineStyle(3,16777215),r=0;u.length>r;r++){var d=u[r],f=t.getChildAt(d.head).headPointTo(t),p=t.getChildAt(d.f1).headPointTo(t),y=t.getChildAt(d.f2).headPointTo(t);s.M.drawDashed(c,p,f,10),s.M.drawDashed(c,y,f,10)}t.addChild(c)}catch(g){}}}},{key:"graphicsForceAnalysis",value:function(t,e){for(;t.children.length>0;){var i=t.removeChildAt(0);i.classType&&"ForceArrow"===i.classType&&(i.disposed(),this.config.main.cachePool.pushThreeClass("ForceArrow",i))}var n=this.Vec2Util.vec3ToVec2(e.buoyancyImpulse()),o=this.config.moduleMain.napeEngine.getGravity(),r=o*e.mass*.001,a=this.getArrowView();t.addChild(a),a.draw(r,e.position,d.get(0,1),"G");var h=void 0,l=s.M.vec2Length(n);if(l>5){h=n.unit(),l*=this.NapeConst.FORCE_RATIO;var u=this.getArrowView();t.addChild(u),u.draw(l,e.position,h,"F浮")}var c=void 0,f=e.constraints;for(c=0;c<f.get_length();c++){var p=f.at(c);if(p.userData&&p.userData.isThruster){var y=p.userData.view.origForceValue(),g=s.M.vec2Length(y),v=y.unit();g*=this.NapeConst.FORCE_RATIO;var _=this.getArrowView();t.addChild(_),_.draw(g,e.position,v,"F")}}var b=e.get_arbiters(),m={},w={};for(c=0;c<b.get_length();c++){var O=b.at(c);if(O&&O.normalImpulse){var x=O.get_body1(),P=O.get_body2(),S=x.get_id()+P.get_id(),k=this.Vec2Util.vec3ToVec2(O.normalImpulse(e)),T=this.Vec2Util.vec3ToVec2(O.tangentImpulse(e));m[S]?m[S].addeq(k):m[S]=k,w[S]?w[S].addeq(T):w[S]=T}}for(var M in m){var C=m[M],E=C.get_length();if(E>0){if(h=C.unit(),.005>(E*=this.NapeConst.FORCE_RATIO))continue;var I=this.getArrowView();t.addChild(I),I.draw(E,e.position,h,"F")}}var D=e.rollingImpulse();for(var B in w){var j=w[B],R=j.get_length()+Math.abs(D);if(R>0){if(0===(h=j.get_length()>0?j.unit():0))continue;if(.005>(R*=this.NapeConst.FORCE_RATIO))continue;var L=this.getArrowView();t.addChild(L),L.draw(R,e.position,h,"f")}}var A=new PIXI.Graphics;A.beginFill(16711680),A.drawCircle(e.posx,e.posy,3),A.endFill(),t.addChild(A)}},{key:"getArrowView",value:function(){return this.config.main.cachePool.popThreeClass("ForceArrow",u["default"],this.config)}},{key:"graphicsRect",value:function(t,e){"start"==e[0].step&&this.clearLine(t),t.beginFill(e[1].color,e[1].alpha),t.drawRect(e[2].x,e[2].y,e[2].width,e[2].height),t.endFill()}},{key:"addText",value:function(t,e){var i=this.config.main.cachePool.popText(e[1].text+"");t.addChild(i),(0,h.forEach)(e[1],function(t,e){i[e]=t}),i.pivot.x=.5*i.width,i.pivot.y=.5*i.height}},{key:"graphicsCircle",value:function(t,e){"start"==e[0].step&&this.clearLine(t),t.beginFill(e[1].color,e[1].alpha),t.drawCircle(e[2].x,e[2].y,e[2].radius),t.endFill()}},{key:"graphicsWhitePenLight",value:function(t,e){for(var i=e[0].list;t.children.length>0;){this.config.main.cachePool.pushGraphic(t.removeChildAt(0))}if(i.length>0){var n=i[0][1];if("0x000000"!==n.color&&!this.globalConfig.LIGHT_DIS_VISIBLE){var o=this.config.main.cachePool.popGraphic();o.lineStyle(n.thin,n.color,0),o.beginFill(n.color,n.alpha);for(var r=0;i.length>r;r++){var a=i[r];o.moveTo(a[2].p1.x,a[2].p1.y),o.lineTo(a[2].p2.x,a[2].p2.y),o.lineTo(a[2].p3.x,a[2].p3.y),o.lineTo(a[2].p4.x,a[2].p4.y),o.lineTo(a[2].p1.x,a[2].p1.y)}o.alpha=n.alpha>.9?.9:osytleobj.alpha,o.blendMode=PIXI.BLEND_MODES.SCREEN,t.addChild(o)}}}},{key:"graphicsLine",value:function(t,e){"start"==e[0].step&&this.clearLine(t);var i=0;for(i=1;e.length>i;i++)"lineStyle"==e[i].type?t.lineStyle(e[i].thin,e[i].color,e[i].alpha):"beginFill"==e[i].type?t.beginFill(e[i].color,e[i].alpha):"endFill"==e[i].type?t.endFill():"moveTo"==e[i].type?t.moveTo(e[i].line_x,e[i].line_y):"lineTo"==e[i].type?t.lineTo(e[i].line_x,e[i].line_y):"curveTo"==e[i].type&&t.quadraticCurveTo(e[i].cpX,e[i].cpY,e[i].toX,e[i].toY)}},{key:"getShader",value:function(){return new PIXI.AbstractFilter(null,"precision mediump float;\n\n            void main(void){\n            gl_FragColor = vec4(1,1,1,1.0);\n            }",{})}}]),e}(PIXI.Container)},557:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0,e["default"]=function o(){n(this,o),this.EARTH_GRAVITY=9.8,this.NB_WORLD_GRAVITY_PER_N=2e3/this.EARTH_GRAVITY,this.DEFAULT_GRAVITY=this.NB_WORLD_GRAVITY_PER_N*this.EARTH_GRAVITY,this.FORCE_SCLAE=.03*this.EARTH_GRAVITY,this.MASS_SCALE=.001,this.k5n=1/33.3333321566,this.FORCE_RATIO=.00029409801384184414,this.K_VELOCITY=1833/10.78,this.STATICFRICTION_SCALE=.5,this.BODY_COLOR=52479,this.MIN_DISTANCE=10,this.LITTLE_RADIUS=20,this.WORLD_ANGULAR_DRAG=.1,this.WORLD_LINEAR_DRAG=.1,this.ROPE_LENGTH=50,this.ROPE_LENGTH_SCLAE=.85,this.RECT_MIN_WIDTH=4*this.SCALE_SPACE,this.RECT_MAX_WIDTH=300*this.SCALE_SPACE,this.DRAG_MAX_FORCE=1e7,this.DRAG_FORCE_PER_PIXEL=this.DRAG_MAX_FORCE/250,this.SCALE_SPACE=3,this.SCALE_PAPER_SPACE=3.342,this.PAPER_VALUE_FACTOR=.953,this.SCALE_VELOCITY=.031806615776081744,this.handJoint=null}},558:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(1),l=i(559),u=n(l),c=i(571),d=n(c),f=i(564),p=n(f),y=i(556),g=n(y),v=i(454),_=n(v),b=i(601),m=n(b),w=i(604),O=n(w),x=i(489),P=n(x),S=i(603),k=n(S),T=void 0,M=void 0,C=void 0,E=function(t){function e(t,i){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.config=t,n.mecMain=i,T=t.main.phy.nape,M=T.NbSpace,C=T.geom.Vec2,n.MechanicsPopTool=t.MechanicsPopTool,n.MouseManager=t.MouseManager,n.globalConfig=t.globalConfig,n.diyClass=new m["default"],n.NapeConst=i.NapeConst,n.ToolStatusStr=i.ToolStatusStr,n.loadstart=!1,n.isactive=!0,n.timeStep=1/60,n.velocityIterations=40,n.positionIterations=40,n.floorDat=null,n.floor=null,n.tmpMechData=[],n.space=null,n.touchManager=null,n.groupManager=new O["default"](T),n.gravity=new C(0,n.NapeConst.DEFAULT_GRAVITY),n.viewSync=null,n.uidMap={},n.enabledDeviceGravity=!1,n.timerInd=0,n.openAirRes=!1,n.grC=new g["default"](t,i),n.coor=null,n._play=!0,n.wallArr=[],n.hockCtrol=new k["default"](t),n}return a(e,t),s(e,[{key:"init",value:function(){this.transformManager=new P["default"](this.config),this.space=new M(this.gravity),this.space.get_userData().napeEngine=this,this.space.get_userData().handbodys=new T.constraint.ConstraintList,this.mecMain.JointUtil.space=this.space,this.changeAirResistance(this.openAirRes),this.hockCtrol.body.set_space(this.space),this.viewSync=new u["default"](this.config,this.mecMain),this.touchManager=new p["default"](this.config,this.mecMain),this.touchManager.registerManager(),this.globalConfig.main.drawStack.addChild(this.grC),this.createWall(),this.globalConfig.DEBUG&&(T.nbdebug=!0)}},{key:"dispose",value:function(){this.space.get_userData().napeEngine=null,this.floor.removed(),this.viewSync.dispose(),this.touchManager.dispose(),this.transformManager.dispose(),this.mecMain.JointUtil.space=null,this.config=null,this.mecMain=null,this.MechanicsPopTool=null,this.MouseManager=null,this.globalConfig=null,this.NapeConst=null,this.ToolStatusStr=null}},{key:"setActive",value:function(t){t?(this.isactive||this.touchManager.initTouch(),this.isactive=!0):(this.isactive=!1,this.touchManager.removeTouch(),T.util.Debug.clearObjectPools()),this.setTouchManager(this.config.MechanicsPopTool.DRAG)}},{key:"getAllMechData",value:function(){var t=this.globalConfig.main.viewStack,e=t.children.length,i=void 0;for(this.tmpMechData=[],i=0;e>i;i++){var n=t.getChildAt(i),o=n.component;o&&o.isMechanics&&this.tmpMechData.push({tar:o,dat:o.getData()})}}},{key:"changeAirResistance",value:function(t){this.openAirRes=t,t?(this.space.set_worldAngularDrag(.1),this.space.set_worldLinearDrag(.1)):(this.space.set_worldAngularDrag(0),this.space.set_worldLinearDrag(0))}},{key:"update",value:function(){if(this.dispatchEvent(_["default"].WORLD_UPDATE),this._play){this.space.get_userData().handbodys.foreach(function(t){if(!t.userData.notdragslow){var e=t.get_angularVel();.01>Math.abs(e)&&(e=0),t.set_angularVel(.2*e)}}),this.hockCtrol.updateShapes(),this.space.step(this.timeStep,this.velocityIterations,this.positionIterations),this.timerInd++,this.dispatchEvent(_["default"].WORLD_TIME_CHANGE)}}},{key:"sensorEnabledWall",value:function(){this.floor.body.sensorEnabled(0>=arguments.length||arguments[0]===undefined||arguments[0])}},{key:"moveWall",value:function(t,e){this.floor.body.set_position(C.get(t,e))}},{key:"createWall",value:function(){var t=new d["default"](this.config);this.floor=t,this.globalConfig.main.otherContainer.addChild(t),t.initWall(),this.floorDat=[t.boxWidth,t.wallWidth],this.wallArr=[t.body]}},{key:"resetWall",value:function(){this.globalConfig.main.otherContainer.removeChild(this.floor);var t=new d["default"](this.config);this.floor=t,this.globalConfig.main.otherContainer.addChild(t),t.initWall(),this.floorDat=[t.boxWidth,t.wallWidth],this.wallArr=[t.body]}},{key:"hideFloor",value:function(t){this.floor.floor.visible=!t}},{key:"groupManager",value:function(){return this.groupManager}},{key:"getGravity",value:function(){return this.gravity.get_y()/this.NapeConst.DEFAULT_GRAVITY*this.NapeConst.EARTH_GRAVITY}},{key:"setGravity",value:function(t){var e=t*this.NapeConst.DEFAULT_GRAVITY/this.NapeConst.EARTH_GRAVITY;this.gravity.set_y(e),this.space.get_gravity().set_y(e)}},{key:"getNapeTimer",value:function(){return Math.floor(this.timerInd*this.timeStep*1e3*1.2)}},{key:"getTouchManager",value:function(){return this.touchManager}},{key:"keyBoardChangeTouchState",value:function(t){var e={68:this.ToolStatusStr.DRAG,67:this.ToolStatusStr.CIRCLE,82:this.ToolStatusStr.RECT,83:this.ToolStatusStr.SLICE,80:this.ToolStatusStr.SPRING,77:this.ToolStatusStr.MOVE,70:this.ToolStatusStr.FIXED,66:this.ToolStatusStr.BEARING,79:this.ToolStatusStr.ROPE,84:this.ToolStatusStr.THRUSTER,81:this.ToolStatusStr.ROTA,76:this.ToolStatusStr.POLY,71:this.ToolStatusStr.GEAR};if(112===t)this.globalConfig.DEBUG=!this.globalConfig.DEBUG;else if(e[t]){var i=this.setTouchManager(e[t]);i&&this.globalConfig.main.keyboardChangeStatus(this.touchManager.getCurrentToolStatus())}}},{key:"changeMouseCur",value:function(t){var e={};e[this.MechanicsPopTool.DRAG]="tuozhuai",e[this.MechanicsPopTool.MOVE]="yidong",e[this.MechanicsPopTool.DRAW_RECT]="rect",e[this.MechanicsPopTool.DRAW_CIRCLE]="circle",e[this.MechanicsPopTool.DRAW_GEAR]="chilun",e[this.MechanicsPopTool.DRAW_ZIDINGYI]="ziyouhuizhi",e[this.MechanicsPopTool.TOOL_SPRING]="spring",e[this.MechanicsPopTool.TOOL_ZHOUCHENG]="motor",e[this.MechanicsPopTool.TOOL_GUDING]="guding",e[this.MechanicsPopTool.TOOL_PUSH]="force",e[this.MechanicsPopTool.TOOL_KNIFE]="cutting",e[this.MechanicsPopTool.TOOL_ROTATE]="rotatebtn",e[this.MechanicsPopTool.DRAW_LAND]="shengzi",t&&e[t]&&(this.globalConfig.main.mouseManager.changeMouseStatusName(e[t],!0,this.globalConfig.main.view,!1),t===this.MechanicsPopTool.MOVE||t===this.MechanicsPopTool.DRAG?(this.MouseManager.lockMouse(!1),this.mecMain._isInToolState=!1):(this.MouseManager.lockMouse(!0),this.mecMain._isInToolState=!0))}},{key:"setTouchManager",value:function(t){return t!==this.touchManager.getCurrentToolStatus()&&(this.touchManager.changeTouchState(t),this.globalConfig.main.view.selectionLayer.cannotSelect(this.touchManager.getCurrentToolStatus()===this.ToolStatusStr.DRAG||this.touchManager.getCurrentToolStatus()===this.ToolStatusStr.MOVE?!1:!0),this.changeMouseCur(t),!0)}},{key:"getFloorY",value:function(){var t=this.floor.getfloorY();return this.globalConfig.main.viewStack.toLocal(new h.Point(0,t),this.globalConfig.main.view).y}},{key:"play",get:function(){return this._play},set:function(t){this._play=t}}]),e}(PIXI.EventEmitter);E.prototype.addEventListener=E.prototype.on,E.prototype.removeEventListener=E.prototype.off,E.prototype.dispatchEvent=E.prototype.emit,e["default"]=E},559:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),s=i(617),h=n(s),l=i(451),u=n(l);e["default"]=function(){function t(e,i){o(this,t),this.globalConfig=e.globalConfig,this.napeEngine=i.napeEngine,this.debugDraw=new h["default"](e,this.napeEngine),this.globalConfig.main.view.addChild(this.debugDraw)}return r(t,[{key:"dispose",value:function(){this.debugDraw.removed(),this.globalConfig=null,this.napeEngine=null}},{key:"update",value:function(){for(var t=this.globalConfig.main.getEquipmentArr(!0),e=0;t.length>e;e++){var i=t[e];!(i instanceof u["default"])&&i.update&&i.update()}this.napeEngine.update(),this.globalConfig.DEBUG?this.debugDraw.draw():this.debugDraw.clear();var n=this.napeEngine.space.constraints,o=this.napeEngine.space.bodies,r=this.napeEngine.space.get_compounds();this.everyOneBody(o);for(var a=0;a<r.get_length();a++){var s=r.at(a);this.everyOneBody(s.get_bodies()),this.updateJoint(s.get_constraints())}this.updateJoint(n),this.updateEnd(o)}},{key:"updateEnd",value:function(t){for(var e=0;e<t.get_length();e++){var i=t.at(e);if(i){var n=i.userData.view;n&&n.updateEnd&&n.updateEnd()}}}},{key:"updateJoint",value:function(t){for(var e=0;e<t.get_length();e++){var i=t.at(e);if(i.userData){var n=i.userData.hockshape;if(n){var o=1;isNaN(i.userData.hocknum)||(o=i.userData.hocknum);n.set_localCOM(i["get_body"+o]().localPointToWorld(i["get_anchor"+o]()))}i.userData.view&&i.userData.view.update&&i.userData.view.update()}i.updateStep&&i.updateStep()}}},{key:"everyOneBody",value:function(t){for(var e=0;e<t.get_length();e++){this.updateBody(t.at(e))}}},{key:"updateBody",value:function(t){if(t){var e=t.userData.view;if(e)if(t.userData.coordinateField){var i=t.userData.coordinateField,n=void 0;try{if(!(n=i.toLocal(new a.Point(t.posx,t.posy),this.globalConfig.main.view)))return}catch(r){return}if(e.x=n.x,e.y=n.y,e.rotation=t.rotation,t.userData.bindupdate){var o=t.userData.bindupdate.field;t.userData.bindupdate.func.call(o)}}else e.x=t.posx,e.y=t.posy,e.rotation=t.rotation,e.update&&e.update()}}}]),t}()},560:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1);e["default"]=function(){function t(e,i,o){n(this,t),this.globalConfig=e.globalConfig,this.rotarget=i,this.mcTrigger=i.rotaSP,this.body=i.body,this.updatefunc=o,this.downRota=0,this.downAng=0,this.init()}return o(t,[{key:"init",value:function(){this.mcTrigger.addEventListener(TouchEvent.TOUCH_BEGIN,this.addRotateTool_touchHandle),this.mcTrigger._this=this}},{key:"dispose",value:function(){this.rotarget=null,this.mcTrigger&&(this.mcTrigger.removeEventListener(TouchEvent.TOUCH_BEGIN,this.addRotateTool_touchHandle),this.mcTrigger.removeEventListener(TouchEvent.TOUCH_MOVE,this.addRotateTool_touchHandle),this.mcTrigger.removeEventListener(TouchEvent.TOUCH_END,this.addRotateTool_touchHandle),this.mcTrigger.removeEventListener(TouchEvent.TOUCH_END_OUTSIDE,this.addRotateTool_touchHandle),this.mcTrigger._this=null),this.mcTrigger=null,this.body=null,this.updatefunc=null}},{key:"addRotateTool_touchHandle",value:function(t,e){var i=this._this||e,n=new r.Point(t.data.global.x,t.data.global.y),o=new r.Point(i.body.posx,i.body.posy);if(r.M.touchIsType(t.type,TouchEvent.TOUCH_BEGIN))downRota=i.body.rotation,i.rotation=downRota,downAng=Math.atan2(n.y-o.y,n.x-o.x),i.mcTrigger.addEventListener(TouchEvent.TOUCH_MOVE,i.addRotateTool_touchHandle),i.mcTrigger.addEventListener(TouchEvent.TOUCH_END,i.addRotateTool_touchHandle),i.mcTrigger.addEventListener(TouchEvent.TOUCH_END_OUTSIDE,i.addRotateTool_touchHandle),this.globalConfig.hData.clearTimeHide.call(this.globalConfig.hData);else if(r.M.touchIsType(t.type,TouchEvent.TOUCH_MOVE)){var a=void 0;a=e?Math.atan2(n.y-o.y,n.x-o.x):Math.atan2(n.y-o.y,n.x-o.x)+.5*Math.PI;var s=a-i.downRota+i.downAng;i.updatefunc.call(i.rotarget,null,s,t)}else(r.M.touchIsType(t.type,TouchEvent.TOUCH_END)||r.M.touchIsType(t.type,TouchEvent.TOUCH_END_OUTSIDE))&&(i.rotarget.cannotSystemDrag=!0,i.mcTrigger.removeEventListener(TouchEvent.TOUCH_MOVE,i.addRotateTool_touchHandle),i.mcTrigger.removeEventListener(TouchEvent.TOUCH_END,i.addRotateTool_touchHandle),i.mcTrigger.removeEventListener(TouchEvent.TOUCH_END_OUTSIDE,i.addRotateTool_touchHandle))}}]),t}()},561:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(500),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.moduleMain.phy.nape,y=p.geom.Vec2,i.singlePoint=!0,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchTabUid||(this.touchTabUid=l.M.addTouch(this.var_dis,{tab:i.touchTab,isAddDB:!1},this))}else this.touchTabUid&&l.M.removeTouch(this.var_dis,this.touchTabUid),this.touchTabUid=null}},{key:"touchTab",value:function(t){var e=new y(t.x,t.y),i=this.space.bodiesUnderPoint(e);if(i.filter(function(t){return!t.userData||!t.userData.isnbequ}),0!=i.length){var n=this.BodyUtil.getTopBodyFormBodyList(i);if(n&&n.userData.view&&!n.userData.view.isMechaTool){this.cancelMecSelected(t);var o=this.BodyUtil.getTopBodyFormBodyList(i,[n]);o||(o=this.space.world),o!=this.space.world&&this.adsorbToCom(o,t,50),this.adsorbToCom(n,t,50);var r=new f["default"](this.config,n,o);this.addEquipmentChild(r,t),this.initScale(r),this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.config.moduleMain.napeEngine.transformManager.hide(),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"bearing"}),this.globalConfig.main.isPlay||(r.setSelected(!0),r.freshLibPan())}}}}]),e}(c["default"])},562:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function P(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:P(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(449),f=n(d),p=i(509),y=n(p),g=i(508),v=n(g),_=i(13),b=void 0,m=void 0,w=void 0,O=void 0,x=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return b=t.moduleMain.phy.nape,O=b.NbPivotJoint,m=b.geom.Vec2,w=b.phys.BodyType,x=b.phys.InertiaMode,i.seBody=null,i.handJoint=null,i.var_originDat=null,i.isClick=!1,i.hithockCtrl=null,i.oldP=null,i.cannotStart=!1,i.rotaTool=null,i.moveTool=null,i.dragtranslate=!1,i.prevP=null,i.offsetP=new l.Point,i.multiMove=!1,i.selfDragManager=!1,i}return a(e,t),s(e,[{key:"setActive",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active?(this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:this.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:this.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:this.func_touchEnd,isAddDB:!1},this))):(this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=null,this.touchMoveUid=null,this.touchEndUid=null)}},{key:"func_touchBegin",value:function(t){if(this.main.activeModule&&this.main.activeModule.napeEngine.play){if(this.hithockCtrl=null,this.prevP=t,this.oldP=t,this.cannotStart)return void(this.cannotStart=!1);if(this.seBody=this.getDragBodyUnderPoit(t)){if(this.seBody.userData.dragManager)return void(this.seBody=null);var e=this.seBody.userData.view;if(e&&!0===e.selfDragManager&&!0===e.checkDrag(t))return e.dragToolBegin(t),void(this.selfDragManager=!0);if(this.seBody.userData.view&&this.seBody.userData.view.findRotaShape){if(this.seBody.userData.view.findRotaShape(t))return this.rotaTool=new y["default"](this.config),void this.rotaTool.bindStartBody(this.seBody,t)}if(this.seBody&&this.seBody.userData&&this.seBody.userData.dragTomoveTool)return this.moveTool=new v["default"](this.config),this.moveTool.init(this.var_dis,this.space),void this.moveTool.moveBody(this.seBody,t);if(this.seBody&&this.seBody.userData&&this.seBody.userData.dragtranslate){if(this.dragtranslate=!0,this.seBody.userData.dragManager=this,e){var i={data:{global:t}};e.dispatchEvent(f["default"].BEGIN,i)}}else{this.checknotDragInnerShape(t)?this.seBody=null:(this.toDragJoint(this.seBody,t),this.main.dispatchEvent(_.PHY_EVENTS.BLACK_TOUCH_STOP))}}}}},{key:"checknotDragInnerShape",value:function(t){var e=this.seBody.get_shapes(),i=!1;return e.foreach(function(e){if(!i){var n=e.get_userData();n&&!0===n.noDrag&&e.contains(m.get(t.x,t.y))&&(i=!0)}}),i}},{key:"getDragBodyUnderPoit",value:function(t){for(var e=m.get(t.x,t.y),i=this.space.shapesUnderPoint(e),n=i.get_length(),o=0;n>o;o++){var r=i.at(o);if(1==r.get_userData().firstDrag)return r.get_body()}var a=this.space.bodiesUnderPoint(e),s=[];return a.filter(function(t){if(t.isStatic())return!1;if(t.userData.noDrag)return!1;var e=t.userData.view;return!!e&&(!(!e.touchEnabled&&!t.userData.coordinateField)&&(s.push(t),!0))}),0===s.length?null:(s.sort(function(t,e){return e.userData.dragLevel-t.userData.dragLevel}),s[0])}},{key:"toDragJoint",value:function(t,e){if(this.seBody=t,t){t.isKinematic()&&(this.var_originDat={},t.noallowRotation=!0),this.oldP=e,this.isClick=!0;var i=t.worldPointToLocal(m.get(e.x,e.y));t.set_type(w.get_DYNAMIC());var n=!1,o=!1;t.userData&&1==t.userData.weldDrag&&(n=!0),t.userData&&1==t.userData.pivotDrag&&(o=!0);var r=t.get_inertia();o||!n&&!this.var_originDat?(this.handJoint=new O(this.space.world,t,m.get(e.x,e.y),i),this.seBody.userData.handJointStiff?this.handJoint.stiff=!0:(this.handJoint.stiff=!1,this.seBody.userData.handJointFrequency&&(this.handJoint.frequency=this.seBody.userData.handJointFrequency)),this.seBody.userData.coerceAB&&(this.handJoint.coerceAB=!0,this.handJoint.aTob=!1),this.handJoint.damping=0,this.handJoint.ignore=!0):this.handJoint=this.JointUtil.createWeldJoint(this.space.world,t,m.get(e.x,e.y),m.get(e.x,e.y)),t.set_inertia(10*r),this.space.constraints.add(this.handJoint);if(this.space.get_userData().handbodys.add(t),this.hithockCtrl=this.hitHockshape(e))return void this.handJoint.set_active(!1);t.userData.dragManager=this;var a=t.userData.view;if(a){a.ismecJoint&&a.istoolMove&&(this.handJoint.active=!1);a.dispatchEvent(f["default"].BEGIN,{data:{global:e}})}}}},{key:"func_touchMove",value:function(t){if(this.seBody&&this.seBody.userData&&!this.seBody.isdestory){var e=this.seBody.userData.view;if(e&&!0===this.selfDragManager)return void e.dragToolMove(t);if(this.rotaTool)return void this.rotaTool.func_touchMove(t);if(this.moveTool)return void this.moveTool.func_touchMove(t);if(this.seBody.userData.noDrag)return void this.func_touchEnd(t);var i=l.Point.distance(this.oldP,t);if(this.hithockCtrl&&50<i){var n=this.hithockCtrl,o=n.get_worldCOM().copy();this.func_touchEnd(t);var r=this.napeEngine.hockCtrol.breakJointToDrag(n);if(r){var a=r.get_position();r.set_position(m.get(a.get_x()+t.x-o.get_x(),a.get_y()+t.y-o.get_y())),this.toDragJoint(r,t)}}else{if(this.isClick&&i>20&&(this.isClick=!1),e&&e.hasOwnProperty("propertyChange")?e.propertyChange=!0:e&&e.root&&e.root.hasOwnProperty("propertyChange")&&(e.root.propertyChange=!0),this.dragtranslate){var s=t.x-this.prevP.x,h=t.y-this.prevP.y;if(Math.abs(h>1e3))return;e.translateMove(s,h),this.prevP=t;return void e.dispatchEvent(f["default"].MOVE,{data:{global:t}})}if(this.handJoint.anchor1.set(m.get(t.x,t.y)),e){e.dispatchEvent(f["default"].MOVE,{data:{global:t}})}}}}},{key:"func_touchEnd",value:function(t,e){if(this.hithockCtrl=null,this.seBody&&this.seBody.userData){var i=this.seBody.userData.view;if(i&&!0===this.selfDragManager)return void i.dragToolEnd(t);if(this.seBody.userData&&delete this.seBody.userData.dragManager,this.rotaTool)return this.rotaTool.func_touchEnd(t),this.rotaTool=null,void(this.seBody=null);if(this.moveTool)return this.moveTool.func_touchEnd(t),this.moveTool.dispose(),this.moveTool=null,void(this.seBody=null);if(this.dragtranslate){i.translateMove(t.x-this.prevP.x,t.y-this.prevP.y,!0);return void i.dispatchEvent(f["default"].END,{data:{global:t}})}if(this.handJoint&&(this.space.constraints.remove(this.handJoint),this.handJoint=null),null!=this.var_originDat&&(this.seBody.noallowRotation=!1,this.seBody.set_type(w.get_KINEMATIC()),this.BodyUtil.frezzBody(this.seBody),this.var_originDat=null),this.seBody){var n=this.space.get_userData();if(n.handbodys.has(this.seBody)&&n.handbodys.remove(this.seBody),this.seBody.isdestory)return;this.seBody.set_inertiaMode(x.get_DEFAULT());var o=!1;if(this.isClick&&(o=this.clickHock(t)),this.seBody.userData&&i&&t){var r={data:{global:t}};this.isClick&&(i.dispatchEvent(f["default"].CLICK,r),!0===i.useDragSetCurElec&&this.main.setCurElec(i,!0)),!1===o&&i.dispatchEvent(f["default"].END,r)}this.isClick=!1,this.seBody=null}}}},{key:"hitHockshape",value:function(t){var e=this.napeEngine.hockCtrol.body,i=e.get_shapes(),n=null;return i.foreach(function(e){var i=e.get_userData().hock;!n&&i&&e.contains(m.get(t.x,t.y))&&(n=e)}),n}},{key:"clickHock",value:function(t){var e=this,i=this.napeEngine.hockCtrol.body,n=i.get_shapes(),o=!1;return n.foreach(function(i){var n=i.get_userData().hock;!o&&n&&i.contains(m.get(t.x,t.y))&&(e.napeEngine.hockCtrol.removeJointShape(i),n.dragToolClick(),o=!0)}),o}}]),e}(c["default"])},563:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(512),f=n(d),p=i(474),y=n(p),g=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.angle=0,i.num=0,i.lineColor=11184810,i.var_edgeColor=11184810,i.lineThin=2,i.var_pointArr=[],i.graphics=new PIXI.Graphics,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.func_dispose(),this.isstart=!0,this.var_center=new l.Point(t.x,t.y),this.thin=6/this.getGlobalScale(),this.skinColor=y["default"].getColor();var e=[];e.push({option:"addElement",target:this.graphics,params:{x:0,y:0}}),this.func_dispatchGraphic(e),this.config.moduleMain.napeEngine.transformManager.hide()}},{key:"func_touchMove",value:function(t){this.isstart&&(this.r=l.Point.distance(this.var_center,t),this.angle=Math.atan2(t.y-this.var_center.y,t.x-this.var_center.x),this.func_refreshGrc())}},{key:"func_refreshGrc",value:function(){this.graphics.clear(),this.num=this.func_getNum(this.r),this.var_pointArr=this.func_getGearPoints(this.r,this.angle,this.num);var t=this.var_pointArr.length;if(t>0){this.graphics.lineStyle(this.thin,this.lineColor,1),this.graphics.beginFill(this.skinColor,1);for(var e=0;t>e;e++){var i=this.var_pointArr[e];0==e?this.graphics.moveTo(this.var_center.x+i.x,this.var_center.y+i.y):this.graphics.lineTo(this.var_center.x+i.x,this.var_center.y+i.y)}this.graphics.endFill()}}},{key:"func_getGearPoints",value:function(t,e,i){var n=[];if(t>=5){var o=i;3>o&&(o=3);var r=5*o,a=18;o>6||(a=11+o);for(var s=void 0,h=r+a,u=[{f:1/8,rad:r},{f:.4,rad:h},{f:.6,rad:h},{f:7/8,rad:r}],c=0;o>c;c++)for(var d=2*Math.PI/o,f=d*c,p=0;u.length>p;p++){var y=e+f+d*u[p].f,g=u[p].rad;s=new l.Point(Math.cos(y)*g,Math.sin(y)*g),n.push(s)}}return n}},{key:"func_getNum",value:function(t){return Math.ceil((t-5)/5)+2}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,this.func_dispose(),this.graphics.clear(),!e)){if(this.var_pointArr.length>3){var i=new f["default"](this.config,this.r,this.angle,0,this.skinColor);this.addEquipmentChild(i,this.var_center),this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"gear"}),this.config.moduleMain.napeEngine.play||(i.setSelected(!0),i.freshLibPan())}this.r=0}}}]),e}(c["default"]);g.preventDraw=!0,e["default"]=g},564:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),s=i(562),h=n(s),l=i(605),u=n(l),c=i(566),d=n(c),f=i(607),p=n(f),y=i(563),g=n(y),v=i(508),_=n(v),b=i(606),m=n(b),w=i(561),O=n(w),x=i(569),P=n(x),S=i(570),k=n(S),T=i(565),M=(n(T),i(544)),C=n(M),E=i(567),I=n(E),D=i(509),B=n(D),j=i(568),R=n(j),L=void 0,A=void 0;e["default"]=function(){function t(e,i){o(this,t),this.config=e,L=e.main.phy.nape,A=L.geom.Vec2,this.BodyUtil=i.BodyUtil,this.globalConfig=e.globalConfig,this.ToolStatusStr=i.ToolStatusStr,this.space=i.napeEngine.space,this.currentType=null,this.toolType=null,this.currentTool=null,this.map={},this.dis=this.globalConfig.main.canvas,this.stage=this.globalConfig.main.stage,this.view=this.globalConfig.main.view,this.toolMap={},this.penpolygon=null,this.enAbled=!0,this.ngZone=i.main.ngZone}return r(t,[{key:"dispose",value:function(){this.removeTouch(),this.config=null,this.BodyUtil=null,this.globalConfig=null,this.ToolStatusStr=null,this.space=null,this.currentTool=null,this.dis=null,this.stage=null,this.view=null,this.penpolygon=null}},{key:"registerManager",value:function(){this.map[this.ToolStatusStr.DRAG]=h["default"],this.map[this.ToolStatusStr.CIRCLE]=u["default"],this.map[this.ToolStatusStr.RECT]=d["default"],this.map[this.ToolStatusStr.TRIANGLE]=p["default"],this.map[this.ToolStatusStr.GEAR]=g["default"],this.map[this.ToolStatusStr.MOVE]=_["default"],this.map[this.ToolStatusStr.FIXED]=m["default"],this.map[this.ToolStatusStr.BEARING]=O["default"],this.map[this.ToolStatusStr.SPRING]=P["default"],this.map[this.ToolStatusStr.THRUSTER]=k["default"],this.map[this.ToolStatusStr.POLY]=C["default"],this.map[this.ToolStatusStr.ROPE]=I["default"],this.map[this.ToolStatusStr.ROTA]=B["default"],this.map[this.ToolStatusStr.SLICE]=R["default"],this.initTouch(),this.changeTouchState(this.ToolStatusStr.MOVE)}},{key:"removeTouch",value:function(){this.var_touchUid&&(a.M.removeDomTouch(this._$dis,this.var_touchUid),this.var_touchUid=null)}},{key:"initTouch",value:function(){var t=this;this.ngZone?this.ngZone.runOutsideAngular(function(){t._$dis=$(t.dis),t.var_touchUid=a.M.addDomTouch(t._$dis,{begin:t.touchBegin,move:t.touchMove,end:t.touchEnd,tab:t.touchTab,isAddDB:!0},t,{canTab:!0})}):(this._$dis=$(this.dis),this.var_touchUid=a.M.addDomTouch(this._$dis,{begin:this.touchBegin,move:this.touchMove,end:this.touchEnd,tab:this.touchTab,isAddDB:!0},this,{canTab:!0}))}},{key:"doubleTab",value:function(){(evt.touches||0===evt.button)&&this.toolMap[0]&&this.toolMap[0].func_touchTab()}},{key:"touchTab",value:function(t){var e=new a.Point(0,0),i=void 0,n=void 0;if(t.touches){var o=t.changedTouches[0];i=o.clientX,n=o.clientY}else i=t.clientX,n=t.clientY;if(this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(e,i,n),e=this.view.toLocal(e,this.stage),t.touches||0===t.button)if(this.toolType===this.ToolStatusStr.POLY){if(this.toolType!==this.ToolStatusStr.POLY)return;this.penpolygon||(this.penpolygon=new C["default"](this.config),this.penpolygon.init(this.dis,this.space)),this.penpolygon.touchTab(e);var r=this.BodyUtil.getSelectBodyUnderPoint(this.space,e);if(r){var s=r.userData.view;s.setSelected(!1)}}else for(var h in this.toolMap){var l=this.toolMap[h];l.touchTab&&l.touchTab(e)}}},{key:"touchEnd",value:function(t,e){if(t.touches||0===t.button)if(t&&t.changedTouches)for(var i=0;t.changedTouches.length>i;i++){var n=t.changedTouches[i],o=n.identifier;if(this.toolMap[o]){var r=new a.Point(0,0);this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(r,n.clientX,n.clientY),r=this.view.toLocal(r,this.stage),this.toolMap[o].func_touchEnd(r),this.toolMap[o].dispose(),delete this.toolMap[o]}}else if(this.toolMap&&this.toolMap[0]){var s=new a.Point(0,0);this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(s,t.clientX,t.clientY),s=this.view.toLocal(s,this.stage),this.toolMap[0].func_touchEnd(s),this.toolMap[0].singlePoint||(this.toolMap[0].dispose(),delete this.toolMap[0])}}},{key:"touchMove",value:function(t){if((t.touches||0==t.button)&&!this.config.main.multiMove){var e=new a.Point(0,0);if(t.touches){var i=void 0;for(i=0;t.changedTouches.length>i;i++){var n=t.changedTouches[i],o=n.identifier;if(this.toolMap[o]){this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(e,n.clientX,n.clientY);this.toolMap[o].func_touchMove(this.view.toLocal(e,this.stage))}}}else this.toolMap&&this.toolMap[0]&&(this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(e,t.clientX,t.clientY),e=this.view.toLocal(e,this.stage),this.toolMap[0].func_touchMove(e))}}},{key:"touchBegin",value:function(t){if(t.touches||0==t.button){var e=this.currentTool;if(t.touches){var i=void 0;for(i=0;t.touches.length>i;i++){var n=t.touches[i],o=n.identifier;if(!this.toolMap[o]){var r=new a.Point(0,0);this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(r,n.clientX,n.clientY);var s=this.view.toLocal(r,this.stage);if(this.moveSelectedBody(o,s))continue;this.createToolManager(t,e,o,s)}}}else{if(!this.toolMap)return;var h=new a.Point(0,0);if(this.globalConfig.main.renderer.plugins.interaction.mapPositionToPoint(h,t.clientX,t.clientY),h=this.view.toLocal(h,this.stage),this.toolMap[0]&&this.touchEnd.call(this,t,!0),this.toolMap[0]&&this.toolMap[0].singlePoint&&(this.toolMap[0]instanceof e||(this.toolMap[0].func_touchEnd&&this.toolMap[0].func_touchEnd(),delete this.toolMap[0])),this.moveSelectedBody(0,h))return;this.toolMap[0]&&this.toolMap[0].singlePoint||this.createToolManager(t,e,0,h)}}}},{key:"moveSelectedBody",value:function(t,e){var i=this.BodyUtil.getSelectBodyUnderPoint(this.space,e);return!!i&&(this.toolMap[t]=new _["default"](this.config),this.toolMap[t].init(this.dis,this.space),this.toolMap[t].moveBody(i,e),!0)}},{key:"createToolManager",value:function(t,e,i,n){if(!this.enAbled)return void(this.enAbled=!0);this.toolType!==this.ToolStatusStr.POLY&&(this.toolMap[i]=new e(this.config),this.toolMap[i].init(this.dis,this.space),this.toolMap[i].func_touchBegin(n))}},{key:"findDeleteTouch",value:function(t,e){var i=void 0;for(i=0;e.length>i;i++){if(function(e){var i=void 0;for(i=0;t.length>i;i++)if(t[i].identifier==e)return!1;return!0}(e[i].identifier))return e[i].identifier}}},{key:"onDomClick",value:function(t){for(var e in this.map){var i=this.map[e];i.onDomClick&&i.onDomClick(t)}for(var n in this.toolMap){var o=this.toolMap[n];o.onDomClick&&o.onDomClick(t)}this.penpolygon&&this.penpolygon.onDomClick(t)}},{key:"reset",value:function(){this.changeTouchState(this.ToolStatusStr.MOVE)}},{key:"getCurrentToolStatus",value:function(){return this.toolType}},{key:"getCurrentStatus",value:function(){return this.currentType}},{key:"changeTouchState",value:function(t){this.map[t]&&(this.currentType=this.toolType=t,this.currentTool=this.map[t],this.penpolygon&&this.penpolygon.onDomClick(null),this.config.main.freshShowHelpVideo.call(this.config.main))}}]),t}()},565:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function _(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:_(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(458),u=(n(l),i(452)),c=(n(u),i(544)),d=n(c),f=i(471),p=(n(f),i(474)),y=n(p),g=i(1),v=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.lineColor=16777215,i.lineThin=2,i.isstart=!1,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=g.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=g.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=g.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&g.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&g.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&g.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"func_init",this).call(this),this.var_lastPoint=null,this.isstart=!1}},{key:"func_touchBegin",value:function(t){this.lineThin=2/this.globalConfig.main.view.scale.x,this.var_r=0,this.skinColor=y["default"].getColor(),this.func_addPoint(t),this.isstart=!0}},{key:"func_touchMove",value:function(t){this.isstart&&(this.var_lastPoint&&10>=g.Point.distance(this.var_lastPoint,t)||(this.var_lastPoint=t,this.func_addPoint(t)))}},{key:"func_touchEnd",value:function(t,e){this.isstart&&(e||(this.n>3&&this.getMaxDis()>80&&(this.createBody(),this.globalConfig.main.dispatchEvent("phy.addEquipment")),this.func_dispose(),this.func_init()))}}]),e}(d["default"]);v.preventDraw=!0,e["default"]=v},566:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(474),f=n(d),p=i(510),y=n(p),g=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.isstart=!1,i.topLeft=null,i.skinColor=null,i.lineColor=16777215,i.var_arcColor=4605510,i.var_edgeColor=11184810,i.lineThin=2,i.shapeView=new PIXI.Graphics,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.lineThin=2/this.globalConfig.main.view.scale.x,this.skinColor=f["default"].getColor(),this.func_dispose(),this.isstart=!0,this.topLeft=new l.Point(t.x,t.y);var e=[];e.push({option:"addElement",target:this.shapeView,params:{x:0,y:0}}),this.func_dispatchGraphic(e),this.config.moduleMain.napeEngine.transformManager.hide()}},{key:"func_touchMove",value:function(t){if(this.isstart){var e=t.x-this.topLeft.x,i=t.y-this.topLeft.y;0!=e&&0!=i&&(this.shapeView.clear(),this.shapeView.lineStyle(this.lineThin,this.lineColor,1),this.shapeView.beginFill(this.skinColor,1),this.shapeView.drawRect(this.topLeft.x,this.topLeft.y,e,i),this.shapeView.endFill())}}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,this.func_dispose(),this.shapeView.clear(),!e)){var i=Math.min(t.x,this.topLeft.x),n=Math.max(t.x,this.topLeft.x),o=Math.min(t.y,this.topLeft.y),r=Math.max(t.y,this.topLeft.y),a=n-i,s=r-o;if(a>=10&&s>=10){var h=new y["default"](this.config,[a,s,this.skinColor]);this.addEquipmentChild(h,new l.Point(i+a/2,o+s/2)),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"rect"}),this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.globalConfig.main.isPlay||h.setSelected(!0)}}}}]),e}(c["default"]);g.preventDraw=!0,e["default"]=g},567:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(514),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.moduleMain.phy.nape,y=p.geom.Vec2,i.view=null,i}return a(e,t),s(e,[{key:"func_touchBegin",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"func_touchBegin",this).call(this,t),this.view=new f["default"](this.config),this.addEquipmentChild(this.view,new l.Point),this.view.fixFirstBox(this.var_vo.beginBody,this.var_vo.beginVec2)}},{key:"func_touchMove",value:function(t){this.view&&this.view.drawRope(t)}},{key:"func_touchEnd",value:function(t,e){if(!e){var i=t,n=this.space.bodiesUnderPoint(new y(i.x,i.y));n.filter(function(t){return(!t.userData||"ropeNode"!=t.userData.classType)&&(!t.userData||!t.userData.isnbequ)});var o=this.BodyUtil.getTopBodyFormBodyList(n);this.var_vo.endBody=o;var r=this.Vec2Util.pointToVec2(i);this.var_vo.endVec2=r,this.view.ropeCreateComplete(o,r),this.var_vo={},this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"rope"}),this.view.setSelected(!0)}}}]),e}(c["default"])},568:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function _(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:_(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(471),f=n(d),p=void 0,y=void 0,g=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.moduleMain.phy.nape,y=p.geom.GeomPoly,g=p.geom.Vec2,i.angle_view=new v(t),i.isstart=!1,i.selectedBody=null,i}return a(e,t),s(e,[{key:"dispose",value:function(){this.angle_view.dispose(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}},{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.isstart=!0;var e=[];e.push({option:"addElement",target:this.angle_view,params:{x:0,y:0}}),this.func_dispatchGraphic(e),this.angle_view.startDraw(t.clone()),this.selectedBody=this.config.moduleMain.napeEngine.transformManager.body}},{key:"func_touchMove",value:function(t){this.isstart&&this.angle_view.func_draw(t)}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,!e)){this.cutAtoB(this.angle_view.var_startP.clone(),t),this.selectedBody=null,this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"slice"})}}},{key:"cutAtoB",value:function(t,e){var i=this,n=this.Vec2Util.pointToVec2(t),o=this.Vec2Util.pointToVec2(e);this.angle_view.func_reset(),this.func_dispose();var r=p.geom.Ray.fromSegment(n,o);if(0!=r.get_direction().get_length()){var a=this.space.rayMultiCast(r,!1),s=[],h=[];a.foreach(function(t){if(null!=t)try{var e=t.get_shape().get_body();if(!e.userData.freeMec)return;if(e.contains(n)||e.contains(o))return;var i=s.indexOf(e);-1==i?(s.push(e),h.push([t.get_shape()])):h[i].push(t.get_shape())}catch(r){}});var l=[],u=[],c=0;for(c=0;s.length>c;c++){var d=s[c];this.selectedBody&&d===this.selectedBody&&l.push(c),u[c]=c}var f=l.length>0?l:u;for(c=0;f.length>c;c++){(function(){var t=f[c],e=s[t],r=h[t],a=i.func_sliceBody(e,n,o,r);if(0>=a.length)return"continue";var l=e.constraints,u=new p.constraint.ConstraintList;l.foreach(function(t){u.push(t)});for(var d=0;a.length>d;d++){i.createEquView(a[d],e,u)}})()}for(c=0;f.length>c;c++){var y=f[c],g=s[y];if(g.userData){var v=g.userData.view;v.removeFromFramework(v)}else this.BodyUtil.destoryBody(g)}}}},{key:"sliceShape",value:function(t,e,i,n){var o=void 0;if(t.contains(e)||t.contains(i))return null;if(t.isCircle()){var r={x:0,y:0};n=n||t.body,n&&(r.x=n.posx,r.y=n.posy),o=new y(this.Vec2Util.getWorldVec2ListFromCircle(t,r)),o.pop()}else o=new y(t.get_worldVerts());return o.cut(e,i,!0,!0)}},{key:"func_sliceGeomPoly",value:function(t,e,i){return contains.contains(e)||contains.contains(i)?[]:t.cut(e,i,!0,!0)}},{key:"func_sliceBody",value:function(t,e,i,n){var o=this.list2Arr(t.shapes),r=o.length;if(1==r){var a=o[0],s=this.sliceShape(a,e,i,t),h=[];return s&&s.foreach(function(t){h.push([t])}),h}var l=[],u=[];if(n)for(var c=0;r>c;c++){var d=o[c];if(-1==this.func_indexof(n,d)){var f=new y(d.get_worldVerts());0>this.getSideOfLine(f,e,i)?u.push(f):l.push(f)}}var p=n||o;r=p.length;for(var g=0;r>g;g++){var v=p[g],_=new y(v.get_worldVerts()),b=_.cut(e,i,!0,!0),m=this.geomPolyListGroupByLine(b,e,i);l=l.concat(m[0]),u=u.concat(m[1])}return this.func_optionMerge(l).concat(this.func_optionMerge(u))}},{key:"geomPolyListGroupByLine",value:function(t,e,i){for(var n=[],o=[],r=t.get_length(),a=0;r>a;a++){var s=t.at(a);s.cutDat=1==r?1:2,0>this.getSideOfLine(s,e,i)?o.push(s):n.push(s)}return[n,o]}},{key:"func_optionMerge",value:function(t){var e=t.length,i=void 0,n=void 0,o=void 0;if(1==e){return[[t[0]]]}var r=[];for(i=0;e>i;i++){r[i]=[];var a=t[i];for(n=0;i>n;n++){r[n][i]=r[i][n]=this.isConnected(a,t[n])}r[i][i]=!0}var s=[];for(i=0;e>i;i++)for(s[i]=[],n=0;e>n;n++)s[i][n]=r[i][n];for(o=0;e>o;o++)for(i=0;e>i;i++)for(n=0;e>n;n++)s[i][o]&&s[o][n]&&(s[i][n]=!0);var h=0,l=[];for(i=0;e>i;i++)if(l[i]===undefined||0>l[i]){for(n=0;e>n;n++)s[i][n]&&(l[n]=h);h++}var u=[];for(i=0;e>i;i++){var c=l[i],d=t[i];u[c]||(u[c]=[]),u[c].push(d)}return u}},{key:"getSideOfLine",value:function(t,e,i){var n=l.Point.vec2ToPoint(t.left()),o=l.Point.vec2ToPoint(t.right()),r=l.Point.vec2ToPoint(t.top()),a=l.M.getPoint_NeiXin(n,o,r);return l.M.checkPointOnLineLeftOrRight(a,l.Point.vec2ToPoint(e),l.Point.vec2ToPoint(i))}},{key:"isConnected",value:function(t,e){for(var i=t.backwardsIterator();i.hasNext();)for(var n=i.next(),o=e.backwardsIterator();o.hasNext();){var r=o.next();if(n.get_x()==r.get_x()&&n.get_y()==r.get_y())return!0}return!1}},{key:"poly2vecArr",value:function(t){for(var e=[],i=t.iterator();i.hasNext();){var n=i.next();e.push(new g(n.get_x(),n.get_y()))}return e}},{key:"list2Arr",value:function(t){var e=[];return t.foreach(function(t){e.push(t)}),e}},{key:"func_indexof",value:function(t,e){for(var i=t.length,n=0;i>n;n++)if(t[n]==e)return n;return-1}},{key:"createEquView",value:function(t,e,i){for(var n=[],o=t.length,r=0;o>r;r++){n.push(this.poly2vecArr(t[r]))}var a=new f["default"](this.config,n);if(a.notAnalytics=!0,this.addEquipmentChild(a,new l.Point(0,0)),a.x=a.body.posx,a.y=a.body.posy,e.userData){var s=e.userData.view,h=s.getData();a.sliceSetData({material:h.material,skinIndex:h.skinIndex,skinType:h.skinType,skinColor:h.skinColor,lightprototype:h.lightprototype,rateN:h.rateN,groupIndex:h.groupIndex})}for(var u=0;u<i.get_length();u++){var c=i.at(u),d=c.userData.toolView;d&&d.bodyContainsConstraint(a.body,c)&&d.changeBody&&d.changeBody(e,a.body)}return a}}]),e}(c["default"]);var v=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.globalConfig=t.globalConfig,i.line=new PIXI.Graphics,i.txt=new PIXI.Text("",{font:"16px Microsoft YaHei",fill:16777215}),i.txt2=new PIXI.Text("",{font:"16px Microsoft YaHei",fill:16777215}),i.addChild(i.line),i.addChild(i.txt),i.addChild(i.txt2),i.lineThin=4,i.lineColor=16777215,i.var_dashLen=150,i.var_r=74,i.var_fontSize=16,i}return a(e,t),s(e,[{key:"dispose",value:function(){this.globalConfig=null}},{key:"startDraw",value:function(t){var e=this.globalConfig.main.view.scale.x;this.lineThin=4/e,this.var_dashLen=150/e,this.var_r=74/e,this.line.lineStyle(this.lineThin,this.lineColor,1),this.var_startP=t,this.txt.scale.x=this.txt.scale.y=2/e,this.txt2.scale.x=this.txt2.scale.y=2/e}},{key:"func_draw",value:function(t){this.line.clear();var e=new l.Point(this.var_startP.x+this.var_dashLen,this.var_startP.y),i=new l.Point(this.var_startP.x-this.var_dashLen,this.var_startP.y),n=Math.atan2(t.y-this.var_startP.y,t.x-this.var_startP.x);n=180*n/Math.PI;var o=void 0,r=void 0;n>0?(o=0,r=n*Math.PI/180):(o=n*Math.PI/180,r=0),this.line.beginFill(16777215,.3),this.line.moveTo(this.var_startP.x,this.var_startP.y),this.line.arc(this.var_startP.x,this.var_startP.y,this.var_r,o,r),this.line.endFill(),n>0?(o=0,r=Math.PI):(o=-Math.PI,r=0),this.line.lineStyle(this.lineThin/2,this.lineColor),this.line.moveTo(this.var_startP.x,this.var_startP.y),this.line.arc(this.var_startP.x,this.var_startP.y,this.var_r,o,r),this.line.lineStyle(this.lineThin,this.lineColor),l.M.drawDashed(this.line,e,i),this.line.lineStyle(this.lineThin,this.lineColor),this.line.moveTo(this.var_startP.x,this.var_startP.y),this.line.lineTo(t.x,t.y);var a=n;0>a&&(a=-a),this.txt.text=l.M.getNumJie(a,1)+"°",this.txt2.text=l.M.getNumJie(180-a,1)+"°",this.txt.x=e.x,this.txt2.x=i.x-2*this.var_fontSize,this.txt.y=this.txt2.y=e.y-this.var_fontSize/2}},{key:"func_reset",value:function(){this.txt.text="",this.line.clear()}}]),e}(PIXI.Sprite)},569:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(551),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.moduleMain.phy.nape,y=p.geom.Vec2,i.isstart=!1,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.isstart=!0,this.view=new f["default"](this.config);for(var e=this.BodyUtil.getMechanicsBodiesUnderPoint(this.space,t),i=0;e.length>i;i++){var n=e[i];n.userData&&n.userData.isnbequ&&(e.splice(i,1),i--)}e=this.BodyUtil.filterMechaTool(e);var o=e[0]||this.space.world;this.addEquipmentChild(this.view,new l.Point),this.view.fixFirstBox(o,this.Vec2Util.pointToVec2(t))}},{key:"func_touchMove",value:function(t){if(this.isstart){this.view.upateSpring(this.Vec2Util.pointToVec2(t))}}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,!e)){if(!this.view.secBox)return this.view.removeFromFramework(this.view),void(this.view=null);var i=this.space.bodiesUnderPoint(new y(t.x,t.y));i.filter(function(t){return!t.userData||!t.userData.isnbequ});var n=this.BodyUtil.getTopBodyFormBodyList(i,[this.view.secBox.body]),o=this.Vec2Util.pointToVec2(t);this.view.upateSpring(o),100>this.view.springLen?this.view.removeFromFramework(this.view):this.view.fixSecondBox(n,o),this.view.setSelected(!0),this.view=null,this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"spring"})}}}]),e}(c["default"])},570:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function p(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:p(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(547),f=n(d);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.isstart=!1,i.tar_body=null,i.thrusterView=null,i.f=null,i.op=null,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){var e=this.func_getTarBody(t);e&&(this.adsorbToCom(e,t,50),this.isstart=!0,this.f=new l.Point(0,0),this.op=new l.Point(t.x,t.y),this.tar_body=e,this.thrusterView=new f["default"](this.config,this.tar_body),this.thrusterView.setActive(!1),this.addEquipmentChild(this.thrusterView,t),this.initScale(this.thrusterView))}},{key:"func_touchMove",value:function(t){if(this.isstart){var e=new l.Point(t.x-this.op.x,t.y-this.op.y);e.x/=f["default"].pxPerN,e.y/=f["default"].pxPerN,this.thrusterView.setForce(e),this.thrusterView.updateDraw(!0)}}},{key:"func_touchEnd",value:function(t,e){this.isstart&&(this.isstart=!1,this.tar_body=null,this.thrusterView.setActive(!0),this.thrusterView.setSelected(!1),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"thruster"}),this.globalConfig.main.isPlay||(this.thrusterView.setSelected(!0),this.thrusterView.freshLibPan()))}},{key:"func_getTarBody",value:function(t){for(var e=this.BodyUtil.getMechanicsBodiesUnderPoint(this.space,t),i=0;e.length>i;i++){var n=e[i];n.userData&&n.userData.isnbequ&&(e.splice(i,1),i--)}var o=e[0];return!o||o.userData.view.isMechaTool?null:o}}]),e}(c["default"])},571:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){var i=[],n=!0,o=!1,r=undefined;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(h){o=!0,r=h}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(451),c=function(t){return t&&t.__esModule?t:{"default":t}}(u),d=void 0,f=void 0,p=void 0,y=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.globalConfig=t.globalConfig,d=t.main.phy.nape,f=d.phys.BodyType,p=d.shape.Polygon,y=d.geom.Vec2,i.BodyUtil=t.moduleMain.BodyUtil,i.Vec2Util=t.moduleMain.Vec2Util,i.InteractionFilterManager=t.moduleMain.InteractionFilterManager,i.boxWidth=1e4,i.wallWidth=1e4,i.lefts=null,i.rights=null,i.tops=null,i.bottoms=null,i.wallColor=1842208,i.seeW=500,i.seeH=200,i.leftSeeW=0,i.leftSeeH=0,i.topSeeW=0,i.topSeeH=0,i.rightSeeW=0,i.rightSeeH=0,i.canvasStyleWH=null,i.nochange=!1,i.step=0,i.floor=new PIXI.Graphics,i.leftDraw=new PIXI.Graphics,i.topDraw=new PIXI.Graphics,i.rightDraw=new PIXI.Graphics,i}return r(e,t),s(e,[{key:"initWall",value:function(){this.material=new d.phys.Material(0,2,2,5,1),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.boxWidth=this.globalConfig.napeWallW,this.body.get_shapes().clear(),this.lefts=new p(p.box(this.wallWidth,2*(this.boxWidth+this.wallWidth)),this.material),this.rights=new p(p.box(this.wallWidth,2*(this.boxWidth+this.wallWidth)),this.material),this.tops=new p(p.box(2*(this.boxWidth+this.wallWidth),this.wallWidth),this.material),this.bottoms=new p(p.box(2*(this.boxWidth+this.wallWidth),this.wallWidth),this.material),this.body.get_shapes().add(this.lefts),this.body.get_shapes().add(this.rights),this.body.get_shapes().add(this.tops),this.body.get_shapes().add(this.bottoms),this.lefts.set_localCOM(y.get(-this.boxWidth-this.wallWidth/2,0)),this.rights.set_localCOM(y.get(this.boxWidth+this.wallWidth/2,0)),this.tops.set_localCOM(y.get(0,-this.boxWidth-this.wallWidth/2)),this.bottoms.set_localCOM(y.get(0,this.boxWidth+this.wallWidth/2)),this.body.set_type(f.get_KINEMATIC()),this.body.userData.noDrag=!0,this.body.userData.nolight=!0,this.body.userData.isnbequ=!0,this.globalConfig.main.addChildAt(this.floor,0),this.globalConfig.main.addChildAt(this.leftDraw,0),this.globalConfig.main.addChildAt(this.topDraw,0),this.globalConfig.main.addChildAt(this.rightDraw,0),this.drawFloor(),this.body.addCbType(this.CbTypeStr.GLOBAL_WALL),this.body.userData.iswall=!0,this.BodyUtil.setBodyFilter(this.body,this.InteractionFilterManager.MEC_FLOOR_FILTER),this.changeCC(.5),this.changeElastic(.5)}},{key:"setVisible",value:function(t){this.floor.visible=t,this.leftDraw.visible=t,this.topDraw.visible=t,this.rightDraw.visible=t}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.drawFloor()}},{key:"getfloorY",value:function(){var t=this.bottoms.get_worldCOM(),e=this.Vec2Util.vec2ToPoint(t);return e.y-=.5*this.wallWidth}},{key:"drawFloor",value:function(){var t=this.getMain(),e=0,i=0;if(this.nochange?this.step++:this.step=0,this.canvasStyleWH&&t.ismobileApp){if(this.nochange&&this.step>100)return}else this.canvasStyleWH={W:l.M.getNumStr(t.canvas.style.width),H:l.M.getNumStr(t.canvas.style.height)};e=this.canvasStyleWH.W,i=this.canvasStyleWH.H;var n=t.W/e,o=t.H/i,r=t.getWindowDoorSize(),s=a(r,2),h=s[0],u=s[1],c=this.bottoms.get_localCOM();c=this.body.localPointToWorld(c);var d=this.Vec2Util.vec2ToPoint(c);if(d.y-=.5*this.wallWidth,d=t.view.toGlobal(d),this.floor.y=d.y,u*o>d.y){var f=u*o-this.floor.y;h*n!==this.seeW||f!==this.seeH?(this.seeW=h*n,this.seeH=f,this.graphicsFloor(this.floor,h*n,f)):this.nochange=!0}var p=this.lefts.get_localCOM();p=this.body.localPointToWorld(p);var y=this.Vec2Util.vec2ToPoint(p);y.x+=.5*this.wallWidth,y.y=0,y=t.view.toGlobal(y),this.leftDraw.x=y.x,y.x>0&&(-y.x==this.leftSeeW&&u*o==this.leftSeeH||(this.leftSeeW=-y.x,this.leftSeeH=u*o,this.graphicsFloor(this.leftDraw,this.leftSeeW,this.leftSeeH)));var g=this.tops.get_localCOM();g=this.body.localPointToWorld(g);var v=this.Vec2Util.vec2ToPoint(g);v.x=0,v.y+=.5*this.wallWidth,v=t.view.toGlobal(v),this.topDraw.y=v.y,v.y>0&&(-v.y==this.topSeeH&&h*n==this.leftSeeW||(this.topSeeW=h*n,this.topSeeH=-v.y,this.graphicsFloor(this.topDraw,this.topSeeW,this.topSeeH)));var _=this.rights.get_localCOM();_=this.body.localPointToWorld(_);var b=this.Vec2Util.vec2ToPoint(_);if(b.x-=.5*this.wallWidth,b.y=0,b=t.view.toGlobal(b),this.rightDraw.x=b.x,h*n>b.x){var m=h*n-this.rightDraw.x;u*o===this.rightSeeH&&m===this.rightSeeW||(this.rightSeeW=m,this.rightSeeH=u*o,this.graphicsFloor(this.rightDraw,this.rightSeeW,this.rightSeeH))}}},{key:"graphicsFloor",value:function(t,e,i){t.clear(),t.beginFill(this.wallColor),t.drawRect(0,0,e,i),t.endFill()}},{key:"changeCC",value:function(t){isNaN(t)&&(t=.5),this.material.set_dynamicFriction(2*t),this.material.set_staticFriction(2.1*t)}},{key:"changeElastic",value:function(t){isNaN(t)&&(t=.5),this.material.set_elasticity(t)}}]),e}(c["default"])},573:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(616),s=n(a),h=i(454),l=n(h),u=void 0,c=void 0,d=void 0,f=void 0,p=void 0,y=void 0,g=void 0,v=void 0,_=void 0,b=void 0,m=void 0,w=void 0,O=void 0;e["default"]=function(){function t(e){o(this,t);var i=e.main.phy.nape;d=i.NbBody,f=i.shape.Polygon,p=i.geom.Vec2,u=i.geom.AABB,c=i.geom.Ray,g=i.geom.GeomPolyList,_=i.geom.MarchingSquares,y=i.geom.Vec2List,b=i.dynamics.InteractionFilter,m=i.geom.Geom,v=i.geom.GeomPoly,w=i.dynamics.ArbiterType,O=i.phys.Material,this.main=e.main,this.ALLOW_MOVE=1,this.ALLOW_ROTA=2}return r(t,[{key:"dispose",value:function(){this.main=null}},{key:"destoryBody",value:function(t){var e=this;if(t){var i=this.getView(t),n=t.constraints;t.get_shapes().foreach(function(t){var e=t.get_userData();e.vo&&delete e.vo}),t.set_compound(null),t.set_group(null),t.set_space(null),t.dispose(),t.userData=null;for(var o=n.get_length()-1;o>=0;o--)!function(t){var o=n.at(t);e.destoryJoint(o);var r=o.userData?o.userData.toolView:null;r&&(r.owner&&r.owner!==i&&r.owner.reFixed?setTimeout(function(){r.owner.reFixed()},0):r.removeFromFramework(r))}(o);t=null}}},{key:"destoryJoint",value:function(t){if(t){try{var e=t.userData.hockshape;e&&this.main.activeModule.napeEngine.hockCtrol.removeJointShape(e)}catch(i){}if(t.active=!1,t.body1=null,t.body2=null,t.body3=null,t.body4=null,t.set_compound(null),t.set_space(null),t.zpp_inner.space){t.zpp_inner.space.outer.constraints.remove(t)}}}},{key:"BodyFromSprite",value:function(t,e,i,n){var o=new PIXI.RenderTexture(this.main.renderer,t.width,t.height);o.render(t);var r=new s["default"](o),a=new u(0,0,t.width,t.height),h=n||2,l=i||8,c=new p(l,l),d=function(t,e){return r.iso.call(r,t,e)},y=_.run(d,a,c,h),v=new g,b=e;return y.foreach(function(t){v.merge(t.convexDecomposition())}),v.foreach(function(t){b.add(new f(t,new O))}),b}},{key:"getBodyFromUID",value:function(t){return this.main.activeModule.napeEngine.uidMap[t]}},{key:"getBodyFromCb",value:function(t){return[t.get_int1(),t.get_int2()]}},{key:"getBodyFromAbter",value:function(t){return[t.get_body1(),t.get_body2()]}},{key:"BodyFromArray",value:function(t,e,i){if(t&&t.length>1){var n=new y,o=e||new d;$.each(t,function(t,e){n.push(new p(e.x,e.y))});var r=new f(n,i),a=r.validity();if("VALID"==a)o.add(r);else{if("DEGENERATE"==a)return;var s=new v(n);if(s.isDegenerate())return;var h=null;try{h=s.simpleDecomposition()}catch(u){return}var l=new g;h.foreach(function(t){l.merge(t.convexDecomposition())}),l.foreach(function(t){o.add(new f(t,i))})}return o}return null}},{key:"setShapeMass",value:function(t,e){var i=t.get_area(),n=e/i*1e3;t.get_material().set_density(n)}},{key:"getShapeMass",value:function(t){return t.get_area()*(t.get_material().get_density()/1e3)}},{key:"getBodyArea",value:function(t){for(var e=t.get_shapes(),i=e.get_length(),n=0,o=0;i>o;o++){var r=e.at(o);if(!r.get_sensorEnabled()){n+=r.get_area()}}return n}},{key:"setShapeMaterial",value:function(t,e){var i=this,n=t.get_material();$.each(e,function(t,e){i.setMaterial(n,t,e)})}},{key:"setBodyMaterial",value:function(t,e){t.shapes.foreach(function(t){var i=t.get_material();$.each(e,function(t,e){this.setMaterial&&this.setMaterial(i,t,e)})})}},{key:"setMaterialFromObject",value:function(t,e){for(var i in e){this.setMaterial(t,i,e[i])}}},{key:"setMaterial",value:function(t,e,i){"density"==e?t.set_density(i):"dynamicFriction"==e?t.set_dynamicFriction(i):"elasticity"==e?t.set_elasticity(i):"rollingFriction"==e?t.set_rollingFriction(i):"staticFriction"==e&&t.set_staticFriction(i)}},{key:"frezzBody",value:function(t){t.set_velocity(p.get(0,0)),t.angularVel=0}},{key:"BodyTweenTo",value:function(t,e,i){var n=t.get_position(),o={x:n.get_x(),y:n.get_y()};i.onUpdate=function(){t.set_position(p.get(o.x,o.y))},TweenMax.to(o,e,i)}},{key:"getBodyStatus",value:function(t){var e=0;return t.allowMovement&&(e|=this.ALLOW_MOVE),t.noallowRotation||(e|=this.ALLOW_ROTA),e}},{key:"setBodyStatus",value:function(t,e){t.allowMovement=e&this.ALLOW_MOVE,t.noallowRotation=!(e&this.ALLOW_ROTA);var i=t.userData?t.userData.view:null;null!=i&&i.dispatchEvent(l["default"].SET_BODY_STATE,e)}},{key:"dampingBodyVelocity",value:function(t,e,i){var n=t.velocity,o=n.get_x()*e,r=n.get_y()*i;t.velocity=p.get(o,r)}},{key:"getAllCollisionBodys",value:function(t,e){var i=this,n=[];return t?(t.arbiters.foreach(function(o){if(i.arbiterIsCollision(o)){var r=o.get_body1(),a=o.get_body2();t===r?(e||a.isDynamic)&&n.push(a):(e||r.isDynamic)&&n.push(r)}}),n):[]}},{key:"arbiterIsCollision",value:function(t){return t.get_type()==w.get_COLLISION()}},{key:"setBodyFilter",value:function(t,e){t.get_shapes().foreach(function(t){e&&t.set_filter(e)})}},{key:"getGroupAndMask",value:function(t,e){for(var i=0,n=0,o=0;t.length>o;o++){var r=t[o];if(0>r){i|=-1;break}i|=0==r?1:2<<r-1}for(var o=0;e.length>o;o++){var a=e[o];if(0>a){n|=-1;break}n|=0==a?1:2<<a-1}return{group:i,mask:n}}},{key:"getLiquidGroup",value:function(t,e,i,n){var o=this.getGroupAndMask(t,e),r=this.getGroupAndMask(i,n);return new b(o.group,o.mask,1,-1,r.group,r.mask)}},{key:"getShapeGroup",value:function(t,e){var i=this.getGroupAndMask(t,e);return new b(i.group,i.mask)}},{key:"bodyHitWall",value:function(t){var e=this.main.activeModule.napeEngine.wallArr,i=0;for(i=0;e.length>i;i++){if(m.intersectsBody(t,e[i]))return!0}}},{key:"bodyShapeNums",value:function(t){return t.shapes.get_length()}},{key:"s",value:function(t){return Math.pow(2,t)}},{key:"createRectShape",value:function(t,e,i,n){return new f(f.rect(t,e,i,n))}},{key:"createPolygonShape",value:function(t,e){return this.createPolygonFromPoints(t,e)}},{key:"createPolygonFromPoints",value:function(t,e,i){var n=void 0;try{for(var o=[],r=0;t.length>r;r++)o.push(p.get(t[r].x,t[r].y));n=new f(o,i),e&&e.add&&e.add(n)}catch(a){}return n}},{key:"createIrregularShape",value:function(t){var e=new g;if(t&&t.length>1){var i=new y;$.each(t,function(t,e){i.push(new p(e.x,e.y))});var n=new v(i);if(n.isDegenerate())return null;var o;try{o=n.simpleDecomposition()}catch(r){return null}o.foreach(function(t){e.merge(t.convexDecomposition())})}return e}},{key:"getMechanicsBodiesUnderPoint",value:function(t,e){for(var i=new p(e.x,e.y),n=t.bodiesUnderPoint(i),o=[],r=n.get_length(),a=0;r>a;a++){var s=n.at(a);s.userData.view.isMechanics&&o.push(s)}return o}},{key:"getView",value:function(t){return t&&t.userData?t.userData.view:null}},{key:"getBodyByShape",value:function(t){return t?t.get_body():null}},{key:"getViewByShape",value:function(t){return this.getView(this.getBodyByShape(t))}},{key:"filterMechaTool",value:function(t){for(var e=[],i=t.length,n=0;i>n;n++){var o=t[n];o.userData.view.isMechaTool||e.push(o)}return e}},{key:"getTopBodyFormBodyList",value:function(t,e){var i=-1e4,n=null;if(e){var o=0;for(o=0;e.length>o;o++)t.remove(e[o])}return t.get_length()>0?(t.foreach(function(t){if(t.userData){var e=t.userData.dragLevel;if(e>i)i=e,n=t;else if(i==e){var o=this.getDisplayIndex(t),r=this.getDisplayIndex(n);0>o||0>r||o>r&&(n=t)}}}),n||(n=t.at(0)),n):null}},{key:"getDisplayIndex",value:function(t){var e=-1;if(t.userData&&t.userData.view){var i=t.userData.view.parent;if(i&&i.parent){e=i.parent.getChildIndex(i)}}return e}},{key:"getHandDragBodyFromArbiter",value:function(t){var e=this.getAllCollisionBodys(t,!1);try{var i=0;for(i=0;e.length>i;i++){var n=e[i];if(n.userData&&n.userData.dragManager)return n;var o=n.connectedBodies(),r=0;for(r=0;r<o.get_length();r++){var a=o.at(r);if(a.userData&&a.userData.dragManager)return a}}}catch(s){}return null}},{key:"getSelectBodyUnderPoint",value:function(t,e){for(var i=t.bodiesUnderPoint(new p(e.x,e.y)),n=i.get_length(),o=0;n>o;o++){var r=i.at(o);if(!r.isStatic()&&!r.userData.noDrag){var a=r.userData.view;if(a&&(a.touchEnabled||r.userData.coordinateField)&&a.transformManager)return r}}return null}},{key:"releaseHandDragJoint",value:function(t){var e=t.connectedBodies(),i=e.get_length(),n=void 0;for(n=0;i>n;n++){var o=e.at(n);o.userData&&o.userData.dragManager&&o.userData.dragManager.func_touchEnd(null)}}},{key:"getHandDragBody",value:function(t){var e=t.connectedBodies(),i=e.get_length(),n=void 0;for(n=0;i>n;n++){var o=e.at(n);if(o.userData&&o.userData.dragManager)return o}}},{key:"findArbMc",value:function(t,e){for(var i=t.get_arbiters(),n=i.get_length(),o=0;n>o;o++){var r=i.at(o),a=null;a=r.get_body1()==t?r.get_body2():r.get_body1();var s=a.userData.view;if(s.classname===e)return s}return null}}]),t}()},574:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1),a=void 0,s=void 0,h=void 0,l=void 0,u=void 0,c=void 0,d=void 0,f=void 0;e["default"]=function(){function t(e){n(this,t),a=e.NbPivotJoint,s=e.NbLineJoint,h=e.NbDistanceJoint,l=e.NbWeldJoint,u=e.NbSpringJoint,c=e.NbAngleJoint,d=e.NbPulleyJoint,f=e.NbRubberJoint,this._space=null,this.PIVOT_JOINT="PivotJoint",this.LINEJOINT_JOINT="LineJointJoint",this.DISTANCE_JOINT="DistanceJoint",this.WELD_JOINT="WeldJoint",this.SPRING_JOINT="SpringJoint",this.ANGLE_JOINT="AngleJoint",this.PULLEY_JOINT="PulleyJoint",this.NBRUBBER_JOINT="NBRubberJoint"}return o(t,[{key:"dispose",value:function(){this.space=null}},{key:"jointType",value:function(t){return t instanceof a?this.PIVOT_JOINT:t instanceof s?this.LINEJOINT_JOINT:t instanceof h?this.DISTANCE_JOINT:t instanceof l?this.WELD_JOINT:t instanceof u?this.SPRING_JOINT:t instanceof c?this.ANGLE_JOINT:t instanceof d?this.PULLEY_JOINT:t instanceof f?this.NBRUBBER_JOINT:""}},{key:"getJointworldVertexs",value:function(t){var e=t.get_body1(),i=t.get_body2(),n=t.get_anchor1(),o=t.get_anchor2();return[e.localPointToWorld(n),i.localPointToWorld(o)]}},{key:"createPivotJoint",value:function(t,e,i,n){var o=new a(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n));return o.set_ignore(!0),o.set_stiff(!0),o.set_damping(0),o.set_frequency(1e5),o.set_space(this.space),o}},{key:"createLineJoint",value:function(t,e,i,n,o,r,a){var h=new s(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n),o,r,a);return h.set_stiff(!0),h.set_ignore(!0),h.set_damping(0),h.set_space(this.space),h}},{key:"createDistanceJoint",value:function(t,e,i,n,o,r){var a=new h(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n),o,r);return a.set_space(this.space),a.set_ignore(!0),a.set_stiff(!1),a.set_damping(0),a.set_frequency(1e10),a}},{key:"createSpringJoint",value:function(t,e,i,n,o){var r=new u(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n),o);return r.set_space(this.space),r.set_frequency(1),r}},{key:"createWeldJoint",value:function(t,e,i,n,o){t.rotation||(t.rotation=0),e.rotation||(e.rotation=0);var r=isNaN(o)?e.rotation-t.rotation:o,a=new l(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n),r);return a.set_maxForce(1e7),a.set_ignore(!0),a.set_space(this.space),a}},{key:"createAngleJoint",value:function(t,e,i,n,o){var r=new c(t,e,i,n,o);return r.set_space(this.space),r}},{key:"createPulleyJoint",value:function(t,e,i,n,o,r,a,s,h,l,u){o=t.worldPointToLocal(o),r=e.worldPointToLocal(r),a=i.worldPointToLocal(a),s=n.worldPointToLocal(s);var c=new d(t,e,i,n,o,r,a,s,h,l,u);return c.set_ignore(!0),c.set_stiff(!0),c.set_damping(0),c.set_frequency(1e5),c.set_space(this.space),c}},{key:"createNBRubberJoint",value:function(t,e,i,n,o){var a=void 0,s=void 0;return a=o>0?o:r.M.vec2Length((new Vec2).add(i).sub(n)),s=new f(t,e,t.worldPointToLocal(i),e.worldPointToLocal(n),a),s.set_stiff(!1),s.set_frequency(2),s.set_damping(.1),s.set_space(this.space),s}},{key:"space",set:function(t){this._space=t},get:function(){return this._space}}]),t}()},575:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=void 0,a=void 0,s=void 0;t.exports=function(){function t(e){n(this,t),this.NBOpticsStr=e.moduleMain.NBOpticsStr,this.main=e.main,r=e.main.phy.nape,a=r.geom.Vec2,s=r.shape.ShapeList,this.threshold=.001,this.space=null,this.eqArr=[],this.intersectedArr=[]}return o(t,[{key:"updateEquips",value:function(){var t=this;this.eqArr.length=0,this.main.getEquipmentArr().forEach(function(e){t.eqArr.push(e.component)})}},{key:"dispose",value:function(){this.NBOpticsStr=null,this.space=null}},{key:"getN",value:function(t,e){return e?e.n*(t/1.5):1}},{key:"getVo",value:function(t){if(t){var e=t.get_userData();if(e)return e.vo}return null}},{key:"getViewByShape",value:function(t){if(t){var e=t.get_body();if(e&&e.userData)return e.userData.view}return null}},{key:"shapeUnderPoint",value:function(t,e){var i=this.shapesUnderPoint(t,e);return 0===i.get_length()?null:i.at(0)}},{key:"getNbyShape",value:function(t,e){if(t){var i=this.getVo(t);if(i)return this.getN(e,i)}return 1}},{key:"vecInBody",value:function(t,e){return t.contains(e)}},{key:"getBody",value:function(t){return t?t.get_body():null}},{key:"getViewByBody",value:function(t){return t&&t.userData?t.userData.view:null}},{key:"getView",value:function(t){return this.getViewByBody(this.getBody(t))}},{key:"rayFindBodyResult",value:function(t,e,i){var n=t.ray,o=this.space.rayCast(n,!0,e);if(o){var r=t.from;o.from=t.from;var a=n.at(o.get_distance()+this.threshold),s=this.shapeUnderPoint(a,r);o.to=s;var h=this.getVo(r),l=this.getVo(s);if(h===l)for(var u=this.space.rayMultiCast(n,!0,e),c=0;c<u.get_length()&&(o=u.at(c),a=n.at(o.get_distance()+this.threshold),s=this.shapeUnderPoint(a,null),o.to=s,l=this.getVo(s),h===l);c++);var d=this.getNbyShape(r,i);return o.rate=this.getNbyShape(s,i)/d,(h&&-1==h.rate||l&&-1==l.rate)&&(o.rate=1),o}}},{key:"shapesUnderPoint",value:function(t,e){var i=this,n=this.space.shapesUnderPoint(t);return n.filter(function(t){return t!==e&&i.underFilter(t)}),n}},{key:"underFilter",value:function(t){return t.get_filter()!==this.NBOpticsStr.LIGHT_AND_HITFILTERS&&t.get_filter()!==this.NBOpticsStr.filters}},{key:"bodyIsMultiShape",value:function(t){for(var e=t.get_body(),i=e.get_shapes(),n=i.get_length(),o=0,r=0;n>r;r++){var a=i.at(r);a.get_filter()!==this.NBOpticsStr.LIGHT_AND_HITFILTERS&&a.get_filter()!==this.NBOpticsStr.filters&&o++}return 1!==o}}]),t}()},576:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(457),u=n(l),c=i(492),d=n(c);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.vectorRay=[],i.rayDat=[{co:16711680,n:1}],i.lightStart=[117,0],i.isPolar=!0,i.isRayPen=!0,i}return a(e,t),s(e,[{key:"init",value:function(){this._width=this.bg.width,this._height=this.bg.height,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.bg.x=.5*-this.bg.width,this.bg.y=.5*-this.bg.height,this.createRays(),this.body.set_sensorEnabled_at(0,!0),this.setShapeInterFliter(this.body.shapesAt(0))}},{key:"createRays",value:function(){for(var t=0;this.rayDat.length>t;t++){var e=this.rayDat[t],i=this.createRay(e);this.addChild(i),this.vectorRay.push(i)}}},{key:"createRay",value:function(t){var e=new d["default"](this.body,t.n,t.co,this.paramObj);return e.isPolar=this.isPolar,e.lineStart=this.lightStart,e.init(),this.isPolar&&(e.polarAngle=Math.random()*Math.PI*2),e}},{key:"update",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this);for(var t=0;this.vectorRay.length>t;t++){this.vectorRay[t].update()}}},{key:"removed",value:function(){var t=0;for(t=0;this.vectorRay.length>t;t++){var i=this.vectorRay[t];i.removeChildren(),i.removed(),this.removeChild(i)}this.vectorRay.length=0,h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"confType",value:function(t,e){}}]),e}(u["default"])},577:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0,e["default"]=function o(t){n(this,o),this.LIGHT_AND_HITFILTERS=t.DRAG_FIELD_FILTER,this.filters=t.LIGHT_SELF_FILTER,this.NO_HIT_FILTERS=t.OPTICS_LENS_FILTER,this.PERISCOPE=t.PERISCOPE,this.PERISCOPE_MIRROR=t.PERISCOPE_MIRROR,this.PERISCOPE_HIT=t.PERISCOPE_HIT}},581:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));return a.resolution=1,a._resolution=1,a}return r(e,t),a(e,[{key:"resolution",set:function(t){this._resolution=t},get:function(){return 1}}]),e}(PIXI.Text)},601:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(510),s=n(a),h=i(548),l=n(h),u=i(511),c=n(u),d=i(512),f=n(d),p=i(551),y=n(p),g=i(549),v=n(g),_=i(500),b=n(_),m=i(547),w=n(m),O=i(471),x=n(O),P=i(514),S=n(P);e["default"]=function(){function t(){o(this,t),this.map={},this.register("Box",s["default"]),this.register("Triangle",l["default"]),this.register("Circle",c["default"]),this.register("Gear",f["default"]),this.register("ToolSpring",y["default"]),this.register("WeldJointView",v["default"]),this.register("BearingJointView",b["default"]),this.register("ThrusterToolView",w["default"]),this.register("PolygonView",x["default"]),this.register("RopeView",S["default"])}return r(t,[{key:"register",value:function(t,e){this.map[t]=e}},{key:"getClassByName",value:function(t){return this.map[t]}}]),t}()},602:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0,c=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=i.phy.nape,c=u.geom.Vec2,i.classType="ForceArrow",i.fillcolor=i.globalConfig.TXT_COLOR,i.var_txt=i.globalConfig.main.cachePool.popText("",{font:"20px Arial",fill:i.fillcolor}),i.fillcolor="",i.addChild(i.var_txt),i.var_line=i.globalConfig.main.cachePool.popGraphic(),i.addChild(i.var_line),i.var_scale=150,i.var_head=PIXI.Sprite.fromFrame("mechSkin/arrowHead2"),i.var_shen=PIXI.Sprite.fromFrame("mechSkin/arrowBody2"),i.addChild(i.var_head),i.addChild(i.var_shen),s.M.alignPivot(i.var_head,"center","top"),s.M.alignPivot(i.var_shen,"center","top"),i}return r(e,t),a(e,[{key:"headPointTo",value:function(t){return t.toLocal({x:this.var_head.x,y:this.var_head.y+6},this)}},{key:"disposed",value:function(){}},{key:"draw",value:function(t,e,i,n){var o=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;(o&&this.fillcolor!=o||this.fillcolor!==this.globalConfig.TXT_COLOR)&&(this.fillcolor=o||this.globalConfig.TXT_COLOR,this.var_txt.style.fill=this.fillcolor,this.removeChild(this.var_head),this.removeChild(this.var_shen),o?(this.var_head=PIXI.Sprite.fromFrame("mechSkin/arrowHead3"),this.var_shen=PIXI.Sprite.fromFrame("mechSkin/arrowBody3")):"#FFFFFF"===this.fillcolor?(this.var_head=PIXI.Sprite.fromFrame("mechSkin/arrowHead2"),this.var_shen=PIXI.Sprite.fromFrame("mechSkin/arrowBody2")):(this.var_head=PIXI.Sprite.fromFrame("mechSkin/arrowHead"),this.var_shen=PIXI.Sprite.fromFrame("mechSkin/arrowBody")),this.addChild(this.var_head),this.addChild(this.var_shen),s.M.alignPivot(this.var_head,"center","top"),s.M.alignPivot(this.var_shen,"center","top")),this.var_value=t,this.var_dir=i;var r=c.get(this.var_scale*this.var_value*this.var_dir.get_x(),this.var_scale*this.var_value*this.var_dir.get_y()),a=s.M.vec2Length(r);this.var_shen.height=a,this.var_head.y=a,this.rotation=Math.atan2(this.var_dir.get_y(),this.var_dir.get_x())-Math.PI/2,this.var_txt.text=n+" = "+s.M.getNumJie(t,2)+"N",this.var_txt.rotation=-this.rotation,this.x=e.get_x(),this.y=e.get_y(),s.M.alignPivot(this.var_txt,"center","top"),this.var_txt.y=a+50}}]),e}(l["default"])},603:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=null,a=null,s=null,h=null;e["default"]=function(){function t(e){n(this,t),r=e.main.phy.nape,a=r.NbBody,s=r.phys.BodyType,h=r.NbCircle,this.shapeRadius=30,this.body=new a(s.get_KINEMATIC()),this.body.userData.noDrag=!0;var i=this.createShape();i.get_userData().isself=!0,this.body.add(i)}return o(t,[{key:"updateShapes",value:function(){var t=this;this.body.get_shapes().foreach(function(e){var i=e.get_userData();if(!i.isself){var n=i.hock;n&&!n.get_body()&&t.removeJointShape(e)}})}},{key:"createShape",value:function(){var t=new h(this.shapeRadius);return t.set_sensorEnabled(!0),t}},{key:"addJointShape",value:function(t,e){var i=this.createShape();this.body.add(i),t.userData.hockshape=i,i.get_userData().hock=e}},{key:"removeJointShape",value:function(t){var e=t.get_userData().hock;e&&e.pivjoint&&(e.pivjoint.userData.hockshape=null),t.get_userData().hock=null,this.body.remove(t)}},{key:"breakJointToDrag",value:function(t){var e=t.get_userData().hock,i=e.get_body(),n=e.get_userData().bind.get_body(),o=null;if(i&&n)if(!0===i.userData.notHockDrag)o=n;else if(!0===n.userData.notHockDrag)o=i;else{var r=i.get_position(),a=n.get_position();o=r.get_y()>a.get_y()?i:n}else o=i||n;return e.dragToolClick(!0),this.removeJointShape(t),o}}]),t}()},604:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0,e["default"]=function o(t){n(this,o);var e=t.dynamics.InteractionGroup;this.WATER_BEAKER=new e(!0),this.WALL_GROUP=new e(!0),this.VERNIERCALIPER_SPIRALMICROMETER=new e(!0)}},605:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(511),f=n(d),p=i(474),y=n(p);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.isstart=!1,i.var_r=0,i.lineColor=16777215,i.var_arcColor=4605510,i.var_edgeColor=11184810,i.lineThin=2,i.center=null,i.skinColor=null,i.shapeView=new PIXI.Graphics,i.angle=0,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.isstart=!0,this.lineThin=2/this.globalConfig.main.view.scale.x,this.func_dispose(),this.skinColor=y["default"].getColor(),this.center=new l.Point(t.x,t.y);var e=[];e.push({option:"addElement",target:this.shapeView,params:{x:0,y:0}}),this.func_dispatchGraphic(e),this.config.moduleMain.napeEngine.transformManager.hide()}},{key:"func_touchMove",value:function(t){this.isstart&&(this.var_r=l.Point.distance(this.center,t),this.angle=Math.atan2(t.y-this.center.y,t.x-this.center.x),this.var_r>0&&(this.shapeView.clear(),this.shapeView.lineStyle(this.lineThin,this.var_edgeColor,1),this.shapeView.beginFill(this.skinColor,1),this.shapeView.drawCircle(this.center.x,this.center.y,this.var_r),this.shapeView.endFill(),this.shapeView.lineStyle(this.lineThin,this.var_edgeColor,1),this.shapeView.beginFill(this.var_arcColor,.6),this.shapeView.moveTo(this.center.x,this.center.y),this.shapeView.arc(this.center.x,this.center.y,this.var_r,this.angle-.1,this.angle+.1),this.shapeView.endFill()))}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,this.func_dispose(),this.shapeView.clear(),!e)){if(this.var_r>50){this.angle=Math.atan2(t.y-this.center.y,t.x-this.center.x);var i=new f["default"](this.config,[this.var_r,this.skinColor,this.angle]);this.addEquipmentChild(i,this.center),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"circle"}),this.globalConfig.main.isPlay||i.setSelected(!0),this.globalConfig.main.dispatchEvent("phy.addEquipment")}this.var_r=0}}}]),e}(c["default"])},606:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function g(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:g(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(549),f=n(d),p=void 0,y=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return p=t.moduleMain.phy.nape,y=p.geom.Vec2,i.singlePoint=!0,i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchTabUid||(this.touchTabUid=l.M.addTouch(this.var_dis,{tab:i.touchTab,isAddDB:!1},this))}else this.touchTabUid&&l.M.removeTouch(this.var_dis,this.touchTabUid),this.touchTabUid=null}},{key:"func_touchBegin",value:function(t){}},{key:"touchTab",value:function(t){var e=new y(t.x,t.y),i=this.space.bodiesUnderPoint(e);if(0!=i.get_length()){i.filter(function(t){if(t.userData){if(t.userData.canfixtool)return!0;if(t.userData.isnbequ)return!1}return!0});var n=this.BodyUtil.getTopBodyFormBodyList(i);if(n&&n.userData.view&&!n.userData.view.isMechaTool){this.cancelMecSelected(t);var o=this.BodyUtil.getTopBodyFormBodyList(i,[n]);o||(o=this.space.world),o!=this.space.world&&this.adsorbToCom(o,t,50),this.adsorbToCom(n,t,50);var r=new f["default"](this.config,n,o);this.addEquipmentChild(r,t),this.initScale(r),r.showToolDatas(),this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.config.moduleMain.napeEngine.transformManager.hide(),this.globalConfig.main.execute(this.NBCommand.ANALYTICS,{type:"mecTool",name:"fix"}),this.globalConfig.main.isPlay||(r.setSelected(!0),r.freshLibPan())}}}}]),e}(c["default"])},607:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function v(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:v(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(452),c=n(u),d=i(548),f=n(d),p=i(474),y=n(p),g=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.isstart=!1,i.globalPoints=[new l.Point,new l.Point,new l.Point],i}return a(e,t),s(e,[{key:"setActive",value:function(t){if(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setActive",this).call(this,t),this.active){var i=this;this.touchBeginUid||(this.touchBeginUid=l.M.addTouch(this.var_dis,{begin:i.func_touchBegin,isAddDB:!1},this)),this.touchMoveUid||(this.touchMoveUid=l.M.addTouch(this.var_dis,{move:i.func_touchMove,isAddDB:!1},this)),this.touchEndUid||(this.touchEndUid=l.M.addTouch(this.var_dis,{end:i.func_touchEnd,isAddDB:!1},this))}else this.touchBeginUid&&l.M.removeTouch(this.var_dis,this.touchBeginUid),this.touchMoveUid&&l.M.removeTouch(this.var_dis,this.touchMoveUid),this.touchEndUid&&l.M.removeTouch(this.var_dis,this.touchEndUid),this.touchBeginUid=this.touchMoveUid=this.touchEndUid=null}},{key:"func_touchBegin",value:function(t){this.skinColor=y["default"].getColor(),this.func_dispose(),this.isstart=!0,this.var_startP=new l.Point(t.x,t.y)}},{key:"func_touchMove",value:function(t){if(this.isstart){this._width=t.x-this.var_startP.x,this._height=t.y-this.var_startP.y,this.func_updateGlobalPoints();var e=new PIXI.Graphics;e.lineStyle(1,this.skinColor,1),e.beginFill(this.skinColor,1);for(var i=0;this.globalPoints.length>i;i++){var t=this.globalPoints[i];0==i?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)}e.endFill();var n=[];n.push({option:"addElement",target:e,params:{x:0,y:0}}),this.func_dispatchGraphic(n)}}},{key:"func_touchEnd",value:function(t,e){if(this.isstart&&(this.isstart=!1,this.func_dispose(),!e&&(this._width=t.x-this.var_startP.x,this._height=t.y-this.var_startP.y,Math.abs(this._width)>=50||Math.abs(this._height)>=50))){var i=this.func_getLocalPoints(),n=[Vec2Util.pointArrToVec2Arr(i)],o=new f["default"](n,this.skinColor);this.addEquipmentChild(o,this.var_startP),this.globalConfig.main.dispatchEvent("phy.addEquipment"),this.globalConfig.main.isPlay||(o.setSelected(!0),o.freshLibPan())}}},{key:"func_updateGlobalPoints",value:function(){var t=this.globalPoints[0],e=this.globalPoints[1],i=this.globalPoints[2];return t.x=this.var_startP.x+this._width/2,t.y=this.var_startP.y,e.x=this.var_startP.x,e.y=this.var_startP.y+this._height,i.x=this.var_startP.x+this._width,i.y=this.var_startP.y+this._height,[t,e,i]}},{key:"func_getLocalPoints",value:function(){for(var t=[],e=0;this.globalPoints.length>e;e++){var i=this.globalPoints[e];t.push(new l.Point(i.x-this.var_startP.x,i.y-this.var_startP.y))}return t}}]),e}(c["default"]);g.preventDraw=!0,e["default"]=g},608:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(1),l=i(226),u=function(t){return t&&t.__esModule?t:{"default":t}}(l);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.count=20,i.elecLable="弹簧",i.line=new PIXI.Graphics,i.line.lineStyle(3,16711680),i.addChild(i.line),i.overrideFunc(),i}return r(e,t),a(e,[{key:"overrideFunc",value:function(){}},{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.hasAddCompComplete=!0}},{key:"update",value:function(){if(this.joint){var t=this.getMain(),e=h.Point.vec2ToPoint(this.joint.body1.localPointToWorld(this.joint.anchor1)),i=h.Point.vec2ToPoint(this.joint.body2.localPointToWorld(this.joint.anchor2));this.line&&(e=this.line.toLocal(e,t.view),i=this.line.toLocal(i,t.view)),this.drawSJ(e,i)}}},{key:"drawSJ",value:function(t,e){var i=h.M.getPointLen(t,e),n=i/this.count,o=(h.M.getXianDuanGaoXianDian(t,e,20,!0),h.M.getXianDuanGaoXianDian(t,e,20,!1),h.M.getXianDuanGaoXianDian(e,t,20,!0),h.M.getXianDuanGaoXianDian(e,t,20,!1),void 0);for(this.line.clear(),this.line.moveTo(t.x,t.y),o=1;this.count>=o;o++){var r=h.M.getXianDianByDis(n*o-n/2,!0,t,e),a=h.M.getXianDuanGaoXianDian(r,t,14,o%2!=0);o%2==0?this.line.lineStyle(3,10027008):this.line.lineStyle(3,10027059),this.line.lineTo(a.x,a.y)}this.line.lineTo(e.x,e.y)}}]),e}(u["default"])},611:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=i(1);e["default"]=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a));return s.s1=t,s.s2=i,s.cover=r,s}return r(e,t),a(e,[{key:"init",value:function(){this._sCon=new PIXI.Sprite,this.addChild(this._sCon),this._sCon.addChild(this.s1),this._sCon.addChild(this.s2),this.s1.x=this.s2.x=0,this.sHeight=this.s1.height-4,this.s1.y=-20,this.s2.y=this.s1.y+this.sHeight,this.addChild(this.cover),this.cover.x=0,this.cover.y=0,this.cover.alpha=.3;var t=new PIXI.Graphics;this.addChild(t),t.beginFill(0),t.drawRect(-this.cover.width/2,-this.cover.height/2,this.cover.width,this.cover.height),t.endFill(),this._sCon.mask=t,this.touchId=u.M.addTouch(this,{begin:this.beginFunc,move:this.moveFunc,end:this.endFunc},this)}},{key:"removed",value:function(){this.s1=null,this.s2=null,this.cover=null,this.$target=null,u.M.removeTouch(this,this.touchId),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"beginFunc",value:function(t){this.$target.touchEnabled=!1,this.touchp=this.getMouseXY(t),this.startP=this.touchp.clone()}},{key:"moveFunc",value:function(t){var e=this,i=this.getMouseXY(t),n=i.y-this.touchp.y;this.touchp=i;var o=i.y-this.startP.y;Math.abs(o)>.5*this.cover.height&&(clearTimeout(this.crollTimeFlag),this.crollTimeFlag=setTimeout(function(){if(!e.hadDestory)return 0>o?(clearInterval(e["int"]),void(e["int"]=setInterval(function(){e.dispatchEvent("rolling",{upordown:!1})},25))):o>0?(clearInterval(e["int"]),void(e["int"]=setInterval(function(){e.dispatchEvent("rolling",{upordown:!0})},25))):void 0},500)),clearInterval(this["int"]),this.dispatchEvent("rolling",{upordown:n>0})}},{key:"endFunc",value:function(t){this.$target.touchEnabled=!0,this.touchp=null,clearTimeout(this.crollTimeFlag),clearInterval(this["int"]),this.dispatchEvent("rollend")}},{key:"updata",value:function(t){t?this.s1.y+=2:this.s1.y-=2,this.s2.y=this.s1.y>-15?this.s1.y-this.sHeight:this.s1.y+this.sHeight,this.s1.y=this.s2.y>-15?this.s2.y-this.sHeight:this.s2.y+this.sHeight}}]),e}(l["default"])},612:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function f(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:f(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(507),u=n(l),c=i(226),d=n(c);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.scaler=new u["default"](t),i}return a(e,t),s(e,[{key:"added",value:function(){this.addChild(this.scaler),this.scaler.added(),this.scaler.initMicrometerH()}},{key:"removed",value:function(){this.scaler.removed(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"reScaleTxt",value:function(t){var e=0;for(e=0;this.scaler.children>e;e++){var i=this.scaler.getChildAt(e);i&&(i.scale.x=i.scale.x=t)}}}]),e}(d["default"])},613:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function u(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:u(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.line=new PIXI.Graphics,i.textObject={},i.space=5,i.total=50*i.space,i}return r(e,t),a(e,[{key:"added",value:function(){this.addChild(this.line),this.initText()}},{key:"removed",value:function(){this.parent&&this.parent.removeChild(this),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"initText",value:function(){var t=0;for(t=0;10>t;t++){var e=new PIXI.Text(5*t+"",{font:"18px Arial",fill:0});this.addChild(e),e.x=10,e.pivotY=4,this.textObject["t"+5*t]=e}}},{key:"reScaleTxt",value:function(t){for(var e in this.textObject){var i=this.textObject[e];i.scale.x=i.scale.y=t}}},{key:"updata",value:function(t){this.posi=-t%this.total,this.drawline()}},{key:"drawline",value:function(){this.line.clear(),this.line.lineStyle(1,0);for(var t=0;50>t;t++){var e=-(t*this.space+this.posi);-this.total/2>e&&(e+=this.total),e>this.total/2&&(e-=this.total),-this.total/2>e&&(e+=this.total);var i=void 0;if(t%5==0){i=15;var n=this.textObject["t"+t];n&&(n.y=e)}else i=7;this.line.moveTo(0,e),this.line.lineTo(i,e)}}}]),e}(l["default"])},616:function(t,e,i){"use strict";function n(t,e){n.injectionClass(),this.bitmap=t,this.alphaThreshold=e||128,this.bounds=new s(0,0,this.bitmap.width,this.bitmap.height)}e.__esModule=!0;var o=i(539),r=function(t){return t&&t.__esModule?t:{"default":t}}(o),a=void 0,s=void 0;n.injectionClass=function(){n.injected||(n.injected=!0,a=r["default"].nape,s=a.geom.AABB)},n.prototype.iso=function(t,e){var i=t,n=e;return 0>i&&(i=0),0>n&&(n=0),this.bitmap.width>i||(i=this.bitmap.width-1),this.bitmap.height>n||(n=this.bitmap.height-1),this.alphaThreshold-this.bitmap.getPixel(i,n)[3]},e["default"]=n},617:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=void 0,h=void 0;e["default"]=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.JointUtil=t.moduleMain.JointUtil,s=t.main.phy.nape,h=s.geom.Vec2,r.napeEngine=i,r.graphic=new PIXI.Graphics,r.addChild(r.graphic),r}return r(e,t),a(e,[{key:"clear",value:function(){this.graphic.clear()}},{key:"draw",value:function(){this.graphic.clear(),this.graphic.lineStyle(1,16711935);var t=this.napeEngine.space.bodies,e=this.napeEngine.space.get_compounds(),i=0;for(i=0;i<t.get_length();i++){this.createdebugShape(t.at(i).get_shapes())}for(i=0;i<e.get_length();i++){var n=e.at(i),o=n.get_bodies(),r=n.get_constraints(),a=void 0;for(a=0;a<o.get_length();a++){this.createdebugShape(o.at(a).get_shapes())}for(a=0;a<r.get_length();a++){this.createJoint(r.at(a))}}var s=this.napeEngine.space.constraints;for(i=0;i<s.get_length();i++){this.createJoint(s.at(i))}}},{key:"createJoint",value:function(t){if(t.get_anchor1&&!isNaN(t.get_anchor1().get_x())){this.graphic.lineStyle(1,65280);var e=t.get_body1(),i=t.get_body2(),n=t.get_body3?t.get_body3():null,o=t.get_body4?t.get_body4():null,r=e.localPointToWorld(t.get_anchor1()),a=i.localPointToWorld(t.get_anchor2());if(this.JointUtil.jointType(t)===this.JointUtil.PIVOT_JOINT)return this.graphic.lineStyle(2,65535),void this.graphic.drawCircle(r.get_x(),r.get_y(),4);if(this.JointUtil.jointType(t)===this.JointUtil.DISTANCE_JOINT)this.graphic.lineStyle(2,16711680);else{if(this.JointUtil.jointType(t)===this.JointUtil.WELD_JOINT)return this.graphic.lineStyle(2,16776960),void this.graphic.drawCircle(r.get_x(),r.get_y(),4);if(this.JointUtil.jointType(t)===this.JointUtil.LINEJOINT_JOINT){this.graphic.lineStyle(2,16750848),this.graphic.moveTo(r.get_x(),r.get_y());var s=h.get(1,1);s.set_angle(t.get_direction().get_angle()),s.set_length(t.get_jointMax());var l=r.add(s);this.graphic.lineTo(l.get_x(),l.get_y()),this.graphic.lineStyle(2,10092492)}}if(this.graphic.moveTo(r.get_x(),r.get_y()),this.graphic.lineTo(a.get_x(),a.get_y()),n){var u=n.localPointToWorld(t.get_anchor3()),c=o.localPointToWorld(t.get_anchor4());this.graphic.moveTo(u.get_x(),u.get_y()),this.graphic.lineTo(c.get_x(),c.get_y())}}}},{key:"createdebugShape",value:function(t){var e=0,i=0;for(e=0;e<t.get_length();e++){var n=t.at(e),o=n.get_body();if(!isNaN(o.get_position().get_x()))if(this.graphic.beginFill(16711680),this.graphic.drawCircle(o.posx,o.posy,2),this.graphic.endFill(),n.get_radius){var r=n.get_worldCOM();this.graphic.drawCircle(r.get_x(),r.get_y(),n.get_radius())}else{var a=void 0;if(a=n.get_worldVerts()){var s={};for(this.graphic.lineStyle(1,16711935),i=0;i<a.get_length();i++){var h=a.at(i);0===i?(s.x=h.get_x(),s.y=h.get_y(),this.graphic.moveTo(h.get_x(),h.get_y())):this.graphic.lineTo(h.get_x(),h.get_y())}this.graphic.lineTo(s.x,s.y)}}}}},{key:"removed",value:function(){this.JointUtil=null,this.napeEngine=null}}]),e}(PIXI.Container)},618:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1);e["default"]=function(){function t(e){n(this,t),this.ray=e,this.from=null,this.fsNbRay=null,this.zsNbRay=null,this.rsNbRay=null,this.normal=null,this.owner=null,this.isQfs=!1,this.inAir=!0,this.dis=0,this.level=0,this.isPolar=!1,this.paths=null,this._I=new r.Point(Math.SQRT1_2,Math.SQRT1_2),this.color=0,this.nofline=!1,this.showGuideLine=!0,this.setRay(e),this.endP=null}return o(t,[{key:"setRay",value:function(t){this.ray=t,this.startP=this.vec2point(t.get_origin()),this.dir=this.vec2point(t.get_direction()),this.dir.normalize(1)}},{key:"setPolar",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=0;this.isPolar?n=this._I.x*e+this._I.y*i:(this.isPolar=!0,n=this.I*Math.SQRT1_2),this._I.x=n*e,this._I.y=n*i}},{key:"updateEndP",value:function(){this.endP=new r.Point(this.startP.x+this.dir.x*this.dis,this.startP.y+this.dir.y*this.dis)}},{key:"vec2point",value:function(t){return new r.Point(t.get_x(),t.get_y())}},{key:"inOrderTreeWalk",value:function(t,e){t&&(this.inOrderTreeWalk(t.fsNbRay,e),e.push(t),this.inOrderTreeWalk(t.zsNbRay,e))}},{key:"preOrderTreeWalk",value:function(t,e){t&&(e.push(t),this.preOrderTreeWalk(t.fsNbRay,e),this.preOrderTreeWalk(t.zsNbRay,e))}},{key:"postOrderTreeWalk",value:function(t,e){t&&(this.postOrderTreeWalk(t.fsNbRay,e),this.postOrderTreeWalk(t.zsNbRay,e),e.push(t))}},{key:"BFSTreeWalk",value:function(){for(var t=[this],e=0;t[e];)t[e].fsNbRay&&t.push(t[e].fsNbRay),t[e].zsNbRay&&t.push(t[e].zsNbRay),e++;return t}},{key:"inOrderTreeWalk2",value:function(t,e){t&&(this.inOrderTreeWalk2(t.zsNbRay,e),e.push(t),this.inOrderTreeWalk2(t.fsNbRay,e))}},{key:"preOrderTreeWalk2",value:function(t,e){t&&(e.push(t),this.preOrderTreeWalk2(t.zsNbRay,e),this.preOrderTreeWalk2(t.fsNbRay,e))}},{key:"postOrderTreeWalk2",value:function(t,e){t&&(this.postOrderTreeWalk2(t.zsNbRay,e),this.postOrderTreeWalk2(t.fsNbRay,e),e.push(t))}},{key:"BFSTreeWalk2",value:function(){for(var t=[this],e=0;t[e];)t[e].zsNbRay&&t.push(t[e].zsNbRay),t[e].fsNbRay&&t.push(t[e].fsNbRay),e++;return t}},{key:"I",get:function(){return this._I.length},set:function(t){if(0===this.I)this._I.x=this._I.y=t*Math.SQRT1_2;else{var e=t/this.I;this._I.x*=e,this._I.y*=e}}}],[{key:"cloneI",value:function(t,e){t._I=e._I.clone()}}]),t}()},619:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function p(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:p(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(49),l=i(457),u=function(t){return t&&t.__esModule?t:{"default":t}}(l),c=void 0,d=void 0,f=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return c=i.phy.nape,d=c.shape.Polygon,f=c.geom.Vec2,i.canRotate=!1,i.dataChangFlag=!1,i.panelChangFlag=!1,i.initBodyFlag=!0,i.className="OpticsWaveBase",i.pxm=5e-5,i.pxmm=1e3*i.pxm,i.lightGain=1,i.lightTypes=[i.language.getLocaleStr("red_light"),i.language.getLocaleStr("yellow_light"),i.language.getLocaleStr("green_light"),i.language.getLocaleStr("less_blue_light"),i.language.getLocaleStr("blue_light"),i.language.getLocaleStr("violet_light"),i.language.getLocaleStr("white_light")],i.lightLamdas=[660,580,550,493,450,410,0],i.lightColors=[16711680,16776960,65280,65535,255,16711935,16777215],i.whiteLight=[{name:i.language.getLocaleStr("red_light"),lamda:660,color:16711680},{name:i.language.getLocaleStr("yellow_light"),lamda:580,color:16776960},{name:i.language.getLocaleStr("green_light"),lamda:550,color:65280},{name:i.language.getLocaleStr("less_blue_light"),lamda:493,color:65535},{name:i.language.getLocaleStr("blue_light"),lamda:450,color:255},{name:i.language.getLocaleStr("violet_light"),lamda:410,color:16711935}],i.curLightId=0,i.curLamda=i.lightLamdas[i.curLightId],i.curColor=i.lightColors[i.curLightId],i.delay=30,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.initBodyFlag&&this.initBody()}},{key:"initBody",value:function(){this.body.shapes.clear();for(var t=0;this.children.length>t;t++){var e=this.children[t],i=e.getLocalBounds();if(i.width>0&&i.height>0){var n=new d(d.box(i.width,i.height));n.translate(f.get(e.x+i.x+i.width/2,e.y+i.y+i.height/2)),this.body.add(n),n.set_filter(this.NBOpticsStr.LIGHT_AND_HITFILTERS)}}this.body.set_sensorEnabled_at(0,!0)}},{key:"setCurLightId",value:function(t){this.lightLamdas.length>t||(t=0),this.curLightId=t,this.curLamda=this.lightLamdas[this.curLightId],this.curColor=this.lightColors[this.curLightId]}},{key:"selfRender",value:function(){}},{key:"getN",value:function(t){t/=1e3;var e=1/t,i=e*e;return 1.3831+.0712*i+i*i*-.0064}},{key:"px2mm",value:function(t){return t*this.pxmm}},{key:"px2m",value:function(t){return t*this.pxm}},{key:"mm2px",value:function(t){return t/this.pxmm}},{key:"m2px",value:function(t){return t/this.pxm}},{key:"toFixed",value:function(t,e){var i=Math.pow(10,-e-1),n=(0,h.round)(t,e),o=n+i+"",r=o.indexOf(".");return 0===e?o.substring(0,r):o.substring(0,r+e+1)}},{key:"dB2times",value:function(t){return Math.pow(10,.1*t)}},{key:"times2dB",value:function(t){return 10*Math.log10(t)}},{key:"delayRender",value:function(){var t=this;this.delay>0?setTimeout(function(){t.hadDestory||t.dataChangFlag&&(t.dataChangFlag=!1,t.selfRender())},30):(this.dataChangFlag=!1,this.selfRender())}},{key:"delayShowPanel",value:function(){var t=this;setTimeout(function(){t.hadDestory||t.panelChangFlag&&(t.panelChangFlag=!1,t.freshLibPan())},30)}},{key:"changeLight",value:function(t){this.curLightId=t.checked,this.curLamda=this.lightLamdas[this.curLightId],this.curColor=this.lightColors[this.curLightId],this.dataChangFlag=!0,this.delayRender()}},{key:"changeLightGain",value:function(t){this.lightGain=this.dB2times(t.showValue),this.dataChangFlag=!0,this.delayRender()}},{key:"getConf",value:function(){var t={};return t.confArr=[],t.confArr.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("light_type"),!1,"",this.lightTypes[this.curLightId],this.lightTypes,this,this.changeLight,0,0),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("light_intensity_gain"),!1,"dB",10,-10,this.toFixed(this.times2dB(this.lightGain),2),1,this.changeLightGain,this)),t}}]),e}(u["default"])},620:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function O(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:O(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.type="SlitScreen",a.w=t,a.h=i,a.babinet=!1,a.slit=null,a.setSlit(r),a}return r(e,t),s(e,[{key:"setSlit",value:function(t){this.slit&&this.removeChild(this.slit),t&&this.addChild(t),this.slit=t}},{key:"getBgColor",value:function(){return this.babinet?16777215:0}},{key:"getFengColor",value:function(){return this.babinet?0:16777215}},{key:"selfRender",value:function(){this.babinet=this.slit.babinet,this.clear(),this.beginFill(this.getBgColor(),1),this.drawRect(0,0,this.w,this.h),this.endFill(),this.slit&&(this.slit.x=this.w/2,this.slit.y=this.h/2,this.slit.selfRender&&this.slit.selfRender(this.getFengColor(),this.getBgColor()))}}]),e}(PIXI.Graphics),l=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.type="Slit",r.babinet=t,r.color=i,r}return r(e,t),s(e,[{key:"selfRender",value:function(t){}},{key:"getData",value:function(){return{}}},{key:"setData",value:function(t){for(var e in t)this[e]=t[e]}}]),e}(PIXI.Graphics),u=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r));return a.type="CircleSlit",a.r=t,a}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t),this.clear(),this.beginFill(t,1),this.drawCircle(0,0,this.r),this.endFill()}},{key:"getData",value:function(){return{r:this.r}}}]),e}(l),c=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,a));return s.type="RectSlit",s.w=t,s.h=i,s}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t),this.clear(),this.beginFill(t,1),this.drawRect(-this.w/2,-this.h/2,this.w,this.h),this.endFill()}},{key:"getData",value:function(){return{w:this.w,h:this.h}}}]),e}(l),d=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r,a));return s.type="SingleSlit",s}return r(e,t),e}(c),f=function(t){function e(t,i,r,a,s){n(this,e);var h=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,s));return h.type="DoubleSlit",h.d=r,h.w=t,h.h=i,h.Slit01=new d(t,i),h.Slit02=new d(t,i),h.addChild(h.Slit01),h.addChild(h.Slit02),h}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t),this.Slit02.w=this.Slit01.w=this.w,this.Slit02.h=this.Slit01.h=this.h,this.Slit01.x=-this.d/2,this.Slit02.x=this.d/2,this.Slit01.selfRender(t),this.Slit02.selfRender(t)}},{key:"getData",value:function(){return{w:this.w,h:this.h,d:this.d}}}]),e}(l),p=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r));return a.type="PolygonSlit",a.ps=t,a}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t),this.clear(),this.beginFill(t,1);for(var i=0;this.ps.length>i;i++){var n=this.ps[i];0===i&&this.moveTo(n.x,n.y),this.lineTo(n.x,n.y)}this.endFill()}},{key:"getData",value:function(){return{ps:this.ps}}}]),e}(l),y=function(t){function e(t,i,r,a,s){n(this,e);var h=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,[],a,s));return h.type="TriangleSlit",h.w=t,h.h=i,h.rot=r,h.ow=100,h.oh=86,h.ops=[{x:-50,y:28.6},{x:.05,y:-58},{x:50,y:28.6},{x:-50,y:28.6}],h}return r(e,t),s(e,[{key:"selfRender",value:function(t){for(var i=this.w/this.ow,n=this.h/this.oh,o=0;this.ops.length>o;o++){var r=this.ops[o];this.ps[o]={x:r.x*i,y:r.y*n}}this.rotation=2*Math.PI-this.rot,a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t)}},{key:"getData",value:function(){return{w:this.w,h:this.h,rot:this.rot}}}]),e}(p),g=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,[],r,a));return s.type="StarSlit",s.r=t,s.rot=i,s.or=105,s.ops=[{x:100,y:-32.4},{x:40.45,y:13.25},{x:61.85,y:85.1},{x:.05,y:42.6},{x:-61.8,y:85.1},{x:-40.45,y:13.25},{x:-100,y:-32.4},{x:-24.95,y:-34.35},{x:.05,y:-105},{x:25,y:-34.35},{x:100,y:-32.4}],s}return r(e,t),s(e,[{key:"selfRender",value:function(t){for(var i=this.r/this.or,n=0;this.ops.length>n;n++){var o=this.ops[n];this.ps[n]={x:o.x*i,y:o.y*i}}this.rotation=2*Math.PI-this.rot,a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t)}},{key:"getData",value:function(){return{r:this.r,rot:this.rot}}}]),e}(p),v=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return a.type="RingSlit",a.ro=t,a.ri=i,a}return r(e,t),s(e,[{key:"selfRender",value:function(t,i){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t),void 0===t&&(t=0,i=16777215),this.clear(),this.beginFill(t,1),this.drawCircle(0,0,this.ro),this.endFill(),this.beginFill(i,1),this.drawCircle(0,0,this.ri),this.endFill()}},{key:"getData",value:function(){return{ro:this.ro,ri:this.ri}}}]),e}(l),_=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));r.type="ImgSlit",r.imgName=t;var a=PIXI.Texture.fromFrame(t),s=new PIXI.Sprite(a);return r.addChild(s),s.x=-s.width/2,s.y=-s.height/2,r.ow=s.width,r.oh=s.height,r.sp=s,r}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t)}},{key:"getData",value:function(){return{imgName:this.imgName}}}]),e}(l),b=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i));r.type="ImgSlit2";var a=new PIXI.Sprite(t);return r.addChild(a),a.x=-128,a.y=-128,r.ow=256,r.oh=256,r.sp=a,r}return r(e,t),s(e,[{key:"selfRender",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t)}},{key:"getData",value:function(){return{}}}]),e}(l),m=function(t){function e(t,i,r,a){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a));return s.type="WireLineSlit",s.w=i,s.h=r,s}return r(e,t),s(e,[{key:"selfRender",value:function(t){this.scale.x=this.w/this.ow,this.scale.y=this.h/this.oh,a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selfRender",this).call(this,t)}},{key:"getData",value:function(){return{imgName:this.imgName,w:this.w,h:this.h}}}]),e}(_),w=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.type="BladeSlit",r}return r(e,t),e}(_);e["default"]={SlitScreen:h,Slit:l,CircleSlit:u,RectSlit:c,SingleSlit:d,DoubleSlit:f,PolygonSlit:p,TriangleSlit:y,StarSlit:g,ImgSlit:_,ImgSlit2:b,WireLineSlit:m,BladeSlit:w,RingSlit:v}},621:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(){function t(){n(this,t)}return o(t,null,[{key:"DFT",value:function(t,e,i,n){for(var o=t.length,r=[],a=[],s=0;o>s;s++){r[s]=0,a[s]=0;for(var h=2*-i*Math.PI*s*n/o,l=0;o>l;l++){var u=Math.cos(l*h),c=Math.sin(l*h);r[s]+=t[l]*u-e[l]*c,a[s]+=t[l]*c+e[l]*u}1==i||(r[s]=r[s]/o,a[s]=a[s]/o)}return{re:r,im:a}}},{key:"FFT",value:function(t,e,i,n){for(var o=1<<i,r=[],a=[],s=o>>1,h=[],l=[],u=[],c=[],d=0;s>d;d++){var f=-2*Math.PI*d*n/o;r[d]=Math.cos(f),a[d]=Math.sin(f)}for(var n=0;i>n;n++){for(var p=0;1<<n>p;p++)for(var y=1<<i-n,g=y>>1,d=0;g>d;d++){var v=p*y,_=d+v,b=d+v+g;h[_]=t[_]+t[b],l[_]=e[_]+e[b];var m=d<<n,w=t[_]-t[b],O=e[_]-e[b];h[b]=w*r[m]-O*a[m],l[b]=w*a[m]+O*r[m]}u=t,c=e,t=h,e=l,h=u,l=c}for(var p=0;o>p;p++){for(var v=0,d=0;i>d;d++)p&1<<d&&(v+=1<<i-d-1);h[p]=t[v],l[p]=e[v]}for(var x=Math.sqrt(o),d=0;o>d;d++)h[d]=h[d]/x,l[d]=-l[d]/x;return{re:h,im:l}}},{key:"IFFT",value:function(e,i,n,o){for(var r=1<<n,a=0;r>a;a++)i[a]=-i[a];return t.FFT(e,i,n,o)}},{key:"FFT2",value:function(e,i,n,o,r,a){for(var s=1<<n,h=1<<o,l=[],u=[],c=0;h>c;c++){for(var d,f=[],p=[],y=0;s>y;y++)d=c*s+y,f[y]=e[d],p[y]=i[d];var g=t.FFT(f,p,n,r);for(y=0;s>y;y++)d=c*s+y,l[d]=g.re[y],u[d]=g.im[y]}for(var y=0;s>y;y++){for(var d,f=[],p=[],c=0;h>c;c++)d=c*s+y,f[c]=l[d],p[c]=u[d];var g=t.FFT(f,p,o,a);for(c=0;h>c;c++)d=c*s+y,l[d]=g.re[c],u[d]=g.im[c]}return{re:l,im:u}}},{key:"IFFT2",value:function(e,i,n,o,r,a){for(var s,h=1<<n,l=1<<o,u=0;l>u;u++)for(var c=0;h>c;c++)s=u*h+c,i[s]=-i[s];return t.FFT2(e,i,n,o,r,a)}}]),t}()},622:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e["default"]=function(){function t(e){n(this,t),this.moduleMain=e,this.globalConfig=e.globalConfig,this.baseLambda=7800}return o(t,[{key:"init",value:function(){}},{key:"destroy",value:function(){}},{key:"dispose",value:function(){}},{key:"getN",value:function(t,e){var i=t;if(550!==e){i=(n1-1)*(1-656e4/lamd1/lamd1)/(1-656e4/lamd2/lamd2)+1}return i}},{key:"getNByLamda",value:function(t){var e=1/t,i=e*e;return 1.3831+.0712*i+i*i*-.0064}},{key:"getN2ByLamdaAndN1",value:function(t,e,i){var n=i;if(660!==e){n=(i-1)*(1-656e4/t/t)/(1-656e4/e/e)+1}return n}},{key:"lamda2rgba",value:function(t){var e=void 0,i=void 0,n=void 0,o=void 0;t>=380&&440>t?(i=-(t-440)/60,n=0,o=1):t>=440&&490>t?(i=0,n=(t-440)/50,o=1):t>=490&&510>t?(i=0,n=1,o=-(t-510)/20):t>=510&&580>t?(i=(t-510)/70,n=1,o=0):t>=580&&645>t?(i=1,n=-(t-645)/65,o=0):t>=645&&781>t?(i=1,n=0,o=0):(i=0,n=0,o=0),e=t>=380&&420>t?.3+.7*(t-380)/40:t>=420&&701>t?1:t>=701&&781>t?.3+.7*(780-t)/80:0;return i=0===i?0:Math.round(255*Math.pow(i*e,.8)),n=0===n?0:Math.round(255*Math.pow(n*e,.8)),o=0===o?0:Math.round(255*Math.pow(o*e,.8)),[i,n,o,e]}},{key:"rgb2color",value:function(t,e,i){return t<<16|e<<8|i<<0}},{key:"color2rgb",value:function(t){return[t>>16&255,t>>8&255,255&t]}},{key:"colorSuperposition",value:function(t,e,i,n){var o=this.color2rgb(t),r=this.color2rgb(i),a=255-(255-o[0])*(255-r[0])/255,s=255-(255-o[1])*(255-r[1])/255,h=255-(255-o[2])*(255-r[2])/255,l=1-(1-e)*(1-n);return[this.rgb2color(a,s,h),l]}}]),t}()},679:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function c(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:c(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},h=i(680),l=function(t){return t&&t.__esModule?t:{"default":t}}(h),u=void 0;e["default"]=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return u=i.ComponentProperty,i.className="FilmInterferenceBase",i.xScale=i.zScale=10,i.yScale=20,i}return r(e,t),a(e,[{key:"init",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this)}},{key:"getI0",value:function(t,e,i,n){i*=1e-9;var o=this.getDl(t,e,i,n),r=Math.PI*o/i,a=Math.cos(r);return a*a}},{key:"getDl",value:function(t,e,i,n){return 0}}]),e}(l["default"])},680:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function y(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:y(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(619),u=n(l),c=i(494),d=n(c),f=i(517),p=n(f);e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.className="InterferenceBase",i.WIDTH=280,i.HEIGHT=280,i.IMG_DATA_LEN=i.WIDTH*i.HEIGHT*4,i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.difImg=new d["default"](this.WIDTH,this.HEIGHT),this.difImg.x=-this.WIDTH/2,this.difImg.y=-this.HEIGHT/2,this.imgData=this.difImg.context.getImageData(0,0,this.WIDTH,this.HEIGHT)}},{key:"selfRender",value:function(){var t=[];if(16777215===this.curColor)for(var e=0;this.whiteLight.length>e;e++){var i=this.whiteLight[e],n=this.calculateImgData(i.lamda,i.color);0===e?t=n:p["default"].blend(t,n,this.IMG_DATA_LEN)}else t=this.calculateImgData(this.curLamda,this.curColor);p["default"].setArr(this.imgData.data,t,this.IMG_DATA_LEN),this.difImg.context.putImageData(this.imgData,0,0),this.difImg.updateTexture()}},{key:"calculateImgData",value:function(t,e){for(var i=this.getN(t),n=0,o=[],r=void 0,a=p["default"].getRGB(e),s=p["default"].rgb2hsv(a.r,a.g,a.b),h=0;this.WIDTH>h;h++)for(var l=0;this.HEIGHT>l;l++){n=this.getI0(h,l,t,i),s.v=this.lightGain*n,r=p["default"].hsv2rgb(s.h,s.s,s.v);var u=4*(l*this.WIDTH+h);o[u]=r.r,o[u+1]=r.g,o[u+2]=r.b,o[u+3]=255}return o}},{key:"getI0",value:function(t,e,i,n){return 0}}]),e}(u["default"])},681:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function T(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===undefined){var o=Object.getPrototypeOf(t);return null===o?undefined:T(o,e,i)}if("value"in n)return n.value;var r=n.get;return r===undefined?undefined:r.call(i)},l=i(1),u=i(619),c=n(u),d=i(621),f=n(d),p=i(517),y=n(p),g=i(1157),v=n(g),_=i(494),b=n(_),m=i(620),w=n(m),O=void 0,x=void 0,P=void 0,S=void 0,k=void 0;e["default"]=function(t){function e(t){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return O=i.phy.nape,x=O.shape.Polygon,P=O.NbBody,S=O.phys.BodyType,k=O.geom.Vec2,i.className="FourierDiffraction",i.canRotate=!1,i.dataChangFlag=!1,i.slitTypes=[i.language.getLocaleStr("single_slit")],i.slits=[new w["default"].SingleSlit(10,256,!1)],i.slitsShow=[new w["default"].SingleSlit(10,256,!1,263172)],i.curSlitId=0,i.curSlit=null,i.curSlitShow=null,i.pxm=5e-5,i.pxmm=1e3*i.pxm,i.BASE_LAMDA=410,i.slitsData=[],i.setFourierSize(8),i.type=1,i.z=0,i.diffWorker=new v["default"],i.diffWorker.supportWorker&&(i.delay=0),i}return a(e,t),s(e,[{key:"init",value:function(){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"init",this).call(this),this.slitBubble.scale.x=this.slitBubble.scale.y=.5,this.slitBubble.x=this.slitBubble.x+3,this.slitBubble.y=this.slitBubble.y+this.slitBubble.height/2+50,this.initBody(),this.slitCon=this.slitBubble.slitCon;var t=new PIXI.Graphics;t.beginFill(),t.drawCircle(0,0,124),t.endFill(),this.slitBubble.addChild(t),this.slitCon.mask=t;var i=new b["default"](this.FOURIER_SIZE,this.FOURIER_SIZE);i.blendMode=PIXI.BLEND_MODES.SCREEN,this.sceen.difImageCon.addChild(i),this.sceen.difImageCon.screenBg.blendMode=PIXI.BLEND_MODES.SCREEN,this.difImg=i,this.renderTexture=PIXI.RenderTexture.create(this.FOURIER_SIZE,this.FOURIER_SIZE,PIXI.SCALE_MODES.DEFAULT,1),this.slitScreen=new w["default"].SlitScreen(this.FOURIER_SIZE,this.FOURIER_SIZE,this.curSlit),this.slitScreen.y=-300,this.data0=y["default"].getData0(this.FOURIER_SIZE,this.FOURIER_SIZE),this.setCurSlitId(0),this.lightLineGra=new PIXI.Graphics,this.addChild(this.lightLineGra),this.initSlitsData(),this.selfRender()}},{key:"removed",value:function(){this.diffWorker&&this.diffWorker.supportWorker&&(this.diffWorker.destroy(),this.diffWorker=null),this.removeChildren(),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removed",this).call(this)}},{key:"selfRender",value:function(){this.updateLightLine(),this.curSlitShow.selfRender&&this.curSlitShow.selfRender(this.curSlitShow.color),this.slitScreen.selfRender(),this.renderTexture=this.main.renderer.generateTexture(this.slitScreen,PIXI.SCALE_MODES.DEFAULT,1);var t=this.main.renderer.extract.pixels(this.renderTexture);this.diffComplete(this.diffraction(y["default"].getArr2(t)))}},{key:"diffComplete",value:function(t){1!==this.lightGain&&(t=y["default"].mul(t,this.lightGain,this.IMG_DATA_LEN));var e=this.difImg.context.getImageData(0,0,this.FOURIER_SIZE,this.FOURIER_SIZE);y["default"].setArr(e.data,t,this.IMG_DATA_LEN),this.difImg.context.putImageData(e,0,0),this.difImg.updateTexture()}},{key:"diffraction",value:function(t){var e=f["default"].FFT2(t,this.data0,this.FOURIER_N,this.FOURIER_N,1,1),i=y["default"].abs(e.re,e.im,this.FOURIER_LEN);if(i=y["default"].center(i,this.FOURIER_SIZE,this.FOURIER_SIZE),this.curLamda>0){i=y["default"].scale(i,this.FOURIER_SIZE,this.FOURIER_SIZE,this.curLamda/this.BASE_LAMDA),i=y["default"].color(i,this.IMG_DATA_LEN,this.curColor)}else{for(var n=[],o=0;this.whiteLight.length>o;o++){var r=this.whiteLight[o],a=r.lamda/this.BASE_LAMDA,s=y["default"].scale(i,this.FOURIER_SIZE,this.FOURIER_SIZE,a);s=y["default"].color(s,this.IMG_DATA_LEN,r.color),0===o?n=s:y["default"].blend(n,s,this.IMG_DATA_LEN)}i=n}return i}},{key:"setFourierSize",value:function(t){this.FOURIER_N=t,this.FOURIER_SIZE=1<<this.FOURIER_N,this.FOURIER_LEN=this.FOURIER_SIZE*this.FOURIER_SIZE,this.IMG_DATA_LEN=4*this.FOURIER_LEN}},{key:"setCurSlitId",value:function(t){this.slits.length>t||(t=0),this.curSlitId=t,this.curSlit=this.slits[this.curSlitId],this.curSlitShow=this.slitsShow[this.curSlitId],this.slitScreen.setSlit(this.curSlit),this.slitCon.removeChildren(0,this.slitCon.children.length),this.slitCon.addChild(this.curSlitShow),this.slitBubble.slitBg.gotoAndStop(this.curSlit.babinet?1:0)}},{key:"updateLightLine",value:function(){this.drawLightLine(this.getLightPoints(),4,this.curColor)}},{key:"drawLightLine",value:function(t,e,i){this.lightLineGra.clear(),this.lightLineGra.lineStyle(e,i,1);for(var n=0;t.length>n;n++){var o=t[n],r=o[0],a=o[1];this.lightLineGra.moveTo(r.x,r.y),this.lightLineGra.lineTo(a.x,a.y)}}},{key:"getLightPoints",value:function(){return[]}},{key:"changeSlit",value:function(t){this.saveSlitsDataByIndex(this.curSlitId),this.setCurSlitId(t.checked),this.selfRender(),this.freshLibPan()}},{key:"changeLight",value:function(t){this.curLightId=t.checked,this.curLamda=this.lightLamdas[this.curLightId],this.curColor=this.lightColors[this.curLightId],this.selfRender()}},{key:"initSlitsData",value:function(){this.slitsData=[];for(var t=0;this.slits.length>t;t++)this.saveSlitsDataByIndex(t)}},{key:"saveSlitsDataByIndex",value:function(t){this.slitsData[t]=this.slits[t].getData()}},{key:"getData",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getData",this).call(this);return t.curSlitId=this.curSlitId,t.curLightId=this.curLightId,t.lightGain=this.lightGain,this.saveSlitsDataByIndex(this.curSlitId),t.slitsData=this.slitsData,t}},{key:"setData",value:function(t){if(t.slitsData){for(var i=0;t.slitsData.length>i;i++){var n=t.slitsData[i],o=this.slits[i];o&&o.setData&&o.setData(n);var r=this.slitsShow[i];r&&r.setData&&r.setData(n)}this.initSlitsData()}t.curSlitId&&this.setCurSlitId(t.curSlitId),t.curLightId&&this.setCurLightId(t.curLightId),t.lightGain&&(this.lightGain=t.lightGain),h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setData",this).call(this,t),this.dataChangFlag=!0,this.delayRender()}},{key:"changeW",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.w=e,this.curSlitShow.w=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeH",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.h=e,this.curSlitShow.h=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeR",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.r=e,this.curSlitShow.r=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeD",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.d=e,this.curSlitShow.d=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeLightGain",value:function(t){this.lightGain=this.dB2times(t.showValue),this.dataChangFlag=!0,this.delayRender()}},{key:"changeRot",value:function(t){var e=l.M.toHu(t.value);this.curSlit.rot=e,this.curSlitShow.rot=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeRo",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.ro=e,this.curSlitShow.ro=e,this.dataChangFlag=!0,this.delayRender()}},{key:"changeRi",value:function(t){var e=this.mm2px(t.showValue);this.curSlit.ri=e,this.curSlitShow.ri=e,this.dataChangFlag=!0,this.delayRender()}},{key:"getConf",value:function(){var t={};return t.confArr=[],t.confArr.push(this.ComponentProperty.getDropMenu(this.language.getLocaleStr("light_type"),!1,"",this.lightTypes[this.curLightId],this.lightTypes,this,this.changeLight,0,0),this.ComponentProperty.getScrollBar(this.language.getLocaleStr("light_intensity_gain"),!1,"dB",10,-10,this.toFixed(this.times2dB(this.lightGain),2),1,this.changeLightGain,this),this.ComponentProperty.getDropMenu(this.language.getLocaleStr("par_slitype"),!1,"",this.slitTypes[this.curSlitId],this.slitTypes,this,this.changeSlit,0,0)),t}},{key:"selectRenderChild",value:function(){return this.updateTransform(),this.bg?this.bg.getBounds():this.getBounds()}}]),e}(c["default"])},682:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1),h=i(226),l=function(t){return t&&t.__esModule?t:{"default":t}}(h);t.exports=function(t){function e(t,i,r){n(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return a.limit=null,a.light=i,a.zuo=r,a.$parent=null,a._p1=null,a._p2=null,a.laminY=0,a.lamaxY=0,a.laOffsetY=0,a.laOrigony=0,a}return r(e,t),a(e,[{key:"setP12",value:function(){}},{key:"setlimitxy",value:function(){}},{key:"initView",value:function(){this.addChild(this.zuo),this.addChild(this.light),this.light.x=this.zuo.x=this.zuo.y=0,this.setP12(),this.setlimitxy(),this.laOrigony=this.light.y,this.laTouchid=s.M.addTouch(this.light,{begin:this.laBegin,move:this.laMove,end:this.laEnd},this),this.zoTouchid=s.M.addTouch(this.zuo,{begin:this.zuoBegin,move:this.zuoMove,end:this.zuoEnd},this)}},{key:"disposeAll",value:function(){this.$parent=null,s.M.removeTouch(this.light,this.laTouchid),s.M.removeTouch(this.zuo,this.zoTouchid),this.light=null,this.zuo=null,this.destroy()}},{key:"zuoBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"checkposition",value:function(){this.x=this.limit[0]>this.x?this.limit[0]:this.x,this.x=this.x>this.limit[1].x-54?this.limit[1].x-54:this.x}},{key:"zuoMove",value:function(t){var e=this.getMouseXY(t);this.x+=e.x-this.oldP.x,this.checkposition(),this.oldP=e,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"zuoEnd",value:function(t){this.$parent.touchEnabled=!0,this.$parent.dispatchEvent("autoFocusMove",{tar:this})}},{key:"laBegin",value:function(t){this.$parent.touchEnabled=!1,this.$parent.stopDragManager(),this.oldP=this.getMouseXY(t)}},{key:"laMove",value:function(t){var e=this.getMouseXY(t);this.light.y+=e.y-this.oldP.y,this.laminY>this.light.y&&(this.light.y=this.laminY),this.light.y>this.lamaxY&&(this.light.y=this.lamaxY),this.setP12(!1),this.laOffsetY=this.light.y-this.laOrigony,this.oldP=e}},{key:"laEnd",value:function(t){this.$parent.touchEnabled=!0}},{key:"p1",get:function(){return this._p1}},{key:"p2",get:function(){return this._p2}}]),e}(l["default"])},683:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1);e["default"]=function(){function t(e,i){n(this,t),this.view=e,this.eqView=i,this.dragArr=[],this.moved=!1,this.gra=new PIXI.Graphics,this.view.addChildAt(this.gra,1),this.hasLine=!1,this.pointArr=[]}return o(t,[{key:"update",value:function(){}},{key:"reset",value:function(){this.gra.clear(),this.hasLine=!1,this.pointArr.length=0,this.refresh()}},{key:"refresh",value:function(){}},{key:"changeBtnLabel",value:function(t,e){t.text=e}},{key:"initBtn",value:function(t,e,i){var n=this;t.btnId=i,t.fontColor="#0033CC",t.text=this.eqView.language.getLocaleStr(e),t.tab=function(){n.changeClick(t.btnId)},t["this"]=this}},{key:"changeClick",value:function(t){this.eqView.changeViewType({showValue:t})}},{key:"drag",value:function(t,e,i,n){var o=this;t.getMScale=function(){return o.eqView.getMScale()},t.dragId=r.M.addDrag(t,null,{begin:function(t){o.eqView.cannotSystemDrag=!0,e&&e.call(o,t)},move:function(t){o.moved=!0,i&&i.call(o,t)},end:function(t){o.eqView.cannotSystemDrag=!1,n&&n.call(o,t)}},this),this.dragArr.push(t)}},{key:"removed",value:function(){this.dragArr.forEach(function(t){r.M.removeDrag(t,t.dragId),t.getMScale=null}),this.dragArr.length=0,this.view=null,this.eqView=null}},{key:"setVisible",value:function(t){this.view.visible=t}},{key:"getD",value:function(t){return 40*Math.abs(t.x)/1200}},{key:"side2plan",value:function(t){var e=[[.622681800333835,-2.26554353140329,1388.93287614087],[1.22602742955981,2.15410964579083,-638.835633268398],[138327614714492e-20,.00133144792441439,1]],i=this.mul(e,[t.x,t.y,1]);return{x:i[0]/i[2],y:i[1]/i[2]}}},{key:"plan2side",value:function(t){var e=[[.434597104229077,.59516884730679,-223.411138468529],[-.177460145184904,.0897866610409582,303.8391483172],[.000235677774164818,-.000120369546353085,.595763035916078]],i=this.mul(e,[t.x,t.y,1]);return{x:i[0]/i[2],y:i[1]/i[2]}}},{key:"mul",value:function(t,e){return[t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2]]}}]),t}()},794:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i(1);t.exports=function(t){function e(t){n(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.select=0,i.list=null,i.itemW=0,i.gap=0,i.ishide=!1,i.touchtar=null,i.equparent=null,i.beginid=null,i.mainid=null,i.stageid=null,i.main=t.moduleMain.main,i.firstshow=!1,i}return r(e,t),a(e,[{key:"destory",value:function(){s.M.removeDomTouch(this.$canvas,this.stageid);for(var t=0;this.list.length>t;t++){var e=this.list[t];s.M.removeTouch(e,e.clickid)}if(this.equparent.cannotSystemDrag=!1,s.M.removeTouch(this.touchtar,this.beginid),null===!this.mainid){s.M.removeTouch(this.main.canvas,this.mainid),this.mainid=null}s.M.removeTouch(this.touchtar,this.beginid),this.touchtar=null,this.equparent=null,this.list=null}},{key:"configInit",value:function(t){var e=this;this.select=t.defselect,this.list=t.list,this.itemW=t.itemW,this.gap=t.gap,this.touchtar=t.touchtar,this.equparent=t.equparent;for(var i=0;this.list.length>i;i++)!function(t){var i=e.list[t];e.addChild(i),i.x=t*(e.itemW+e.gap)+e.itemW/2,i.y=0,i.index=t,i.clickid=s.M.addTouch(i,{tab:function(){e.select!==i.index&&(e.select=i.index,e.setSelect(!0,!0),e.dispatchEvent("change"))}})}(i);this.setSelect(),this.addTouchListener(),this.dispatchEvent("change")}},{key:"resetPos",value:function(){for(var t=0;this.list.length>t;t++){var e=this.list[t];e.x=t*(this.itemW+this.gap)+this.itemW/2,e.y=0}}},{key:"setSelect",value:function(){for(var t=arguments.length>0&&arguments[0]!==undefined&&arguments[0],e=1>=arguments.length||arguments[1]===undefined||arguments[1],i=this.select,n=1;i>=0;)n=1-.3*(this.select-i),this.list[i].alpha=n,i--;for(i=this.select,n=1;this.list.length>i;)n=1-.3*(i-this.select),this.list[i].alpha=n,i++;var o=-this.select*(this.itemW+this.gap)-this.itemW/2;e&&(t?TweenMax.to(this,.4,{x:o}):this.x=o)}},{key:"show",value:function(){var t=this;TweenMax.killAll(!0),this.firstshow=!0,this.ishide=!1,this.parent.visible=!0;for(var e=this.select-1,i=this.list[this.select].x;e>=0;){var n=this.list[e];TweenMax.from(n,.4,{x:i,delay:.3*(this.select-e-1),ease:Linear.easeOut}),e--}for(e=this.select+1;this.list.length>e;){var o=this.list[e];TweenMax.from(o,.4,{x:i,delay:.3*(e-this.select-1),ease:Linear.easeOut}),e++}var r=this.main.canvas;this.$canvas=$(r),this.stageid=s.M.addDomTouch(this.$canvas,{end:function(e){if(t.firstshow)return void(t.firstshow=!1);var i={x:0,y:0},n=void 0,o=void 0;if(e.touches){var r=e.changedTouches[0];n=r.clientX,o=r.clientY}else n=e.clientX,o=e.clientY;t.main.renderer.plugins.interaction.mapPositionToPoint(i,n,o);var a=t.getBounds();i.x>a.x&&a.x+a.width>i.x&&i.y>a.y&&a.y+a.height>i.y||t.hide()}})}},{key:"toggle",value:function(){this.ishide?this.show():this.hide()}},{key:"hide",value:function(){this.firstshow=!1,this.ishide=!0,this.parent.visible=!1,TweenMax.killAll(!0),this.resetPos();var t=this.main.canvas;s.M.removeDomTouch($(t),this.stageid)}},{key:"moveX",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined&&arguments[1];(this.x+=2*t)>-this.itemW/2&&(this.x=-this.itemW/2);var i=this.width-this.itemW/2;-i>this.x&&(this.x=-i);for(var n=this.select,o=9999999999,r=this.toLocal({x:0,y:0},this.parent),a=0;this.list.length>a;a++){var s=this.list[a],h=Math.abs(s.x-r.x);o>h&&(o=h,n=a)}(e||this.select!=n)&&(this.select=n,e?this.setSelect(!0,e):this.setSelect(!1,e),this.dispatchEvent("change"))}},{key:"addTouchListener",value:function(){var t=this,e=this.main.canvas;this.beginid=s.M.addTouch(this,{begin:function(i){t.equparent.cannotSystemDrag=!0,t.oldP=null,null===!t.mainid&&(s.M.removeTouch(e,t.mainid),t.mainid=null),t.mainid=s.M.addTouch(e,{move:function(e){var i=t.equparent.getMouseXY(e);t.oldP&&t.moveX(i.x-t.oldP.x),t.oldP=i},end:function(i){var n=t.equparent.getMouseXY(i);t.oldP&&(t.moveX(n.x-t.oldP.x,!0),t.oldP=null),t.equparent.cannotSystemDrag=!1,s.M.removeTouch(e,t.mainid),t.mainid=null}})}})}}]),e}(PIXI.Container)}});