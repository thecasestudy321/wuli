var redis = require('redis');
var conf = {
    /*生产*/
    redis_port: 6379,
    redis_hostname: '172.17.0.15',
    redis_options1:{detect_buffers: true},
    redis_options2:"sccxjykj!"
    /*开发*/
    // redis_port: 6378,
    // redis_hostname: '111.231.140.20',
    // redis_options1:{detect_buffers: true},
    // redis_options2:'mzkq'
    /*本地*/
/*    redis_port: 6379,
    redis_hostname: '127.0.0.1',
    redis_options1:{detect_buffers: true},
    redis_options2:''*/
}

const _createClient = () => {
    // 如果使用
    // redis.createClient();
    // 表示默认配置 localhost:6379
    const client = redis.createClient(conf.redis_port, conf.redis_hostname,conf.redis_options1);
    client.auth(conf.redis_options2);
    client.select(0)//物理初中数据库
    //记录redis错误
    client.on("error", function (err) {
        console.log("redis error: " + err);
    });
    return client;
};
const redisClient = _createClient();

function setItem(key, value, exprires) {
    redisClient.set(key, value);
    //设置过期 单位：秒
    if (exprires) {
        redisClient.expire(key, exprires);
    }
}
function delItem(key){
    redisClient.del(key);
}
async function getItem(key) {
    return new Promise((resolve, reject) => {
        redisClient.get(key, (err, val) => {
            if(err) {
                reject(err)
            }
            resolve(val);
        })
    })
}


module.exports = {
    redisClient,
    setItem,
    getItem
};