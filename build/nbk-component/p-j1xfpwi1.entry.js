import{r as registerInstance,h,g as getElement,c as createEvent}from"./p-05c16912.js";import{D as DomUtils}from"./p-e34c4f58.js";import{S as SystemUtils}from"./p-6ea92d75.js";import"./p-ba1f185e.js";import{N as NBUtils}from"./p-d9f729d6.js";const FRACTION_LIST=[{value:.5,content:"1/2"},{value:1.5,content:"3/2"},{value:1/3,content:"1/3"},{value:2/3,content:"2/3"},{value:8/3,content:"8/3"}],NbChemBridge=class{constructor(t){registerInstance(this,t),this.arrowPosition=!0,this.way="",this.coefficient=1,this.electronics=1}brigdeChange(t,s){let{from:i,to:e}=t;i.bindElement.valenceVisible=!0,e.bindElement.valenceVisible=!0;let{from:h,to:n}=s;h.bindElement.valenceVisible=!1,n.bindElement.valenceVisible=!1}componentWillLoad(){this.componentWillUpdate()}componentWillUpdate(){let e=DomUtils.domQuerySelector(this.ele,".bridge");e&&(this.color=getComputedStyle(e).color);let{from,to,mode,coefficient,electronics}=this.bridgeConfig;if(!from||!to)return void console.log("参数不健全");this.mode=void 0===mode?1:mode;let fv=from.valence,tv=to.valence;if(console.log("---------\x3e",fv,tv),"string"==typeof fv&&(fv=eval(fv)),"string"==typeof tv&&(tv=eval(tv)),this.direction="top",1===this.mode&&fv!==tv?fv<tv?this.way="失去":(this.way="得到",this.direction="bottom"):this.way="",coefficient&&electronics)this.coefficient=coefficient,this.electronics=electronics;else{this.coefficient=Math.min(from.count,to.count);let t=Math.abs(fv-tv);if(!Number.isInteger(t)){let s=FRACTION_LIST.length;for(let i=0;i<s;i++)if(Math.abs(t-FRACTION_LIST[i].value)<Number.EPSILON){t=FRACTION_LIST[i].content;break}}this.electronics=t}Number.isInteger(this.coefficient)||(this.coefficient=Math.round(this.coefficient)),from.medObj.getElementBounds(from.indexInMed).then(t=>{let{top:s,left:i,height:e,width:h}=t;to.medObj.getElementBounds(to.indexInMed).then(t=>{let{left:n,width:l}=t;switch(this.left=i+h/2,this.direction){case"top":this.top=s;break;case"bottom":this.top=s+e}this.width=n-i,l!==h&&(this.width+=(l-h)/2),this.width<0&&(this.left+=this.width,this.width=-this.width),n<i&&(this.arrowPosition=!1)})})}componentDidLoad(){let{from:t,to:s}=this.bridgeConfig;t.bindElement.valenceVisible=!0,s.bindElement.valenceVisible=!0,this.componentWillUpdate()}createTitleDom(){return this.mode?h("span",null,this.coefficient,"×","string"==typeof this.electronics?h("nb-num-fraction",{value:this.electronics}):this.electronics):h("span",null,this.coefficient*this.electronics)}componentDidUnload(){let{from:t,to:s}=this.bridgeConfig;t.bindElement.valenceVisible=!1,s.bindElement.valenceVisible=!1}render(){return h("div",{class:"bridge "+this.direction+(this.arrowPosition?"":" reversal"),style:{top:`${this.top}px`,left:`${this.left}px`,width:`${this.width}px`,borderColor:this.color}},h("div",{class:"line"},h("div",{class:"title"},this.way,this.createTitleDom(),"e⁻")),h("span",{class:"electronic"}," "))}get ele(){return getElement(this)}static get watchers(){return{bridgeConfig:["brigdeChange"]}}static get style(){return"\@-webkit-keyframes top{0%{left:0;top:100%;opacity:0}25%{left:0;top:-.2em;opacity:1}75%{left:100%;top:-.2em;margin-left:-.1em;opacity:1}to{left:100%;top:100%;margin-left:-.1em;opacity:0}}\@keyframes top{0%{left:0;top:100%;opacity:0}25%{left:0;top:-.2em;opacity:1}75%{left:100%;top:-.2em;margin-left:-.1em;opacity:1}to{left:100%;top:100%;margin-left:-.1em;opacity:0}}\@-webkit-keyframes top_r{to{left:0;top:100%;opacity:0}75%{left:0;top:-.2em;opacity:1}25%{left:100%;top:-.2em;margin-left:-.1em;opacity:1}0%{left:100%;top:100%;margin-left:-.1em;opacity:0}}\@keyframes top_r{to{left:0;top:100%;opacity:0}75%{left:0;top:-.2em;opacity:1}25%{left:100%;top:-.2em;margin-left:-.1em;opacity:1}0%{left:100%;top:100%;margin-left:-.1em;opacity:0}}\@-webkit-keyframes bottom{0%{left:0;top:-.2em;opacity:0}25%{left:0;top:100%;margin-top:-.15em;opacity:1}75%{left:100%;top:100%;margin-top:-.1em;margin-left:-.1em;opacity:1}to{left:100%;top:-.1em;margin-left:-.1em;opacity:0}}\@keyframes bottom{0%{left:0;top:-.2em;opacity:0}25%{left:0;top:100%;margin-top:-.15em;opacity:1}75%{left:100%;top:100%;margin-top:-.1em;margin-left:-.1em;opacity:1}to{left:100%;top:-.1em;margin-left:-.1em;opacity:0}}.bridge{position:absolute;height:.8em;margin-left:-.1em;border-left:.1em solid;border-right:.1em solid}.bridge .line{width:100%;text-align:center;white-space:nowrap;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;font-size:.6em}.bridge .electronic{position:absolute;top:0;left:0;width:0;height:0;margin-left:-.2em;border:.15em solid;border-radius:50%;-webkit-transform:scale(.7);transform:scale(.7)}.bridge.top{margin-top:-1.5em;border-top:.1em solid}.bridge.top:after{position:absolute;content:\"\";right:-.2em;bottom:-.1em;width:0;height:0;border-left:.15em solid transparent;border-right:.15em solid transparent;border-top:.3em solid}.bridge.top .line .title{position:absolute;top:0;margin-top:-2em}.bridge.top .electronic{-webkit-animation:top 5s linear infinite;animation:top 5s linear infinite}.bridge.bottom{margin-top:.8em;border-bottom:.1em solid}.bridge.bottom:after{position:absolute;content:\"\";right:-.2em;top:-.1em;width:0;height:0;border-left:.15em solid transparent;border-right:.15em solid transparent;border-bottom:.3em solid}.bridge.bottom .line .title{position:absolute;bottom:0;margin-bottom:-2em}.bridge.bottom .electronic{-webkit-animation:bottom 5s linear infinite;animation:bottom 5s linear infinite}.bridge.reversal{-webkit-animation-direction:alternate;animation-direction:alternate}.bridge.reversal:after{left:-.2em}.bridge.reversal.top .electronic{-webkit-animation:top_r 5s linear infinite;animation:top_r 5s linear infinite}"}},NbChemCondition=class{constructor(t){registerInstance(this,t),this.conTopStr="",this.conBtmStr=""}medCreatComplete(t){t.stopPropagation()}async updateUI(){let t=DomUtils.domQuerySelector(this.ele,".conditionBox");this.color=getComputedStyle(t).color}componentWillLoad(){this.conditionAry&&(this.conditionAry[0]&&(this.conTopStr=this.conditionAry[0]),this.conditionAry[1]&&(this.conBtmStr=this.conditionAry[1]))}componentDidLoad(){this.updateUI()}creatConDom(t){return t&&""!==t?t.split("、").map(t=>/^[A-Z]+/.test(t)?h("nb-chem-med",{medName:t,medCalVal:!1}):h("span",null,t)):h("span",null," ")}render(){return h("div",{class:"conditionBox"},h("div",{class:"con-top condition"},this.creatConDom(this.conTopStr)),h("div",{class:"arrowType"+this.arrowType}),h("div",{class:"con-btm condition"},this.creatConDom(this.conBtmStr)))}get ele(){return getElement(this)}static get style(){return".conditionBox{text-align:center;font-size:1em;min-width:1.5em}.condition{font-size:.6em;margin:0 .5em}.arrowType1{height:.1em;border-top:.1em solid;border-bottom:.1em solid}.arrowType2{height:0;width:calc(100% - .1em);margin-right:.1em;border:.05em solid;border-left:none;border-right:none;position:relative}.arrowType2:after{position:absolute;content:\"\";right:-.1em;top:-.15em;width:0;height:0;border-top:.15em solid transparent;border-bottom:.15em solid transparent;border-left:.3em solid}.arrowType3{height:.1em;width:100%;margin:0 .2em;border-width:.1em 0;border-style:solid;position:relative;margin:.1em 0}.arrowType3:after{right:0;top:-.2em;width:0}.arrowType3:after,.arrowType3:before{position:absolute;content:\"\";height:.1em;border:.15em solid;border-top:none;border-bottom:none;transform:skewY(30deg);-webkit-transform:skewY(30deg);-moz-transform:skewY(30deg)}.arrowType3:before{left:0;bottom:-.2em}"}},NbChemElement=class{constructor(t){registerInstance(this,t),this.valenceAble=!0,this.valenceVisible=!1,this.switchValenceVisible=()=>{this.valenceVisible=!this.valenceVisible;let t=DomUtils.domQuerySelector(this.ele,".element");t.removeEventListener("touchend",this.switchValenceVisible),t.removeEventListener("mouseup",this.switchValenceVisible)},this.eleCreatComplete=createEvent(this,"eleCreatComplete",7)}async getBounds(){let t=DomUtils.domQuerySelector(this.ele,".element"),s=DomUtils.domQuerySelector(this.ele,".valenceNumBox"),{offsetLeft:i,offsetTop:e,offsetHeight:h,offsetWidth:n}=t;return{left:i+s.offsetLeft,top:e+s.offsetTop,height:h-s.offsetTop,width:Math.max(n,s.offsetWidth)}}async getValenceVisible(){return this.valenceVisible}async setValenceVisible(t){if(t!==this.valenceVisible)return this.valenceVisible=t}changeValenceVisible(t){let s=DomUtils.domQuerySelector(this.ele,".element");s.addEventListener("touchend",this.switchValenceVisible,{passive:!1}),s.addEventListener("mouseup",this.switchValenceVisible),setTimeout(()=>{s.removeEventListener("touchend",this.switchValenceVisible),s.removeEventListener("mouseup",this.switchValenceVisible)},500)}componentWillLoad(){}componentDidLoad(){this.eleInfo.bindElement=this,this.eleCreatComplete.emit({info:this.eleInfo,target:this}),SystemUtils.getInstance()}getValenceNum(){let t=this.eleInfo.valence;switch(typeof t){case"number":return h("div",{class:"valenceNum"},t>0?"+"+t:t);case"string":return h("div",{class:"valenceNum"},h("nb-num-fraction",{value:t,showPositive:!0}))}}render(){return h("div",{class:"element "+(this.valenceAble?"active":""),onPointerDown:t=>this.changeValenceVisible(t)},h("div",{class:"eleName"},this.eleInfo.content),h("div",{class:"valenceNumBox",style:{display:this.valenceAble&&this.valenceVisible?"flex":"none"}},this.getValenceNum()))}get ele(){return getElement(this)}static get style(){return".element{display:inline-block;position:relative}.element.active,.element .eleName{-webkit-transition:all .2s;transition:all .2s}.element.active{cursor:pointer}.element.active:hover .eleName{text-shadow:rgba(0,0,0,.8) 0 .1em .1em;-webkit-transform:translateY(-.1em);transform:translateY(-.1em)}.element .valenceNumBox{position:absolute;top:-.75em;height:1em;line-height:1em;width:100%;font-size:60%;-ms-flex-align:center;align-items:center}.element .valenceNumBox,.element .valenceNumBox .valenceNum{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.element .valenceNumBox .valenceNum{color:#f5a623;font-weight:bolder}"}},KEY="nb-chem-equ-usertip",NbChemEquPanel=class{constructor(t){registerInstance(this,t),this.MED_TYPE_REDOX={},this.isTouchDevice=!1,this.topAndBtmHeight=40,this.forceWidth=0,this.supportsPassiveOption=!1,this.expression="2H2+O2==2H2O",this.aboutList=[],this.minWidth=420,this.minHeight=260,this.width=580,this.height=300,this.showState=0,this.scale=1,this.showStateAble_1=!1,this.showStateAble_2=!1,this.showMedType=!1,this.showTip=!localStorage.getItem(KEY),this.isFull=!1,this.isShowAbloutList=!1,this.showMedTypeSet=new Set,this.eqConScale=.25,this.eqConLeft=0,this.eqConTop=0,this.eqConTopArea=[0,0],this.eqConLeftArea=[0,0],this.showDefinitionList=!1,this.isShowMoreList=!1,this.hadResize=!1,this.needChangePos=!1,this.close=createEvent(this,"close",7),this.converExp=createEvent(this,"converExp",7),this.tapAbloutExp=createEvent(this,"tapAbloutExp",7)}sizeChangeHander(t){let{height:s,width:i}=t.detail,e=this.scale;if(this.scale=i/this.width,t.detail.fullScreenChange){let t=this.equation.getBoundingClientRect();this.eqConLeft=.5*Math.max(this.minWidth,i)-t.width/this.eqConScale*.5,this.eqConTop=.5*(Math.max(this.minHeight,s)-this.topAndBtmHeight)-t.height/this.eqConScale*.5}else this.needChangePos=!0;this.eqConScale=Math.max(Math.min(1.5,this.eqConScale/e*this.scale),.1),this.hadResize=!0}equCreatCompleteHander(t){let s=t.detail;this.showStateAble_1=s.showEleTransformAble_0,this.showStateAble_2=s.showEleTransformAble_1,this.showMedType=s.showMedType,this.MED_TYPE_REDOX=s.MED_TYPE_REDOX,(this.showStateAble_1||this.showStateAble_2||this.showMedType||this.MED_TYPE_REDOX)&&(this.topAndBtmHeight=92)}componentWillLoad(){this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;const t=SystemUtils.getInstance();this.supportsPassiveOption=t.supportsPassiveOption}componentDidLoad(){this.panel=DomUtils.domQuerySelector(this.ele,"nb-panel"),this.header=DomUtils.domQuerySelector(this.ele,"#header"),this.equation=DomUtils.domQuerySelector(this.ele,"nb-chem-equation"),this.width=Math.max(this.equation.getBoundingClientRect().width+40,this.minWidth),this.innerDom=DomUtils.domQuerySelector(this.ele,"#inner"),this.init()}componentDidUpdate(){this.setDragArea()}setDragArea(){if(!this.hadResize)return;let t,s=this.equation.getBoundingClientRect(),i=this.innerDom.getBoundingClientRect();this.forceWidth?(t=this.forceWidth,this.forceWidth=0):t=i.width;let e=i.height,h=this.eqConLeftArea[1]-this.eqConLeftArea[0],n=this.eqConTopArea[1]-this.eqConTopArea[0],l=this.eqConLeft-this.eqConLeftArea[0],o=this.eqConTop-this.eqConTopArea[0];this.eqConLeftArea[0]=.5*-(s.width/this.eqConScale+s.width)+100*this.eqConScale,this.eqConLeftArea[1]=this.eqConLeftArea[0]+s.width+t-100*this.eqConScale*2,this.eqConTopArea[0]=.5*-(s.height/this.eqConScale+s.height)+100*this.eqConScale,this.eqConTopArea[1]=this.eqConTopArea[0]+s.height+e-100*this.eqConScale*2,this.needChangePos?(this.needChangePos=!1,h&&n&&(this.eqConLeft=l/h*(this.eqConLeftArea[1]-this.eqConLeftArea[0])+this.eqConLeftArea[0],this.eqConTop=o/n*(this.eqConTopArea[1]-this.eqConTopArea[0])+this.eqConTopArea[0])):(this.eqConLeft<this.eqConLeftArea[0]&&(this.eqConLeft=this.eqConLeftArea[0]),this.eqConLeft>this.eqConLeftArea[1]&&(this.eqConLeft=this.eqConLeftArea[1]),this.eqConTop<this.eqConTopArea[0]&&(this.eqConTop=this.eqConTopArea[0]),this.eqConTop>this.eqConTopArea[1]&&(this.eqConTop=this.eqConTopArea[1]))}init(){this.initEqConPos(this.width,this.height),this.setGesture(),this.initHeaderEvents()}setGesture(){this.isTouchDevice?this.addTouchDeviceEvents():this.addPcDeviceEvents()}addTouchDeviceEvents(){let t,s,i,e=!1,h=[],n=!1;this.innerDom.addEventListener("touchstart",l=>{l.touches&&1===l.touches.length&&(l.stopPropagation(),l.preventDefault(),s={x:l.touches[0].pageX,y:l.touches[0].pageY},n=!0),l.touches&&l.touches.length>=2&&(e=!0,n=!1,t=this.eqConScale,i={x:((h=l.touches)[0].pageX+h[1].pageX)/2,y:(h[0].pageY+h[1].pageY)/2},l.stopPropagation(),l.preventDefault())}),document.addEventListener("touchmove",l=>{if(l.touches&&l.touches.length>=2&&e){l.preventDefault(),l.stopPropagation();let s=l.touches,e=this.getDistance(s[0],s[1])/this.getDistance(h[0],h[1]);this.setEqConScaleAndPos(e*t,i)}if(l.touches&&1===l.touches.length&&n){l.preventDefault(),l.stopPropagation();let t=l.touches[0];this.setEqConPos(this.eqConLeft+(t.pageX-s.x),this.eqConTop+(t.pageY-s.y)),s.x=t.pageX,s.y=t.pageY}},!!this.supportsPassiveOption&&{passive:!1}),document.addEventListener("touchend",t=>{e&&(e=!1),0===t.touches.length&&n&&(n=!1)},!!this.supportsPassiveOption&&{passive:!1})}addPcDeviceEvents(){let t,s=!1;this.innerDom.addEventListener("mousedown",i=>{s=!0,(i=i||window.event).preventDefault(),i.stopPropagation(),t={x:i.pageX,y:i.pageY}}),document.addEventListener("mousemove",i=>{s&&((i=i||window.event).preventDefault(),i.stopPropagation(),this.setEqConPos(this.eqConLeft+(i.pageX-t.x),this.eqConTop+(i.pageY-t.y)),t.x=i.pageX,t.y=i.pageY)},!1),document.addEventListener("mouseup",t=>{s&&((t=t||window.event).preventDefault(),t.stopPropagation(),s=!1)},!1)}getDistance(t,s){var i=s.pageX-t.pageX,e=s.pageY-t.pageY;return Math.sqrt(i*i+e*e)}initEqConPos(t,s){let i=this.equation.getBoundingClientRect();this.eqConLeft=.5*Math.max(this.minWidth,t)-i.width/this.eqConScale*.5,this.eqConTop=.5*(Math.max(this.minHeight,s)-this.topAndBtmHeight)-i.height/this.eqConScale*.5,this.hadResize=!0,this.forceWidth=Math.max(this.minWidth,t)}setEqConPos(t,s){this.eqConLeft=Math.max(this.eqConLeftArea[0],Math.min(this.eqConLeftArea[1],t)),this.eqConTop=Math.max(this.eqConTopArea[0],Math.min(this.eqConTopArea[1],s))}changeEqConScale(t){(t=t||window.event).stopPropagation(),t.preventDefault();let s=t.wheelDelta||40*t.detail;if(0===s)return;let i=Math.max(.025,Math.min(.2,Math.abs(s/4800)));this.setEqConScaleAndPos(this.eqConScale+i*(s>0?1:-1),{x:t.pageX,y:t.pageY})}setEqConScaleAndPos(t,s){let i=s.x,e=s.y,h=this.equation.getBoundingClientRect(),n=this.eqConScale,l=(h.left-i)/h.width,o=(h.top-e)/h.height;t=Math.max(Math.min(1.5,t),.1),this.eqConScale=t,this.hadResize=!0;let a=this.eqConScale/n,r=h.width*a,c=h.height*a;this.setEqConPos(this.eqConLeft+(l*r-(h.left-(r-h.width)/2)+i),this.eqConTop+(o*c-(h.top-(c-h.height)/2)+e))}initHeaderEvents(){this.header.addEventListener(this.isTouchDevice?"touchstart":"mousedown",this.startDrag.bind(this),!1)}changeState(t){if(this.timer)return;let s=this.showState;this.showState=0,s!==t&&(this.timer=setTimeout(()=>{this.timer&&(this.timer=null),this.showState=t},20))}showMedTypeHander(t){if("ALL"===t){let t=!0;4===this.showMedTypeSet.size&&(t=!1);for(let s in this.MED_TYPE_REDOX)t?(this.showMedTypeSet.add(s),this.equation.changeMedTypeShowState(s,!0)):(this.showMedTypeSet.delete(s),this.equation.changeMedTypeShowState(s,!1))}else this.showMedTypeSet.has(t)?(this.showMedTypeSet.delete(t),this.equation.changeMedTypeShowState(t,!1)):(this.showMedTypeSet.add(t),this.equation.changeMedTypeShowState(t,!0));this.showMedTypeSet=new Set([...this.showMedTypeSet])}startDrag(t){if(this.panel){if(t.touches){const s=t.touches[0];t.clientX=s.clientX,t.clientY=s.clientY}this.panel.startDrag(t)}}closeTip(t){this.showTip=!1,localStorage.setItem(KEY,"true"),t.stopPropagation(),t.preventDefault()}gotoFull(t){this.isFull=t,this.panel.gotoFull(t),this.isShowAbloutList=!1,this.isShowMoreList=!1}converExpTap(){this.gotoFull(!1),this.converExp.emit({expression:this.expression})}closeTap(){this.close.emit()}changeShowAbloutList(){this.isShowAbloutList=!this.isShowAbloutList}tapAbloutExpHander(t){this.tapAbloutExp.emit({index:t.index}),this.gotoFull(!1)}changeDefinitionListState(){this.showDefinitionList=!this.showDefinitionList}changeShowMoreList(){this.isShowMoreList=!this.isShowMoreList,this.isShowMoreList||(this.isShowAbloutList=!1)}creatBridgeBtnGroupDom(){return[{title:"单线桥",show:this.showStateAble_1,bindId:1},{title:"双线桥",show:this.showStateAble_2,bindId:2}].map(({show:t,title:s,bindId:i},e)=>h("button",{style:{display:t?void 0:"none"},class:"changeBtn btn "+(this.showState===i?"active":"")+(e>0?" hasLine":""),onClick:()=>{this.changeState(i)}},s))}creatDefinitionListDom(){return[{title:"全部",bindId:"ALL"},{title:"氧化剂",bindId:this.MED_TYPE_REDOX.OXIDANT},{title:"还原剂",bindId:this.MED_TYPE_REDOX.REDUCING},{title:"氧化产物",bindId:this.MED_TYPE_REDOX.OXIDANT_PRIDUCT},{title:"还原产物",bindId:this.MED_TYPE_REDOX.REDUCING_PRIDUCT}].map(({title:t,bindId:s})=>{if("ALL"===s){let i=4===this.showMedTypeSet.size;return h("div",{class:"infoList "+(i?"active":""),onClick:()=>{this.showMedTypeHander(s)}},h("span",{class:"box"},i?"✓":""),t)}{let i=this.showMedTypeSet.has(s);return h("div",{class:"infoList "+(i?"active":""),onClick:()=>{this.showMedTypeHander(s)}},h("span",{class:"box"},i?"✓":""),t)}})}creatAboutListDom(){return this.aboutList&&this.aboutList[0]?this.aboutList.map((t,s)=>{let{title:i,subtitle:e,type:n}=t;return h("div",{class:"listItem",onClick:()=>{this.tapAbloutExpHander({index:s})}},h("div",{class:"itemTitle"},i),h("div",{class:"sunTitle"},h("span",{class:"type",style:{display:n?"inline-block":"none"}},n),h("span",{class:"info"},e)))}):h("div",{class:"listItem"},h("div",{class:"itemTitle"},"无"))}render(){return h("nb-panel",{width:this.width,height:this.height,minWidth:this.minWidth,minHeight:this.minHeight,closeVisible:!1},h("div",{slot:"panel-body",id:"panel-body",class:this.isFull?"full":""},h("div",{id:"header"},h("div",{id:"title"},"方程式"),h("div",{id:"btnGroup",style:{display:this.isFull?"none":"flex"}},h("div",{id:"more",onClick:()=>{this.changeShowMoreList()}}),h("div",{id:"full",onClick:()=>{this.gotoFull(!0)}}),h("div",{id:"close",onClick:()=>{this.closeTap()}}))),h("div",{id:"inner",onWheel:t=>{this.changeEqConScale(t)}},h("div",{id:"equation-con",style:{transform:`scale(${this.eqConScale})`,left:`${this.eqConLeft}px`,top:`${this.eqConTop}px`}},h("nb-chem-equation",{style:{transform:`scale(${.25*this.scale})`},eleTransformState:this.showState,expression:this.expression})),h("div",{class:"userTip",style:{display:this.showTip?"block":"none"}},"提示：点击元素可查看价态(有机物除外)",h("span",{class:"closeIcon",onPointerDown:t=>{this.closeTip(t)}},"✕"))),h("div",{id:"footer",style:{height:this.isFull||this.showStateAble_1||this.showStateAble_2?"":"0px",minHeight:this.isFull||this.showStateAble_1||this.showStateAble_2?"":"0px"}},h("div",{class:"fullBtnGroup",style:{display:this.isFull?"flex":"none"}},h("div",{class:"fullBtn",onClick:()=>{this.gotoFull(!1)}},h("div",{class:"back"})),h("div",{class:"fullBtn"},h("button",{class:"about btn "+(this.isShowAbloutList?"active":""),onClick:()=>{this.changeShowAbloutList()}},h("span",{class:"aboutIcon"}),"相关实验"),h("button",{class:"about btn",onClick:()=>{this.converExpTap()}},h("span",{class:"generateIcon"}),"生成实验"))),h("div",{style:{display:this.showStateAble_1||this.showStateAble_2?"flex":"none"}},h("div",{class:"bridgeBtnGroup"},this.creatBridgeBtnGroupDom()),h("div",{class:"definitionList"+(this.showDefinitionList?" active":"")},h("button",{class:"listBtn",onClick:()=>{this.changeDefinitionListState()}},"显示设置 ",h("span",{class:"listIcon"})),h("div",{class:"list",style:{display:this.showDefinitionList?"block":"none"}},this.creatDefinitionListDom())))),h("div",{class:"moreList",style:{display:this.isShowMoreList?"block":"none"}},h("div",{class:this.isShowAbloutList?"active":"",onClick:()=>{this.changeShowAbloutList()}},"相关实验"),h("div",{onClick:()=>{this.converExpTap()}},"生成实验"),h("span",{class:"triangle"})),h("div",{class:"aboutEqList test",style:{display:this.isShowAbloutList?"block":"none"}},this.creatAboutListDom())))}get ele(){return getElement(this)}static get style(){return"\@charset \"UTF-8\";#panel-body .about .aboutIcon,.about_def{background-position:0 -511px}#panel-body .about .aboutIcon,#panel-body .about.active .aboutIcon,.about_def,.about_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:24px;height:24px}#panel-body .about.active .aboutIcon,.about_pre{background-position:0 -279px}#panel-body #footer .fullBtnGroup .fullBtn .back,.back_def{background-position:0 -540px}#panel-body #footer .fullBtnGroup .fullBtn .back,#panel-body #footer .fullBtnGroup .fullBtn .back:hover,.back_def,.back_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:24px;height:24px}#panel-body #footer .fullBtnGroup .fullBtn .back:hover,.back_hov{background-position:0 -569px}#panel-body #footer .fullBtnGroup .fullBtn .back:active,.back_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;background-position:0 -76px;width:24px;height:24px}#panel-body #header #close,.close_def{background-position:0 -105px}#panel-body #header #close,#panel-body #header #close:hover,.close_def,.close_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:25px;height:24px}#panel-body #header #close:hover,.close_hov{background-position:0 -134px}#panel-body #header #close:active,.close_pre{background-position:0 -163px}#panel-body #header #close:active,#panel-body .creatExperiment,.close_pre,.conversion_def{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:25px;height:24px}#panel-body .creatExperiment,.conversion_def{background-position:0 -192px}#panel-body .creatExperiment:hover,.conversion_hov{background-position:0 -221px}#panel-body .creatExperiment:active,#panel-body .creatExperiment:hover,.conversion_hov,.conversion_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:25px;height:24px}#panel-body .creatExperiment:active,.conversion_pre{background-position:0 -250px}#panel-body #header #full,.full_def{background-position:0 -598px}#panel-body #header #full,#panel-body #header #full:hover,.full_def,.full_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:30px;height:24px}#panel-body #header #full:hover,.full_hov{background-position:0 -308px}#panel-body #header #full:active,.full_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;background-position:0 -337px;width:30px;height:24px}#panel-body .about .generateIcon,.generate_def{background-position:0 -366px}#panel-body .about.active .generateIcon,#panel-body .about .generateIcon,.generate_def,.generate_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:24px;height:24px}#panel-body .about.active .generateIcon,.generate_pre{background-position:0 -395px}#panel-body #header #more,.more_def{background-position:0 -424px}#panel-body #header #more,#panel-body #header #more:hover,.more_def,.more_hov{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:30px;height:24px}#panel-body #header #more:hover,.more_hov{background-position:0 -453px}#panel-body #header #more:active,.more_pre{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;background-position:0 -482px;width:30px;height:24px}#panel-body #footer .definitionList.active .listBtn .listIcon,.triangle_1{background-position:0 -19px}#panel-body #footer .definitionList.active .listBtn .listIcon,.full #footer .definitionList .listBtn .listIcon,.triangle_1,.triangle_2{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:14px;height:14px}.full #footer .definitionList .listBtn .listIcon,.triangle_2{background-position:0 -38px}.full #footer .definitionList .listBtn.active .listIcon,.triangle_3{background-position:0 -57px}#panel-body #footer .definitionList .listBtn .listIcon,.full #footer .definitionList .listBtn.active .listIcon,.triangle_3,.triangle_4{background-image:url(assets/imgs/nbk/nbk_nb-chem-equ-panel_sprite.png);background-size:30px 622px;background-repeat:no-repeat;width:14px;height:14px}#panel-body #footer .definitionList .listBtn .listIcon,.triangle_4{background-position:0 0}nb-panel{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button{display:inherit}.full{border-radius:0!important}.full #footer .bridgeBtnGroup{height:42px!important}.full #footer .changeBtn{width:105px!important;top:0!important;height:42px!important;z-index:1!important}.full #footer .definitionList{height:42px!important;width:150px!important}.full #footer .definitionList .listBtn{top:0!important}.full #footer .definitionList .listBtn .listIcon{margin-top:4px}.full #footer .definitionList .list{width:134px!important}.full .aboutEqList{bottom:55px!important;right:130px!important;top:auto!important;left:auto!important}.test::-webkit-scrollbar{width:4px}.test::-webkit-scrollbar-track{background-color:transparent}.test::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.5);border-radius:2px}#panel-body{-webkit-transition:all .2s;transition:all .2s;background:#464c54;height:100%;width:100%;-webkit-box-shadow:0 4px 26px 0 rgba(24,26,30,.51);box-shadow:0 4px 26px 0 rgba(24,26,30,.51);border-radius:8px;overflow:hidden;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#panel-body .btn{cursor:pointer;outline:none;border:none}#panel-body .about{width:80px;height:26px;line-height:26px;text-align:center;background:hsla(0,0%,100%,.1);border-radius:6px;margin:0;font-size:14px;color:#a6a6a6}#panel-body .about .aboutIcon,#panel-body .about .generateIcon{margin:0!important}#panel-body .about.active{background:#2592ff;color:#fff}#panel-body .about.active .aboutIcon,#panel-body .about.active .generateIcon{margin:0!important}#panel-body #header{min-height:40px;width:100%;background:-webkit-gradient(linear,left top,left bottom,from(#3f444c),to(#343940));background:linear-gradient(180deg,#3f444c,#343940);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}#panel-body #header #title{color:#c5cad2;font-size:14px}#panel-body #header #btnGroup{position:absolute;display:-ms-flexbox;display:flex;width:100%;-ms-flex-align:center;align-items:center;-ms-flex-pack:end;justify-content:flex-end}#panel-body #header #btnGroup :nth-child(n){position:relative;margin:0 6px 0 0}#panel-body #header #btnGroup :last-child{margin-right:15px}#panel-body #inner{position:relative;height:100%;-ms-flex-negative:100;flex-shrink:100;color:hsla(0,0%,100%,.85);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;overflow:hidden}#panel-body #inner nb-chem-equation{font-size:96px;-webkit-transition:all .1s;transition:all .1s;-webkit-transform:scale(.25);transform:scale(.25)}#panel-body #inner #equation-con{position:absolute}#panel-body #inner .userTip{position:absolute;top:12px;width:250px;height:24px;line-height:24px;text-align:center;background:rgba(37,146,255,.2);border-radius:5px;font-size:12px;color:hsla(0,0%,100%,.85)}#panel-body #inner .userTip .closeIcon{position:absolute;right:4px;cursor:pointer}#panel-body #footer{min-height:52px;height:52px;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}#panel-body #footer .fullBtnGroup{position:absolute;width:100%;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}#panel-body #footer .fullBtnGroup .fullBtn{margin:0 20px;height:42px;background:#141516;-webkit-box-shadow:0 5px 12px 0 rgba(0,0,0,.5);box-shadow:0 5px 12px 0 rgba(0,0,0,.5);border-radius:10px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#panel-body #footer .fullBtnGroup .fullBtn :nth-child(n){position:relative;margin:10px}#panel-body #footer .fullBtnGroup .fullBtn .about{width:100px;height:26px}#panel-body #footer .bridgeBtnGroup{height:28px;border-radius:6px;overflow:hidden}#panel-body #footer .bridgeBtnGroup .changeBtn{width:70px;height:28px;background:rgba(0,0,0,.2);font-size:14px;color:#a6a6a6;padding:0;position:relative;float:left}#panel-body #footer .bridgeBtnGroup .changeBtn.active{color:#fff;background:#2592ff}#panel-body #footer .bridgeBtnGroup .changeBtn.hasLine{border-left:1px solid #464c54}#panel-body #footer .definitionList{width:100px;height:28px;background:rgba(0,0,0,.2);border-radius:6px;margin-left:12px;text-align:center}#panel-body #footer .definitionList.active{background:#2e92ff!important}#panel-body #footer .definitionList.active .listBtn{color:#fff}#panel-body #footer .definitionList .listBtn{padding:0;margin:0;background:transparent;border:none;outline:none;width:100%;height:100%;font-size:14px;position:relative;color:#a6a6a6;cursor:pointer}#panel-body #footer .definitionList .listBtn .listIcon{margin-top:2px;position:fixed}#panel-body #footer .definitionList .list{position:absolute;bottom:55px;color:#999;font-size:13px;width:84px;background:rgba(35,38,40,.98);padding:8px;border-radius:6px}#panel-body #footer .definitionList .list .infoList{text-align:left;line-height:24px;cursor:pointer}#panel-body #footer .definitionList .list .infoList .box{width:10px;height:10px;border-radius:2px;display:inline-block;border:1px solid #999;margin-right:7px;position:relative;top:1px;line-height:12px}#panel-body #footer .definitionList .list .infoList.active{color:#2e92ff}#panel-body #footer .definitionList .list .infoList.active .box{border-color:#2e92ff}#panel-body .aboutEqList{position:absolute;top:45px;right:-205px;width:260px;max-height:225px;padding:10px;background:#232628;border:1px solid #25282e;border-radius:6px;overflow-y:auto}#panel-body .aboutEqList .listItem{margin:4px 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}#panel-body .aboutEqList .listItem .itemTitle{color:#fff;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#panel-body .aboutEqList .listItem .sunTitle{color:#a6a6a6;font-size:12px;width:100%;text-overflow:ellipsis}#panel-body .aboutEqList .listItem .type{background-color:#bb5b5b;border-radius:2px;display:inline-block;width:1em;height:1em;line-height:1em;text-align:center;margin-right:.5em}#panel-body .aboutEqList .listItem .info{height:1em;text-overflow:ellipsis}#panel-body .aboutEqList .listItem:hover .itemTitle,#panel-body .aboutEqList .listItem:hover .sunTitle{color:#2592ff}#panel-body .aboutEqList .listItem:hover .type{background-color:#2592ff;color:#fff}#panel-body .moreList{position:absolute;background:rgba(35,38,40,.98);width:86px;padding:12px 0;border-radius:6px;font-size:14px;line-height:20px;right:80px;top:45px}#panel-body .moreList div{color:#a6a6a6;line-height:24px;height:24px;padding:0 12px}#panel-body .moreList div.active,#panel-body .moreList div:hover{color:#fff;background:#2e92ff}#panel-body .moreList .triangle{position:absolute;top:-12px;right:12px;width:0;height:0;border:6px solid;border-color:transparent transparent rgba(35,38,40,.98)}"}};class IngredientNode{constructor(t,s){this.count=1,this.valence=0,this.content=t,this.type=s}}const ING_TYPE={ELEMENT:"ELEMENT",SUBSCRIPT:"SUBSCRIPT",SYMBOL:"SYMBOL",COEFFICIENT:"COEFFICIENT"},MED_TYPE_REDOX={OXIDANT:"OXIDANT",REDUCING:"REDUCING",OXIDANT_PRIDUCT:"OXIDANT_PRIDUCT",REDUCING_PRIDUCT:"REDUCING_PRIDUCT"},ELEMENT_VALENCE={H:{nums:[1,-1]},Li:{nums:[1]},Be:{nums:[2]},B:{nums:[3]},C:{nums:[-1,2,4]},N:{nums:[-3,1,2,3,4,5]},O:{nums:[-2]},F:{nums:[-1]},Na:{nums:[1]},Mg:{nums:[2]},Al:{nums:[3]},Si:{nums:[4]},P:{nums:[-3,3,5]},S:{nums:[-2,2,4,6]},Cl:{nums:[-1,1,3,5,7]},K:{nums:[1]},Ca:{nums:[2]},Cr:{nums:[2,3,6]},Mn:{nums:[2,4,6,7]},Fe:{nums:[2,3]},Cu:{nums:[1,2]},Zn:{nums:[2]},Br:{nums:[-1,1,3,5,7]},Ag:{nums:[1]},I:{nums:[-1,5,7]},Ba:{nums:[2]},Hg:{nums:[2]},Pb:{nums:[2,4]}},CONDIRIONS_FORMAT={"=":{"=":1,">":2},"<":{">":3}},NbChemEquation=class{constructor(t){registerInstance(this,t),this.expression="CaCO3+2HCl=点燃&加热、浓硫酸>CaCl2+H2O+CO2_g",this.showEleTransform=!0,this.listenerHover=!1,this.eleTransformState=2,this.showEleTransformAble_0=!1,this.showEleTransformAble_1=!1,this.showMedType=!1,this.productCompleteCount=0,this.resultCompleteCount=0,this.equationObj={product:[],result:[],condition:[],arrowType:1},this.calcedEleTransform=!0,this.elementControl={product:{},result:{}},this.eleTransformList=[],this.equCreatComplete=createEvent(this,"equCreatComplete",7)}medCreatComplete(t){let{medName:s,chemEles:i,target:e,calculateValence:h}=t.detail;if(h||(this.calcedEleTransform=!1),this.calcedEleTransform){if(this.productCompleteCount<this.equationObj.product.length)for(let t=0,h=this.equationObj.product.length;t<h;t++){let h=this.equationObj.product[t];if(h.medName===s){h.chemEles=i,h.medObj=e,this.productCompleteCount++;break}}if(this.resultCompleteCount<this.equationObj.result.length)for(let t=0,h=this.equationObj.result.length;t<h;t++){let h=this.equationObj.result[t];if(h.medName===s){h.chemEles=i,h.medObj=e,this.resultCompleteCount++;break}}this.productCompleteCount>=this.equationObj.product.length&&this.resultCompleteCount>=this.equationObj.result.length&&(this.createElementControl(),this.calculateEleTransform())}}async changeMedTypeShowState(t,s){switch(t){case MED_TYPE_REDOX.OXIDANT:case MED_TYPE_REDOX.REDUCING:this.equationObj.product.forEach(i=>{let{medObj:e}=i;e.changeMedTypeShowState(t,s)});break;case MED_TYPE_REDOX.OXIDANT_PRIDUCT:case MED_TYPE_REDOX.REDUCING_PRIDUCT:this.equationObj.result.forEach(i=>{let{medObj:e}=i;e.changeMedTypeShowState(t,s)})}}componentWillLoad(){this.analyticalExpression()}componentDidLoad(){this.showEleTransform&&this.equCreatComplete.emit({showEleTransformAble_0:this.showEleTransformAble_0,showEleTransformAble_1:this.showEleTransformAble_1,showMedType:this.showMedType,MED_TYPE_REDOX})}async analyticalExpression(){let t,s=this.expression,i=s.length,e="",h="",n="";for(let a=0;a<i;a++){let i=s[a];t?isNaN(t)?t[i]?t=t[i]:n+=i:h+=i:CONDIRIONS_FORMAT[i]?t=CONDIRIONS_FORMAT[i]:e+=i}this.equationObj.arrowType=t,this.equationObj.condition=n.split("&");let l=e.split("+"),o=h.split("+");l.forEach(t=>{let s=parseInt(t);s?t=t.replace(""+s,""):s=1,this.equationObj.product.push({medName:t,module:s,chemEles:[]})}),o.forEach(t=>{let s=parseInt(t);s?t=t.replace(""+s,""):s=1,this.equationObj.result.push({medName:t,module:s,chemEles:[]})})}createElementControl(){if(!this.showEleTransform)return;let t=this.elementControl;this.equationObj.product.forEach(s=>{let{chemEles:i,module:e,medObj:h}=s,n=t.product;i.forEach((t,s)=>{let i=t.content,l=Object.assign({medObj:h,indexInMed:s},t);l.count*=e,n[i]?n[i].push(l):n[i]=[l]})}),this.equationObj.result.forEach(s=>{let{chemEles:i,module:e,medObj:h}=s,n=t.result;i.forEach((t,s)=>{let i=t.content,l=Object.assign({medObj:h,indexInMed:s},t);l.count*=e,n[i]?n[i].push(l):n[i]=[l]})})}calculateEleTransform(){if(!this.showEleTransform||!this.calcedEleTransform||"Fe3O4+8HCl==FeCl2+2FeCl3+4H2O"==this.expression)return;let elementControl=this.elementControl;for(let t in elementControl.product){let s=elementControl.product[t],i=elementControl.result[t];for(let t=0,e=s.length;t<e;t++){let e=s[t];for(let t=0,s=i.length;t<s;t++){let s=i[t];if(e.valence===s.valence){let t=Math.min(e.count,s.count);e.count-=t,s.count-=t}}}}for(let t in elementControl.product){let s=elementControl.product[t],i=elementControl.result[t];for(let t=0,e=s.length;t<e;t++){let e=s[t];if(e.count)for(let t=0,s=i.length;t<s;t++){let s=i[t];if(s.count&&e.valence!==s.valence){let t={from:e,to:s};this.eleTransformList.push(t)}}}}if(this.eleTransformList.length<=0)this.showEleTransformAble_0=!1,this.showEleTransformAble_1=!1;else{this.eleTransformList.length>2?this.showEleTransformAble_1=!1:2===this.eleTransformList.length&&(this.showEleTransformAble_1=!0);let last=this.eleTransformList[0].from.bindElement,length=this.eleTransformList.length,i=1;for(;i<length;i++){let t=this.eleTransformList[i].from.bindElement;if(t!==last)break}if(i>=length)this.showEleTransformAble_0=!1;else{this.eleTransformList.sort((a,b)=>{let dis=eval(a.from.valence)-eval(a.to.valence)-(eval(b.from.valence)-eval(b.to.valence));return Number.isNaN(dis)&&(dis=1e3),dis});let count=0,i=0,length=this.eleTransformList.length,from=this.eleTransformList[0].from,to=this.eleTransformList[length-1].from;for(;i<length;i++){let a=this.eleTransformList[i],dis=eval(a.to.valence)-eval(a.from.valence);if(dis>0){if(count+=dis*Math.min(a.to.count,a.from.count),a.from.bindElement!==from.bindElement){from=null;break}}else if(a.from.bindElement!==to.bindElement){to=null;break}}from&&to?(this.showEleTransform_0_config={from,to,coefficient:count,electronics:1,mode:0},this.showEleTransformAble_0=!0):this.showEleTransformAble_0=!1}}this.eleTransformList.length&&(this.showMedType=!0,this.eleTransformList.forEach(config=>{let{from,to}=config;eval(from.valence)<eval(to.valence)?(from.medObj.setMedType(MED_TYPE_REDOX.REDUCING),to.medObj.setMedType(MED_TYPE_REDOX.OXIDANT_PRIDUCT)):(from.medObj.setMedType(MED_TYPE_REDOX.OXIDANT),to.medObj.setMedType(MED_TYPE_REDOX.REDUCING_PRIDUCT))}))}createMedDom(t){let s=[];for(let i=0,e=t.length;i<e;i++){let h=t[i];h.module>1&&s.push(h.module),s.push(h),i!==e-1&&s.push("+")}return s.map(t=>isNaN(t)?"+"===t?h("div",{class:"inl-blc"}," ",t," "):h("div",{class:"inl-blc"},h("nb-chem-med",{medInfo:t,medCalVal:this.showEleTransform})):h("div",{class:"inl-blc module"}," ",t," "))}createEleDom(){if(this.calcedEleTransform){if(this.showEleTransformAble_0&&1===this.eleTransformState)return h("nb-chem-bridge",{eleTransformState:this.eleTransformState,bridgeConfig:Object.assign({},this.showEleTransform_0_config),style:{color:"#3BC3FF"}});if(this.showEleTransformAble_1&&2===this.eleTransformState){let t=["#3BC3FF","#3BC3FF"];return this.eleTransformList.map((s,i)=>h("nb-chem-bridge",{eleTransformState:this.eleTransformState,bridgeConfig:Object.assign({},s),style:{color:t[i]}}))}}}render(){return h("div",{class:"equation"},this.createMedDom(this.equationObj.product),h("div",{class:"inl-blc"},h("nb-chem-condition",{conditionAry:this.equationObj.condition,arrowType:this.equationObj.arrowType})),this.createMedDom(this.equationObj.result),this.createEleDom())}get el(){return getElement(this)}static get style(){return".equation{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.inl-blc{margin:0 .1em;white-space:nowrap}.module{margin-right:-.1em}"}},commonlyRegular={isUpperCaseChar:t=>t&&1===t.length?/^[A-Z]$/.test(t):(console.error("isUpperCase 传入参数不合法"),!1),isLowerCaseChar:t=>t&&1===t.length?/^[a-z]$/.test(t):(console.error("isUpperCase 传入参数不合法"),!1),isNumberChar:t=>t&&1===t.length?/^[0-9]$/.test(t):(console.error("isUpperCase 传入参数不合法"),!1)},REG=commonlyRegular,NbChemMed=class{constructor(t){registerInstance(this,t),this.medName="KO2",this.medInfo={},this.medCalVal=!0,this.ingredientList=[],this.calculateValence=!0,this.medTypeRedox=new Set,this.medChar="",this.showMedTypeSet=new Set,this.eleCreatCompletedCount=0,this.eleList=[],this.allEle=[],this.medCreatComplete=createEvent(this,"medCreatComplete",7)}eleCreatComplete(t){++this.eleCreatCompletedCount>=this.allEle.length&&this.medCreatComplete.emit({chemEles:this.allEle,target:this,medName:this.medName,calculateValence:this.calculateValence})}async setMedType(t){this.medTypeRedox.add(t)}async getElementBounds(t){let s=DomUtils.domQuerySelector(this.ele,".med"),{offsetLeft:i,offsetTop:e}=s,h=this.allEle[t];return h?h.bindElement.getBounds().then(t=>({left:i+t.left,top:e+t.top,height:t.height,width:t.width})):null}async changeMedTypeShowState(t,s){let i=new Set([...this.showMedTypeSet]);s?i.add(t):i.delete(t),this.showMedTypeSet=i}componentWillLoad(){this.medName=this.medInfo.medName||this.medName,this.analyticalMedName(),this.medCalVal&&(this.analyticalEleNum(),this.getAllValence())}componentDidLoad(){}analyticalMedName(){let t=this.medName,s=this.ingredientList,i=t.length;if(!s.length){for(let e=0;e<i;e++){let h;s.length>0&&(h=s[s.length-1]);let n,l=t[e];REG.isUpperCaseChar(l)?n=new IngredientNode(l,ING_TYPE.ELEMENT):REG.isLowerCaseChar(l)?h&&(h.type===ING_TYPE.SYMBOL&&"_"===h.content&&e===i-1?"s"===l?(h.content="↓",this.medChar="↓"):"g"===l&&(h.content="↑",this.medChar="↑"):h.type===ING_TYPE.ELEMENT&&(h.content+=l)):REG.isNumberChar(l)?h&&"·"===h.content?n=new IngredientNode(l,ING_TYPE.COEFFICIENT):!h||h.type!==ING_TYPE.ELEMENT&&h.type!==ING_TYPE.SYMBOL?!h||h.type!==ING_TYPE.SUBSCRIPT&&h.type!==ING_TYPE.COEFFICIENT||(h.content+=l):n=new IngredientNode(l,ING_TYPE.SUBSCRIPT):"|"===l&&h.type===ING_TYPE.SYMBOL&&/^\|+$/.test(h.content)?h.content+=l:n=new IngredientNode(l,ING_TYPE.SYMBOL),n&&s.push(n)}this.medChar&&s.pop()}}analyticalEleNum(){let t,s=this.ingredientList,i=this.eleList,e=this.allEle,h=0;for(let o=0,a=s.length;o<a;o++){let a=s[o];if(a.type===ING_TYPE.ELEMENT)n=a,i[h]||(i[h]=[]),i[h].push(n),e.push(n);else if(a.type===ING_TYPE.SUBSCRIPT){let s=a.content<<0;t.type===ING_TYPE.ELEMENT?t.count*=s:/^[\]|\)]$/.test(t.content)&&l(t.content,s,o-2)}else if("·"===a.content){h+=1;continue}t=a}var n;function l(t,i,e){const h={"]":"[",")":"("}[t];i>>=0;let n=s,l=e;for(;!n[l]||n[l].content!==h;){let{type:t}=n[l];t===ING_TYPE.ELEMENT&&(n[l].count*=i),l--}}}getAllValence(){let t=[].concat(this.eleList);this.eleList.length>1&&(t=t.sort((t,s)=>t.length-s.length)),t.forEach(t=>{this.getOnceValence(t)})}getOnceValence(t){if(1===t.length)return;if(function(){for(let s=0,i=t.length;s<i;s++){let e=t[s];if("C"!==e.content)continue;let h=t[s+1];if(!h){let i=t[s-1];return!i||"Ca"!==i.content||1!==i.count||2!==e.count}if("O"===h.content){if(h.count/e.count==3)return!1;if(2===i&&1===e.count&&[1,2].includes(h.count))return!1}else if("N"===h.content){if(h.count/e.count==1)return!1}else if("S"===h.content&&h.count/e.count==2)return!1;return!0}}())return void(this.calculateValence=!1);let s=[],i=[];if(2===t.length){if(/^(Na|H|K)$/.test(t[0].content)&&2===t[0].count&&/^O$/.test(t[1].content)&&2===t[1].count)return t[0].valence=1,void(t[1].valence=-1);"Fe"===t[0].content&&"O"===t[1].content&&3===t[0].count&&4===t[1].count?(t[0].valence="8/3",t[1].valence=-2):"K"===t[0].content&&"O"===t[1].content&&1===t[0].count&&2===t[1].count&&(t[0].valence=1,t[1].valence="-1/2")}t.forEach(t=>{if(t.valence)return;let e=ELEMENT_VALENCE[t.content];e||console.warn(`无法找到${t.content}的价态列表`);let{nums:h}=e;h&&1===h.length?t.valence=h[0]:(i.push(e),s.push(t))}),function e(h){if(h>=s.length)return function(){let s=0;return t.forEach(t=>{let{valence:i,count:e}=t;s+=i*e}),0===s}();let n=i[h].nums;for(let t=0,i=n.length;t<i;t++)if(s[h].valence=n[t],e(h+1))return!0;return!1}(0)}render(){return h("div",{class:"medBox"},h("div",{class:"med"},this.creatMed(),this.creatMedType()),h("span",{class:"char"},this.medChar))}creatMed(){return this.ingredientList.map(t=>{switch(ING_TYPE.SYMBOL===t.type&&/^\|+$/.test(t.content)&&(t.content=["-","=","≡"][t.content.length-1]),t.type){case ING_TYPE.SUBSCRIPT:return h("span",{class:"subscript"},t.content);case ING_TYPE.ELEMENT:{let s;return s=this.calculateValence&&this.medCalVal?h("nb-chem-element",{eleInfo:t,valenceAble:this.calculateValence&&this.medCalVal}):h("span",null,t.content)}default:return h("span",null,t.content)}})}creatMedType(){let t=Array.from(this.medTypeRedox).filter(t=>this.showMedTypeSet.has(t)).map(t=>({OXIDANT:"氧化剂",REDUCING:"还原剂",OXIDANT_PRIDUCT:"氧化产物",REDUCING_PRIDUCT:"还原产物"})[t]);return h("div",{class:"medType"},h("div",{class:"medTypeInner"},t.join("/")))}get ele(){return getElement(this)}static get style(){return".med{position:relative;display:inline-block;white-space:nowrap}.med .subscript{position:relative;top:.2em;line-height:1em;font-size:60%}.med .medType{position:absolute;top:100%;left:0;width:100%;height:.5em;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;color:#f5a623;font-weight:bolder}.med .medType .medTypeInner{font-size:.5em}"}},NbNumFraction=class{constructor(t){registerInstance(this,t),this.showPositive=!1}componentWillLoad(){let t=!1,s=this.value;if(/[0-9]+\/[0-9]+$/.test(s)){let i=/^-/;i.test(s)&&(t=!0,s=s.replace(i,"")),this.numbers=s.split("/")}this.isNegative=t}componentDidLoad(){let t=DomUtils.domQuerySelector(this.ele,".fractionBox");this.color=getComputedStyle(t).color}render(){return h("span",{class:"fractionBox"},h("div",{class:"valenceNum"},h("div",{class:"symbol"},this.isNegative?"-":this.showPositive?"+":h("span",{style:{width:"0px"}}," ")),h("div",{class:"fraction"},h("div",{class:"num"},this.numbers[0]),h("div",{class:"line",style:{borderColor:this.color}}," "),h("div",{class:"num"},this.numbers[1]))))}get ele(){return getElement(this)}static get style(){return".fractionBox{display:inline-block}.valenceNum,.valenceNum .fraction{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.valenceNum .fraction{font-size:60%;line-height:.8em;-ms-flex-direction:column;flex-direction:column}.valenceNum .line{width:100%;height:0;border-top:.1rem solid #000;margin:.1em 0}.valenceNum .num{padding:0 .1em}.valenceNum .symbol{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;margin-top:-.1em}"}},NbPanel=class{constructor(t){registerInstance(this,t),this.isFull=!1,this.hold=!1,this.enableEdge=!1,this.x=0,this.y=0,this.width=400,this.height=300,this.minWidth=200,this.minHeight=200,this.maxWidth=void 0,this.maxHeight=void 0,this.canResize=!0,this.closeVisible=!0,this.supportsPassiveOption=!1,this.scaling=!1,this.downP=null,this.downDragP=null,this.guangObj={direct:"",isIntersect:!1,line:{width:540,height:35},btn:{width:50,height:30}},this.editorPanelStyle={tempObj:{}},this.moveOptions={bWidth:0,bHeight:0},this.scaleWinMove=t=>{if(!this.downP)return;if(!t.clientX&&t.touches){const s=t.touches[0];t.clientX=s.clientX,t.clientY=s.clientY}const s=t.clientY-this.downP.y;this.width+=t.clientX-this.downP.x,this.width=Math.max(this.minWidth,this.width),this.maxWidth&&(this.width=Math.min(this.maxWidth,this.width)),this.height+=s,this.height=Math.max(this.minHeight,this.height),this.maxHeight&&(this.height=Math.min(this.maxHeight,this.height)),this.downP.x=t.clientX,this.downP.y=t.clientY,this.scaling=!0,this.sizeChange.emit({target:this,width:this.width,height:this.height})},this.scaleWinEnd=()=>{this.downP=null,this.scaling=!1,document.removeEventListener("touchend",this.scaleWinEnd),document.removeEventListener("touchmove",this.scaleWinMove),document.removeEventListener("mouseup",this.scaleWinEnd),document.removeEventListener("mousemove",this.scaleWinMove)},this.moveDrag=t=>{if(!this.downDragP)return;if(!t.clientX&&t.touches){const s=t.touches[0];t.clientX=s.clientX,t.clientY=s.clientY}const s=t.clientX-this.downDragP.x,i=t.clientY-this.downDragP.y;this.getPanelDom()&&(this.x+=s,this.y+=i),this.downDragP.x=t.clientX,this.downDragP.y=t.clientY,NBUtils.M.getXYLen(this.oriDownDragP.x,this.oriDownDragP.y,t.clientX,t.clientY)>20&&this.moveChange.emit({target:this})},this.endDrag=t=>{this.downDragP&&(this.downDragP=null,document.removeEventListener("touchend",this.endDrag),document.removeEventListener("touchmove",this.moveDrag),document.removeEventListener("mouseup",this.endDrag),document.removeEventListener("mousemove",this.moveDrag),this.moveEnd.emit(t))},this.sizeChange=createEvent(this,"sizeChange",7),this.moveChange=createEvent(this,"moveChange",7),this.moveEnd=createEvent(this,"moveEnd",7),this.closed=createEvent(this,"closed",7)}async moveToXY(t,s){this.x=t,this.y=s}async setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}async getRect(){return new NBUtils.Rectangle(this.x,this.y,this.width,this.height)}async gotoFull(t=!0){this.isFull=t,setTimeout(()=>{let{offsetWidth:t,offsetHeight:s}=this.getPanelDom();this.sizeChange.emit({target:this,width:t,height:s,fullScreenChange:!0})},20)}componentWillLoad(){const t=SystemUtils.getInstance();this.supportsPassiveOption=t.supportsPassiveOption}componentDidLoad(){$(window).off(".equ.panel").on("resize.equ.panel",()=>{if(this.isFull){let{offsetWidth:t,offsetHeight:s}=this.getPanelDom();this.sizeChange.emit({target:this,width:t,height:s,fullScreenChange:!0})}})}getPanelDom(){return DomUtils.domQuerySelector(this.ele,".editor-panel")}scaleWinBegin(t){this.hold||(this.downP={x:0,y:0},this.downP.x=t.clientX,this.downP.y=t.clientY,this.supportsPassiveOption?(document.addEventListener("touchend",this.scaleWinEnd,{passive:!1}),document.addEventListener("touchmove",this.scaleWinMove,{passive:!1})):(document.addEventListener("touchend",this.scaleWinEnd),document.addEventListener("touchmove",this.scaleWinMove)),document.addEventListener("mouseup",this.scaleWinEnd),document.addEventListener("mousemove",this.scaleWinMove))}async startDrag(t){console.log("startdrag~~~~~~~~~",t),this.hold||this.isFull||(this.downDragP=new NBUtils.Point(t.clientX,t.clientY),this.oriDownDragP=this.downDragP.clone(),this.moveOptions.bWidth=document.body.clientWidth,this.moveOptions.bHeight=document.body.clientHeight,this.supportsPassiveOption?(document.addEventListener("touchend",this.endDrag,{passive:!1}),document.addEventListener("touchmove",this.moveDrag,{passive:!1})):(document.addEventListener("touchend",this.endDrag),document.addEventListener("touchmove",this.moveDrag)),document.addEventListener("mouseup",this.endDrag),document.addEventListener("mousemove",this.moveDrag))}panelCloseHandle(t){this.closed.emit({target:this})}render(){return h("div",{class:"editor-panel",style:this.isFull?{left:0,top:0,width:"100%",height:"100%",position:"fixed",zIndex:9999999}:{left:`${this.x}px`,top:`${this.y}px`,width:`${this.width}px`,height:`${this.height}px`,position:"absolute"}},h("div",{class:this.scaling?"body-shell panel-div":"panel-div"},h("slot",{name:"panel-body"},h("div",null))),h("div",{class:"panel-close-btn",onClick:t=>this.panelCloseHandle(t),style:{display:this.closeVisible?"block":"none"}}),h("nb-touch-cell",{class:"editor-dragBtn",style:{display:this.canResize&&!this.isFull?"block":"none"},onNbMouseDown:t=>this.scaleWinBegin(t.detail)},h("div",{class:"editor-dragBtn-img",style:{display:this.hold?"none":""}})))}get ele(){return getElement(this)}static get style(){return".close_hov{background-position:0 -19px}.close_hov,.close_pre{background-image:url(assets/imgs/nbk/nbk_nb-panel_sprite.png);background-size:540px 246px;background-repeat:no-repeat;width:30px;height:24px}.close_pre{background-position:0 -48px}.colse_def,nb-panel .editor-panel .panel-close-btn{background-position:0 -77px;width:30px;height:24px}.colse_def,.guangtop,nb-panel .editor-panel .panel-close-btn,nb-panel .editor-panel .panel-guang .panel-guang-line{background-image:url(assets/imgs/nbk/nbk_nb-panel_sprite.png);background-size:540px 246px;background-repeat:no-repeat}.guangtop,nb-panel .editor-panel .panel-guang .panel-guang-line{background-position:0 -211px;width:540px;height:35px}.meau_def,nb-panel .editor-panel .panel-guang .panel-guang-btn{background-position:0 -106px}.meau_def,.meau_hov,nb-panel .editor-panel .panel-guang .panel-guang-btn,nb-panel .editor-panel .panel-guang .panel-guang-btn:hover{background-image:url(assets/imgs/nbk/nbk_nb-panel_sprite.png);background-size:540px 246px;background-repeat:no-repeat;width:50px;height:30px}.meau_hov,nb-panel .editor-panel .panel-guang .panel-guang-btn:hover{background-position:0 -141px}.meau_pre,nb-panel .editor-panel .panel-guang .panel-guang-btn:active{background-image:url(assets/imgs/nbk/nbk_nb-panel_sprite.png);background-size:540px 246px;background-repeat:no-repeat;background-position:0 -176px;width:50px;height:30px}.scale,nb-panel .editor-panel .editor-dragBtn .editor-dragBtn-img{background-image:url(assets/imgs/nbk/nbk_nb-panel_sprite.png);background-size:540px 246px;background-repeat:no-repeat;background-position:0 0;width:14px;height:14px}nb-panel .body-shell{pointer-events:none}nb-panel .panel-div{height:100%}nb-panel .moveAnimate{-webkit-transition:left .5s,top .5s;transition:left .5s,top .5s}nb-panel .editor-panel{position:relative;display:block;background:-webkit-gradient(linear,left top,left bottom,from(#3f444c),color-stop(48%,#3a3f46),to(#343940));background:linear-gradient(180deg,#3f444c,#3a3f46 48%,#343940);border-radius:8px;-webkit-box-shadow:0 2px 16px 0 rgba(0,0,0,.09);box-shadow:0 2px 16px 0 rgba(0,0,0,.09);z-index:999}nb-panel .editor-panel .editor-alpha{position:absolute;width:100%;margin-top:40px;height:90%;opacity:0;background-color:#ec6941}nb-panel .editor-panel .editor-dragBtn{position:absolute;width:25px;height:25px;right:0;bottom:0}nb-panel .editor-panel .editor-dragBtn .editor-dragBtn-img{position:absolute;right:4px;bottom:4px}nb-panel .editor-panel .panel-guang{position:fixed}nb-panel .editor-panel .panel-close-btn{position:absolute;right:10px;top:8.5px}nb-panel .editor-panel .drag-bar{width:100%;height:40px;pointer-events:none;background:rgba(236,105,65,0);position:absolute;display:inline-block}"}},NbTouchCell=class{constructor(t){registerInstance(this,t),this.istouch=!1,this.nbMouseDown=createEvent(this,"nbMouseDown",7)}touchStartHanlder(t){const s=t.touches[0];t.clientX=s.clientX,t.clientY=s.clientY,this.nbMouseDown.emit(t),this.istouch=!0}mouseDownHanlder(t){this.istouch?this.istouch=!1:this.nbMouseDown.emit(t)}componentWillLoad(){}get element(){return getElement(this)}static get style(){return""}};export{NbChemBridge as nb_chem_bridge,NbChemCondition as nb_chem_condition,NbChemElement as nb_chem_element,NbChemEquPanel as nb_chem_equ_panel,NbChemEquation as nb_chem_equation,NbChemMed as nb_chem_med,NbNumFraction as nb_num_fraction,NbPanel as nb_panel,NbTouchCell as nb_touch_cell};